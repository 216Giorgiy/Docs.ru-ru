---
title: "Управление ключами и время существования"
author: rick-anderson
description: "Описывает управление ключами и временем существования."
keywords: "ASP.NET Core ключа управления DPAPI, DataProtection"
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: ef7dad2a-7029-4ae5-8f06-1fbebedccaa4
ms.technology: aspnet
ms.prod: asp.net-core
uid: security/data-protection/configuration/default-settings
ms.openlocfilehash: 913eda69f88ef05a990d9465024f4fa6b08cd1b7
ms.sourcegitcommit: 0b6c8e6d81d2b3c161cd375036eecbace46a9707
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2017
---
# <a name="key-management-and-lifetime"></a>Управление ключами и время существования

<a name=data-protection-default-settings></a>

## <a name="key-management"></a>Управление ключами

Система пытается обнаружить его в рабочей среде и обеспечивают хорошей настройки поведения значения по умолчанию. Используемая эвристика выглядит следующим образом.

1. Если система размещенный в веб-сайтов Azure, ключи сохраняются в папку «% HOME%\ASP.NET\DataProtection-Keys». Эта папка поддерживаемый сети хранения данных и синхронизации на всех компьютерах, где размещено приложение. Ключи не защищены при хранении. Эта папка предоставляет ключей ко всем экземплярам приложения в одного слота развертывания. Слоты отдельное развертывание, например промежуточной и производственной сред, не будут совместно использовать ключ кольцо. При переключении между слотами развертывания, например Смена промежуточного хранения в рабочей среде или с использованием / B тестирование, любой системе с помощью защиты данных не будет иметь возможность расшифровать хранимым данным с помощью ключей в предыдущей области памяти. Это приведет к пользователям, выполняется выход из приложения ASP.NET, использующего стандартный ASP.NET cookie по промежуточного слоя, как оно использует защиты данных, чтобы защитить свои файлы cookie. При желании колец ключ слот независимый поставщик внешних ключей, такие как хранилище больших двоичных объектов Azure, хранилище ключей Azure, хранилище SQL, или кэш Redis.

2. Если профиль пользователя, ключи, сохраняются в папке «% LOCALAPPDATA%\ASP.NET\DataProtection-Keys». Кроме того Если операционная система Windows, они будут зашифрованы при хранении с помощью DPAPI.

3. Если приложение размещается в службах IIS, ключи, сохраняются в реестре HKLM в специальный раздел реестра, ACLed только для учетной записи рабочего процесса. Они шифруются при хранении с помощью DPAPI.

4. Если ни одно из этих условий совпадает, ключи не сохраняются за пределами текущего процесса. Когда процесс завершится, все созданные ключи будут потеряны.

Разработчик получает полный контроль над всегда и можно переопределить, как и где хранятся ключи. Первые три параметра выше должен хорошо значения по умолчанию для большинства приложений, подобно тому, как ASP.NET <machineKey> работал для автоматического создания процедуры. Конечный, параметр обратной попадают — единственный сценарий, действительно требуется разработчику указать [конфигурации](overview.md) переднего плана, если им нужен сохраняемость ключа, но этот план должен встречаться только в тех редких случаях.

>[!WARNING]
> Если разработчик переопределяет этот эвристический алгоритм и указывает система защиты данных на определенный репозиторий ключа, автоматическое шифрование ключей при хранении, будут отключены. Неактивные защиту можно включить с помощью [конфигурации](overview.md).

## <a name="key-lifetime"></a>Время жизни ключа

Ключи по умолчанию имеют жизни 90 дней. После истечения срока действия ключа, система автоматически создать новый ключ и назначить новый ключ активным ключом. При условии, что удалено ключи остаются в системе вы по-прежнему сможете расшифровать данные, защищенные с их. В разделе [управление ключами](../implementation/key-management.md#data-protection-implementation-key-management-expiration) для получения дополнительной информации.

## <a name="default-algorithms"></a>Алгоритмы по умолчанию

Алгоритм защиты полезных данных по умолчанию, используемый — AES-256-CBC по конфиденциальности и HMACSHA256 подлинность. 512-разрядный главный ключ, откатывается каждые 90 дней, используется для формирования двух вложенных ключей, используемых для этих алгоритмов на основе каждого полезных данных. В разделе [подраздел производного](../implementation/subkeyderivation.md#data-protection-implementation-subkey-derivation-aad) для получения дополнительной информации.
