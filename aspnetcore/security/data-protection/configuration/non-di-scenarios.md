---
title: "Зависимые сценарии не DI"
author: rick-anderson
description: 
keywords: ASP.NET Core
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: a7d8a962-80ff-48e3-96f6-8472b7ba2df9
ms.technology: aspnet
ms.prod: asp.net-core
uid: security/data-protection/configuration/non-di-scenarios
ms.openlocfilehash: 54a930c26f9f48ea0e6f7865e2927bcde0f4d6c0
ms.sourcegitcommit: 0b6c8e6d81d2b3c161cd375036eecbace46a9707
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2017
---
# <a name="non-di-aware-scenarios"></a>Зависимые сценарии не DI

Система защиты данных обычно проектируется [добавляется в контейнер службы](../consumer-apis/overview.md) и передавать зависимые компоненты через механизм DI. Тем не менее могут быть некоторые случаи, когда это нецелесообразно, особенно при импорте существующего приложения в системе.

Для поддержки следующих сценариев пакет Microsoft.AspNetCore.DataProtection.Extensions содержит конкретный тип DataProtectionProvider, которая предлагает простой способ использования системы защиты данных минуя DI конкретного пути кода. Сам тип реализует IDataProtectionProvider и создав его так же легко, как поставщик DirectoryInfo, где должно храниться этот поставщик криптографических ключей.

Пример:

[!code-none[Main](non-di-scenarios/_static/nodisample1.cs)]

>[!WARNING]
> По умолчанию DataProtectionProvider конкретный тип, не шифруются необработанные материал ключа перед его сохранении в файловой системе. Это необходимо для поддержки сценариев, где совместное использование точек разработчика к сети, в этом случае система защиты данных не может вывести автоматически механизм соответствующие статических ключа шифрования.
>
>Кроме того, не конкретный тип DataProtectionProvider [изолировать приложения](overview.md#data-protection-configuration-per-app-isolation) по умолчанию, так что все приложения указывали на том же каталоге ключа могут совместно использовать полезных данных до тех пор, пока их параметры цели соответствуют.

Разработчик приложения можно преодолеть эти при необходимости. Конструктор DataProtectionProvider принимает [обратного вызова необязательная конфигурация](overview.md#data-protection-configuration-callback) которого можно использовать для настройки поведения системы. В следующем примере показано восстановление изоляцию через явный вызов SetApplicationName, а также демонстрирует настройки системы для автоматического шифрования материализованного ключа с помощью Windows DPAPI. Если каталог указывает на общий ресурс UNC, вы можете распределять общий сертификат на всех компьютерах, соответствующих и настроить систему, чтобы вместо этого используйте шифрование на основе сертификата через вызов [ProtectKeysWithCertificate](overview.md#configuring-x509-certificate).

[!code-none[Main](non-di-scenarios/_static/nodisample2.cs)]

>[!TIP]
> Экземпляры этого типа DataProtectionProvider много времени. Если приложение поддерживает несколько экземпляров этого типа, и они указывает на том же каталоге хранилища ключей, может наблюдаться снижение производительности приложения. Предполагаемое использование — что разработчик приложения после создания экземпляра этого типа, затем сохранить максимально повторное использование одной ссылки на этот. Тип DataProtectionProvider и все IDataProtector экземпляры, созданные из этого являются потокобезопасными для нескольких клиентов.
