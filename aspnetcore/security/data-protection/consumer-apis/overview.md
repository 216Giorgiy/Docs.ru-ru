---
title: "Общие сведения об API-интерфейсы потребителя"
author: rick-anderson
description: 
keywords: ASP.NET Core
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: f69beb9d-a519-43a8-857c-f6b01886a903
ms.technology: aspnet
ms.prod: asp.net-core
uid: security/data-protection/consumer-apis/overview
ms.openlocfilehash: d23a6ce50eef71f393124b9420f4ba473904d8b4
ms.sourcegitcommit: 0b6c8e6d81d2b3c161cd375036eecbace46a9707
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/11/2017
---
# <a name="consumer-apis-overview"></a>Общие сведения об API-интерфейсы потребителя

Интерфейсы IDataProtectionProvider и IDataProtector являются базовые интерфейсы, через которые потребители используют система защиты данных. Они находятся в пакете Microsoft.AspNetCore.DataProtection.Abstractions.

## <a name="idataprotectionprovider"></a>IDataProtectionProvider

Интерфейс поставщика представляет в корневом каталоге системы защиты данных. Он не может использоваться непосредственно для защиты или снять защиту данных. Вместо этого потребитель необходимо получить ссылку на IDataProtector путем вызова IDataProtectionProvider.CreateProtector(purpose), где целью является строка, описывающая вариант использования предполагаемого получателя. В разделе [строки цели](purpose-strings.md) гораздо Дополнительные сведения о назначение этого параметра и выборе подходящего значения.

## <a name="idataprotector"></a>IDataProtector

Интерфейс предохранитель возвращается путем вызова CreateProtector, и именно этот интерфейс, который потребители могут использовать для выполнения установки и снятия защиты операций.

Чтобы защитить часть данных, передается методу защитить данные. Базовый интерфейс определяет метод, который преобразует byte [] -> byte [], но также имеется перегрузки (предоставляется в виде метода расширения), которая преобразует строку "->" строки. Безопасность, предлагаемую два метода является одинаковым; разработчику необходимо выбрать любой перегрузка является наиболее удобным для их варианта использования. Независимо от выбора перегрузки значения, возвращенного защитить метод теперь защищены (enciphered и подтверждены вскрытия) и приложения можно отправить ненадежный клиент.

Чтобы отменить защиту защищенными фрагмента данных, передается методу Unprotect защищенных данных. (Существует byte []-перегрузки на основе и на основе строк для удобства разработчиков.) Если защищенные полезных данных, созданных предыдущими вызовами метода защитить на этом же IDataProtector, метод Unprotect возвращает исходный незащищенный полезных данных. Если защищенные полезных данных подделки или был создан с помощью различных IDataProtector, метод Unprotect вызовет CryptographicException.

Понятие таким же или разных IDataProtector связывает к концепцию цели. Если были созданы два экземпляра IDataProtector один и тот же корневой IDataProtectionProvider, но через строк в разных целях в вызове IDataProtectionProvider.CreateProtector, то они считаются [предохранители разных](purpose-strings.md), и одно не будет снять защиту полезных данных, созданные другим.

## <a name="consuming-these-interfaces"></a>Использование этих интерфейсов

Для компонента поддержкой DI предполагаемого использования является, компонент получают параметр IDataProtectionProvider в конструкторе и что DI система автоматически предоставляет этой службы, при создании экземпляра компонента.

> [!NOTE]
> Некоторые приложения (например, консольные приложения или приложения ASP.NET 4.x) может быть DI поддержкой, нельзя использовать механизм описанных здесь. Для этих сценариев, обратитесь к [не зависимые сценарии DI](../configuration/non-di-scenarios.md) Дополнительные сведения о получении экземпляр IDataProtection поставщика, минуя DI.

В следующем примере показано три понятия:

1. [Добавление в систему защиты данных](../configuration/overview.md) в контейнер службы

2. С помощью DI для получения экземпляра IDataProtectionProvider и

3. Создать IDataProtector из IDataProtectionProvider и использовать его для установки и снятия защиты данных.

[!code-csharp[Main](../using-data-protection/samples/protectunprotect.cs?highlight=26,34,35,36,37,38,39,40)]

Пакет Microsoft.AspNetCore.DataProtection.Abstractions содержит метод расширения IServiceProvider.GetDataProtector для удобства разработчиков. Он инкапсулирует единственную операцию, как получение IDataProtectionProvider у поставщика услуг и вызов IDataProtectionProvider.CreateProtector. Следующий пример демонстрирует его использование.

[!code-csharp[Main](./overview/samples/getdataprotector.cs?highlight=15)]

>[!TIP]
> Экземпляры IDataProtectionProvider и IDataProtector являются потокобезопасными для нескольких клиентов. Она предназначена, когда компонент получает ссылку на IDataProtector через вызов CreateProtector, эта ссылка будет использоваться для нескольких вызовов защитить и вызов Unprotect.A Unprotect вызовет CryptographicException, если не может быть защищенным полезных данных проверить или расшифровать. Некоторые компоненты нужна возможность пропускать ошибки во время снятия защиты операций; компонент, который считывает файлы cookie проверки подлинности может обработать эту ошибку и обрабатывать запрос, как если бы объекты cookie не на всех, а не ошибкой запроса сразу. В частности, компонентами, которые хотите такого поведения следует перехватывать CryptographicException вместо подавление всех исключений.
