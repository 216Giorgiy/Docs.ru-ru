---
title: "Общие сведения об API-интерфейсы потребителя"
author: rick-anderson
description: "Этот документ содержит краткий обзор различных интерфейсов API, доступные в библиотеке защиты данных ASP.NET Core потребителя."
manager: wpickett
ms.author: riande
ms.date: 10/14/2016
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: article
uid: security/data-protection/consumer-apis/overview
ms.openlocfilehash: 7f335681581b73e36e5b4deaf513255770900965
ms.sourcegitcommit: a510f38930abc84c4b302029d019a34dfe76823b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/30/2018
---
# <a name="consumer-apis-overview"></a>Общие сведения об API-интерфейсы потребителя

`IDataProtectionProvider` И `IDataProtector` интерфейсы являются базовые интерфейсы, через которые потребители используют система защиты данных. Они находятся в [Microsoft.AspNetCore.DataProtection.Abstractions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Abstractions/) пакета.

## <a name="idataprotectionprovider"></a>IDataProtectionProvider

Интерфейс поставщика представляет в корневом каталоге системы защиты данных. Он не может использоваться непосредственно для защиты или снять защиту данных. Вместо этого пользователь должен получить ссылку на `IDataProtector` путем вызова `IDataProtectionProvider.CreateProtector(purpose)`, где цель — строка, описывающая вариант использования предполагаемого получателя. В разделе [строки цели](purpose-strings.md) гораздо Дополнительные сведения о назначение этого параметра и выборе подходящего значения.

## <a name="idataprotector"></a>IDataProtector

Интерфейс предохранитель возвращается путем вызова `CreateProtector`и его этот интерфейс, который потребители могут использовать для выполнения установки и снятия защиты операций.

Чтобы защитить часть данных, передачи данных `Protect` метод. Базовый интерфейс определяет метод, который преобразует byte [] -> byte [], но есть также перегрузки (предоставляется в виде метода расширения), которая преобразует строку "->" строки. Безопасность, предлагаемую два метода является одинаковым; разработчику необходимо выбрать любой перегрузка является наиболее удобным для их варианта использования. Независимо от выбора перегрузки значения, возвращенного защитить метод теперь защищены (enciphered и подтверждены вскрытия) и приложения можно отправить ненадежный клиент.

Чтобы снять защиту с защищенными фрагмента данных, передайте защищенных данных в `Unprotect` метод. (Существует byte []-перегрузки на основе и на основе строк для удобства разработчиков.) Если защищенные полезных данных, созданных предыдущими вызовами метода `Protect` на этом же `IDataProtector`, `Unprotect` метод вернет исходный незащищенный полезных данных. Если защищенный полезные данные подделки или был создан с помощью другой `IDataProtector`, `Unprotect` метод вызывает исключение CryptographicException.

Понятие таким же или разных `IDataProtector` WITH ties обратно в понятие цели. Если два `IDataProtector` экземпляров формировались с таким же корнем `IDataProtectionProvider` , но через строк в разных целях в вызове `IDataProtectionProvider.CreateProtector`, то все они считаются [предохранители разных](purpose-strings.md), и одно не сможет снять защиту полезные данные, созданные другим.

## <a name="consuming-these-interfaces"></a>Использование этих интерфейсов

Для компонента поддержкой DI предполагаемого использования является, компонент предпринять `IDataProtectionProvider` параметр в конструкторе и что DI система автоматически предоставляет этой службы, при создании экземпляра компонента.

> [!NOTE]
> Некоторые приложения (например, консольные приложения или приложения ASP.NET 4.x) может быть DI поддержкой, нельзя использовать механизм описанных здесь. Для этих сценариев, обратитесь к [не зависимые сценарии DI](../configuration/non-di-scenarios.md) Дополнительные сведения о получении экземпляром `IDataProtection` поставщика, минуя DI.

В следующем примере показано три понятия:

1. [Добавление в систему защиты данных](../configuration/overview.md) в контейнер службы

2. С помощью DI для получения экземпляра `IDataProtectionProvider`, и

3. Создание `IDataProtector` из `IDataProtectionProvider` и использовать его для установки и снятия защиты данных.

[!code-csharp[Main](../using-data-protection/samples/protectunprotect.cs?highlight=26,34,35,36,37,38,39,40)]

Пакет Microsoft.AspNetCore.DataProtection.Abstractions содержит метод расширения `IServiceProvider.GetDataProtector` для удобства разработчиков. Он инкапсулирует единственную операцию обоих получение `IDataProtectionProvider` из поставщика служб и вызова `IDataProtectionProvider.CreateProtector`. Следующий пример демонстрирует его использование.

[!code-csharp[Main](./overview/samples/getdataprotector.cs?highlight=15)]

>[!TIP]
> Экземпляры `IDataProtectionProvider` и `IDataProtector` потокобезопасны для нескольких клиентов. Он предназначен, когда компонент получает ссылку на `IDataProtector` через вызов `CreateProtector`, он будет использовать эту ссылку для нескольких вызовов `Protect` и `Unprotect`. Вызов `Unprotect` CryptographicException вызывает исключение, если защищенный полезных данных не может быть проверена или расшифровать. Некоторые компоненты нужна возможность пропускать ошибки во время снятия защиты операций; компонент, который считывает файлы cookie проверки подлинности может обработать эту ошибку и обрабатывать запрос, как если бы объекты cookie не на всех, а не ошибкой запроса сразу. В частности, компонентами, которые хотите такого поведения следует перехватывать CryptographicException вместо подавление всех исключений.
