---
title: "Общие сведения о защите данных"
author: rick-anderson
description: "В этом документе введено понятие защиты данных и общие принципы проектирования соответствующие API-интерфейсы ASP.NET Core."
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.technology: aspnet
ms.prod: asp.net-core
uid: security/data-protection/introduction
ms.openlocfilehash: b02ef9121e50ab9d9f24032d32f1e65fe73049c0
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2018
---
# <a name="introduction-to-data-protection"></a><span data-ttu-id="9b1a5-103">Общие сведения о защите данных</span><span class="sxs-lookup"><span data-stu-id="9b1a5-103">Introduction to Data Protection</span></span>

<span data-ttu-id="9b1a5-104">Веб-приложений часто требуется хранить конфиденциальные данные.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-104">Web applications often need to store security-sensitive data.</span></span> <span data-ttu-id="9b1a5-105">Windows предоставляет DPAPI для настольных приложений, но это не подходит для веб-приложений.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-105">Windows provides DPAPI for desktop applications but this is unsuitable for web applications.</span></span> <span data-ttu-id="9b1a5-106">Стек защиты данных ASP.NET Core предоставляют простой и удобный API-интерфейса криптографии разработчик может использовать для защиты данных, включая управление ключами и поворота.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-106">The ASP.NET Core data protection stack provide a simple, easy to use cryptographic API a developer can use to protect data, including key management and rotation.</span></span>

<span data-ttu-id="9b1a5-107">Стек защиты данных ASP.NET Core предназначен для использования в качестве долгосрочной заменой <machineKey> элемент в ASP.NET 1.x - 4.x.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-107">The ASP.NET Core data protection stack is designed to serve as the long-term replacement for the <machineKey> element in ASP.NET 1.x - 4.x.</span></span> <span data-ttu-id="9b1a5-108">Она может решать многие из недостатки использования старого шифрования стека в то же время предоставляя out встроенное решение для большинства вариантов использования, которые чаще всего возникают современных приложений.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-108">It was designed to address many of the shortcomings of the old cryptographic stack while providing an out-of-the-box solution for the majority of use cases modern applications are likely to encounter.</span></span>

## <a name="problem-statement"></a><span data-ttu-id="9b1a5-109">Постановка задачи</span><span class="sxs-lookup"><span data-stu-id="9b1a5-109">Problem statement</span></span>

<span data-ttu-id="9b1a5-110">Общее постановка можно четко сформулировать в одном предложении: необходимо сохранить доверенные данные для последующего извлечения, но я не доверять механизм сохраняемости.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-110">The overall problem statement can be succinctly stated in a single sentence: I need to persist trusted information for later retrieval, but I don't trust the persistence mechanism.</span></span> <span data-ttu-id="9b1a5-111">В терминах web это могут быть написаны как «Требуется приема-передачи надежным через ненадежный клиент.»</span><span class="sxs-lookup"><span data-stu-id="9b1a5-111">In web terms, this might be written as "I need to round-trip trusted state via an untrusted client."</span></span>

<span data-ttu-id="9b1a5-112">Это типичный пример — это файл cookie проверки подлинности или носителя токена.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-112">The canonical example of this is an authentication cookie or bearer token.</span></span> <span data-ttu-id="9b1a5-113">Сервер создает «Я Groot и иметь разрешения xyz» токен, и передает его клиенту.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-113">The server generates an "I am Groot and have xyz permissions" token and hands it to the client.</span></span> <span data-ttu-id="9b1a5-114">Отменено клиент представляет токен на сервер, но этот сервер должен каких-либо гарантий, что клиент не подделан маркер.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-114">At some future date the client will present that token back to the server, but the server needs some kind of assurance that the client hasn't forged the token.</span></span> <span data-ttu-id="9b1a5-115">Таким образом, первое требование: подлинность (так)</span><span class="sxs-lookup"><span data-stu-id="9b1a5-115">Thus the first requirement: authenticity (a.k.a.</span></span> <span data-ttu-id="9b1a5-116">целостность, проверки правописания вскрытия).</span><span class="sxs-lookup"><span data-stu-id="9b1a5-116">integrity, tamper-proofing).</span></span>

<span data-ttu-id="9b1a5-117">Поскольку сохраненное состояние является доверенным для сервера, мы полагаем, что это состояние может содержать сведения, относящиеся к рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-117">Since the persisted state is trusted by the server, we anticipate that this state might contain information that's specific to the operating environment.</span></span> <span data-ttu-id="9b1a5-118">Это может быть в форме путь к файлу, разрешение, дескриптор или других непрямую ссылку или иную часть данных конкретного сервера.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-118">This could be in the form of a file path, a permission, a handle or other indirect reference, or some other piece of server-specific data.</span></span> <span data-ttu-id="9b1a5-119">Такие данные следует обычно не будут предоставлены ненадежный клиент.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-119">Such information should generally not be disclosed to an untrusted client.</span></span> <span data-ttu-id="9b1a5-120">Таким образом второе требование: конфиденциальность.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-120">Thus the second requirement: confidentiality.</span></span>

<span data-ttu-id="9b1a5-121">Наконец поскольку различными современных приложений мы узнали является отдельных компонентов потребуется воспользоваться преимуществами этой системы независимо от других компонентов в системе.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-121">Finally, since modern applications are componentized, what we've seen is that individual components will want to take advantage of this system without regard to other components in the system.</span></span> <span data-ttu-id="9b1a5-122">Для экземпляра Если этот стек использует компонент токена носителя, он должен использовать без вмешательства механизм противодействия CSRF, также могут использовать тот же стек.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-122">For instance, if a bearer token component is using this stack, it should operate without interference from an anti-CSRF mechanism that might also be using the same stack.</span></span> <span data-ttu-id="9b1a5-123">Таким образом окончательного требование: изоляции.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-123">Thus the final requirement: isolation.</span></span>

<span data-ttu-id="9b1a5-124">Мы случае можно указать дополнительные ограничения для сужения области в соответствии с требованиями.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-124">We can provide further constraints in order to narrow the scope of our requirements.</span></span> <span data-ttu-id="9b1a5-125">Предполагается, что все службы, находящейся в пределах криптосистеме равной степени надежными и что данные не нужно создать или использовать за пределами служб в нашем прямое управление.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-125">We assume that all services operating within the cryptosystem are equally trusted and that the data doesn't need to be generated or consumed outside of the services under our direct control.</span></span> <span data-ttu-id="9b1a5-126">Кроме того нам требуется, что операции имеют максимально возможной скоростью, так как каждый запрос к веб-служба может пройти через криптосистеме один или несколько раз.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-126">Furthermore, we require that operations are as fast as possible since each request to the web service might go through the cryptosystem one or more times.</span></span> <span data-ttu-id="9b1a5-127">Это делает симметричного шифрования идеально подходит для данного сценария, и мы скидки асимметричное шифрование, пока таких время, когда она нужна.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-127">This makes symmetric cryptography ideal for our scenario, and we can discount asymmetric cryptography until such a time that it's needed.</span></span>

## <a name="design-philosophy"></a><span data-ttu-id="9b1a5-128">Принципы разработки</span><span class="sxs-lookup"><span data-stu-id="9b1a5-128">Design philosophy</span></span>

<span data-ttu-id="9b1a5-129">Мы запустили путем выявления проблем с существующие стека.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-129">We started by identifying problems with the existing stack.</span></span> <span data-ttu-id="9b1a5-130">После создания, мы исследованных ландшафта существующие решения и подтвердила, что с существующие решения не довольно возможности, мы поиск.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-130">Once we had that, we surveyed the landscape of existing solutions and concluded that no existing solution quite had the capabilities we sought.</span></span> <span data-ttu-id="9b1a5-131">Затем мы разработан решение, основанное на несколько замечания.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-131">We then engineered a solution based on several guiding principles.</span></span>

* <span data-ttu-id="9b1a5-132">Система должны обеспечивать простоты конфигурации.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-132">The system should offer simplicity of configuration.</span></span> <span data-ttu-id="9b1a5-133">В идеале система будет требует настройки и разработчики могут попаданий посадки.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-133">Ideally the system would be zero-configuration and developers could hit the ground running.</span></span> <span data-ttu-id="9b1a5-134">В ситуациях, где разработчики должны настроить определенный аспект (например, хранилище ключей) следует учесть перед собой простой этих определенных конфигураций.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-134">In situations where developers need to configure a specific aspect (such as the key repository), consideration should be given to making those specific configurations simple.</span></span>

* <span data-ttu-id="9b1a5-135">Предоставляют простой API потребительском.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-135">Offer a simple consumer-facing API.</span></span> <span data-ttu-id="9b1a5-136">API-интерфейсы должно быть легко использовать правильно и сложности при использовании неправильно.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-136">The APIs should be easy to use correctly and difficult to use incorrectly.</span></span>

* <span data-ttu-id="9b1a5-137">Разработчикам не следует узнать принципы управления ключами.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-137">Developers shouldn't learn key management principles.</span></span> <span data-ttu-id="9b1a5-138">Система должна поддерживать выбора алгоритма и ключа временем существования от имени для разработчиков.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-138">The system should handle algorithm selection and key lifetime on the developer's behalf.</span></span> <span data-ttu-id="9b1a5-139">В идеальном случае разработчик даже никогда не должны иметь доступ к необработанные материал ключа.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-139">Ideally the developer should never even have access to the raw key material.</span></span>

* <span data-ttu-id="9b1a5-140">Ключи должны быть защищены при хранении, когда это возможно.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-140">Keys should be protected at rest when possible.</span></span> <span data-ttu-id="9b1a5-141">Система должна определить механизм защиты соответствующее значение по умолчанию и автоматического применения.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-141">The system should figure out an appropriate default protection mechanism and apply it automatically.</span></span>

<span data-ttu-id="9b1a5-142">С этими правилами, помните, мы разработали простой, [удобные](using-data-protection.md) стека защиты данных.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-142">With these principles in mind we developed a simple, [easy to use](using-data-protection.md) data protection stack.</span></span>

<span data-ttu-id="9b1a5-143">В основном защиты данных ASP.NET Core API-интерфейсы не предназначены для неопределенного сохраняемости Конфиденциально полезных данных.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-143">The ASP.NET Core data protection APIs are not primarily intended for indefinite persistence of confidential payloads.</span></span> <span data-ttu-id="9b1a5-144">Другие технологии, такие как [CNG Windows DPAPI](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx) и [Azure Rights Management](https://docs.microsoft.com/rights-management/) больше подходят для сценария хранилища не ограничена, и они обладают возможностями соответственно строгого управления ключами.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-144">Other technologies like [Windows CNG DPAPI](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx) and [Azure Rights Management](https://docs.microsoft.com/rights-management/) are more suited to the scenario of indefinite storage, and they have correspondingly strong key management capabilities.</span></span> <span data-ttu-id="9b1a5-145">С другой стороны, нет ничего запретить разработчик с помощью интерфейсов API защиты данных ASP.NET Core для долгосрочной защиты конфиденциальных данных.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-145">That said, there's nothing prohibiting a developer from using the ASP.NET Core data protection APIs for long-term protection of confidential data.</span></span>

## <a name="audience"></a><span data-ttu-id="9b1a5-146">Аудитория</span><span class="sxs-lookup"><span data-stu-id="9b1a5-146">Audience</span></span>

<span data-ttu-id="9b1a5-147">Система защиты данных состоит из пяти основных пакетов.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-147">The data protection system is divided into five main packages.</span></span> <span data-ttu-id="9b1a5-148">Различные аспекты эти API-интерфейсы целевой аудитории три основных;</span><span class="sxs-lookup"><span data-stu-id="9b1a5-148">Various aspects of these APIs target three main audiences;</span></span>

1. <span data-ttu-id="9b1a5-149">[Обзор API-интерфейсы потребителя](consumer-apis/overview.md) целевой разработчики приложений и инфраструктуры.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-149">The [Consumer APIs Overview](consumer-apis/overview.md) target application and framework developers.</span></span>

   <span data-ttu-id="9b1a5-150">«Я не хочу получить сведения о том, как функционирует стека или о его настройке.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-150">"I don't want to learn about how the stack operates or about how it's configured.</span></span> <span data-ttu-id="9b1a5-151">Просто требуется для выполнения некоторой операции в виде простого, так как можно с высокой вероятностью успешно с помощью API-интерфейсы.»</span><span class="sxs-lookup"><span data-stu-id="9b1a5-151">I simply want to perform some operation in as simple a manner as possible with high probability of using the APIs successfully."</span></span>

2. <span data-ttu-id="9b1a5-152">[Интерфейсы API настройки](configuration/overview.md) предназначены для разработчиков приложений и системных администраторов.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-152">The [configuration APIs](configuration/overview.md) target application developers and system administrators.</span></span>

   <span data-ttu-id="9b1a5-153">«Я необходимо предоставить система защиты данных, что моя среда требует пути не по умолчанию или параметры».</span><span class="sxs-lookup"><span data-stu-id="9b1a5-153">"I need to tell the data protection system that my environment requires non-default paths or settings."</span></span>

3. <span data-ttu-id="9b1a5-154">Разработчики целевой API-интерфейсы расширяемости ответственный за реализация пользовательской политики.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-154">The extensibility APIs target developers in charge of implementing custom policy.</span></span> <span data-ttu-id="9b1a5-155">Использование этих API-интерфейсов ограничением в тех редких случаях и возникла помнить разработчикам безопасности.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-155">Usage of these APIs would be limited to rare situations and experienced, security aware developers.</span></span>

   <span data-ttu-id="9b1a5-156">«Необходимо заменить весь компонент в системе, так как у меня действительно уникальные требования относительно поведения.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-156">"I need to replace an entire component within the system because I have truly unique behavioral requirements.</span></span> <span data-ttu-id="9b1a5-157">Я хочу узнать uncommonly используемых частей рабочую область API для создания подключаемого модуля, который соответствует требованиям my.»</span><span class="sxs-lookup"><span data-stu-id="9b1a5-157">I am willing to learn uncommonly-used parts of the API surface in order to build a plugin that fulfills my requirements."</span></span>

## <a name="package-layout"></a><span data-ttu-id="9b1a5-158">Макета пакета</span><span class="sxs-lookup"><span data-stu-id="9b1a5-158">Package Layout</span></span>

<span data-ttu-id="9b1a5-159">Стек защиты данных состоит из пяти пакетов.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-159">The data protection stack consists of five packages.</span></span>

* <span data-ttu-id="9b1a5-160">Microsoft.AspNetCore.DataProtection.Abstractions содержит базовые интерфейсы IDataProtectionProvider и IDataProtector.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-160">Microsoft.AspNetCore.DataProtection.Abstractions contains the basic IDataProtectionProvider and IDataProtector interfaces.</span></span> <span data-ttu-id="9b1a5-161">Он также содержит методы расширения полезны, может оказаться полезным при работе с этими типами (например, из-за перегрузки IDataProtector.Protect).</span><span class="sxs-lookup"><span data-stu-id="9b1a5-161">It also contains useful extension methods that can assist working with these types (e.g., overloads of IDataProtector.Protect).</span></span> <span data-ttu-id="9b1a5-162">В разделе потребителя интерфейсы для получения дополнительной информации.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-162">See the consumer interfaces section for more information.</span></span> <span data-ttu-id="9b1a5-163">Если просто потребляют API-интерфейсы, кто отвечает за создание экземпляров система защиты данных, может потребоваться ссылка Microsoft.AspNetCore.DataProtection.Abstractions.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-163">If somebody else is responsible for instantiating the data protection system and you are simply consuming the APIs, you'll want to reference Microsoft.AspNetCore.DataProtection.Abstractions.</span></span>

* <span data-ttu-id="9b1a5-164">Microsoft.AspNetCore.DataProtection содержит базовую реализацию системы защиты данных, в том числе основных криптографических операций, управления ключами, конфигурации и расширяемость.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-164">Microsoft.AspNetCore.DataProtection contains the core implementation of the data protection system, including the core cryptographic operations, key management, configuration, and extensibility.</span></span> <span data-ttu-id="9b1a5-165">Если вы отвечает за создание экземпляров система защиты данных (например, добавление его IServiceCollection) или изменение или расширение его поведение, может потребоваться ссылка Microsoft.AspNetCore.DataProtection.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-165">If you're responsible for instantiating the data protection system (e.g., adding it to an IServiceCollection) or modifying or extending its behavior, you'll want to reference Microsoft.AspNetCore.DataProtection.</span></span>

* <span data-ttu-id="9b1a5-166">Microsoft.AspNetCore.DataProtection.Extensions содержит дополнительные интерфейсы API, разработчики могут оказаться полезными, но которая не входящие в базовый пакет.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-166">Microsoft.AspNetCore.DataProtection.Extensions contains additional APIs which developers might find useful but which don't belong in the core package.</span></span> <span data-ttu-id="9b1a5-167">Например этот пакет содержит простой API «создать экземпляр системы, который указывает на каталог конкретного хранилища ключей без настройки внедрения зависимостей» (Дополнительные сведения).</span><span class="sxs-lookup"><span data-stu-id="9b1a5-167">For instance, this package contains a simple "instantiate the system pointing at a specific key storage directory with no dependency injection setup" API (more info).</span></span> <span data-ttu-id="9b1a5-168">Он также содержит методы расширения для ограничения времени существования полезных данных защищенного (Дополнительные сведения).</span><span class="sxs-lookup"><span data-stu-id="9b1a5-168">It also contains extension methods for limiting the lifetime of protected payloads (more info).</span></span>

* <span data-ttu-id="9b1a5-169">Microsoft.AspNetCore.DataProtection.SystemWeb могут быть установлены в существующее приложение ASP.NET 4.x перенаправлять его <machineKey> операций вместо этого использовать новый стек защиты данных.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-169">Microsoft.AspNetCore.DataProtection.SystemWeb can be installed into an existing ASP.NET 4.x application to redirect its <machineKey> operations to instead use the new data protection stack.</span></span> <span data-ttu-id="9b1a5-170">В разделе [совместимости](compatibility/replacing-machinekey.md#compatibility-replacing-machinekey) для получения дополнительной информации.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-170">See [compatibility](compatibility/replacing-machinekey.md#compatibility-replacing-machinekey) for more information.</span></span>

* <span data-ttu-id="9b1a5-171">Microsoft.AspNetCore.Cryptography.KeyDerivation предоставляет реализацию пароль PBKDF2 хэширования подпрограммы и может использоваться с компьютеров, на которых необходимо безопасно обрабатывать пароли пользователей.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-171">Microsoft.AspNetCore.Cryptography.KeyDerivation provides an implementation of the PBKDF2 password hashing routine and can be used by systems which need to handle user passwords securely.</span></span> <span data-ttu-id="9b1a5-172">В разделе [хэширования паролей](consumer-apis/password-hashing.md) для получения дополнительной информации.</span><span class="sxs-lookup"><span data-stu-id="9b1a5-172">See [Password Hashing](consumer-apis/password-hashing.md) for more information.</span></span>
