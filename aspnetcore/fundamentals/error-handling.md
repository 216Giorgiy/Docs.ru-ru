---
title: "Обработка ошибок в ASP.NET Core"
author: ardalis
description: "Описывается обработка ошибок в приложениях ASP.NET Core"
keywords: "ASP.NET Core, обработка, обработка исключений, ошибок"
ms.author: tdykstra
manager: wpickett
ms.date: 11/30/2016
ms.topic: article
ms.assetid: 4db51023-c8a6-4119-bbbe-3917e272c260
ms.technology: aspnet
ms.prod: asp.net-core
uid: fundamentals/error-handling
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 96a4fed19887a7a9eba08ec70296147f22e41569
ms.sourcegitcommit: 368aabde4de3728a8e5a8c016a2ec61f9c0854bf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/12/2017
---
# <a name="introduction-to-error-handling-in-aspnet-core"></a>Введение в обработку ошибок в ASP.NET Core

По [Стив Смит](https://ardalis.com/) и [Tom Dykstra](https://github.com/tdykstra/)

В этой статье рассматриваются распространенные appoaches к обработке ошибок в приложениях ASP.NET Core.

[Просмотреть или скачать образец кода](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/error-handling/sample)

## <a name="the-developer-exception-page"></a>Странице исключение разработчика

Чтобы настроить приложение для отображения страницы, которая отображает подробные сведения об исключениях, установите `Microsoft.AspNetCore.Diagnostics` NuGet пакета и добавление строки в [настройки метода в класс Startup](startup.md):

[!code-csharp[Main](error-handling/sample/Startup.cs?name=snippet_DevExceptionPage&highlight=7)]

Поместите `UseDeveloperExceptionPage` перед любое по промежуточного слоя, чтобы перехватывать исключения, такие как `app.UseMvc`.

>[!WARNING]
> Включить странице исключение разработчика **только тогда, когда приложение работает в среде разработки**. Сведения об исключении в подробные общего просмотра при запуске приложения в рабочей среде не требуется. [Дополнительные сведения о настройке среды](environments.md).

Для просмотра страницы исключение разработчика, запустить образец приложения со средой, равным `Development`и добавьте `?throw=true` базовый URL-адрес приложения. Страница содержит несколько вкладок с информацией об исключении и запрос. Первая вкладка включает трассировку стека. 

![Трассировка стека](error-handling/_static/developer-exception-page.png)

Следующая вкладка отображается параметры строки запроса, если они имеются.

![Параметры строки запроса](error-handling/_static/developer-exception-page-query.png)

Этот запрос не все файлы cookie, но в противном случае они появятся на **файлы cookie** вкладки. Вы увидите заголовки, которые были переданы в последнюю позицию.

![Заголовки](error-handling/_static/developer-exception-page-headers.png)

## <a name="configuring-a-custom-exception-handling-page"></a>Настройка пользовательского исключения, обработка страницы

Рекомендуется настроить страницу обработчика исключений для использования, когда приложение не выполняется `Development` среде.

[!code-csharp[Main](error-handling/sample/Startup.cs?name=snippet_DevExceptionPage&highlight=11)]

В приложении MVC не декорировать явным образом метод действия обработчика ошибок с атрибутами метода HTTP, такие как `HttpGet`. С помощью явного команд может помешать достижение метод некоторых запросов.

```csharp
[Route("/Error")]
public IActionResult Index()
{
    // Handle error here
}
```

## <a name="configuring-status-code-pages"></a>Настройка состояния кодовые страницы

По умолчанию приложение не предоставляет широкие возможности состояние кодовую страницу для коды состояния HTTP, например 500 (Внутренняя ошибка сервера) или 404 (не найдено). Можно настроить `StatusCodePagesMiddleware` , добавив строку в `Configure` метод:

```csharp
app.UseStatusCodePages();
```

По умолчанию это по промежуточного слоя добавляет простой и текстовыми обработчики стандартные коды состояния, такие как 404:

![404 страницы](error-handling/_static/default-404-status-code.png)

По промежуточного слоя поддерживает несколько разных метода расширения. Одна принимает лямбда-выражение, другой принимает строку содержимого, тип и формат.

[!code-csharp[Main](error-handling/sample/Startup.cs?name=snippet_StatusCodePages)]

```csharp
app.UseStatusCodePages("text/plain", "Status code page, status code: {0}");
```

Существуют методы расширения для перенаправления. Один отправляет клиенту код 302 состояния и один возвращается исходный код состояния клиента, а также выполняет действия обработчика для URL-адрес перенаправления.

[!code-csharp[Main](error-handling/sample/Startup.cs?name=snippet_StatusCodePagesWithRedirect)]

```csharp
app.UseStatusCodePagesWithReExecute("/error/{0}");
```

Если вам нужно отключить состояние кодовых страниц для определенных запросов, это можно сделать:

```csharp
var statusCodePagesFeature = context.Features.Get<IStatusCodePagesFeature>();
if (statusCodePagesFeature != null)
{
  statusCodePagesFeature.Enabled = false;
}
```

## <a name="exception-handling-code"></a>Код обработки исключений

Код страницы обработки исключения может вызывать исключения. Чаще всего рекомендуется для производственных страницы ошибок для состоять исключительно статического содержимого.

Кроме того помните, что после отправки заголовков ответа невозможно изменить код состояния ответа, а также любые исключения страницами или обработчиками запускается. Ответ должен быть завершен либо подключение прервано.

## <a name="server-exception-handling"></a>Обработка исключений с сервера

Помимо логики приложения, обрабатывающего [сервера](servers/index.md) размещение приложение выполняет некоторые обработки исключений. Если сервер перехватывает исключение, перед отправкой заголовки, сервер отправляет ответ 500 Внутренняя ошибка сервера без тела. Если сервер перехватывает исключение после отправки заголовков, сервер закрывает соединение. Запросы, не обрабатываются приложением, обрабатываются сервером. Любое исключение, возникающее обрабатывается исключение сервера обработки. Любой настроен настраиваемые страницы ошибок или по промежуточного слоя обработки исключений и фильтры не влияют на это поведение.

## <a name="startup-exception-handling"></a>Обработка исключений при запуске

Уровень размещения может обрабатывать исключения, происходящие во время запуска приложения. Вы можете [настройки узла при возникновении ошибок во время запуска](hosting.md#detailed-errors) с помощью `captureStartupErrors` и `detailedErrors` ключа.

Размещение можно показывать только страницу ошибки для ошибки записанного запуска, если эта ошибка возникает после привязки адреса узла и порта. Если любая привязка какой-либо причине произошел сбой, уровня размещения входит критические исключения, сбои процесса dotnet, и страница ошибки, не отображается.

## <a name="aspnet-mvc-error-handling"></a>Обработка ошибок в ASP.NET MVC

[MVC](../mvc/index.md) приложения имеют некоторые дополнительные параметры для обработки ошибок, такие как Настройка фильтров исключений и проверки модели.

### <a name="exception-filters"></a>Фильтры исключений

Фильтры исключений можно задать глобально или на основе-контроллера или каждого действия в приложении MVC. Эти фильтры обрабатывать любые необработанное исключение, возникающее во время выполнения действия контроллера или другой фильтр и не вызываются в противном случае. Дополнительные сведения о фильтры исключений в [фильтры](../mvc/controllers/filters.md).

>[!TIP]
> Фильтры исключений подходят для перехвата исключений, возникающих в рамках действия MVC, но они не обладает такой гибкостью, как по промежуточного слоя обработки ошибок. Предпочтение по промежуточного слоя в общем случае и использовать фильтры, только когда нужен для обработки ошибок *по-разному* основании действие MVC, которое было выбрано.

### <a name="handling-model-state-errors"></a>Состояние модели обработки ошибок

[Проверка модели](../mvc/models/validation.md) происходит перед каждой вызываемого действия контроллера, и ответственность метода действия для проверки `ModelState.IsValid` и реагировать соответствующим образом.

Некоторые приложения будет реализовывать стандартного соглашения для обработки ошибок проверки модели, в этом случае [фильтра](../mvc/controllers/filters.md) может быть необходимо реализовать такую политику. Следует проверить поведение свои действия с состояниями Недопустимая модель. Дополнительные сведения см. в разделе [тестирование логики контроллера](../mvc/controllers/testing.md).



