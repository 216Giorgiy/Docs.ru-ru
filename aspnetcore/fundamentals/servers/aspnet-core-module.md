---
title: "Модуль ASP.NET Core"
author: tdykstra
description: "Вводные сведения о модуле ASP.NET Core (ANCM), позволяющем веб-серверу Kestrel использовать IIS или IIS Express в качестве обратного прокси-сервера."
manager: wpickett
ms.author: tdykstra
ms.custom: H1Hack27Feb2017
ms.date: 08/03/2017
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: article
uid: fundamentals/servers/aspnet-core-module
ms.openlocfilehash: 4337bc42c5454d6a9634a396d9c89f3518af148b
ms.sourcegitcommit: a510f38930abc84c4b302029d019a34dfe76823b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/30/2018
---
# <a name="introduction-to-aspnet-core-module"></a><span data-ttu-id="d2da6-103">Введение в модуль ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="d2da6-103">Introduction to ASP.NET Core Module</span></span>

<span data-ttu-id="d2da6-104">Авторы: [Том Дикстра](https://github.com/tdykstra) (Tom Dykstra), [Рик Штраль](https://github.com/RickStrahl) (Rick Strahl) и [Крис Росс](https://github.com/Tratcher) (Chris Ross)</span><span class="sxs-lookup"><span data-stu-id="d2da6-104">By [Tom Dykstra](https://github.com/tdykstra), [Rick Strahl](https://github.com/RickStrahl), and [Chris Ross](https://github.com/Tratcher)</span></span> 

<span data-ttu-id="d2da6-105">Модуль Core ASP.NET (ANCM) позволяет запускать приложения ASP.NET Core за службами IIS, используя преимущества обеих технологий — IIS (безопасность, управляемость и многое другое) и [Kestrel](kestrel.md) (высокое быстродействие).</span><span class="sxs-lookup"><span data-stu-id="d2da6-105">ASP.NET Core Module (ANCM) lets you run ASP.NET Core applications behind IIS, using IIS for what it's good at (security, manageability, and lots more) and using [Kestrel](kestrel.md) for what it's good at (being really fast), and getting the benefits from both technologies at once.</span></span> <span data-ttu-id="d2da6-106">**ANCM работает только с Kestrel, он не совместим с WebListener (в ASP.NET Core 1.x) или HTTP.sys (в 2.x).**</span><span class="sxs-lookup"><span data-stu-id="d2da6-106">**ANCM works only with Kestrel; it isn't compatible with WebListener (in ASP.NET Core 1.x) or HTTP.sys (in 2.x).**</span></span> 

<span data-ttu-id="d2da6-107">Поддерживаемые версии Windows:</span><span class="sxs-lookup"><span data-stu-id="d2da6-107">Supported Windows versions:</span></span>

* <span data-ttu-id="d2da6-108">Windows 7 и Windows Server 2008 R2 и более поздних версий</span><span class="sxs-lookup"><span data-stu-id="d2da6-108">Windows 7 and Windows Server 2008 R2 and later</span></span>

<span data-ttu-id="d2da6-109">[Просмотреть или скачать образец кода](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/servers/aspnet-core-module/sample) ([как скачивать](xref:tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="d2da6-109">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/servers/aspnet-core-module/sample) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

## <a name="what-aspnet-core-module-does"></a><span data-ttu-id="d2da6-110">Назначение модуля ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="d2da6-110">What ASP.NET Core Module does</span></span>

<span data-ttu-id="d2da6-111">ANCM — это собственный модуль IIS, который подключается к конвейеру IIS и перенаправляет трафик в серверное приложение ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="d2da6-111">ANCM is a native IIS module that hooks into the IIS pipeline and redirects traffic to the backend ASP.NET Core application.</span></span> <span data-ttu-id="d2da6-112">Большинство других модулей, таких как проверка подлинности Windows, по-прежнему имеют возможность запуска.</span><span class="sxs-lookup"><span data-stu-id="d2da6-112">Most other modules, such as windows authentication, still get a chance to run.</span></span> <span data-ttu-id="d2da6-113">ANCM принимает управление, только если для запроса выбран обработчик, а в файле *web.config* приложения определено сопоставление этого обработчика.</span><span class="sxs-lookup"><span data-stu-id="d2da6-113">ANCM only takes control when a handler is selected for the request, and handler mapping is defined in the application *web.config* file.</span></span>

<span data-ttu-id="d2da6-114">Так как приложения ASP.NET Core выполняются в процессе, отделенном от рабочего процесса IIS, модуль ANCM также осуществляет управление процессами.</span><span class="sxs-lookup"><span data-stu-id="d2da6-114">Because ASP.NET Core applications run in a process separate from the IIS worker process, ANCM also does process management.</span></span> <span data-ttu-id="d2da6-115">ANCM запускает процесс для приложения ASP.NET Core при поступлении первого запроса и перезапускает его при сбое.</span><span class="sxs-lookup"><span data-stu-id="d2da6-115">ANCM starts the process for the ASP.NET Core application when the first request comes in and restarts it when it crashes.</span></span> <span data-ttu-id="d2da6-116">Это, по сути, совпадает с поведением классических приложений ASP.NET, выполняемых внутрипроцессно в IIS и управляемых службой активации Windows (WAS).</span><span class="sxs-lookup"><span data-stu-id="d2da6-116">This is essentially the same behavior as classic ASP.NET applications that run in-process in IIS and are managed by WAS (Windows Activation Service).</span></span>

<span data-ttu-id="d2da6-117">Ниже приведена схема, показывающая связь между IIS, ANCM и приложениями ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="d2da6-117">Here's a diagram that illustrates the relationship between IIS, ANCM, and ASP.NET Core applications.</span></span>

![Модуль ASP.NET Core](aspnet-core-module/_static/ancm.png)

<span data-ttu-id="d2da6-119">Запросы поступают из Интернета и попадают в драйвер режима ядра Http.Sys, который направляет их в IIS по основному порту (80) или SSL-порту (443).</span><span class="sxs-lookup"><span data-stu-id="d2da6-119">Requests come in from the Web and hit the kernel mode Http.Sys driver which routes them into IIS on the primary port (80) or SSL port (443).</span></span> <span data-ttu-id="d2da6-120">ANCM переадресует запросы в приложение ASP.NET Core по настроенному для него HTTP-порту, который отличается от порта 80/443.</span><span class="sxs-lookup"><span data-stu-id="d2da6-120">ANCM forwards the requests to the ASP.NET Core application on the HTTP port configured for the application, which isn't port 80/443.</span></span>

<span data-ttu-id="d2da6-121">Kestrel прослушивает трафик, поступающий из модуля ANCM.</span><span class="sxs-lookup"><span data-stu-id="d2da6-121">Kestrel listens for traffic coming from ANCM.</span></span>  <span data-ttu-id="d2da6-122">ANCM задает порт с помощью переменной среды во время запуска, а метод [UseIISIntegration](#call-useiisintegration) настраивает сервер для прослушивания `http://localhost:{port}`.</span><span class="sxs-lookup"><span data-stu-id="d2da6-122">ANCM specifies the port via environment variable at startup, and the [UseIISIntegration](#call-useiisintegration) method configures the server to listen on `http://localhost:{port}`.</span></span> <span data-ttu-id="d2da6-123">Существуют и дополнительные проверки, позволяющие отклонять запросы, поступающие не из ANCM.</span><span class="sxs-lookup"><span data-stu-id="d2da6-123">There are additional checks to reject requests not from ANCM.</span></span> <span data-ttu-id="d2da6-124">(ANCM не поддерживает переадресацию по HTTPS, поэтому запросы переадресовываются по протоколу HTTP, даже если были получены IIS по протоколу HTTPS.)</span><span class="sxs-lookup"><span data-stu-id="d2da6-124">(ANCM doesn't support HTTPS forwarding, so requests are forwarded over HTTP even if received by IIS over HTTPS.)</span></span>

<span data-ttu-id="d2da6-125">Kestrel принимает запросы от ANCM и помещает их в конвейер ПО промежуточного слоя ASP.NET Core, который затем обрабатывает их и передает в качестве экземпляров `HttpContext` в логику приложения.</span><span class="sxs-lookup"><span data-stu-id="d2da6-125">Kestrel picks up requests from ANCM and pushes them into the ASP.NET Core middleware pipeline, which then handles them and passes them on as `HttpContext` instances to application logic.</span></span> <span data-ttu-id="d2da6-126">После этого отклики приложений передаются обратно в службы IIS, которые отправляют их обратно в HTTP-клиент, инициировавший соответствующие запросы.</span><span class="sxs-lookup"><span data-stu-id="d2da6-126">The application's responses are then passed back to IIS, which pushes them back out to the HTTP client that initiated the requests.</span></span>

<span data-ttu-id="d2da6-127">ANCM выполняет и некоторые другие функции:</span><span class="sxs-lookup"><span data-stu-id="d2da6-127">ANCM has a few other functions as well:</span></span>

* <span data-ttu-id="d2da6-128">задает переменные среды;</span><span class="sxs-lookup"><span data-stu-id="d2da6-128">Sets environment variables.</span></span>
* <span data-ttu-id="d2da6-129">регистрирует в журнале выходные данные `stdout` для хранилища файлов;</span><span class="sxs-lookup"><span data-stu-id="d2da6-129">Logs `stdout` output to file storage.</span></span>
* <span data-ttu-id="d2da6-130">переадресовывает токены проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="d2da6-130">Forwards Windows authentication tokens.</span></span>

## <a name="how-to-use-ancm-in-aspnet-core-apps"></a><span data-ttu-id="d2da6-131">Условия использования ANCM в приложениях ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="d2da6-131">How to use ANCM in ASP.NET Core apps</span></span>

<span data-ttu-id="d2da6-132">Этот раздел содержит обзор настройки сервера IIS и приложения ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="d2da6-132">This section provides an overview of the process for setting up an IIS server and ASP.NET Core application.</span></span> <span data-ttu-id="d2da6-133">Подробные инструкции см. в разделе [Размещение в Windows с помощью IIS](xref:host-and-deploy/iis/index).</span><span class="sxs-lookup"><span data-stu-id="d2da6-133">For detailed instructions, see [Host on Windows with IIS](xref:host-and-deploy/iis/index).</span></span>

### <a name="install-ancm"></a><span data-ttu-id="d2da6-134">Установка ANCM</span><span class="sxs-lookup"><span data-stu-id="d2da6-134">Install ANCM</span></span>


<span data-ttu-id="d2da6-135">Модуль Core ASP.NET нужно установить в службах IIS на серверах, а также в IIS Express на компьютерах разработки.</span><span class="sxs-lookup"><span data-stu-id="d2da6-135">The ASP.NET Core Module has to be installed in IIS on your servers and in IIS Express on your development machines.</span></span> <span data-ttu-id="d2da6-136">Для серверов модуль ANCM включен в [пакет размещения .NET Core для Windows Server](https://aka.ms/dotnetcore-2-windowshosting).</span><span class="sxs-lookup"><span data-stu-id="d2da6-136">For servers, ANCM is included in the [.NET Core Windows Server Hosting bundle](https://aka.ms/dotnetcore-2-windowshosting).</span></span> <span data-ttu-id="d2da6-137">Для компьютеров разработки Visual Studio автоматически устанавливает ANCM в IIS Express и IIS, если они уже установлены на компьютере.</span><span class="sxs-lookup"><span data-stu-id="d2da6-137">For development machines, Visual Studio automatically installs ANCM in IIS Express, and in IIS if it's already installed on the machine.</span></span>

### <a name="install-the-iisintegration-nuget-package"></a><span data-ttu-id="d2da6-138">Установка пакета NuGet IISIntegration</span><span class="sxs-lookup"><span data-stu-id="d2da6-138">Install the IISIntegration NuGet package</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="d2da6-139">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="d2da6-139">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="d2da6-140">Пакет [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/) входит в состав метапакетов ASP.NET Core ([Microsoft.AspNetCore](https://www.nuget.org/packages/Microsoft.AspNetCore/) и [Microsoft.AspNetCore.All](xref:fundamentals/metapackage)).</span><span class="sxs-lookup"><span data-stu-id="d2da6-140">The [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/) package is included in the ASP.NET Core metapackages ([Microsoft.AspNetCore](https://www.nuget.org/packages/Microsoft.AspNetCore/) and [Microsoft.AspNetCore.All](xref:fundamentals/metapackage)).</span></span> <span data-ttu-id="d2da6-141">Если вы не используете один из метапакетов, установите `Microsoft.AspNetCore.Server.IISIntegration` отдельно.</span><span class="sxs-lookup"><span data-stu-id="d2da6-141">If you don't use one of the metapackages, install `Microsoft.AspNetCore.Server.IISIntegration` separately.</span></span> <span data-ttu-id="d2da6-142">`IISIntegration` представляет собой пакет взаимодействия, который считывает переменные среды, транслируемые модулем ANCM, для настройки приложения.</span><span class="sxs-lookup"><span data-stu-id="d2da6-142">The `IISIntegration` package is an interoperability pack that reads environment variables broadcast by ANCM to set up your app.</span></span> <span data-ttu-id="d2da6-143">Переменные среды предоставляют сведения о конфигурации, например прослушиваемый порт.</span><span class="sxs-lookup"><span data-stu-id="d2da6-143">The environment variables provide configuration information, such as the port to listen on.</span></span> 

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="d2da6-144">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="d2da6-144">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="d2da6-145">Установите [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/) в приложении.</span><span class="sxs-lookup"><span data-stu-id="d2da6-145">In your application, install [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/).</span></span> <span data-ttu-id="d2da6-146">`IISIntegration` представляет собой пакет взаимодействия, который считывает переменные среды, транслируемые модулем ANCM, для настройки приложения.</span><span class="sxs-lookup"><span data-stu-id="d2da6-146">The `IISIntegration` package  is an interoperability pack that reads environment variables broadcast by ANCM to set up your app.</span></span> <span data-ttu-id="d2da6-147">Переменные среды предоставляют сведения о конфигурации, например прослушиваемый порт.</span><span class="sxs-lookup"><span data-stu-id="d2da6-147">The environment variables provide configuration information, such as the port to listen on.</span></span> 

---

### <a name="call-useiisintegration"></a><span data-ttu-id="d2da6-148">Вызов UseIISIntegration</span><span class="sxs-lookup"><span data-stu-id="d2da6-148">Call UseIISIntegration</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="d2da6-149">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="d2da6-149">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="d2da6-150">Метод расширения `UseIISIntegration` в [`WebHostBuilder`](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder) вызывается автоматически при выполнении в IIS.</span><span class="sxs-lookup"><span data-stu-id="d2da6-150">The `UseIISIntegration` extension method on [`WebHostBuilder`](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder) is called automatically when you run with IIS.</span></span>

<span data-ttu-id="d2da6-151">Если вы не используете один из метапакетов ASP.NET Core и еще не установили пакет `Microsoft.AspNetCore.Server.IISIntegration`, возникает ошибка времени выполнения.</span><span class="sxs-lookup"><span data-stu-id="d2da6-151">If you aren't using one of the ASP.NET Core metapackages and haven't installed the  `Microsoft.AspNetCore.Server.IISIntegration` package, you get a runtime error.</span></span> <span data-ttu-id="d2da6-152">Если пакет не установлен, при явном вызове `UseIISIntegration` возникает ошибка времени компиляции.</span><span class="sxs-lookup"><span data-stu-id="d2da6-152">If you call `UseIISIntegration` explicitly, you get a compile time error if the package isn't installed.</span></span>

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="d2da6-153">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="d2da6-153">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="d2da6-154">Метод `Main` в приложении вызывает метод расширения `UseIISIntegration` для [`WebHostBuilder`](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder).</span><span class="sxs-lookup"><span data-stu-id="d2da6-154">In your application's `Main` method, call the `UseIISIntegration` extension method on [`WebHostBuilder`](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder).</span></span> 

[!code-csharp[](aspnet-core-module/sample/Program.cs?name=snippet_Main&highlight=12)]

---

<span data-ttu-id="d2da6-155">Метод `UseIISIntegration` ищет переменные среды, задаваемые модулем ANCM, а при их отсутствии не выполняет никакие операции.</span><span class="sxs-lookup"><span data-stu-id="d2da6-155">The `UseIISIntegration` method looks for environment variables that ANCM sets, and it no-ops if they aren't found.</span></span> <span data-ttu-id="d2da6-156">Это поведение упрощает реализацию таких сценариев, как разработка и тестирование в macOS или Linux и развертывание на сервере под управлением IIS.</span><span class="sxs-lookup"><span data-stu-id="d2da6-156">This behavior facilitates scenarios like developing and testing on macOS or Linux and deploying to a server that runs IIS.</span></span> <span data-ttu-id="d2da6-157">Kestrel при запуске в macOS или Linux выступает в качестве веб-сервера. Однако при развертывании приложения в среде IIS оно автоматически использует ANCM и IIS.</span><span class="sxs-lookup"><span data-stu-id="d2da6-157">While running on macOS or Linux, Kestrel acts as the web server; but when the app is deployed to the IIS environment, it automatically uses ANCM and IIS.</span></span>

### <a name="ancm-port-binding-overrides-other-port-bindings"></a><span data-ttu-id="d2da6-158">Привязка порта ANCM переопределяет все другие привязки портов</span><span class="sxs-lookup"><span data-stu-id="d2da6-158">ANCM port binding overrides other port bindings</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="d2da6-159">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="d2da6-159">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="d2da6-160">ANCM создает динамический порт для назначения серверному процессу.</span><span class="sxs-lookup"><span data-stu-id="d2da6-160">ANCM generates a dynamic port to assign to the back-end process.</span></span> <span data-ttu-id="d2da6-161">Метод `UseIISIntegration` принимает этот динамический порт и настраивает Kestrel для прослушивания адресу `http://locahost:{dynamicPort}/`.</span><span class="sxs-lookup"><span data-stu-id="d2da6-161">The `UseIISIntegration` method picks up this dynamic port and configures Kestrel to listen on `http://locahost:{dynamicPort}/`.</span></span> <span data-ttu-id="d2da6-162">Это переопределяет другие конфигурации URL-адресов, такие как вызовы `UseUrls` или [API прослушивания Kestrel](xref:fundamentals/servers/kestrel?tabs=aspnetcore2x#endpoint-configuration).</span><span class="sxs-lookup"><span data-stu-id="d2da6-162">This overrides other URL configurations, such as calls to `UseUrls` or [Kestrel's Listen API](xref:fundamentals/servers/kestrel?tabs=aspnetcore2x#endpoint-configuration).</span></span> <span data-ttu-id="d2da6-163">Таким образом, вам не нужно вызывать `UseUrls` или API `Listen` Kestrel при использовании ANCM.</span><span class="sxs-lookup"><span data-stu-id="d2da6-163">Therefore, you don't need to call `UseUrls` or Kestrel's `Listen` API when you use ANCM.</span></span> <span data-ttu-id="d2da6-164">Если вы вызываете `UseUrls` или `Listen`, Kestrel прослушивает заданный вами порт при запуске приложения без IIS.</span><span class="sxs-lookup"><span data-stu-id="d2da6-164">If you do call `UseUrls` or `Listen`, Kestrel listens on the port you specify when you run the app without IIS.</span></span>

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="d2da6-165">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="d2da6-165">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="d2da6-166">ANCM создает динамический порт для назначения серверному процессу.</span><span class="sxs-lookup"><span data-stu-id="d2da6-166">ANCM generates a dynamic port to assign to the back-end process.</span></span> <span data-ttu-id="d2da6-167">Метод `UseIISIntegration` принимает этот динамический порт и настраивает Kestrel для прослушивания адресу `http://locahost:{dynamicPort}/`.</span><span class="sxs-lookup"><span data-stu-id="d2da6-167">The `UseIISIntegration` method picks up this dynamic port and configures Kestrel to listen on `http://locahost:{dynamicPort}/`.</span></span> <span data-ttu-id="d2da6-168">Это переопределяет другие конфигурации URL-адресов, такие как вызовы `UseUrls`.</span><span class="sxs-lookup"><span data-stu-id="d2da6-168">This overrides other URL configurations, such as calls to `UseUrls`.</span></span> <span data-ttu-id="d2da6-169">Таким образом, вам не нужно вызывать `UseUrls` при использовании ANCM.</span><span class="sxs-lookup"><span data-stu-id="d2da6-169">Therefore, you don't need to call `UseUrls` when you use ANCM.</span></span> <span data-ttu-id="d2da6-170">Если вы вызываете `UseUrls`, Kestrel прослушивает заданный вами порт при запуске приложения без IIS.</span><span class="sxs-lookup"><span data-stu-id="d2da6-170">If you do call `UseUrls`, Kestrel listens on the port you specify when you run the app without IIS.</span></span>

<span data-ttu-id="d2da6-171">Если вы вызываете `UseUrls` в ASP.NET Core 1.0, вызывайте его **до** вызова `UseIISIntegration`, чтобы предотвратить перезапись порта, настроенного модулем ANCM.</span><span class="sxs-lookup"><span data-stu-id="d2da6-171">In ASP.NET Core 1.0, if you call `UseUrls`, call it **before** you call `UseIISIntegration` so that the ANCM-configured port doesn't get overwritten.</span></span> <span data-ttu-id="d2da6-172">В ASP.NET Core 1.1 соблюдать этот порядок вызовов не требуется, так как параметр ANCM переопределяет `UseUrls`.</span><span class="sxs-lookup"><span data-stu-id="d2da6-172">This calling order isn't required in ASP.NET Core 1.1, because the ANCM setting overrides `UseUrls`.</span></span>

---

### <a name="configure-ancm-options-in-webconfig"></a><span data-ttu-id="d2da6-173">Настройка параметров ANCM в файле Web.config</span><span class="sxs-lookup"><span data-stu-id="d2da6-173">Configure ANCM options in Web.config</span></span>

<span data-ttu-id="d2da6-174">Конфигурация для модуля ASP.NET Core хранится в файле *web.config*, расположенном в корневой папке приложения.</span><span class="sxs-lookup"><span data-stu-id="d2da6-174">Configuration for the ASP.NET Core Module is stored in the *web.config* file that's located in the application's root folder.</span></span> <span data-ttu-id="d2da6-175">Параметры в этом файле указывают на команду и аргументы, служащие для запуска приложения ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="d2da6-175">Settings in this file point to the startup command and arguments that start your ASP.NET Core app.</span></span> <span data-ttu-id="d2da6-176">Пример кода *web.config* и сведения о параметрах конфигурации см. в разделе [Справочник по конфигурации модуля ASP.NET Core](xref:host-and-deploy/aspnet-core-module).</span><span class="sxs-lookup"><span data-stu-id="d2da6-176">For sample *web.config* code and guidance on configuration options, see [ASP.NET Core Module Configuration Reference](xref:host-and-deploy/aspnet-core-module).</span></span>

### <a name="run-with-iis-express-in-development"></a><span data-ttu-id="d2da6-177">Выполнение с IIS Express в среде разработки</span><span class="sxs-lookup"><span data-stu-id="d2da6-177">Run with IIS Express in development</span></span>

<span data-ttu-id="d2da6-178">Visual Studio может запустить службы IIS Express с использованием профиля по умолчанию, определенного в шаблонах ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="d2da6-178">IIS Express can be launched by Visual Studio using the default profile defined by the ASP.NET Core templates.</span></span>

## <a name="proxy-configuration-uses-http-protocol-and-a-pairing-token"></a><span data-ttu-id="d2da6-179">Конфигурация прокси-сервера использует протокол HTTP и токен связывания</span><span class="sxs-lookup"><span data-stu-id="d2da6-179">Proxy configuration uses HTTP protocol and a pairing token</span></span>

<span data-ttu-id="d2da6-180">Прокси-сервер, созданный между ANCM и Kestrel, использует протокол HTTP.</span><span class="sxs-lookup"><span data-stu-id="d2da6-180">The proxy created between the ANCM and Kestrel uses the HTTP protocol.</span></span> <span data-ttu-id="d2da6-181">Использование HTTP позволяет оптимизировать производительность, так как трафик между ANCM и Kestrel передается на петлевой адрес в сетевом интерфейсе.</span><span class="sxs-lookup"><span data-stu-id="d2da6-181">Using HTTP is a performance optimization where the traffic between the ANCM and Kestrel takes place on a loopback address off of the network interface.</span></span> <span data-ttu-id="d2da6-182">Отсутствует риск перехвата трафика между ANCM и Kestrel из расположения на сервере.</span><span class="sxs-lookup"><span data-stu-id="d2da6-182">There's no risk of eavesdropping the traffic between the ANCM and Kestrel from a location off of the server.</span></span>

<span data-ttu-id="d2da6-183">Токен связывания гарантирует, что полученные Kestrel запросы были переданы службами IIS, а не из какого-либо другого источника.</span><span class="sxs-lookup"><span data-stu-id="d2da6-183">A pairing token is used to guarantee that the requests received by Kestrel were proxied by IIS and didn't come from some other source.</span></span> <span data-ttu-id="d2da6-184">Этот токен создается и задается модулем ANCM в переменной среды (`ASPNETCORE_TOKEN`).</span><span class="sxs-lookup"><span data-stu-id="d2da6-184">The pairing token is created and set into an environment variable (`ASPNETCORE_TOKEN`) by the ANCM.</span></span> <span data-ttu-id="d2da6-185">Он также задается в заголовке (`MSAspNetCoreToken`) каждого запроса, переданного через прокси-сервер.</span><span class="sxs-lookup"><span data-stu-id="d2da6-185">The pairing token is also set into a header (`MSAspNetCoreToken`) on every proxied request.</span></span> <span data-ttu-id="d2da6-186">ПО промежуточного слоя IIS проверяет каждый получаемый запрос, чтобы убедиться, что заголовок с токеном связывания соответствует значению переменной среды.</span><span class="sxs-lookup"><span data-stu-id="d2da6-186">IIS Middleware checks each request it receives to confirm that the pairing token header value matches the environment variable value.</span></span> <span data-ttu-id="d2da6-187">Если значения токена не совпадают, запрос заносится в журнал и отклоняется.</span><span class="sxs-lookup"><span data-stu-id="d2da6-187">If the token values are mismatched, the request is logged and rejected.</span></span> <span data-ttu-id="d2da6-188">Переменная среды с токеном связывания и трафик между ANCM и Kestrel недоступны из расположения на сервере.</span><span class="sxs-lookup"><span data-stu-id="d2da6-188">The pairing token environment variable and the traffic between the ANCM and Kestrel aren't accessible from a location off of the server.</span></span> <span data-ttu-id="d2da6-189">Не зная значение токена связывания, злоумышленник не может отправлять запросы, обходящие проверку в ПО промежуточного слоя IIS.</span><span class="sxs-lookup"><span data-stu-id="d2da6-189">Without knowing the pairing token value, an attacker can't submit requests that bypass the check in the IIS Middleware.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d2da6-190">Следующие шаги</span><span class="sxs-lookup"><span data-stu-id="d2da6-190">Next steps</span></span>

<span data-ttu-id="d2da6-191">Дополнительные сведения см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="d2da6-191">For more information, see the following resources:</span></span>

* [<span data-ttu-id="d2da6-192">Пример приложения для этой статьи</span><span class="sxs-lookup"><span data-stu-id="d2da6-192">Sample app for this article</span></span>](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/servers/aspnet-core-module/sample)
* [<span data-ttu-id="d2da6-193">Исходный код модуля ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="d2da6-193">ASP.NET Core Module source code</span></span>](https://github.com/aspnet/AspNetCoreModule)
* [<span data-ttu-id="d2da6-194">Справочник по конфигурации модуля ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="d2da6-194">ASP.NET Core Module Configuration Reference</span></span>](xref:host-and-deploy/aspnet-core-module)
* [<span data-ttu-id="d2da6-195">Размещение в Windows с помощью IIS</span><span class="sxs-lookup"><span data-stu-id="d2da6-195">Host on Windows with IIS</span></span>](xref:host-and-deploy/iis/index)
