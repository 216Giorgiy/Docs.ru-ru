---
title: "Модуль ASP.NET Core"
author: tdykstra
description: "Вводит ASP.NET Core модуля (ANCM), модуль, позволяющий использовать в качестве обратного прокси-сервера IIS или IIS Express Kestrel веб-сервере IIS."
keywords: "Модуль Core Express,ASP.NET IIS ASP.NET Core, IIS, UseIISIntegration"
ms.author: tdykstra
manager: wpickett
ms.date: 08/03/2017
ms.topic: article
ms.assetid: 4661af33-34c5-4d71-93a0-8c7632f43580
ms.technology: aspnet
ms.prod: asp.net-core
uid: fundamentals/servers/aspnet-core-module
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 5eef9405c0c3d219755d7cffa5d45c3df45ddb5c
ms.sourcegitcommit: 12e5194936b7e820efc5505a2d5d4f84e88eb5ef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/11/2018
---
# <a name="introduction-to-aspnet-core-module"></a><span data-ttu-id="2c9e5-104">Введение в ASP.NET Core модуля</span><span class="sxs-lookup"><span data-stu-id="2c9e5-104">Introduction to ASP.NET Core Module</span></span>

<span data-ttu-id="2c9e5-105">По [Tom Dykstra](https://github.com/tdykstra), [Рик Штраль](https://github.com/RickStrahl), и [Ross Крис](https://github.com/Tratcher)</span><span class="sxs-lookup"><span data-stu-id="2c9e5-105">By [Tom Dykstra](https://github.com/tdykstra), [Rick Strahl](https://github.com/RickStrahl), and [Chris Ross](https://github.com/Tratcher)</span></span> 

<span data-ttu-id="2c9e5-106">Модуль Core ASP.NET (ANCM) позволяет запускать приложениям за IIS, ASP.NET Core с помощью служб IIS для что такое эффективное (безопасности, управляемости и много больше) и [Kestrel](kestrel.md) для что такое эффективное (быстротой действительно) и получение преимущества обеих технологий за один раз.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-106">ASP.NET Core Module (ANCM) lets you run ASP.NET Core applications behind IIS, using IIS for what it's good at (security, manageability, and lots more) and using [Kestrel](kestrel.md) for what it's good at (being really fast), and getting the benefits from both technologies at once.</span></span> <span data-ttu-id="2c9e5-107">**ANCM работает только с Kestrel; оно не совместимо с WebListener (в ASP.NET Core 1.x) или HTTP.sys (в 2.x).**</span><span class="sxs-lookup"><span data-stu-id="2c9e5-107">**ANCM works only with Kestrel; it isn't compatible with WebListener (in ASP.NET Core 1.x) or HTTP.sys (in 2.x).**</span></span> 

<span data-ttu-id="2c9e5-108">Поддерживаемые версии Windows:</span><span class="sxs-lookup"><span data-stu-id="2c9e5-108">Supported Windows versions:</span></span>

* <span data-ttu-id="2c9e5-109">Windows 7 и Windows Server 2008 R2 и более поздних версий</span><span class="sxs-lookup"><span data-stu-id="2c9e5-109">Windows 7 and Windows Server 2008 R2 and later</span></span>

<span data-ttu-id="2c9e5-110">[Просмотреть или скачать образец кода](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/servers/aspnet-core-module/sample) ([как скачивать](xref:tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="2c9e5-110">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/servers/aspnet-core-module/sample) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

## <a name="what-aspnet-core-module-does"></a><span data-ttu-id="2c9e5-111">Назначение модуля ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="2c9e5-111">What ASP.NET Core Module does</span></span>

<span data-ttu-id="2c9e5-112">ANCM имеет собственный модуль IIS, который подключается к конвейеру IIS и перенаправляет трафик к серверной части приложения ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-112">ANCM is a native IIS module that hooks into the IIS pipeline and redirects traffic to the backend ASP.NET Core application.</span></span> <span data-ttu-id="2c9e5-113">Большинство других модулей, такие как проверка подлинности windows, по-прежнему будет возможность запустить.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-113">Most other modules, such as windows authentication, still get a chance to run.</span></span> <span data-ttu-id="2c9e5-114">ANCM берет управление, только если сопоставления обработчика, определенных в приложении, и обработчик выбран для запроса *web.config* файла.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-114">ANCM only takes control when a handler is selected for the request, and handler mapping is defined in the application *web.config* file.</span></span>

<span data-ttu-id="2c9e5-115">Поскольку приложения ASP.NET Core, выполняемые в процессе разделения из рабочего процесса IIS, ANCM также управление процессами.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-115">Because ASP.NET Core applications run in a process separate from the IIS worker process, ANCM also does process management.</span></span> <span data-ttu-id="2c9e5-116">ANCM запускает процесс для приложения ASP.NET Core, когда первый запрос поступает и перезапускает ее при сбоях.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-116">ANCM starts the process for the ASP.NET Core application when the first request comes in and restarts it when it crashes.</span></span> <span data-ttu-id="2c9e5-117">Это по сути совпадает с поведением классических приложениях ASP.NET, запустите в работе в IIS и управляются с помощью WAS (службы активации Windows).</span><span class="sxs-lookup"><span data-stu-id="2c9e5-117">This is essentially the same behavior as classic ASP.NET applications that run in-process in IIS and are managed by WAS (Windows Activation Service).</span></span>

<span data-ttu-id="2c9e5-118">Вот на диаграмме, которая показана связь между приложениями служб IIS, ANCM и ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-118">Here's a diagram that illustrates the relationship between IIS, ANCM, and ASP.NET Core applications.</span></span>

![Модуль ASP.NET Core](aspnet-core-module/_static/ancm.png)

<span data-ttu-id="2c9e5-120">Запросы поступают из Интернета и попадания драйвер Http.Sys режима ядра, который направляет их в службы IIS на основном порту (80) или SSL-порта (443).</span><span class="sxs-lookup"><span data-stu-id="2c9e5-120">Requests come in from the Web and hit the kernel mode Http.Sys driver which routes them into IIS on the primary port (80) or SSL port (443).</span></span> <span data-ttu-id="2c9e5-121">ANCM направляет запросы к приложению ASP.NET Core на HTTP-порта, настроенного для приложения, который не используется порт 80 или 443.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-121">ANCM forwards the requests to the ASP.NET Core application on the HTTP port configured for the application, which is not port 80/443.</span></span>

<span data-ttu-id="2c9e5-122">Kestrel прослушивает трафик, поступающий из ANCM.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-122">Kestrel listens for traffic coming from ANCM.</span></span>  <span data-ttu-id="2c9e5-123">ANCM указывает порт, через переменную среды во время запуска и [UseIISIntegration](#call-useiisintegration) метод настраивает сервер на прослушивание `http://localhost:{port}`.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-123">ANCM specifies the port via environment variable at startup, and the [UseIISIntegration](#call-useiisintegration) method configures the server to listen on `http://localhost:{port}`.</span></span> <span data-ttu-id="2c9e5-124">Существуют дополнительные проверки, чтобы отклонять запросы не ANCM.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-124">There are additional checks to reject requests not from ANCM.</span></span> <span data-ttu-id="2c9e5-125">(ANCM не поддерживает пересылка HTTPS, поэтому запросы направляются по протоколу HTTP, даже если получен службой IIS, по протоколу HTTPS.)</span><span class="sxs-lookup"><span data-stu-id="2c9e5-125">(ANCM does not support HTTPS forwarding, so requests are forwarded over HTTP even if received by IIS over HTTPS.)</span></span>

<span data-ttu-id="2c9e5-126">Kestrel принимает запросы от ANCM и помещает их в конвейере ASP.NET Core по промежуточного слоя, который их обрабатывает и передает их в качестве `HttpContext` экземпляров для логики приложения.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-126">Kestrel picks up requests from ANCM and pushes them into the ASP.NET Core middleware pipeline, which then handles them and passes them on as `HttpContext` instances to application logic.</span></span> <span data-ttu-id="2c9e5-127">Ответы приложений, затем передаются обратно в IIS, какие отправлений их обратно в HTTP-клиента, который инициировал запросы.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-127">The application's responses are then passed back to IIS, which pushes them back out to the HTTP client that initiated the requests.</span></span>

<span data-ttu-id="2c9e5-128">ANCM имеет несколько других функций.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-128">ANCM has a few other functions as well:</span></span>

* <span data-ttu-id="2c9e5-129">Задает переменные среды.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-129">Sets environment variables.</span></span>
* <span data-ttu-id="2c9e5-130">Журналы `stdout` выходных данных для хранения файлов.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-130">Logs `stdout` output to file storage.</span></span>
* <span data-ttu-id="2c9e5-131">Пересылает токены проверки подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-131">Forwards Windows authentication tokens.</span></span>

## <a name="how-to-use-ancm-in-aspnet-core-apps"></a><span data-ttu-id="2c9e5-132">Как использовать в приложениях ASP.NET Core ANCM</span><span class="sxs-lookup"><span data-stu-id="2c9e5-132">How to use ANCM in ASP.NET Core apps</span></span>

<span data-ttu-id="2c9e5-133">В этом разделе Обзор процесса настройки сервера IIS и ASP.NET Core приложения.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-133">This section provides an overview of the process for setting up an IIS server and ASP.NET Core application.</span></span> <span data-ttu-id="2c9e5-134">Подробные инструкции см. в разделе [узла в Windows с помощью IIS](xref:host-and-deploy/iis/index).</span><span class="sxs-lookup"><span data-stu-id="2c9e5-134">For detailed instructions, see [Host on Windows with IIS](xref:host-and-deploy/iis/index).</span></span>

### <a name="install-ancm"></a><span data-ttu-id="2c9e5-135">Установить ANCM</span><span class="sxs-lookup"><span data-stu-id="2c9e5-135">Install ANCM</span></span>


<span data-ttu-id="2c9e5-136">Модуль Core ASP.NET должно быть установлено в службах IIS на серверах и в IIS Express на компьютерах разработки.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-136">The ASP.NET Core Module has to be installed in IIS on your servers and in IIS Express on your development machines.</span></span> <span data-ttu-id="2c9e5-137">Для серверов, ANCM включается в [пакета .NET Core Windows Server, где размещены](https://aka.ms/dotnetcore-2-windowshosting).</span><span class="sxs-lookup"><span data-stu-id="2c9e5-137">For servers, ANCM is included in the [.NET Core Windows Server Hosting bundle](https://aka.ms/dotnetcore-2-windowshosting).</span></span> <span data-ttu-id="2c9e5-138">Для компьютеров разработчиков Visual Studio автоматически устанавливает ANCM в IIS Express и в службах IIS, если он еще не установлен на компьютере.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-138">For development machines, Visual Studio automatically installs ANCM in IIS Express, and in IIS if it is already installed on the machine.</span></span>

### <a name="install-the-iisintegration-nuget-package"></a><span data-ttu-id="2c9e5-139">Установка пакета IISIntegration NuGet</span><span class="sxs-lookup"><span data-stu-id="2c9e5-139">Install the IISIntegration NuGet package</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="2c9e5-140">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="2c9e5-140">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="2c9e5-141">[Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/) пакет включен в ASP.NET Core metapackages ([Microsoft.AspNetCore](https://www.nuget.org/packages/Microsoft.AspNetCore/) и [Microsoft.AspNetCore.All](xref:fundamentals/metapackage) ).</span><span class="sxs-lookup"><span data-stu-id="2c9e5-141">The [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/) package is included in the ASP.NET Core metapackages ([Microsoft.AspNetCore](https://www.nuget.org/packages/Microsoft.AspNetCore/) and [Microsoft.AspNetCore.All](xref:fundamentals/metapackage)).</span></span> <span data-ttu-id="2c9e5-142">Если вы не используете один из metapackages, установите `Microsoft.AspNetCore.Server.IISIntegration` отдельно.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-142">If you don't use one of the metapackages, install `Microsoft.AspNetCore.Server.IISIntegration` separately.</span></span> <span data-ttu-id="2c9e5-143">`IISIntegration` Пакета — пакет взаимодействие, который считывает переменные среды вещания по ANCM для настройки приложения.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-143">The `IISIntegration` package is an interoperability pack that reads environment variables broadcast by ANCM to set up your app.</span></span> <span data-ttu-id="2c9e5-144">Переменные среды предоставляют сведения о конфигурации, такие как порт для прослушивания.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-144">The environment variables provide configuration information, such as the port to listen on.</span></span> 

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="2c9e5-145">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="2c9e5-145">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="2c9e5-146">В приложении, установите [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/).</span><span class="sxs-lookup"><span data-stu-id="2c9e5-146">In your application, install [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/).</span></span> <span data-ttu-id="2c9e5-147">`IISIntegration` Пакета — пакет взаимодействие, который считывает переменные среды вещания по ANCM для настройки приложения.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-147">The `IISIntegration` package  is an interoperability pack that reads environment variables broadcast by ANCM to set up your app.</span></span> <span data-ttu-id="2c9e5-148">Переменные среды предоставляют сведения о конфигурации, такие как порт для прослушивания.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-148">The environment variables provide configuration information, such as the port to listen on.</span></span> 

---

### <a name="call-useiisintegration"></a><span data-ttu-id="2c9e5-149">Вызов UseIISIntegration</span><span class="sxs-lookup"><span data-stu-id="2c9e5-149">Call UseIISIntegration</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="2c9e5-150">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="2c9e5-150">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="2c9e5-151">`UseIISIntegration` Метод расширения в [ `WebHostBuilder` ](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder) вызывается автоматически при выполнении с IIS.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-151">The `UseIISIntegration` extension method on [`WebHostBuilder`](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder) is called automatically when you run with IIS.</span></span>

<span data-ttu-id="2c9e5-152">Если не используется один из metapackages ASP.NET Core и еще не установили `Microsoft.AspNetCore.Server.IISIntegration` пакета, возникнет ошибка времени выполнения.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-152">If you aren't using one of the ASP.NET Core metapackages and haven't installed the  `Microsoft.AspNetCore.Server.IISIntegration` package, you get a runtime error.</span></span> <span data-ttu-id="2c9e5-153">При вызове метода `UseIISIntegration` явным образом, если пакет не установлен получить ошибку времени компиляции.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-153">If you call `UseIISIntegration` explicitly, you get a compile time error if the package isn't installed.</span></span>

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="2c9e5-154">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="2c9e5-154">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="2c9e5-155">В вашем приложении `Main` метод, вызовите `UseIISIntegration` метод расширения в [ `WebHostBuilder` ](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder).</span><span class="sxs-lookup"><span data-stu-id="2c9e5-155">In your application's `Main` method, call the `UseIISIntegration` extension method on [`WebHostBuilder`](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder).</span></span> 

[!code-csharp[](aspnet-core-module/sample/Program.cs?name=snippet_Main&highlight=12)]

---

<span data-ttu-id="2c9e5-156">`UseIISIntegration` Метод ищет переменные среды, которые задает ANCM и его ops нет, если они не найдены.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-156">The `UseIISIntegration` method looks for environment variables that ANCM sets, and it no-ops if they aren't found.</span></span> <span data-ttu-id="2c9e5-157">Это облегчает сценариев разработки и тестирования на macOS или Linux, и развертывание на сервере под управлением служб IIS.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-157">This behavior facilitates scenarios like developing and testing on macOS or Linux and deploying to a server that runs IIS.</span></span> <span data-ttu-id="2c9e5-158">Во время выполнения с macOS или Linux, Kestrel выступает в качестве веб-сервера. Однако при развертывании приложения в среде IIS, он автоматически использует ANCM и IIS.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-158">While running on macOS or Linux, Kestrel acts as the web server; but when the app is deployed to the IIS environment, it automatically uses ANCM and IIS.</span></span>

### <a name="ancm-port-binding-overrides-other-port-bindings"></a><span data-ttu-id="2c9e5-159">Привязка порта ANCM переопределяет другие привязки портов</span><span class="sxs-lookup"><span data-stu-id="2c9e5-159">ANCM port binding overrides other port bindings</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="2c9e5-160">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="2c9e5-160">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="2c9e5-161">ANCM создает динамический порт для назначения для внутренней обработки.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-161">ANCM generates a dynamic port to assign to the back-end process.</span></span> <span data-ttu-id="2c9e5-162">`UseIISIntegration` Метод принимает этот динамический порт и настраивает Kestrel для прослушивания `http://locahost:{dynamicPort}/`.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-162">The `UseIISIntegration` method picks up this dynamic port and configures Kestrel to listen on `http://locahost:{dynamicPort}/`.</span></span> <span data-ttu-id="2c9e5-163">Это значение переопределяет другие конфигурации URL-адрес, например вызовы `UseUrls` или [API прослушивания по Kestrel](xref:fundamentals/servers/kestrel?tabs=aspnetcore2x#endpoint-configuration).</span><span class="sxs-lookup"><span data-stu-id="2c9e5-163">This overrides other URL configurations, such as calls to `UseUrls` or [Kestrel's Listen API](xref:fundamentals/servers/kestrel?tabs=aspnetcore2x#endpoint-configuration).</span></span> <span data-ttu-id="2c9e5-164">Таким образом, не нужно вызывать `UseUrls` или Kestrel в `Listen` API при использовании ANCM.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-164">Therefore, you don't need to call `UseUrls` or Kestrel's `Listen` API when you use ANCM.</span></span> <span data-ttu-id="2c9e5-165">Если вы вызываете `UseUrls` или `Listen`, Kestrel прослушивает порт, укажите при запуске приложения без IIS.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-165">If you do call `UseUrls` or `Listen`, Kestrel listens on the port you specify when you run the app without IIS.</span></span>

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="2c9e5-166">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="2c9e5-166">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="2c9e5-167">ANCM создает динамический порт для назначения для внутренней обработки.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-167">ANCM generates a dynamic port to assign to the back-end process.</span></span> <span data-ttu-id="2c9e5-168">`UseIISIntegration` Метод принимает этот динамический порт и настраивает Kestrel для прослушивания `http://locahost:{dynamicPort}/`.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-168">The `UseIISIntegration` method picks up this dynamic port and configures Kestrel to listen on `http://locahost:{dynamicPort}/`.</span></span> <span data-ttu-id="2c9e5-169">Это значение переопределяет другие конфигурации URL-адрес, например вызовы `UseUrls`.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-169">This overrides other URL configurations, such as calls to `UseUrls`.</span></span> <span data-ttu-id="2c9e5-170">Таким образом, не нужно вызывать `UseUrls` при использовании ANCM.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-170">Therefore, you don't need to call `UseUrls` when you use ANCM.</span></span> <span data-ttu-id="2c9e5-171">Если вы вызываете `UseUrls`, Kestrel прослушивает порт, укажите при запуске приложения без IIS.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-171">If you do call `UseUrls`, Kestrel listens on the port you specify when you run the app without IIS.</span></span>

<span data-ttu-id="2c9e5-172">В ASP.NET Core 1.0, при вызове метода `UseUrls`, она вызывается **перед** вызове `UseIISIntegration` , чтобы ANCM настроенный порт не перезаписывается.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-172">In ASP.NET Core 1.0, if you call `UseUrls`, call it **before** you call `UseIISIntegration` so that the ANCM-configured port doesn't get overwritten.</span></span> <span data-ttu-id="2c9e5-173">Этот порядок вызова не требуется в ASP.NET Core 1.1, так как параметр ANCM переопределяет `UseUrls`.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-173">This calling order isn't required in ASP.NET Core 1.1, because the ANCM setting overrides `UseUrls`.</span></span>

---

### <a name="configure-ancm-options-in-webconfig"></a><span data-ttu-id="2c9e5-174">Настройка параметров ANCM в файле Web.config</span><span class="sxs-lookup"><span data-stu-id="2c9e5-174">Configure ANCM options in Web.config</span></span>

<span data-ttu-id="2c9e5-175">Конфигурация для модуля ASP.NET Core хранится в *web.config* файл, расположенный в корневой папке приложения.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-175">Configuration for the ASP.NET Core Module is stored in the *web.config* file that is located in the application's root folder.</span></span> <span data-ttu-id="2c9e5-176">Параметры в этом файле точки для запуска команды и аргументы, которые запуска приложения ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-176">Settings in this file point to the startup command and arguments that start your ASP.NET Core app.</span></span> <span data-ttu-id="2c9e5-177">Для образца *web.config* кода, а также соответствующие параметры конфигурации в разделе [модуля конфигурации ASP.NET Core Reference](xref:host-and-deploy/aspnet-core-module).</span><span class="sxs-lookup"><span data-stu-id="2c9e5-177">For sample *web.config* code and guidance on configuration options, see [ASP.NET Core Module Configuration Reference](xref:host-and-deploy/aspnet-core-module).</span></span>

### <a name="run-with-iis-express-in-development"></a><span data-ttu-id="2c9e5-178">Запустите сервер IIS Express в разработке</span><span class="sxs-lookup"><span data-stu-id="2c9e5-178">Run with IIS Express in development</span></span>

<span data-ttu-id="2c9e5-179">IIS Express можно запускать Visual Studio с использованием профиля по умолчанию, определенным в шаблонах ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-179">IIS Express can be launched by Visual Studio using the default profile defined by the ASP.NET Core templates.</span></span>

## <a name="proxy-configuration-uses-http-protocol-and-a-pairing-token"></a><span data-ttu-id="2c9e5-180">Конфигурация прокси-сервера используется протокол HTTP и токен связывания</span><span class="sxs-lookup"><span data-stu-id="2c9e5-180">Proxy configuration uses HTTP protocol and a pairing token</span></span>

<span data-ttu-id="2c9e5-181">Между ANCM и Kestrel прокси-сервер использует протокол HTTP.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-181">The proxy created between the ANCM and Kestrel uses the HTTP protocol.</span></span> <span data-ttu-id="2c9e5-182">С помощью HTTP — оптимизации производительности, где трафик между ANCM и Kestrel производится на адрес замыкания на себя из сетевого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-182">Using HTTP is a performance optimization where the traffic between the ANCM and Kestrel takes place on a loopback address off of the network interface.</span></span> <span data-ttu-id="2c9e5-183">Нет риска перехвата трафика между ANCM и Kestrel из расположения, из сервера.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-183">There's no risk of eavesdropping the traffic between the ANCM and Kestrel from a location off of the server.</span></span>

<span data-ttu-id="2c9e5-184">Токен связывания позволяет гарантировать, что запросы, полученные Kestrel были прокси в службах IIS и не поступают из другого источника.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-184">A pairing token is used to guarantee that the requests received by Kestrel were proxied by IIS and didn't come from some other source.</span></span> <span data-ttu-id="2c9e5-185">Токен связывания создается, доступный в переменной среды (`ASPNETCORE_TOKEN`), ANCM.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-185">The pairing token is created and set into an environment variable (`ASPNETCORE_TOKEN`) by the ANCM.</span></span> <span data-ttu-id="2c9e5-186">Токен связывания также задается в заголовке (`MSAspNetCoreToken`) при каждом запросе прокси.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-186">The pairing token is also set into a header (`MSAspNetCoreToken`) on every proxied request.</span></span> <span data-ttu-id="2c9e5-187">По промежуточного слоя IIS проверяет запрос, чтобы убедиться, что значение связывания заголовок токена соответствует значение переменной среды.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-187">IIS Middleware checks each request it receives to confirm that the pairing token header value matches the environment variable value.</span></span> <span data-ttu-id="2c9e5-188">Если обнаружено несоответствие значения маркера, записываются в журнал и отклонил запрос.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-188">If the token values are mismatched, the request is logged and rejected.</span></span> <span data-ttu-id="2c9e5-189">Попарное переменной маркера среды и трафик между ANCM и Kestrel, недоступны в расположение за пределами сервера.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-189">The pairing token environment variable and the traffic between the ANCM and Kestrel aren't accessible from a location off of the server.</span></span> <span data-ttu-id="2c9e5-190">Не зная связывания значение токена, злоумышленник не могут отправлять запросы, пропустить проверку в IIS по промежуточного слоя.</span><span class="sxs-lookup"><span data-stu-id="2c9e5-190">Without knowing the pairing token value, an attacker can't submit requests that bypass the check in the IIS Middleware.</span></span>

## <a name="next-steps"></a><span data-ttu-id="2c9e5-191">Следующие шаги</span><span class="sxs-lookup"><span data-stu-id="2c9e5-191">Next steps</span></span>

<span data-ttu-id="2c9e5-192">Дополнительные сведения см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="2c9e5-192">For more information, see the following resources:</span></span>

* [<span data-ttu-id="2c9e5-193">Образец приложения для этой статьи</span><span class="sxs-lookup"><span data-stu-id="2c9e5-193">Sample app for this article</span></span>](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/servers/aspnet-core-module/sample)
* [<span data-ttu-id="2c9e5-194">Исходный код ASP.NET модуль Core</span><span class="sxs-lookup"><span data-stu-id="2c9e5-194">ASP.NET Core Module source code</span></span>](https://github.com/aspnet/AspNetCoreModule)
* [<span data-ttu-id="2c9e5-195">Справочник по конфигурации модуля ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="2c9e5-195">ASP.NET Core Module Configuration Reference</span></span>](xref:host-and-deploy/aspnet-core-module)
* [<span data-ttu-id="2c9e5-196">Размещение в Windows с помощью IIS</span><span class="sxs-lookup"><span data-stu-id="2c9e5-196">Host on Windows with IIS</span></span>](xref:host-and-deploy/iis/index)
