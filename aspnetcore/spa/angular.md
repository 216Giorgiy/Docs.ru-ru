---
title: Использование шаблона проекта Angular с ASP.NET Core
author: SteveSandersonMS
description: Сведения о начале работы с использованием шаблона одностраничного приложения ASP.NET Core (SPA) с использованием Angular и Angular CLI.
manager: wpickett
ms.author: scaddie
ms.custom: mvc
ms.date: 02/21/2018
ms.devlang: csharp
ms.prod: aspnet-core
ms.technology: aspnet
ms.topic: article
uid: spa/angular
ms.openlocfilehash: b4e48f40c3d4e3167e7fdb3534d2c33b3544592c
ms.sourcegitcommit: 9bc34b8269d2a150b844c3b8646dcb30278a95ea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/12/2018
---
# <a name="use-the-angular-project-template-with-aspnet-core"></a>Использование шаблона проекта Angular с ASP.NET Core

> [!NOTE]
> Эта документация не относится к шаблону проекта Angular, включенному в ASP.NET Core 2.0. Она предназначена для нового шаблона, который вы можете установить вручную. Этот шаблон по умолчанию включен в ASP.NET Core 2.1.

Обновленный шаблон проекта Angular представляет собой удобную отправную точку для создания приложений ASP.NET Core с использованием Angular и Angular CLI и позволяет создать полнофункциональный клиентский пользовательский интерфейс (UI).

Шаблон эквивалентен созданию проекта ASP.NET Core для серверного API и проекта Angular CLI для пользовательского интерфейса. Он также позволяет размещать оба типа проектов в проекте одного приложения, что позволяет выполнять сборку и публикацию проекта как единого целого.

## <a name="create-a-new-app"></a>Создание нового приложения

При использовании ASP.NET Core 2.0 обязательно [установите обновленный шаблон проекта Angular](xref:spa/index#installation). Если вы используете ASP.NET Core 2.1, устанавливать его не требуется.

Создайте из командной строки новый проект в пустом каталоге с помощью команды `dotnet new angular`. Например, следующие команды создают приложение в каталоге *my-new-app* и переходят к этому каталогу:

```console
dotnet new angular -o my-new-app
cd my-new-app
```

Запустите приложение из Visual Studio или .NET Core CLI:

# <a name="visual-studiotabvisual-studio"></a>[Visual Studio](#tab/visual-studio/)

Откройте созданный файл проекта *.csproj* и запустите в нем приложение в обычном режиме.

Процесс сборки восстанавливает зависимости npm при первом запуске и может выполняться несколько минут. Последующие сборки выполняются гораздо быстрее.

# <a name="net-core-clitabnetcore-cli"></a>[Интерфейс командной строки .NET Core](#tab/netcore-cli/)

Убедитесь в наличии переменной среды `ASPNETCORE_Environment` со значением `Development`. В Windows (в запросах не PowerShell) запускаются `SET ASPNETCORE_Environment=Development`. В Linux или macOS, запустите `export ASPNETCORE_Environment=Development`.

Запустите [dotnet build](/dotnet/core/tools/dotnet-build), чтобы проверить правильность сборки приложения. При первом запуске процесс сборки восстанавливает зависимости npm, что может занять несколько минут. Последующие сборки выполняется гораздо быстрее.

Запустите [dotnet run](/dotnet/core/tools/dotnet-run) для запуска приложения. Появится сообщение, аналогичное следующему:

```console
Now listening on: http://localhost:<port>
```

Перейдите по этому URL-адресу в браузере.

Приложение запускает экземпляр сервера Angular CLI в фоновом режиме. Записывается сообщение следующего вида: <em>NG Live Development Server is listening on localhost:&lt;otherport&gt;, open your browser on http://localhost:&lt; otherport&gt; /</em> (NG Live Development Server ожидает передачи данных на localhost:<другой_порт>, откройте в браузере адрес http://localhost:<другой_порт>). Игнорируйте это сообщение — этот URL-адрес <strong>не соответствует</strong> объединенному приложению ASP.NET Core и Angular CLI.
---

Шаблон проекта создает приложение ASP.NET Core и приложение Angular. Приложение ASP.NET Core предназначено для доступа к данным, авторизации и других задач на стороне сервера. Приложение Angular, размещенное в подкаталоге *ClientApp*, предназначено для всех задач, связанных с пользовательским интерфейсом.

## <a name="add-pages-images-styles-modules-etc"></a>Добавление страниц, изображений, стилей, модулей и т. д.

Каталог *ClientApp* содержит стандартное приложение Angular CLI. См. дополнительные сведения в [официальной документации Angular](https://github.com/angular/angular-cli/wiki).

Существуют небольшие различия между приложениями Angular, создаваемыми этим шаблоном и создаваемыми непосредственно Angular CLI (командой `ng new`), однако возможности приложений одинаковые. Приложение, созданное с помощью шаблона, содержит основанный на [Bootstrap](https://getbootstrap.com/) макет и простой пример маршрутизации.

## <a name="run-ng-commands"></a>Выполнение команд ng

В командной строке перейдите в подкаталог *ClientApp*:

```console
cd ClientApp
```

Если средство `ng` установлено глобально, вы можете запустить любую из его команд. Например, можно запустить `ng lint`, `ng test` или любую другую [команду Angular CLI](https://github.com/angular/angular-cli/wiki#additional-commands). Выполнять `ng serve` не требуется, так как приложения ASP.NET Core обслуживают как серверную, так и клиентскую части приложения. На внутреннем уровне они используют `ng serve` в процессе разработки.

Если у вас не установлено средство `ng`, запустите вместо него `npm run ng`. Например, можно запустить `npm run ng lint` или `npm run ng test`.

## <a name="install-npm-packages"></a>Установка пакетов npm

Для установки npm-пакетов сторонних разработчиков используйте в командной строке подкаталог *ClientApp*. Пример:

```console
cd ClientApp
npm install --save <package_name>
```

## <a name="publish-and-deploy"></a>Публикация и развертывание

В процессе разработки приложение запускается в режиме, оптимизированном для удобства разработчиков. Например, пакеты JavaScript включают сопоставления с исходным кодом (благодаря чему при отладке вы сможете видеть исходный код TypeScript). Приложение следит за изменениями файлов TypeScript, HTML и CSS на диске и при обнаружении изменений автоматически производит перекомпиляцию и перезагрузку страницы.

На рабочем этапе используйте версию приложения, оптимизированную для производительности. На нее уже настроено автоматическое переключение. При публикации конфигурация сборки выдает уменьшенные, предварительно скомпилированные (AoT) сборки клиентского кода. В отличие от сборки в режиме разработки, установка на сервере Node.js не требуется (если только не используется [предварительная отрисовка на стороне сервера](#server-side-rendering)).

Можно использовать стандартные [методы размещения и развертывания ASP.NET Core](xref:host-and-deploy/index).

## <a name="run-ng-serve-independently"></a>Запуск "ng serve" отдельно

Проект настроен запускать свой собственный экземпляр сервера Angular CLI в фоновом режиме, когда приложение ASP.NET Core запускается в режиме разработки. Это удобно, так как нет необходимости вручную запускать отдельный сервер.

У этой настройки по умолчанию есть недостатки. Каждый раз при изменении кода на C# и необходимости перезапустить приложение ASP.NET Core также перезагружается и сервер Angular CLI. Перезапуск может занять около 10 секунд. Если вы часто вносите изменения в код C# и не хотите ждать перезапуска сервера Angular CLI, запустите сервер Angular CLI отдельно, независимо от процесса ASP.NET Core. Для этого сделайте следующее:

1. В командной строке перейдите в подкаталог *ClientApp* и запустите сервер разработки Angular CLI следующей командой:

    ```console
    cd ClientApp
    npm start
    ```

    > [!IMPORTANT]
    > Используйте `npm start`, а не `ng serve` для запуска сервера разработки Angular CLI, в результате чего будет учитываться конфигурация в файле *package.json*. Чтобы передать серверу Angular CLI дополнительные параметры, добавьте их в *package.json* в нужную строку `scripts`.

2. Измените свои приложения ASP.NET Core так, чтобы они использовали внешний экземпляр сервера Angular CLI, а не запускали собственный. В вашем классе *Startup* замените вызов `spa.UseAngularCliServer` на следующий:

    ```csharp
    spa.UseProxyToSpaDevelopmentServer("http://localhost:4200");
    ```

При запуске приложения ASP.NET Core экземпляр сервера Angular CLI запускаться не будет. Вместо него будет использоваться экземпляр, запускаемый вручную. Это ускорит запуск и перезагрузку. Теперь не придется каждый раз дожидаться повторной сборки клиентского приложения в Angular CLI.

## <a name="server-side-rendering"></a>Отрисовка на стороне сервера

Как средство производительности можно предварительно отрисовки углового приложения на сервере, а также ее запуска на клиенте. Это означает, что браузеры получать HTML-разметка, представляющая начального пользовательского интерфейса приложения, чтобы они отображали даже перед загрузкой и выполнение пакетов на JavaScript. Большая часть реализации этого поступают из углового называемую [углового универсальных](https://universal.angular.io/).

> [!TIP]
> Включение отрисовки на стороне сервера (SSR) появился ряд дополнительных сложностей как во время разработки и развертывания. Чтение [недостатка SSR](#drawbacks-of-ssr) для определения SSR хорошо подходит для конкретной ситуации.

Чтобы включить SSR, необходимо сделать число дополнения к проекту.

В *запуска* класса *после* строку, которая настраивает `spa.Options.SourcePath`, и *перед* вызов `UseAngularCliServer` или `UseProxyToSpaDevelopmentServer`, добавьте следующий код:

[!code-csharp[](sample/AngularServerSideRendering/Startup.cs?name=snippet_Call_UseSpa&highlight=5-12)]

В режиме разработки, этот код пытается построить SSR пакета, запустив сценарий `build:ssr`, которая определена в *ClientApp\package.json*. После этого будет построено углового приложения с именем `ssr`, которая еще не определена. 

В конце `apps` массива в *ClientApp/.angular-cli.json*, определение дополнительных приложения с именем `ssr`. Используйте следующие параметры:

[!code-json[](sample/AngularServerSideRendering/ClientApp/.angular-cli.json?range=24-41)]

Новые настройки приложения с поддержкой SSR требует двух дополнительных файлов: *tsconfig.server.json* и *main.server.ts*. *Tsconfig.server.json* файл задает параметры компиляции TypeScript. *Main.server.ts* файла служит точка входа в коде во время обработки SSR.

Добавьте новый файл с именем *tsconfig.server.json* внутри *ClientApp/src* (наряду с существующие *tsconfig.app.json*), содержащий следующие:

[!code-json[](sample/AngularServerSideRendering/ClientApp/src/tsconfig.server.json)]

Этот файл настраивает в угловой AoT компилятору поиск модуль с именем `app.server.module`. Добавить, путем создания файла в *ClientApp/src/app/app.server.module.ts* (наряду с существующие *app.module.ts*) содержащий следующее: 

[!code-typescript[](sample/AngularServerSideRendering/ClientApp/src/app/app.server.module.ts)]

Этот модуль наследует стороне клиента `app.module` и определяет, какие дополнительные угловых модулей доступны во время обработки SSR.

Помните, что новый `ssr` входа в *.angular cli.json* ссылка на файл точки входа с именем *main.server.ts*. Вы еще не был добавлен этот файл и пришло время сделать это. Создать новый файл в *ClientApp/src/main.server.ts* (наряду с существующие *main.ts*), содержащий следующие:

[!code-typescript[](sample/AngularServerSideRendering/ClientApp/src/main.server.ts)]

Этот файл код выполняется ASP.NET Core для каждого запроса при запуске `UseSpaPrerendering` по промежуточного слоя, добавленную в *запуска* класса. Он имеет дело с получения `params` из кода .NET (например, URL-адрес запрашиваемого), а также вызовы API-интерфейсам углового SSR получить результирующий HTML. 

Строго говоря, это достаточно, чтобы SSR в режиме разработки. Очень важно сделать один окончательного изменения, чтобы приложение работает правильно при публикации. В основном приложения *.csproj* файле `BuildServerSideRenderer` значение свойства `true`:

[!code-xml[](sample/AngularServerSideRendering/AngularServerSideRendering.csproj?name=snippet_EnableBuildServerSideRenderer)]

Это настраивает процесса построения для запуска `build:ssr` во время публикации и развертывания SSR файлов на сервере. Если это не включен, SSR завершается ошибкой в рабочей среде.

При запуске приложения в режиме разработки или производства углового кода предварительно подготавливает к просмотру как HTML на сервере. Код на стороне клиента выполняется в обычном режиме.

### <a name="pass-data-from-net-code-into-typescript-code"></a>Передать данные из кода .NET в код TypeScript

Во время обработки SSR может потребоваться для передачи данных для каждого запроса из приложения ASP.NET Core в угловой приложения. Например можно передать сведения о файле cookie или что-то чтения из базы данных. Чтобы сделать это, измените вашей *запуска* класса. В обратный вызов для `UseSpaPrerendering`, задайте значение для `options.SupplyData` примерно следующего вида:

```csharp
options.SupplyData = (context, data) =>
{
    // Creates a new value called isHttpsRequest that's passed to TypeScript code
    data["isHttpsRequest"] = context.Request.IsHttps;
};
```

`SupplyData` Обратный вызов позволяет передать произвольное, для каждого запроса, JSON-сериализируемыми данных (например строки, логические значения или числа). Ваш *main.server.ts* код получает его в виде `params.data`. Например, в предыдущем примере кода передается значение типа boolean, как `params.data.isHttpsRequest` в `createServerRenderer` обратного вызова. Это можно передать в другие части приложения каким-либо образом, поддерживаемых угловой. Например, в разделе как *main.server.ts* передает `BASE_URL` значение для любого компонента, конструктор которого объявлен для его получения.

### <a name="drawbacks-of-ssr"></a>Недостатки SSR

Не все приложения используют преимущество SSR. Основное преимущество воспринимается производительности. Посетители достижение приложения через медленное сетевое подключение или на мобильных устройствах с медленным. в разделе начального пользовательского интерфейса быстро, даже если это занимает немного времени выборки или проанализировать пакеты JavaScript. Тем не менее многие SPAs основном используются сетях быстрый, внутренняя компании на быстрых компьютерах практически мгновенно расположения приложения.

В то же время существуют существенные недостатки включения SSR. Он добавляет сложность процесса разработки. Код должен выполняться в двух разных средах: клиентские и серверные (в среде Node.js, вызываемые из ASP.NET Core). Ниже приведены некоторые аспекты, которые необходимо учитывать.

* SSR требует установки Node.js на производственных серверах. Это происходит автоматически в некоторых сценариях, таких как службы приложения Azure, но не для других пользователей, таких как Azure Service Fabric.
* Включение `BuildServerSideRenderer` построения причины флаг вашей *node_modules* каталога для публикации. Эта папка содержит 20 000 + файлов, что увеличивает время развертывания.
* Для запуска кода в Node.js среде, нельзя полагаться на существование API-интерфейсов JavaScript обозревателем например `window` или `localStorage`. Если ваш код (или некоторые библиотеки сторонних разработчиков, ссылки на которые) пытается использовать эти API-интерфейсы, приведет к ошибке во время обработки SSR. Например не используйте jQuery, так как оно ссылается на API-интерфейсы обозревателем во многих местах. Чтобы избежать ошибок, необходимо избегать SSR или избежать обозревателем API-интерфейсы или библиотеки. Все вызовы таких API можно заключить в проверок, чтобы убедиться, что они не вызывается в процессе обработки SSR. Например можно используйте проверку примерно следующего вида в коде JavaScript или TypeScript:

    ```javascript
    if (typeof window !== 'undefined') {
        // Call browser-specific APIs here
    }
    ```
