---
title: "Используйте шаблон проекта углового"
author: SteveSandersonMS
description: "Сведения о начале работы с использованием шаблона проекта ASP.NET Core одностраничного приложения (SPA) версии кандидата для угловой и углового CLI."
manager: wpickett
ms.author: scaddie
ms.custom: mvc
ms.date: 12/06/2017
ms.devlang: csharp
ms.prod: aspnet-core
ms.technology: aspnet
ms.topic: article
uid: spa/angular
ms.openlocfilehash: b54798a43f6a448c2e2aad0613ee60805a61f303
ms.sourcegitcommit: 12e5194936b7e820efc5505a2d5d4f84e88eb5ef
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/11/2018
---
# <a name="use-the-angular-project-template-release-candidate"></a>Используйте шаблон проекта углового (версия-кандидат)

> [!NOTE]
> В этой документации не о шаблоне выпущено углового проекта. **Данная документация является о версии-кандидате углового шаблона.** Мы надеемся, что для отправки в начале 2018 выпущенной версии.

Обновленный проект углового шаблон предоставляет удобную начальную точку для ASP.NET Core приложений с помощью угловых 5 и углового CLI для реализации полнофункционального клиентского пользовательского интерфейса (UI).

Шаблон эквивалентно созданию проекта служб ASP.NET Core в качестве внутренних API и углового CLI проекта в качестве пользовательского интерфейса. Шаблон также размещение обоих типов проектов в проект одного приложения. Следовательно в проект приложения можно выполнять построение и публикуются как единое целое.

## <a name="create-a-new-app"></a>Создание нового приложения

Чтобы начать, убедитесь, вы уже [установленного шаблона обновленный проект углового](xref:spa/index#installation). Эти инструкции не относятся к предыдущей шаблон углового проекта, включенные в .NET Core 2.0.x SDK.

Создание нового проекта из командной строки с помощью команды `dotnet new angular` в пустой каталог. Например, следующие команды создают приложения в *Мои новое приложение* каталога и перейти к этому каталогу:

```console
dotnet new angular -o my-new-app
cd my-new-app
```

Запустите приложение из Visual Studio или .NET Core CLI:

# <a name="visual-studiotabvisual-studio"></a>[Visual Studio](#tab/visual-studio)

Откройте созданный *.csproj* файл и запустить приложение в обычном режиме оттуда.

Процесс построения восстанавливает npm зависимостей при первом выполнении может занять несколько минут. Последующие сборки выполняется гораздо быстрее.

# <a name="net-core-clitabnetcore-cli"></a>[Интерфейс командной строки .NET Core](#tab/netcore-cli)

Убедитесь в наличии переменной среды `ASPNETCORE_Environment` со значением `Development`. В Windows (в запросах не PowerShell) запускаются `SET ASPNETCORE_Environment=Development`. В Linux или macOS, запустите `export ASPNETCORE_Environment=Development`.

Запустите `dotnet build` для проверки приложения правильно ли выполняется сборка. Во время первого выполнения процесса построения восстанавливает npm зависимости, что может занять несколько минут. Последующие сборки выполняется гораздо быстрее.

Запустите `dotnet run` для запуска приложения. Регистрируется сообщение, аналогичное следующему:

```console
Now listening on: http://localhost:<port>
```

Перейдите в этот URL-адрес в браузере.

Приложение запускается экземпляр сервера углового CLI в фоновом режиме. Записывается сообщение следующего вида: *NG Live Development Server прослушивает localhost:&lt;otherport&gt;, откройте в браузере на http://localhost:&lt;otherport&gt; /* . Игнорировать это сообщение&mdash;имеет **не** URL-адрес для объединенных приложения ASP.NET Core и углового CLI.

---

Шаблон проекта создает приложение ASP.NET Core и углового приложения. Приложения ASP.NET Core предназначен для использования для доступа к данным, авторизации и других проблем на стороне сервера. Угловое приложения, размещенные в *ClientApp* подкаталог, предназначен для использования все проблемы пользовательского интерфейса.

## <a name="add-pages-images-styles-modules-etc"></a>Добавление страниц, изображений, стили, модули, и т. д.

*ClientApp* каталог содержит стандартные приложения углового CLI. В разделе официальные [углового документации](https://github.com/angular/angular-cli/wiki) для получения дополнительной информации.

Существуют небольшие различия между углового приложении, созданном с помощью этого шаблона и созданные углового CLI сам (через `ng new`), однако в приложении возможности остаются без изменений. Приложение, созданное с помощью шаблона содержит [начальной загрузки](https://getbootstrap.com/)-макета и простой пример маршрутизации на основе.

## <a name="run-ng-commands"></a>Выполните команды ng

В командной строке перейдите в *ClientApp* подкаталог:

```console
cd ClientApp
```

Если у вас есть `ng` средство установлен глобально, можно запустить любую из команд. Например, можно запустить `ng lint`, `ng test`, или любой другой [команды углового CLI](https://github.com/angular/angular-cli/wiki#additional-commands). Нет необходимости выполнять `ng serve` , так как приложения ASP.NET Core посвящена обслуживающий частей серверные и клиентские приложения. На внутреннем уровне он использует `ng serve` в разработке.

Если у вас нет `ng` средство установлена, запустите `npm run ng` вместо. Например, можно запустить `npm run ng lint` или `npm run ng test`.

## <a name="install-npm-packages"></a>Установка пакета npm

Для установки пакета npm сторонних разработчиков, используйте в командной *ClientApp* подкаталог. Пример:

```console
cd ClientApp
npm install --save <package_name>
```

## <a name="publish-and-deploy"></a>Публикация и развертывание

В разработке приложение запускается в режиме, оптимизированный для удобства разработчиков. Примеры JavaScript пакеты: исходное сопоставление (благодаря чему при отладке, можно увидеть исходный код TypeScript). Приложение следит за TypeScript, HTML и CSS изменения файлов на диске и автоматически перекомпилирует и перезагружает, когда она видит эти файлы изменения.

В рабочей среде обслуживать версии приложения, оптимизированный для производительности. Это настраивается происходит автоматически. При публикации, выдает уменьшенный конфигурации построения, вперед времени (AoT) скомпилированные сборки клиентского кода. В отличие от сборки разработки рабочей сборки не требует Node.js установлен на сервере (если не включен [предварительной визуализации серверные](#server-side-rendering)).

Можно использовать стандартный [методы размещения и развертывания ASP.NET Core](xref:host-and-deploy/index).

## <a name="run-ng-serve-independently"></a>Запустите «ng serve» независимо друг от друга

Проект настроен для запуска свой собственный экземпляр сервера углового CLI в фоновом режиме, когда приложение ASP.NET Core запускается в режиме разработки. Это удобно, так как нет необходимости вручную выполнять отдельный сервер.

Недостаток этой настройки по умолчанию не существует. Каждый раз при изменении кода на C# и ASP.NET основные приложения необходима перезагрузка, угловое CLI сервер перезагрузится. Чтобы запустить резервное копирование требуется около 10 секунд. Если вы вносите частые изменения кода C# и не хотите ждать углового CLI перезагрузить компьютер, запустите сервера углового CLI извне, независимо от процесса ASP.NET Core. Для этого:

1. В командной строке перейдите в *ClientApp* подкаталог и запустить на сервере разработки углового CLI:

    ```console
    cd ClientApp
    npm start
    ```

    > [!IMPORTANT]
    > Используйте `npm start` для запуска на сервере разработки углового CLI, не `ng serve`, после чего конфигурации в *package.json* учитывается. Чтобы задать дополнительные параметры серверу углового CLI, добавьте их в соответствующий `scripts` строку в вашей *package.json* файла.

2. Измените приложения ASP.NET Core для использования внешнего экземпляра углового CLI вместо запуска одного свои собственные. В вашей *запуска* класса, замените `spa.UseAngularCliServer` вызова со следующими:

    ```csharp
    spa.UseProxyToSpaDevelopmentServer("http://localhost:4200");
    ```

При запуске приложения ASP.NET Core, этого не будет запущен сервер углового CLI. Вместо него используется экземпляр, который можно запустить вручную. Это позволяет запустить и перезапустить быстрее. Угловое CLI для перестроения клиентского приложения при каждом больше не ожидает.

## <a name="server-side-rendering"></a>Отрисовка на стороне сервера

Как средство производительности можно предварительно отрисовки углового приложения на сервере, а также ее запуска на клиенте. Это означает, что браузеры получать HTML-разметка, представляющая начального пользовательского интерфейса приложения, чтобы они отображали даже перед загрузкой и выполнение пакетов на JavaScript. Большая часть реализации этого поступают из углового называемую [углового универсальных](https://universal.angular.io/).

> [!TIP]
> Включение отрисовки на стороне сервера (SSR) появился ряд дополнительных сложностей как во время разработки и развертывания. Чтение [недостатка SSR](#drawbacks-of-ssr) для определения SSR хорошо подходит для конкретной ситуации.

Чтобы включить SSR, необходимо сделать число дополнения к проекту.

В *запуска* класса *после* строку, которая настраивает `spa.Options.SourcePath`, и *перед* вызов `UseAngularCliServer` или `UseProxyToSpaDevelopmentServer`, добавьте следующий код:

[!code-csharp[](sample/AngularServerSideRendering/Startup.cs?name=snippet_Call_UseSpa&highlight=5-12)]

В режиме разработки, этот код пытается построить SSR пакета, запустив сценарий `build:ssr`, которая определена в *ClientApp\package.json*. После этого будет построено углового приложения с именем `ssr`, который еще не определен. 

В конце `apps` массива в *ClientApp/.angular-cli.json*, определение дополнительных приложения с именем `ssr`. Используйте следующие параметры:

[!code-json[](sample/AngularServerSideRendering/ClientApp/.angular-cli.json?range=24-41)]

Новые настройки приложения с поддержкой SSR требует двух дополнительных файлов: *tsconfig.server.json* и *main.server.ts*. *Tsconfig.server.json* файл задает параметры компиляции TypeScript. *Main.server.ts* файла служит точка входа в коде во время обработки SSR.

Добавьте новый файл с именем *tsconfig.server.json* внутри *ClientApp/src* (наряду с существующие *tsconfig.app.json*), содержащий следующие:

[!code-json[](sample/AngularServerSideRendering/ClientApp/src/tsconfig.server.json)]

Этот файл настраивает в угловой AoT компилятору поиск модуль с именем `app.server.module`. Добавить, путем создания файла в *ClientApp/src/app/app.server.module.ts* (наряду с существующие *app.module.ts*) содержащий следующее: 

[!code-typescript[](sample/AngularServerSideRendering/ClientApp/src/app/app.server.module.ts)]

Этот модуль наследует стороне клиента `app.module` и определяет, какие дополнительные угловых модулей доступны во время обработки SSR.

Помните, что новый `ssr` входа в *.angular cli.json* ссылка на файл точки входа с именем *main.server.ts*. Вы еще не был добавлен этот файл и пришло время сделать это. Создать новый файл в *ClientApp/src/main.server.ts* (наряду с существующие *main.ts*), содержащий следующие:

[!code-typescript[](sample/AngularServerSideRendering/ClientApp/src/main.server.ts)]

Этот файл код выполняется ASP.NET Core для каждого запроса при запуске `UseSpaPrerendering` по промежуточного слоя, добавленную в *запуска* класса. Он имеет дело с получения `params` из кода .NET (например, URL-адрес запрашиваемого), а также вызовы API-интерфейсам углового SSR получить результирующий HTML. 

Строго говоря, это достаточно, чтобы SSR в режиме разработки. Очень важно сделать один окончательного изменения, чтобы приложение работает правильно при публикации. В основном приложения *.csproj* файле `BuildServerSideRenderer` значение свойства `true`:

[!code-xml[](sample/AngularServerSideRendering/AngularServerSideRendering.csproj?name=snippet_EnableBuildServerSideRenderer)]

Это настраивает процесса построения для запуска `build:ssr` во время публикации и развертывания SSR файлов на сервере. Если это не включен, SSR завершается ошибкой в рабочей среде.

При запуске приложения в режиме разработки или производства углового кода предварительно подготавливает к просмотру как HTML на сервере. Код на стороне клиента выполняется в обычном режиме.

### <a name="pass-data-from-net-code-into-typescript-code"></a>Передать данные из кода .NET в код TypeScript

Во время обработки SSR может потребоваться для передачи данных для каждого запроса из приложения ASP.NET Core в угловой приложения. Например можно передать сведения о файле cookie или что-то чтения из базы данных. Чтобы сделать это, измените вашей *запуска* класса. В обратный вызов для `UseSpaPrerendering`, задайте значение для `options.SupplyData` примерно следующего вида:

```csharp
options.SupplyData = (context, data) =>
{
    // Creates a new value called isHttpsRequest that is passed to TypeScript code
    data["isHttpsRequest"] = context.Request.IsHttps;
};
```

`SupplyData` Обратный вызов позволяет передать произвольное, для каждого запроса, JSON-сериализируемыми данных (например строки, логические значения или числа). Ваш *main.server.ts* код получает его в виде `params.data`. Например, в предыдущем примере кода передается значение типа boolean, как `params.data.isHttpsRequest` в `createServerRenderer` обратного вызова. Это можно передать в другие части приложения каким-либо образом, поддерживаемых угловой. Например, в разделе как *main.server.ts* передает `BASE_URL` значение для любого компонента, конструктор которого объявлен для его получения.

### <a name="drawbacks-of-ssr"></a>Недостатки SSR

Не все приложения используют преимущество SSR. Основное преимущество воспринимается производительности. Посетители достижение приложения через медленное сетевое подключение или на мобильных устройствах с медленным. в разделе начального пользовательского интерфейса быстро, даже если это занимает немного времени выборки или проанализировать пакеты JavaScript. Тем не менее многие SPAs основном используются сетях быстрый, внутренняя компании на быстрых компьютерах практически мгновенно расположения приложения.

В то же время существуют существенные недостатки включения SSR. Он добавляет сложность процесса разработки. Код должен выполняться в двух разных средах: клиентские и серверные (в среде Node.js, вызываемые из ASP.NET Core). Ниже приведены некоторые аспекты, которые необходимо учитывать.

* SSR требует установки Node.js на производственных серверах. Это происходит автоматически в некоторых сценариях, таких как службы приложения Azure, но не для других пользователей, таких как Azure Service Fabric.
* Включение `BuildServerSideRenderer` построения причины флаг вашей *node_modules* каталога для публикации. Эта папка содержит 20 000 + файлов, что увеличивает время развертывания.
* Для запуска кода в Node.js среде, нельзя полагаться на существование API-интерфейсов JavaScript обозревателем например `window` или `localStorage`. Если ваш код (или некоторые библиотеки сторонних разработчиков, ссылки на которые) пытается использовать эти API-интерфейсы, приведет к ошибке во время обработки SSR. Например не используйте jQuery, так как оно ссылается на API-интерфейсы обозревателем во многих местах. Чтобы избежать ошибок, необходимо избегать SSR или избежать обозревателем API-интерфейсы или библиотеки. Все вызовы таких API можно заключить в проверок, чтобы убедиться, что они не вызывается в процессе обработки SSR. Например можно используйте проверку примерно следующего вида в коде JavaScript или TypeScript:

    ```javascript
    if (typeof window !== 'undefined') {
        // Call browser-specific APIs here
    }
    ```
