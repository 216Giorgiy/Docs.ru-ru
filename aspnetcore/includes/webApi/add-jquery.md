## <a name="call-the-web-api-with-jquery"></a><span data-ttu-id="30f78-101">Вызов веб-API с помощью jQuery</span><span class="sxs-lookup"><span data-stu-id="30f78-101">Call the Web API with jQuery</span></span>

<span data-ttu-id="30f78-102">В этом разделе добавляется HTML-страница, которая использует jQuery для вызова веб-API.</span><span class="sxs-lookup"><span data-stu-id="30f78-102">In this section, an HTML page is added that uses jQuery to call the Web API.</span></span> <span data-ttu-id="30f78-103">jQuery запускает запрос и вносит на страницу подробные сведения из ответа API.</span><span class="sxs-lookup"><span data-stu-id="30f78-103">jQuery initiates the request and updates the page with the details from the API's response.</span></span>

<span data-ttu-id="30f78-104">Настройте в проекте обслуживание статических файлов и включение сопоставления файлов по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="30f78-104">Configure the project to serve static files and to enable default file mapping.</span></span> <span data-ttu-id="30f78-105">Для этого необходимо вызвать методы расширения [UseStaticFiles](/dotnet/api/microsoft.aspnetcore.builder.staticfileextensions.usestaticfiles#Microsoft_AspNetCore_Builder_StaticFileExtensions_UseStaticFiles_Microsoft_AspNetCore_Builder_IApplicationBuilder_) и [UseDefaultFiles](/dotnet/api/microsoft.aspnetcore.builder.defaultfilesextensions.usedefaultfiles#Microsoft_AspNetCore_Builder_DefaultFilesExtensions_UseDefaultFiles_Microsoft_AspNetCore_Builder_IApplicationBuilder_) в *Startup.Configure*.</span><span class="sxs-lookup"><span data-stu-id="30f78-105">This is accomplished by invoking the [UseStaticFiles](/dotnet/api/microsoft.aspnetcore.builder.staticfileextensions.usestaticfiles#Microsoft_AspNetCore_Builder_StaticFileExtensions_UseStaticFiles_Microsoft_AspNetCore_Builder_IApplicationBuilder_) and [UseDefaultFiles](/dotnet/api/microsoft.aspnetcore.builder.defaultfilesextensions.usedefaultfiles#Microsoft_AspNetCore_Builder_DefaultFilesExtensions_UseDefaultFiles_Microsoft_AspNetCore_Builder_IApplicationBuilder_) extension methods in *Startup.Configure*.</span></span> <span data-ttu-id="30f78-106">Дополнительные сведения см. в разделе [Статические файлы](xref:fundamentals/static-files).</span><span class="sxs-lookup"><span data-stu-id="30f78-106">For more information, see [Static files](xref:fundamentals/static-files).</span></span>

[!code-csharp[](../../tutorials/first-web-api/samples/2.0/TodoApi/Startup2.cs?name=snippet_Configure&highlight=3-4)]

<span data-ttu-id="30f78-107">Добавьте HTML-файл с именем *index.html* в каталог *wwwroot* проекта.</span><span class="sxs-lookup"><span data-stu-id="30f78-107">Add an HTML file, named *index.html*, to the project's *wwwroot* directory.</span></span> <span data-ttu-id="30f78-108">Замените его содержимое следующей разметкой:</span><span class="sxs-lookup"><span data-stu-id="30f78-108">Replace its contents with the following markup:</span></span>

[!code-html[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/index.html)]

<span data-ttu-id="30f78-109">Добавьте файл JavaScript с именем *site.js* в каталог *wwwroot* проекта.</span><span class="sxs-lookup"><span data-stu-id="30f78-109">Add a JavaScript file, named *site.js*, to the project's *wwwroot* directory.</span></span> <span data-ttu-id="30f78-110">Замените его содержимое следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="30f78-110">Replace its contents with the following code:</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_SiteJs)]

<span data-ttu-id="30f78-111">Может потребоваться изменение параметров запуска проекта ASP.NET Core для локального тестирования HTML-страницы.</span><span class="sxs-lookup"><span data-stu-id="30f78-111">A change to the ASP.NET Core project's launch settings may be required to test the HTML page locally.</span></span> <span data-ttu-id="30f78-112">Откройте *launchSettings.json* в каталоге *Свойства* в проекте.</span><span class="sxs-lookup"><span data-stu-id="30f78-112">Open *launchSettings.json* in the *Properties* directory of the project.</span></span> <span data-ttu-id="30f78-113">Удалите свойство `launchUrl`, чтобы приложение открылось через *index.html* &mdash; файл проекта по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="30f78-113">Remove the `launchUrl` property to force the app to open at *index.html*&mdash;the project's default file.</span></span>

<span data-ttu-id="30f78-114">Для получения jQuery можно использовать следующие способы.</span><span class="sxs-lookup"><span data-stu-id="30f78-114">There are several ways to get jQuery.</span></span> <span data-ttu-id="30f78-115">В предыдущем фрагменте кода библиотека загружается из CDN.</span><span class="sxs-lookup"><span data-stu-id="30f78-115">In the preceding snippet, the library is loaded from a CDN.</span></span> <span data-ttu-id="30f78-116">В этом примере приводится полный набор функций CRUD для вызова API с помощью jQuery.</span><span class="sxs-lookup"><span data-stu-id="30f78-116">This sample is a complete CRUD example of calling the API with jQuery.</span></span> <span data-ttu-id="30f78-117">В этом примере используются дополнительные компоненты, расширяющие возможности разработчика.</span><span class="sxs-lookup"><span data-stu-id="30f78-117">There are additional features in this sample to make the experience richer.</span></span> <span data-ttu-id="30f78-118">Ниже приводятся объяснения о вызовах API.</span><span class="sxs-lookup"><span data-stu-id="30f78-118">Below are explanations around the calls to the API.</span></span>

### <a name="get-a-list-of-to-do-items"></a><span data-ttu-id="30f78-119">Получение списка элементов задач</span><span class="sxs-lookup"><span data-stu-id="30f78-119">Get a list of to-do items</span></span>

<span data-ttu-id="30f78-120">Чтобы получить список элементов задач, отправьте HTTP-запрос GET к */api/todo*.</span><span class="sxs-lookup"><span data-stu-id="30f78-120">To get a list of to-do items, send an HTTP GET request to */api/todo*.</span></span>

<span data-ttu-id="30f78-121">Функция JQuery [ajax](https://api.jquery.com/jquery.ajax/) отправляет запрос AJAX к API, который возвращает JSON, представляющий объект или массив.</span><span class="sxs-lookup"><span data-stu-id="30f78-121">The jQuery [ajax](https://api.jquery.com/jquery.ajax/) function sends an AJAX request to the API, which returns JSON representing an object or array.</span></span> <span data-ttu-id="30f78-122">Эта функция может обрабатывать все виды взаимодействия с HTTP, отправляя HTTP-запросы в указанный `url`.</span><span class="sxs-lookup"><span data-stu-id="30f78-122">This function can handle all forms of HTTP interaction, sending an HTTP request to the specified `url`.</span></span> <span data-ttu-id="30f78-123">`GET` используется в качестве `type`.</span><span class="sxs-lookup"><span data-stu-id="30f78-123">`GET` is used as the `type`.</span></span> <span data-ttu-id="30f78-124">В случае успешного запроса используется функция обратного вызова `success`.</span><span class="sxs-lookup"><span data-stu-id="30f78-124">The `success` callback function is invoked if the request succeeds.</span></span> <span data-ttu-id="30f78-125">При обратном вызове в модель DOM вносятся данные о задачах.</span><span class="sxs-lookup"><span data-stu-id="30f78-125">In the callback, the DOM is updated with the to-do information.</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_GetData)]

### <a name="add-a-to-do-item"></a><span data-ttu-id="30f78-126">Добавление элемента задачи</span><span class="sxs-lookup"><span data-stu-id="30f78-126">Add a to-do item</span></span>

<span data-ttu-id="30f78-127">Чтобы добавить элемент задачи, отправьте HTTP-запрос POST к */api/todo/*.</span><span class="sxs-lookup"><span data-stu-id="30f78-127">To add a to-do item, send an HTTP POST request to */api/todo/*.</span></span> <span data-ttu-id="30f78-128">Текст запроса должен содержать объект задачи.</span><span class="sxs-lookup"><span data-stu-id="30f78-128">The request body should contain a to-do object.</span></span> <span data-ttu-id="30f78-129">Функция [ajax](https://api.jquery.com/jquery.ajax/) использует `POST` для вызова API.</span><span class="sxs-lookup"><span data-stu-id="30f78-129">The [ajax](https://api.jquery.com/jquery.ajax/) function is using `POST` to call the API.</span></span> <span data-ttu-id="30f78-130">В тексте запросов `POST` и `PUT` содержатся данные, отправляемые в API.</span><span class="sxs-lookup"><span data-stu-id="30f78-130">For `POST` and `PUT` requests, the request body represents the data sent to the API.</span></span> <span data-ttu-id="30f78-131">API ожидает текста запроса JSON.</span><span class="sxs-lookup"><span data-stu-id="30f78-131">The API is expecting a JSON request body.</span></span> <span data-ttu-id="30f78-132">Для параметров `accepts` и `contentType` указывается `application/json`, чтобы классифицировать тип носителя при получении и отправке соответственно.</span><span class="sxs-lookup"><span data-stu-id="30f78-132">The `accepts` and `contentType` options are set to `application/json` to classify the media type being received and sent, respectively.</span></span> <span data-ttu-id="30f78-133">Данные преобразуются в объект JSON с помощью [`JSON.stringify`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify).</span><span class="sxs-lookup"><span data-stu-id="30f78-133">The data is converted to a JSON object using [`JSON.stringify`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify).</span></span> <span data-ttu-id="30f78-134">Если интерфейс API возвращает код состояния успешного выполнения, вызывается функция `getData` для обновления HTML-таблицы.</span><span class="sxs-lookup"><span data-stu-id="30f78-134">When the API returns a successful status code, the `getData` function is invoked to update the HTML table.</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_AddItem)]

### <a name="update-a-to-do-item"></a><span data-ttu-id="30f78-135">Обновление элемента задачи</span><span class="sxs-lookup"><span data-stu-id="30f78-135">Update a to-do item</span></span>

<span data-ttu-id="30f78-136">Обновление элемента задачи похоже на добавление, поскольку в обеих операциях используется текст запроса.</span><span class="sxs-lookup"><span data-stu-id="30f78-136">Updating a to-do item is very similar to adding one, since both rely on a request body.</span></span> <span data-ttu-id="30f78-137">Единственная разница между ними заключается в изменении `url` для добавления уникального идентификатора элемента, а `type` — `PUT`.</span><span class="sxs-lookup"><span data-stu-id="30f78-137">The only real difference between the two in this case is that the `url` changes to add the unique identifier of the item, and the `type` is `PUT`.</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_AjaxPut)]

### <a name="delete-a-to-do-item"></a><span data-ttu-id="30f78-138">Удаление элемента задачи</span><span class="sxs-lookup"><span data-stu-id="30f78-138">Delete a to-do item</span></span>

<span data-ttu-id="30f78-139">Чтобы удалить элемент задачи, установите для `type` в вызове AJAX значение `DELETE` и укажите уникальный идентификатор элемента в URL-адресе.</span><span class="sxs-lookup"><span data-stu-id="30f78-139">Deleting a to-do item is accomplished by setting the `type` on the AJAX call to `DELETE` and specifing the item's unique identifier in the URL.</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_AjaxDelete)]
