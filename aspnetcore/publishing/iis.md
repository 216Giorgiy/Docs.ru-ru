---
title: "Размещение ASP.NET Core в Windows со службами IIS"
author: guardrex
description: "Настройка служб IIS в Windows Server и развертывание приложений ASP.NET Core."
keywords: "ASP.NET Core, службы iis, iis, windows server, пакет размещения, модуль asp.net core, веб-развертывание"
ms.author: riande
manager: wpickett
ms.date: 03/13/2017
ms.topic: article
ms.assetid: a4449ad3-5bad-410c-afa7-dc32d832b552
ms.technology: aspnet
ms.prod: asp.net-core
uid: publishing/iis
ms.openlocfilehash: e9e9019d5b879498e8800bb579c177dd3ad64061
ms.sourcegitcommit: 96af03c9f44f7c206e68ae3ef8596068e6b4e5fd
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/15/2017
---
# <a name="host-aspnet-core-on-windows-with-iis"></a><span data-ttu-id="2688e-104">Размещение ASP.NET Core в Windows со службами IIS</span><span class="sxs-lookup"><span data-stu-id="2688e-104">Host ASP.NET Core on Windows with IIS</span></span>

<span data-ttu-id="2688e-105">Авторы: [Люк Лэтэм](https://github.com/guardrex) (Luke Latham) и [Рик Андерсон](https://twitter.com/RickAndMSFT) (Rick Anderson)</span><span class="sxs-lookup"><span data-stu-id="2688e-105">By [Luke Latham](https://github.com/guardrex) and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

## <a name="supported-operating-systems"></a><span data-ttu-id="2688e-106">Поддерживаемые операционные системы</span><span class="sxs-lookup"><span data-stu-id="2688e-106">Supported operating systems</span></span>

<span data-ttu-id="2688e-107">Поддерживаются следующие операционные системы:</span><span class="sxs-lookup"><span data-stu-id="2688e-107">The following operating systems are supported:</span></span>

* <span data-ttu-id="2688e-108">Windows 7 и более поздних версий;</span><span class="sxs-lookup"><span data-stu-id="2688e-108">Windows 7 and newer</span></span>
* <span data-ttu-id="2688e-109">Windows Server 2008 R2 и более поздних версий.</span><span class="sxs-lookup"><span data-stu-id="2688e-109">Windows Server 2008 R2 and newer&#8224;</span></span>

<span data-ttu-id="2688e-110">&#8224;В принципе, конфигурация IIS, описываемая в этом документе, также применима при размещении приложений ASP.NET Core в службах IIS Nano Server, однако более точные инструкции см. в статье [ASP.NET Core со службами IIS в Nano Server](xref:tutorials/nano-server).</span><span class="sxs-lookup"><span data-stu-id="2688e-110">&#8224;Conceptually, the IIS configuration described in this document also applies to hosting ASP.NET Core applications on Nano Server IIS, but refer to [ASP.NET Core with IIS on Nano Server](xref:tutorials/nano-server) for specific instructions.</span></span>

<span data-ttu-id="2688e-111">[Сервер HTTP.sys](xref:fundamentals/servers/httpsys) (который ранее назывался [WebListener](xref:fundamentals/servers/weblistener)) не будет работать в конфигурации обратного прокси-сервера со службами IIS.</span><span class="sxs-lookup"><span data-stu-id="2688e-111">[HTTP.sys server](xref:fundamentals/servers/httpsys) (formerly called [WebListener](xref:fundamentals/servers/weblistener)) won't work in a reverse-proxy configuration with IIS.</span></span> <span data-ttu-id="2688e-112">Необходимо использовать [сервер Kestrel](xref:fundamentals/servers/kestrel).</span><span class="sxs-lookup"><span data-stu-id="2688e-112">You must use the [Kestrel server](xref:fundamentals/servers/kestrel).</span></span>

## <a name="iis-configuration"></a><span data-ttu-id="2688e-113">Конфигурация IIS</span><span class="sxs-lookup"><span data-stu-id="2688e-113">IIS configuration</span></span>

<span data-ttu-id="2688e-114">Включите роль **Веб-сервер (IIS)** и создайте службы роли.</span><span class="sxs-lookup"><span data-stu-id="2688e-114">Enable the **Web Server (IIS)** role and establish role services.</span></span>

### <a name="windows-desktop-operating-systems"></a><span data-ttu-id="2688e-115">Операционные системы Windows для настольных компьютеров</span><span class="sxs-lookup"><span data-stu-id="2688e-115">Windows desktop operating systems</span></span>

<span data-ttu-id="2688e-116">Последовательно выберите **Панель управления** > **Программы** > **Программы и компоненты** > **Включение или отключение компонентов Windows** (в левой части экрана).</span><span class="sxs-lookup"><span data-stu-id="2688e-116">Navigate to **Control Panel** > **Programs** > **Programs and Features** > **Turn Windows features on or off** (left side of the screen).</span></span> <span data-ttu-id="2688e-117">Откройте группу **Службы IIS**, а затем — **Средства управления веб-сайтом**.</span><span class="sxs-lookup"><span data-stu-id="2688e-117">Open the group for **Internet Information Services** and **Web Management Tools**.</span></span> <span data-ttu-id="2688e-118">Установите флажок **Консоль управления IIS**.</span><span class="sxs-lookup"><span data-stu-id="2688e-118">Check the box for **IIS Management Console**.</span></span> <span data-ttu-id="2688e-119">Установите флажок **Службы Интернета**.</span><span class="sxs-lookup"><span data-stu-id="2688e-119">Check the box for **World Wide Web Services**.</span></span> <span data-ttu-id="2688e-120">В группе **Службы Интернета** оставьте компоненты по умолчанию или настройте компоненты IIS согласно потребностям.</span><span class="sxs-lookup"><span data-stu-id="2688e-120">Accept the default features for **World Wide Web Services** or customize the IIS features to suit your needs.</span></span>

![Группы "Консоль управления IIS" и "Службы Интернета" выбраны в окне "Компоненты Windows".](iis/_static/windows-features-win10.png)

### <a name="windows-server-operating-systems"></a><span data-ttu-id="2688e-122">Операционные системы семейства Windows Server</span><span class="sxs-lookup"><span data-stu-id="2688e-122">Windows Server operating systems</span></span>

<span data-ttu-id="2688e-123">В серверной операционной системе используйте мастер **добавления ролей и компонентов**, который можно вызвать в меню **Управление** или по ссылке в **диспетчере сервера**.</span><span class="sxs-lookup"><span data-stu-id="2688e-123">For server operating systems, use the **Add Roles and Features** wizard via the **Manage** menu or the link in **Server Manager**.</span></span> <span data-ttu-id="2688e-124">На этапе **Роли сервера** установите флажок **Веб-сервер (IIS)**.</span><span class="sxs-lookup"><span data-stu-id="2688e-124">On the **Server Roles** step, check the box for **Web Server (IIS)**.</span></span>

![Роль "Веб-сервер (IIS)" выбрана на странице "Выбор ролей сервера".](iis/_static/server-roles-ws2016.png)

<span data-ttu-id="2688e-126">На этапе **Службы роли** выберите нужные службы роли IIS или оставьте службы по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="2688e-126">On the **Role services** step, select the IIS role services you desire or accept the default role services provided.</span></span>

![Службы роли по умолчанию, выбранные на странице "Выбор служб ролей".](iis/_static/role-services-ws2016.png)

<span data-ttu-id="2688e-128">Пройдите этап **Подтверждение**, чтобы установить роль и службы веб-сервера.</span><span class="sxs-lookup"><span data-stu-id="2688e-128">Proceed through the **Confirmation** step to install the web server role and services.</span></span> <span data-ttu-id="2688e-129">После установки роли "Веб-сервер (IIS)" перезагружать сервер или службы IIS не требуется.</span><span class="sxs-lookup"><span data-stu-id="2688e-129">A server/IIS restart isn't required after installing the Web Server (IIS) role.</span></span>

## <a name="install-the-net-core-windows-server-hosting-bundle"></a><span data-ttu-id="2688e-130">Установка пакета размещения .NET Core для Windows Server</span><span class="sxs-lookup"><span data-stu-id="2688e-130">Install the .NET Core Windows Server Hosting bundle</span></span>

1. <span data-ttu-id="2688e-131">Установите [пакет размещения .NET Core для Windows Server](https://download.microsoft.com/download/5/C/1/5C190037-632B-443D-842D-39085F02E1E8/DotNetCore.2.0.3-WindowsHosting.exe) в размещающей системе.</span><span class="sxs-lookup"><span data-stu-id="2688e-131">Install the [.NET Core Windows Server Hosting bundle](https://download.microsoft.com/download/5/C/1/5C190037-632B-443D-842D-39085F02E1E8/DotNetCore.2.0.3-WindowsHosting.exe) on the hosting system.</span></span> <span data-ttu-id="2688e-132">В составе пакета устанавливаются среда выполнения .NET Core, библиотека .NET Core и [модуль ASP.NET Core](xref:fundamentals/servers/aspnet-core-module).</span><span class="sxs-lookup"><span data-stu-id="2688e-132">The bundle installs the .NET Core Runtime, .NET Core Library, and the [ASP.NET Core Module](xref:fundamentals/servers/aspnet-core-module).</span></span> <span data-ttu-id="2688e-133">Модуль создает обратный прокси-сервер между службами IIS и сервером Kestrel.</span><span class="sxs-lookup"><span data-stu-id="2688e-133">The module creates the reverse-proxy between IIS and the Kestrel server.</span></span> <span data-ttu-id="2688e-134">Если система не подключена к Интернету, перед установкой пакета размещения .NET Core для Windows Server получите и установите [Распространяемый компонент Microsoft Visual C++ 2015](https://www.microsoft.com/download/details.aspx?id=53840).</span><span class="sxs-lookup"><span data-stu-id="2688e-134">If the system doesn't have an Internet connection, obtain and install the [Microsoft Visual C++ 2015 Redistributable](https://www.microsoft.com/download/details.aspx?id=53840) before installing the .NET Core Windows Server Hosting bundle.</span></span>

2. <span data-ttu-id="2688e-135">Перезапустите систему или выполните в командной строке команду **net stop was /y**, а затем команду **net start w3svc**, чтобы изменение системной переменной PATH вступило в силу.</span><span class="sxs-lookup"><span data-stu-id="2688e-135">Restart the system or execute **net stop was /y** followed by **net start w3svc** from a command prompt to pick up a change to the system PATH.</span></span>

> [!NOTE]
> <span data-ttu-id="2688e-136">Если вы используете общую конфигурацию IIS, см. раздел [Модуль ASP.NET Core с общей конфигурацией IIS](xref:hosting/aspnet-core-module#aspnet-core-module-with-an-iis-shared-configuration).</span><span class="sxs-lookup"><span data-stu-id="2688e-136">If you use an IIS Shared Configuration, see [ASP.NET Core Module with IIS Shared Configuration](xref:hosting/aspnet-core-module#aspnet-core-module-with-an-iis-shared-configuration).</span></span>

## <a name="install-web-deploy-when-publishing-with-visual-studio"></a><span data-ttu-id="2688e-137">Установка веб-развертывания при публикации с помощью Visual Studio</span><span class="sxs-lookup"><span data-stu-id="2688e-137">Install Web Deploy when publishing with Visual Studio</span></span>

<span data-ttu-id="2688e-138">Если вы планируете развертывать приложения с помощью [веб-развертывания](/iis/publish/using-web-deploy/introduction-to-web-deploy) в [Visual Studio](https://www.visualstudio.com/vs/), установите последнюю версию веб-развертывания в размещающей системе.</span><span class="sxs-lookup"><span data-stu-id="2688e-138">If you intend to deploy your applications with [Web Deploy](/iis/publish/using-web-deploy/introduction-to-web-deploy) in [Visual Studio](https://www.visualstudio.com/vs/), install the latest version of Web Deploy on the hosting system.</span></span> <span data-ttu-id="2688e-139">Чтобы установить веб-развертывание, можно использовать [установщик веб-платформы (WebPI)](https://www.microsoft.com/web/downloads/platform.aspx) или получить установщик непосредственно в [Центре загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=43717).</span><span class="sxs-lookup"><span data-stu-id="2688e-139">To install Web Deploy, you can use the [Web Platform Installer (WebPI)](https://www.microsoft.com/web/downloads/platform.aspx) or obtain an installer directly from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=43717).</span></span> <span data-ttu-id="2688e-140">Предпочтительный метод — использовать WebPI.</span><span class="sxs-lookup"><span data-stu-id="2688e-140">The preferred method is to use WebPI.</span></span> <span data-ttu-id="2688e-141">WebPI обеспечивает автономную установку и настройку поставщиков размещения.</span><span class="sxs-lookup"><span data-stu-id="2688e-141">WebPI offers a standalone setup and a configuration for hosting providers.</span></span>

## <a name="application-configuration"></a><span data-ttu-id="2688e-142">Настройка приложения</span><span class="sxs-lookup"><span data-stu-id="2688e-142">Application configuration</span></span>

### <a name="enabling-the-iisintegration-components"></a><span data-ttu-id="2688e-143">Включение компонентов IISIntegration</span><span class="sxs-lookup"><span data-stu-id="2688e-143">Enabling the IISIntegration components</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="2688e-144">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="2688e-144">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="2688e-145">Обычно *Program.cs* вызывает [CreateDefaultBuilder](/dotnet/api/microsoft.aspnetcore.webhost.createdefaultbuilder), чтобы начать настройку узла.</span><span class="sxs-lookup"><span data-stu-id="2688e-145">A typical *Program.cs* calls [CreateDefaultBuilder](/dotnet/api/microsoft.aspnetcore.webhost.createdefaultbuilder) to begin setting up a host.</span></span> <span data-ttu-id="2688e-146">`CreateDefaultBuilder` настраивает [Kestrel](xref:fundamentals/servers/kestrel) в качестве веб-сервера и активирует интеграцию IIS, задавая базовый путь и порт для [модуля ASP.NET Core](xref:fundamentals/servers/aspnet-core-module):</span><span class="sxs-lookup"><span data-stu-id="2688e-146">`CreateDefaultBuilder` configures [Kestrel](xref:fundamentals/servers/kestrel) as the web server and enables IIS integration by configuring the base path and port for the [ASP.NET Core Module](xref:fundamentals/servers/aspnet-core-module):</span></span>

```csharp
public static IWebHost BuildWebHost(string[] args) =>
    WebHost.CreateDefaultBuilder(args)
        ...
```

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="2688e-147">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="2688e-147">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="2688e-148">Включите в зависимости приложения зависимость от пакета [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/).</span><span class="sxs-lookup"><span data-stu-id="2688e-148">Include a dependency on the [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/) package in your app dependencies.</span></span> <span data-ttu-id="2688e-149">Включите в приложение ПО промежуточного слоя для интеграции IIS, добавив метод расширения *UseIISIntegration* в *WebHostBuilder*.</span><span class="sxs-lookup"><span data-stu-id="2688e-149">Incorporate IIS Integration middleware into the app by adding the *UseIISIntegration* extension method to *WebHostBuilder*:</span></span>

```csharp
var host = new WebHostBuilder()
    .UseKestrel()
    .UseIISIntegration()
    ...
```

<span data-ttu-id="2688e-150">`UseKestrel` и `UseIISIntegration` являются обязательными элементами.</span><span class="sxs-lookup"><span data-stu-id="2688e-150">Both `UseKestrel` and `UseIISIntegration` are required.</span></span> <span data-ttu-id="2688e-151">Код, вызывающий *UseIISIntegration*, не влияет на переносимость кода.</span><span class="sxs-lookup"><span data-stu-id="2688e-151">Code calling *UseIISIntegration* doesn't affect code portability.</span></span> <span data-ttu-id="2688e-152">Если приложение запускается не в IIS (например, запускается непосредственно в Kestrel), то в `UseIISIntegration` нет операций.</span><span class="sxs-lookup"><span data-stu-id="2688e-152">If the app isn't run behind IIS (for example, the app is run directly on Kestrel), `UseIISIntegration` no-ops.</span></span>

---

<span data-ttu-id="2688e-153">Дополнительные сведения о размещении см. в разделе [Размещение в ASP.NET Core](xref:fundamentals/hosting).</span><span class="sxs-lookup"><span data-stu-id="2688e-153">For more information on hosting, see [Hosting in ASP.NET Core](xref:fundamentals/hosting).</span></span>

### <a name="iis-options"></a><span data-ttu-id="2688e-154">Параметры служб IIS</span><span class="sxs-lookup"><span data-stu-id="2688e-154">IIS options</span></span>

<span data-ttu-id="2688e-155">Чтобы настроить параметры службы *IISIntegration*, включите конфигурацию службы для *IISOptions* в *ConfigureServices*:</span><span class="sxs-lookup"><span data-stu-id="2688e-155">To configure *IISIntegration* service options, include a service configuration for *IISOptions* in *ConfigureServices*:</span></span>

```csharp
services.Configure<IISOptions>(options => 
{
    ...
});
```

| <span data-ttu-id="2688e-156">Параметр</span><span class="sxs-lookup"><span data-stu-id="2688e-156">Option</span></span>                         | <span data-ttu-id="2688e-157">По умолчанию</span><span class="sxs-lookup"><span data-stu-id="2688e-157">Default</span></span> | <span data-ttu-id="2688e-158">Параметр</span><span class="sxs-lookup"><span data-stu-id="2688e-158">Setting</span></span> |
| ------------------------------ | ------- | ------- |
| `AutomaticAuthentication`      | `true`  | <span data-ttu-id="2688e-159">Если значение — `true`, ПО промежуточного слоя для проверки подлинности задаст значение `HttpContext.User` и будет отвечать на общие запросы.</span><span class="sxs-lookup"><span data-stu-id="2688e-159">If `true`, the authentication middleware sets the `HttpContext.User` and responds to generic challenges.</span></span> <span data-ttu-id="2688e-160">Если значение — `false`, ПО промежуточного слоя для проверки подлинности только предоставит идентификатор (`HttpContext.User`) и будет отвечать только на явные запросы от `AuthenticationScheme`.</span><span class="sxs-lookup"><span data-stu-id="2688e-160">If `false`, the authentication middleware only provides an identity (`HttpContext.User`) and responds to challenges when explicitly requested by the `AuthenticationScheme`.</span></span> <span data-ttu-id="2688e-161">Для работы `AutomaticAuthentication` необходимо включить в службах IIS проверку подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="2688e-161">Windows Authentication must be enabled in IIS for `AutomaticAuthentication` to function.</span></span> |
| `AuthenticationDisplayName`    | `null`  | <span data-ttu-id="2688e-162">Задает отображаемое имя для пользователей на страницах входа.</span><span class="sxs-lookup"><span data-stu-id="2688e-162">Sets the display name shown to users on login pages.</span></span> |
| `ForwardClientCertificate`     | `true`  | <span data-ttu-id="2688e-163">Если значение — `true` и если присутствует заголовок запроса `MS-ASPNETCORE-CLIENTCERT`, происходит заполнение `HttpContext.Connection.ClientCertificate`.</span><span class="sxs-lookup"><span data-stu-id="2688e-163">If `true` and the `MS-ASPNETCORE-CLIENTCERT` request header is present, the `HttpContext.Connection.ClientCertificate` is populated.</span></span> |

### <a name="webconfig"></a><span data-ttu-id="2688e-164">web.config.</span><span class="sxs-lookup"><span data-stu-id="2688e-164">web.config</span></span>

<span data-ttu-id="2688e-165">Файл *web.config* в первую очередь настраивает модуль ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="2688e-165">The *web.config* file primarily configures the ASP.NET Core Module.</span></span> <span data-ttu-id="2688e-166">Он может также предоставлять дополнительные параметры конфигурации IIS.</span><span class="sxs-lookup"><span data-stu-id="2688e-166">It may optionally provide additional IIS configuration settings.</span></span> <span data-ttu-id="2688e-167">За создание, преобразования и публикацию *web.config* отвечает веб-пакет SDK для .NET Core (`Microsoft.NET.Sdk.Web`).</span><span class="sxs-lookup"><span data-stu-id="2688e-167">Creating, transforming, and publishing *web.config* is handled by the .NET Core Web SDK (`Microsoft.NET.Sdk.Web`).</span></span> <span data-ttu-id="2688e-168">Пакет SDK устанавливается поверх файла проекта (*CSPROJ*), `<Project Sdk="Microsoft.NET.Sdk.Web">`.</span><span class="sxs-lookup"><span data-stu-id="2688e-168">The SDK is set  at the top of the project file (*.csproj*), `<Project Sdk="Microsoft.NET.Sdk.Web">`.</span></span> <span data-ttu-id="2688e-169">Чтобы пакет SDK не преобразовывал файл *web.config*, добавьте в файл проекта свойство **\<IsTransformWebConfigDisabled>** со значением `true`:</span><span class="sxs-lookup"><span data-stu-id="2688e-169">To prevent the SDK from transforming the *web.config* file, add the **\<IsTransformWebConfigDisabled>** property to the project file with a setting of `true`:</span></span>

```xml
<PropertyGroup>
  <IsTransformWebConfigDisabled>true</IsTransformWebConfigDisabled>
</PropertyGroup>
```

<span data-ttu-id="2688e-170">Если при публикации с помощью команды *dotnet publish* или функции публикации в Visual Studio в проекте нет файла *web.config*, он создается автоматически в [публикуемых выходных данных](xref:hosting/directory-structure).</span><span class="sxs-lookup"><span data-stu-id="2688e-170">If you don't have a *web.config* file in the project when you publish with *dotnet publish* or with Visual Studio publish, the file is created for you in [published output](xref:hosting/directory-structure).</span></span> <span data-ttu-id="2688e-171">Если в проекте есть файл *web.config*, он преобразуется с использованием соответствующих аргументов *processPath* и *arguments* для настройки [модуля ASP.NET Core](xref:fundamentals/servers/aspnet-core-module) и переносится в опубликованные выходные данные.</span><span class="sxs-lookup"><span data-stu-id="2688e-171">If you have a *web.config* file in your project, it's transformed with the correct *processPath* and *arguments* to configure the [ASP.NET Core Module](xref:fundamentals/servers/aspnet-core-module) and moved to published output.</span></span> <span data-ttu-id="2688e-172">Преобразование не затрагивает параметры конфигурации IIS, включенные в файл.</span><span class="sxs-lookup"><span data-stu-id="2688e-172">The transformation doesn't touch IIS configuration settings that you've included in the file.</span></span>

## <a name="create-the-iis-website"></a><span data-ttu-id="2688e-173">Создание веб-сайта IIS</span><span class="sxs-lookup"><span data-stu-id="2688e-173">Create the IIS Website</span></span>

1. <span data-ttu-id="2688e-174">В целевой системе IIS создайте папку для опубликованных папок и файлов приложения, которые описываются в статье [Структура каталогов](xref:hosting/directory-structure).</span><span class="sxs-lookup"><span data-stu-id="2688e-174">On the target IIS system, create a folder to contain the app's published folders and files, which are described in [Directory Structure](xref:hosting/directory-structure).</span></span>

2. <span data-ttu-id="2688e-175">В созданной папке создайте папку *logs* для журналов StdOut (если вы планируете включить ведение журналов для устранения неполадок при запуске).</span><span class="sxs-lookup"><span data-stu-id="2688e-175">Within the folder you created, create a *logs* folder to hold stdout logs (if you plan to enable logging to troubleshoot start-up issues).</span></span> <span data-ttu-id="2688e-176">Если вы планируете развернуть приложение с папкой *logs* в полезных данных, этот шаг можно пропустить.</span><span class="sxs-lookup"><span data-stu-id="2688e-176">If you plan to deploy your application with a *logs* folder in the payload, you may skip this step.</span></span> <span data-ttu-id="2688e-177">Существует [нерешенная проблема с автоматическим созданием папки](https://github.com/aspnet/AspNetCoreModule/issues/30).</span><span class="sxs-lookup"><span data-stu-id="2688e-177">There's an [open issue to create the folder automatically](https://github.com/aspnet/AspNetCoreModule/issues/30).</span></span> <span data-ttu-id="2688e-178">Если вы хотите, чтобы система MSBuild самостоятельно создала папку *log*, добавьте в файл проекта следующий объект `Target`.</span><span class="sxs-lookup"><span data-stu-id="2688e-178">If you would like MSBuild to create the *log* folder for you, add the following `Target` to your project file:</span></span>

   ```xml
   <Target Name="CreateLogsFolder" AfterTargets="AfterPublish">
     <MakeDir Directories="$(PublishDir)logs" Condition="!Exists('$(PublishDir)logs')" />
     <MakeDir Directories="$(PublishUrl)logs" Condition="!Exists('$(PublishUrl)logs')" />
   </Target>
   ```

3. <span data-ttu-id="2688e-179">В **диспетчере IIS** создайте веб-сайт.</span><span class="sxs-lookup"><span data-stu-id="2688e-179">In **IIS Manager**, create a new website.</span></span> <span data-ttu-id="2688e-180">Укажите **Имя сайта** и задайте **Физический путь** к созданной папке развертывания приложения.</span><span class="sxs-lookup"><span data-stu-id="2688e-180">Provide a **Site name** and set the **Physical path** to the app's deployment folder that you created.</span></span> <span data-ttu-id="2688e-181">Укажите конфигурацию **привязки** и создайте веб-сайт.</span><span class="sxs-lookup"><span data-stu-id="2688e-181">Provide the **Binding** configuration and create the website.</span></span>

4. <span data-ttu-id="2688e-182">Для пула приложений выберите **Без управляемого кода**.</span><span class="sxs-lookup"><span data-stu-id="2688e-182">Set the application pool to **No Managed Code**.</span></span> <span data-ttu-id="2688e-183">ASP.NET Core выполняется в отдельном процессе и управляет средой выполнения.</span><span class="sxs-lookup"><span data-stu-id="2688e-183">ASP.NET Core runs in a separate process and manages the runtime.</span></span>

5. <span data-ttu-id="2688e-184">Откройте окно **Добавить веб-сайт**.</span><span class="sxs-lookup"><span data-stu-id="2688e-184">Open the **Add Website** window.</span></span>

   ![В контекстном меню узла "Сайты" выберите пункт "Добавить веб-сайт".](iis/_static/add-website-context-menu-ws2016.png)

6. <span data-ttu-id="2688e-186">Настройте веб-сайт.</span><span class="sxs-lookup"><span data-stu-id="2688e-186">Configure the website.</span></span>

   ![В окне "Добавить веб-сайт" укажите имя сайта, физический путь и имя узла.](iis/_static/add-website-ws2016.png)

7. <span data-ttu-id="2688e-188">На панели **Пулы приложений** откройте окно **Изменение пула приложений**, щелкнув пул приложений веб-сайта правой кнопкой мыши и выбрав в контекстном меню пункт **Основные параметры...**</span><span class="sxs-lookup"><span data-stu-id="2688e-188">In the **Application Pools** panel, open the **Edit Application Pool** window by right-clicking on the website's app pool and selecting **Basic Settings...** from the popup menu.</span></span>

   ![В контекстном меню пула приложений выберите пункт "Основные настройки".](iis/_static/apppools-basic-settings-ws2016.png)

8. <span data-ttu-id="2688e-190">Для параметра **Версия среды CLR .NET** выберите значение **Без управляемого кода**.</span><span class="sxs-lookup"><span data-stu-id="2688e-190">Set the **.NET CLR version** to **No Managed Code**.</span></span>

   ![Выберите "Без управляемого кода" для параметра "Версия среды CLR .NET".](iis/_static/edit-apppool-ws2016.png)
     
    <span data-ttu-id="2688e-192">Примечание. Задавать для параметра **Версия среды CLR .NET** значение **Без управляемого кода** необязательно.</span><span class="sxs-lookup"><span data-stu-id="2688e-192">Note: Setting the **.NET CLR version** to **No Managed Code** is optional.</span></span> <span data-ttu-id="2688e-193">Для ASP.NET Core не требуется загрузка классической среды CLR.</span><span class="sxs-lookup"><span data-stu-id="2688e-193">ASP.NET Core doesn't rely on loading the desktop CLR.</span></span>

9. <span data-ttu-id="2688e-194">Убедитесь в том, что удостоверение модели процесса имеет соответствующие разрешения.</span><span class="sxs-lookup"><span data-stu-id="2688e-194">Confirm the process model identity has the proper permissions.</span></span>

   <span data-ttu-id="2688e-195">Если вы изменяете удостоверение по умолчанию для пула приложений (**Модель процесса** > **Удостоверение**) с **ApplicationPoolIdentity** на другое, убедитесь, что у нового удостоверения есть соответствующие разрешения для доступа к папке приложения, базе данных и другим необходимым ресурсам.</span><span class="sxs-lookup"><span data-stu-id="2688e-195">If you change the default identity of the app pool (**Process Model** > **Identity**) from **ApplicationPoolIdentity** to another identity, verify that the new identity has the required permissions to access the app's folder, database, and other required resources.</span></span>
   
## <a name="deploy-the-application"></a><span data-ttu-id="2688e-196">Развертывание приложения</span><span class="sxs-lookup"><span data-stu-id="2688e-196">Deploy the application</span></span>
<span data-ttu-id="2688e-197">Разверните приложение в папке, созданной в целевой системе IIS.</span><span class="sxs-lookup"><span data-stu-id="2688e-197">Deploy the application to the folder you created on the target IIS system.</span></span> <span data-ttu-id="2688e-198">Рекомендуемый механизм развертывания — [веб-развертывание](/iis/publish/using-web-deploy/introduction-to-web-deploy).</span><span class="sxs-lookup"><span data-stu-id="2688e-198">[Web Deploy](/iis/publish/using-web-deploy/introduction-to-web-deploy) is the recommended mechanism for deployment.</span></span> <span data-ttu-id="2688e-199">Альтернативы ему описываются ниже.</span><span class="sxs-lookup"><span data-stu-id="2688e-199">Alternatives to Web Deploy are listed below.</span></span>

<span data-ttu-id="2688e-200">Убедитесь в том, что приложение, публикуемое для развертывания, не запущено.</span><span class="sxs-lookup"><span data-stu-id="2688e-200">Confirm that the published app for deployment isn't running.</span></span> <span data-ttu-id="2688e-201">Во время выполнения приложения файлы в папке *publish* блокируются.</span><span class="sxs-lookup"><span data-stu-id="2688e-201">Files in the *publish* folder are locked when the app is running.</span></span> <span data-ttu-id="2688e-202">Заблокированные файлы нельзя скопировать, так что развертывание в этом случае не произойдет.</span><span class="sxs-lookup"><span data-stu-id="2688e-202">Deployment can't occur because locked files can't be copied.</span></span>

### <a name="web-deploy-with-visual-studio"></a><span data-ttu-id="2688e-203">Веб-развертывание с помощью Visual Studio</span><span class="sxs-lookup"><span data-stu-id="2688e-203">Web Deploy with Visual Studio</span></span>
<span data-ttu-id="2688e-204">Сведения о создании профиля публикации для веб-развертывания см. в статье [Создание профилей публикации для Visual Studio и MSBuild с целью развертывания приложений ASP.NET Core](xref:publishing/web-publishing-vs#publish-profiles).</span><span class="sxs-lookup"><span data-stu-id="2688e-204">See [Create publish profiles for Visual Studio and MSBuild, to deploy ASP.NET Core apps](xref:publishing/web-publishing-vs#publish-profiles) topic to learn how to create a publish profile for use with Web Deploy.</span></span> <span data-ttu-id="2688e-205">Если ваш поставщик услуг размещения предоставляет профиль публикации или поддерживает его создание, скачайте этот профиль и импортируйте его с помощью диалогового окна **Публикация** в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="2688e-205">If your hosting provider supplies a Publish Profile or support for creating one, download their profile and import it using the Visual Studio **Publish** dialog.</span></span>

![Диалоговое окно "Публикация"](iis/_static/pub-dialog.png)

### <a name="web-deploy-outside-of-visual-studio"></a><span data-ttu-id="2688e-207">Веб-развертывание вне Visual Studio</span><span class="sxs-lookup"><span data-stu-id="2688e-207">Web Deploy outside of Visual Studio</span></span>
<span data-ttu-id="2688e-208">[Веб-развертывание](/iis/publish/using-web-deploy/introduction-to-web-deploy) можно также использовать вне Visual Studio с помощью командной строки.</span><span class="sxs-lookup"><span data-stu-id="2688e-208">You can also use [Web Deploy](/iis/publish/using-web-deploy/introduction-to-web-deploy) outside of Visual Studio from the command line.</span></span> <span data-ttu-id="2688e-209">Дополнительные сведения см. в статье [Средство веб-развертывания](/iis/publish/using-web-deploy/use-the-web-deployment-tool).</span><span class="sxs-lookup"><span data-stu-id="2688e-209">For more information, see [Web Deployment Tool](/iis/publish/using-web-deploy/use-the-web-deployment-tool).</span></span>

### <a name="alternatives-to-web-deploy"></a><span data-ttu-id="2688e-210">Альтернативы веб-развертыванию</span><span class="sxs-lookup"><span data-stu-id="2688e-210">Alternatives to Web Deploy</span></span>
<span data-ttu-id="2688e-211">Если вы не хотите применять веб-развертывание или не используете Visual Studio, вы можете прибегнуть к одному из методов переноса приложения в систему размещения, например Xcopy, Robocopy или PowerShell.</span><span class="sxs-lookup"><span data-stu-id="2688e-211">If you don't wish to use Web Deploy or are not using Visual Studio, you may use any of several methods to move the application to the hosting system, such as Xcopy, Robocopy, or PowerShell.</span></span> <span data-ttu-id="2688e-212">Пользователи Visual Studio могут применять [образцы публикации](https://github.com/aspnet/vsweb-publish/blob/master/samples/samples.md).</span><span class="sxs-lookup"><span data-stu-id="2688e-212">Visual Studio users may use the [Publish Samples](https://github.com/aspnet/vsweb-publish/blob/master/samples/samples.md).</span></span>

## <a name="browse-the-website"></a><span data-ttu-id="2688e-213">Обзор веб-сайта</span><span class="sxs-lookup"><span data-stu-id="2688e-213">Browse the website</span></span>
![Начальная страница IIS, загруженная в браузере Microsoft Edge.](iis/_static/browsewebsite.png)
   
> [!WARNING]
> <span data-ttu-id="2688e-215">Приложения .NET Core размещаются посредством обратного прокси-сервера между службами IIS и сервером Kestrel.</span><span class="sxs-lookup"><span data-stu-id="2688e-215">.NET Core apps are hosted via a reverse-proxy between IIS and the Kestrel server.</span></span> <span data-ttu-id="2688e-216">Для создания обратного прокси-сервера файл *web.config* должен находиться по корневому пути к содержимому развернутого приложения (как правило, это основной путь приложения). Это физический путь к веб-сайту, указанный в службах IIS.</span><span class="sxs-lookup"><span data-stu-id="2688e-216">In order to create the reverse-proxy, the *web.config* file must be present at the content root path (typically the app base path) of the deployed application, which is the website physical path provided to IIS.</span></span> <span data-ttu-id="2688e-217">По физическому пути приложения находятся важные файлы, включая такие вложенные папки, как *мое_приложение.runtimeconfig.json*, *мое_приложение.xml* (комментарии к документам XML) и *мое_приложение.deps.json*.</span><span class="sxs-lookup"><span data-stu-id="2688e-217">Sensitive files exist on the app's physical path, including subfolders, such as *my_application.runtimeconfig.json*, *my_application.xml* (XML Documentation comments), and *my_application.deps.json*.</span></span> <span data-ttu-id="2688e-218">Файл *web.config* необходим для создания обратного прокси-сервера для Kestrel, который запрещает службам IIS предоставлять эти и другие важные файлы.</span><span class="sxs-lookup"><span data-stu-id="2688e-218">The *web.config* file is required to create the reverse proxy to Kestrel, which prevents IIS from serving these and other sensitive files.</span></span> <span data-ttu-id="2688e-219">**Поэтому важно следить за тем, чтобы файл *web.config* не был случайно переименован или удален из развертывания**.</span><span class="sxs-lookup"><span data-stu-id="2688e-219">**Therefore, it's important that the *web.config* file isn't accidently renamed or removed from the deployment.**</span></span>

## <a name="data-protection"></a><span data-ttu-id="2688e-220">Защита данных</span><span class="sxs-lookup"><span data-stu-id="2688e-220">Data protection</span></span>

<span data-ttu-id="2688e-221">Приложение ASP.NET Core хранит набор ключей в памяти при выполнении указанных ниже условий.</span><span class="sxs-lookup"><span data-stu-id="2688e-221">An ASP.NET Core application stores the keyring in memory under the following conditions:</span></span>

* <span data-ttu-id="2688e-222">Веб-сайт размещается за службами IIS.</span><span class="sxs-lookup"><span data-stu-id="2688e-222">A website is hosted behind IIS.</span></span>
* <span data-ttu-id="2688e-223">В стеке защиты данных не настроено хранение набора ключей в постоянном хранилище.</span><span class="sxs-lookup"><span data-stu-id="2688e-223">The Data Protection stack hasn't been configured to store the keyring in a persistent store.</span></span>

<span data-ttu-id="2688e-224">Если набор ключей хранится в памяти, то при перезапуске приложения происходит следующее.</span><span class="sxs-lookup"><span data-stu-id="2688e-224">If the keyring is stored in memory when the app restarts:</span></span>

* <span data-ttu-id="2688e-225">Все токены проверки подлинности на основе форм становятся недействительными.</span><span class="sxs-lookup"><span data-stu-id="2688e-225">All forms authentication tokens are invalidated.</span></span> 
* <span data-ttu-id="2688e-226">При выполнении следующего запроса пользователю требуется выполнить вход снова.</span><span class="sxs-lookup"><span data-stu-id="2688e-226">Users are required to login again on their next request.</span></span> 
* <span data-ttu-id="2688e-227">Все данные, защищенные с помощью набора ключей, становятся незащищенными.</span><span class="sxs-lookup"><span data-stu-id="2688e-227">Any data you protected with the keyring are no longer protected.</span></span>

> [!WARNING]
> <span data-ttu-id="2688e-228">Защита данных используется некоторым программным обеспечением промежуточного слоя ASP.NET, в том числе применяемым для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="2688e-228">Data Protection is used by several ASP.NET middlewares, including those used in authentication.</span></span> <span data-ttu-id="2688e-229">Даже если вы не вызываете интерфейсы API защиты данных из своего кода, следует настроить защиту данных с помощью скрипта развертывания или в собственном коде.</span><span class="sxs-lookup"><span data-stu-id="2688e-229">Even if you don't call Data Protection APIs from your own code, you should configure Data Protection with a deployment script or in your code.</span></span> <span data-ttu-id="2688e-230">Если вы не настраиваете защиту данных, ключи по умолчанию хранятся в памяти и удаляются при перезапуске приложения.</span><span class="sxs-lookup"><span data-stu-id="2688e-230">If you don't configure data protection, by default the keys are held in memory and discarded when your app restarts.</span></span> <span data-ttu-id="2688e-231">При перезапуске все файлы cookie, записанные ПО промежуточного слоя для проверки подлинности, становятся недействительными, а пользователям требуется выполнить вход повторно.</span><span class="sxs-lookup"><span data-stu-id="2688e-231">Restarting invalidates cookies written by the cookie authentication middleware and users must login again.</span></span>

<span data-ttu-id="2688e-232">Чтобы настроить защиту данных в службах IIS, следует использовать один из описанных ниже подходов.</span><span class="sxs-lookup"><span data-stu-id="2688e-232">To configure Data Protection under IIS, you must use one of the following approaches:</span></span>

* <span data-ttu-id="2688e-233">Запустите [скрипт PowerShell](https://github.com/aspnet/DataProtection/blob/dev/Provision-AutoGenKeys.ps1), чтобы создать соответствующие записи в реестре (например, `.\Provision-AutoGenKeys.ps1 DefaultAppPool`).</span><span class="sxs-lookup"><span data-stu-id="2688e-233">Run a [powershell script](https://github.com/aspnet/DataProtection/blob/dev/Provision-AutoGenKeys.ps1) to create suitable registry entries (For example, `.\Provision-AutoGenKeys.ps1 DefaultAppPool`).</span></span> <span data-ttu-id="2688e-234">В результате ключи сохраняются в реестре и защищаются посредством API защиты данных с использованием ключа на уровне компьютера.</span><span class="sxs-lookup"><span data-stu-id="2688e-234">This stores keys in the registry, protected using DPAPI with a machine-wide key.</span></span>
* <span data-ttu-id="2688e-235">Настройте пул приложений IIS для загрузки профиля пользователя.</span><span class="sxs-lookup"><span data-stu-id="2688e-235">Configure the IIS Application Pool to load the user profile.</span></span> <span data-ttu-id="2688e-236">Этот параметр находится на странице **Дополнительные параметры** пула приложений в разделе **Модель процесса**.</span><span class="sxs-lookup"><span data-stu-id="2688e-236">This setting is in the **Process Model** section under the **Advanced Settings** for the application pool.</span></span> <span data-ttu-id="2688e-237">Задайте для параметра **Загрузить профиль пользователя** значение `True`.</span><span class="sxs-lookup"><span data-stu-id="2688e-237">Set **Load User Profile** to `True`.</span></span> <span data-ttu-id="2688e-238">В результате ключи сохраняются в каталоге профиля пользователя и защищаются посредством API защиты данных с использованием ключа на уровне учетной записи пользователя, применяемой для пула приложений.</span><span class="sxs-lookup"><span data-stu-id="2688e-238">This stores keys under the user profile directory and protects them using DPAPI with a key specific to the user account used for the app pool.</span></span>
* <span data-ttu-id="2688e-239">Измените код приложения так, чтобы [в качестве хранилища набора ключей использовалась файловая система](xref:security/data-protection/configuration/overview).</span><span class="sxs-lookup"><span data-stu-id="2688e-239">Adjust your app code to [use the file system as a key ring store](xref:security/data-protection/configuration/overview).</span></span> <span data-ttu-id="2688e-240">Используйте сертификат X509 для защиты набора ключей, причем это должен быть доверенный сертификат.</span><span class="sxs-lookup"><span data-stu-id="2688e-240">Use an X509 certificate to protect the keyring and ensure it's a trusted certificate.</span></span> <span data-ttu-id="2688e-241">Если сертификат является самозаверяющим, его следует поместить в доверенное корневое хранилище.</span><span class="sxs-lookup"><span data-stu-id="2688e-241">If it's a self signed certificate, you must place it in the Trusted Root store.</span></span>

<span data-ttu-id="2688e-242">При использовании служб IIS в веб-ферме:</span><span class="sxs-lookup"><span data-stu-id="2688e-242">When using IIS in a web farm:</span></span>

* <span data-ttu-id="2688e-243">используйте общую папку, которая доступна всем компьютерам;</span><span class="sxs-lookup"><span data-stu-id="2688e-243">Use a file share that all machines can access.</span></span>
* <span data-ttu-id="2688e-244">разверните сертификат X509 на каждом компьютере;</span><span class="sxs-lookup"><span data-stu-id="2688e-244">Deploy an X509 certificate to each machine.</span></span> <span data-ttu-id="2688e-245">настройте [защиту данных в коде](https://docs.microsoft.com/aspnet/core/security/data-protection/configuration/overview).</span><span class="sxs-lookup"><span data-stu-id="2688e-245">Configure [data protection in code](https://docs.microsoft.com/aspnet/core/security/data-protection/configuration/overview).</span></span>

### <a name="1-create-a-data-protection-registry-hive"></a><span data-ttu-id="2688e-246">1. Создание куста реестра для защиты данных</span><span class="sxs-lookup"><span data-stu-id="2688e-246">1. Create a Data Protection Registry Hive</span></span>

<span data-ttu-id="2688e-247">Ключи защиты данных, используемые приложениями ASP.NET, хранятся в кустах реестра, являющихся внешними для приложений.</span><span class="sxs-lookup"><span data-stu-id="2688e-247">Data Protection keys used by ASP.NET applications are stored in registry hives external to the applications.</span></span> <span data-ttu-id="2688e-248">Чтобы сохранять эти ключи для определенного приложения, нужно создать куст реестра для пула приложений, к которому относится данное приложение.</span><span class="sxs-lookup"><span data-stu-id="2688e-248">To persist the keys for a given application, you must create a registry hive for the app's application pool.</span></span>

<span data-ttu-id="2688e-249">При автономной установке служб IIS следует выполнить [скрипт PowerShell Provision-AutoGenKeys.ps1 для защиты данных](https://github.com/aspnet/DataProtection/blob/dev/Provision-AutoGenKeys.ps1) применительно к каждому пулу приложений, в который входит приложение ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="2688e-249">For standalone IIS installations, you may use the [Data Protection Provision-AutoGenKeys.ps1 PowerShell script](https://github.com/aspnet/DataProtection/blob/dev/Provision-AutoGenKeys.ps1) for each app pool used with an ASP.NET Core app.</span></span> <span data-ttu-id="2688e-250">Этот скрипт создает специальный раздел в реестре HKLM, который будет доступен только учетной записи рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="2688e-250">This script creates a special registry key in the HKLM registry that is ACLed only to the worker process account.</span></span> <span data-ttu-id="2688e-251">Неактивные ключи шифруются с помощью API защиты данных.</span><span class="sxs-lookup"><span data-stu-id="2688e-251">Keys are encrypted at rest using DPAPI.</span></span>

<span data-ttu-id="2688e-252">В веб-ферме приложение можно настроить так, чтобы для хранения набора ключей защиты данных использовался UNC-путь.</span><span class="sxs-lookup"><span data-stu-id="2688e-252">In web farm scenarios, an app can be configured to use a UNC path to store its data protection keyring.</span></span> <span data-ttu-id="2688e-253">По умолчанию ключи защиты данных не шифруются.</span><span class="sxs-lookup"><span data-stu-id="2688e-253">By default, the data protection keys are not encrypted.</span></span> <span data-ttu-id="2688e-254">Разрешения на доступ к файлам в общей папке должны быть предоставлены только учетной записи Windows, от имени которой выполняется приложение.</span><span class="sxs-lookup"><span data-stu-id="2688e-254">You should ensure that the file permissions for such a share are limited to the Windows account the app runs as.</span></span> <span data-ttu-id="2688e-255">Помимо этого, для защиты неактивных ключей можно использовать сертификат X509.</span><span class="sxs-lookup"><span data-stu-id="2688e-255">In addition, you may choose to protect keys at rest using an X509 certificate.</span></span> <span data-ttu-id="2688e-256">При этом может потребоваться реализовать механизм, позволяющий пользователям отправлять сертификаты: поместить сертификаты в хранилище доверенных сертификатов пользователя и обеспечивать их доступность на всех компьютерах, где выполняется приложение.</span><span class="sxs-lookup"><span data-stu-id="2688e-256">You may wish to consider a mechanism to allow users to upload certificates: Place certificates into the user's trusted certificate store and ensure they're available on all machines where the user's app runs.</span></span> <span data-ttu-id="2688e-257">Подробные сведения см. в разделе [Настройка защиты данных](xref:security/data-protection/configuration/overview).</span><span class="sxs-lookup"><span data-stu-id="2688e-257">See [Configuring Data Protection](xref:security/data-protection/configuration/overview) for details.</span></span>

### <a name="2-configure-the-iis-application-pool-to-load-the-user-profile"></a><span data-ttu-id="2688e-258">2. Настройка пула приложений IIS для загрузки профиля пользователя</span><span class="sxs-lookup"><span data-stu-id="2688e-258">2. Configure the IIS Application Pool to load the user profile</span></span>

<span data-ttu-id="2688e-259">Этот параметр находится на странице **Дополнительные параметры** пула приложений в разделе **Модель процесса**.</span><span class="sxs-lookup"><span data-stu-id="2688e-259">This setting is in the **Process Model** section under the **Advanced Settings** for the app pool.</span></span> <span data-ttu-id="2688e-260">Задайте для параметра "Загрузить профиль пользователя" значение `True`.</span><span class="sxs-lookup"><span data-stu-id="2688e-260">Set Load User Profile to `True`.</span></span> <span data-ttu-id="2688e-261">В результате ключи сохраняются в каталоге профиля пользователя и защищаются посредством API защиты данных с использованием ключа на уровне учетной записи пользователя, применяемой для пула приложений.</span><span class="sxs-lookup"><span data-stu-id="2688e-261">This stores keys under the user profile directory and protects them using DPAPI with a key specific to the user account used for the app pool.</span></span>

### <a name="3-machine-wide-policy-for-data-protection"></a><span data-ttu-id="2688e-262">3. Политика защиты данных на уровне компьютера</span><span class="sxs-lookup"><span data-stu-id="2688e-262">3. Machine-wide policy for data protection</span></span>

<span data-ttu-id="2688e-263">Система защиты данных обеспечивает ограниченную поддержку задания [политики по умолчанию на уровне компьютера](xref:security/data-protection/configuration/machine-wide-policy) для всех приложений, использующих интерфейсы API защиты данных.</span><span class="sxs-lookup"><span data-stu-id="2688e-263">The data protection system has limited support for setting a default [machine-wide policy](xref:security/data-protection/configuration/machine-wide-policy) for all apps that consume the Data Protection APIs.</span></span> <span data-ttu-id="2688e-264">Дополнительные сведения см. в документации по [защите данных](xref:security/data-protection/index).</span><span class="sxs-lookup"><span data-stu-id="2688e-264">See the [data protection](xref:security/data-protection/index) documentation for more details.</span></span>

## <a name="configuration-of-sub-applications"></a><span data-ttu-id="2688e-265">Настройка дочерних приложений</span><span class="sxs-lookup"><span data-stu-id="2688e-265">Configuration of sub-applications</span></span>

<span data-ttu-id="2688e-266">Дочерние приложения, добавленные в корневое приложение, не должны включать в себя модуль ASP.NET Core в качестве обработчика.</span><span class="sxs-lookup"><span data-stu-id="2688e-266">Sub applications added under the root application shouldn't include the ASP.NET Core Module as a handler.</span></span> <span data-ttu-id="2688e-267">Если вы добавите модуль в качестве обработчика в файл *web.config* дочернего приложения, то при попытке работы с этим приложением получите ошибку 500.19 (внутренняя ошибка сервера) с указанием некорректного файла конфигурации.</span><span class="sxs-lookup"><span data-stu-id="2688e-267">If you add the module as a handler in a sub-application's *web.config* file, you receive a 500.19 (Internal Server Error) referencing the faulty config file when you attempt to browse the sub-app.</span></span> <span data-ttu-id="2688e-268">В приведенном ниже примере показано содержимое опубликованного файла *web.config* для дочернего приложения ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="2688e-268">The following example shows the contents of a published *web.config* file for an ASP.NET Core sub-app:</span></span>

```xml
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
    <aspNetCore processPath="dotnet" 
      arguments=".\MyApp.dll" 
      stdoutLogEnabled="false" 
      stdoutLogFile=".\logs\stdout" />
  </system.webServer>
</configuration>
```

<span data-ttu-id="2688e-269">Если вы планируете размещать дочернее приложение не на основе ASP.NET Core в приложении ASP.NET Core, нужно явным образом удалить унаследованный обработчик из файла *web.config* дочернего приложения.</span><span class="sxs-lookup"><span data-stu-id="2688e-269">If you intend to host a non-ASP.NET Core sub-app underneath an ASP.NET Core app, you must explicitly remove the inherited handler in the sub-app *web.config* file:</span></span>

```xml
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
    <handlers>
      <remove name="aspNetCore"/>
    </handlers>
    <aspNetCore processPath="dotnet" 
      arguments=".\MyApp.dll" 
      stdoutLogEnabled="false" 
      stdoutLogFile=".\logs\stdout" />
  </system.webServer>
</configuration>
```

<span data-ttu-id="2688e-270">Дополнительные сведения о настройке модуля ASP.NET Core с помощью файла *web.config* см. в статье [Введение в модуль ASP.NET Core Module](xref:fundamentals/servers/aspnet-core-module) и в [справочнике по настройке модуля ASP.NET Core](xref:hosting/aspnet-core-module).</span><span class="sxs-lookup"><span data-stu-id="2688e-270">For more information on configuring the ASP.NET Core Module with the *web.config* file, see the [Introduction to ASP.NET Core Module](xref:fundamentals/servers/aspnet-core-module) topic and the [ASP.NET Core Module configuration reference](xref:hosting/aspnet-core-module).</span></span>

## <a name="configuration-of-iis-with-webconfig"></a><span data-ttu-id="2688e-271">Настройка служб IIS с помощью файла web.config</span><span class="sxs-lookup"><span data-stu-id="2688e-271">Configuration of IIS with web.config</span></span>

<span data-ttu-id="2688e-272">Раздел `<system.webServer>` файла *web.config* по-прежнему действует для тех компонентов IIS, которые относятся к конфигурации прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="2688e-272">IIS configuration is still influenced by the `<system.webServer>` section of *web.config* for those IIS features that apply to a reverse proxy configuration.</span></span> <span data-ttu-id="2688e-273">Например, на уровне системы в службах IIS может быть настроено динамическое сжатие, однако для приложения этот параметр можно отключить с помощью элемента `<urlCompression>` в файле *web.config* приложения.</span><span class="sxs-lookup"><span data-stu-id="2688e-273">For example, you may have IIS configured at the system level to use dynamic compression, but you could disable that setting for an app with the `<urlCompression>` element in the app's *web.config* file.</span></span> <span data-ttu-id="2688e-274">Дополнительные сведения см. в [справочнике по настройке `<system.webServer>`](https://docs.microsoft.com/iis/configuration/system.webServer/), [справочнике по настройке модуля ASP.NET Core](xref:hosting/aspnet-core-module) и статье [Использование модулей IIS с ASP.NET Core](xref:hosting/iis-modules).</span><span class="sxs-lookup"><span data-stu-id="2688e-274">For more information, see the [configuration reference for `<system.webServer>`](https://docs.microsoft.com/iis/configuration/system.webServer/), [ASP.NET Core Module Configuration Reference](xref:hosting/aspnet-core-module) and [Using IIS Modules with ASP.NET Core](xref:hosting/iis-modules).</span></span> <span data-ttu-id="2688e-275">Если нужно задать переменные среды для отдельных приложений, выполняющихся в изолированных пулах приложений (такая возможность поддерживается в службах IIS 10.0 и более поздних версий), см. подраздел, посвященный *команде AppCmd.exe*, в разделе [Переменные среды \<environmentVariables>](/iis/configuration/system.applicationHost/applicationPools/add/environmentVariables/#appcmdexe) справочной документации по службам IIS.</span><span class="sxs-lookup"><span data-stu-id="2688e-275">If you need to set environment variables for individual apps running in isolated Application Pools (supported on IIS 10.0+), see the *AppCmd.exe command* section of the [Environment Variables \<environmentVariables>](/iis/configuration/system.applicationHost/applicationPools/add/environmentVariables/#appcmdexe) topic in the IIS reference documentation.</span></span>

## <a name="configuration-sections-of-webconfig"></a><span data-ttu-id="2688e-276">Разделы конфигурации файла web.config</span><span class="sxs-lookup"><span data-stu-id="2688e-276">Configuration sections of web.config</span></span>

<span data-ttu-id="2688e-277">В отличие от приложений .NET Framework, которые настраиваются с помощью элементов `<system.web>`, `<appSettings>`, `<connectionStrings>` и `<location>` в файле *web.config*, приложения ASP.NET Core настраиваются с помощью других поставщиков конфигурации.</span><span class="sxs-lookup"><span data-stu-id="2688e-277">Unlike .NET Framework applications that are configured with the `<system.web>`, `<appSettings>`, `<connectionStrings>`, and `<location>` elements in *web.config*, ASP.NET Core apps are configured using other configuration providers.</span></span> <span data-ttu-id="2688e-278">Дополнительные сведения см. в разделе [Конфигурация](xref:fundamentals/configuration).</span><span class="sxs-lookup"><span data-stu-id="2688e-278">For more information, see [Configuration](xref:fundamentals/configuration).</span></span>

## <a name="application-pools"></a><span data-ttu-id="2688e-279">Пулы приложений</span><span class="sxs-lookup"><span data-stu-id="2688e-279">Application Pools</span></span>

<span data-ttu-id="2688e-280">Если в одной системе размещается несколько веб-сайтов, приложения следует изолировать друг от друга, запуская каждое из них в отдельном пуле приложений.</span><span class="sxs-lookup"><span data-stu-id="2688e-280">When hosting multiple websites on a single system, you should isolate the apps from each other by running each app in its own application pool.</span></span> <span data-ttu-id="2688e-281">В диалоговом окне **Добавить веб-сайт** служб IIS такое поведение задано по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="2688e-281">The IIS **Add Website** dialog defaults to this behavior.</span></span> <span data-ttu-id="2688e-282">Если вы указываете **имя сайта**, оно автоматически переносится в текстовое поле **Пул приложений**.</span><span class="sxs-lookup"><span data-stu-id="2688e-282">When you provide a **Site name**, the text is automatically transferred to the **Application pool** textbox.</span></span> <span data-ttu-id="2688e-283">При добавлении веб-сайта создается пул приложений с именем сайта.</span><span class="sxs-lookup"><span data-stu-id="2688e-283">A new application pool is created using the site name when you add the website.</span></span>

## <a name="application-pool-identity"></a><span data-ttu-id="2688e-284">Удостоверение пула приложений</span><span class="sxs-lookup"><span data-stu-id="2688e-284">Application Pool Identity</span></span>

<span data-ttu-id="2688e-285">Учетная запись удостоверения пула приложений позволяет запускать приложение от имени уникальной учетной записи, не создавая домены или локальные учетные записи и не управляя ими.</span><span class="sxs-lookup"><span data-stu-id="2688e-285">An application pool identity account allows you to run an application under a unique account without having to create and manage domains or local accounts.</span></span> <span data-ttu-id="2688e-286">В службах IIS 8.0 и более поздних версий рабочий процесс администратора IIS (WAS) создает виртуальную учетную запись с именем нового пула приложений и по умолчанию выполняет рабочие процессы пула приложений с этой учетной записью.</span><span class="sxs-lookup"><span data-stu-id="2688e-286">On IIS 8.0+, the IIS Admin Worker Process (WAS) creates a virtual account with the name of the new application pool and runs the app pool's worker processes under this account by default.</span></span> <span data-ttu-id="2688e-287">В консоли управления IIS в окне **Дополнительные параметры** для пула приложений должно быть выбрано **Удостоверение** **ApplicationPoolIdentity**, как показано на рисунке ниже.</span><span class="sxs-lookup"><span data-stu-id="2688e-287">In the IIS Management Console under **Advanced Settings** for your app pool, ensure that the **Identity** is set to use **ApplicationPoolIdentity** as shown in the image below.</span></span>

![Диалоговое окно дополнительных параметров для пула приложений](iis/_static/apppool-identity.png)

<span data-ttu-id="2688e-289">Процесс управления IIS создает в системе безопасности Windows безопасный идентификатор с именем пула приложений.</span><span class="sxs-lookup"><span data-stu-id="2688e-289">The IIS management process creates a secure identifier with the name of the app pool in the Windows Security System.</span></span> <span data-ttu-id="2688e-290">С помощью этого удостоверения можно защищать ресурсы, но оно не представляет реальную учетную запись пользователя и не отображается в консоли управления Windows пользователя.</span><span class="sxs-lookup"><span data-stu-id="2688e-290">Resources can be secured by using this identity; however, this identity isn't a real user account and won't show up in the Windows User Management Console.</span></span>

<span data-ttu-id="2688e-291">Если рабочему процессу IIS требуется предоставить доступ к приложению с повышенными правами, нужно изменить список управления доступом (ACL) для каталога, содержащего приложение.</span><span class="sxs-lookup"><span data-stu-id="2688e-291">If you need to grant the IIS worker process elevated access to your app, you must modify the Access Control List (ACL) for the directory containing your application.</span></span>

1. <span data-ttu-id="2688e-292">Откройте проводник и перейдите к каталогу.</span><span class="sxs-lookup"><span data-stu-id="2688e-292">Open Windows Explorer and navigate to the directory.</span></span>

2. <span data-ttu-id="2688e-293">Щелкните каталог правой кнопкой мыши и выберите пункт **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="2688e-293">Right click on the directory and click **Properties**.</span></span>

3. <span data-ttu-id="2688e-294">На вкладке **Безопасность** нажмите кнопку **Изменить**, а затем кнопку **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="2688e-294">Under the **Security** tab, click the **Edit** button and then the **Add** button.</span></span>

4. <span data-ttu-id="2688e-295">Нажмите кнопку **Размещение** и выберите свою систему.</span><span class="sxs-lookup"><span data-stu-id="2688e-295">Click the **Locations** button and make sure you select your system.</span></span>

5. <span data-ttu-id="2688e-296">В текстовом поле **Введите имена выбираемых объектов** введите **IIS AppPool\DefaultAppPool**.</span><span class="sxs-lookup"><span data-stu-id="2688e-296">Enter **IIS AppPool\DefaultAppPool** in **Enter the object names to select** textbox.</span></span>

  ![Диалоговое окно "Введите имена выбираемых объектов" для папки приложения](iis/_static/select-users-or-groups-1.png)

6. <span data-ttu-id="2688e-298">Нажмите кнопку **Проверить имена**, а затем — кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="2688e-298">Click the **Check Names** button and then click **OK**.</span></span>

  ![Диалоговое окно "Введите имена выбираемых объектов" для папки приложения](iis/_static/select-users-or-groups-2.png)

<span data-ttu-id="2688e-300">Это также можно сделать в командной строке с помощью программы **ICACLS**:</span><span class="sxs-lookup"><span data-stu-id="2688e-300">You can also do this via a command prompt using **ICACLS** tool:</span></span>

```console
ICACLS C:\sites\MyWebApp /grant "IIS AppPool\DefaultAppPool":F
```

## <a name="troubleshooting-tips"></a><span data-ttu-id="2688e-301">Советы по устранению неполадок</span><span class="sxs-lookup"><span data-stu-id="2688e-301">Troubleshooting tips</span></span>

<span data-ttu-id="2688e-302">Процедура диагностики проблем для развертываний IIS</span><span class="sxs-lookup"><span data-stu-id="2688e-302">To diagnose problems with IIS deployments:</span></span>

* <span data-ttu-id="2688e-303">Изучите выходные данные браузера.</span><span class="sxs-lookup"><span data-stu-id="2688e-303">Study browser output.</span></span>
* <span data-ttu-id="2688e-304">Просмотрите системный **приложения** с помощью средства **Просмотр событий**.</span><span class="sxs-lookup"><span data-stu-id="2688e-304">Examine the system's **Application** log through **Event Viewer**.</span></span>
* <span data-ttu-id="2688e-305">Включите ведение журнала `stdout`.</span><span class="sxs-lookup"><span data-stu-id="2688e-305">Enable `stdout` logging.</span></span> <span data-ttu-id="2688e-306">Журнал **модуля ASP.NET Core** находится по пути, указанном в атрибуте *stdoutLogFile* элемента `<aspNetCore>` в файле *web.config*. Все папки по пути, указанному в значении этого атрибута, должны существовать в развертывании.</span><span class="sxs-lookup"><span data-stu-id="2688e-306">The **ASP.NET Core Module** log is found on the path provided in the *stdoutLogFile* attribute of the `<aspNetCore>` element in *web.config*. Any folders on the path provided in the attribute value must exist in the deployment.</span></span> <span data-ttu-id="2688e-307">Кроме того, необходимо задать *stdoutLogEnabled="true"*.</span><span class="sxs-lookup"><span data-stu-id="2688e-307">You must also set *stdoutLogEnabled="true"*.</span></span> <span data-ttu-id="2688e-308">Во всех приложениях, использующих пакет SDK `Microsoft.NET.Sdk.Web` для создания файла *web.config*, параметр *stdoutLogEnabled* по умолчанию имеет значение *false*, поэтому файл *web.config* нужно предоставить вручную или изменить его, включив ведение журналов `stdout`.</span><span class="sxs-lookup"><span data-stu-id="2688e-308">Apps that use the the `Microsoft.NET.Sdk.Web` SDK to create the *web.config* file default the *stdoutLogEnabled* setting to *false*, so you must manually provide the *web.config* file or modify the file in order to enable `stdout` logging.</span></span>

<span data-ttu-id="2688e-309">Некоторые распространенные ошибки не приводятся в браузере, журнале приложений и журнале модуля ASP.NET Core, пока не будут достигнуты значения *startupTimeLimit* (по умолчанию 120 секунд) и *startupRetryCount* (по умолчанию 2).</span><span class="sxs-lookup"><span data-stu-id="2688e-309">Several of the common errors don't appear in the browser, Application Log, and ASP.NET Core Module Log until the module *startupTimeLimit* (default: 120 seconds) and *startupRetryCount* (default: 2) have passed.</span></span> <span data-ttu-id="2688e-310">Поэтому прежде чем делать вывод о том, что модулю не удалось запустить процесс приложения, подождите шесть минут.</span><span class="sxs-lookup"><span data-stu-id="2688e-310">Therefore, wait a full six minutes before deducing that the module has failed to start a process for the app.</span></span>

<span data-ttu-id="2688e-311">Один из простых способов определить, правильно ли работает приложение, — запустить его непосредственно в Kestrel.</span><span class="sxs-lookup"><span data-stu-id="2688e-311">One quick way to determine if the app is working properly is to run the app directly on Kestrel.</span></span> <span data-ttu-id="2688e-312">Если приложение было опубликовано как зависящее от платформы развертывание (FDD), выполните команду `dotnet my_application.dll` в папке развертывания, которая представляет собой физический путь к приложению в IIS.</span><span class="sxs-lookup"><span data-stu-id="2688e-312">If the app was published as a framework-dependent deployment (FDD), execute `dotnet my_application.dll` in the deployment folder, which is the IIS physical path to the app.</span></span> <span data-ttu-id="2688e-313">Если приложение было опубликовано как автономное развертывание (SCD), запустите его исполняемый файл (`my_application.exe`) в папке развертывания непосредственно из командной строки.</span><span class="sxs-lookup"><span data-stu-id="2688e-313">If the app was published as a self-contained deployment (SCD), run the app's executable directly from a command prompt, `my_application.exe`, in the deployment folder.</span></span> <span data-ttu-id="2688e-314">Если Kestrel прослушивает порт по умолчанию с номером 5000, приложение должно быть доступно по адресу `http://localhost:5000/`.</span><span class="sxs-lookup"><span data-stu-id="2688e-314">If Kestrel is listening on default port 5000, you should be able to browse the app at `http://localhost:5000/`.</span></span> <span data-ttu-id="2688e-315">Если приложение отвечает на запросы по адресу конечной точки Kestrel, проблема, вероятнее всего, связана с конфигурацией служб IIS, модуля ASP.NET Core и Kestrel, а не с самим приложением.</span><span class="sxs-lookup"><span data-stu-id="2688e-315">If the app responds normally at the Kestrel endpoint address, the problem is more likely related to the IIS-ASP.NET Core Module-Kestrel configuration and less likely within the app itself.</span></span>

<span data-ttu-id="2688e-316">Один из способов определить, правильно ли работает обратный прокси-сервер между службами IIS и сервером Kestrel, — выполнить простой запрос статического файла, которым может быть таблица стилей, скрипт или изображение из каталога *wwwroot*, с помощью [ПО промежуточного слоя для статических файлов](xref:fundamentals/static-files).</span><span class="sxs-lookup"><span data-stu-id="2688e-316">One way to determine if the IIS reverse proxy to the Kestrel server is working properly is to perform a simple static file request for a stylesheet, script, or image from the app's static files in *wwwroot* using [Static File middleware](xref:fundamentals/static-files).</span></span> <span data-ttu-id="2688e-317">Если приложение может предоставлять статические файлы, но представления MVC и другие конечные точки не работают, проблема, скорее всего, связана с самим приложением (например, маршрутизацией MVC или внутренней ошибкой сервера 500), а не с конфигурацией служб IIS, модуля ASP.NET Core и Kestrel.</span><span class="sxs-lookup"><span data-stu-id="2688e-317">If the app can serve static files but MVC Views and other endpoints are failing, the problem is less likely related to the IIS-ASP.NET Core Module-Kestrel configuration and more likely within the app itself (for example, MVC routing or 500 Internal Server Error).</span></span>

<span data-ttu-id="2688e-318">Если Kestrel нормально работает за службами IIS, но приложение не запускается в системе, хотя успешно выполняется локально, вы можете временно добавить в файл *web.config* переменную среды `ASPNETCORE_ENVIRONMENT` со значением `Development`.</span><span class="sxs-lookup"><span data-stu-id="2688e-318">When Kestrel starts normally behind IIS but the app won't run on the system after successfully running locally, you can temporarily add an environment variable to *web.config* to set the `ASPNETCORE_ENVIRONMENT` to `Development`.</span></span> <span data-ttu-id="2688e-319">Пока среда не переопределена в параметрах запуска приложения, при выполнении приложения в системе выводится [страница исключения для разработчика](xref:fundamentals/error-handling).</span><span class="sxs-lookup"><span data-stu-id="2688e-319">As long as you don't override the environment in app startup, this allows the [developer exception page](xref:fundamentals/error-handling) to appear when the app is run on the system.</span></span> <span data-ttu-id="2688e-320">Задавать таким образом переменную среды `ASPNETCORE_ENVIRONMENT` рекомендуется только в промежуточных и тестовых системах, доступ к которым из Интернета закрыт.</span><span class="sxs-lookup"><span data-stu-id="2688e-320">Setting the environment variable for `ASPNETCORE_ENVIRONMENT` in this way is only recommended for staging/testing systems that aren't exposed to the Internet.</span></span> <span data-ttu-id="2688e-321">По завершении обязательно удалите эту переменную среды из файла *web.config*.</span><span class="sxs-lookup"><span data-stu-id="2688e-321">Be sure you remove the environment variable from the *web.config* file when finished.</span></span> <span data-ttu-id="2688e-322">Сведения о задании переменных среды для обратного прокси-сервера с помощью файла *web.config* см. в разделе, посвященном [дочернему элементу environmentVariables aspNetCore](xref:hosting/aspnet-core-module#setting-environment-variables).</span><span class="sxs-lookup"><span data-stu-id="2688e-322">For information on setting environment variables via *web.config* for the reverse proxy, see [environmentVariables child element of aspNetCore](xref:hosting/aspnet-core-module#setting-environment-variables).</span></span>

<span data-ttu-id="2688e-323">В большинстве случаев включение журнала приложений помогает находить и устранять проблемы, связанные с приложением или обратным прокси-сервером.</span><span class="sxs-lookup"><span data-stu-id="2688e-323">In most cases, enabling application logging assists in troubleshooting problems with the app or the reverse proxy.</span></span> <span data-ttu-id="2688e-324">Дополнительные сведения см. в статье, посвященной [ведению журналов](xref:fundamentals/logging/index).</span><span class="sxs-lookup"><span data-stu-id="2688e-324">See [Logging](xref:fundamentals/logging/index) for more information.</span></span>

<span data-ttu-id="2688e-325">Последняя рекомендация по устранению неполадок касается приложений, которые не запускаются после обновления пакета SDK для .NET Core на компьютере разработки или версий пакета в приложении.</span><span class="sxs-lookup"><span data-stu-id="2688e-325">Our last troubleshooting tip pertains to apps that fail to run after upgrading either the .NET Core SDK on the development machine or package versions within the app.</span></span> <span data-ttu-id="2688e-326">В некоторых случаях в результате важного обновления несогласованные версии пакетов могут привести к нарушению работы приложения.</span><span class="sxs-lookup"><span data-stu-id="2688e-326">In some cases, incoherent packages may break an app when performing major upgrades.</span></span> <span data-ttu-id="2688e-327">Большинство таких неполадок можно устранить, удалив папки `bin` и `obj` из проекта, очистив кэши пакетов в каталогах `%UserProfile%\.nuget\packages\` и `%LocalAppData%\Nuget\v3-cache`, восстановив проект и полностью удалив предыдущее развертывание в системе перед повторным развертыванием приложения.</span><span class="sxs-lookup"><span data-stu-id="2688e-327">You can fix most of these issues by deleting the `bin` and `obj` folders in the project, clearing package caches at `%UserProfile%\.nuget\packages\` and `%LocalAppData%\Nuget\v3-cache`, restoring the project, and confirming that your prior deployment on the system has been completely deleted prior to re-deploying the app.</span></span>

> [!TIP]
> <span data-ttu-id="2688e-328">Чтобы упростить очистку кэшей пакетов, можно получить средство *NuGet.exe* с сайта [NuGet.org](https://www.nuget.org/), добавить его в каталог PATH системы и выполнить в командной строке команду `nuget locals all -clear`.</span><span class="sxs-lookup"><span data-stu-id="2688e-328">A convenient way to clear package caches is to obtain the *NuGet.exe* tool from [NuGet.org](https://www.nuget.org/), add it to your system PATH, and execute `nuget locals all -clear` from a command prompt.</span></span> <span data-ttu-id="2688e-329">Также можно выполнить команду `dotnet nuget locals all --clear` из командной строки без получения *NuGet.exe*.</span><span class="sxs-lookup"><span data-stu-id="2688e-329">You can also execute the `dotnet nuget locals all --clear` command from a command prompt without obtaining *NuGet.exe*.</span></span>

## <a name="common-errors"></a><span data-ttu-id="2688e-330">Распространенные ошибки</span><span class="sxs-lookup"><span data-stu-id="2688e-330">Common errors</span></span>

<span data-ttu-id="2688e-331">Приведенный ниже перечень ошибок не является исчерпывающим.</span><span class="sxs-lookup"><span data-stu-id="2688e-331">The following isn't a complete list of errors.</span></span> <span data-ttu-id="2688e-332">Если у вас возникла другая ошибка, приведите сообщение о ней в разделе комментариев ниже.</span><span class="sxs-lookup"><span data-stu-id="2688e-332">Should you encounter an error not listed here, please leave a detailed error message in the comments section below.</span></span>

### <a name="installer-unable-to-obtain-vc-redistributable"></a><span data-ttu-id="2688e-333">Установщику не удается получить распространяемый компонент VC++</span><span class="sxs-lookup"><span data-stu-id="2688e-333">Installer unable to obtain VC++ Redistributable</span></span>

* <span data-ttu-id="2688e-334">**Исключение установщика:** 0x80072efd or 0x80072f76 — неопределенная ошибка</span><span class="sxs-lookup"><span data-stu-id="2688e-334">**Installer Exception:** 0x80072efd or 0x80072f76 - Unspecified error</span></span>

* <span data-ttu-id="2688e-335">**Исключение журнала установщика&#8224;:** ошибка 0x80072efd или 0x80072f76: не удалось выполнить пакет EXE</span><span class="sxs-lookup"><span data-stu-id="2688e-335">**Installer Log Exception&#8224;:** Error 0x80072efd or 0x80072f76: Failed to execute EXE package</span></span>

  <span data-ttu-id="2688e-336">&#8224;Журнал находится в папке C:\Users\\{ПОЛЬЗОВАТЕЛЬ}\AppData\Local\Temp\dd_DotNetCoreWinSvrHosting__{метка_времени}.log.</span><span class="sxs-lookup"><span data-stu-id="2688e-336">&#8224;The log is located at C:\Users\\{USER}\AppData\Local\Temp\dd_DotNetCoreWinSvrHosting__{timestamp}.log.</span></span>

<span data-ttu-id="2688e-337">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="2688e-337">Troubleshooting:</span></span>

* <span data-ttu-id="2688e-338">Если при установке пакета размещения сервера у системы нет доступа к Интернету, это исключение возникает, когда у установщика нет возможности получить *Распространяемый компонент Microsoft Visual C++ 2015*.</span><span class="sxs-lookup"><span data-stu-id="2688e-338">If the system doesn't have Internet access while installing the server hosting bundle, this exception occurs when the installer is prevented from obtaining the *Microsoft Visual C++ 2015 Redistributable*.</span></span> <span data-ttu-id="2688e-339">Получить установщик можно в [Центре загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=53840).</span><span class="sxs-lookup"><span data-stu-id="2688e-339">You may obtain an installer from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=53840).</span></span> <span data-ttu-id="2688e-340">Если работа установщика завершается сбоем, возможно, вы не сможете получить среду выполнения .NET Core, необходимую для размещения зависимых от платформы развертываний (FDD).</span><span class="sxs-lookup"><span data-stu-id="2688e-340">If the installer fails, you may not receive the .NET Core runtime required to host a framework-dependent deployment (FDD).</span></span> <span data-ttu-id="2688e-341">Если вы планируете размещать зависимые от платформы развертывания, убедитесь в том, что среда выполнения установлена, в окне "Программы и компоненты".</span><span class="sxs-lookup"><span data-stu-id="2688e-341">If you plan to host an FDD, confirm that the runtime is installed in Programs &amp; Features.</span></span> <span data-ttu-id="2688e-342">Получить установщик среды выполнения можно на [странице загрузки .NET](https://www.microsoft.com/net/download/core).</span><span class="sxs-lookup"><span data-stu-id="2688e-342">You may obtain a runtime installer from [.NET Downloads](https://www.microsoft.com/net/download/core).</span></span> <span data-ttu-id="2688e-343">После установки среды выполнения перезагрузите систему или перезапустите службы IIS, выполнив в командной строке команду **net stop was /y**, а затем — команду **net start w3svc**.</span><span class="sxs-lookup"><span data-stu-id="2688e-343">After installing the runtime, restart the system or restart IIS by executing **net stop was /y** followed by **net start w3svc** from a command prompt.</span></span>

### <a name="os-upgrade-removed-the-32-bit-aspnet-core-module"></a><span data-ttu-id="2688e-344">При обновлении ОС был удален 32-разрядный модуль ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="2688e-344">OS upgrade removed the 32-bit ASP.NET Core Module</span></span>

* <span data-ttu-id="2688e-345">**Журнал приложений:** не удалось загрузить модуль DLL **C:\WINDOWS\system32\inetsrv\aspnetcore.dll**.</span><span class="sxs-lookup"><span data-stu-id="2688e-345">**Application Log:** The Module DLL **C:\WINDOWS\system32\inetsrv\aspnetcore.dll** failed to load.</span></span> <span data-ttu-id="2688e-346">Ошибочные данные.</span><span class="sxs-lookup"><span data-stu-id="2688e-346">The data is the error.</span></span>

<span data-ttu-id="2688e-347">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="2688e-347">Troubleshooting:</span></span>

* <span data-ttu-id="2688e-348">Не относящиеся к ОС файлы в каталоге **C:\Windows\SysWOW64\inetsrv** не сохраняются при обновлении ОС.</span><span class="sxs-lookup"><span data-stu-id="2688e-348">Non-OS files in the **C:\Windows\SysWOW64\inetsrv** directory aren't preserved during an OS upgrade.</span></span> <span data-ttu-id="2688e-349">Если вы установили модуль ASP.NET Core до обновления ОС, а после обновления пытаетесь запустить любой пул приложений в 32-разрядном режиме, возникает эта ошибка.</span><span class="sxs-lookup"><span data-stu-id="2688e-349">If you have the ASP.NET Core Module installed prior to an OS upgrade and then try to run any AppPool in 32-bit mode after an OS upgrade, you encounter this issue.</span></span> <span data-ttu-id="2688e-350">После обновления ОС восстановите модуль ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="2688e-350">After an OS upgrade, repair the ASP.NET Core Module.</span></span> <span data-ttu-id="2688e-351">См. раздел [Установка пакета размещения .NET Core для Windows Server](#install-the-net-core-windows-server-hosting-bundle).</span><span class="sxs-lookup"><span data-stu-id="2688e-351">See [Install the .NET Core Windows Server Hosting bundle](#install-the-net-core-windows-server-hosting-bundle).</span></span> <span data-ttu-id="2688e-352">При запуске установщика выберите вариант **Восстановить**.</span><span class="sxs-lookup"><span data-stu-id="2688e-352">Select **Repair** when you run the installer.</span></span>

### <a name="platform-conflicts-with-rid"></a><span data-ttu-id="2688e-353">Конфликты платформы с относительным идентификатором</span><span class="sxs-lookup"><span data-stu-id="2688e-353">Platform conflicts with RID</span></span>

* <span data-ttu-id="2688e-354">**Браузер:** ошибка HTTP 502.5 — сбой процесса</span><span class="sxs-lookup"><span data-stu-id="2688e-354">**Browser:** HTTP Error 502.5 - Process Failure</span></span>

* <span data-ttu-id="2688e-355">**Журнал приложений:** приложению MACHINE/WEBROOT/APPHOST/MY_APPLICATION с физическим корневым каталогом C:\{PATH}\' не удалось запустить процесс с помощью команды "C:\\{PATH}\my_application.{exe|dll}"; код ошибки = 0x80004005 : ff.</span><span class="sxs-lookup"><span data-stu-id="2688e-355">**Application Log:** Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\{PATH}\' failed to start process with commandline '"C:\\{PATH}\my_application.{exe|dll}" ', ErrorCode = '0x80004005 : ff.</span></span>

* <span data-ttu-id="2688e-356">**Журнал модуля ASP.NET Core:** необработанное исключение System.BadImageFormatException: не удалось загрузить файл или сборку my_application.dll.</span><span class="sxs-lookup"><span data-stu-id="2688e-356">**ASP.NET Core Module Log:** Unhandled Exception: System.BadImageFormatException: Could not load file or assembly 'my_application.dll'.</span></span> <span data-ttu-id="2688e-357">Была сделана попытка загрузить программу, имеющую неверный формат.</span><span class="sxs-lookup"><span data-stu-id="2688e-357">An attempt was made to load a program with an incorrect format.</span></span>

<span data-ttu-id="2688e-358">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="2688e-358">Troubleshooting:</span></span>

* <span data-ttu-id="2688e-359">Убедитесь в том, что приложение выполняется локально в Kestrel.</span><span class="sxs-lookup"><span data-stu-id="2688e-359">Confirm that the application runs locally on Kestrel.</span></span> <span data-ttu-id="2688e-360">Сбой процесса может быть результатом проблемы в приложении.</span><span class="sxs-lookup"><span data-stu-id="2688e-360">A process failure might be the result of a problem within the application.</span></span> <span data-ttu-id="2688e-361">Дополнительные сведения см. в разделе [Советы по устранению неполадок](#troubleshooting-tips).</span><span class="sxs-lookup"><span data-stu-id="2688e-361">For more information, see [Troubleshooting tips](#troubleshooting-tips).</span></span>

* <span data-ttu-id="2688e-362">Убедитесь в том, что в файле *CSPROJ* не задано значение `<PlatformTarget>`, конфликтующее с относительным идентификатором (RID).</span><span class="sxs-lookup"><span data-stu-id="2688e-362">Confirm that you didn't set a `<PlatformTarget>` in your *.csproj* that conflicts with the RID.</span></span> <span data-ttu-id="2688e-363">Например, не указывайте `<PlatformTarget>` со значением `x86`, если вы выполняете публикацию с идентификатором RID `win10-x64` с помощью команды *dotnet publish -c Release -r win10-x64* или задавая `<RuntimeIdentifiers>` в файле *CSPROJ* равным `win10-x64`.</span><span class="sxs-lookup"><span data-stu-id="2688e-363">For example, don't specify a `<PlatformTarget>` of `x86` and publish with an RID of `win10-x64`, either by using *dotnet publish -c Release -r win10-x64* or by setting the `<RuntimeIdentifiers>` in your *.csproj* to `win10-x64`.</span></span> <span data-ttu-id="2688e-364">Проект публикуется без предупреждения или сообщения об ошибке, но при запуске в системе происходит сбой, а в журнале регистрируются указанные выше исключения.</span><span class="sxs-lookup"><span data-stu-id="2688e-364">The project publishes without warning or error but fails with the above logged exceptions on the system.</span></span>

* <span data-ttu-id="2688e-365">Если это исключение возникает для развертывания приложений Azure при обновлении приложения и развертывании более новых сборок, вручную удалите все файлы предыдущего развертывания.</span><span class="sxs-lookup"><span data-stu-id="2688e-365">If this exception occurs for an Azure Apps deployment when upgrading an application and deploying newer assemblies, manually delete all files from the prior deployment.</span></span> <span data-ttu-id="2688e-366">Если останутся несовместимые сборки, то при развертывании обновленного приложения это может привести к исключению `System.BadImageFormatException`.</span><span class="sxs-lookup"><span data-stu-id="2688e-366">Lingering incompatible assemblies can result in a `System.BadImageFormatException` exception when deploying an upgraded app.</span></span>

### <a name="uri-endpoint-wrong-or-stopped-website"></a><span data-ttu-id="2688e-367">Неправильная конечная точка URI, либо веб-сайт остановлен</span><span class="sxs-lookup"><span data-stu-id="2688e-367">URI endpoint wrong or stopped website</span></span>

* <span data-ttu-id="2688e-368">**Браузер:** ERR_CONNECTION_REFUSED</span><span class="sxs-lookup"><span data-stu-id="2688e-368">**Browser:** ERR_CONNECTION_REFUSED</span></span>

* <span data-ttu-id="2688e-369">**Журнал приложений:** нет записи</span><span class="sxs-lookup"><span data-stu-id="2688e-369">**Application Log:** No entry</span></span>

* <span data-ttu-id="2688e-370">**Журнал модуля ASP.NET Core:** файл журнала не создан</span><span class="sxs-lookup"><span data-stu-id="2688e-370">**ASP.NET Core Module Log:** Log file not created</span></span>

<span data-ttu-id="2688e-371">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="2688e-371">Troubleshooting:</span></span>

* <span data-ttu-id="2688e-372">Убедитесь в том, что для приложения используется правильная конечная точка URI.</span><span class="sxs-lookup"><span data-stu-id="2688e-372">Confirm you are using the correct URI endpoint for the application.</span></span> <span data-ttu-id="2688e-373">Проверьте привязки.</span><span class="sxs-lookup"><span data-stu-id="2688e-373">Check your bindings.</span></span>

* <span data-ttu-id="2688e-374">Проверьте, не находится ли веб-сайт IIS в состоянии *Остановлен*.</span><span class="sxs-lookup"><span data-stu-id="2688e-374">Confirm that the IIS website is not in the *Stopped* state.</span></span>

### <a name="corewebengine-or-w3svc-server-features-disabled"></a><span data-ttu-id="2688e-375">Компонент сервера CoreWebEngine или W3SVC отключен</span><span class="sxs-lookup"><span data-stu-id="2688e-375">CoreWebEngine or W3SVC server features disabled</span></span>

* <span data-ttu-id="2688e-376">**Исключение ОС:** для использования модуля ASP.NET Core должны быть установлены компоненты IIS 7.0 CoreWebEngine и W3SVC.</span><span class="sxs-lookup"><span data-stu-id="2688e-376">**OS Exception:** The IIS 7.0 CoreWebEngine and W3SVC features must be installed to use the ASP.NET Core Module.</span></span>

<span data-ttu-id="2688e-377">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="2688e-377">Troubleshooting:</span></span>

* <span data-ttu-id="2688e-378">Убедитесь в том, что включена соответствующая роль и компоненты.</span><span class="sxs-lookup"><span data-stu-id="2688e-378">Confirm that you have enabled the proper role and features.</span></span> <span data-ttu-id="2688e-379">См. раздел [Конфигурация IIS](#iis-configuration).</span><span class="sxs-lookup"><span data-stu-id="2688e-379">See [IIS Configuration](#iis-configuration).</span></span>

### <a name="incorrect-website-physical-path-or-application-missing"></a><span data-ttu-id="2688e-380">Неправильный физический путь к веб-сайту, либо отсутствует приложение</span><span class="sxs-lookup"><span data-stu-id="2688e-380">Incorrect website physical path or application missing</span></span>

* <span data-ttu-id="2688e-381">**Браузер:** 403 — запрещено. В доступе отказано **--ИЛИ--** 403.14 — запрещено. Веб-сервер настроен таким образом, чтобы не формировать список содержимого каталога.</span><span class="sxs-lookup"><span data-stu-id="2688e-381">**Browser:** 403 Forbidden - Access is denied **--OR--** 403.14 Forbidden - The Web server is configured to not list the contents of this directory.</span></span>

* <span data-ttu-id="2688e-382">**Журнал приложений:** нет записи</span><span class="sxs-lookup"><span data-stu-id="2688e-382">**Application Log:** No entry</span></span>

* <span data-ttu-id="2688e-383">**Журнал модуля ASP.NET Core:** файл журнала не создан</span><span class="sxs-lookup"><span data-stu-id="2688e-383">**ASP.NET Core Module Log:** Log file not created</span></span>

<span data-ttu-id="2688e-384">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="2688e-384">Troubleshooting:</span></span>

* <span data-ttu-id="2688e-385">Проверьте **основные настройки** веб-сайта IIS и физическую папку приложения.</span><span class="sxs-lookup"><span data-stu-id="2688e-385">Check the IIS website **Basic Settings** and the physical application folder.</span></span> <span data-ttu-id="2688e-386">Убедитесь в том, что приложение находится в папке по **физическому пути** веб-сайта IIS.</span><span class="sxs-lookup"><span data-stu-id="2688e-386">Confirm that the application is in the folder at the IIS website **Physical path**.</span></span>

### <a name="incorrect-role-module-not-installed-or-incorrect-permissions"></a><span data-ttu-id="2688e-387">Неправильная роль, модуль не установлен либо неверные разрешения</span><span class="sxs-lookup"><span data-stu-id="2688e-387">Incorrect role, module not installed, or incorrect permissions</span></span>

* <span data-ttu-id="2688e-388">**Браузер:** 500.19 — внутренняя ошибка сервера. Запрашиваемая страница недоступна из-за неверной конфигурации данных для этой страницы.</span><span class="sxs-lookup"><span data-stu-id="2688e-388">**Browser:** 500.19 Internal Server Error - The requested page cannot be accessed because the related configuration data for the page is invalid.</span></span>

* <span data-ttu-id="2688e-389">**Журнал приложений:** нет записи</span><span class="sxs-lookup"><span data-stu-id="2688e-389">**Application Log:** No entry</span></span>

* <span data-ttu-id="2688e-390">**Журнал модуля ASP.NET Core:** файл журнала не создан</span><span class="sxs-lookup"><span data-stu-id="2688e-390">**ASP.NET Core Module Log:** Log file not created</span></span>

<span data-ttu-id="2688e-391">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="2688e-391">Troubleshooting:</span></span>

* <span data-ttu-id="2688e-392">Убедитесь в том, что включена соответствующая роль.</span><span class="sxs-lookup"><span data-stu-id="2688e-392">Confirm that you've enabled the proper role.</span></span> <span data-ttu-id="2688e-393">См. раздел [Конфигурация IIS](#iis-configuration).</span><span class="sxs-lookup"><span data-stu-id="2688e-393">See [IIS Configuration](#iis-configuration).</span></span>

* <span data-ttu-id="2688e-394">На странице **Программы и компоненты** убедитесь в том, что установлен **модуль Microsoft ASP.NET Core**.</span><span class="sxs-lookup"><span data-stu-id="2688e-394">Check **Programs &amp; Features** and confirm that the **Microsoft ASP.NET Core Module** has been installed.</span></span> <span data-ttu-id="2688e-395">Если **модуль Microsoft ASP.NET Core** отсутствует в списке установленных программ, установите его.</span><span class="sxs-lookup"><span data-stu-id="2688e-395">If the **Microsoft ASP.NET Core Module** isn't present in the list of installed programs, install the module.</span></span> <span data-ttu-id="2688e-396">См. раздел [Установка пакета размещения .NET Core для Windows Server](#install-the-net-core-windows-server-hosting-bundle).</span><span class="sxs-lookup"><span data-stu-id="2688e-396">See [Install the .NET Core Windows Server Hosting bundle](#install-the-net-core-windows-server-hosting-bundle).</span></span>

* <span data-ttu-id="2688e-397">Убедитесь, что параметр **Пул приложений** > **Модель процесса** > **Удостоверение** имеет значение **ApplicationPoolIdentity** или что у пользовательского удостоверения есть нужные разрешения на доступ к папке развертывания приложения.</span><span class="sxs-lookup"><span data-stu-id="2688e-397">Make sure that the **Application Pool** > **Process Model** > **Identity** is set to **ApplicationPoolIdentity** or your custom identity has the correct permissions to access the app's deployment folder.</span></span>

### <a name="incorrect-processpath-missing-path-variable-hosting-bundle-not-installed-systemiis-not-restarted-vc-redistributable-not-installed-or-dotnetexe-access-violation"></a><span data-ttu-id="2688e-398">Неправильное значение processPath, отсутствует переменная PATH, пакет размещения не установлен, система или службы IIS не перезапущены, не установлен распространяемый компонент VC++ либо нарушены права доступа к dotnet.exe</span><span class="sxs-lookup"><span data-stu-id="2688e-398">Incorrect processPath, missing PATH variable, hosting bundle not installed, system/IIS not restarted, VC++ Redistributable not installed, or dotnet.exe access violation</span></span>

* <span data-ttu-id="2688e-399">**Браузер:** ошибка HTTP 502.5 — сбой процесса</span><span class="sxs-lookup"><span data-stu-id="2688e-399">**Browser:** HTTP Error 502.5 - Process Failure</span></span>

* <span data-ttu-id="2688e-400">**Журнал приложений:** приложению MACHINE/WEBROOT/APPHOST/MY_APPLICATION с физическим корневым каталогом C:\\{PATH}\' не удалось запустить процесс с помощью команды ".\my_application.exe"; код ошибки = 0x80070002 : 0.</span><span class="sxs-lookup"><span data-stu-id="2688e-400">**Application Log:** Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\\{PATH}\' failed to start process with commandline '".\my_application.exe" ', ErrorCode = '0x80070002 : 0.</span></span>

* <span data-ttu-id="2688e-401">**Журнал модуля ASP.NET Core:** файл журнала создан, но пуст</span><span class="sxs-lookup"><span data-stu-id="2688e-401">**ASP.NET Core Module Log:** Log file created but empty</span></span>

<span data-ttu-id="2688e-402">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="2688e-402">Troubleshooting:</span></span>

* <span data-ttu-id="2688e-403">Убедитесь в том, что приложение выполняется локально в Kestrel.</span><span class="sxs-lookup"><span data-stu-id="2688e-403">Confirm that the application runs locally on Kestrel.</span></span> <span data-ttu-id="2688e-404">Сбой процесса может быть результатом проблемы в приложении.</span><span class="sxs-lookup"><span data-stu-id="2688e-404">A process failure might be the result of a problem within the application.</span></span> <span data-ttu-id="2688e-405">Дополнительные сведения см. в разделе [Советы по устранению неполадок](#troubleshooting-tips).</span><span class="sxs-lookup"><span data-stu-id="2688e-405">For more information, see [Troubleshooting tips](#troubleshooting-tips).</span></span>

* <span data-ttu-id="2688e-406">Проверьте атрибут *processPath* элемента `<aspNetCore>` в файле *web.config*. Он должен иметь значение *dotnet* для зависимого от платформы развертывания (FDD) или *.\my_application.exe* для автономного развертывания (SCD).</span><span class="sxs-lookup"><span data-stu-id="2688e-406">Check the *processPath* attribute on the `<aspNetCore>` element in *web.config* to confirm that it's *dotnet* for a framework-dependent deployment (FDD) or *.\my_application.exe* for a self-contained deployment (SCD).</span></span>

* <span data-ttu-id="2688e-407">Для зависимого от платформы развертывания файл *dotnet.exe* может быть недоступен по пути, указанному в переменной PATH.</span><span class="sxs-lookup"><span data-stu-id="2688e-407">For an FDD, *dotnet.exe* might not be accessible via the PATH settings.</span></span> <span data-ttu-id="2688e-408">Убедитесь в том, что папка *C:\Program Files\dotnet\* существует в системных параметрах PATH.</span><span class="sxs-lookup"><span data-stu-id="2688e-408">Confirm that *C:\Program Files\dotnet\* exists in the System PATH settings.</span></span>

* <span data-ttu-id="2688e-409">В случае с зависимым от платформы развертыванием файл *dotnet.exe* может быть недоступен для удостоверения пользователя, используемого для пула приложений.</span><span class="sxs-lookup"><span data-stu-id="2688e-409">For an FDD, *dotnet.exe* might not be accessible for the user identity of the Application Pool.</span></span> <span data-ttu-id="2688e-410">Убедитесь в том, что удостоверение пользователя AppPool имеет доступ к каталогу *C:\Program Files\dotnet*.</span><span class="sxs-lookup"><span data-stu-id="2688e-410">Confirm that the AppPool user identity has access to the *C:\Program Files\dotnet* directory.</span></span> <span data-ttu-id="2688e-411">Убедитесь в отсутствии запрещающих правил для удостоверения пользователя AppPool в каталоге *C:\Program Files\dotnet* и каталоге приложения.</span><span class="sxs-lookup"><span data-stu-id="2688e-411">Confirm that there are no deny rules configured for the AppPool user identity on the *C:\Program Files\dotnet* and application directories.</span></span>

* <span data-ttu-id="2688e-412">Возможно, вы произвели зависимое от платформы развертывание и установили .NET Core, не перезапустив после этого службы IIS.</span><span class="sxs-lookup"><span data-stu-id="2688e-412">You may have deployed an FDD and installed .NET Core without restarting IIS.</span></span> <span data-ttu-id="2688e-413">Перезагрузите сервер или перезапустите службы IIS, выполнив в командной строке команду **net stop was /y**, а затем — команду **net start w3svc**.</span><span class="sxs-lookup"><span data-stu-id="2688e-413">Either restart the server or restart IIS by executing **net stop was /y** followed by **net start w3svc** from a command prompt.</span></span>

* <span data-ttu-id="2688e-414">Возможно, вы произвели зависимое от платформы развертывание, не установив среду выполнения .NET Core в размещающей системе.</span><span class="sxs-lookup"><span data-stu-id="2688e-414">You may have deployed an FDD without installing the .NET Core runtime on the hosting system.</span></span> <span data-ttu-id="2688e-415">Если вы пытаетесь выполнить зависимое от платформы развертывание, не установив среду выполнения .NET Core, запустите в системе **установщик пакета размещения .NET Core для Windows Server**.</span><span class="sxs-lookup"><span data-stu-id="2688e-415">If you're attempting to deploy a FDD and haven't installed the .NET Core runtime, run the **.NET Core Windows Server Hosting bundle installer** on the system.</span></span> <span data-ttu-id="2688e-416">См. раздел [Установка пакета размещения .NET Core для Windows Server](#install-the-net-core-windows-server-hosting-bundle).</span><span class="sxs-lookup"><span data-stu-id="2688e-416">See [Install the .NET Core Windows Server Hosting bundle](#install-the-net-core-windows-server-hosting-bundle).</span></span> <span data-ttu-id="2688e-417">Если вы пытаетесь установить среду выполнения .NET Core в системе, не имеющей подключения к Интернету, получите среду выполнения на [странице скачивания .NET](https://www.microsoft.com/net/download/core) и запустите установщик пакета размещения, чтобы установить модуль ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="2688e-417">If you're attempting to install the .NET Core runtime on a system without an Internet connection, obtain the runtime from [.NET Downloads](https://www.microsoft.com/net/download/core) and run the hosting bundle installer to install the ASP.NET Core Module.</span></span> <span data-ttu-id="2688e-418">Завершите установку, перезагрузив систему или перезапустив службы IIS. Для этого выполните в командной строке команду **net stop was /y**, а затем — команду **net start w3svc**.</span><span class="sxs-lookup"><span data-stu-id="2688e-418">Complete the installation by restarting the system or restarting IIS by executing **net stop was /y** followed by **net start w3svc** from a command prompt.</span></span>

* <span data-ttu-id="2688e-419">Возможно, вы произвели зависимое от платформы развертывание и установили .NET Core, не перезапустив после этого систему или службы IIS.</span><span class="sxs-lookup"><span data-stu-id="2688e-419">You may have deployed an FDD and installed .NET Core without restarting the system/IIS.</span></span> <span data-ttu-id="2688e-420">Перезагрузите систему или перезапустите службы IIS, выполнив в командной строке команду **net stop was /y**, а затем — команду **net start w3svc**.</span><span class="sxs-lookup"><span data-stu-id="2688e-420">Either restart the system or restart IIS by executing **net stop was /y** followed by **net start w3svc** from a command prompt.</span></span>

* <span data-ttu-id="2688e-421">Возможно, вы произвели зависимое от платформы развертывание, не установив в системе *Распространяемый компонент Microsoft Visual C++ 2015 (64-разрядный)*.</span><span class="sxs-lookup"><span data-stu-id="2688e-421">You may have deployed an FDD and the *Microsoft Visual C++ 2015 Redistributable (x64)* is not installed on the system.</span></span> <span data-ttu-id="2688e-422">Получить установщик можно в [Центре загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=53840).</span><span class="sxs-lookup"><span data-stu-id="2688e-422">You may obtain an installer from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=53840).</span></span>

### <a name="incorrect-arguments-of-aspnetcore-element"></a><span data-ttu-id="2688e-423">Неверные аргументы элемента \<aspNetCore\></span><span class="sxs-lookup"><span data-stu-id="2688e-423">Incorrect arguments of \<aspNetCore\> element</span></span>

* <span data-ttu-id="2688e-424">**Браузер:** ошибка HTTP 502.5 — сбой процесса</span><span class="sxs-lookup"><span data-stu-id="2688e-424">**Browser:** HTTP Error 502.5 - Process Failure</span></span>

* <span data-ttu-id="2688e-425">**Журнал приложений:** приложению MACHINE/WEBROOT/APPHOST/MY_APPLICATION с физическим корневым каталогом C:\\{PATH}\' не удалось запустить процесс с помощью команды ""dotnet" \my_application.dll"; код ошибки = 0x80004005 : 80008081.</span><span class="sxs-lookup"><span data-stu-id="2688e-425">**Application Log:** Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\\{PATH}\' failed to start process with commandline '"dotnet" .\my_application.dll', ErrorCode = '0x80004005 : 80008081.</span></span>

* <span data-ttu-id="2688e-426">**Журнал модуля ASP.NET Core:** Выполняемое приложение не существует: "PATH\my_application.dll"</span><span class="sxs-lookup"><span data-stu-id="2688e-426">**ASP.NET Core Module Log:** The application to execute does not exist: 'PATH\my_application.dll'</span></span>

<span data-ttu-id="2688e-427">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="2688e-427">Troubleshooting:</span></span>

* <span data-ttu-id="2688e-428">Убедитесь в том, что приложение выполняется локально в Kestrel.</span><span class="sxs-lookup"><span data-stu-id="2688e-428">Confirm that the application runs locally on Kestrel.</span></span> <span data-ttu-id="2688e-429">Сбой процесса может быть результатом проблемы в приложении.</span><span class="sxs-lookup"><span data-stu-id="2688e-429">A process failure might be the result of a problem within the application.</span></span> <span data-ttu-id="2688e-430">Дополнительные сведения см. в разделе [Советы по устранению неполадок](#troubleshooting-tips).</span><span class="sxs-lookup"><span data-stu-id="2688e-430">For more information, see [Troubleshooting tips](#troubleshooting-tips).</span></span>

* <span data-ttu-id="2688e-431">Проверьте атрибут *arguments* элемента `<aspNetCore>` в файле *web.config* и удостоверьтесь, что его значение: а) имеет вид *.\my_application.dll* для развертывания, зависящего от платформы (FDD); б) отсутствует, содержит пустую строку (*arguments=""*) или список аргументов вашего приложения (*arguments="arg1, arg2, ..."*) для автономного развертывания (SCD).</span><span class="sxs-lookup"><span data-stu-id="2688e-431">Examine the *arguments* attribute on the `<aspNetCore>` element in *web.config* to confirm that it is either (a) *.\my_application.dll* for a framework-dependent deployment (FDD); or (b) not present, an empty string (*arguments=""*), or a list of your app's arguments (*arguments="arg1, arg2, ..."*) for a self-contained deployment (SCD).</span></span>

### <a name="missing-net-framework-version"></a><span data-ttu-id="2688e-432">Отсутствует версия платформы .NET Framework</span><span class="sxs-lookup"><span data-stu-id="2688e-432">Missing .NET Framework version</span></span>

* <span data-ttu-id="2688e-433">**Браузер:** 502.3 — неверный шлюз. При попытке маршрутизации запроса произошла ошибка подключения.</span><span class="sxs-lookup"><span data-stu-id="2688e-433">**Browser:** 502.3 Bad Gateway - There was a connection error while trying to route the request.</span></span>

* <span data-ttu-id="2688e-434">**Журнал приложений:** Код ошибки = приложению MACHINE/WEBROOT/APPHOST/MY_APPLICATION с физическим корневым каталогом C:\\{PATH}\' не удалось запустить процесс с помощью команды ""dotnet" \my_application.dll"; код ошибки = 0x80004005 : 80008081.</span><span class="sxs-lookup"><span data-stu-id="2688e-434">**Application Log:** ErrorCode = Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\\{PATH}\' failed to start process with commandline '"dotnet" .\my_application.dll', ErrorCode = '0x80004005 : 80008081.</span></span>

* <span data-ttu-id="2688e-435">**Журнал модуля ASP.NET Core:** Исключение из-за отсутствия метода, файла или сборки.</span><span class="sxs-lookup"><span data-stu-id="2688e-435">**ASP.NET Core Module Log:** Missing method, file, or assembly exception.</span></span> <span data-ttu-id="2688e-436">Метод, файл или сборка, указанные в исключении, представляют собой метод, файл или сборку .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="2688e-436">The method, file, or assembly specified in the exception is a .NET Framework method, file, or assembly.</span></span>

<span data-ttu-id="2688e-437">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="2688e-437">Troubleshooting:</span></span>

* <span data-ttu-id="2688e-438">Установите версию .NET Framework, отсутствующую в системе.</span><span class="sxs-lookup"><span data-stu-id="2688e-438">Install the .NET Framework version missing from the system.</span></span>

* <span data-ttu-id="2688e-439">В случае с зависимым от платформы развертыванием (FDD) убедитесь в том, что в системе установлена нужная среда выполнения.</span><span class="sxs-lookup"><span data-stu-id="2688e-439">For a framework-dependent deployment (FDD), confirm that you have the correct runtime installed on the system.</span></span> <span data-ttu-id="2688e-440">Если вы обновляете проект с версии 1.1 до версии 2.0, развертываете его в размещающей системе, а затем получаете это исключение, проверьте, установлена ли в системе платформа версии 2.0.</span><span class="sxs-lookup"><span data-stu-id="2688e-440">If you upgrade a project from 1.1 to 2.0, deploy to the hosting system, and receive this exception, ensure you install the 2.0 framework on the hosting system.</span></span>

### <a name="stopped-application-pool"></a><span data-ttu-id="2688e-441">Пул приложений остановлен</span><span class="sxs-lookup"><span data-stu-id="2688e-441">Stopped Application Pool</span></span>

* <span data-ttu-id="2688e-442">**Браузер:** 503 — служба недоступна</span><span class="sxs-lookup"><span data-stu-id="2688e-442">**Browser:** 503 Service Unavailable</span></span>

* <span data-ttu-id="2688e-443">**Журнал приложений:** нет записи</span><span class="sxs-lookup"><span data-stu-id="2688e-443">**Application Log:** No entry</span></span>

* <span data-ttu-id="2688e-444">**Журнал модуля ASP.NET Core:** файл журнала не создан</span><span class="sxs-lookup"><span data-stu-id="2688e-444">**ASP.NET Core Module Log:** Log file not created</span></span>

<span data-ttu-id="2688e-445">Устранение неполадок</span><span class="sxs-lookup"><span data-stu-id="2688e-445">Troubleshooting</span></span>

* <span data-ttu-id="2688e-446">Проверьте, не находится ли пул приложений в состоянии *Остановлен*.</span><span class="sxs-lookup"><span data-stu-id="2688e-446">Confirm that the Application Pool is not in the *Stopped* state.</span></span>

### <a name="iis-integration-middleware-not-implemented"></a><span data-ttu-id="2688e-447">ПО промежуточного слоя для интеграции IIS не внедрено</span><span class="sxs-lookup"><span data-stu-id="2688e-447">IIS Integration middleware not implemented</span></span>

* <span data-ttu-id="2688e-448">**Браузер:** ошибка HTTP 502.5 — сбой процесса</span><span class="sxs-lookup"><span data-stu-id="2688e-448">**Browser:** HTTP Error 502.5 - Process Failure</span></span>

* <span data-ttu-id="2688e-449">**Журнал приложений:** приложение MACHINE/WEBROOT/APPHOST/MY_APPLICATION с физическим корневым каталогом C:\\{PATH}\' создало процесс с помощью команды "C:\\{PATH}\my_application.{exe|dll}", однако при этом либо произошел сбой, либо не был получен ответ, либо не прослушивался указанный порт {PORT}; код ошибки = 0x800705b4</span><span class="sxs-lookup"><span data-stu-id="2688e-449">**Application Log:** Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\\{PATH}\' created process with commandline '"C:\\{PATH}\my_application.{exe|dll}" ' but either crashed or did not reponse or did not listen on the given port '{PORT}', ErrorCode = '0x800705b4'</span></span>

* <span data-ttu-id="2688e-450">**Журнал модуля ASP.NET Core:** файл журнала создан, и в нем нет сведений о неправильной работе.</span><span class="sxs-lookup"><span data-stu-id="2688e-450">**ASP.NET Core Module Log:** Log file created and shows normal operation.</span></span>

<span data-ttu-id="2688e-451">Устранение неполадок</span><span class="sxs-lookup"><span data-stu-id="2688e-451">Troubleshooting</span></span>

* <span data-ttu-id="2688e-452">Убедитесь в том, что приложение выполняется локально в Kestrel.</span><span class="sxs-lookup"><span data-stu-id="2688e-452">Confirm that the app runs locally on Kestrel.</span></span> <span data-ttu-id="2688e-453">Сбой процесса может быть результатом проблемы в приложении.</span><span class="sxs-lookup"><span data-stu-id="2688e-453">A process failure might be the result of a problem within the app.</span></span> <span data-ttu-id="2688e-454">Дополнительные сведения см. в разделе [Советы по устранению неполадок](#troubleshooting-tips).</span><span class="sxs-lookup"><span data-stu-id="2688e-454">For more information, see [Troubleshooting tips](#troubleshooting-tips).</span></span>

* <span data-ttu-id="2688e-455">Убедитесь в том, что вы правильно указали ПО промежуточного слоя для интеграции IIS, вызвав метод *.UseIISIntegration()* для объекта *WebHostBuilder()* приложения (ASP.NET Core 1.x), или использовали метод `CreateDefaultBuilder` (ASP.NET Core 2.x).</span><span class="sxs-lookup"><span data-stu-id="2688e-455">Confirm that you've correctly referenced the IIS Integration middleware by calling the *.UseIISIntegration()* method on the application's *WebHostBuilder()* (ASP.NET Core 1.x) or used the `CreateDefaultBuilder` method (ASP.NET Core 2.x).</span></span> <span data-ttu-id="2688e-456">Дополнительные сведения см. в статье [Размещение в ASP.NET Core](xref:fundamentals/hosting).</span><span class="sxs-lookup"><span data-stu-id="2688e-456">See [Hosting in ASP.NET Core](xref:fundamentals/hosting) for details.</span></span>

### <a name="sub-application-includes-a-handlers-section"></a><span data-ttu-id="2688e-457">Дочернее приложение имеет раздел \<handlers\></span><span class="sxs-lookup"><span data-stu-id="2688e-457">Sub-application includes a \<handlers\> section</span></span>

* <span data-ttu-id="2688e-458">**Браузер:** ошибка HTTP 500.19 — внутренняя ошибка сервера</span><span class="sxs-lookup"><span data-stu-id="2688e-458">**Browser:** HTTP Error 500.19 - Internal Server Error</span></span>

* <span data-ttu-id="2688e-459">**Журнал приложений:** нет записи</span><span class="sxs-lookup"><span data-stu-id="2688e-459">**Application Log:** No entry</span></span>

* <span data-ttu-id="2688e-460">**Журнал модуля ASP.NET Core:** файл журнала создан для корневого приложения, и в нем нет сведений о неправильной работе.</span><span class="sxs-lookup"><span data-stu-id="2688e-460">**ASP.NET Core Module Log:** Log file created and shows normal operation for the root application.</span></span> <span data-ttu-id="2688e-461">Файл журнала для дочернего приложения не создан.</span><span class="sxs-lookup"><span data-stu-id="2688e-461">Log file not created for the sub-application.</span></span>

<span data-ttu-id="2688e-462">Устранение неполадок</span><span class="sxs-lookup"><span data-stu-id="2688e-462">Troubleshooting</span></span>

* <span data-ttu-id="2688e-463">В файле *web.config* дочернего приложения не должно быть раздела `<handlers>`.</span><span class="sxs-lookup"><span data-stu-id="2688e-463">Confirm that the sub-app's *web.config* file doesn't include a `<handlers>` section.</span></span>

### <a name="application-configuration-general-issue"></a><span data-ttu-id="2688e-464">Общая проблема с конфигурацией приложения</span><span class="sxs-lookup"><span data-stu-id="2688e-464">Application configuration general issue</span></span>

* <span data-ttu-id="2688e-465">**Браузер:** ошибка HTTP 502.5 — сбой процесса</span><span class="sxs-lookup"><span data-stu-id="2688e-465">**Browser:** HTTP Error 502.5 - Process Failure</span></span>

* <span data-ttu-id="2688e-466">**Журнал приложений:** приложение MACHINE/WEBROOT/APPHOST/MY_APPLICATION с физическим корневым каталогом C:\\{PATH}\' создало процесс с помощью команды "C:\\{PATH}\my_application.{exe|dll}", однако при этом либо произошел сбой, либо не был получен ответ, либо не прослушивался указанный порт {PORT}; код ошибки = 0x800705b4</span><span class="sxs-lookup"><span data-stu-id="2688e-466">**Application Log:** Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\\{PATH}\' created process with commandline '"C:\\{PATH}\my_application.{exe|dll}" ' but either crashed or did not reponse or did not listen on the given port '{PORT}', ErrorCode = '0x800705b4'</span></span>

* <span data-ttu-id="2688e-467">**Журнал модуля ASP.NET Core:** файл журнала создан, но пуст</span><span class="sxs-lookup"><span data-stu-id="2688e-467">**ASP.NET Core Module Log:** Log file created but empty</span></span>

<span data-ttu-id="2688e-468">Устранение неполадок</span><span class="sxs-lookup"><span data-stu-id="2688e-468">Troubleshooting</span></span>

* <span data-ttu-id="2688e-469">Это общее исключение указывает на то, что процесс не удалось запустить, скорее всего, из-за проблемы с конфигурацией приложения.</span><span class="sxs-lookup"><span data-stu-id="2688e-469">This general exception indicates that the process failed to start, most likely due to an application configuration issue.</span></span> <span data-ttu-id="2688e-470">Обратитесь к статье [Структура каталогов](xref:hosting/directory-structure) и убедитесь в том, что развернуты надлежащие файлы и папки приложения, имеются его файлы конфигурации и в них содержатся правильные параметры для приложения и среды.</span><span class="sxs-lookup"><span data-stu-id="2688e-470">Referring to [Directory Structure](xref:hosting/directory-structure), confirm that your app's deployed files and folders are appropriate and that your app's configuration files are present and contain the correct settings for your app and environment.</span></span> <span data-ttu-id="2688e-471">Дополнительные сведения см. в разделе [Советы по устранению неполадок](#troubleshooting-tips).</span><span class="sxs-lookup"><span data-stu-id="2688e-471">For more information, see [Troubleshooting tips](#troubleshooting-tips).</span></span>

## <a name="resources"></a><span data-ttu-id="2688e-472">Ресурсы</span><span class="sxs-lookup"><span data-stu-id="2688e-472">Resources</span></span>

* [<span data-ttu-id="2688e-473">Введение в модуль ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="2688e-473">Introduction to ASP.NET Core Module</span></span>](xref:fundamentals/servers/aspnet-core-module)
* [<span data-ttu-id="2688e-474">Справочник по конфигурации модуля ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="2688e-474">ASP.NET Core Module configuration reference</span></span>](xref:hosting/aspnet-core-module)
* [<span data-ttu-id="2688e-475">Использование модулей IIS с ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="2688e-475">Using IIS Modules with ASP.NET Core</span></span>](xref:hosting/iis-modules)
* [<span data-ttu-id="2688e-476">Введение в ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="2688e-476">Introduction to ASP.NET Core</span></span>](../index.md)
* [<span data-ttu-id="2688e-477">Официальный веб-сайт Microsoft IIS</span><span class="sxs-lookup"><span data-stu-id="2688e-477">The Official Microsoft IIS Site</span></span>](https://www.iis.net/)
* [<span data-ttu-id="2688e-478">Библиотека Microsoft TechNet: Windows Server</span><span class="sxs-lookup"><span data-stu-id="2688e-478">Microsoft TechNet Library: Windows Server</span></span>](https://docs.microsoft.com/windows-server/windows-server-versions)
