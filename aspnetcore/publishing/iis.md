---
title: "Размещение ASP.NET Core в Windows со службами IIS"
author: guardrex
description: "Настройка служб IIS в Windows Server и развертывание приложений ASP.NET Core."
keywords: "ASP.NET Core, службы iis, iis, windows server, пакет размещения, модуль asp.net core, веб-развертывание"
ms.author: riande
manager: wpickett
ms.date: 03/13/2017
ms.topic: article
ms.assetid: a4449ad3-5bad-410c-afa7-dc32d832b552
ms.technology: aspnet
ms.prod: asp.net-core
uid: publishing/iis
ms.openlocfilehash: f506fc880e50aa2fdc772fd29b905dfad02cda2b
ms.sourcegitcommit: 8005eb4051e568d88ee58d48424f39916052e6e2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2017
---
# <a name="set-up-a-hosting-environment-for-aspnet-core-on-windows-with-iis-and-deploy-to-it"></a><span data-ttu-id="f84a1-104">Настройка среды размещения для ASP.NET Core в операционной системе Windows со службами IIS и развертывание в этой среде</span><span class="sxs-lookup"><span data-stu-id="f84a1-104">Set up a hosting environment for ASP.NET Core on Windows with IIS, and deploy to it</span></span>

<span data-ttu-id="f84a1-105">Авторы: [Люк Лэтэм](https://github.com/guardrex) (Luke Latham) и [Рик Андерсон](https://twitter.com/RickAndMSFT) (Rick Anderson)</span><span class="sxs-lookup"><span data-stu-id="f84a1-105">By [Luke Latham](https://github.com/guardrex) and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

## <a name="supported-operating-systems"></a><span data-ttu-id="f84a1-106">Поддерживаемые операционные системы</span><span class="sxs-lookup"><span data-stu-id="f84a1-106">Supported operating systems</span></span>

<span data-ttu-id="f84a1-107">Поддерживаются следующие операционные системы:</span><span class="sxs-lookup"><span data-stu-id="f84a1-107">The following operating systems are supported:</span></span>

* <span data-ttu-id="f84a1-108">Windows 7 и более поздних версий;</span><span class="sxs-lookup"><span data-stu-id="f84a1-108">Windows 7 and newer</span></span>

* <span data-ttu-id="f84a1-109">Windows Server 2008 R2 и более поздних версий.</span><span class="sxs-lookup"><span data-stu-id="f84a1-109">Windows Server 2008 R2 and newer&#8224;</span></span>

<span data-ttu-id="f84a1-110">&#8224;В принципе, конфигурация IIS, описываемая в этом документе, также применима при размещении приложений ASP.NET Core в службах IIS Nano Server, однако более точные инструкции см. в статье [ASP.NET Core со службами IIS в Nano Server](xref:tutorials/nano-server).</span><span class="sxs-lookup"><span data-stu-id="f84a1-110">&#8224;Conceptually, the IIS configuration described in this document also applies to hosting ASP.NET Core applications on Nano Server IIS, but refer to [ASP.NET Core with IIS on Nano Server](xref:tutorials/nano-server) for specific instructions.</span></span>

<span data-ttu-id="f84a1-111">[Сервер WebListener](xref:fundamentals/servers/weblistener) не будет работать в конфигурации обратного прокси-сервера со службами IIS.</span><span class="sxs-lookup"><span data-stu-id="f84a1-111">[WebListener server](xref:fundamentals/servers/weblistener) will not work in a reverse-proxy configuration with IIS.</span></span> <span data-ttu-id="f84a1-112">Необходимо использовать [сервер Kestrel](xref:fundamentals/servers/kestrel).</span><span class="sxs-lookup"><span data-stu-id="f84a1-112">You must use the [Kestrel server](xref:fundamentals/servers/kestrel).</span></span>

## <a name="iis-configuration"></a><span data-ttu-id="f84a1-113">Конфигурация IIS</span><span class="sxs-lookup"><span data-stu-id="f84a1-113">IIS configuration</span></span>

<span data-ttu-id="f84a1-114">Включите роль **Веб-сервер (IIS)** и создайте службы роли.</span><span class="sxs-lookup"><span data-stu-id="f84a1-114">Enable the **Web Server (IIS)** role and establish role services.</span></span>

### <a name="windows-desktop-operating-systems"></a><span data-ttu-id="f84a1-115">Операционные системы Windows для настольных компьютеров</span><span class="sxs-lookup"><span data-stu-id="f84a1-115">Windows desktop operating systems</span></span>

<span data-ttu-id="f84a1-116">Последовательно выберите **Панель управления > Программы > Программы и компоненты > Включение или отключение компонентов Windows** (в левой части экрана).</span><span class="sxs-lookup"><span data-stu-id="f84a1-116">Navigate to **Control Panel > Programs > Programs and Features > Turn Windows features on or off** (left side of the screen).</span></span> <span data-ttu-id="f84a1-117">Откройте группу **Службы IIS**, а затем — **Средства управления веб-сайтом**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-117">Open the group for **Internet Information Services** and **Web Management Tools**.</span></span> <span data-ttu-id="f84a1-118">Установите флажок **Консоль управления IIS**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-118">Check the box for **IIS Management Console**.</span></span> <span data-ttu-id="f84a1-119">Установите флажок **Службы Интернета**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-119">Check the box for **World Wide Web Services**.</span></span> <span data-ttu-id="f84a1-120">В группе **Службы Интернета** оставьте компоненты по умолчанию или настройте компоненты IIS согласно потребностям.</span><span class="sxs-lookup"><span data-stu-id="f84a1-120">Accept the default features for **World Wide Web Services** or customize the IIS features to suit your needs.</span></span>

![Группы "Консоль управления IIS" и "Службы Интернета" выбраны в окне "Компоненты Windows".](iis/_static/windows-features-win10.png)

### <a name="windows-server-operating-systems"></a><span data-ttu-id="f84a1-122">Операционные системы семейства Windows Server</span><span class="sxs-lookup"><span data-stu-id="f84a1-122">Windows Server operating systems</span></span>

<span data-ttu-id="f84a1-123">В серверной операционной системе используйте мастер **добавления ролей и компонентов**, который можно вызвать в меню **Управление** или по ссылке в **диспетчере сервера**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-123">For server operating systems, use the **Add Roles and Features** wizard via the **Manage** menu or the link in **Server Manager**.</span></span> <span data-ttu-id="f84a1-124">На этапе **Роли сервера** установите флажок **Веб-сервер (IIS)**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-124">On the **Server Roles** step, check the box for **Web Server (IIS)**.</span></span>

![Роль "Веб-сервер (IIS)" выбрана на странице "Выбор ролей сервера".](iis/_static/server-roles-ws2016.png)

<span data-ttu-id="f84a1-126">На этапе **Службы роли** выберите нужные службы роли IIS или оставьте службы по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="f84a1-126">On the **Role services** step, select the IIS role services you desire or accept the default role services provided.</span></span>

![Службы роли по умолчанию, выбранные на странице "Выбор служб ролей".](iis/_static/role-services-ws2016.png)

<span data-ttu-id="f84a1-128">Пройдите этап **Подтверждение**, чтобы установить роль и службы веб-сервера.</span><span class="sxs-lookup"><span data-stu-id="f84a1-128">Proceed through the **Confirmation** step to install the web server role and services.</span></span> <span data-ttu-id="f84a1-129">После установки роли "Веб-сервер (IIS)" перезагружать сервер или перезапускать службы IIS не требуется.</span><span class="sxs-lookup"><span data-stu-id="f84a1-129">A server/IIS restart is not required after installing the Web Server (IIS) role.</span></span>

## <a name="install-the-net-core-windows-server-hosting-bundle"></a><span data-ttu-id="f84a1-130">Установка пакета размещения .NET Core для Windows Server</span><span class="sxs-lookup"><span data-stu-id="f84a1-130">Install the .NET Core Windows Server Hosting bundle</span></span>

1. <span data-ttu-id="f84a1-131">Установите [пакет размещения .NET Core для Windows Server](https://aka.ms/dotnetcore.2.0.0-windowshosting) в размещающей системе.</span><span class="sxs-lookup"><span data-stu-id="f84a1-131">Install the [.NET Core Windows Server Hosting bundle](https://aka.ms/dotnetcore.2.0.0-windowshosting) on the hosting system.</span></span> <span data-ttu-id="f84a1-132">В составе пакета устанавливаются среда выполнения .NET Core, библиотека .NET Core и [модуль ASP.NET Core](xref:fundamentals/servers/aspnet-core-module).</span><span class="sxs-lookup"><span data-stu-id="f84a1-132">The bundle will install the .NET Core Runtime, .NET Core Library, and the [ASP.NET Core Module](xref:fundamentals/servers/aspnet-core-module).</span></span> <span data-ttu-id="f84a1-133">Модуль создает обратный прокси-сервер между службами IIS и сервером Kestrel.</span><span class="sxs-lookup"><span data-stu-id="f84a1-133">The module creates the reverse-proxy between IIS and the Kestrel server.</span></span> <span data-ttu-id="f84a1-134">Примечание. Если система не подключена к Интернету, перед установкой пакета размещения .NET Core для Windows Server получите и установите *[Распространяемый компонент Microsoft Visual C++ 2015](https://www.microsoft.com/download/details.aspx?id=53840)*.</span><span class="sxs-lookup"><span data-stu-id="f84a1-134">Note: If the system doesn't have an Internet connection, obtain and install the *[Microsoft Visual C++ 2015 Redistributable](https://www.microsoft.com/download/details.aspx?id=53840)* before installing the .NET Core Windows Server Hosting bundle.</span></span>

2. <span data-ttu-id="f84a1-135">Перезапустите систему или выполните в командной строке команду **net stop was /y**, а затем команду **net start w3svc**, чтобы изменение системной переменной PATH вступило в силу.</span><span class="sxs-lookup"><span data-stu-id="f84a1-135">Restart the system or execute **net stop was /y** followed by **net start w3svc** from a command prompt to pick up a change to the system PATH.</span></span>

> [!NOTE]
> <span data-ttu-id="f84a1-136">Если вы используете общую конфигурацию IIS, см. раздел [Модуль ASP.NET Core с общей конфигурацией IIS](xref:hosting/aspnet-core-module#aspnet-core-module-with-an-iis-shared-configuration).</span><span class="sxs-lookup"><span data-stu-id="f84a1-136">If you use an IIS Shared Configuration, see [ASP.NET Core Module with IIS Shared Configuration](xref:hosting/aspnet-core-module#aspnet-core-module-with-an-iis-shared-configuration).</span></span>

## <a name="install-web-deploy-when-publishing-with-visual-studio"></a><span data-ttu-id="f84a1-137">Установка веб-развертывания при публикации с помощью Visual Studio</span><span class="sxs-lookup"><span data-stu-id="f84a1-137">Install Web Deploy when publishing with Visual Studio</span></span>

<span data-ttu-id="f84a1-138">Если вы планируете развертывать приложения с помощью веб-развертывания в Visual Studio, установите последнюю версию веб-развертывания в размещающей системе.</span><span class="sxs-lookup"><span data-stu-id="f84a1-138">If you intend to deploy your applications with Web Deploy in Visual Studio, install the latest version of Web Deploy on the hosting system.</span></span> <span data-ttu-id="f84a1-139">Чтобы установить веб-развертывание, можно использовать [установщик веб-платформы (WebPI)](https://www.microsoft.com/web/downloads/platform.aspx) или получить установщик непосредственно в [Центре загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=43717).</span><span class="sxs-lookup"><span data-stu-id="f84a1-139">To install Web Deploy, you can use the [Web Platform Installer (WebPI)](https://www.microsoft.com/web/downloads/platform.aspx) or obtain an installer directly from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=43717).</span></span> <span data-ttu-id="f84a1-140">Предпочтительный метод — использовать WebPI.</span><span class="sxs-lookup"><span data-stu-id="f84a1-140">The preferred method is to use WebPI.</span></span> <span data-ttu-id="f84a1-141">WebPI обеспечивает автономную установку и настройку поставщиков размещения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-141">WebPI offers a standalone setup and a configuration for hosting providers.</span></span>

## <a name="application-configuration"></a><span data-ttu-id="f84a1-142">Настройка приложения</span><span class="sxs-lookup"><span data-stu-id="f84a1-142">Application configuration</span></span>

### <a name="enabling-the-iisintegration-components"></a><span data-ttu-id="f84a1-143">Включение компонентов IISIntegration</span><span class="sxs-lookup"><span data-stu-id="f84a1-143">Enabling the IISIntegration components</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="f84a1-144">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="f84a1-144">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="f84a1-145">Обычно *Program.cs* вызывает [CreateDefaultBuilder](/dotnet/api/microsoft.aspnetcore.webhost.createdefaultbuilder), чтобы начать настройку узла.</span><span class="sxs-lookup"><span data-stu-id="f84a1-145">A typical *Program.cs* calls [CreateDefaultBuilder](/dotnet/api/microsoft.aspnetcore.webhost.createdefaultbuilder) to begin setting up a host.</span></span> <span data-ttu-id="f84a1-146">`CreateDefaultBuilder` настраивает [Kestrel](xref:fundamentals/servers/kestrel) в качестве веб-сервера и активирует интеграцию IIS, задавая базовый путь и порт для [модуля ASP.NET Core](xref:fundamentals/servers/aspnet-core-module):</span><span class="sxs-lookup"><span data-stu-id="f84a1-146">`CreateDefaultBuilder` configures [Kestrel](xref:fundamentals/servers/kestrel) as the web server and enables IIS integration by configuring the base path and port for the [ASP.NET Core Module](xref:fundamentals/servers/aspnet-core-module):</span></span>

```csharp
public static IWebHost BuildWebHost(string[] args) =>
    WebHost.CreateDefaultBuilder(args)
        ...
```

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="f84a1-147">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="f84a1-147">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="f84a1-148">Включите в зависимости приложения зависимость от [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/).</span><span class="sxs-lookup"><span data-stu-id="f84a1-148">Include a dependency on the [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/) package in the application dependencies.</span></span> <span data-ttu-id="f84a1-149">Включите в приложение ПО промежуточного слоя для интеграции IIS, добавив метод расширения *UseIISIntegration* в *WebHostBuilder*:</span><span class="sxs-lookup"><span data-stu-id="f84a1-149">Incorporate IIS Integration middleware into the application by adding the *UseIISIntegration* extension method to *WebHostBuilder*:</span></span>

```csharp
var host = new WebHostBuilder()
    .UseKestrel()
    .UseIISIntegration()
    ...
```

<span data-ttu-id="f84a1-150">`UseKestrel` и `UseIISIntegration` являются обязательными элементами.</span><span class="sxs-lookup"><span data-stu-id="f84a1-150">Both `UseKestrel` and `UseIISIntegration` are required.</span></span> <span data-ttu-id="f84a1-151">Код, вызывающий *UseIISIntegration*, не влияет на переносимость кода.</span><span class="sxs-lookup"><span data-stu-id="f84a1-151">Code calling *UseIISIntegration* doesn't affect code portability.</span></span> <span data-ttu-id="f84a1-152">Если приложение запускается не в IIS (например, запускается непосредственно в Kestrel), то в `UseIISIntegration` нет операций.</span><span class="sxs-lookup"><span data-stu-id="f84a1-152">If the app isn't run behind IIS (for example, the app is run directly on Kestrel), `UseIISIntegration` no-ops.</span></span>

---

<span data-ttu-id="f84a1-153">Дополнительные сведения о размещении см. в разделе [Размещение в ASP.NET Core](xref:fundamentals/hosting).</span><span class="sxs-lookup"><span data-stu-id="f84a1-153">For more information on hosting, see [Hosting in ASP.NET Core](xref:fundamentals/hosting).</span></span>

### <a name="iis-options"></a><span data-ttu-id="f84a1-154">Параметры служб IIS</span><span class="sxs-lookup"><span data-stu-id="f84a1-154">IIS options</span></span>

<span data-ttu-id="f84a1-155">Чтобы настроить параметры службы *IISIntegration*, включите конфигурацию службы для *IISOptions* в *ConfigureServices*:</span><span class="sxs-lookup"><span data-stu-id="f84a1-155">To configure *IISIntegration* service options, include a service configuration for *IISOptions* in *ConfigureServices*:</span></span>

```csharp
services.Configure<IISOptions>(options => 
{
    ...
});
```

| <span data-ttu-id="f84a1-156">Параметр</span><span class="sxs-lookup"><span data-stu-id="f84a1-156">Option</span></span>                         | <span data-ttu-id="f84a1-157">По умолчанию</span><span class="sxs-lookup"><span data-stu-id="f84a1-157">Default</span></span> | <span data-ttu-id="f84a1-158">Параметр</span><span class="sxs-lookup"><span data-stu-id="f84a1-158">Setting</span></span> |
| ------------------------------ | ------- | ------- |
| `AutomaticAuthentication`      | `true`  | <span data-ttu-id="f84a1-159">Если значение — `true`, ПО промежуточного слоя для проверки подлинности задаст значение `HttpContext.User` и будет отвечать на общие запросы.</span><span class="sxs-lookup"><span data-stu-id="f84a1-159">If `true`, the authentication middleware sets the `HttpContext.User` and responds to generic challenges.</span></span> <span data-ttu-id="f84a1-160">Если значение — `false`, ПО промежуточного слоя для проверки подлинности только предоставит идентификатор (`HttpContext.User`) и будет отвечать только на явные запросы от `AuthenticationScheme`.</span><span class="sxs-lookup"><span data-stu-id="f84a1-160">If `false`, the authentication middleware only provides an identity (`HttpContext.User`) and responds to challenges when explicitly requested by the `AuthenticationScheme`.</span></span> <span data-ttu-id="f84a1-161">Для работы `AutomaticAuthentication` необходимо включить в службах IIS проверку подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="f84a1-161">Windows Authentication must be enabled in IIS for `AutomaticAuthentication` to function.</span></span> |
| `AuthenticationDisplayName`    | `null`  | <span data-ttu-id="f84a1-162">Задает отображаемое имя для пользователей на страницах входа.</span><span class="sxs-lookup"><span data-stu-id="f84a1-162">Sets the display name shown to users on login pages.</span></span> |
| `ForwardClientCertificate`     | `true`  | <span data-ttu-id="f84a1-163">Если значение — `true` и если присутствует заголовок запроса `MS-ASPNETCORE-CLIENTCERT`, происходит заполнение `HttpContext.Connection.ClientCertificate`.</span><span class="sxs-lookup"><span data-stu-id="f84a1-163">If `true` and the `MS-ASPNETCORE-CLIENTCERT` request header is present, the `HttpContext.Connection.ClientCertificate` is populated.</span></span> |

### <a name="webconfig"></a><span data-ttu-id="f84a1-164">web.config.</span><span class="sxs-lookup"><span data-stu-id="f84a1-164">web.config</span></span>

<span data-ttu-id="f84a1-165">Файл *web.config* служит для настройки модуля ASP.NET Core и предоставляет другие параметры конфигурации IIS.</span><span class="sxs-lookup"><span data-stu-id="f84a1-165">The *web.config* file configures the ASP.NET Core Module and provides other IIS configuration.</span></span> <span data-ttu-id="f84a1-166">Создание, преобразование и публикация файла *web.config* осуществляются с помощью пакета `Microsoft.NET.Sdk.Web`, который включается при указании SDK проекта в начале файла *CSPROJ*: `<Project Sdk="Microsoft.NET.Sdk.Web">`.</span><span class="sxs-lookup"><span data-stu-id="f84a1-166">Creating, transforming, and publishing *web.config* is handled by `Microsoft.NET.Sdk.Web`, which is included when you set your project's SDK at the top of your *.csproj* file, `<Project Sdk="Microsoft.NET.Sdk.Web">`.</span></span> <span data-ttu-id="f84a1-167">Чтобы целевой объект MSBuild не преобразовывал файл *web.config*, добавьте в файл проекта свойство **\<IsTransformWebConfigDisabled>** со значением `true`.</span><span class="sxs-lookup"><span data-stu-id="f84a1-167">To prevent the MSBuild target from transforming your *web.config* file, add the **\<IsTransformWebConfigDisabled>** property to your project file with a setting of `true`:</span></span>

```xml
<PropertyGroup>
  <IsTransformWebConfigDisabled>true</IsTransformWebConfigDisabled>
</PropertyGroup>
```

<span data-ttu-id="f84a1-168">Если при публикации с помощью команды *dotnet publish* или функции публикации в Visual Studio в проекте нет файла *web.config*, он создается автоматически в публикуемых выходных данных.</span><span class="sxs-lookup"><span data-stu-id="f84a1-168">If you don't have a *web.config* file in the project when you publish with *dotnet publish* or with Visual Studio publish, the file is created for you in published output.</span></span> <span data-ttu-id="f84a1-169">Если в проекте есть этот файл, он преобразуется с использованием соответствующих аргументов *processPath* и *arguments* для настройки модуля ASP.NET Core и переносится в опубликованные выходные данные.</span><span class="sxs-lookup"><span data-stu-id="f84a1-169">If you have the file in your project, it's transformed with the correct *processPath* and *arguments* to configure the ASP.NET Core Module and moved to published output.</span></span> <span data-ttu-id="f84a1-170">Преобразование не затрагивает параметры конфигурации IIS, включенные в файл.</span><span class="sxs-lookup"><span data-stu-id="f84a1-170">The transformation doesn't touch IIS configuration settings that you've included in the file.</span></span>

## <a name="create-the-iis-website"></a><span data-ttu-id="f84a1-171">Создание веб-сайта IIS</span><span class="sxs-lookup"><span data-stu-id="f84a1-171">Create the IIS Website</span></span>

1. <span data-ttu-id="f84a1-172">В целевой системе IIS создайте папку для опубликованных папок и файлов приложения, которые описываются в статье [Структура каталогов](xref:hosting/directory-structure).</span><span class="sxs-lookup"><span data-stu-id="f84a1-172">On the target IIS system, create a folder to contain the application's published folders and files, which are described in [Directory Structure](xref:hosting/directory-structure).</span></span>

2. <span data-ttu-id="f84a1-173">В созданной папке создайте папку *logs* для журналов приложения (если вы планируете включить ведение журналов).</span><span class="sxs-lookup"><span data-stu-id="f84a1-173">Within the folder you created, create a *logs* folder to hold application logs (if you plan to enable logging).</span></span> <span data-ttu-id="f84a1-174">Если вы планируете развернуть приложение с папкой *logs* в полезных данных, этот шаг можно пропустить.</span><span class="sxs-lookup"><span data-stu-id="f84a1-174">If you plan to deploy your application with a *logs* folder in the payload, you may skip this step.</span></span>

3. <span data-ttu-id="f84a1-175">В **диспетчере IIS** создайте веб-сайт.</span><span class="sxs-lookup"><span data-stu-id="f84a1-175">In **IIS Manager**, create a new website.</span></span> <span data-ttu-id="f84a1-176">Укажите **имя сайта** и задайте в качестве **физического пути** созданную папку развертывания приложения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-176">Provide a **Site name** and set the **Physical path** to the application's deployment folder that you created.</span></span> <span data-ttu-id="f84a1-177">Укажите конфигурацию **привязки** и создайте веб-сайт.</span><span class="sxs-lookup"><span data-stu-id="f84a1-177">Provide the **Binding** configuration and create the website.</span></span>

4. <span data-ttu-id="f84a1-178">Для пула приложений выберите **Без управляемого кода**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-178">Set the application pool to **No Managed Code**.</span></span> <span data-ttu-id="f84a1-179">ASP.NET Core выполняется в отдельном процессе и управляет средой выполнения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-179">ASP.NET Core runs in a separate process and manages the runtime.</span></span>

5. <span data-ttu-id="f84a1-180">Откройте окно **Добавить веб-сайт**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-180">Open the **Add Website** window.</span></span>

   ![В контекстном меню узла "Сайты" выберите пункт "Добавить веб-сайт".](iis/_static/add-website-context-menu-ws2016.png)

6. <span data-ttu-id="f84a1-182">Настройте веб-сайт.</span><span class="sxs-lookup"><span data-stu-id="f84a1-182">Configure the website.</span></span>

   ![В окне "Добавить веб-сайт" укажите имя сайта, физический путь и имя узла.](iis/_static/add-website-ws2016.png)

7. <span data-ttu-id="f84a1-184">На панели **Пулы приложений** откройте окно **Изменение пула приложений**, щелкнув пул приложений веб-сайта правой кнопкой мыши и выбрав в контекстном меню пункт **Основные настройки...**</span><span class="sxs-lookup"><span data-stu-id="f84a1-184">In the **Application Pools** panel, open the **Edit Application Pool** window by right-clicking on the website's application pool and selecting **Basic Settings...** from the popup menu.</span></span>

   ![В контекстном меню пула приложений выберите пункт "Основные настройки".](iis/_static/apppools-basic-settings-ws2016.png)

8. <span data-ttu-id="f84a1-186">Для параметра **Версия среды CLR .NET** выберите значение **Без управляемого кода**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-186">Set the **.NET CLR version** to **No Managed Code**.</span></span>

   ![Выберите "Без управляемого кода" для параметра "Версия среды CLR .NET".](iis/_static/edit-apppool-ws2016.png)
     
    <span data-ttu-id="f84a1-188">Примечание. Задавать для параметра **Версия среды CLR .NET** значение **Без управляемого кода** необязательно.</span><span class="sxs-lookup"><span data-stu-id="f84a1-188">Note: Setting the **.NET CLR version** to **No Managed Code** is optional.</span></span> <span data-ttu-id="f84a1-189">Для ASP.NET Core не требуется загрузка классической среды CLR.</span><span class="sxs-lookup"><span data-stu-id="f84a1-189">ASP.NET Core doesn't rely on loading the desktop CLR.</span></span>

9. <span data-ttu-id="f84a1-190">Убедитесь в том, что удостоверение модели процесса имеет соответствующие разрешения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-190">Confirm the process model identity has the proper permissions.</span></span>

    <span data-ttu-id="f84a1-191">Если вы измените удостоверение по умолчанию для пула приложений (**Модель процесса** > **Удостоверение**) с **ApplicationPoolIdentity** на другое, убедитесь в том, что у нового удостоверения есть соответствующие разрешения для доступа к папке приложения, базе данных и другим необходимым ресурсам.</span><span class="sxs-lookup"><span data-stu-id="f84a1-191">If you change the default identity of the application pool (**Process Model** > **Identity**) from **ApplicationPoolIdentity** to another identity, verify that the new identity has the required permissions to access the application's folder, database, and other required resources.</span></span>
   
## <a name="deploy-the-application"></a><span data-ttu-id="f84a1-192">Развертывание приложения</span><span class="sxs-lookup"><span data-stu-id="f84a1-192">Deploy the application</span></span>
<span data-ttu-id="f84a1-193">Разверните приложение в папке, созданной в целевой системе IIS.</span><span class="sxs-lookup"><span data-stu-id="f84a1-193">Deploy the application to the folder you created on the target IIS system.</span></span> <span data-ttu-id="f84a1-194">Рекомендуемый механизм развертывания — веб-развертывание.</span><span class="sxs-lookup"><span data-stu-id="f84a1-194">Web Deploy is the recommended mechanism for deployment.</span></span> <span data-ttu-id="f84a1-195">Альтернативы ему описываются ниже.</span><span class="sxs-lookup"><span data-stu-id="f84a1-195">Alternatives to Web Deploy are listed below.</span></span>

<span data-ttu-id="f84a1-196">Убедитесь в том, что приложение, публикуемое для развертывания, не запущено.</span><span class="sxs-lookup"><span data-stu-id="f84a1-196">Confirm that the published app for deployment isn't running.</span></span> <span data-ttu-id="f84a1-197">Во время выполнения приложения файлы в папке *publish* блокируются.</span><span class="sxs-lookup"><span data-stu-id="f84a1-197">Files in the *publish* folder are locked when the app is running.</span></span> <span data-ttu-id="f84a1-198">Заблокированные файлы нельзя скопировать, так что развертывание в этом случае не произойдет.</span><span class="sxs-lookup"><span data-stu-id="f84a1-198">Deployment can't occur because locked files can't be copied.</span></span>

### <a name="web-deploy-with-visual-studio"></a><span data-ttu-id="f84a1-199">Веб-развертывание с помощью Visual Studio</span><span class="sxs-lookup"><span data-stu-id="f84a1-199">Web Deploy with Visual Studio</span></span>
<span data-ttu-id="f84a1-200">Сведения о создании профиля публикации для веб-развертывания см. в статье [Создание профилей публикации для Visual Studio и MSBuild с целью развертывания приложений ASP.NET Core](xref:publishing/web-publishing-vs#publish-profiles).</span><span class="sxs-lookup"><span data-stu-id="f84a1-200">See [Create publish profiles for Visual Studio and MSBuild, to deploy ASP.NET Core apps](xref:publishing/web-publishing-vs#publish-profiles) topic to learn how to create a publish profile for use with Web Deploy.</span></span> <span data-ttu-id="f84a1-201">Если ваш поставщик услуг размещения предоставляет профиль публикации или поддерживает его создание, скачайте этот профиль и импортируйте его с помощью диалогового окна **Публикация** в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="f84a1-201">If your hosting provider supplies a Publish Profile or support for creating one, download their profile and import it using the Visual Studio **Publish** dialog.</span></span>

![Диалоговое окно "Публикация"](iis/_static/pub-dialog.png)

### <a name="web-deploy-outside-of-visual-studio"></a><span data-ttu-id="f84a1-203">Веб-развертывание вне Visual Studio</span><span class="sxs-lookup"><span data-stu-id="f84a1-203">Web Deploy outside of Visual Studio</span></span>
<span data-ttu-id="f84a1-204">Веб-развертывание можно также использовать вне Visual Studio с помощью командной строки.</span><span class="sxs-lookup"><span data-stu-id="f84a1-204">You can also use Web Deploy outside of Visual Studio from the command line.</span></span> <span data-ttu-id="f84a1-205">Дополнительные сведения см. в статье [Средство веб-развертывания](https://docs.microsoft.com/iis/publish/using-web-deploy/use-the-web-deployment-tool).</span><span class="sxs-lookup"><span data-stu-id="f84a1-205">For more information, see [Web Deployment Tool](https://docs.microsoft.com/iis/publish/using-web-deploy/use-the-web-deployment-tool).</span></span>

### <a name="alternatives-to-web-deploy"></a><span data-ttu-id="f84a1-206">Альтернативы веб-развертыванию</span><span class="sxs-lookup"><span data-stu-id="f84a1-206">Alternatives to Web Deploy</span></span>
<span data-ttu-id="f84a1-207">Если вы не хотите применять веб-развертывание или не используете Visual Studio, вы можете прибегнуть к одному из методов переноса приложения в систему размещения, например Xcopy, Robocopy или PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f84a1-207">If you don't wish to use Web Deploy or are not using Visual Studio, you may use any of several methods to move the application to the hosting system, such as Xcopy, Robocopy, or PowerShell.</span></span> <span data-ttu-id="f84a1-208">Пользователи Visual Studio могут применять [образцы публикации](https://github.com/aspnet/vsweb-publish/blob/master/samples/samples.md).</span><span class="sxs-lookup"><span data-stu-id="f84a1-208">Visual Studio users may use the [Publish Samples](https://github.com/aspnet/vsweb-publish/blob/master/samples/samples.md).</span></span>

## <a name="browse-the-website"></a><span data-ttu-id="f84a1-209">Обзор веб-сайта</span><span class="sxs-lookup"><span data-stu-id="f84a1-209">Browse the website</span></span>
![Начальная страница IIS, загруженная в браузере Microsoft Edge.](iis/_static/browsewebsite.png)
   
>[!WARNING]
> <span data-ttu-id="f84a1-211">Приложения .NET Core размещаются посредством обратного прокси-сервера между службами IIS и сервером Kestrel.</span><span class="sxs-lookup"><span data-stu-id="f84a1-211">.NET Core applications are hosted via a reverse-proxy between IIS and the Kestrel server.</span></span> <span data-ttu-id="f84a1-212">Для создания обратного прокси-сервера файл *web.config* должен находиться по корневому пути к содержимому развернутого приложения (как правило, это основной путь приложения). Это физический путь к веб-сайту, указанный в службах IIS.</span><span class="sxs-lookup"><span data-stu-id="f84a1-212">In order to create the reverse-proxy, the *web.config* file must be present at the content root path (typically the app base path) of the deployed application, which is the website physical path provided to IIS.</span></span> <span data-ttu-id="f84a1-213">По физическому пути приложения находятся важные файлы, включая такие вложенные папки, как *мое_приложение.runtimeconfig.json*, *мое_приложение.xml* (комментарии к документам XML) и *мое_приложение.deps.json*.</span><span class="sxs-lookup"><span data-stu-id="f84a1-213">Sensitive files exist on the app's physical path, including subfolders, such as *my_application.runtimeconfig.json*, *my_application.xml* (XML Documentation comments), and *my_application.deps.json*.</span></span> <span data-ttu-id="f84a1-214">Файл *web.config* необходим для создания обратного прокси-сервера для Kestrel, который запрещает службам IIS предоставлять эти и другие важные файлы.</span><span class="sxs-lookup"><span data-stu-id="f84a1-214">The *web.config* file is required to create the reverse proxy to Kestrel, which prevents IIS from serving these and other sensitive files.</span></span> <span data-ttu-id="f84a1-215">**Поэтому важно следить за тем, чтобы файл *web.config* не был случайно переименован или удален из развертывания.**</span><span class="sxs-lookup"><span data-stu-id="f84a1-215">**Therefore, it is important that the *web.config* file is never accidently renamed or removed from the deployment.**</span></span>

## <a name="data-protection"></a><span data-ttu-id="f84a1-216">Защита данных</span><span class="sxs-lookup"><span data-stu-id="f84a1-216">Data protection</span></span>

<span data-ttu-id="f84a1-217">Приложение ASP.NET Core хранит набор ключей в памяти при выполнении указанных ниже условий.</span><span class="sxs-lookup"><span data-stu-id="f84a1-217">An ASP.NET Core application will store the keyring in memory under the following condition:</span></span>

* <span data-ttu-id="f84a1-218">Веб-сайт размещается за службами IIS.</span><span class="sxs-lookup"><span data-stu-id="f84a1-218">A website is hosted behind IIS.</span></span>
* <span data-ttu-id="f84a1-219">В стеке защиты данных не настроено хранение набора ключей в постоянном хранилище.</span><span class="sxs-lookup"><span data-stu-id="f84a1-219">The Data Protection stack has not been configured to store the keyring in a persistent store.</span></span>

<span data-ttu-id="f84a1-220">Если набор ключей хранится в памяти, то при перезапуске приложения происходит следующее:</span><span class="sxs-lookup"><span data-stu-id="f84a1-220">If the keyring is stored in memory, when the app restarts:</span></span>

* <span data-ttu-id="f84a1-221">Все токены проверки подлинности на основе форм становятся недействительными.</span><span class="sxs-lookup"><span data-stu-id="f84a1-221">All forms authentication tokens will be invalid.</span></span> 
* <span data-ttu-id="f84a1-222">При выполнении следующего запроса пользователю потребуется выполнить вход снова.</span><span class="sxs-lookup"><span data-stu-id="f84a1-222">Users will need to login again on their next request.</span></span> 
* <span data-ttu-id="f84a1-223">Все данные, защищенные с помощью набора ключей, перестанут быть незащищенными.</span><span class="sxs-lookup"><span data-stu-id="f84a1-223">Any data you protected with the keyring will no longer be unprotected.</span></span>

> [!WARNING]
> <span data-ttu-id="f84a1-224">Защита данных используется некоторым программным обеспечением промежуточного слоя ASP.NET, в том числе применяемым для проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="f84a1-224">Data Protection is used by several ASP.NET middlewares, including those used in authentication.</span></span> <span data-ttu-id="f84a1-225">Даже если вы не вызываете интерфейсы API защиты данных из своего кода, необходимо настроить защиту данных с помощью скрипта развертывания или в собственном коде.</span><span class="sxs-lookup"><span data-stu-id="f84a1-225">Even if you do not specifically call any Data Protection APIs from your own code you should configure Data Protection with a deployment script or in your own code.</span></span> <span data-ttu-id="f84a1-226">Если вы не настроите защиту данных, ключи по умолчанию будут храниться в памяти и удалены при перезапуске приложения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-226">If you do not configure data protection, by default the keys will be held in memory and discarded when your app restarts.</span></span> <span data-ttu-id="f84a1-227">При перезапуске все файлы cookie, записанные в процессе проверки подлинности, станут недействительными, и пользователям потребуется выполнить вход повторно.</span><span class="sxs-lookup"><span data-stu-id="f84a1-227">Restarting will invalidate any cookies written by the cookie authentication and users will have to login again.</span></span>

<span data-ttu-id="f84a1-228">Чтобы настроить защиту данных в службах IIS, следует использовать один из описанных ниже подходов.</span><span class="sxs-lookup"><span data-stu-id="f84a1-228">To configure Data Protection under IIS you must use one of the following approaches:</span></span>

* <span data-ttu-id="f84a1-229">Запустите [скрипт PowerShell](https://github.com/aspnet/DataProtection/blob/dev/Provision-AutoGenKeys.ps1), чтобы создать соответствующие записи в реестре (например, `.\Provision-AutoGenKeys.ps1 DefaultAppPool`).</span><span class="sxs-lookup"><span data-stu-id="f84a1-229">Run a [powershell script](https://github.com/aspnet/DataProtection/blob/dev/Provision-AutoGenKeys.ps1) to create suitable registry entries (For example,  `.\Provision-AutoGenKeys.ps1 DefaultAppPool`).</span></span> <span data-ttu-id="f84a1-230">В результате ключи будут храниться в реестре и защищаться посредством API защиты данных с использованием ключа на уровне компьютера.</span><span class="sxs-lookup"><span data-stu-id="f84a1-230">This will store keys in the registry, protected using DPAPI with a machine wide key.</span></span>
* <span data-ttu-id="f84a1-231">Настройте пул приложений IIS для загрузки профиля пользователя.</span><span class="sxs-lookup"><span data-stu-id="f84a1-231">Configure the IIS Application Pool to load the user profile.</span></span> <span data-ttu-id="f84a1-232">Этот параметр находится на странице **Дополнительные параметры** пула приложений в разделе **Модель процесса**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-232">This setting is in the **Process Model** section under the **Advanced Settings** for the application pool.</span></span> <span data-ttu-id="f84a1-233">Задайте для параметра **Загрузить профиль пользователя** значение `True`.</span><span class="sxs-lookup"><span data-stu-id="f84a1-233">Set **Load User Profile** to `True`.</span></span> <span data-ttu-id="f84a1-234">В результате ключи будут храниться в каталоге профиля пользователя и защищаться посредством API защиты данных с использованием ключа на уровне учетной записи пользователя, применяемой для пула приложений.</span><span class="sxs-lookup"><span data-stu-id="f84a1-234">This will store keys under the user profile directory, and protected using DPAPI with a key specific to the user account used for the app pool.</span></span>
* <span data-ttu-id="f84a1-235">Измените код приложения так, чтобы [в качестве хранилища набора ключей использовалась файловая система](xref:security/data-protection/configuration/overview).</span><span class="sxs-lookup"><span data-stu-id="f84a1-235">Adjust your application code to [use the file system as a key ring store](xref:security/data-protection/configuration/overview).</span></span> <span data-ttu-id="f84a1-236">Используйте сертификат X509 для защиты набора ключей, причем это должен быть доверенный сертификат.</span><span class="sxs-lookup"><span data-stu-id="f84a1-236">Use an X509 certificate to protect the key ring and ensure it is a trusted certificate.</span></span> <span data-ttu-id="f84a1-237">Например, если сертификат является самозаверяющим, его необходимо поместить в доверенное корневое хранилище.</span><span class="sxs-lookup"><span data-stu-id="f84a1-237">For example, if it is a self signed certificate you must place it in the Trusted Root store.</span></span>

<span data-ttu-id="f84a1-238">При использовании служб IIS в веб-ферме:</span><span class="sxs-lookup"><span data-stu-id="f84a1-238">When using IIS in a web farm:</span></span>

* <span data-ttu-id="f84a1-239">используйте общую папку, которая доступна всем компьютерам;</span><span class="sxs-lookup"><span data-stu-id="f84a1-239">Use a file share all machines can access.</span></span>
* <span data-ttu-id="f84a1-240">разверните сертификат X509 на каждом компьютере;</span><span class="sxs-lookup"><span data-stu-id="f84a1-240">Deploy an X509 certificate to each machine.</span></span>  <span data-ttu-id="f84a1-241">настройте [защиту данных в коде](https://docs.microsoft.com/aspnet/core/security/data-protection/configuration/overview).</span><span class="sxs-lookup"><span data-stu-id="f84a1-241">Configure [data protection in code](https://docs.microsoft.com/aspnet/core/security/data-protection/configuration/overview).</span></span>

### <a name="1-create-a-data-protection-registry-hive"></a><span data-ttu-id="f84a1-242">1. Создание куста реестра для защиты данных</span><span class="sxs-lookup"><span data-stu-id="f84a1-242">1. Create a Data Protection Registry Hive</span></span>

<span data-ttu-id="f84a1-243">Ключи защиты данных, используемые приложениями ASP.NET, хранятся в кустах реестра, являющихся внешними для приложений.</span><span class="sxs-lookup"><span data-stu-id="f84a1-243">Data Protection keys used by ASP.NET applications are stored in registry hives external to the applications.</span></span> <span data-ttu-id="f84a1-244">Чтобы сохранять эти ключи для определенного приложения, необходимо создать куст реестра для пула приложений, к которому относится данное приложение.</span><span class="sxs-lookup"><span data-stu-id="f84a1-244">To persist the keys for a given application, you must create a registry hive for the application's application pool.</span></span>

<span data-ttu-id="f84a1-245">При автономной установке служб IIS следует выполнить [скрипт PowerShell Provision-AutoGenKeys.ps1 для защиты данных](https://github.com/aspnet/DataProtection/blob/dev/Provision-AutoGenKeys.ps1) применительно к каждому пулу приложений, в который входит приложение ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="f84a1-245">For standalone IIS installations, you may use the [Data Protection Provision-AutoGenKeys.ps1 PowerShell script](https://github.com/aspnet/DataProtection/blob/dev/Provision-AutoGenKeys.ps1) for each application pool used with an ASP.NET Core application.</span></span> <span data-ttu-id="f84a1-246">Этот скрипт создаст специальный раздел в реестре HKLM, который будет доступен только учетной записи рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="f84a1-246">This script will create a special registry key in the HKLM registry that is ACLed only to the worker process account.</span></span> <span data-ttu-id="f84a1-247">Неактивные ключи шифруются с помощью API защиты данных.</span><span class="sxs-lookup"><span data-stu-id="f84a1-247">Keys are encrypted at rest using DPAPI.</span></span>

<span data-ttu-id="f84a1-248">В веб-ферме приложение можно настроить так, чтобы для хранения набора ключей защиты данных использовался UNC-путь.</span><span class="sxs-lookup"><span data-stu-id="f84a1-248">In web farm scenarios, an application can be configured to use a UNC path to store its data protection key ring.</span></span> <span data-ttu-id="f84a1-249">По умолчанию ключи защиты данных не шифруются.</span><span class="sxs-lookup"><span data-stu-id="f84a1-249">By default, the data protection keys are not encrypted.</span></span> <span data-ttu-id="f84a1-250">Разрешения на доступ к файлам в общей папке должны быть предоставлены только учетной записи Windows, от имени которой выполняется приложение.</span><span class="sxs-lookup"><span data-stu-id="f84a1-250">You should ensure that the file permissions for such a share are limited to the Windows account the application runs as.</span></span> <span data-ttu-id="f84a1-251">Помимо этого, для защиты неактивных ключей можно использовать сертификат X509.</span><span class="sxs-lookup"><span data-stu-id="f84a1-251">In addition you may choose to protect keys at rest using an X509 certificate.</span></span> <span data-ttu-id="f84a1-252">При этом может потребоваться реализовать механизм, позволяющий пользователям добавлять сертификаты, помещать их в хранилище доверенных сертификатов пользователя и обеспечивать их доступность на всех компьютерах, на которых будет работать приложение.</span><span class="sxs-lookup"><span data-stu-id="f84a1-252">You may wish to consider a mechanism to allow users to upload certificates, place them into the user's trusted certificate store, and ensure they are available on all machines the user's application will run on.</span></span> <span data-ttu-id="f84a1-253">Подробные сведения см. в разделе [Настройка защиты данных](xref:security/data-protection/configuration/overview#data-protection-configuring).</span><span class="sxs-lookup"><span data-stu-id="f84a1-253">See [Configuring Data Protection](xref:security/data-protection/configuration/overview#data-protection-configuring) for details.</span></span>

### <a name="2-configure-the-iis-application-pool-to-load-the-user-profile"></a><span data-ttu-id="f84a1-254">2. Настройка пула приложений IIS для загрузки профиля пользователя</span><span class="sxs-lookup"><span data-stu-id="f84a1-254">2. Configure the IIS Application Pool to load the user profile</span></span>
<span data-ttu-id="f84a1-255">Этот параметр находится на странице "Дополнительные параметры" пула приложений в разделе "Модель процесса".</span><span class="sxs-lookup"><span data-stu-id="f84a1-255">This setting is in the Process Model section under the Advanced Settings for the application pool.</span></span> <span data-ttu-id="f84a1-256">Задайте для параметра "Загрузить профиль пользователя" значение True.</span><span class="sxs-lookup"><span data-stu-id="f84a1-256">Set Load User Profile to True.</span></span> <span data-ttu-id="f84a1-257">В результате ключи будут храниться в каталоге профиля пользователя и защищаться посредством API защиты данных с использованием ключа на уровне учетной записи пользователя, применяемой для пула приложений.</span><span class="sxs-lookup"><span data-stu-id="f84a1-257">This will store keys under the user profile directory, and protected using DPAPI with a key specific to the user account used for the app pool.</span></span>

### <a name="3-machine-wide-policy-for-data-protection"></a><span data-ttu-id="f84a1-258">3. Политика защиты данных на уровне компьютера</span><span class="sxs-lookup"><span data-stu-id="f84a1-258">3. Machine-wide policy for data protection</span></span>

<span data-ttu-id="f84a1-259">Система защиты данных обеспечивает ограниченную поддержку задания [политики по умолчанию на уровне компьютера](xref:security/data-protection/configuration/machine-wide-policy#data-protection-configuration-machinewidepolicy) для всех приложений, которые используют интерфейсы API защиты данных.</span><span class="sxs-lookup"><span data-stu-id="f84a1-259">The data protection system has limited support for setting default [machine-wide policy](xref:security/data-protection/configuration/machine-wide-policy#data-protection-configuration-machinewidepolicy) for all applications that consume the data protection APIs.</span></span> <span data-ttu-id="f84a1-260">Дополнительные сведения см. в документации по [защите данных](xref:security/data-protection/index).</span><span class="sxs-lookup"><span data-stu-id="f84a1-260">See the [data protection](xref:security/data-protection/index) documentation for more details.</span></span>

## <a name="configuration-of-sub-applications"></a><span data-ttu-id="f84a1-261">Настройка дочерних приложений</span><span class="sxs-lookup"><span data-stu-id="f84a1-261">Configuration of sub-applications</span></span>

<span data-ttu-id="f84a1-262">Дочерние приложения, добавленные в корневое приложение, не должны включать в себя модуль ASP.NET Core в качестве обработчика.</span><span class="sxs-lookup"><span data-stu-id="f84a1-262">Sub applications added under the root application shouldn't include the ASP.NET Core Module as a handler.</span></span> <span data-ttu-id="f84a1-263">Если вы добавите модуль в качестве обработчика в файл *web.config* дочернего приложения, то при попытке работы с этим приложением вы получите ошибку 500.19 (внутренняя ошибка сервера) с указанием некорректного файла конфигурации.</span><span class="sxs-lookup"><span data-stu-id="f84a1-263">If you add the module as a handler in a sub-application's *web.config* file, you receive a 500.19 (Internal Server Error) referencing the faulty config file when you attempt to browse the sub app.</span></span> <span data-ttu-id="f84a1-264">В приведенном ниже примере показано содержимое опубликованного файла *web.config* для дочернего приложения ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="f84a1-264">The following example shows the contents of a published *web.config* file for an ASP.NET Core sub app:</span></span>

```xml
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
    <aspNetCore processPath="dotnet" 
        arguments=".\MyApp.dll" 
        stdoutLogEnabled="false" 
        stdoutLogFile=".\logs\stdout" />
  </system.webServer>
</configuration>
```

<span data-ttu-id="f84a1-265">Если вы планируете размещать дочернее приложение не на основе ASP.NET Core в приложении ASP.NET Core, необходимо явным образом удалить унаследованный обработчик из файла *web.config* дочернего приложения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-265">If you intend to host a non-ASP.NET Core sub app underneath an ASP.NET Core app, you must explicitly remove the inherited handler in the sub app *web.config* file:</span></span>

```xml
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
    <handlers>
      <remove name="aspNetCore"/>
    </handlers>
    <aspNetCore processPath="dotnet" 
        arguments=".\MyApp.dll" 
        stdoutLogEnabled="false" 
        stdoutLogFile=".\logs\stdout" />
  </system.webServer>
</configuration>
```

<span data-ttu-id="f84a1-266">Дополнительные сведения о настройке модуля ASP.NET Core с помощью файла *web.config* см. в статье [Введение в модуль ASP.NET Core Module](xref:fundamentals/servers/aspnet-core-module) и в [справочнике по настройке модуля ASP.NET Core](xref:hosting/aspnet-core-module).</span><span class="sxs-lookup"><span data-stu-id="f84a1-266">For more information on configuring the ASP.NET Core Module with the *web.config* file, see the [Introduction to ASP.NET Core Module](xref:fundamentals/servers/aspnet-core-module) topic and the [ASP.NET Core Module configuration reference](xref:hosting/aspnet-core-module).</span></span>

## <a name="configuration-of-iis-with-webconfig"></a><span data-ttu-id="f84a1-267">Настройка служб IIS с помощью файла web.config</span><span class="sxs-lookup"><span data-stu-id="f84a1-267">Configuration of IIS with web.config</span></span>

<span data-ttu-id="f84a1-268">Раздел `<system.webServer>` файла *web.config* по-прежнему действует для тех компонентов IIS, которые относятся к конфигурации прокси-сервера.</span><span class="sxs-lookup"><span data-stu-id="f84a1-268">IIS configuration is still influenced by the `<system.webServer>` section of *web.config* for those IIS features that apply to a reverse proxy configuration.</span></span> <span data-ttu-id="f84a1-269">Например, на уровне системы в службах IIS может быть настроено динамическое сжатие, однако для приложения этот параметр можно отключить с помощью элемента `<urlCompression>` в файле *web.config* приложения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-269">For example, you may have IIS configured at the system level to use dynamic compression, but you could disable that setting for an app with the `<urlCompression>` element in the app's *web.config* file.</span></span> <span data-ttu-id="f84a1-270">Дополнительные сведения см. в [справочнике по настройке `<system.webServer>`](https://docs.microsoft.com/iis/configuration/system.webServer/), [справочнике по настройке модуля ASP.NET Core](xref:hosting/aspnet-core-module) и статье [Использование модулей IIS с ASP.NET Core](xref:hosting/iis-modules).</span><span class="sxs-lookup"><span data-stu-id="f84a1-270">For more information, see the [configuration reference for `<system.webServer>`](https://docs.microsoft.com/iis/configuration/system.webServer/), [ASP.NET Core Module Configuration Reference](xref:hosting/aspnet-core-module), and [Using IIS Modules with ASP.NET Core](xref:hosting/iis-modules).</span></span> <span data-ttu-id="f84a1-271">Если нужно задать переменные среды для отдельных приложений, выполняющихся в изолированных пулах приложений (такая возможность поддерживается в службах IIS 10.0 и более поздних версий), см. подраздел, посвященный *команде AppCmd.exe*, в разделе [Переменные среды \<environmentVariables>](/iis/configuration/system.applicationHost/applicationPools/add/environmentVariables/#appcmdexe) справочной документации по службам IIS.</span><span class="sxs-lookup"><span data-stu-id="f84a1-271">If you need to set environment variables for individual apps running in isolated Application Pools (supported on IIS 10.0+), see the *AppCmd.exe command* section of the [Environment Variables \<environmentVariables>](/iis/configuration/system.applicationHost/applicationPools/add/environmentVariables/#appcmdexe) topic in the IIS reference documentation.</span></span>

## <a name="configuration-sections-of-webconfig"></a><span data-ttu-id="f84a1-272">Разделы конфигурации файла web.config</span><span class="sxs-lookup"><span data-stu-id="f84a1-272">Configuration sections of web.config</span></span>

<span data-ttu-id="f84a1-273">В отличие от приложений .NET Framework, которые настраиваются с помощью элементов `<system.web>`, `<appSettings>`, `<connectionStrings>` и `<location>` в файле *web.config*, приложения ASP.NET Core настраиваются с помощью других поставщиков конфигурации.</span><span class="sxs-lookup"><span data-stu-id="f84a1-273">Unlike .NET Framework applications that are configured with the `<system.web>`, `<appSettings>`, `<connectionStrings>`, and `<location>` elements in *web.config*, ASP.NET Core apps are configured using other configuration providers.</span></span> <span data-ttu-id="f84a1-274">Дополнительные сведения см. в разделе [Конфигурация](xref:fundamentals/configuration).</span><span class="sxs-lookup"><span data-stu-id="f84a1-274">For more information, see [Configuration](xref:fundamentals/configuration).</span></span>

## <a name="application-pools"></a><span data-ttu-id="f84a1-275">Пулы приложений</span><span class="sxs-lookup"><span data-stu-id="f84a1-275">Application Pools</span></span>

<span data-ttu-id="f84a1-276">Если в одной системе размещается несколько веб-сайтов, приложения следует изолировать друг от друга, запуская каждое из них в отдельном пуле приложений.</span><span class="sxs-lookup"><span data-stu-id="f84a1-276">When hosting multiple websites on a single system, you should isolate the applications from each other by running each app in its own application pool.</span></span> <span data-ttu-id="f84a1-277">В диалоговом окне **Добавить веб-сайт** служб IIS такое поведение задано по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="f84a1-277">The IIS **Add Website** dialog defaults to this behavior.</span></span> <span data-ttu-id="f84a1-278">Если вы указываете **имя сайта**, оно автоматически переносится в текстовое поле **Пул приложений**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-278">When you provide a **Site name**, the text is automatically transferred to the **Application pool** textbox.</span></span> <span data-ttu-id="f84a1-279">При добавлении веб-сайта будет создан пул приложений с именем сайта.</span><span class="sxs-lookup"><span data-stu-id="f84a1-279">A new application pool will be created using the site name when you add the website.</span></span>

## <a name="application-pool-identity"></a><span data-ttu-id="f84a1-280">Удостоверение пула приложений</span><span class="sxs-lookup"><span data-stu-id="f84a1-280">Application Pool Identity</span></span>

<span data-ttu-id="f84a1-281">Учетная запись удостоверения пула приложений позволяет запускать приложение от имени уникальной учетной записи, не создавая домены или локальные учетные записи и не управляя ими.</span><span class="sxs-lookup"><span data-stu-id="f84a1-281">An application pool identity account allows you to run an application under a unique account without having to create and manage domains or local accounts.</span></span> <span data-ttu-id="f84a1-282">В службах IIS 8.0 и более поздних версий рабочий процесс администратора IIS (WAS) создает виртуальную учетную запись с именем нового пула приложений и по умолчанию выполняет рабочие процессы пула приложений с этой учетной записью.</span><span class="sxs-lookup"><span data-stu-id="f84a1-282">On IIS 8.0+, the IIS Admin Worker Process (WAS) will create a virtual account with the name of the new application pool and run the application pool's worker processes under this account by default.</span></span> <span data-ttu-id="f84a1-283">В консоли управления IIS в окне "Дополнительные параметры" для пула приложений должно быть выбрано удостоверение **ApplicationPoolIdentity**, как показано на рисунке ниже.</span><span class="sxs-lookup"><span data-stu-id="f84a1-283">In the IIS Management Console, under Advanced Settings for your application pool, ensure that the Identity is set to use **ApplicationPoolIdentity** as shown in the image below.</span></span>

![Диалоговое окно дополнительных параметров для пула приложений](iis/_static/apppool-identity.png)

<span data-ttu-id="f84a1-285">Процесс управления IIS создает в системе безопасности Windows безопасный идентификатор с именем пула приложений.</span><span class="sxs-lookup"><span data-stu-id="f84a1-285">The IIS management process creates a secure identifier with the name of the application pool in the Windows Security System.</span></span> <span data-ttu-id="f84a1-286">С помощью этого удостоверения можно защищать ресурсы, однако оно не представляет реальную учетную запись пользователя и не отображается в консоли управления Windows пользователя.</span><span class="sxs-lookup"><span data-stu-id="f84a1-286">Resources can be secured by using this identity; however, this identity is not a real user account and won't show up in the Windows User Management Console.</span></span>

<span data-ttu-id="f84a1-287">Если рабочему процессу IIS необходимо предоставить доступ к приложению с повышенными правами, потребуется изменить список управления доступом (ACL) для каталога, содержащего приложения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-287">If you need to grant the IIS worker process elevated access to your application, you will need to modify the Access Control List (ACL) for the directory containing your application.</span></span>

1. <span data-ttu-id="f84a1-288">Откройте проводник и перейдите к каталогу.</span><span class="sxs-lookup"><span data-stu-id="f84a1-288">Open Windows Explorer and navigate to the directory.</span></span>

2. <span data-ttu-id="f84a1-289">Щелкните каталог правой кнопкой мыши и выберите пункт **Свойства**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-289">Right click on the directory and click **Properties**.</span></span>

3. <span data-ttu-id="f84a1-290">На вкладке **Безопасность** нажмите кнопку **Изменить**, а затем кнопку **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-290">Under the **Security** tab, click the **Edit** button and then the **Add** button.</span></span>

4. <span data-ttu-id="f84a1-291">Нажмите кнопку **Размещение** и выберите свою систему.</span><span class="sxs-lookup"><span data-stu-id="f84a1-291">Click the **Locations** button and make sure you select your system.</span></span>

5. <span data-ttu-id="f84a1-292">В текстовом поле **Введите имена выбираемых объектов** введите **IIS AppPool\DefaultAppPool**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-292">Enter **IIS AppPool\DefaultAppPool** in **Enter the object names to select** textbox.</span></span>

  ![Диалоговое окно "Введите имена выбираемых объектов" для папки приложения](iis/_static/select-users-or-groups-1.png)

6. <span data-ttu-id="f84a1-294">Нажмите кнопку **Проверить имена**, а затем — кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-294">Click the **Check Names** button and then click **OK**.</span></span>

  ![Диалоговое окно "Введите имена выбираемых объектов" для папки приложения](iis/_static/select-users-or-groups-2.png)

<span data-ttu-id="f84a1-296">Это также можно сделать в командной строке с помощью программы **ICACLS**:</span><span class="sxs-lookup"><span data-stu-id="f84a1-296">You can also do this via a command prompt using **ICACLS** tool:</span></span>

```console
ICACLS C:\sites\MyWebApp /grant "IIS AppPool\DefaultAppPool":F
```

## <a name="troubleshooting-tips"></a><span data-ttu-id="f84a1-297">Советы по устранению неполадок</span><span class="sxs-lookup"><span data-stu-id="f84a1-297">Troubleshooting tips</span></span>

<span data-ttu-id="f84a1-298">Для диагностики проблем с развертыванием служб IIS изучите выходные данные в браузере, просмотрите системный журнал **Приложение** в окне **Просмотр событий** и включите ведение журналов `stdout`.</span><span class="sxs-lookup"><span data-stu-id="f84a1-298">To diagnose problems with IIS deployments, study browser output, examine the system's **Application** log through **Event Viewer**, and enable `stdout` logging.</span></span> <span data-ttu-id="f84a1-299">Журнал **модуля ASP.NET Core** находится по пути, указанному в атрибуте *stdoutLogFile* элемента `<aspNetCore>` в файле *web.config*. Все папки по пути, указанному в значении этого атрибута, должны существовать в развертывании.</span><span class="sxs-lookup"><span data-stu-id="f84a1-299">The **ASP.NET Core Module** log will be found on the path provided in the *stdoutLogFile* attribute of the `<aspNetCore>` element in *web.config*. Any folders on the path provided in the attribute value must exist in the deployment.</span></span> <span data-ttu-id="f84a1-300">Кроме того, необходимо задать *stdoutLogEnabled="true"*.</span><span class="sxs-lookup"><span data-stu-id="f84a1-300">You must also set *stdoutLogEnabled="true"*.</span></span> <span data-ttu-id="f84a1-301">Во всех приложениях, использующих пакет SDK `Microsoft.NET.Sdk.Web` для создания файла *web.config*, параметр *stdoutLogEnabled* по умолчанию имеет значение *false*, поэтому файл *web.config* необходимо предоставить вручную или изменить его, включив ведение журналов `stdout`.</span><span class="sxs-lookup"><span data-stu-id="f84a1-301">Applications that use the `Microsoft.NET.Sdk.Web` SDK to create the *web.config* file will default the *stdoutLogEnabled* setting to *false*, so you must manually provide the *web.config* file or modify the file in order to enable `stdout` logging.</span></span>

<span data-ttu-id="f84a1-302">Некоторые распространенные ошибки не приводятся в браузере, журнале приложений и журнале модуля ASP.NET Core, пока не будут достигнуты значения *startupTimeLimit* (по умолчанию 120 секунд) и *startupRetryCount* (по умолчанию 2).</span><span class="sxs-lookup"><span data-stu-id="f84a1-302">Several of the common errors do not appear in the browser, Application Log, and ASP.NET Core Module Log until the module *startupTimeLimit* (default: 120 seconds) and *startupRetryCount* (default: 2) have passed.</span></span> <span data-ttu-id="f84a1-303">Поэтому прежде чем делать вывод о том, что модулю не удалось запустить процесс приложения, подождите шесть минут.</span><span class="sxs-lookup"><span data-stu-id="f84a1-303">Therefore, wait a full six minutes before deducing that the module has failed to start a process for the application.</span></span>

<span data-ttu-id="f84a1-304">Один из простых способов определить, правильно ли работает приложение, — запустить его непосредственно в Kestrel.</span><span class="sxs-lookup"><span data-stu-id="f84a1-304">One quick way to determine if the application is working properly is to run the application directly on Kestrel.</span></span> <span data-ttu-id="f84a1-305">Если приложение было опубликовано как зависящее от платформы развертывание, выполните команду **dotnet my_application.dll** в папке развертывания, которая представляет собой физический путь к приложению в IIS.</span><span class="sxs-lookup"><span data-stu-id="f84a1-305">If the application was published as a framework-dependent deployment, execute **dotnet my_application.dll** in the deployment folder, which is the IIS physical path to the application.</span></span> <span data-ttu-id="f84a1-306">Если приложение было опубликовано как автономное развертывание, запустите его исполняемый файл (**мое_приложение.exe**) в папке развертывания непосредственно из командной строки.</span><span class="sxs-lookup"><span data-stu-id="f84a1-306">If the application was published as a self-contained deployment, run the application's executable directly from a command prompt, **my_application.exe**, in the deployment folder.</span></span> <span data-ttu-id="f84a1-307">Если Kestrel прослушивает порт по умолчанию с номером 5000, приложение должно быть доступно по адресу `http://localhost:5000/`.</span><span class="sxs-lookup"><span data-stu-id="f84a1-307">If Kestrel is listening on default port 5000, you should be able to browse the application at `http://localhost:5000/`.</span></span> <span data-ttu-id="f84a1-308">Если приложение отвечает на запросы по адресу конечной точки Kestrel, проблема, вероятнее всего, связана с конфигурацией служб IIS, модуля ASP.NET Core и Kestrel, а не с самим приложением.</span><span class="sxs-lookup"><span data-stu-id="f84a1-308">If the application responds normally at the Kestrel endpoint address, the problem is more likely related to the IIS-ASP.NET Core Module-Kestrel configuration and less likely within the application itself.</span></span>

<span data-ttu-id="f84a1-309">Один из способов определить, правильно ли работает обратный прокси-сервер между службами IIS и сервером Kestrel, — выполнить простой запрос статического файла, которым может быть таблица стилей, скрипт или изображение из каталога *wwwroot*, с помощью [ПО промежуточного слоя для статических файлов](xref:fundamentals/static-files).</span><span class="sxs-lookup"><span data-stu-id="f84a1-309">One way to determine if the IIS reverse proxy to the Kestrel server is working properly is to perform a simple static file request for a stylesheet, script, or image from the application's static files in *wwwroot* using [Static File middleware](xref:fundamentals/static-files).</span></span> <span data-ttu-id="f84a1-310">Если приложение может предоставлять статические файлы, но представления MVC и другие конечные точки не работают, проблема, скорее всего, связана с самим приложением (например, маршрутизацией MVC или внутренней ошибкой сервера 500), а не с конфигурацией служб IIS, модуля ASP.NET Core и Kestrel.</span><span class="sxs-lookup"><span data-stu-id="f84a1-310">If the application can serve static files but MVC Views and other endpoints are failing, the problem is less likely related to the IIS-ASP.NET Core Module-Kestrel configuration and more likely within the application itself (for example, MVC routing or 500 Internal Server Error).</span></span>

<span data-ttu-id="f84a1-311">Если Kestrel нормально работает за службами IIS, но приложение не запускается в системе, хотя успешно выполняется локально, вы можете временно добавить в файл *web.config* переменную среды `ASPNETCORE_ENVIRONMENT` со значением `Development`.</span><span class="sxs-lookup"><span data-stu-id="f84a1-311">When Kestrel starts normally behind IIS but the app won't run on the system after successfully running locally, you can temporarily add an environment variable to *web.config* to set the `ASPNETCORE_ENVIRONMENT` to `Development`.</span></span> <span data-ttu-id="f84a1-312">Пока среда не будет переопределена в параметрах запуска приложения, при выполнении приложения в системе будет выводиться [страница исключения для разработчика](xref:fundamentals/error-handling).</span><span class="sxs-lookup"><span data-stu-id="f84a1-312">As long as you don't override the environment in app startup, this will allow the [developer exception page](xref:fundamentals/error-handling) to appear when the app is run on the system.</span></span> <span data-ttu-id="f84a1-313">Задавать таким образом переменную среды `ASPNETCORE_ENVIRONMENT` рекомендуется только в промежуточных и тестовых системах, доступ к которым из Интернета закрыт.</span><span class="sxs-lookup"><span data-stu-id="f84a1-313">Setting the environment variable for `ASPNETCORE_ENVIRONMENT` in this way is only recommended for staging/testing systems that are not exposed to the Internet.</span></span> <span data-ttu-id="f84a1-314">По завершении обязательно удалите эту переменную среды из файла *web.config*.</span><span class="sxs-lookup"><span data-stu-id="f84a1-314">Be sure you remove the environment variable from the *web.config* file when finished.</span></span> <span data-ttu-id="f84a1-315">Сведения о задании переменных среды для обратного прокси-сервера с помощью файла *web.config* см. в разделе, посвященном [дочернему элементу environmentVariables aspNetCore](xref:hosting/aspnet-core-module#setting-environment-variables).</span><span class="sxs-lookup"><span data-stu-id="f84a1-315">For information on setting environment variables via *web.config* for the reverse proxy, see [environmentVariables child element of aspNetCore](xref:hosting/aspnet-core-module#setting-environment-variables).</span></span>

<span data-ttu-id="f84a1-316">В большинстве случаев включение журнала приложений помогает находить и устранять проблемы, связанные с приложением или обратным прокси-сервером.</span><span class="sxs-lookup"><span data-stu-id="f84a1-316">In most cases, enabling application logging will assist in troubleshooting problems with application or the reverse proxy.</span></span> <span data-ttu-id="f84a1-317">Дополнительные сведения см. в статье, посвященной [ведению журналов](xref:fundamentals/logging).</span><span class="sxs-lookup"><span data-stu-id="f84a1-317">See [Logging](xref:fundamentals/logging) for more information.</span></span>

<span data-ttu-id="f84a1-318">Последняя рекомендация по устранению неполадок касается приложений, которые не запускаются после обновления пакета SDK для .NET Core на компьютере разработки или версий пакета в приложении.</span><span class="sxs-lookup"><span data-stu-id="f84a1-318">Our last troubleshooting tip pertains to apps that fail to run after upgrading either the .NET Core SDK on the development machine or package versions within the app.</span></span> <span data-ttu-id="f84a1-319">В некоторых случаях в результате важного обновления несогласованные версии пакетов могут привести к нарушению работы приложения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-319">In some cases, incoherent packages may break an app when performing major upgrades.</span></span> <span data-ttu-id="f84a1-320">Большинство таких неполадок можно устранить, удалив папки `bin` и `obj` из проекта, очистив кэши пакетов в каталогах `%UserProfile%\.nuget\packages\` и `%LocalAppData%\Nuget\v3-cache`, восстановив проект и полностью удалив предыдущее развертывание в системе перед повторным развертыванием приложения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-320">You can fix most of these issues by deleting the `bin` and `obj` folders in the project, clearing package caches at `%UserProfile%\.nuget\packages\` and `%LocalAppData%\Nuget\v3-cache`, restoring the project, and confirming that your prior deployment on the system has been completely deleted prior to re-deploying the app.</span></span>

>[!TIP]
> <span data-ttu-id="f84a1-321">Чтобы упростить очистку кэшей пакетов, можно получить средство `NuGet.exe` с сайта [NuGet.org](https://www.nuget.org/), добавить его в каталог PATH системы и выполнить в командной строке команду `nuget locals all -clear`.</span><span class="sxs-lookup"><span data-stu-id="f84a1-321">A convenient way to clear package caches is to obtain the `NuGet.exe` tool from [NuGet.org](https://www.nuget.org/), add it to your system PATH, and execute `nuget locals all -clear` from a command prompt.</span></span>

## <a name="common-errors"></a><span data-ttu-id="f84a1-322">Распространенные ошибки</span><span class="sxs-lookup"><span data-stu-id="f84a1-322">Common errors</span></span>

<span data-ttu-id="f84a1-323">Приведенный ниже перечень ошибок не является исчерпывающим.</span><span class="sxs-lookup"><span data-stu-id="f84a1-323">The following is not a complete list of errors.</span></span> <span data-ttu-id="f84a1-324">Если у вас возникла другая ошибка, приведите сообщение о ней в разделе комментариев ниже.</span><span class="sxs-lookup"><span data-stu-id="f84a1-324">Should you encounter an error not listed here, please leave a detailed error message in the comments section below.</span></span>

### <a name="installer-unable-to-obtain-vc-redistributable"></a><span data-ttu-id="f84a1-325">Установщику не удается получить распространяемый компонент VC++</span><span class="sxs-lookup"><span data-stu-id="f84a1-325">Installer unable to obtain VC++ Redistributable</span></span>

* <span data-ttu-id="f84a1-326">**Исключение установщика:** 0x80072efd or 0x80072f76 — неопределенная ошибка</span><span class="sxs-lookup"><span data-stu-id="f84a1-326">**Installer Exception:** 0x80072efd or 0x80072f76 - Unspecified error</span></span>

* <span data-ttu-id="f84a1-327">**Исключение журнала установщика&#8224;:** ошибка 0x80072efd или 0x80072f76: не удалось выполнить пакет EXE</span><span class="sxs-lookup"><span data-stu-id="f84a1-327">**Installer Log Exception&#8224;:** Error 0x80072efd or 0x80072f76: Failed to execute EXE package</span></span>

  <span data-ttu-id="f84a1-328">&#8224;Журнал находится в папке C:\Users\\{ПОЛЬЗОВАТЕЛЬ}\AppData\Local\Temp\dd_DotNetCoreWinSvrHosting__{метка_времени}.log.</span><span class="sxs-lookup"><span data-stu-id="f84a1-328">&#8224;The log is located at C:\Users\\{USER}\AppData\Local\Temp\dd_DotNetCoreWinSvrHosting__{timestamp}.log.</span></span>

<span data-ttu-id="f84a1-329">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="f84a1-329">Troubleshooting:</span></span>

* <span data-ttu-id="f84a1-330">Если при установке пакета размещения сервера у системы нет доступа к Интернету, это исключение возникает, когда у установщика нет возможности получить *Распространяемый компонент Microsoft Visual C++ 2015*.</span><span class="sxs-lookup"><span data-stu-id="f84a1-330">If the system does not have Internet access while installing the server hosting bundle, this exception will occur when the installer is prevented from obtaining the *Microsoft Visual C++ 2015 Redistributable*.</span></span> <span data-ttu-id="f84a1-331">Получить установщик можно в [Центре загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=53840).</span><span class="sxs-lookup"><span data-stu-id="f84a1-331">You may obtain an installer from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=53840).</span></span> <span data-ttu-id="f84a1-332">Если работа установщика завершается сбоем, возможно, вы не сможете получить среду выполнения .NET Core, необходимую для размещения зависимых от платформы сборок.</span><span class="sxs-lookup"><span data-stu-id="f84a1-332">If the installer fails, you may not receive the .NET Core runtime required to host framework-dependent deployments.</span></span> <span data-ttu-id="f84a1-333">Если вы планируете размещать зависимые от платформы развертывания, убедитесь в том, что среда выполнения установлена, в окне "Программы и компоненты".</span><span class="sxs-lookup"><span data-stu-id="f84a1-333">If you plan to host framework-dependent deployments, confirm that the runtime is installed in Programs &amp; Features.</span></span> <span data-ttu-id="f84a1-334">Получить установщик среды выполнения можно на [странице загрузки .NET](https://www.microsoft.com/net/download/core).</span><span class="sxs-lookup"><span data-stu-id="f84a1-334">You may obtain a runtime installer from [.NET Downloads](https://www.microsoft.com/net/download/core).</span></span> <span data-ttu-id="f84a1-335">После установки среды выполнения перезагрузите систему или перезапустите службы IIS, выполнив в командной строке команду **net stop was /y**, а затем — команду **net start w3svc**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-335">After installing the runtime, restart the system or restart IIS by executing **net stop was /y** followed by **net start w3svc** from a command prompt.</span></span>

### <a name="os-upgrade-removed-the-32-bit-aspnet-core-module"></a><span data-ttu-id="f84a1-336">При обновлении ОС был удален 32-разрядный модуль ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="f84a1-336">OS upgrade removed the 32-bit ASP.NET Core Module</span></span>

* <span data-ttu-id="f84a1-337">**Журнал приложений:** не удалось загрузить модуль DLL **C:\WINDOWS\system32\inetsrv\aspnetcore.dll**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-337">**Application Log:** The Module DLL **C:\WINDOWS\system32\inetsrv\aspnetcore.dll** failed to load.</span></span> <span data-ttu-id="f84a1-338">Ошибочные данные.</span><span class="sxs-lookup"><span data-stu-id="f84a1-338">The data is the error.</span></span>

<span data-ttu-id="f84a1-339">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="f84a1-339">Troubleshooting:</span></span>

* <span data-ttu-id="f84a1-340">Не относящиеся к ОС файлы в каталоге **C:\Windows\SysWOW64\inetsrv** не сохраняются при обновлении ОС.</span><span class="sxs-lookup"><span data-stu-id="f84a1-340">Non-OS files in the **C:\Windows\SysWOW64\inetsrv** directory are not preserved during an OS upgrade.</span></span> <span data-ttu-id="f84a1-341">Если вы установили модуль ASP.NET Core до обновления ОС, а после обновления пытаетесь запустить любой пул приложений в 32-разрядном режиме, возникает эта ошибка.</span><span class="sxs-lookup"><span data-stu-id="f84a1-341">If you have the ASP.NET Core Module installed prior to an OS upgrade and then try to run any AppPool in 32-bit mode after an OS upgrade, you will encounter this issue.</span></span> <span data-ttu-id="f84a1-342">После обновления ОС восстановите модуль ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="f84a1-342">After an OS upgrade, repair the ASP.NET Core Module.</span></span> <span data-ttu-id="f84a1-343">См. раздел [Установка пакета размещения .NET Core для Windows Server](#install-the-net-core-windows-server-hosting-bundle).</span><span class="sxs-lookup"><span data-stu-id="f84a1-343">See [Install the .NET Core Windows Server Hosting bundle](#install-the-net-core-windows-server-hosting-bundle).</span></span> <span data-ttu-id="f84a1-344">При запуске установщика выберите вариант **Восстановить**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-344">Select **Repair** when you run the installer.</span></span>

### <a name="platform-conflicts-with-rid"></a><span data-ttu-id="f84a1-345">Конфликты платформы с относительным идентификатором</span><span class="sxs-lookup"><span data-stu-id="f84a1-345">Platform conflicts with RID</span></span>

* <span data-ttu-id="f84a1-346">**Браузер:** ошибка HTTP 502.5 — сбой процесса</span><span class="sxs-lookup"><span data-stu-id="f84a1-346">**Browser:** HTTP Error 502.5 - Process Failure</span></span>

* <span data-ttu-id="f84a1-347">**Журнал приложений:** приложению MACHINE/WEBROOT/APPHOST/MY_APPLICATION с физическим корневым каталогом C:\{PATH}\' не удалось запустить процесс с помощью команды "C:\\{PATH}\my_application.{exe|dll}"; код ошибки = 0x80004005 : ff.</span><span class="sxs-lookup"><span data-stu-id="f84a1-347">**Application Log:** Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\{PATH}\' failed to start process with commandline '"C:\\{PATH}\my_application.{exe|dll}" ', ErrorCode = '0x80004005 : ff.</span></span>

* <span data-ttu-id="f84a1-348">**Журнал модуля ASP.NET Core:** необработанное исключение System.BadImageFormatException: не удалось загрузить файл или сборку my_application.dll.</span><span class="sxs-lookup"><span data-stu-id="f84a1-348">**ASP.NET Core Module Log:** Unhandled Exception: System.BadImageFormatException: Could not load file or assembly 'my_application.dll'.</span></span> <span data-ttu-id="f84a1-349">Была сделана попытка загрузить программу, имеющую неверный формат.</span><span class="sxs-lookup"><span data-stu-id="f84a1-349">An attempt was made to load a program with an incorrect format.</span></span>

<span data-ttu-id="f84a1-350">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="f84a1-350">Troubleshooting:</span></span>

* <span data-ttu-id="f84a1-351">Убедитесь в том, что приложение выполняется локально в Kestrel.</span><span class="sxs-lookup"><span data-stu-id="f84a1-351">Confirm that the application runs locally on Kestrel.</span></span> <span data-ttu-id="f84a1-352">Сбой процесса может быть результатом проблемы в приложении.</span><span class="sxs-lookup"><span data-stu-id="f84a1-352">A process failure might be the result of a problem within the application.</span></span> <span data-ttu-id="f84a1-353">Дополнительные сведения см. в разделе [Советы по устранению неполадок](#troubleshooting-tips).</span><span class="sxs-lookup"><span data-stu-id="f84a1-353">For more information, see [Troubleshooting tips](#troubleshooting-tips).</span></span>

* <span data-ttu-id="f84a1-354">Убедитесь в том, что в файле *CSPROJ* не задано значение `<PlatformTarget>`, конфликтующее с относительным идентификатором (RID).</span><span class="sxs-lookup"><span data-stu-id="f84a1-354">Confirm that you didn't set a `<PlatformTarget>` in your *.csproj* that conflicts with the RID.</span></span> <span data-ttu-id="f84a1-355">Например, не указывайте `<PlatformTarget>` со значением `x86`, если вы выполняете публикацию с идентификатором RID `win10-x64` с помощью команды *dotnet publish -c Release -r win10-x64* или задавая `<RuntimeIdentifiers>` в файле *CSPROJ* равным `win10-x64`.</span><span class="sxs-lookup"><span data-stu-id="f84a1-355">For example, don't specify a `<PlatformTarget>` of `x86` and publish with an RID of `win10-x64`, either by using *dotnet publish -c Release -r win10-x64* or by setting the `<RuntimeIdentifiers>` in your *.csproj* to `win10-x64`.</span></span> <span data-ttu-id="f84a1-356">Проект будет опубликован без предупреждения или сообщения об ошибке, однако при запуске в системе произойдет сбой, а в журнале будут зарегистрированы указанные выше исключения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-356">The project will publish without warning or error but fail with the above logged exceptions on the system.</span></span>

* <span data-ttu-id="f84a1-357">Если это исключение возникает для развертывания приложений Azure при обновлении приложения и развертывании более новых сборок, вручную удалите все файлы предыдущего развертывания.</span><span class="sxs-lookup"><span data-stu-id="f84a1-357">If this exception occurs for an Azure Apps deployment when upgrading an application and deploying newer assemblies, manually delete all files from the prior deployment.</span></span> <span data-ttu-id="f84a1-358">Если останутся несовместимые сборки, то при развертывании обновленного приложения это может привести к исключению `System.BadImageFormatException`.</span><span class="sxs-lookup"><span data-stu-id="f84a1-358">Lingering incompatible assemblies can result in a `System.BadImageFormatException` exception when deploying an upgraded app.</span></span>

### <a name="uri-endpoint-wrong-or-stopped-website"></a><span data-ttu-id="f84a1-359">Неправильная конечная точка URI, либо веб-сайт остановлен</span><span class="sxs-lookup"><span data-stu-id="f84a1-359">URI endpoint wrong or stopped website</span></span>

* <span data-ttu-id="f84a1-360">**Браузер:** ERR_CONNECTION_REFUSED</span><span class="sxs-lookup"><span data-stu-id="f84a1-360">**Browser:** ERR_CONNECTION_REFUSED</span></span>

* <span data-ttu-id="f84a1-361">**Журнал приложений:** нет записи</span><span class="sxs-lookup"><span data-stu-id="f84a1-361">**Application Log:** No entry</span></span>

* <span data-ttu-id="f84a1-362">**Журнал модуля ASP.NET Core:** файл журнала не создан</span><span class="sxs-lookup"><span data-stu-id="f84a1-362">**ASP.NET Core Module Log:** Log file not created</span></span>

<span data-ttu-id="f84a1-363">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="f84a1-363">Troubleshooting:</span></span>

* <span data-ttu-id="f84a1-364">Убедитесь в том, что для приложения используется правильная конечная точка URI.</span><span class="sxs-lookup"><span data-stu-id="f84a1-364">Confirm you are using the correct URI endpoint for the application.</span></span> <span data-ttu-id="f84a1-365">Проверьте привязки.</span><span class="sxs-lookup"><span data-stu-id="f84a1-365">Check your bindings.</span></span>

* <span data-ttu-id="f84a1-366">Проверьте, не находится ли веб-сайт IIS в состоянии *Остановлен*.</span><span class="sxs-lookup"><span data-stu-id="f84a1-366">Confirm that the IIS website is not in the *Stopped* state.</span></span>

### <a name="corewebengine-or-w3svc-server-features-disabled"></a><span data-ttu-id="f84a1-367">Компонент сервера CoreWebEngine или W3SVC отключен</span><span class="sxs-lookup"><span data-stu-id="f84a1-367">CoreWebEngine or W3SVC server features disabled</span></span>

* <span data-ttu-id="f84a1-368">**Исключение ОС:** для использования модуля ASP.NET Core должны быть установлены компоненты IIS 7.0 CoreWebEngine и W3SVC.</span><span class="sxs-lookup"><span data-stu-id="f84a1-368">**OS Exception:** The IIS 7.0 CoreWebEngine and W3SVC features must be installed to use the ASP.NET Core Module.</span></span>

<span data-ttu-id="f84a1-369">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="f84a1-369">Troubleshooting:</span></span>

* <span data-ttu-id="f84a1-370">Убедитесь в том, что включена соответствующая роль и компоненты.</span><span class="sxs-lookup"><span data-stu-id="f84a1-370">Confirm that you have enabled the proper role and features.</span></span> <span data-ttu-id="f84a1-371">См. раздел [Конфигурация IIS](#iis-configuration).</span><span class="sxs-lookup"><span data-stu-id="f84a1-371">See [IIS Configuration](#iis-configuration).</span></span>

### <a name="incorrect-website-physical-path-or-application-missing"></a><span data-ttu-id="f84a1-372">Неправильный физический путь к веб-сайту, либо отсутствует приложение</span><span class="sxs-lookup"><span data-stu-id="f84a1-372">Incorrect website physical path or application missing</span></span>

* <span data-ttu-id="f84a1-373">**Браузер:** 403 — запрещено. В доступе отказано **--ИЛИ--** 403.14 — запрещено. Веб-сервер настроен таким образом, чтобы не формировать список содержимого каталога.</span><span class="sxs-lookup"><span data-stu-id="f84a1-373">**Browser:** 403 Forbidden - Access is denied **--OR--** 403.14 Forbidden - The Web server is configured to not list the contents of this directory.</span></span>

* <span data-ttu-id="f84a1-374">**Журнал приложений:** нет записи</span><span class="sxs-lookup"><span data-stu-id="f84a1-374">**Application Log:** No entry</span></span>

* <span data-ttu-id="f84a1-375">**Журнал модуля ASP.NET Core:** файл журнала не создан</span><span class="sxs-lookup"><span data-stu-id="f84a1-375">**ASP.NET Core Module Log:** Log file not created</span></span>

<span data-ttu-id="f84a1-376">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="f84a1-376">Troubleshooting:</span></span>

* <span data-ttu-id="f84a1-377">Проверьте **основные настройки** веб-сайта IIS и физическую папку приложения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-377">Check the IIS website **Basic Settings** and the physical application folder.</span></span> <span data-ttu-id="f84a1-378">Убедитесь в том, что приложение находится в папке по **физическому пути** веб-сайта IIS.</span><span class="sxs-lookup"><span data-stu-id="f84a1-378">Confirm that the application is in the folder at the IIS website **Physical path**.</span></span>

### <a name="incorrect-role-module-not-installed-or-incorrect-permissions"></a><span data-ttu-id="f84a1-379">Неправильная роль, модуль не установлен либо неверные разрешения</span><span class="sxs-lookup"><span data-stu-id="f84a1-379">Incorrect role, module not installed, or incorrect permissions</span></span>

* <span data-ttu-id="f84a1-380">**Браузер:** 500.19 — внутренняя ошибка сервера. Запрашиваемая страница недоступна из-за неверной конфигурации данных для этой страницы.</span><span class="sxs-lookup"><span data-stu-id="f84a1-380">**Browser:** 500.19 Internal Server Error - The requested page cannot be accessed because the related configuration data for the page is invalid.</span></span>

* <span data-ttu-id="f84a1-381">**Журнал приложений:** нет записи</span><span class="sxs-lookup"><span data-stu-id="f84a1-381">**Application Log:** No entry</span></span>

* <span data-ttu-id="f84a1-382">**Журнал модуля ASP.NET Core:** файл журнала не создан</span><span class="sxs-lookup"><span data-stu-id="f84a1-382">**ASP.NET Core Module Log:** Log file not created</span></span>

<span data-ttu-id="f84a1-383">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="f84a1-383">Troubleshooting:</span></span>

* <span data-ttu-id="f84a1-384">Убедитесь в том, что включена соответствующая роль.</span><span class="sxs-lookup"><span data-stu-id="f84a1-384">Confirm that you have enabled the proper role.</span></span> <span data-ttu-id="f84a1-385">См. раздел [Конфигурация IIS](#iis-configuration).</span><span class="sxs-lookup"><span data-stu-id="f84a1-385">See [IIS Configuration](#iis-configuration).</span></span>

* <span data-ttu-id="f84a1-386">На странице **Программы и компоненты** убедитесь в том, что установлен **модуль Microsoft ASP.NET Core**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-386">Check **Programs &amp; Features** and confirm that the **Microsoft ASP.NET Core Module** has been installed.</span></span> <span data-ttu-id="f84a1-387">Если **модуль Microsoft ASP.NET Core** отсутствует в списке установленных программ, установите его.</span><span class="sxs-lookup"><span data-stu-id="f84a1-387">If the **Microsoft ASP.NET Core Module** is not present in the list of installed programs, install the module.</span></span> <span data-ttu-id="f84a1-388">См. раздел [Установка пакета размещения .NET Core для Windows Server](#install-the-net-core-windows-server-hosting-bundle).</span><span class="sxs-lookup"><span data-stu-id="f84a1-388">See [Install the .NET Core Windows Server Hosting bundle](#install-the-net-core-windows-server-hosting-bundle).</span></span>

* <span data-ttu-id="f84a1-389">Убедитесь в том, что параметр **Пул приложений > Модель процесса > Удостоверение** имеет значение **ApplicationPoolIdentity** или что у пользовательского удостоверения есть нужные разрешения на доступ к папке развертывания приложения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-389">Make sure that the **Application Pool > Process Model > Identity** is set to **ApplicationPoolIdentity** or your custom identity has the correct permissions to access the application's deployment folder.</span></span>

### <a name="incorrect-processpath-missing-path-variable-hosting-bundle-not-installed-systemiis-not-restarted-vc-redistributable-not-installed-or-dotnetexe-access-violation"></a><span data-ttu-id="f84a1-390">Неправильное значение processPath, отсутствует переменная PATH, пакет размещения не установлен, система или службы IIS не перезапущены, не установлен распространяемый компонент VC++ либо нарушены права доступа к dotnet.exe</span><span class="sxs-lookup"><span data-stu-id="f84a1-390">Incorrect processPath, missing PATH variable, hosting bundle not installed, system/IIS not restarted, VC++ Redistributable not installed, or dotnet.exe access violation</span></span>

* <span data-ttu-id="f84a1-391">**Браузер:** ошибка HTTP 502.5 — сбой процесса</span><span class="sxs-lookup"><span data-stu-id="f84a1-391">**Browser:** HTTP Error 502.5 - Process Failure</span></span>

* <span data-ttu-id="f84a1-392">**Журнал приложений:** приложению MACHINE/WEBROOT/APPHOST/MY_APPLICATION с физическим корневым каталогом C:\\{PATH}\' не удалось запустить процесс с помощью команды ".\my_application.exe"; код ошибки = 0x80070002 : 0.</span><span class="sxs-lookup"><span data-stu-id="f84a1-392">**Application Log:** Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\\{PATH}\' failed to start process with commandline '".\my_application.exe" ', ErrorCode = '0x80070002 : 0.</span></span>

* <span data-ttu-id="f84a1-393">**Журнал модуля ASP.NET Core:** файл журнала создан, но пуст</span><span class="sxs-lookup"><span data-stu-id="f84a1-393">**ASP.NET Core Module Log:** Log file created but empty</span></span>

<span data-ttu-id="f84a1-394">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="f84a1-394">Troubleshooting:</span></span>

* <span data-ttu-id="f84a1-395">Убедитесь в том, что приложение выполняется локально в Kestrel.</span><span class="sxs-lookup"><span data-stu-id="f84a1-395">Confirm that the application runs locally on Kestrel.</span></span> <span data-ttu-id="f84a1-396">Сбой процесса может быть результатом проблемы в приложении.</span><span class="sxs-lookup"><span data-stu-id="f84a1-396">A process failure might be the result of a problem within the application.</span></span> <span data-ttu-id="f84a1-397">Дополнительные сведения см. в разделе [Советы по устранению неполадок](#troubleshooting-tips).</span><span class="sxs-lookup"><span data-stu-id="f84a1-397">For more information, see [Troubleshooting tips](#troubleshooting-tips).</span></span>

* <span data-ttu-id="f84a1-398">Проверьте атрибут *processPath* элемента `<aspNetCore>` в файле *web.config*. Он должен иметь значение *dotnet* для зависимого от платформы развертывания или *.\мое_приложение.exe* для автономного развертывания.</span><span class="sxs-lookup"><span data-stu-id="f84a1-398">Check the *processPath* attribute on the `<aspNetCore>` element in *web.config* to confirm that it is *dotnet* for a framework-dependent deployment or *.\my_application.exe* for a self-contained deployment.</span></span>

* <span data-ttu-id="f84a1-399">Для зависимого от платформы развертывания файл *dotnet.exe* может быть недоступен по пути, указанному в переменной PATH.</span><span class="sxs-lookup"><span data-stu-id="f84a1-399">For a framework-dependent deployment, *dotnet.exe* might not be accessible via the PATH settings.</span></span> <span data-ttu-id="f84a1-400">Убедитесь в том, что папка *C:\Program Files\dotnet\* существует в системных параметрах PATH.</span><span class="sxs-lookup"><span data-stu-id="f84a1-400">Confirm that *C:\Program Files\dotnet\* exists in the System PATH settings.</span></span>

* <span data-ttu-id="f84a1-401">В случае с зависимым от платформы развертыванием файл *dotnet.exe* может быть недоступен для удостоверения пользователя, используемого для пула приложений.</span><span class="sxs-lookup"><span data-stu-id="f84a1-401">For a framework-dependent deployment, *dotnet.exe* might not be accessible for the user identity of the Application Pool.</span></span> <span data-ttu-id="f84a1-402">Убедитесь в том, что удостоверение пользователя AppPool имеет доступ к каталогу *C:\Program Files\dotnet*.</span><span class="sxs-lookup"><span data-stu-id="f84a1-402">Confirm that the AppPool user identity has access to the *C:\Program Files\dotnet* directory.</span></span> <span data-ttu-id="f84a1-403">Убедитесь в отсутствии запрещающих правил для удостоверения пользователя AppPool в каталоге *C:\Program Files\dotnet* и каталоге приложения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-403">Confirm that there are no deny rules configured for the AppPool user identity on the *C:\Program Files\dotnet* and application directories.</span></span>

* <span data-ttu-id="f84a1-404">Возможно, вы произвели зависимое от платформы развертывание и установили .NET Core, не перезапустив после этого службу IIS.</span><span class="sxs-lookup"><span data-stu-id="f84a1-404">You may have deployed a framework-dependent deployment and installed .NET Core without restarting IIS.</span></span> <span data-ttu-id="f84a1-405">Перезагрузите сервер или перезапустите службы IIS, выполнив в командной строке команду **net stop was /y**, а затем — команду **net start w3svc**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-405">Either restart the server or restart IIS by executing **net stop was /y** followed by **net start w3svc** from a command prompt.</span></span>

* <span data-ttu-id="f84a1-406">Возможно, вы произвели зависимое от платформы развертывание, не установив среду выполнения .NET Core в размещающей системе.</span><span class="sxs-lookup"><span data-stu-id="f84a1-406">You may have deployed a framework-dependent deployment without installing the .NET Core runtime on the hosting system.</span></span> <span data-ttu-id="f84a1-407">Если вы пытаетесь выполнить зависимое от платформы развертывание, не установив среду выполнения .NET Core, запустите в системе **установщик пакета размещения .NET Core для Windows Server**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-407">If you're attempting to deploy a framework-dependent deployment and have not installed the .NET Core runtime, run the **.NET Core Windows Server Hosting bundle installer** on the system.</span></span> <span data-ttu-id="f84a1-408">См. раздел [Установка пакета размещения .NET Core для Windows Server](#install-the-net-core-windows-server-hosting-bundle).</span><span class="sxs-lookup"><span data-stu-id="f84a1-408">See [Install the .NET Core Windows Server Hosting bundle](#install-the-net-core-windows-server-hosting-bundle).</span></span> <span data-ttu-id="f84a1-409">Если вы пытаетесь установить среду выполнения .NET Core в системе, не имеющей подключения к Интернету, получите среду выполнения на [странице загрузки .NET](https://www.microsoft.com/net/download/core) и запустите установщик пакета размещения, чтобы установить модуль ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="f84a1-409">If you are attempting to install the .NET Core runtime on a system without an Internet connection, obtain the runtime from [.NET Downloads](https://www.microsoft.com/net/download/core) and run the hosting bundle installer to install the ASP.NET Core Module.</span></span> <span data-ttu-id="f84a1-410">Завершите установку, перезагрузив систему или перезапустив службы IIS. Для этого выполните в командной строке команду **net stop was /y**, а затем — команду **net start w3svc**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-410">Complete the installation by restarting the system or restarting IIS by executing **net stop was /y** followed by **net start w3svc** from a command prompt.</span></span>

* <span data-ttu-id="f84a1-411">Возможно, вы произвели зависимое от платформы развертывание и установили .NET Core, не перезагрузив после этого систему или не перезапустив службы IIS.</span><span class="sxs-lookup"><span data-stu-id="f84a1-411">You may have deployed a framework-dependent deployment and installed .NET Core without restarting the system/IIS.</span></span> <span data-ttu-id="f84a1-412">Перезагрузите систему или перезапустите службы IIS, выполнив в командной строке команду **net stop was /y**, а затем — команду **net start w3svc**.</span><span class="sxs-lookup"><span data-stu-id="f84a1-412">Either restart the system or restart IIS by executing **net stop was /y** followed by **net start w3svc** from a command prompt.</span></span>

* <span data-ttu-id="f84a1-413">Возможно, вы произвели зависимое от платформы развертывание, не установив в системе *Распространяемый компонент Microsoft Visual C++ 2015 (64-разрядный)*.</span><span class="sxs-lookup"><span data-stu-id="f84a1-413">You may have deployed a framework-dependent deployment and the *Microsoft Visual C++ 2015 Redistributable (x64)* is not installed on the system.</span></span> <span data-ttu-id="f84a1-414">Получить установщик можно в [Центре загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=53840).</span><span class="sxs-lookup"><span data-stu-id="f84a1-414">You may obtain an installer from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=53840).</span></span>

### <a name="incorrect-arguments-of-aspnetcore-element"></a><span data-ttu-id="f84a1-415">Неверные аргументы элемента \<aspNetCore\></span><span class="sxs-lookup"><span data-stu-id="f84a1-415">Incorrect arguments of \<aspNetCore\> element</span></span>

* <span data-ttu-id="f84a1-416">**Браузер:** ошибка HTTP 502.5 — сбой процесса</span><span class="sxs-lookup"><span data-stu-id="f84a1-416">**Browser:** HTTP Error 502.5 - Process Failure</span></span>

* <span data-ttu-id="f84a1-417">**Журнал приложений:** приложению MACHINE/WEBROOT/APPHOST/MY_APPLICATION с физическим корневым каталогом C:\\{PATH}\' не удалось запустить процесс с помощью команды ""dotnet" \my_application.dll"; код ошибки = 0x80004005 : 80008081.</span><span class="sxs-lookup"><span data-stu-id="f84a1-417">**Application Log:** Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\\{PATH}\' failed to start process with commandline '"dotnet" .\my_application.dll', ErrorCode = '0x80004005 : 80008081.</span></span>

* <span data-ttu-id="f84a1-418">**Журнал модуля ASP.NET Core:** Выполняемое приложение не существует: "PATH\my_application.dll"</span><span class="sxs-lookup"><span data-stu-id="f84a1-418">**ASP.NET Core Module Log:** The application to execute does not exist: 'PATH\my_application.dll'</span></span>

<span data-ttu-id="f84a1-419">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="f84a1-419">Troubleshooting:</span></span>

* <span data-ttu-id="f84a1-420">Убедитесь в том, что приложение выполняется локально в Kestrel.</span><span class="sxs-lookup"><span data-stu-id="f84a1-420">Confirm that the application runs locally on Kestrel.</span></span> <span data-ttu-id="f84a1-421">Сбой процесса может быть результатом проблемы в приложении.</span><span class="sxs-lookup"><span data-stu-id="f84a1-421">A process failure might be the result of a problem within the application.</span></span> <span data-ttu-id="f84a1-422">Дополнительные сведения см. в разделе [Советы по устранению неполадок](#troubleshooting-tips).</span><span class="sxs-lookup"><span data-stu-id="f84a1-422">For more information, see [Troubleshooting tips](#troubleshooting-tips).</span></span>

* <span data-ttu-id="f84a1-423">Проверьте атрибут *arguments* элемента `<aspNetCore>` в файле *web.config* и удостоверьтесь, что его значение: а) имеет вид *.\<мое_приложение>.dll* для развертывания, зависящего от платформы; б) отсутствует, содержит пустую строку (*arguments=""*) или список аргументов вашего приложения (*arguments="arg1, arg2, ..."*) для автономного развертывания.</span><span class="sxs-lookup"><span data-stu-id="f84a1-423">Examine the *arguments* attribute on the `<aspNetCore>` element in *web.config* to confirm that it is either (a) *.\my_application.dll* for a framework-dependent deployment; or (b) not present, an empty string (*arguments=""*), or a list of your application's arguments (*arguments="arg1, arg2, ..."*) for a self-contained deployment.</span></span>

### <a name="missing-net-framework-version"></a><span data-ttu-id="f84a1-424">Отсутствует версия платформы .NET Framework</span><span class="sxs-lookup"><span data-stu-id="f84a1-424">Missing .NET Framework version</span></span>

* <span data-ttu-id="f84a1-425">**Браузер:** 502.3 — неверный шлюз. При попытке маршрутизации запроса произошла ошибка подключения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-425">**Browser:** 502.3 Bad Gateway - There was a connection error while trying to route the request.</span></span>

* <span data-ttu-id="f84a1-426">**Журнал приложений:** Код ошибки = приложению MACHINE/WEBROOT/APPHOST/MY_APPLICATION с физическим корневым каталогом C:\\{PATH}\' не удалось запустить процесс с помощью команды ""dotnet" \my_application.dll"; код ошибки = 0x80004005 : 80008081.</span><span class="sxs-lookup"><span data-stu-id="f84a1-426">**Application Log:** ErrorCode = Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\\{PATH}\' failed to start process with commandline '"dotnet" .\my_application.dll', ErrorCode = '0x80004005 : 80008081.</span></span>

* <span data-ttu-id="f84a1-427">**Журнал модуля ASP.NET Core:** Исключение из-за отсутствия метода, файла или сборки.</span><span class="sxs-lookup"><span data-stu-id="f84a1-427">**ASP.NET Core Module Log:** Missing method, file, or assembly exception.</span></span> <span data-ttu-id="f84a1-428">Метод, файл или сборка, указанные в исключении, представляют собой метод, файл или сборку .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="f84a1-428">The method, file, or assembly specified in the exception is a .NET Framework method, file, or assembly.</span></span>

<span data-ttu-id="f84a1-429">Устранение неполадок:</span><span class="sxs-lookup"><span data-stu-id="f84a1-429">Troubleshooting:</span></span>

* <span data-ttu-id="f84a1-430">Установите версию .NET Framework, отсутствующую в системе.</span><span class="sxs-lookup"><span data-stu-id="f84a1-430">Install the .NET Framework version missing from the system.</span></span>

* <span data-ttu-id="f84a1-431">В случае с зависимым от платформы развертыванием убедитесь в том, что в системе установлена нужная среда выполнения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-431">For a framework-dependent deployment, confirm that you have the correct runtime installed on the system.</span></span> <span data-ttu-id="f84a1-432">Например, если вы обновляете проект с версии 1.0 до версии 1.1, развертываете его в размещающей системе, а затем получаете это исключение, проверьте, установлена ли в системе платформа версии 1.1.</span><span class="sxs-lookup"><span data-stu-id="f84a1-432">For example if you upgrade a project from 1.0 to 1.1, deploy to the hosting system, and receive this exception, ensure you install the 1.1 framework on the hosting system.</span></span>

### <a name="stopped-application-pool"></a><span data-ttu-id="f84a1-433">Пул приложений остановлен</span><span class="sxs-lookup"><span data-stu-id="f84a1-433">Stopped Application Pool</span></span>

* <span data-ttu-id="f84a1-434">**Браузер:** 503 — служба недоступна</span><span class="sxs-lookup"><span data-stu-id="f84a1-434">**Browser:** 503 Service Unavailable</span></span>

* <span data-ttu-id="f84a1-435">**Журнал приложений:** нет записи</span><span class="sxs-lookup"><span data-stu-id="f84a1-435">**Application Log:** No entry</span></span>

* <span data-ttu-id="f84a1-436">**Журнал модуля ASP.NET Core:** файл журнала не создан</span><span class="sxs-lookup"><span data-stu-id="f84a1-436">**ASP.NET Core Module Log:** Log file not created</span></span>

<span data-ttu-id="f84a1-437">Устранение неполадок</span><span class="sxs-lookup"><span data-stu-id="f84a1-437">Troubleshooting</span></span>

* <span data-ttu-id="f84a1-438">Проверьте, не находится ли пул приложений в состоянии *Остановлен*.</span><span class="sxs-lookup"><span data-stu-id="f84a1-438">Confirm that the Application Pool is not in the *Stopped* state.</span></span>

### <a name="iis-integration-middleware-not-implemented"></a><span data-ttu-id="f84a1-439">ПО промежуточного слоя для интеграции IIS не внедрено</span><span class="sxs-lookup"><span data-stu-id="f84a1-439">IIS Integration middleware not implemented</span></span>

* <span data-ttu-id="f84a1-440">**Браузер:** ошибка HTTP 502.5 — сбой процесса</span><span class="sxs-lookup"><span data-stu-id="f84a1-440">**Browser:** HTTP Error 502.5 - Process Failure</span></span>

* <span data-ttu-id="f84a1-441">**Журнал приложений:** приложение MACHINE/WEBROOT/APPHOST/MY_APPLICATION с физическим корневым каталогом C:\\{PATH}\' создало процесс с помощью команды "C:\\{PATH}\my_application.{exe|dll}", однако при этом либо произошел сбой, либо не был получен ответ, либо не прослушивался указанный порт {PORT}; код ошибки = 0x800705b4</span><span class="sxs-lookup"><span data-stu-id="f84a1-441">**Application Log:** Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\\{PATH}\' created process with commandline '"C:\\{PATH}\my_application.{exe|dll}" ' but either crashed or did not reponse or did not listen on the given port '{PORT}', ErrorCode = '0x800705b4'</span></span>

* <span data-ttu-id="f84a1-442">**Журнал модуля ASP.NET Core:** файл журнала создан, и в нем нет сведений о неправильной работе.</span><span class="sxs-lookup"><span data-stu-id="f84a1-442">**ASP.NET Core Module Log:** Log file created and shows normal operation.</span></span>

<span data-ttu-id="f84a1-443">Устранение неполадок</span><span class="sxs-lookup"><span data-stu-id="f84a1-443">Troubleshooting</span></span>

* <span data-ttu-id="f84a1-444">Убедитесь в том, что приложение выполняется локально в Kestrel.</span><span class="sxs-lookup"><span data-stu-id="f84a1-444">Confirm that the application runs locally on Kestrel.</span></span> <span data-ttu-id="f84a1-445">Сбой процесса может быть результатом проблемы в приложении.</span><span class="sxs-lookup"><span data-stu-id="f84a1-445">A process failure might be the result of a problem within the application.</span></span> <span data-ttu-id="f84a1-446">Дополнительные сведения см. в разделе [Советы по устранению неполадок](#troubleshooting-tips).</span><span class="sxs-lookup"><span data-stu-id="f84a1-446">For more information, see [Troubleshooting tips](#troubleshooting-tips).</span></span>

* <span data-ttu-id="f84a1-447">Убедитесь в том, что вы правильно указали ПО промежуточного слоя для интеграции IIS, вызвав метод *.UseIISIntegration()* для объекта *WebHostBuilder()* приложения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-447">Confirm that you have correctly referenced the IIS Integration middleware by calling the *.UseIISIntegration()* method on the application's *WebHostBuilder()*.</span></span>

### <a name="sub-application-includes-a-handlers-section"></a><span data-ttu-id="f84a1-448">Дочернее приложение имеет раздел \<handlers\></span><span class="sxs-lookup"><span data-stu-id="f84a1-448">Sub-application includes a \<handlers\> section</span></span>

* <span data-ttu-id="f84a1-449">**Браузер:** ошибка HTTP 500.19 — внутренняя ошибка сервера</span><span class="sxs-lookup"><span data-stu-id="f84a1-449">**Browser:** HTTP Error 500.19 - Internal Server Error</span></span>

* <span data-ttu-id="f84a1-450">**Журнал приложений:** нет записи</span><span class="sxs-lookup"><span data-stu-id="f84a1-450">**Application Log:** No entry</span></span>

* <span data-ttu-id="f84a1-451">**Журнал модуля ASP.NET Core:** файл журнала создан для корневого приложения, и в нем нет сведений о неправильной работе.</span><span class="sxs-lookup"><span data-stu-id="f84a1-451">**ASP.NET Core Module Log:** Log file created and shows normal operation for the root application.</span></span> <span data-ttu-id="f84a1-452">Файл журнала для дочернего приложения не создан.</span><span class="sxs-lookup"><span data-stu-id="f84a1-452">Log file not created for the sub-application.</span></span>

<span data-ttu-id="f84a1-453">Устранение неполадок</span><span class="sxs-lookup"><span data-stu-id="f84a1-453">Troubleshooting</span></span>

* <span data-ttu-id="f84a1-454">В файле *web.config* дочернего приложения не должно быть раздела `<handlers>`.</span><span class="sxs-lookup"><span data-stu-id="f84a1-454">Confirm that the sub-application's *web.config* file doesn't include a `<handlers>` section.</span></span>

### <a name="application-configuration-general-issue"></a><span data-ttu-id="f84a1-455">Общая проблема с конфигурацией приложения</span><span class="sxs-lookup"><span data-stu-id="f84a1-455">Application configuration general issue</span></span>

* <span data-ttu-id="f84a1-456">**Браузер:** ошибка HTTP 502.5 — сбой процесса</span><span class="sxs-lookup"><span data-stu-id="f84a1-456">**Browser:** HTTP Error 502.5 - Process Failure</span></span>

* <span data-ttu-id="f84a1-457">**Журнал приложений:** приложение MACHINE/WEBROOT/APPHOST/MY_APPLICATION с физическим корневым каталогом C:\\{PATH}\' создало процесс с помощью команды "C:\\{PATH}\my_application.{exe|dll}", однако при этом либо произошел сбой, либо не был получен ответ, либо не прослушивался указанный порт {PORT}; код ошибки = 0x800705b4</span><span class="sxs-lookup"><span data-stu-id="f84a1-457">**Application Log:** Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\\{PATH}\' created process with commandline '"C:\\{PATH}\my_application.{exe|dll}" ' but either crashed or did not reponse or did not listen on the given port '{PORT}', ErrorCode = '0x800705b4'</span></span>

* <span data-ttu-id="f84a1-458">**Журнал модуля ASP.NET Core:** файл журнала создан, но пуст</span><span class="sxs-lookup"><span data-stu-id="f84a1-458">**ASP.NET Core Module Log:** Log file created but empty</span></span>

<span data-ttu-id="f84a1-459">Устранение неполадок</span><span class="sxs-lookup"><span data-stu-id="f84a1-459">Troubleshooting</span></span>

* <span data-ttu-id="f84a1-460">Это общее исключение указывает на то, что процесс не удалось запустить, скорее всего, из-за проблемы с конфигурацией приложения.</span><span class="sxs-lookup"><span data-stu-id="f84a1-460">This general exception indicates that the process failed to start, most likely due to an application configuration issue.</span></span> <span data-ttu-id="f84a1-461">Обратитесь к статье [Структура каталогов](xref:hosting/directory-structure) и убедитесь в том, что развернуты надлежащие файлы и папки приложения, имеются его файлы конфигурации и в них содержатся правильные параметры для приложения и среды.</span><span class="sxs-lookup"><span data-stu-id="f84a1-461">Referring to [Directory Structure](xref:hosting/directory-structure), confirm that your application's deployed files and folders are appropriate and that your application's configuration files are present and contain the correct settings for your app and environment.</span></span> <span data-ttu-id="f84a1-462">Дополнительные сведения см. в разделе [Советы по устранению неполадок](#troubleshooting-tips).</span><span class="sxs-lookup"><span data-stu-id="f84a1-462">For more information, see [Troubleshooting tips](#troubleshooting-tips).</span></span>

## <a name="resources"></a><span data-ttu-id="f84a1-463">Ресурсы</span><span class="sxs-lookup"><span data-stu-id="f84a1-463">Resources</span></span>

* [<span data-ttu-id="f84a1-464">Введение в модуль ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="f84a1-464">Introduction to ASP.NET Core Module</span></span>](xref:fundamentals/servers/aspnet-core-module)

* [<span data-ttu-id="f84a1-465">Справочник по конфигурации модуля ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="f84a1-465">ASP.NET Core Module configuration reference</span></span>](xref:hosting/aspnet-core-module)

* [<span data-ttu-id="f84a1-466">Использование модулей IIS с ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="f84a1-466">Using IIS Modules with ASP.NET Core</span></span>](xref:hosting/iis-modules)

* [<span data-ttu-id="f84a1-467">Введение в ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="f84a1-467">Introduction to ASP.NET Core</span></span>](../index.md)

* [<span data-ttu-id="f84a1-468">Официальный веб-сайт Microsoft IIS</span><span class="sxs-lookup"><span data-stu-id="f84a1-468">The Official Microsoft IIS Site</span></span>](https://www.iis.net/)

* [<span data-ttu-id="f84a1-469">Библиотека Microsoft TechNet: Windows Server</span><span class="sxs-lookup"><span data-stu-id="f84a1-469">Microsoft TechNet Library: Windows Server</span></span>](https://docs.microsoft.com/windows-server/windows-server-versions)
