---
title: "Непрерывное развертывание в Azure с помощью Visual Studio и Git"
author: rick-anderson
description: "Узнайте, как создать веб-приложение ASP.NET Core с помощью Visual Studio и развернуть его в службе приложений Azure, используя Git для непрерывного развертывания."
keywords: ASP.NET Core
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: 2707c7a8-2350-4304-9856-fda58e5c0a16
ms.technology: aspnet
ms.prod: asp.net-core
uid: publishing/azure-continuous-deployment
ms.openlocfilehash: a9efad38b1c75bd3a186b4ec85861357ecf744b9
ms.sourcegitcommit: 9cdbfd0d670d70b9c354216aabee260c52dad5ee
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/12/2017
---
# <a name="continuous-deployment-to-azure-for-aspnet-core-with-visual-studio-and-git"></a>Непрерывное развертывание в Azure для ASP.NET Core с помощью Visual Studio и Git

Автор: [Эрик Рейтан](https://github.com/Erikre) (Erik Reitan)

В этом руководстве показано, как создать веб-приложение ASP.NET Core с помощью Visual Studio и развернуть его из Visual Studio в службе приложений Azure, используя непрерывное развертывание. 

См. также статью [Использование VSTS для сборки и публикации в веб-приложении Azure с помощью непрерывного развертывания](https://www.visualstudio.com/docs/build/get-started/aspnet-4-ci-cd-azure-automatic), в которой показано, как настроить рабочий процесс непрерывной поставки для [службы приложений Azure](https://azure.microsoft.com/documentation/articles/app-service-changes-existing-services/) с помощью Visual Studio Team Services. Непрерывная поставка Azure в Team Services упрощает настройку эффективного конвейера развертывания с целью публикации обновлений для приложения в службе приложений Azure. Этот конвейер можно настроить на портале Azure для сборки, выполнения тестов, развертывания в промежуточном слоте и последующего развертывания в рабочей среде.

> [!NOTE]
> Для работы с этим руководством требуется учетная запись Microsoft Azure. Если у вас нет учетной записи, вы можете [активировать преимущества подписчика MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/?WT.mc_id=A261C142F) или [зарегистрироваться для получения бесплатной версии](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A261C142F).

## <a name="prerequisites"></a>Предварительные требования

В этом руководстве предполагается, что вы уже установили следующие компоненты:

* [Visual Studio](https://www.visualstudio.com)

* [ASP.NET Core](https://download.microsoft.com/download/F/6/E/F6ECBBCC-B02F-424E-8E03-D47E9FA631B7/DotNetCore.1.0.1-VS2015Tools.Preview2.0.3.exe) (среда выполнения и средства);

* [Git](https://git-scm.com/downloads) для Windows.

## <a name="create-an-aspnet-core-web-app"></a>Создание веб-приложения ASP.NET Core

1. Запустите Visual Studio.

2. В меню **Файл** выберите пункт **Создать** > **Проект**.

3. Выберите шаблон проекта **Веб-приложение ASP.NET**. Он находится в разделе **Установленные** > **Шаблоны** > **Visual C#** > **Интернет**. Задайте для проекта имя `SampleWebAppDemo`. Выберите параметр **Создать репозиторий Git** и нажмите кнопку **ОК**.

   ![Диалоговое окно создания нового проекта](azure-continuous-deployment/_static/01-new-project.png)

4. В диалоговом окне **Новый проект ASP.NET** выберите **пустой** шаблон ASP.NET Core и нажмите кнопку **ОК**.

   ![Диалоговое окно "Новый проект ASP.NET"](azure-continuous-deployment/_static/02-web-site-template.png)


### <a name="running-the-web-app-locally"></a>Запуск веб-приложения в локальной системе

1. После того как Visual Studio завершит создание приложения, запустите его, выбрав **Отладка** -> **Начать отладку**. Вы также можете нажать клавишу **F5**.

   Инициализация Visual Studio и нового приложения может занять некоторое время. По завершении запущенное приложение появится в браузере.

   ![Окно браузера с выполняющимся приложением, в котором выводится сообщение "Hello World!"](azure-continuous-deployment/_static/04-browser-runapp.png)

2. Посмотрев, как работает веб-приложение, закройте браузер и щелкните значок "Остановить отладку" на панели инструментов Visual Studio, чтобы остановить работу приложения.

## <a name="create-a-web-app-in-the-azure-portal"></a>Создание веб-приложения на портале Azure

Ниже приведены инструкции по созданию веб-приложения на портале Azure.

1. Войдите на [портал Azure](https://portal.azure.com).
2. В левом верхнем углу страницы портала нажмите **Создать**.
3. Выберите **Интернет и мобильные устройства** > **Веб-приложение**.

    ![Портал Microsoft Azure > кнопка "Создать" > пункт "Интернет и мобильные устройства" в списке "Marketplace" > кнопка "Веб-приложение" в списке "Рекомендуемые приложения"](azure-continuous-deployment/_static/05-azure-newwebapp.png)

4.  В колонке **Веб-приложение** в поле **Имя службы приложений** введите уникальное значение.

    ![Колонка "Веб-приложение"](azure-continuous-deployment/_static/06-azure-newappblade.png)

    >[!NOTE]
    >**Имя службы приложений** должно быть уникальным. Это правило применяется при попытке ввести имя на портале. После того как вы введете другое значение, вам потребуется подставить его вместо каждого экземпляра имени **SampleWebAppDemo**, который встретится вам в этом руководстве.

    &nbsp;
    
    Кроме того, в колонке **Веб-приложение** выберите существующее **Расположение или план службы приложений** либо создайте собственный план или расположение. При создании плана необходимо выбрать ценовую категорию, расположение и другие параметры. Дополнительные сведения о планах службы приложений см. в статье [Подробный обзор планов службы приложений Azure](https://azure.microsoft.com/documentation/articles/azure-web-sites-web-hosting-plans-in-depth-overview/).

5.  Нажмите кнопку **Создать**. Azure подготовит и запустит веб-приложение.

    ![Портал Azure: колонка "Основное" для приложения SampleWebAppDemo01](azure-continuous-deployment/_static/07-azure-webappblade.png)

## <a name="enable-git-publishing-for-the-new-web-app"></a>Включение публикации в Git для нового веб-приложения

Git — это распределенная система управления версиями, с помощью которой можно развернуть веб-приложение службы приложений Azure. Вы будете сохранять создаваемый код веб-приложения в локальном репозитории Git и развертывать его в Azure, отправляя в удаленный репозиторий.

1. Войдите на [портал Azure](https://portal.azure.com), если вы этого еще не сделали.

2. В нижней части области навигации нажмите кнопку **Обзор**.

3. Щелкните **Веб-приложения**, чтобы просмотреть список веб-приложений, связанных с вашей подпиской Azure.

4. Выберите веб-приложение, созданное в предыдущем разделе этого руководства.

5. Если колонка **Параметры** не отображается, выберите элемент **Параметры** в колонке **Веб-приложение**.

6. В колонке **Параметры** выберите элементы **Источник развертывания** > **Выбор источника** > **Локальный репозиторий Git**.

   ![Колонка "Параметры" > колонка "Источник развертывания" > колонка "Выбор источника"](azure-continuous-deployment/_static/08-azure-localrepository.png)

7. Нажмите кнопку **ОК**.

8. Если вы еще не настроили учетные данные развертывания для публикации веб-приложения или другого приложения службы приложений, сделайте это сейчас.

   * Выберите **Параметры** > **Учетные данные развертывания**. Появится колонка **Установка учетных данных развертывания**.

   * Создайте имя пользователя и пароль.  Этот пароль понадобится позднее при настройке Git.

   * Нажмите кнопку **Сохранить**.

9. В колонке **Веб-приложение** выберите **Параметры** > **Свойства**. URL-адрес удаленного репозитория Git, в котором будет развертываться приложение, приводится в поле **URL-адрес Git**.

10. Скопируйте значение в поле **URL-адрес Git**, так как оно понадобится далее в этом руководстве.

   ![Портал Azure > колонка свойств приложения](azure-continuous-deployment/_static/09-azure-giturl.png)

## <a name="publish-your-web-app-to-azure-app-service"></a>Публикация веб-приложения в службе приложений Azure

В этом разделе вы создадите локальный репозиторий Git с помощью Visual Studio и отправите код из него в Azure, чтобы развернуть веб-приложение. Для этого потребуется выполнить указанные ниже действия.

   * Добавьте параметр удаленного репозитория, используя значение URL-адреса GIT, чтобы развернуть локальный репозиторий в Azure.

   * Зафиксируйте изменения, внесенные в проект.

   * Отправьте изменения, внесенные в проект, из локального репозитория в удаленный репозиторий в Azure.

&nbsp;
   
1.  В **обозревателе решений** щелкните правой кнопкой мыши элемент **Решение "SampleWebAppDemo"** и выберите пункт **Зафиксировать**. Откроется **Team Explorer**.

    ![Вкладка "Подключение" в Team Explorer](azure-continuous-deployment/_static/10-team-explorer.png)

2.  В **Team Explorer** щелкните значок **Главная** и выберите **Параметры** > **Параметры репозитория**.

3.  В разделе **Удаленные** окна **Параметры репозитория** нажмите кнопку **Добавить**. Откроется диалоговое окно **Добавить удаленный объект**.

4.  В качестве **имени** удаленного объекта укажите **Azure-SampleApp**.

5.  В поле **Извлечь** укажите **URL-адрес Git**, который вы скопировали ранее на портале Azure. Обратите внимание на то, что этот URL-адрес должен заканчиваться на **.git**.

    ![Диалоговое окно "Изменение удаленного объекта"](azure-continuous-deployment/_static/11-add-remote.png)

    >[!NOTE]
    >Удаленный репозиторий можно также указать в **командном окне**. Для этого откройте **командное окно**, перейдите в каталог проекта и введите команду. Пример: `git remote add Azure-SampleApp https://me@sampleapp.scm.azurewebsites.net:443/SampleApp.git`

6.  Щелкните значок **Главная** и выберите **Параметры** > **Глобальные параметры**. Необходимо указать свое имя и адрес электронной почты. Также может потребоваться выбрать команду **Обновить**.

7.  Выберите **Главная** > **Изменения**, чтобы вернуться к представлению **Изменения**.

8.  Введите сообщение о фиксации, например **Начальная отправка № 1**, и щелкните **Зафиксировать**. В результате будет создана локальная *фиксация*. Далее ее необходимо *синхронизировать* с Azure.

    ![Вкладка "Подключение" в Team Explorer](azure-continuous-deployment/_static/12-initial-commit.png)

    >[!NOTE]
    >Изменения можно также фиксировать в **командном окне**. Для этого откройте **командное окно**, перейдите в каталог проекта и введите команду git. Пример:
    >
    >`git add .`
    >
    >`git commit -am "Initial Push #1"`

9.  Выберите **Главная** > **Синхронизировать** > **Действия** > **Открыть командную строку**. Откроется командная строка, в которой будет выбран каталог проекта.

10.  Введите в командном окне следующую команду:

    `git push -u Azure-SampleApp master`

11.  Введите пароль из **учетных данных развертывания**, которые вы создали ранее на портале Azure.

    >[!NOTE]
    >В процессе ввода пароль не отображается.

    Эта команда запустит процесс отправки локальных файлов проекта в Azure. Выходные данные приведенной выше команды заканчиваются сообщением о том, что развертывание прошло успешно.
        
    ```
    remote: Finished successfully.
    remote: Running post deployment command(s)...
    remote: Deployment successful.
    To https://username@samplewebappdemo01.scm.azurewebsites.net:443/SampleWebAppDemo01.git
    * [new branch]      master -> master
    Branch master set up to track remote branch master from Azure-SampleApp.
    ```
    > [!NOTE]
    > Если вам нужно работать над проектом совместно, возможно, следует отправлять изменения в [GitHub](https://github.com) между операциями отправки в Azure.
 
### <a name="verify-the-active-deployment"></a>Проверка активного развертывания

Вы можете проверить, было ли веб-приложение успешно передано из локальной среды в Azure. Успешное развертывание должно быть указано в списке.

1. На [портале Azure](https://portal.azure.com) выберите веб-приложение. Затем выберите **Параметры** > **Непрерывное развертывание**.

   ![Портал Azure > колонка "Параметры" > колонка "Развертывания", содержащая успешное развертывание](azure-continuous-deployment/_static/13-verify-deployment.png)

## <a name="run-the-app-in-azure"></a>Запуск приложения в Azure

Развернув веб-приложение в Azure, можно запустить его.

Это можно сделать двумя способами.

* На портале Azure найдите колонку соответствующего веб-приложения и нажмите **Обзор**, чтобы открыть приложение в браузере по умолчанию.

* Откройте браузер и введите URL-адрес веб-приложения. Пример:

  `http://SampleWebAppDemo.azurewebsites.net`

## <a name="update-your-web-app-and-republish"></a>Обновление веб-приложения и повторная публикация

После внесения изменений в хранящийся локально код его можно опубликовать повторно.

1.  В **обозревателе решений** Visual Studio откройте файл *Startup.cs*.

2.  В методе `Configure` измените метод `Response.WriteAsync`, как показано ниже.

    ```aspx-cs
    await context.Response.WriteAsync("Hello World! Deploy to Azure.");
    ```
3.  Сохраните изменения в файле *Startup.cs*.

4.  В **обозревателе решений** щелкните правой кнопкой мыши элемент **Решение "SampleWebAppDemo"** и выберите пункт **Зафиксировать**. Откроется **Team Explorer**.

5.  Введите сообщение о фиксации, например:

    ```none
    Update #2
    ```

6.  Нажмите кнопку **Зафиксировать**, чтобы зафиксировать изменения проекта.

7.  Выберите **Главная** > **Синхронизировать** > **Действия** > **Отправить**.

>[!NOTE]
>Изменения можно также отправлять в **командном окне**. Для этого откройте **командное окно**, перейдите в каталог проекта и введите команду git. Пример:
>
>`git push -u Azure-SampleApp master`

## <a name="view-the-updated-web-app-in-azure"></a>Просмотр обновленного веб-приложения в Azure

Чтобы просмотреть обновленное веб-приложение, на портале Azure в колонке веб-приложения выберите **Обзор** или откройте браузер и введите URL-адрес веб-приложения. Пример:

   `http://SampleWebAppDemo.azurewebsites.net`

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Публикация и развертывание](index.md)

* [Проект Kudu](https://github.com/projectkudu/kudu/wiki)
