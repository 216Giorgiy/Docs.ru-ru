---
title: "Проверка модели в ASP.NET Core MVC"
author: rick-anderson
description: "Вводит проверка модели в ASP.NET Core MVC."
keywords: "ASP.NET Core, MVC, проверка"
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: 3a8676dd-7ed8-4a05-bca2-44e288ab99ee
ms.technology: aspnet
ms.prod: asp.net-core
uid: mvc/models/validation
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 0874d3b677cee2859da9eb85b0573811abbed12a
ms.sourcegitcommit: 78d28178345a0eea91556e4cd1adad98b1446db8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/22/2017
---
# <a name="introduction-to-model-validation-in-aspnet-core-mvc"></a>Общие сведения о проверке модели в ASP.NET Core MVC

По [Рэйчел Аппель](https://github.com/rachelappel)

## <a name="introduction-to-model-validation"></a>Общие сведения о проверке модели

Прежде чем приложение сохраняет данные в базе данных, приложение должно проверить данные. Данные необходимо проверить наличие потенциальных угроз безопасности, проверить его соответствующим образом форматируется с помощью типа и размера, что она должна соответствовать правил. Проверка не требуется, хотя он может быть сложно реализовать и избыточность. В MVC проверка выполняется на клиенте и сервере.

К счастью .NET абстрагированы проверки в атрибутов проверки. Эти атрибуты содержат код проверки, тем самым уменьшая объем кода, который необходимо написать.

[Просмотреть или загрузить пример из GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/models/validation/sample).

## <a name="validation-attributes"></a>Атрибуты проверки

Атрибуты проверки — это способ для настройки проверки модели, поэтому она аналогична концептуально проверки для полей в таблицах базы данных. Сюда входят ограничения, такие как назначение типов данных или обязательных полей. Другие виды проверки включают применение шаблонов данных для применения бизнес-правил, например кредитной карты, номер телефона или адрес электронной почты. Атрибуты проверки сделать применения этих требований гораздо проще и удобнее в использовании.

Ниже приведен аннотируемого `Movie` модели из приложения, которое хранит сведения о фильмах и телепередачи. Большинство свойств являются обязательными, и требования к длине имеют несколько свойств строки. Кроме того, есть ограничения числового диапазона на месте для `Price` значение $999,99, а также настраиваемый атрибут проверки от 0.

[!code-csharp[Main](validation/sample/Movie.cs?range=6-31)]

Просто прочтя модели раскроется правил о данных для этого приложения, упрощая процесс для обслуживания кода. Ниже приведены несколько популярных встроенной проверке атрибутов.

* `[CreditCard]`: Проверяет свойство имеет формат кредитной карты.

* `[Compare]`: Проверяет два свойства в модели совпадения.

* `[EmailAddress]`: Проверяет свойство имеет формат электронной почты.

* `[Phone]`: Проверяет свойство имеет формат телефона.

* `[Range]`: Проверяет его значение свойства находится в указанном диапазоне.

* `[RegularExpression]`: Проверяет, что данные соответствуют указанному регулярному выражению.

* `[Required]`: Делает свойство обязательное.

* `[StringLength]`: Осуществляет проверку на строковое свойство максимум данной максимальной длины.

* `[Url]`: Проверяет свойство имеет формат URL-адреса.

MVC поддерживает любой атрибут, который является производным от `ValidationAttribute` для целей проверки. Множество полезных проверки атрибутов можно найти в [System.ComponentModel.DataAnnotations](https://docs.microsoft.com/dotnet/api/system.componentmodel.dataannotations) пространства имен.

Возможны случаи, в которых требуется больше возможностей, чем встроенные атрибуты. В тех случаях, можно создать собственные настраиваемые атрибуты проверки путем наследования от `ValidationAttribute` или изменение модели для реализации `IValidatableObject`.

## <a name="model-state"></a>Состояние модели

Состояние модели представляет ошибок проверки в введенные значения формы HTML.

MVC по-прежнему Проверка полей, пока не достигнет максимальное количество ошибок (по умолчанию — 200). Это число можно настроить, вставив следующий код в `ConfigureServices` метод в *файла Startup.cs* файла:

[!code-csharp[Main](validation/sample/Startup.cs?range=27)]

## <a name="handling-model-state-errors"></a>Состояние модели обработки ошибок

Проверка модели, происходит перед каждой вызываемого действия контроллера, и ответственность метода действия для проверки `ModelState.IsValid` и реагировать соответствующим образом. Во многих случаях соответствующие реакции является возврат каких-либо ответа с ошибкой, в идеале с подробными сведениями о причине, причину ошибки проверки модели.

Некоторые приложения выберет следовать стандартного соглашения для обработки ошибок проверки модели, при которых фильтр может быть необходимо реализовать такую политику. Следует проверить поведение свои действия с состояниями допустимые и недопустимые модели.

## <a name="manual-validation"></a>Ручная проверка

После завершения привязки модели и проверки, можно повторить его части. Например пользователь может быть введен текст в поле, ожидается целое число, или необходимо вычислить значение для свойства модели.

Необходимо вручную выполнить проверку. Чтобы сделать это, вызовите `TryValidateModel` метода, как показано ниже:

[!code-csharp[Main](validation/sample/MoviesController.cs?range=52)]

## <a name="custom-validation"></a>Пользовательской проверки

Для большинства задач проверки работы атрибутов проверки. Тем не менее некоторые правила проверки относятся только к вашей организации, они не являются просто требуется проверка универсальных данных, таких как обеспечение поля или соответствует диапазон значений. В этих сценариях настраиваемых атрибутов проверки — это эффективное решение. Создание собственных настраиваемых атрибутов проверки в MVC можно легко. Наследовать только от `ValidationAttribute`и Переопределите `IsValid` метод. `IsValid` Метод принимает два параметра: первый — объект с именем *значение* , а второй — `ValidationContext` объект с именем *validationContext*. *Значение* ссылается на фактическое значение из поля, проверка вашего пользовательского проверяющего элемента управления.

В следующем образце бизнес-правило том, что пользователи не могут устанавливать жанр *классический* к фильму, выпущенные после выхода 1960. `[ClassicMovie]` Атрибут сначала проверяет жанр и если это classic, затем выполняется проверка является более поздней, чем 1960 даты выпуска. Если он освобождается после 1960, проверка завершается с ошибками. Атрибут принимает целочисленный параметр, представляющее год, можно использовать для проверки данных. Можно записать значение параметра в конструктор атрибута, как показано ниже:

[!code-csharp[Main](validation/sample/ClassicMovieAttribute.cs?range=9-28)]

`movie` Переменной выше представляет `Movie` объект, содержащий данные из отправки формы для проверки. В этом случае код проверки проверяет дату и жанр в `IsValid` метод `ClassicMovieAttribute` класса согласно правилам. По окончании успешной проверки `IsValid` возвращает `ValidationResult.Success` кода, и если проверка завершается неудачно, `ValidationResult` с сообщением об ошибке. Когда пользователь изменяет `Genre` поля и отправляет форму, `IsValid` метод `ClassicMovieAttribute` будет проверить, является ли фильма классические. Как и все встроенные атрибут применять `ClassicMovieAttribute` к свойству, такие как `ReleaseDate` для обеспечения проверки происходит, как показано в предыдущем примере кода. Поскольку пример работает только с `Movie` типов, лучшим вариантом является использование `IValidatableObject` как показано в следующем абзаце.

Кроме того, этот же код может быть переведена в модель, реализовав `Validate` метод `IValidatableObject` интерфейса. Хотя настраиваемых атрибутов проверки подходят для проверки отдельных свойств, реализация `IValidatableObject` можно использовать для реализации проверки на уровне класса, как показано ниже.

[!code-csharp[Main](validation/sample/MovieIValidatable.cs?range=33-41)]

## <a name="client-side-validation"></a>Проверки на стороне клиента

Проверки на стороне клиента является большое удобство для пользователей. Он сохраняет время, в противном случае они бы проводят ожидание кругового пути на сервере. Бизнес-терминологией даже несколько долей секунды, умноженные сотни раз в день до добавляет ожидается большое количество времени, затрат и трудностей. Простой и непосредственный проверки позволяет пользователям работать более продуктивно и создавать более высокое качество входных и выходных данных.

Необходимо иметь представление с правильной ссылки на скрипты JavaScript на месте для проверки на стороне клиента для работы, как показано ниже.

[!code-html[Main](validation/sample/Views/Shared/_Layout.cshtml?range=37)]

[!code-html[Main](validation/sample/Views/Shared/_ValidationScriptsPartial.cshtml)]

MVC использует атрибуты проверки, а также метаданные типа от свойств модели для проверки данных и отображения сообщения об ошибках, с использованием JavaScript. При использовании MVC для визуализации элементов формы из модели с помощью [вспомогательных функций тегов](xref:mvc/views/tag-helpers/intro) или [вспомогательных методов HTML](xref:mvc/views/overview) добавит HTML 5 [атрибуты данных](http://w3c.github.io/html/dom.html#embedding-custom-non-visible-data-with-the-data-attributes) в форму элементы, которые требуется проверить, как показан ниже. MVC создает `data-` встроенных и пользовательских атрибутов. Для отображения ошибок проверки на стороне клиента с помощью соответствующего тега вспомогательные методы, как показано ниже:

[!code-html[Main](validation/sample/Views/Movies/Create.cshtml?highlight=4,5&range=19-25)]

Выше вспомогательных функций тегов визуализацию HTML ниже. Обратите внимание, что `data-` выходных атрибутов в документ HTML, соответствующие атрибуты проверки для `ReleaseDate` свойства. `data-val-required` Атрибута ниже содержит сообщение об ошибке для отображения, если пользователь не заполните поле даты выпуска, и это сообщение отображается в соответствующем `<span>` элемента.

```html
<form action="/Movies/Create" method="post">
    <div class="form-horizontal">
        <h4>Movie</h4>
        <div class="text-danger"></div>
        <div class="form-group">
            <label class="col-md-2 control-label" for="ReleaseDate">ReleaseDate</label>
            <div class="col-md-10">
                <input class="form-control" type="datetime"
                data-val="true" data-val-required="The ReleaseDate field is required."
                id="ReleaseDate" name="ReleaseDate" value="" />
                <span class="text-danger field-validation-valid"
                data-valmsg-for="ReleaseDate" data-valmsg-replace="true"></span>
            </div>
        </div>
    </div>
</form>
```

Проверка на стороне клиента предотвращает отправку до формы является допустимым. Кнопки "Отправить" запускает JavaScript, который отправляет форму или отображаются сообщения об ошибках.

MVC определяет значения атрибутов типа на основе типа данных .NET, возможно переопределено с помощью свойства `[DataType]` атрибуты. Базовый `[DataType]` атрибута не выполняет проверку real серверную. Браузеры выберите собственные сообщения об ошибках и отобразить эти ошибки, однако их следует, однако пакет ненавязчивой проверки jQuery можно переопределить сообщения и отображать их согласованно с другими разделами. Это происходит, наиболее очевидно, что если пользователи применять `[DataType]` подклассов, такие как `[EmailAddress]`.

## <a name="iclientmodelvalidator"></a>IClientModelValidator

Можно создать пользовательский атрибут, логика стороны клиента и [ненавязчивой проверки](http://jqueryvalidation.org/documentation/) будет выполняться на клиентском компьютере автоматически в процессе проверки. Первым шагом является контролировать, какие данные атрибуты добавляются путем реализации `IClientModelValidator` интерфейс, как показано ниже:

[!code-csharp[Main](validation/sample/ClassicMovieAttribute.cs?range=30-42)]

Созданные поля атрибутов, которые реализуют этот интерфейс можно добавить атрибуты HTML. Анализ результатов для `ReleaseDate` элемент показывает код HTML, который аналогичен предыдущему примеру, за исключением того, теперь является `data-val-classicmovie` атрибут, который был определен в `AddValidation` метод `IClientModelValidator`.

```html
<input class="form-control" type="datetime"
data-val="true"
data-val-classicmovie="Classic movies must have a release year earlier than 1960."
data-val-classicmovie-year="1960"
data-val-required="The ReleaseDate field is required."
id="ReleaseDate" name="ReleaseDate" value="" />
```

Проверки ненавязчивого использует данные в `data-` атрибуты для отображения сообщений об ошибках. Тем не менее, не знает о правилах jQuery, или сообщения до момента добавления элемента jQuery `validator` объекта. Это показано в следующем примере, который добавляет метод с именем `classicmovie` с кодом проверки пользовательских клиентских jQuery `validator` объекта.

[!code-javascript[Main](validation/sample/Views/Movies/Create.cshtml?range=71-93)]

Теперь jQuery содержит данные для выполнения пользовательской проверки JavaScript, а также сообщение об ошибке для отображения, если этот код проверки возвращает значение false.

## <a name="remote-validation"></a>Удаленной проверки

Удаленной проверки является компонент используется для проверки данных на стороне клиента к данным на сервере. Например приложение может потребоваться проверить электронной почты или имя пользователя уже используется, и он большой объем данных для этого необходимо выполнить запрос. Загрузка больших наборов данных для проверки одного или нескольких полей потребляет слишком много ресурсов. Он также может предоставлять конфиденциальную информацию. Альтернативой является выполнение кругового пути запроса для проверки поля.

Можно реализовать удаленной проверки в два этапа. Во-первых, следует пометить модели с помощью `[Remote]` атрибута. `[Remote]` Атрибут принимает несколько перегрузок, которые можно использовать для перенаправления на стороне клиента JavaScript соответствующий код вызова. Пример указывает `VerifyEmail` метод действия `Users` контроллера.

[!code-csharp[Main](validation/sample/User.cs?range=5-9)]

Второй шаг размещения кода проверки в соответствующий метод действия, как определено в `[Remote]` атрибута. Он возвращает `JsonResult` , на стороне клиента можно использовать для продолжения или приостановить и отображает ошибку, при необходимости.

[!code-none[Main](validation/sample/UsersController.cs?range=19-28)]

Теперь, когда пользователи вводят сообщение электронной почты, JavaScript, в представлении делает удаленный вызов, чтобы увидеть, если сообщение электронной почты были выполнены и если да, выводится сообщение об ошибке. В противном случае пользователь может отправить форму обычным образом.
