---
title: Устранение неполадок ASP.NET Core в службе приложений Azure
author: guardrex
description: Сведения о диагностике проблем с развертываниями ASP.NET Core в службе приложений Azure.
manager: wpickett
ms.author: riande
ms.custom: mvc
ms.date: 01/31/2018
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: article
uid: host-and-deploy/azure-apps/troubleshoot
ms.openlocfilehash: 47056c80c7abf5dd5ad5ae96af7b821d31b21b8b
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
# <a name="troubleshoot-aspnet-core-on-azure-app-service"></a>Устранение неполадок ASP.NET Core в службе приложений Azure

Автор [Люк Латэм](https://github.com/guardrex) (Luke Latham)

[!INCLUDE [Azure App Service Preview Notice](../../includes/azure-apps-preview-notice.md)]

Эта статья содержит инструкции для ASP.NET Core диагностики проблемы при запуске приложения с помощью средств диагностики службы приложений Azure. Дополнительные советы по устранению неполадок, в разделе [Общие сведения о службе приложений Azure diagnostics](/azure/app-service/app-service-diagnostics) и [как: мониторинг приложений в службе приложений Azure](/azure/app-service/web-sites-monitor) в документации Azure.

## <a name="app-startup-errors"></a>Ошибки при запуске приложения

**502.5 сбой процесса**  
Рабочий процесс завершается ошибкой. Приложение не запускается.

[Модуль ASP.NET Core](xref:fundamentals/servers/aspnet-core-module) пытается запустить рабочий процесс, но он не запускается. Найдите в журнале событий приложений часто помогает устранить проблемы такого типа. Доступ к журналу описан в [журнал событий приложений](#application-event-log) раздела.

*502.5 сбой процесса* возвращаемая страница ошибки, когда имеет неправильный формат приложения приводит к сбою рабочий процесс:

![Окно браузера, показывающий 502.5 страницу ошибки процесса](troubleshoot/_static/process-failure-page.png)

**500 Внутренняя ошибка сервера**  
Приложение запускается, но ошибка не позволяет выполнить запрос сервера.

Эта ошибка возникает в коде приложения при запуске или при создании ответа. Ответ может содержать отсутствует содержимое или ответ может выглядеть как *500 Внутренняя ошибка сервера* в браузере. Журнал событий приложений обычно состояний обычном запуске приложения. С точки зрения сервера верно. Приложения был запущен, но его не удается создать допустимый ответ. [Запуск приложения в консоли Kudu](#run-the-app-in-the-kudu-console) или [включите журнал stdout модуль ASP.NET Core](#aspnet-core-module-stdout-log) для устранения неполадок.

**Сброс подключения**

Если ошибка возникает после отправки заголовков, уже слишком поздно для сервера для отправки **500 Внутренняя ошибка сервера** при возникновении ошибки. Это часто происходит при возникновении ошибки во время сериализации ответа сложных объектов. Ошибки такого типа отображается как *Сброс соединения* ошибки на стороне клиента. [Ведение журналов для приложений](xref:fundamentals/logging/index) устранения таких ошибок.

## <a name="default-startup-limits"></a>Ограничения по умолчанию при запуске

Значение по умолчанию настроен модуль ASP.NET Core *startupTimeLimit* 120 секунд. Если оставить значение по умолчанию, приложение может занять до двух минут для запуска до ошибки в процессе входа модуля. Сведения о настройке модуля см. в разделе [атрибуты элемента aspNetCore](xref:host-and-deploy/aspnet-core-module#attributes-of-the-aspnetcore-element).

## <a name="troubleshoot-app-startup-errors"></a>Устранение ошибок при запуске приложения

### <a name="application-event-log"></a>Журнал событий приложений

Открыть журнал событий приложений с помощью **диагностики и устранения неполадок** колонку на портале Azure:

1. На портале Azure откройте колонку приложения в **службы приложений** колонку.
1. Выберите **диагностики и устранения неполадок** колонку.
1. В разделе **ВЫБЕРИТЕ КАТЕГОРИЮ ПРОБЛЕМЫ**выберите **Web App вниз** кнопки.
1. В разделе **предлагаемые решения**, откройте область для **Открыть журналы событий приложений**. Выберите **Открыть журналы событий приложений** кнопки.
1. Просмотрите последние ошибки, предоставляемые *IIS AspNetCoreModule* в **источника** столбца.

Вместо использования **диагностики и устранения неполадок** панель — это файл на журнал событий приложений, которые непосредственно с помощью [Kudu](https://github.com/projectkudu/kudu/wiki):

1. Выберите **дополнительные средства** колонки в **средства разработки** области. Выберите **Go&rarr;**  кнопки. Консоль Kudu открывает новую вкладку браузера или в окне.
1. С помощью панели навигации в верхней части страницы откройте **консоли отладки** и выберите **CMD**.
1. Откройте **LogFiles** папки.
1. Выберите значок с карандашом рядом с *eventlog.xml* файла.
1. Проверьте в журнале. Прокрутка до нижней части журнала, чтобы просмотреть самые последние события.

### <a name="run-the-app-in-the-kudu-console"></a>Запуск приложения в консоли Kudu

Многие ошибки запуска не создают полезные сведения в журнале событий приложений. Можно запустить приложение в [Kudu](https://github.com/projectkudu/kudu/wiki) удаленной консоли выполнения для обнаружения ошибки:

1. Выберите **дополнительные средства** колонки в **средства разработки** области. Выберите **Go&rarr;**  кнопки. Консоль Kudu открывает новую вкладку браузера или в окне.
1. С помощью панели навигации в верхней части страницы откройте **консоли отладки** и выберите **CMD**.
1. Откройте папки в папку **сайта** > **wwwroot**.
1. В консоли запустите приложение, выполнив сборку приложения.
   * Если приложение является [развертывания зависит от framework](/dotnet/core/deploying/#framework-dependent-deployments-fdd), выполнить сборку приложения с *dotnet.exe*. В следующей команде замените имя сборки приложения для `<assembly_name>`: `dotnet .\<assembly_name>.dll`
   * Если приложение является [автономное развертывание](/dotnet/core/deploying/#self-contained-deployments-scd), запустите приложение в исполняемый файл. В следующей команде замените имя сборки приложения для `<assembly_name>`: `<assembly_name>.exe`
1. Выходные данные из приложения, отображение ошибок, консоли, будет выведен на консоль Kudu.

### <a name="aspnet-core-module-stdout-log"></a>Журнал stdout модуль Core ASP.NET

В журнале stdout модуль ASP.NET Core часто записывается полезных сообщений не удалось найти в журнале событий приложений. Для включения и просмотра журналов stdout:

1. Перейдите к **диагностики и устранения неполадок** колонку на портале Azure.
1. В разделе **ВЫБЕРИТЕ КАТЕГОРИЮ ПРОБЛЕМЫ**выберите **Web App вниз** кнопки.
1. В разделе **предлагаемые решения** > **включить перенаправление Stdout журнала**, нажмите кнопку, чтобы **откройте консоль Kudu, редактируя файл Web.Config**.
1. В Kudu **консоли диагностики**, откройте папку к пути **сайта** > **wwwroot**. Прокрутите вниз до показа *web.config* файла в нижней части списка.
1. Щелкните значок карандаша *web.config* файла.
1. Задать **stdoutLogEnabled** для `true` и измените **stdoutLogFile** путь: `\\?\%home%\LogFiles\stdout`.
1. Выберите **Сохранить** сохранить обновленный *web.config* файла.
1. Сделать запрос к приложению.
1. Вернитесь на портал Azure. Выберите **дополнительные средства** колонки в **средства разработки** области. Выберите **Go&rarr;**  кнопки. Консоль Kudu открывает новую вкладку браузера или в окне.
1. С помощью панели навигации в верхней части страницы откройте **консоли отладки** и выберите **CMD**.
1. Выберите **LogFiles** папки.
1. Проверить **Modified** столбца и выберите значок карандаша, чтобы изменить стандартный вывод журнала с даты последнего изменения.
1. При открытии файла журнала отображается сообщение об ошибке.

**Важно!** Отключите ведение журнала stdout, после завершения устранения неполадок.

1. В Kudu **консоли диагностики**, возвращают путь **сайта** > **wwwroot** для отображения полей *web.config* файла. Откройте **web.config** снова, выбрав значок карандаша.
1. Задать **stdoutLogEnabled** для `false`.
1. Выберите **Сохранить** для сохранения файла.

> [!WARNING]
> Неудача при отключении журнала stdout может привести к сбоям приложения или сервера. Ни размер файла журнала, ни количество создаваемых файлов журналов ничем не ограничены. Используйте только stdout ведения журнала для устранения неполадок при запуске приложения.
>
> Для общих ведения журнала в приложении ASP.NET Core после запуска приложения, используйте библиотеку ведения журнала, которая ограничивает размер файла журнала и поворачивает журналы. Дополнительные сведения см. в разделе [сторонних регистраторов](xref:fundamentals/logging/index#third-party-logging-providers).

## <a name="common-startup-errors"></a>Распространенные ошибки запуска 

В разделе [общую ссылку ошибки ASP.NET Core](xref:host-and-deploy/azure-iis-errors-reference). В справочном разделе рассматриваются наиболее распространенных проблем, препятствующих запуск приложений.

## <a name="slow-or-hanging-app"></a>Приложение медленно или красная

Когда приложение медленно реагирует или зависает на запрос, в разделе [проблем с производительностью приложения диагностика медленно web в службе приложений Azure](/azure/app-service/app-service-web-troubleshoot-performance-degradation) для отладки рекомендации.

## <a name="remote-debugging"></a>Удаленная отладка

См. указанные ниже разделы.

* [Удаленная отладка приложений разделе Устранение неполадок веб-приложения в службе приложений Azure с помощью Visual Studio web](/azure/app-service/web-sites-dotnet-troubleshoot-visual-studio#remotedebug) (документация Azure)
* [Удаленной отладки ASP.NET Core на сервере IIS в Azure в Visual Studio 2017 г](/visualstudio/debugger/remote-debugging-azure) (документация по Visual Studio)

## <a name="application-insights"></a>Application Insights

[Application Insights](https://azure.microsoft.com/services/application-insights/) предоставляет телеметрии из приложения, размещенные в службе приложений Azure, включая регистрации ошибок и функции отчетов. Application Insights можно только отчетов об ошибках, произошедших после запуска приложения, когда становятся доступными возможности ведения журнала приложения. Дополнительные сведения см. в разделе [Application Insights для ASP.NET Core](/azure/application-insights/app-insights-asp-net-core).

## <a name="monitoring-blades"></a>Мониторинг колонок

Мониторинга колонках предоставляют альтернативный, устранении неполадок для методов, описанных ранее в этом разделе. Эти модули можно использовать для диагностики ошибок 500-й серии.

Убедитесь, что основные модули ASP.NET установлены. Если расширения не установлены, установите их вручную:

1. В **средства разработки** колонке выберите пункт **расширения** колонку.
1. **Расширения ASP.NET Core** должны появиться в списке.
1. Если расширения не установлены, выберите **добавить** кнопки.
1. Выберите **расширения ASP.NET Core** из списка.
1. Выберите **ОК** для принятия условия.
1. Выберите **ОК** на **добавить расширение** колонку.
1. Информационное всплывающее сообщение указывает, когда расширения успешно установлены.

Если ведение журнала stdout не включен, выполните следующие действия.

1. На портале Azure выберите **дополнительные средства** колонки в **средства разработки** области. Выберите **Go&rarr;**  кнопки. Консоль Kudu открывает новую вкладку браузера или в окне.
1. С помощью панели навигации в верхней части страницы откройте **консоли отладки** и выберите **CMD**.
1. Откройте папки в папку **сайта** > **wwwroot** и прокрутите вниз до показа *web.config* файла в нижней части списка.
1. Щелкните значок карандаша *web.config* файла.
1. Задать **stdoutLogEnabled** для `true` и измените **stdoutLogFile** путь: `\\?\%home%\LogFiles\stdout`.
1. Выберите **Сохранить** сохранить обновленный *web.config* файла.

Перейдите к активации ведения журнала диагностики:

1. На портале Azure выберите **журналы диагностики** колонку.
1. Выберите **на** Перейти **ведение журнала приложения (файловая система)** и **подробные сообщения об ошибках**. Выберите **Сохранить** кнопку в верхней части колонки.
1. Чтобы включить трассировку невыполненных запросов, также известные как ведение журнала сбой запроса событий буферизации (FREB), установите **на** Перейти **Трассировка запросов с ошибками**. 
1. Выберите **потока журнала** колонки, который отображается в списке немедленно **журналы диагностики** колонку на портале.
1. Сделать запрос к приложению.
1. В поток данных журнала указывает причину ошибки.

**Важно!** Не забудьте отключить регистрацию stdout завершении устранения неполадок. См. инструкции в [журнала stdout модуль ASP.NET Core](#aspnet-core-module-stdout-log) раздела.

Чтобы просмотреть журналы трассировки запросов с ошибками (журналы FREB):

1. Перейдите к **диагностики и устранения неполадок** колонку на портале Azure.
1. Выберите **журналы невыполненных запросов трассировки** из **средства поддержки** области боковой панели.

В разделе [сбой запроса отслеживает раздел Включить ведение журналов диагностики для веб-приложений в службе приложений Azure разделе](/azure/app-service/web-sites-enable-diagnostic-log#failed-request-traces) и [вопросы и ответы о производительности приложений для веб-приложений в Azure: как включить трассировку невыполненных запросов?](/azure/app-service/app-service-web-availability-performance-application-issues-faq#how-do-i-turn-on-failed-request-tracing) Для получения дополнительных сведений.

Дополнительные сведения см. в разделе [включить ведение журнала диагностики для веб-приложений в службе приложений Azure](/azure/app-service/web-sites-enable-diagnostic-log).

> [!WARNING]
> Неудача при отключении журнала stdout может привести к сбоям приложения или сервера. Ни размер файла журнала, ни количество создаваемых файлов журналов ничем не ограничены.
>
> Для процедуры входа в приложение ASP.NET Core, используйте библиотеку ведения журнала, которая ограничивает размер файла журнала и поворачивает журналы. Дополнительные сведения см. в разделе [сторонних регистраторов](xref:fundamentals/logging/index#third-party-logging-providers).

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Общие сведения об обработке ошибок в ASP.NET Core](xref:fundamentals/error-handling)
* [Справочник по общим ошибкам для службы приложений Azure и служб IIS с ASP.NET Core](xref:host-and-deploy/azure-iis-errors-reference)
* [Устранение неполадок веб-приложения в службе приложений Azure с помощью Visual Studio](/azure/app-service/web-sites-dotnet-troubleshoot-visual-studio)
* [Устранение ошибок HTTP «502 — неправильный шлюз» и «503 — Служба недоступна» в Azure веб-приложения](/app-service/app-service-web-troubleshoot-http-502-http-503)
* [Устранение неполадок производительности медленных веб приложения в службе приложений Azure](/azure/app-service/app-service-web-troubleshoot-performance-degradation)
* [Вопросы и ответы о производительности приложений для веб-приложений в Azure](/azure/app-service/app-service-web-availability-performance-application-issues-faq)
* [Azure веб-приложение "песочницы" (ограничения выполнения среды выполнения службы приложений)](https://github.com/projectkudu/kudu/wiki/Azure-Web-App-sandbox)
* [Azure, пятница: практики диагностики и устранения неполадок в службе приложений Azure (12-минутное видео)](https://channel9.msdn.com/Shows/Azure-Friday/Azure-App-Service-Diagnostic-and-Troubleshooting-Experience)
