---
title: Справочник по общим ошибкам в Службе приложений Azure и службах IIS с ASP.NET Core
author: guardrex
description: Сведения о распространенных ошибках при размещении приложений ASP.NET Core в Службе приложений Azure и службах IIS.
ms.author: riande
ms.custom: mvc
ms.date: 03/13/2017
uid: host-and-deploy/azure-iis-errors-reference
ms.openlocfilehash: 30b7f1d8e1cfdfd3d1db865ff428eb2094a84d32
ms.sourcegitcommit: a1afd04758e663d7062a5bfa8a0d4dca38f42afc
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/20/2018
ms.locfileid: "36277323"
---
# <a name="common-errors-reference-for-azure-app-service-and-iis-with-aspnet-core"></a>Справочник по общим ошибкам в Службе приложений Azure и службах IIS с ASP.NET Core

Автор [Люк Латэм](https://github.com/guardrex) (Luke Latham)

Приведенный ниже перечень ошибок не является исчерпывающим. Если вы встретите сообщение об ошибке, которое здесь не указано, [создайте запрос](https://github.com/aspnet/Docs/issues/new) с подробным описанием, которое поможет воспроизвести эту ошибку.

Соберите следующие сведения:

* поведение браузера;
* записи в журнале событий приложения;
* записи в журнале вывода stdout модуля ASP.NET Core.

Сравните собранные данные с представленной здесь информацией о распространенных ошибках. Если вы найдете соответствие, выполните рекомендации по устранению неполадок.

[!INCLUDE [Azure App Service Preview Notice](../includes/azure-apps-preview-notice.md)]

## <a name="installer-unable-to-obtain-vc-redistributable"></a>Установщику не удается получить распространяемый компонент VC++

* **Исключение установщика:** 0x80072efd or 0x80072f76 — неопределенная ошибка

* **Исключение журнала установщика&#8224;:** ошибка 0x80072efd или 0x80072f76: не удалось выполнить пакет EXE

  &#8224;Журнал находится в папке C:\Users\\{ПОЛЬЗОВАТЕЛЬ}\AppData\Local\Temp\dd_DotNetCoreWinSvrHosting__{метка_времени}.log.

Устранение неполадок:

* Если при установке пакета размещения у системы нет доступа к Интернету, это исключение возникает при попытке установщика получить *распространяемый компонент Microsoft Visual C++ 2015*. Получите установщик в [Центре загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=53840). Если работа установщика завершается сбоем, это может быть связано с тем, что сервер не может получить среду выполнения .NET Core, необходимую для размещения зависимых от платформы развертываний (FDD). Если вы размещаете зависимые от платформы развертывания, в окне "Программы и компоненты" убедитесь, что установлена среда выполнения. Если нет, то получите установщик среды выполнения на [странице загрузки .NET](https://www.microsoft.com/net/download/all). После установки среды выполнения перезагрузите систему или перезапустите службы IIS, выполнив в командной строке команду **net stop was /y**, а затем — команду **net start w3svc**.

## <a name="os-upgrade-removed-the-32-bit-aspnet-core-module"></a>При обновлении ОС был удален 32-разрядный модуль ASP.NET Core

* **Журнал приложений:** не удалось загрузить модуль DLL **C:\WINDOWS\system32\inetsrv\aspnetcore.dll**. Ошибочные данные.

Устранение неполадок:

* Не относящиеся к ОС файлы в каталоге **C:\Windows\SysWOW64\inetsrv** не сохраняются при обновлении ОС. Эта ошибка возникает, если модуль ASP.NET Core был установлен до обновления ОС, а после обновления ОС выполняется любой пул приложений в 32-разрядном режиме. После обновления ОС восстановите модуль ASP.NET Core. См. статью [Установка пакета размещения .NET Core](xref:host-and-deploy/iis/index#install-the-net-core-hosting-bundle). Выберите вариант **Восстановить** при запуске установщика.

## <a name="platform-conflicts-with-rid"></a>Конфликты платформы с относительным идентификатором

* **Браузер:** ошибка HTTP 502.5 — сбой процесса

* **Журнал приложений:** приложению MACHINE/WEBROOT/APPHOST/{СБОРКА} с физическим корневым каталогом C:\{ПУТЬ}\' не удалось запустить процесс с помощью команды "C:\\{ПУТЬ}\{СБОРКА}.{exe|dll}"; код ошибки = 0x80004005 : ff.

* **Журнал модуля ASP.NET Core:** необработанное исключение System.BadImageFormatException: не удалось загрузить файл или сборку {сборка}.dll. Была сделана попытка загрузить программу, имеющую неверный формат.

Устранение неполадок:

* Убедитесь в том, что приложение выполняется локально в Kestrel. Сбой процесса может быть результатом проблемы в приложении. Дополнительные сведения см. в [руководстве по устранению неполадок](xref:host-and-deploy/iis/troubleshoot).

* Убедитесь, что значение `<PlatformTarget>` в файле *.csproj* не конфликтует с RID. Например, не указывайте `<PlatformTarget>` со значением `x86`, если вы выполняете публикацию с идентификатором RID `win10-x64` с помощью команды *dotnet publish -c Release -r win10-x64* или указывая значение `win10-x64` для параметра `<RuntimeIdentifiers>` в файле *.csproj*. Проект публикуется без предупреждения или сообщения об ошибке, но при запуске в системе происходит сбой, а в журнале регистрируются указанные выше исключения.

* Если это исключение возникает для развертывания приложений Azure при обновлении приложения и развертывании более новых сборок, вручную удалите все файлы предыдущего развертывания. Если останутся несовместимые сборки, то при развертывании обновленного приложения это может привести к исключению `System.BadImageFormatException`.

## <a name="uri-endpoint-wrong-or-stopped-website"></a>Неправильная конечная точка URI, либо веб-сайт остановлен

* **Браузер:** ERR_CONNECTION_REFUSED

* **Журнал приложений:** нет записи

* **Журнал модуля ASP.NET Core:** файл журнала не создан

Устранение неполадок:

* Убедитесь, что используется правильный URI конечной точки для приложения. Проверьте все привязки.

* Убедитесь, что веб-сайт IIS не находится в состоянии *Остановлен*.

## <a name="corewebengine-or-w3svc-server-features-disabled"></a>Компонент сервера CoreWebEngine или W3SVC отключен

* **Исключение ОС:** для использования модуля ASP.NET Core должны быть установлены компоненты IIS 7.0 CoreWebEngine и W3SVC.

Устранение неполадок:

* Убедитесь, что включены правильная роль и необходимые компоненты. См. раздел [Конфигурация IIS](xref:host-and-deploy/iis/index#iis-configuration).

## <a name="incorrect-website-physical-path-or-app-missing"></a>Неправильный физический путь к веб-сайту, либо отсутствует приложение

* **Браузер:** 403 — запрещено. В доступе отказано **--ИЛИ--** 403.14 — запрещено. Веб-сервер настроен таким образом, чтобы не формировать список содержимого каталога.

* **Журнал приложений:** нет записи

* **Журнал модуля ASP.NET Core:** файл журнала не создан

Устранение неполадок:

* Проверьте **основные настройки** веб-сайта IIS и физическую папку приложения. Убедитесь в том, что приложение находится в папке по **физическому пути**, указанному для веб-сайта IIS.

## <a name="incorrect-role-module-not-installed-or-incorrect-permissions"></a>Неправильная роль, модуль не установлен либо неверные разрешения

* **Браузер:** 500.19 — внутренняя ошибка сервера. Запрашиваемая страница недоступна из-за неверной конфигурации данных для этой страницы.

* **Журнал приложений:** нет записи

* **Журнал модуля ASP.NET Core:** файл журнала не создан

Устранение неполадок:

* Убедитесь, что включена соответствующая роль. См. раздел [Конфигурация IIS](xref:host-and-deploy/iis/index#iis-configuration).

* На странице **Программы и компоненты** убедитесь в том, что установлен **модуль Microsoft ASP.NET Core**. Если **модуль Microsoft ASP.NET Core** отсутствует в списке установленных программ, установите его. См. статью [Установка пакета размещения .NET Core](xref:host-and-deploy/iis/index#install-the-net-core-hosting-bundle)

* Убедитесь, что параметр **Пул приложений** > **Модель процесса** > **Удостоверение** имеет значение **ApplicationPoolIdentity** или что у пользовательского удостоверения есть нужные разрешения на доступ к папке развертывания приложения.

## <a name="incorrect-processpath-missing-path-variable-hosting-bundle-not-installed-systemiis-not-restarted-vc-redistributable-not-installed-or-dotnetexe-access-violation"></a>Неправильное значение processPath, отсутствует переменная PATH, пакет размещения не установлен, система или службы IIS не перезапущены, не установлен распространяемый компонент VC++ либо нарушены права доступа к dotnet.exe

* **Браузер:** ошибка HTTP 502.5 — сбой процесса

* **Журнал приложений:** приложению MACHINE/WEBROOT/APPHOST/{СБОРКА} с физическим корневым каталогом C:\\ПУТЬ}\' не удалось запустить процесс с помощью команды '".\{сборка}.exe" ', код ошибки = 0x80070002 : 0.

* **Журнал модуля ASP.NET Core:** файл журнала создан, но пуст

Устранение неполадок:

* Убедитесь в том, что приложение выполняется локально в Kestrel. Сбой процесса может быть результатом проблемы в приложении. Дополнительные сведения см. в [руководстве по устранению неполадок](xref:host-and-deploy/iis/troubleshoot).

* Проверьте атрибут *processPath* для элемента `<aspNetCore>` в файле *web.config*. Он должен иметь значение *dotnet* для зависимого от платформы развертывания (FDD) или *.\{сборка}.exe* для автономного развертывания (SCD).

* Для зависимого от платформы развертывания файл *dotnet.exe* может быть недоступен по пути, указанному в переменной PATH. Убедитесь в том, что папка *C:\Program Files\dotnet\* существует в системных параметрах PATH.

* В случае с зависимым от платформы развертыванием файл *dotnet.exe* может быть недоступен для удостоверения пользователя, используемого для пула приложений. Убедитесь в том, что удостоверение пользователя AppPool имеет доступ к каталогу *C:\Program Files\dotnet*. Убедитесь в отсутствии запрещающих правил для удостоверения пользователя AppPool в каталоге *C:\Program Files\dotnet* и каталоге приложения.

* Возможно, зависимое от платформы развертывание и .NET Core были установлены без перезапуска служб IIS. Перезагрузите сервер или перезапустите службы IIS, выполнив в командной строке команду **net stop was /y**, а затем — команду **net start w3svc**.

* Возможно, зависимое от платформы развертывание было развернуто без установки среды выполнения .NET Core в размещающей системе. Если среда выполнения .NET Core не была установлена, запустите в целевой системе **установщик пакета размещения .NET Core**. См. статью [Установка пакета размещения .NET Core](xref:host-and-deploy/iis/index#install-the-net-core-hosting-bundle) Если вы пытаетесь установить среду выполнения .NET Core в системе, не имеющей подключения к Интернету, получите среду выполнения на [странице скачивания .NET](https://www.microsoft.com/net/download/all) и запустите установщик пакета размещения, чтобы установить модуль ASP.NET Core. Завершите установку, перезагрузив систему или перезапустив службы IIS. Для этого выполните в командной строке команду **net stop was /y**, а затем — команду **net start w3svc**.

* Возможно, зависимое от платформы развертывание было развернуто в системе, где отсутствует *распространяемый компонент Microsoft Visual C++ 2015 (64-разрядный)*. Получите установщик в [Центре загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=53840).

## <a name="incorrect-arguments-of-aspnetcore-element"></a>Неверные аргументы элемента \<aspNetCore\>

* **Браузер:** ошибка HTTP 502.5 — сбой процесса

* **Журнал приложений:** приложению MACHINE/WEBROOT/APPHOST/{СБОРКА} с физическим корневым каталогом C:\\ПУТЬ}\' не удалось запустить процесс с помощью команды '"dotnet" .\{сборка}.dll',код ошибки = 0x80004005 : 80008081.

* **Журнал модуля ASP.NET Core:** Выполняемое приложение не существует: "PATH\\{сборка}.dll"

Устранение неполадок:

* Убедитесь в том, что приложение выполняется локально в Kestrel. Сбой процесса может быть результатом проблемы в приложении. Дополнительные сведения см. в [руководстве по устранению неполадок](xref:host-and-deploy/iis/troubleshoot).

* Проверьте атрибут *arguments* для элемента `<aspNetCore>` в файле *web.config* и удостоверьтесь, что его значение: а) имеет вид *.\{сборка}.dll* для развертывания, зависящего от платформы (FDD); б) отсутствует, содержит пустую строку (*arguments=""*) или список аргументов вашего приложения (*arguments="arg1, arg2, ..."*) для автономного развертывания (SCD).

## <a name="missing-net-framework-version"></a>Отсутствует версия платформы .NET Framework

* **Браузер:** 502.3 — неверный шлюз. При попытке маршрутизации запроса произошла ошибка подключения.

* **Журнал приложений:** код ошибки = приложению MACHINE/WEBROOT/APPHOST/{СБОРКА} с физическим корневым каталогом C:\\ПУТЬ}\' не удалось запустить процесс с помощью команды '"dotnet" .\{сборка}.dll',код ошибки = 0x80004005 : 80008081.

* **Журнал модуля ASP.NET Core:** Исключение из-за отсутствия метода, файла или сборки. Метод, файл или сборка, указанные в исключении, представляют собой метод, файл или сборку .NET Framework.

Устранение неполадок:

* Установите версию .NET Framework, отсутствующую в системе.

* Если используется зависимое от платформы развертывание (FDD), убедитесь в том, что в системе установлена нужная среда выполнения. Если это исключение возникает, когда проект обновляется с версии 1.1 до 2.0 и развертывается в системе размещения, убедитесь, что на компьютере размещения установлена платформа 2.0.

## <a name="stopped-application-pool"></a>Пул приложений остановлен

* **Браузер:** 503 — служба недоступна

* **Журнал приложений:** нет записи

* **Журнал модуля ASP.NET Core:** файл журнала не создан

Устранение неполадок

* Убедитесь, что пул приложений не находится в состоянии *Остановлен*.

## <a name="iis-integration-middleware-not-implemented"></a>ПО промежуточного слоя для интеграции IIS не внедрено

* **Браузер:** ошибка HTTP 502.5 — сбой процесса

* **Журнал приложений:** приложение MACHINE/WEBROOT/APPHOST/{СБОРКА} с физическим корневым каталогом C:\\{ПУТЬ}\' создало процесс с помощью команды "C:\\{ПУТЬ}\{СБОРКА}.{exe|dll}", однако при этом либо произошел сбой, либо не был получен ответ, либо не прослушивался указанный порт {ПОРТ}; код ошибки = 0x800705b4

* **Журнал модуля ASP.NET Core:** файл журнала создан, и в нем нет сведений о неправильной работе.

Устранение неполадок

* Убедитесь в том, что приложение выполняется локально в Kestrel. Сбой процесса может быть результатом проблемы в приложении. Дополнительные сведения см. в [руководстве по устранению неполадок](xref:host-and-deploy/iis/troubleshoot).

* Убедитесь, что выполняется одно из следующих условий:
  * ПО промежуточного слоя интеграции IIS указывается в вызове метода `UseIISIntegration` в приложении `WebHostBuilder` (ASP.NET Core 1.x).
  * Приложения используют метод `CreateDefaultBuilder` (ASP.NET Core 2.x).
  
  Дополнительные сведения см. в статье [Размещение в ASP.NET Core](xref:fundamentals/host/index).

## <a name="sub-application-includes-a-handlers-section"></a>Дочернее приложение имеет раздел \<handlers\>

* **Браузер:** ошибка HTTP 500.19 — внутренняя ошибка сервера

* **Журнал приложений:** нет записи

* **Журнал модуля ASP.NET Core:** файл журнала создан для корневого приложения и в нем нет сведений о неправильной работе. Файл журнала для дочернего приложения не создан.

Устранение неполадок

* В файле *web.config* дочернего приложения не должно быть раздела `<handlers>`.

## <a name="stdout-log-path-incorrect"></a>Неверный путь к журналу stdout

* **Браузер.** Приложение работает правильно.

* **Журнал приложения.** Предупреждение: не удалось создать stdoutLogFile \\?\C:\_apps\app_folder\bin\Release\netcoreapp2.0\win10-x64\publish\logs\path_doesnt_exist\stdout_8748_201831835937.log, код ошибки = -2147024893.

* **Журнал модуля ASP.NET Core:** файл журнала не создан

Устранение неполадок

* Не существует путь `stdoutLogFile`, указанный в элементе `<aspNetCore>` в файле *web.config*. Дополнительные сведения см. в разделе [о создании и перенаправлении журналов](xref:host-and-deploy/aspnet-core-module#log-creation-and-redirection) в руководстве по конфигурации модуля ASP.NET Core.

## <a name="application-configuration-general-issue"></a>Общая проблема с конфигурацией приложения

* **Браузер:** ошибка HTTP 502.5 — сбой процесса

* **Журнал приложений:** приложение MACHINE/WEBROOT/APPHOST/{СБОРКА} с физическим корневым каталогом C:\\{ПУТЬ}\' создало процесс с помощью команды "C:\\{ПУТЬ}\{СБОРКА}.{exe|dll}", однако при этом либо произошел сбой, либо не был получен ответ, либо не прослушивался указанный порт {ПОРТ}; код ошибки = 0x800705b4

* **Журнал модуля ASP.NET Core:** файл журнала создан, но пуст

Устранение неполадок

* Это общее исключение указывает на то, что процесс не удалось запустить, скорее всего, из-за проблемы с конфигурацией приложения. Обратитесь к статье [Структура каталогов](xref:host-and-deploy/directory-structure) и убедитесь в том, что развернуты все нужные файлы и папки приложения, файлы конфигурации присутствуют и содержат правильные параметры для приложения и среды. Дополнительные сведения см. в [руководстве по устранению неполадок](xref:host-and-deploy/iis/troubleshoot).
