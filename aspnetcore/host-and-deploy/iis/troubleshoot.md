---
title: "Устранение неполадок Core ASP.NET в IIS"
author: guardrex
description: "Сведения для диагностики проблем с развертыванием IIS ASP.NET Core."
manager: wpickett
ms.author: riande
ms.custom: mvc
ms.date: 03/13/2017
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: article
uid: host-and-deploy/iis/troubleshoot
ms.openlocfilehash: c68070a9cba5667504d1ad4927b02b73f83e6573
ms.sourcegitcommit: a510f38930abc84c4b302029d019a34dfe76823b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/30/2018
---
# <a name="troubleshoot-aspnet-core-on-iis"></a><span data-ttu-id="972a5-103">Устранение неполадок Core ASP.NET в IIS</span><span class="sxs-lookup"><span data-stu-id="972a5-103">Troubleshoot ASP.NET Core on IIS</span></span>

<span data-ttu-id="972a5-104">Автор [Люк Латэм](https://github.com/guardrex) (Luke Latham)</span><span class="sxs-lookup"><span data-stu-id="972a5-104">By [Luke Latham](https://github.com/guardrex)</span></span>

<span data-ttu-id="972a5-105">Для диагностики проблем с развертыванием служб IIS:</span><span class="sxs-lookup"><span data-stu-id="972a5-105">To diagnose issues with IIS deployments:</span></span>

* <span data-ttu-id="972a5-106">Изучите выходные данные браузера.</span><span class="sxs-lookup"><span data-stu-id="972a5-106">Study browser output.</span></span>
* <span data-ttu-id="972a5-107">Просмотрите системный **приложения** с помощью средства **Просмотр событий**.</span><span class="sxs-lookup"><span data-stu-id="972a5-107">Examine the system's **Application** log through **Event Viewer**.</span></span>
* <span data-ttu-id="972a5-108">Включите ведение журнала `stdout`.</span><span class="sxs-lookup"><span data-stu-id="972a5-108">Enable `stdout` logging.</span></span> <span data-ttu-id="972a5-109">Журнал **модуля ASP.NET Core** находится по пути, указанном в атрибуте *stdoutLogFile* элемента `<aspNetCore>` в файле *web.config*. Все папки по пути, указанному в значении этого атрибута, должны существовать в развертывании.</span><span class="sxs-lookup"><span data-stu-id="972a5-109">The **ASP.NET Core Module** log is found on the path provided in the *stdoutLogFile* attribute of the `<aspNetCore>` element in *web.config*. Any folders on the path provided in the attribute value must exist in the deployment.</span></span> <span data-ttu-id="972a5-110">Задать *stdoutLogEnabled* для `true`.</span><span class="sxs-lookup"><span data-stu-id="972a5-110">Set *stdoutLogEnabled* to `true`.</span></span> <span data-ttu-id="972a5-111">Приложения, использующие `Microsoft.NET.Sdk.Web` пакет SDK для создания *web.config* файла по умолчанию *stdoutLogEnabled* параметру `false`, вручную предоставить *web.config* файл или измените его так, чтобы включить `stdout` ведения журнала.</span><span class="sxs-lookup"><span data-stu-id="972a5-111">Apps that use the the `Microsoft.NET.Sdk.Web` SDK to create the *web.config* file default the *stdoutLogEnabled* setting to `false`, so manually provide the *web.config* file or modify the file in order to enable `stdout` logging.</span></span>

<span data-ttu-id="972a5-112">Используйте сведения из этих трех источников с [распространенные ошибки ссылается раздел](xref:host-and-deploy/azure-iis-errors-reference) для определения проблемы.</span><span class="sxs-lookup"><span data-stu-id="972a5-112">Use information from those three sources with the [common errors reference topic](xref:host-and-deploy/azure-iis-errors-reference) to determine the problem.</span></span> <span data-ttu-id="972a5-113">Выполните советов по устранению неполадок для решения проблемы.</span><span class="sxs-lookup"><span data-stu-id="972a5-113">Follow the troubleshooting advice provided to resolve the issue.</span></span>

<span data-ttu-id="972a5-114">Некоторые распространенные ошибки не приводятся в браузере, журнале приложений и журнале модуля ASP.NET Core, пока не будут достигнуты значения *startupTimeLimit* (по умолчанию 120 секунд) и *startupRetryCount* (по умолчанию 2).</span><span class="sxs-lookup"><span data-stu-id="972a5-114">Several of the common errors don't appear in the browser, Application Log, and ASP.NET Core Module Log until the module *startupTimeLimit* (default: 120 seconds) and *startupRetryCount* (default: 2) have passed.</span></span> <span data-ttu-id="972a5-115">Поэтому прежде чем делать вывод о том, что модулю не удалось запустить процесс приложения, подождите шесть минут.</span><span class="sxs-lookup"><span data-stu-id="972a5-115">Therefore, wait a full six minutes before deducing that the module has failed to start a process for the app.</span></span>

<span data-ttu-id="972a5-116">Один из простых способов определить, правильно ли работает приложение, — запустить его непосредственно в Kestrel.</span><span class="sxs-lookup"><span data-stu-id="972a5-116">One quick way to determine if the app is working properly is to run the app directly on Kestrel.</span></span> <span data-ttu-id="972a5-117">Если приложение опубликовано как [развертывания зависит от framework](/dotnet/core/deploying/#framework-dependent-deployments-fdd), выполнение `dotnet <assembly_name>.dll` в папку развертывания, который является физический путь приложения IIS.</span><span class="sxs-lookup"><span data-stu-id="972a5-117">If the app was published as a [framework-dependent deployment](/dotnet/core/deploying/#framework-dependent-deployments-fdd), execute `dotnet <assembly_name>.dll` in the deployment folder, which is the IIS physical path to the app.</span></span> <span data-ttu-id="972a5-118">Если приложение опубликовано как [автономное развертывание](/dotnet/core/deploying/#self-contained-deployments-scd), запустите приложение в исполняемый файл непосредственно из командной строки, `<assembly_name>.exe`, в папку развертывания.</span><span class="sxs-lookup"><span data-stu-id="972a5-118">If the app was published as a [self-contained deployment](/dotnet/core/deploying/#self-contained-deployments-scd), run the app's executable directly from a command prompt, `<assembly_name>.exe`, in the deployment folder.</span></span> <span data-ttu-id="972a5-119">Если Kestrel прослушивает порт по умолчанию 5000, приложение должно находиться в `http://localhost:5000/`.</span><span class="sxs-lookup"><span data-stu-id="972a5-119">If Kestrel is listening on default port 5000, the app should be available at `http://localhost:5000/`.</span></span> <span data-ttu-id="972a5-120">Если приложение обычно отвечает Kestrel адрес конечной точки, проблема скорее всего, конфигурации обратного прокси-сервера и меньшей вероятностью в приложении, связанные с.</span><span class="sxs-lookup"><span data-stu-id="972a5-120">If the app responds normally at the Kestrel endpoint address, the problem is more likely related to the reverse proxy configuration and less likely within the app.</span></span>

<span data-ttu-id="972a5-121">Является одним из способов определения правильности работы обратного прокси-сервера для выполнения простой статический файл запрос для таблицы стилей, скрипта или образ из статических файлов приложения в *wwwroot* с помощью [промежуточного слоя статических файлов](xref:fundamentals/static-files).</span><span class="sxs-lookup"><span data-stu-id="972a5-121">One way to determine if the reverse proxy is working properly is to perform a simple static file request for a stylesheet, script, or image from the app's static files in *wwwroot* using [Static File Middleware](xref:fundamentals/static-files).</span></span> <span data-ttu-id="972a5-122">Если приложение может обрабатывать статические файлы, но не удается установить представления MVC и других конечных точек, проблема заключается в меньшей вероятностью связанные с конфигурацией обратного прокси-сервера и скорее всего, в приложении (например для маршрутизации MVC или 500 Внутренняя ошибка сервера).</span><span class="sxs-lookup"><span data-stu-id="972a5-122">If the app can serve static files but MVC Views and other endpoints are failing, the problem is less likely related to the reverse proxy configuration and more likely within the app (for example, MVC routing or 500 Internal Server Error).</span></span>

<span data-ttu-id="972a5-123">При Kestrel обычно запускается под IIS, но приложение не будет выполняться в системе после успешного запуска локально, переменной среды можно временно добавляется в *web.config* для задания `ASPNETCORE_ENVIRONMENT` для `Development`.</span><span class="sxs-lookup"><span data-stu-id="972a5-123">When Kestrel starts normally behind IIS but the app won't run on the system after successfully running locally, an environment variable can be temporarily added to *web.config* to set the `ASPNETCORE_ENVIRONMENT` to `Development`.</span></span> <span data-ttu-id="972a5-124">До тех пор, пока среда не переопределено в запуске приложения, установив переменную среды позволяет [страницы разработчик исключений](xref:fundamentals/error-handling) для отображения при запуске приложения.</span><span class="sxs-lookup"><span data-stu-id="972a5-124">As long as the environment isn't overridden in app startup, setting the environment variable allows the [developer exception page](xref:fundamentals/error-handling) to appear when the app is run.</span></span> <span data-ttu-id="972a5-125">Новое значение переменной среды для `ASPNETCORE_ENVIRONMENT` таким образом рекомендуется только для промежуточного хранения и тестирование серверов, которые не показываются в Интернет.</span><span class="sxs-lookup"><span data-stu-id="972a5-125">Setting the environment variable for `ASPNETCORE_ENVIRONMENT` in this way is only recommended for staging/testing servers that aren't exposed to the Internet.</span></span> <span data-ttu-id="972a5-126">Не забудьте удалить переменную среды из *web.config* файла после завершения.</span><span class="sxs-lookup"><span data-stu-id="972a5-126">Be sure to remove the environment variable from the *web.config* file when finished.</span></span> <span data-ttu-id="972a5-127">Дополнительные сведения о задании переменные среды посредством *web.config*, в разделе [переменных среды дочерний элемент элемента aspNetCore](xref:host-and-deploy/aspnet-core-module#setting-environment-variables).</span><span class="sxs-lookup"><span data-stu-id="972a5-127">For information on setting environment variables via *web.config*, see [environmentVariables child element of aspNetCore](xref:host-and-deploy/aspnet-core-module#setting-environment-variables).</span></span>

<span data-ttu-id="972a5-128">В большинстве случаев включение журнала приложений помогает находить и устранять проблемы, связанные с приложением или обратным прокси-сервером.</span><span class="sxs-lookup"><span data-stu-id="972a5-128">In most cases, enabling application logging assists in troubleshooting problems with the app or the reverse proxy.</span></span> <span data-ttu-id="972a5-129">Дополнительные сведения см. в статье, посвященной [ведению журналов](xref:fundamentals/logging/index).</span><span class="sxs-lookup"><span data-stu-id="972a5-129">See [Logging](xref:fundamentals/logging/index) for more information.</span></span>

<span data-ttu-id="972a5-130">Совет по устранению неполадок относится к приложениям, которые не смогут работать после обновления, либо Core .NET SDK в версиях машины или пакет разработки в приложении.</span><span class="sxs-lookup"><span data-stu-id="972a5-130">The last troubleshooting tip pertains to apps that fail to run after upgrading either the .NET Core SDK on the development machine or package versions within the app.</span></span> <span data-ttu-id="972a5-131">В некоторых случаях в результате важного обновления несогласованные версии пакетов могут привести к нарушению работы приложения.</span><span class="sxs-lookup"><span data-stu-id="972a5-131">In some cases, incoherent packages may break an app when performing major upgrades.</span></span> <span data-ttu-id="972a5-132">Большая часть этих проблем можно устранить путем:</span><span class="sxs-lookup"><span data-stu-id="972a5-132">Most of these issues can be fixed by:</span></span>

* <span data-ttu-id="972a5-133">Удаление `bin` и `obj` папки в проекте.</span><span class="sxs-lookup"><span data-stu-id="972a5-133">Deleting the `bin` and `obj` folders in the project.</span></span>
* <span data-ttu-id="972a5-134">Очистка пакета кэширует на `%UserProfile%\.nuget\packages\` и `%LocalAppData%\Nuget\v3-cache`.</span><span class="sxs-lookup"><span data-stu-id="972a5-134">Clearing package caches at `%UserProfile%\.nuget\packages\` and `%LocalAppData%\Nuget\v3-cache`.</span></span>
* <span data-ttu-id="972a5-135">Восстановление и построить проект заново.</span><span class="sxs-lookup"><span data-stu-id="972a5-135">Restoring and rebuilding the project.</span></span>
* <span data-ttu-id="972a5-136">Подтверждает, что предыдущего развертывания на сервере полностью удалено до повторного развертывания приложения.</span><span class="sxs-lookup"><span data-stu-id="972a5-136">Confirming that the prior deployment on the server has been completely deleted prior to re-deploying the app.</span></span>

> [!TIP]
> <span data-ttu-id="972a5-137">Чтобы очистить кэш пакета удобно для выполнения `dotnet nuget locals all --clear` из командной строки.</span><span class="sxs-lookup"><span data-stu-id="972a5-137">A convenient way to clear package caches is to execute `dotnet nuget locals all --clear` from a command prompt.</span></span>
> 
> <span data-ttu-id="972a5-138">Очистка кэша пакета можно также с помощью [nuget.exe](https://www.nuget.org/downloads) средство и выполнения команды `nuget locals all -clear`.</span><span class="sxs-lookup"><span data-stu-id="972a5-138">Clearing package caches can also be accomplished by using the [nuget.exe](https://www.nuget.org/downloads) tool and executing the command `nuget locals all -clear`.</span></span> <span data-ttu-id="972a5-139">*NuGet.exe* не объединенной установки с Windows 10 и должны быть получены отдельно на веб-сайте NuGet.</span><span class="sxs-lookup"><span data-stu-id="972a5-139">*nuget.exe* isn't a bundled install with Windows 10 and must be obtained separately from the NuGet website.</span></span>
<!--
> [!TIP]
> A convenient way to clear package caches is to:
>
> * Obtain the *NuGet.exe* tool from [NuGet.org](https://www.nuget.org/).
> * Add the path to *NuGet.exe* to the system PATH.
> * Execute `nuget locals all -clear` from a command prompt.
>
> Alternatively, execute `dotnet nuget locals all --clear` from a command prompt without obtaining *NuGet.exe*. -->

## <a name="additional-resources"></a><span data-ttu-id="972a5-140">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="972a5-140">Additional resources</span></span>

* [<span data-ttu-id="972a5-141">Справочник по общим ошибкам для службы приложений Azure и служб IIS с ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="972a5-141">Common errors reference for Azure App Service and IIS with ASP.NET Core</span></span>](xref:host-and-deploy/azure-iis-errors-reference)
* [<span data-ttu-id="972a5-142">Справочник по конфигурации модуля ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="972a5-142">ASP.NET Core Module configuration reference</span></span>](xref:host-and-deploy/aspnet-core-module)
