---
title: "Устранение неполадок Core ASP.NET в IIS"
author: guardrex
description: "Сведения для диагностики проблем с развертыванием приложений ASP.NET Core Internet Information Services (IIS)."
manager: wpickett
ms.author: riande
ms.custom: mvc
ms.date: 02/07/2018
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: article
uid: host-and-deploy/iis/troubleshoot
ms.openlocfilehash: 65173e0101a17c64f4cde583e5bbb9fb0a9c7718
ms.sourcegitcommit: b83a5f731a9c02bdb1cc1e3f9a8bf273eb5b33e0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/11/2018
---
# <a name="troubleshoot-aspnet-core-on-iis"></a>Устранение неполадок Core ASP.NET в IIS

Автор [Люк Латэм](https://github.com/guardrex) (Luke Latham)

Эта статья содержит инструкции о том, как ASP.NET Core диагностики проблемы при запуске приложения при размещении в службах [Internet Information Services (IIS)](/iis). Информация в этой статье относится к размещение в службах IIS на сервере Windows и Windows Desktop.

В Visual Studio, проект ASP.NET Core по умолчанию [IIS Express](/iis/extensions/introduction-to-iis-express/iis-express-overview) размещения во время отладки. Объект *502.5 сбой процесса* , происходящее, когда отладка локально, может быть troubleshooted с помощью советов по в этом разделе.

Дополнительные статьи по устранению неполадок:

[Устранение неполадок ASP.NET Core в службе приложений Azure](xref:host-and-deploy/azure-apps/troubleshoot)  
Несмотря на то, что приложение службы использует [модуль ASP.NET Core](xref:fundamentals/servers/aspnet-core-module) и IIS для ведущего приложения, см. в разделе, выделенной инструкции, специфические для приложения службы.

[Обработка ошибок](xref:fundamentals/error-handling)  
Узнайте, как обрабатывать ошибки в приложениях ASP.NET Core во время разработки в локальной системе.

[Сведения об отладке с помощью Visual Studio](/visualstudio/debugger/getting-started-with-the-debugger)  
Этот раздел знакомит с возможностями отладчика Visual Studio.

## <a name="app-startup-errors"></a>Ошибки при запуске приложения

**502.5 сбой процесса**  
Рабочий процесс завершается ошибкой. Приложение не запускается.

Модуль Core ASP.NET пытается запустить рабочий процесс, но он не запускается. Обычно причиной сбоя при запуске процесса можно определить по записи в [журнал событий приложений](#application-event-log) и [модуль ASP.NET Core stdout журнала](#aspnet-core-module-stdout-log).

*502.5 сбой процесса* возвращаемая страница ошибки, когда неправильной конфигурации приложения или размещение приводит к сбою рабочий процесс:

![Окно браузера, показывающий 502.5 страницу ошибки процесса](troubleshoot/_static/process-failure-page.png)

**500 Внутренняя ошибка сервера**  
Приложение запускается, но ошибка не позволяет выполнить запрос сервера.

Эта ошибка возникает в коде приложения при запуске или при создании ответа. Ответ может содержать отсутствует содержимое или ответ может выглядеть как *500 Внутренняя ошибка сервера* в браузере. Журнал событий приложений обычно состояний обычном запуске приложения. С точки зрения сервера верно. Приложения был запущен, но его не удается создать допустимый ответ. [Запуск приложения в командной строке](#run-the-app-at-a-command-prompt) на сервере или [включите журнал stdout модуль ASP.NET Core](#aspnet-core-module-stdout-log) для устранения неполадок.

**Сброс подключения**

Если ошибка возникает после отправки заголовков, уже слишком поздно для сервера для отправки **500 Внутренняя ошибка сервера** при возникновении ошибки. Это часто происходит при возникновении ошибки во время сериализации ответа сложных объектов. Ошибки такого типа отображается как *Сброс соединения* ошибки на стороне клиента. [Ведение журналов для приложений](xref:fundamentals/logging/index) устранения таких ошибок.

## <a name="default-startup-limits"></a>Ограничения по умолчанию при запуске

Значение по умолчанию настроен модуль ASP.NET Core *startupTimeLimit* 120 секунд. Если оставить значение по умолчанию, приложение может занять до двух минут для запуска до ошибки в процессе входа модуля. Сведения о настройке модуля см. в разделе [атрибуты элемента aspNetCore](xref:host-and-deploy/aspnet-core-module#attributes-of-the-aspnetcore-element).

## <a name="troubleshoot-app-startup-errors"></a>Устранение ошибок при запуске приложения

### <a name="application-event-log"></a>Журнал событий приложений

Доступ к журналу событий приложений:

1. Откройте меню "Пуск", поиск **средство просмотра событий**и выберите **средство просмотра событий** приложения.
1. В **средство просмотра событий**откройте **журналы Windows** узла.
1. Выберите **приложения** открыть журнал событий приложения.
1. Поиск ошибок, связанных с приложением сбоя. Ошибки имеют значение *модуля IIS AspNetCore* или *IIS Express AspNetCore модуль* в *источника* столбца.

### <a name="run-the-app-at-a-command-prompt"></a>Запуск приложения из командной строки

Многие ошибки запуска не создают полезные сведения в журнале событий приложений. Причиной ошибки можно найти путем запуска приложения из командной строки на хост-системы.

**Зависящие от Framework развертывания**

Если приложение является [развертывания зависит от framework](/dotnet/core/deploying/#framework-dependent-deployments-fdd):

1. В командной строке перейдите в папку развертывания, и запустить приложение, выполнив сборку приложения с *dotnet.exe*. В следующей команде замените имя сборки приложения для \<assembly_name >: `dotnet .\<assembly_name>.dll`.
1. Выходные данные консоли из приложения, отображаются все ошибки записываются в окно консоли.
1. Если ошибки возникают при выполнении запроса к приложению, выполните запрос на узел и порт, где Kestrel. С помощью узла по умолчанию и post, сделать запрос к `http://localhost:5000/`. Если приложение обычно отвечает Kestrel адрес конечной точки, проблема скорее всего, конфигурации обратного прокси-сервера и меньшей вероятностью в приложении, связанные с.

**Автономное развертывание**

Если приложение является [автономное развертывание](/dotnet/core/deploying/#self-contained-deployments-scd):

1. В командной строке перейдите в папку развертывания и запустите исполняемый файл приложения. В следующей команде замените имя сборки приложения для \<assembly_name >: `<assembly_name>.exe`.
1. Выходные данные консоли из приложения, отображаются все ошибки записываются в окно консоли.
1. Если ошибки возникают при выполнении запроса к приложению, выполните запрос на узел и порт, где Kestrel. С помощью узла по умолчанию и post, сделать запрос к `http://localhost:5000/`. Если приложение обычно отвечает Kestrel адрес конечной точки, проблема скорее всего, конфигурации обратного прокси-сервера и меньшей вероятностью в приложении, связанные с.

### <a name="aspnet-core-module-stdout-log"></a>Журнал stdout модуль Core ASP.NET

Для включения и просмотра журналов stdout:

1. Перейдите в папку развертывания на сайте на хост-системы.
1. Если *журналы* папки не существуют, создайте папку. Инструкции по включению MSBuild для создания *журналы* папку в развертывании автоматически, в разделе [структуру каталогов](xref:host-and-deploy/directory-structure) раздела.
1. Изменить *web.config* файла. Задать **stdoutLogEnabled** для `true` и измените **stdoutLogFile** путь должен указывать *журналы* папку (например, `.\logs\stdout`). `stdout`в пути — это префикс имени файла журнала. Отметка времени, идентификатор процесса и расширение файла добавляются автоматически при создании журнала. С помощью `stdout` как префикс имени файла журнала обычно файл с именем *stdout_20180205184032_5412.log*. 
1. Сохраните Обновленный *web.config* файла.
1. Сделать запрос к приложению.
1. Перейдите к *журналы* папки. Найдите и откройте журнал последних stdout.
1. Изучите журнал на наличие ошибок.

**Важно!** Отключите ведение журнала stdout, после завершения устранения неполадок.

1. Изменить *web.config* файла.
1. Задать **stdoutLogEnabled** для `false`.
1. Сохраните файл.

> [!WARNING]
> Неудача при отключении журнала stdout может привести к сбоям приложения или сервера. Нет ограничения на размер файла журнала или количество созданных файлов журналов.
>
> Для процедуры входа в приложение ASP.NET Core, используйте библиотеку ведения журнала, которая ограничивает размер файла журнала и поворачивает журналы. Дополнительные сведения см. в разделе [сторонних регистраторов](xref:fundamentals/logging/index#third-party-logging-providers).

## <a name="enabling-the-developer-exception-page"></a>Включение странице исключение разработчика

`ASPNETCORE_ENVIRONMENT` [Переменной среды можно добавить в файл web.config](xref:host-and-deploy/aspnet-core-module#setting-environment-variables) для запуска приложения в среде разработки. До тех пор, пока среде не переопределено в запуск приложений путем `UseEnvironment` построитель узел, установив переменную среды позволяет [страницы разработчик исключений](xref:fundamentals/error-handling) для отображения при запуске приложения.

```xml
<aspNetCore processPath="dotnet"
      arguments=".\MyApp.dll"
      stdoutLogEnabled="false"
      stdoutLogFile=".\logs\stdout">
  <environmentVariables>
    <environmentVariable name="ASPNETCORE_ENVIRONMENT" value="Development" />
  </environmentVariables>
</aspNetCore>
```

Новое значение переменной среды для `ASPNETCORE_ENVIRONMENT` рекомендуется только для использования в промежуточной и тестовых серверах, которые не подключены к Интернету. Удалить переменную среды из *web.config* файла после устранения неполадок. Сведения о настройке переменных среды *web.config*, в разделе [переменных среды дочерний элемент элемента aspNetCore](xref:host-and-deploy/aspnet-core-module#setting-environment-variables).

## <a name="common-startup-errors"></a>Распространенные ошибки запуска 

В разделе [общую ссылку ошибки ASP.NET Core](xref:host-and-deploy/azure-iis-errors-reference). В справочном разделе рассматриваются наиболее распространенных проблем, препятствующих запуск приложений.

## <a name="slow-or-hanging-app"></a>Приложение медленно или красная

Когда приложение медленно реагирует или зависает на запрос, получать и анализировать [файл дампа](/visualstudio/debugger/using-dump-files). Файлы дампа можно получить с помощью любого из следующих средств:

* [ProcDump](/sysinternals/downloads/procdump)
* [DebugDiag](https://www.microsoft.com/download/details.aspx?id=49924)
* WinDbg: [загрузить инструменты отладки для Windows](https://developer.microsoft.com/windows/hardware/download-windbg), [отладки с помощью WinDbg.](/windows-hardware/drivers/debugger/debugging-using-windbg)

## <a name="remote-debugging"></a>Удаленная отладка

В разделе [удаленной отладки ASP.NET Core на удаленном компьютере IIS в Visual Studio 2017 г](/visualstudio/debugger/remote-debugging-aspnet-on-a-remote-iis-computer) в документации по Visual Studio.

## <a name="application-insights"></a>Application Insights

[Application Insights](/azure/application-insights/) предоставляет телеметрии из приложения, размещенные в IIS, включая регистрации ошибок и функции отчетов. Application Insights можно только отчетов об ошибках, произошедших после запуска приложения, когда становятся доступными возможности ведения журнала приложения. Дополнительные сведения см. в разделе [Application Insights для ASP.NET Core](/azure/application-insights/app-insights-asp-net-core).

## <a name="additional-troubleshooting-advice"></a>Дополнительные советы по устранению неполадок

Иногда работающее приложение не удается выполнить после обновления Core SDK .NET в версиях машины или пакет разработки в приложении. В некоторых случаях в результате важного обновления несогласованные версии пакетов могут привести к нарушению работы приложения. Большая часть этих проблем можно исправить следующим инструкциям:

1. Удалить *bin* и *obj* папки.
1. Снимите кэширует пакета в *% UserProfile %\\.nuget\\пакетов* и *% LocalAppData %\\Nuget\\v3 кэша*.
1. Восстановите и перестройте проект.
1. Убедитесь, что предыдущего развертывания на сервере были полностью удалены до повторного развертывания приложения.

> [!TIP]
> Чтобы очистить кэш пакета удобно для выполнения `dotnet nuget locals all --clear` из командной строки.
> 
> Очистка кэша пакета можно также с помощью [nuget.exe](https://www.nuget.org/downloads) средство и выполнения команды `nuget locals all -clear`. *NuGet.exe* не объединенной установки в операционной системе Windows для настольных компьютеров и должны быть получены отдельно от [веб-сайте NuGet](https://www.nuget.org/downloads).

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Общие сведения об обработке ошибок в ASP.NET Core](xref:fundamentals/error-handling)
* [Справочник по общим ошибкам для службы приложений Azure и служб IIS с ASP.NET Core](xref:host-and-deploy/azure-iis-errors-reference)
* [Справочник по конфигурации модуля ASP.NET Core](xref:host-and-deploy/aspnet-core-module)
* [Устранение неполадок ASP.NET Core в службе приложений Azure](xref:host-and-deploy/azure-apps/troubleshoot)
