---
uid: web-api/overview/security/external-authentication-services
title: "Внешние службы проверки подлинности с помощью веб-API ASP.NET (C#) | Документы Microsoft"
author: rmcmurray
description: "Описывает использование внешние службы проверки подлинности в ASP.NET Web API."
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/26/2013
ms.topic: article
ms.assetid: 3bb8eb15-b518-44f5-a67d-a27e051aedc6
ms.technology: dotnet-webapi
ms.prod: .net-framework
msc.legacyurl: /web-api/overview/security/external-authentication-services
msc.type: authoredcontent
ms.openlocfilehash: 744396cb0c95d1887f259b1e2e890bd06ef7d049
ms.sourcegitcommit: 016f4d58663bcd442930227022de23fb3abee0b3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/12/2018
---
<a name="external-authentication-services-with-aspnet-web-api-c"></a>Внешние службы проверки подлинности с помощью веб-API ASP.NET (C#)
====================
по [Robert McMurray](https://github.com/rmcmurray)

Visual Studio 2013 и ASP.NET 4.5.1 разверните параметры безопасности для [приложений на одной странице](../../../single-page-application/index.md) (SPA) и [веб-API](../../index.md) службы интегрируются с внешние службы проверки подлинности, которые включают несколько OAuth или OpenID и социальные службы проверки подлинности: учетные записи Microsoft, Facebook, Twitter и Google.

### <a name="in-this-walkthrough"></a>В этом пошаговом руководстве

- [Внешние службы проверки подлинности с помощью](#USING)
- [Создание примера веб-приложения](#SAMPLE)
- [Включение проверки подлинности Facebook](#FACEBOOK)
- [Включение проверки подлинности Google](#GOOGLE)
- [Включение проверки подлинности Майкрософт](#MICROSOFT)
- [Включение проверки подлинности Twitter](#TWITTER)
- [Дополнительные сведения](#MOREINFO)

    - [Объединение внешние службы проверки подлинности](#COMBINE)
    - [Настройки IIS Express для использования полного доменного имени](#FQDN)
    - [Как получить параметры приложения для проверки подлинности Майкрософт](#OBTAIN)
    - [Необязательно: Отключить регистрацию локального](#DISABLE)

### <a name="prerequisites"></a>Предварительные требования

Чтобы выполнить примеры в этом пошаговом руководстве, необходимо иметь следующее:

- Visual Studio 2013
- Хотя бы для одного из следующих служб внешней проверки подлинности учетной записи:

    - Учетная запись пользователя Google
    - Учетная запись разработчика с идентификатором приложения и секретный ключ для одной из следующих служб проверки подлинности социальных сетей:

        - Учетные записи Майкрософт ([https://go.microsoft.com/fwlink/?LinkID=144070](https://go.microsoft.com/fwlink/?LinkID=144070))
        - Twitter ([https://dev.twitter.com/](https://dev.twitter.com/))
        - Facebook ([https://developers.facebook.com/](https://developers.facebook.com/))

<a id="USING"></a>
## <a name="using-external-authentication-services"></a>Внешние службы проверки подлинности с помощью

Множество внешние службы проверки подлинности, доступных для веб-разработчиков Справка для разработки уменьшения времени при создании новых веб-приложений. Веб-пользователей обычно имеют несколько существующих учетных записей для популярных веб-служб и веб-сайты социальных сетей, поэтому при реализует приложения web, из внешней веб-службе или социальные веб-сайта служб проверки подлинности, она сохраняет времени разработки будет потраченных вариант реализации проверки подлинности. С помощью службы внешней проверки подлинности сохраняет конечных пользователей от необходимости создавать другую учетную запись для веб-приложения, а также от необходимости запоминать другое имя пользователя и пароль.

В прошлом, разработчики испытывали два варианта: создать свою собственную реализацию проверки подлинности или узнайте, как интегрировать службу внешней проверки подлинности в свои приложения. На самом базовом уровне, на следующей схеме показана потока простого запроса для агента пользователя (веб-браузер), который запрашивает сведения из веб-приложения, который настроен для использования внешней проверки подлинности службы:

[![](external-authentication-services/_static/image2.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image1.png)

На предыдущей схеме агент пользователя (или веб-браузер, в этом примере) отправляет запрос веб-приложения, который перенаправляет запрос службы проверки подлинности внешнего веб-браузера. Агент пользователя отправляет свои учетные данные в службу внешней проверки подлинности, и если агент пользователя успешно прошел проверку, службу внешней проверки подлинности будет перенаправлять агент пользователя для исходного веб-приложения с использованием некоторой типа маркера, который агент пользователя отправляет веб-приложения. Веб-приложение будет использовать токен для убедитесь, что агент пользователя успешно проверена службой внешней проверки подлинности и веб-приложение может использовать для получения дополнительных сведений об агенте пользователя. Когда приложение выполняется обработка сведений агента пользователя, веб-приложение будет возвращать соответствующий ответ на агент пользователя, в соответствии с параметрами авторизации.

В во втором примере агент пользователя взаимодействует с веб-приложением и внешние авторизации сервера и веб-приложения выполняет дополнительное взаимодействие с сервером внешней авторизации для получения дополнительных сведений о пользователе агент:

[![](external-authentication-services/_static/image4.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image3.png)

Visual Studio 2013 и ASP.NET 4.5.1 упростить интеграцию с внешние службы проверки подлинности для разработчиков благодаря встроенной интеграции для следующих служб проверки подлинности:

- Facebook
- Google
- Учетные записи Майкрософт (учетные записи Windows Live ID)
- Twitter

Примеры в этом пошаговом руководстве будет показано, как настройка каждого из поддерживаемых внешние службы проверки подлинности с помощью нового шаблона веб-приложения ASP.NET, который поставляется с Visual Studio 2013.

> [!NOTE]
> При необходимости, может потребоваться добавить полное доменное имя в параметрах службы внешней проверки подлинности. Это требование основано на ограничения безопасности для некоторых служб внешней проверки подлинности, которым требуется полное доменное имя в параметрах приложения, сопоставляемое полное доменное имя, который используется клиентами. (Для этого действия в значительной мере для каждой службы внешней проверки подлинности необходимо обратиться к документации для каждой внешней проверки подлинности службы, чтобы проверить, является ли обязательным и способах настройки этих параметров.) Если необходимо настроить IIS Express для использования полного доменного ИМЕНИ для тестирования данной среды см. в разделе [настройки IIS Express использовать полное доменное имя](#FQDN) далее в этом пошаговом руководстве.


<a id="SAMPLE"></a>
## <a name="creating-a-sample-web-application"></a>Создание примера веб-приложения

Ниже поможет созданию образца приложения с помощью шаблона веб-приложения ASP.NET, и будет использовать этот образец приложения для каждой из служб внешней проверки подлинности далее в этом пошаговом руководстве.

Запустите Visual Studio 2013 выберите **новый проект** с начальной страницы. Или из **файл** последовательно выберите пункты **New** и затем **проекта**.

[![](external-authentication-services/_static/image6.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image5.png)

Когда **новый проект** отображается диалоговое окно, выберите пункт **установленные** **шаблоны** и разверните **Visual C#**. В разделе **Visual C#**выберите **Web**. В списке шаблонов проектов выберите **веб-приложение ASP.NET**. Введите имя для своего проекта и нажмите кнопку **ОК**.

[![](external-authentication-services/_static/image8.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image7.png)

Когда **новый проект ASP.NET** — отображается, выберите пункт **SPA** шаблона и нажмите кнопку **Создание проекта**.

[![](external-authentication-services/_static/image10.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image9.png)

Ожидание, как Visual Studio 2013 создается проект.

[![](external-authentication-services/_static/image12.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image11.png)

После завершения создания проекта Visual Studio 2013 откройте *Startup.Auth.cs* файл, расположенный в **приложения\_запустить** папки.

[![](external-authentication-services/_static/image14.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image13.png)

При создании проекта, внешние службы проверки подлинности не включены в *Startup.Auth.cs* файла; ниже показано, что ваш код может выглядеть следующим образом, с разделами, выделенной для where включен Внешняя проверка подлинности службы и все соответствующие параметры для использования проверки подлинности учетных записей Майкрософт, Twitter, Facebook или Google вместе с приложением ASP.NET:

[!code-csharp[Main](external-authentication-services/samples/sample1.cs)]

При нажатии клавиши F5 для построения и отладки веб-приложения, появится экран входа, где вы увидите, что были определены не внешние службы проверки подлинности.

[![](external-authentication-services/_static/image16.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image15.png)

В следующих разделах вы узнаете, как включить каждой из внешней проверки подлинности служб, предоставляемых с ASP.NET в Visual Studio 2013.

<a id="FACEBOOK"></a>
## <a name="enabling-facebook-authentication"></a>Включение проверки подлинности Facebook

Facebook с помощью проверки подлинности необходимо создать учетную запись разработчика Facebook и проекта потребуется идентификатор приложения и секретный ключ от Facebook для своей работы. Сведения о создании учетной записи разработчика Facebook и получение идентификатора приложения и секретный ключ см. в разделе [https://go.microsoft.com/fwlink/?LinkID=252166](https://go.microsoft.com/fwlink/?LinkID=252166).

Получив идентификатор приложения и секретный ключ, выполните следующие действия для включения проверки подлинности Facebook для веб-приложения.

1. Когда проект открыт в Visual Studio 2013, откройте *Startup.Auth.cs* файла:

    [![](external-authentication-services/_static/image18.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image17.png)
2. Найдите раздел, выделенный код:

    [!code-csharp[Main](external-authentication-services/samples/sample2.cs)]
3. Удалить &quot; // &quot; символов Раскомментировать выделенные строки кода, а затем добавьте код приложения и секретный ключ. После добавления этих параметров можно повторную компиляцию проекта:

    [!code-csharp[Main](external-authentication-services/samples/sample3.cs)]
4. При нажатии клавиши F5, чтобы открыть веб-приложения в веб-браузере, вы увидите, что Facebook определен как службу внешней проверки подлинности:

    [![](external-authentication-services/_static/image20.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image19.png)
5. При нажатии кнопки **Facebook** кнопки, будет выполнено перенаправление на страницу входа Facebook:

    [![](external-authentication-services/_static/image22.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image21.png)
6. После ввода учетных данных Facebook и нажмите кнопку **вход**, веб-браузере будет перенаправлено обратно в веб-приложения, которой будет предложено ввести **имя пользователя** , которую требуется связать с вашей Учетная запись Facebook:

    [![](external-authentication-services/_static/image24.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image23.png)
7. После ввода имени пользователя и щелчке **зарегистрироваться** кнопки, веб-приложение будет отображаться по умолчанию **Домашняя страница** для учетной записи Facebook:

    [![](external-authentication-services/_static/image26.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image25.png)

<a id="GOOGLE"></a>
## <a name="enabling-google-authentication"></a>Включение проверки подлинности Google

Является наиболее простым внешней проверки подлинности служб для включения, так как он не требует учетной записи разработчика, а требуются дополнительные сведения, как код приложения или секретный ключ, как другие внешние службы проверки подлинности Google требующий.

Чтобы включить проверку подлинности Google для веб-приложения, выполните следующие действия:

1. Когда проект открыт в Visual Studio 2013, откройте *Startup.Auth.cs* файла:

    [![](external-authentication-services/_static/image28.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image27.png)
2. Найдите раздел, выделенный код:

    [!code-csharp[Main](external-authentication-services/samples/sample4.cs)]
3. Удалить &quot; // &quot; символов раскомментируйте выделенную строку кода и перекомпиляции проекта:

    [!code-csharp[Main](external-authentication-services/samples/sample5.cs)]
4. При нажатии клавиши F5, чтобы открыть веб-приложения в веб-браузере, вы увидите, что Google определен как службу внешней проверки подлинности:

    [![](external-authentication-services/_static/image30.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image29.png)
5. При нажатии кнопки **Google** кнопки, будет выполнено перенаправление на страницу входа Google:

    [![](external-authentication-services/_static/image32.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image31.png)
6. После ввода учетных данных Google и нажмите кнопку **входа**, Google предложит убедитесь, что веб-приложение имеет разрешения на доступ к вашей учетной записи Google:

    [![](external-authentication-services/_static/image34.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image33.png)
7. При нажатии кнопки **Accept**, веб-браузере будет перенаправлено обратно в веб-приложения, который будет предложено ввести **имя пользователя** , которую требуется связать с вашей учетной записи Google:

    [![](external-authentication-services/_static/image36.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image35.png)
8. После ввода имени пользователя и щелчке **зарегистрироваться** кнопки, веб-приложение будет отображаться по умолчанию **Домашняя страница** для вашей учетной записи Google:

    [![](external-authentication-services/_static/image38.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image37.png)

<a id="MICROSOFT"></a>
## <a name="enabling-microsoft-authentication"></a>Включение проверки подлинности Майкрософт

Проверки подлинности Майкрософт необходимо создать учетную запись разработчика, и для него необходим идентификатор клиента и секрет клиента для своей работы. Сведения о создании учетную запись разработчика Майкрософт и получение идентификатора клиента и секрет клиента см. в разделе [https://go.microsoft.com/fwlink/?LinkID=144070](https://go.microsoft.com/fwlink/?LinkID=144070).

Получив ваш ключ клиента и секрет пользователя, выполните следующие действия, чтобы включить проверку подлинности Microsoft для веб-приложения:

1. Когда проект открыт в Visual Studio 2013, откройте *Startup.Auth.cs* файла:

    [![](external-authentication-services/_static/image40.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image39.png)
2. Найдите раздел, выделенный код:

    [!code-csharp[Main](external-authentication-services/samples/sample6.cs)]
3. Удалить &quot; // &quot; символов Раскомментировать выделенные строки кода, а затем добавьте идентификатор клиента и секрет клиента. После добавления этих параметров можно повторную компиляцию проекта:

    [!code-csharp[Main](external-authentication-services/samples/sample7.cs)]
4. При нажатии клавиши F5, чтобы открыть веб-приложения в веб-браузере, вы увидите, что Microsoft был определен как службу внешней проверки подлинности:

    [![](external-authentication-services/_static/image42.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image41.png)
5. При нажатии кнопки **Microsoft** кнопки, будет выполнено перенаправление на страницу входа Microsoft:

    [![](external-authentication-services/_static/image44.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image43.png)
6. Введите учетные данные Microsoft и нажмите кнопку **входа**, вам будет предложено убедитесь, что веб-приложение имеет разрешения на доступ к учетной записи Майкрософт:

    [![](external-authentication-services/_static/image46.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image45.png)
7. При нажатии кнопки **Да**, веб-браузере будет перенаправлено обратно в веб-приложения, который будет предложено ввести **имя пользователя** , которую требуется связать с учетной записью Майкрософт:

    [![](external-authentication-services/_static/image48.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image47.png)
8. После ввода имени пользователя и щелчке **зарегистрироваться** кнопки, веб-приложение будет отображаться по умолчанию **Домашняя страница** для учетной записи Майкрософт:

    [![](external-authentication-services/_static/image50.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image49.png)

<a id="TWITTER"></a>
## <a name="enabling-twitter-authentication"></a>Включение проверки подлинности Twitter

Twitter проверки подлинности необходимо создать учетную запись разработчика, и ей требуется ключ потребителя и секретом получателя для своей работы. Сведения о создании учетной записи разработчика Twitter и получить ключ потребителя и секретом получателя см. в разделе [https://go.microsoft.com/fwlink/?LinkID=252166](https://go.microsoft.com/fwlink/?LinkID=252166).

Получив ваш ключ клиента и секрет пользователя, выполните следующие действия, чтобы включить проверку подлинности Twitter для веб-приложения:

1. Когда проект открыт в Visual Studio 2013, откройте *Startup.Auth.cs* файла:

    [![](external-authentication-services/_static/image52.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image51.png)
2. Найдите раздел, выделенный код:

    [!code-csharp[Main](external-authentication-services/samples/sample8.cs)]
3. Удалить &quot; // &quot; символов Раскомментировать выделенные строки кода, а затем добавить ключ клиента и секретом получателя. После добавления этих параметров можно повторную компиляцию проекта:

    [!code-csharp[Main](external-authentication-services/samples/sample9.cs)]
4. При нажатии клавиши F5, чтобы открыть веб-приложения в веб-браузере, вы увидите, что Twitter определен как службу внешней проверки подлинности:

    [![](external-authentication-services/_static/image54.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image53.png)
5. При нажатии кнопки **Twitter** кнопки, будет выполнено перенаправление на страницу входа Twitter:

    [![](external-authentication-services/_static/image56.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image55.png)
6. После ввода учетных данных Twitter и нажмите кнопку **авторизовать приложение**, веб-браузере будет перенаправлено обратно в веб-приложения, который будет предложено ввести **имя пользователя** , которую требуется связать с учетной записи Twitter:

    [![](external-authentication-services/_static/image58.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image57.png)
7. После ввода имени пользователя и щелчке **зарегистрироваться** кнопки, веб-приложение будет отображаться по умолчанию **Домашняя страница** для вашей учетной записи Twitter:

    [![](external-authentication-services/_static/image60.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image59.png)

<a id="MOREINFO"></a>
## <a name="additional-information"></a>Дополнительные сведения

Дополнительные сведения о создании приложений, использующих OAuth и OpenID см. следующие URL-адреса:

- [https://go.microsoft.com/fwlink/?LinkID=252166](https://go.microsoft.com/fwlink/?LinkID=252166)
- [https://go.microsoft.com/fwlink/?LinkID=243995](https://go.microsoft.com/fwlink/?LinkID=243995)

<a id="COMBINE"></a>
### <a name="combining-external-authentication-services"></a>Объединение внешние службы проверки подлинности

Для повышения гибкости можно определить несколько внешние службы проверки подлинности, в то же время — это позволяет веб-приложения используйте учетную запись с любого из включенных внешние службы проверки подлинности:

[![](external-authentication-services/_static/image62.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image61.png)

<a id="FQDN"></a>
### <a name="configuring-iis-express-to-use-a-fully-qualified-domain-name"></a>Настройки IIS Express для использования полного доменного имени

Некоторые поставщики услуг внешней проверки подлинности не поддерживают тестирование приложения с помощью HTTP-адрес как `http://localhost:port/`. Чтобы обойти эту проблему, можно добавить в файл HOSTS статическое сопоставление полное доменное имя (FQDN) и настроить параметры проекта в Visual Studio 2013 для использования полного доменного ИМЕНИ для тестирования и отладки. Чтобы сделать это, выполните следующие действия:

- Добавьте статический полное доменное имя сопоставления файл HOSTS.

    1. Откройте командную строку с повышенными правами в Windows.
    2. Введите следующую команду:

        <kbd>%WinDir%\system32\drivers\etc\hosts Блокнот</kbd>
    3. Добавьте в файл HOSTS запись следующим образом:

        <kbd>127.0.0.1 www.wingtiptoys.com</kbd>
    4. Сохраните и закройте файл HOSTS.
- Настройка проекта Visual Studio для использования полного доменного ИМЕНИ.

    1. Когда проект открыт в Visual Studio 2013, нажмите кнопку **проекта** меню, а затем выберите свойства для проекта. Например, можно выбрать **WebApplication1 свойства**.
    2. Выберите **Web** вкладки.
    3. Введите полное доменное имя для **URL-адрес проекта**. Например, можно ввести <kbd>http://www.wingtiptoys.com</kbd> Если это было сопоставления полное доменное имя, которое вы добавили в файл HOSTS.
- Настройте сервер IIS Express использовать полное доменное имя для вашего приложения.

    1. Откройте командную строку с повышенными правами в Windows.
    2. Введите следующую команду, чтобы изменить папку IIS Express:

        <kbd>CD /d &quot;%ProgramFiles%\IIS, экспресс-выпуск&quot;</kbd>
    3. Введите следующую команду, чтобы добавить полное доменное имя для приложения:

        <kbd>appcmd.exe set config -section:system.applicationHost/sites /+&quot;[name='WebApplication1'].bindings.[protocol='http',bindingInformation='*:80:www.wingtiptoys.com']&quot; /commit:apphost</kbd>

 Где **WebApplication1** имя проекта и **bindingInformation** содержит номер порта и полное доменное имя, которые требуется использовать для тестирования.

<a id="OBTAIN"></a>
### <a name="how-to-obtain-your-application-settings-for-microsoft-authentication"></a>Как получить параметры приложения для проверки подлинности Майкрософт

Связывание приложения для Windows Live для проверки подлинности Microsoft — это простой процесс. Если вы уже не связаны приложения для Windows Live, можно использовать следующие шаги:

1. Перейдите к [https://go.microsoft.com/fwlink/?LinkID=144070](https://go.microsoft.com/fwlink/?LinkID=144070) и введите имя учетной записи Майкрософт и пароль при появлении запроса, а затем нажмите кнопку **входа**:

    [![](external-authentication-services/_static/image64.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image63.png)
2. Введите имя и язык приложения при появлении запроса и нажмите кнопку **я принимаю**:

    [![](external-authentication-services/_static/image66.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image65.png)
3. На **параметры API** страницы приложения, введите домен перенаправления для приложения и скопируйте **идентификатор клиента** и **секрет клиента** для проекта, а затем Нажмите кнопку **Сохранить**:

    [![](external-authentication-services/_static/image68.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image67.png)

<a id="DISABLE"></a>
### <a name="optional-disable-local-registration"></a>Необязательно: Отключить регистрацию локального

Текущая функциональность регистрацию локального ASP.NET не запрещает автоматические программы (программы-роботы) создания элемента учетных записей; Например, с помощью технологии, защиты от программ-роботов и проверки, как [CAPTCHA](../../../web-pages/overview/security/16-adding-security-and-membership.md). По этой причине следует удалить ссылки формы и регистрации локального имени входа на странице входа. Чтобы сделать это, откройте  *\_Login.cshtml* страницы в проекте, а затем закомментируйте линии панели локальное имя входа и ссылка на страницу регистрации. Страницы должен выглядеть как в следующем примере кода:

[!code-html[Main](external-authentication-services/samples/sample10.html)]

После отключения панели локальное имя входа и ссылка на страницу регистрации страница входа отображает только поставщики внешней проверки подлинности, которые вы включили:

[![](external-authentication-services/_static/image70.png "Щелкните, чтобы развернуть образ")](external-authentication-services/_static/image69.png)
