---
uid: web-api/overview/older-versions/creating-a-web-api-that-supports-crud-operations
title: "Включение операций CRUD в ASP.NET Web API 1 | Документы Microsoft"
author: MikeWasson
description: "Этот учебник показывает, как для поддержки операций CRUD в службы HTTP с помощью веб-API ASP.NET. Версии программного обеспечения, используемые в учебник Visual Studio 2012 Web точки доступа..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/28/2012
ms.topic: article
ms.assetid: c125ca47-606a-4d6f-a1fc-1fc62928af93
ms.technology: dotnet-webapi
ms.prod: .net-framework
msc.legacyurl: /web-api/overview/older-versions/creating-a-web-api-that-supports-crud-operations
msc.type: authoredcontent
ms.openlocfilehash: a91bf065c9ce0fc5bd9b7115340edabea975a7e0
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="enabling-crud-operations-in-aspnet-web-api-1"></a>Включение операций CRUD в ASP.NET Web API 1
====================
по [Mike Wasson](https://github.com/MikeWasson)

[Загрузка завершенного проекта](http://code.msdn.microsoft.com/ASP-NET-Web-API-Tutorial-c4761894)

> Этот учебник показывает, как для поддержки операций CRUD в службы HTTP с помощью веб-API ASP.NET.
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемая в этом учебнике
> 
> 
> - Visual Studio 2012
> - Веб-API 1 (также работает с веб-API 2)


Обозначает CRUD &quot;создания, чтения, обновления и удаления,&quot; эти четыре основные операции. Многие службы HTTP также модели операций CRUD через REST или API REST like.

В этом учебнике будет создание очень простого веб-API для управления списком продуктов. Каждого продукта будет содержать имя, цену и категории (такие как &quot;toys&quot; или &quot;оборудования&quot;), а также идентификатора продукта.

Продукты API предоставляет следующие методы.

| Действие | Метод HTTP | Относительный URI |
| --- | --- | --- |
| Получить список всех продуктов | GET | / api/продуктов |
| Получение продукта по Идентификатору | GET | /API/продукты/*идентификатор* |
| Получение продукта по категориям | GET | / api/продуктов? категории =*категории* |
| Создать продукт | ПОМЕСТИТЬ | / api/продуктов |
| Обновления продукта | PUT | /API/продукты/*идентификатор* |
| Удаление продукта | DELETE | /API/продукты/*идентификатор* |

Обратите внимание, что часть URL-адреса, включают идентификатор продукта в пути. Например, чтобы получить продукта, идентификатор которого — 28, клиент отправляет запрос GET `http://hostname/api/products/28`.

### <a name="resources"></a>Ресурсы

Продукты API определяет идентификаторы URI для двух типов ресурсов:

| Ресурс | URI |
| --- | --- |
| Список всех продуктов. | / api/продуктов |
| Отдельного продукта. | /API/продукты/*идентификатор* |

### <a name="methods"></a>Методы

Четыре основных метода HTTP (GET, PUT, POST и DELETE) может быть сопоставлен операций CRUD следующим образом:

- GET возвращает представление ресурса в указанный универсальный код Ресурса. GET должен не имеют побочных эффектов на сервере.
- PUT обновляет ресурс с указанным URI. PUT может также использоваться для создания нового ресурса с указанным URI, если сервер разрешает клиентам задавать новые URI. В этом учебнике API не поддерживают создание с помощью PUT.
- POST создает новый ресурс. Сервер назначает URI нового объекта и возвращает этот URI как часть ответного сообщения.
- DELETE удаляет ресурс с указанным URI.

Примечание: Метод PUT заменяет сущность всего продукта. То есть клиент ожидается отправки полное представление обновленного продукта. Если вы хотите поддерживать частичных обновлений, метод PATCH является предпочтительным. Этот учебник не реализует ИСПРАВЛЕНИЯ.

## <a name="create-a-new-web-api-project"></a>Создайте новый проект Web API

Запустить Visual Studio и выберите **новый проект** из **запустить** страницы. Или из **файл** последовательно выберите пункты **New** и затем **проекта**.

В **шаблоны** выберите **установленные шаблоны** и разверните **Visual C#** узла. В разделе **Visual C#**выберите **Web**. В списке шаблонов проектов выберите **веб-приложение ASP.NET MVC 4**. Назовите проект &quot;ProductStore&quot; и нажмите кнопку **ОК**.

![](creating-a-web-api-that-supports-crud-operations/_static/image1.png)

В **нового проекта ASP.NET MVC 4** диалогового окна выберите **веб-API** и нажмите кнопку **ОК**.

![](creating-a-web-api-that-supports-crud-operations/_static/image2.png)

## <a name="adding-a-model"></a>Добавление модели

*Модель* — это объект, представляющий данные в приложении. В веб-API ASP.NET строго типизированными объектами CLR можно использовать в качестве модели, и они будут автоматически сериализованы в XML или JSON для клиента.

Для ProductStore API состоит наши данные продуктов, поэтому мы создадим новый класс с именем `Product`.

Если обозреватель решений не отображается, нажмите кнопку **представление** и выбрать пункт **обозревателе решений**. В обозревателе решений щелкните правой кнопкой мыши **моделей** папки. Meny контекста, выберите **добавить**, а затем выберите **класса**. Имя класса &quot;продукта&quot;.

![](creating-a-web-api-that-supports-crud-operations/_static/image3.png)

Добавьте следующие свойства для `Product` класса.

[!code-csharp[Main](creating-a-web-api-that-supports-crud-operations/samples/sample1.cs)]

## <a name="adding-a-repository"></a>Добавление репозитория

Необходимо хранить в коллекции продуктов. Это хороший способ разделения коллекции из реализации служб. Таким образом, мы можем изменить резервного хранилища без перезаписи класс службы. Этот тип конструктора называется *репозитория* шаблон. Начинается с определения универсальный интерфейс для репозитория.

В обозревателе решений щелкните правой кнопкой мыши **моделей** папки. Выберите **добавить**, а затем выберите **новый элемент**.

![](creating-a-web-api-that-supports-crud-operations/_static/image4.png)

В **шаблоны** выберите **установленные шаблоны** и разверните узел C#. В C#, выберите **кода**. В списке шаблонов кода, выберите **интерфейс**. Назовите этот интерфейс &quot;IProductRepository&quot;.

![](creating-a-web-api-that-supports-crud-operations/_static/image5.png)

Добавьте реализацию следующего:

[!code-csharp[Main](creating-a-web-api-that-supports-crud-operations/samples/sample2.cs)]

Теперь добавьте еще один класс в папке «модели», с именем &quot;ProductRepository.&quot; Этот класс реализует интерфейс `IProductRespository`. Добавьте реализацию следующего:

[!code-csharp[Main](creating-a-web-api-that-supports-crud-operations/samples/sample3.cs)]

Репозитории сохраняет список в локальной памяти. Это ОК учебник, но в реальном приложении будут храниться данные извне, либо базы данных или в Облачное хранилище. Шаблон репозитория поможет упростить его изменить реализацию более поздней версии.

## <a name="adding-a-web-api-controller"></a>Добавление контроллера Web API

Если вы работали с ASP.NET MVC, затем вы уже знакомы с контроллерами. В ASP.NET Web API *контроллера* — это класс, который обрабатывает HTTP-запросы от клиента. При создании проекта мастером создания проекта автоматически создается два контроллера. Чтобы увидеть их, разверните папку Controllers в обозревателе решений.

- HomeController — это традиционные контроллер ASP.NET MVC. Он отвечает за обслуживающий HTML-страниц для сайта и не связаны непосредственно с нашими веб-API.
- ValuesController является контроллера WebAPI примере.

Продолжить и удалить ValuesController, дважды щелкнув файл в обозревателе решений и выбрав **удалить.** Добавьте новый контроллер, следующим образом:

В **обозревателе решений**, щелкните правой кнопкой мыши папку Controllers. Выберите **добавить** , а затем выберите **контроллера**.

![](creating-a-web-api-that-supports-crud-operations/_static/image6.png)

В **добавления контроллера** мастера, имя контроллера &quot;ProductsController&quot;. В **шаблона** раскрывающемся списке выберите **пустой контроллер API**. Затем нажмите кнопку **Добавить**.

![](creating-a-web-api-that-supports-crud-operations/_static/image7.png)

> [!NOTE]
> Поместить в папку с именем контроллеров вашей contollers необязательно. Имя папки не имеет значения; Это просто удобный способ организации исходные файлы.


**Добавить контроллер** мастер создаст файл с именем ProductsController.cs в папке Controllers находится. Если этот файл уже не открыт, дважды щелкните файл, чтобы открыть его. Добавьте следующие **с помощью** инструкции:

[!code-csharp[Main](creating-a-web-api-that-supports-crud-operations/samples/sample4.cs)]

Добавьте поле, которое хранит **IProductRepository** экземпляра.

[!code-csharp[Main](creating-a-web-api-that-supports-crud-operations/samples/sample5.cs)]

> [!NOTE]
> Вызов `new ProductRepository()` в контроллере не лучший проектированию, привязывает контроллера для данного экземпляра `IProductRepository`. Более удачным подходом в разделе [с помощью сопоставителя зависимостей Web API](../advanced/dependency-injection.md).


## <a name="getting-a-resource"></a>Получение сведений о ресурсе

Предоставляет несколько ProductStore API &quot;чтения&quot; действия, как методы HTTP GET. Каждое действие будет соответствовать методу в `ProductsController` класса.

| Действие | Метод HTTP | Относительный URI |
| --- | --- | --- |
| Получить список всех продуктов | GET | / api/продуктов |
| Получение продукта по Идентификатору | GET | /API/продукты/*идентификатор* |
| Получение продукта по категориям | GET | / api/продуктов? категории =*категории* |

Чтобы получить список всех продуктов, добавьте этот метод `ProductsController` класса:

[!code-csharp[Main](creating-a-web-api-that-supports-crud-operations/samples/sample6.cs)]

Имя метода начинается с &quot;получить&quot;, поэтому по соглашению оно сопоставлено запросов GET. Кроме того, поскольку метод не имеет параметров, он был сопоставлен URI, который не содержит  *&quot;идентификатор&quot;*  сегмента пути.

Чтобы получить продукта по Идентификатору, добавьте этот метод, чтобы `ProductsController` класса:

[!code-csharp[Main](creating-a-web-api-that-supports-crud-operations/samples/sample7.cs)]

Этот метод также с названиями &quot;получить&quot;, но метод имеет параметр с именем *идентификатор*. Этот параметр сопоставляется &quot;идентификатор&quot; сегмент пути URI. Платформа веб-API ASP.NET автоматически преобразует идентификатор в правильный тип данных (**int**) для параметра.

Метод GetProduct вызывает исключение типа **HttpResponseException** Если *идентификатор* является недопустимым. Это исключение платформой будут преобразовываться в ошибку 404 (не найдено).

Наконец добавьте метод для поиска продуктов по категориям:

[!code-csharp[Main](creating-a-web-api-that-supports-crud-operations/samples/sample8.cs)]

Если URI запроса содержит строку запроса, веб-API пытается сопоставить параметры запроса для параметров метода контроллера. Таким образом, URI вида «api и продукты? категории =*категории*"будет сопоставлен этот метод.

## <a name="creating-a-resource"></a>Создание ресурса

Далее мы добавим метод `ProductsController` класса, чтобы создать новый продукт. Ниже приведен простой реализации метода.

[!code-csharp[Main](creating-a-web-api-that-supports-crud-operations/samples/sample9.cs)]

Обратите внимание два аспекта этот метод.

- Имя метода начинается с &quot;Post... &quot;. Чтобы создать новый продукт, клиент отправляет запрос HTTP POST.
- Метод принимает параметр типа Product. В веб-API десериализации параметров со сложными типами, в тексте запроса. Таким образом ожидается, что клиенту отправлять сериализованное представление объекта продукта в формате XML или JSON.

Эта реализация будет работать, но не является неполной. В идеальном случае мы хотели бы HTTP-ответа, относятся следующие:

- **Код ответа:** по умолчанию платформа веб-API задает код состояния ответа 200 (ОК). Но по протоколу HTTP/1.1, когда запрос POST приводит к созданию ресурса, сервера следует ответить с состоянием 201 (создано).
- **Расположение:** при сервер создает ресурс, он должен содержать URI нового ресурса в заголовке Location ответа.

Веб-API ASP.NET позволяет легко управлять сообщения HTTP-ответа. Вот улучшенную реализацию.

[!code-csharp[Main](creating-a-web-api-that-supports-crud-operations/samples/sample10.cs)]

Обратите внимание, что тип возвращаемого значения метода **HttpResponseMessage**. Путем возвращения **HttpResponseMessage** вместо продукта, можно управлять сведения сообщения HTTP-ответа, включая код состояния и заголовок расположения.

**CreateResponse** метод создает **HttpResponseMessage** и автоматически записывает сериализованное представление объекта продукта в тексте fo ответное сообщение.

> [!NOTE]
> В этом примере не проверяет `Product`. Сведения о проверке модели см. в разделе [проверки модели в ASP.NET Web API](../formats-and-model-binding/model-validation-in-aspnet-web-api.md).


## <a name="updating-a-resource"></a>Обновление ресурса

Обновление продукта с помощью метода PUT проста:

[!code-csharp[Main](creating-a-web-api-that-supports-crud-operations/samples/sample11.cs)]

Имя метода начинается с &quot;поместить... &quot;, поэтому веб-API сопоставляет его запросы PUT. Этот метод принимает два параметра код продукта и обновленного продукта. *Идентификатор* параметра берется из пути URI и *продукта* параметр десериализуется в тексте запроса. По умолчанию платформа ASP.NET Web API принимает простые типы параметров маршрута и сложных типов в тексте запроса.

## <a name="deleting-a-resource"></a>Удаление ресурса

Чтобы удалить resourse, определите метод «Удалить...».

[!code-csharp[Main](creating-a-web-api-that-supports-crud-operations/samples/sample12.cs)]

Если запрос DELETE завершается успешно, он может возвращать состояния 200 (ОК) с тело сущности, описывающая состояние; состояние 202 (принято), если удаление по-прежнему ожидающие; или состояния 204 (нет содержимого) без тела сущности. В этом случае `DeleteProduct` имеет метод `void` тип возвращаемого значения, поэтому веб-API ASP.NET автоматически преобразует это в состоянии код 204 (нет содержимого).
