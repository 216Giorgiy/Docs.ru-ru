---
uid: visual-studio/overview/2012/windows-azure-authentication
title: "Windows Azure Authentication | Документы Microsoft"
author: Rick-Anderson
description: "Инструменты Microsoft ASP.NET для Windows Azure Active Directory позволяет легко включить проверку подлинности для веб-приложений, размещенных в Windows Azure веб-сайтов..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2013
ms.topic: article
ms.assetid: a3cef801-a54b-4ebd-93c3-55764e2e14b1
ms.technology: 
ms.prod: .net-framework
msc.legacyurl: /visual-studio/overview/2012/windows-azure-authentication
msc.type: authoredcontent
ms.openlocfilehash: 4deb3536699f1ef3025f8858ee71a76a1c2def18
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2018
---
<a name="windows-azure-authentication"></a><span data-ttu-id="93a0a-103">Windows Azure проверка подлинности</span><span class="sxs-lookup"><span data-stu-id="93a0a-103">Windows Azure Authentication</span></span>
====================
<span data-ttu-id="93a0a-104">По [Рик Андерсон](https://github.com/Rick-Anderson)</span><span class="sxs-lookup"><span data-stu-id="93a0a-104">by [Rick Anderson](https://github.com/Rick-Anderson)</span></span>

> <span data-ttu-id="93a0a-105">Средства Microsoft ASP.NET для Windows Azure Active Directory позволяет легко включить проверку подлинности для веб-приложений, размещенных на [веб-сайтов Windows Azure](https://www.windowsazure.com/home/features/web-sites/).</span><span class="sxs-lookup"><span data-stu-id="93a0a-105">Microsoft ASP.NET tools for Windows Azure Active Directory makes it simple to enable authentication for web applications hosted on [Windows Azure Web Sites](https://www.windowsazure.com/home/features/web-sites/).</span></span> <span data-ttu-id="93a0a-106">Проверка подлинности Windows Azure можно использовать для проверки подлинности пользователей Office 365 в организации, корпоративных учетных записей, синхронизированные из локальной службы Active Directory или пользователей, созданных в собственный домен Windows Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="93a0a-106">You can use Windows Azure Authentication to authenticate Office 365 users from your organization, corporate accounts synced from your on-premise Active Directory or users created in your own custom Windows Azure Active Directory domain.</span></span> <span data-ttu-id="93a0a-107">Включение проверки подлинности Windows Azure настраивает приложение для проверки подлинности пользователей с помощью одного [Windows Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) клиента.</span><span class="sxs-lookup"><span data-stu-id="93a0a-107">Enabling Windows Azure Authentication configures your application to authenticate users using a single [Windows Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) tenant.</span></span>
> 
> <span data-ttu-id="93a0a-108">Средство проверки подлинности ASP.NET Windows Azure не поддерживается для веб-ролей в облачной службе, но мы планируем в будущем выпуске.</span><span class="sxs-lookup"><span data-stu-id="93a0a-108">The ASP.NET Windows Azure Authentication tool is not supported for web roles in a cloud service but we plan to do so in a future release.</span></span> <span data-ttu-id="93a0a-109">[Windows Identity Foundation](https://msdn.microsoft.com/library/hh291066(v=VS.110).aspx) (WIF) поддерживается в веб-роли Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="93a0a-109">[Windows Identity Foundation](https://msdn.microsoft.com/library/hh291066(v=VS.110).aspx) (WIF) is supported in Windows Azure web roles.</span></span>
> 
> <span data-ttu-id="93a0a-110">Дополнительные сведения о том, как настроить синхронизацию между вашей локальной Active Directory и клиент Windows Azure Active Directory см. в разделе [использование AD FS 2.0 для реализации и управления единым входом](https://technet.microsoft.com/library/jj205462.aspx).</span><span class="sxs-lookup"><span data-stu-id="93a0a-110">For details on how to setup synchronization between your on-premise Active Directory and your Windows Azure Active Directory tenant please see [Use AD FS 2.0 to implement and manage single sign-on](https://technet.microsoft.com/library/jj205462.aspx).</span></span>
> 
> <span data-ttu-id="93a0a-111">Windows Azure Active Directory в настоящее время доступен в виде [освободить предварительной версии службы](https://azure.microsoft.com/free/?WT.mc_id=A443DD604).</span><span class="sxs-lookup"><span data-stu-id="93a0a-111">Windows Azure Active Directory is currently available as a [free preview service](https://azure.microsoft.com/free/?WT.mc_id=A443DD604).</span></span>


## <a name="requirements"></a><span data-ttu-id="93a0a-112">Требования:</span><span class="sxs-lookup"><span data-stu-id="93a0a-112">Requirements:</span></span>

- <span data-ttu-id="93a0a-113">Visual Studio 2012 или [Visual Studio Express 2012](https://www.microsoft.com/visualstudio/11/products/express)</span><span class="sxs-lookup"><span data-stu-id="93a0a-113">Visual Studio 2012 or [Visual Studio Express 2012](https://www.microsoft.com/visualstudio/11/products/express)</span></span>
- <span data-ttu-id="93a0a-114">[Веб-средств расширения для Visual Studio 2012](https://go.microsoft.com/fwlink/?LinkID=282228&amp;clcid=0x409) или [расширения веб-средства для Visual Studio Express 2012 г.](https://go.microsoft.com/fwlink/?LinkID=282231&amp;clcid=0x409)</span><span class="sxs-lookup"><span data-stu-id="93a0a-114">[Web Tools Extensions for Visual Studio 2012](https://go.microsoft.com/fwlink/?LinkID=282228&amp;clcid=0x409) or [Web Tools Extensions for Visual Studio Express 2012](https://go.microsoft.com/fwlink/?LinkID=282231&amp;clcid=0x409)</span></span>
- <span data-ttu-id="93a0a-115">[Microsoft ASP.NET Tools для Windows Azure Active Directory — Visual Studio 2012](https://go.microsoft.com/fwlink/?LinkID=282306) или [Microsoft ASP.NET Tools для Windows Azure Active Directory — Visual Studio Express 2012 для Web](https://go.microsoft.com/fwlink/?LinkId=282652)</span><span class="sxs-lookup"><span data-stu-id="93a0a-115">[Microsoft ASP.NET Tools for Windows Azure Active Directory – Visual Studio 2012](https://go.microsoft.com/fwlink/?LinkID=282306) or [Microsoft ASP.NET Tools for Windows Azure Active Directory – Visual Studio Express 2012 for Web](https://go.microsoft.com/fwlink/?LinkId=282652)</span></span>

## <a name="create-an-aspnet-web-application-with-visual-studio-2012"></a><span data-ttu-id="93a0a-116">Создание веб-приложения ASP.NET с помощью Visual Studio 2012</span><span class="sxs-lookup"><span data-stu-id="93a0a-116">Create an ASP.NET Web Application with Visual Studio 2012</span></span>

<span data-ttu-id="93a0a-117">Все веб-приложения можно создать с помощью Visual Studio 2012, в этом учебнике используется шаблон интрасети ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="93a0a-117">You can create any Web Application with Visual Studio 2012, this tutorial uses the ASP.NET MVC intranet template.</span></span>

1. <span data-ttu-id="93a0a-118">Создайте новое приложение интрасети MVC 4 ASP.NET и примите параметры по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="93a0a-118">Create a new ASP.NET MVC 4 Intranet Application and accept all the defaults.</span></span> <span data-ttu-id="93a0a-119">(Он должен быть In **проверка сс** net и не в **ажите** net проекта).</span><span class="sxs-lookup"><span data-stu-id="93a0a-119">(It must be an In **tra** net and not In **ter** net project).</span></span>  
     ![](windows-azure-authentication/_static/image1.png)

## <a name="enable-window-azure-authentication-when-you-are-a-global-administrator-of-the-tenet"></a><span data-ttu-id="93a0a-120">Включение проверки подлинности Azure окна (Если вы являетесь глобальным администратором принцип)</span><span class="sxs-lookup"><span data-stu-id="93a0a-120">Enable Window Azure Authentication (When you are a Global Administrator of the Tenet)</span></span>

<span data-ttu-id="93a0a-121">Если нет существующего клиента Windows Azure Active Directory (например, с помощью существующую учетную запись Office 365) можно создать новый клиент, зарегистрировавшись для [новую учетную запись Windows Azure Active Directory](http://g.microsoftonline.com/0AX00en/5).</span><span class="sxs-lookup"><span data-stu-id="93a0a-121">If you do not have an existing Windows Azure Active Directory tenant (For example, through an existing Office 365 account) you can create a new tenant by signing up for a [new Windows Azure Active Directory account](http://g.microsoftonline.com/0AX00en/5).</span></span>

1. <span data-ttu-id="93a0a-122">В меню Проект выберите **включить проверку подлинности Windows Azure**:</span><span class="sxs-lookup"><span data-stu-id="93a0a-122">From the Project menu select **Enable Windows Azure Authentication**:</span></span>  
  
 ![](windows-azure-authentication/_static/image2.png)

2. <span data-ttu-id="93a0a-123">Введите имя домена для вашего клиента Windows Azure Active Directory (например, contoso.onmicrosoft.com) и нажмите кнопку **включить**:</span><span class="sxs-lookup"><span data-stu-id="93a0a-123">Enter the domain for your Windows Azure Active Directory tenant (for example, contoso.onmicrosoft.com) and click **Enable**:</span></span>

![](windows-azure-authentication/_static/image3.png)

3. <span data-ttu-id="93a0a-124">В веб-проверки подлинности диалоговое окно входа с правами администратора для вашего клиента Windows Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="93a0a-124">In the Web Authentication dialog sign in as an administrator for your Windows Azure Active Directory tenant:</span></span>  
  
 ![](windows-azure-authentication/_static/image4.png)

![](windows-azure-authentication/_static/image5.png)

## <a name="enable-window-azure-by-a-non-administrator-of-the-tenet"></a><span data-ttu-id="93a0a-125">Включите Windows Azure, не имеющий прав администратора из принцип</span><span class="sxs-lookup"><span data-stu-id="93a0a-125">Enable Window Azure by a non-administrator of the Tenet</span></span>

<span data-ttu-id="93a0a-126">Если у вас прав глобального администратора для вашего клиента Windows Azure Active Directory, можно снять флажок для подготовки приложения.</span><span class="sxs-lookup"><span data-stu-id="93a0a-126">If you do not have Global Administrator privilege for your Windows Azure Active Directory tenant, you can uncheck the checkbox for provisioning the application.</span></span>

![](windows-azure-authentication/_static/image6.png)

<span data-ttu-id="93a0a-127">В диалоговом окне отобразится **домена**, **ИД участник приложения** и **URL-адрес ответа** , необходимые для подготовки приложения с Azure Active Directory Принцип.</span><span class="sxs-lookup"><span data-stu-id="93a0a-127">The dialog will display the **Domain**, **Application Principal Id** and **Reply URL** which are required for provisioning the application with an Azure Active Directory tenet.</span></span> <span data-ttu-id="93a0a-128">Необходимо предоставить эти сведения кому-либо обладающего привилегиями, достаточными для подготовки приложения.</span><span class="sxs-lookup"><span data-stu-id="93a0a-128">You need to give this information to someone who has sufficient privilege to provision the application.</span></span> <span data-ttu-id="93a0a-129">В разделе[как реализовать единый вход в Windows Azure Active Directory - приложение ASP.NET](https://github.com/Azure-Samples/active-directory-dotnet-webapp-openidconnect) подробные сведения о том, как вручную создать участника службы с помощью командлета.</span><span class="sxs-lookup"><span data-stu-id="93a0a-129">See[How to implement single sign-on with Windows Azure Active Directory - ASP.NET Application](https://github.com/Azure-Samples/active-directory-dotnet-webapp-openidconnect) for details on how to use cmdlet to create the service principal manually.</span></span>  
<span data-ttu-id="93a0a-130">После успешной подготовки приложения можно щелкнуть **обновить файл web.config с помощью выбранных параметров по-прежнему**.</span><span class="sxs-lookup"><span data-stu-id="93a0a-130">Once the application has been successfully provisioned, you can click on **Continue to update web.config with the selected settings**.</span></span> <span data-ttu-id="93a0a-131">Если вы хотите продолжать разработку приложения при ожидании инициализации нежелательно, можно щелкнуть **закрыть, чтобы хранить параметры в файле проекта**.</span><span class="sxs-lookup"><span data-stu-id="93a0a-131">If you want to continue developing the application while waiting for provisioning to happen, you can click **Close to remember the settings in project file**.</span></span> <span data-ttu-id="93a0a-132">В следующий раз, вызывать включить проверку подлинности Windows Azure и снимите флажок подготовки, вы увидите те же параметры, и можно щелкнуть **Продолжить**, нажмите кнопку **применить эти параметры в файле web.config**.</span><span class="sxs-lookup"><span data-stu-id="93a0a-132">The next time you invoke Enable Windows Azure Authentication and uncheck the provisioning checkbox, you will see the same settings and you can click **Continue**, then click, **Apply these settings in web.config**.</span></span>

1. <span data-ttu-id="93a0a-133">Подождите, пока приложение настроено для аутентификации Windows Azure и настроена для поддержки Windows Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="93a0a-133">Wait while your application is configured for Windows Azure Authentication and provisioned with Windows Azure Active Directory.</span></span>
2. <span data-ttu-id="93a0a-134">После включения проверки подлинности Windows Azure для приложения щелкните **закрыть:**</span><span class="sxs-lookup"><span data-stu-id="93a0a-134">Once Windows Azure Authentication has been enabled for your application, click **Close:**</span></span> 

    ![](windows-azure-authentication/_static/image7.png)
3. <span data-ttu-id="93a0a-135">Нажмите клавишу F5 для запуска приложения.</span><span class="sxs-lookup"><span data-stu-id="93a0a-135">Hit F5 to run your application.</span></span> <span data-ttu-id="93a0a-136">Вы автоматически получите перенаправляется на страницу входа.</span><span class="sxs-lookup"><span data-stu-id="93a0a-136">You should automatically get redirected to login page.</span></span> <span data-ttu-id="93a0a-137">Использовать учетные данные пользователя принцип каталог для входа в приложение...</span><span class="sxs-lookup"><span data-stu-id="93a0a-137">Use the directory tenet user credentials to login to the application..</span></span>  

    ![](windows-azure-authentication/_static/image1.jpg)
4. <span data-ttu-id="93a0a-138">Так как приложение в настоящее время использует самозаверяющий тестовый сертификат вы получите предупреждение от браузера, сертификат не был выдан доверенным центром сертификации.</span><span class="sxs-lookup"><span data-stu-id="93a0a-138">Because your application is currently using a self-signed test certificate you will receive a warning from the browser that the certificate was not issued by a trusted certificate authority.</span></span>

    <span data-ttu-id="93a0a-139">Это предупреждение можно пропустить во время локальной разработки, щелкнув **Продолжить открытие этого веб-сайта:**</span><span class="sxs-lookup"><span data-stu-id="93a0a-139">This warning can be safely ignored during local development by clicking **Continue to this website:**</span></span> 

    ![](windows-azure-authentication/_static/image8.png)
5. <span data-ttu-id="93a0a-140">Теперь успешного входа приложение, используя проверку подлинности Windows Azure!</span><span class="sxs-lookup"><span data-stu-id="93a0a-140">You have now successfully logged in to your application using Windows Azure Authentication!</span></span>

    ![](windows-azure-authentication/_static/image2.jpg)

<span data-ttu-id="93a0a-141">Включение Windows Azure проверка подлинности вносит следующие изменения в приложение:</span><span class="sxs-lookup"><span data-stu-id="93a0a-141">Enabling Windows Azure authentication makes the following changes to your application:</span></span>

- <span data-ttu-id="93a0a-142">Приложения для защиты сайта перекрестную подделки запросов ([CSRF](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF))) класса ( *приложения\_Start\AntiXsrfConfig.cs* ) добавляется в проект.</span><span class="sxs-lookup"><span data-stu-id="93a0a-142">An Anti-Cross-Site Request Forgery ([CSRF](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF))) class ( *App\_Start\AntiXsrfConfig.cs* ) is added to your project.</span></span>
- <span data-ttu-id="93a0a-143">Пакеты NuGet `System.IdentityModel.Tokens.ValidatingIssuerNameRegistry` добавляется в проект.</span><span class="sxs-lookup"><span data-stu-id="93a0a-143">The NuGet packages `System.IdentityModel.Tokens.ValidatingIssuerNameRegistry` is added to your project.</span></span>
- <span data-ttu-id="93a0a-144">Настроек Windows Identity Foundation в приложении будет настроен для приема токенов безопасности из клиента Windows Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="93a0a-144">Windows Identity Foundation settings in your application will be configured to accept security tokens from your Windows Azure Active Directory tenant.</span></span> <span data-ttu-id="93a0a-145">Щелкните ниже, чтобы увидеть изменения, внесенные в расширенное представление *Web.config* файла.</span><span class="sxs-lookup"><span data-stu-id="93a0a-145">Click on the image below to see an expanded view of the changes made to the *Web.config* file.</span></span>  
  
     ![](windows-azure-authentication/_static/image9.png)
- <span data-ttu-id="93a0a-146">Будет использован субъекта-службы для приложения в клиенте Windows Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="93a0a-146">A service principal for your application in your Windows Azure Active Directory tenant will be provisioned.</span></span>
- <span data-ttu-id="93a0a-147">Протокол HTTPS включен.</span><span class="sxs-lookup"><span data-stu-id="93a0a-147">HTTPS is enabled.</span></span>

## <a name="deploy-the-application-to-windows-azure"></a><span data-ttu-id="93a0a-148">Развертывание приложения в Windows Azure</span><span class="sxs-lookup"><span data-stu-id="93a0a-148">Deploy the application to Windows Azure</span></span>

<span data-ttu-id="93a0a-149">Полные инструкции см. в разделе [развертывание веб-приложения ASP.NET на веб-сайта Windows Azure](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet).</span><span class="sxs-lookup"><span data-stu-id="93a0a-149">For complete instructions, see [Deploying an ASP.NET Web Application to a Windows Azure Web Site](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet).</span></span>

<span data-ttu-id="93a0a-150">Чтобы опубликовать приложение с использованием проверки подлинности Windows Azure для веб-сайта Azure:</span><span class="sxs-lookup"><span data-stu-id="93a0a-150">To publish an application using Windows Azure Authentication to an Azure Web Site:</span></span>

1. <span data-ttu-id="93a0a-151">Щелкните приложение правой кнопкой мыши и выберите **публикации:**</span><span class="sxs-lookup"><span data-stu-id="93a0a-151">Right click on your application and select **Publish:**</span></span> 

    ![](windows-azure-authentication/_static/image3.jpg)
2. <span data-ttu-id="93a0a-152">Из диалогового окна веб-публикация Загрузите и импортируйте профиль публикации для веб-сайта Azure.</span><span class="sxs-lookup"><span data-stu-id="93a0a-152">From the Publish Web dialog download and import a publishing profile for your Azure Web Site.</span></span>

    ![](windows-azure-authentication/_static/image4.jpg)
3. <span data-ttu-id="93a0a-153">**Подключения** вкладке показана **URL-адрес назначения** (открытый разворота URL-адрес приложения).</span><span class="sxs-lookup"><span data-stu-id="93a0a-153">The **Connection** tab shows the **Destination URL** (the public facing URL for your application).</span></span> <span data-ttu-id="93a0a-154">Нажмите кнопку **проверить подключение** можно проверить подключение:</span><span class="sxs-lookup"><span data-stu-id="93a0a-154">Click **Validate Connection** to test your connection:</span></span>

    ![](windows-azure-authentication/_static/image5.jpg)
4. <span data-ttu-id="93a0a-155">Публикацию на этом веб-сайте Azure ранее имеет смысл вернуть **удалить дополнительные файлы в месте назначения** параметр, чтобы обеспечить приложение публикует без ошибок.</span><span class="sxs-lookup"><span data-stu-id="93a0a-155">If you have published to this Azure Web Site previously consider checking the **Remove additional files at destination** setting to ensure your application publishes cleanly.</span></span> <span data-ttu-id="93a0a-156">Обратите внимание **включить проверку подлинности Windows Azure** slected — флажок.</span><span class="sxs-lookup"><span data-stu-id="93a0a-156">Notice the **Enable Windows Azure Authentication** check box is slected.</span></span>  

    ![](windows-azure-authentication/_static/image10.png)
5. <span data-ttu-id="93a0a-157">Необязательно: На **предварительного просмотра** вкладке **начать просмотр** Чтобы просмотреть файлы, развернутые.</span><span class="sxs-lookup"><span data-stu-id="93a0a-157">Optional: On the **Preview** tab click **Start Preview** to see the files deployed.</span></span>

    ![](windows-azure-authentication/_static/image6.jpg)
6. <span data-ttu-id="93a0a-158">Нажмите кнопку **публикации.**</span><span class="sxs-lookup"><span data-stu-id="93a0a-158">Click **Publish.**</span></span>

    <span data-ttu-id="93a0a-159">Будет предложено включить проверку подлинности Windows Azure для конечного узла.</span><span class="sxs-lookup"><span data-stu-id="93a0a-159">You will be prompted to enable Windows Azure Authentication for the target host.</span></span> <span data-ttu-id="93a0a-160">Нажмите кнопку **включить** продолжить:</span><span class="sxs-lookup"><span data-stu-id="93a0a-160">Click **Enable** to continue:</span></span>

    ![](windows-azure-authentication/_static/image11.png)
7. <span data-ttu-id="93a0a-161">Введите учетные данные администратора для вашего клиента Windows Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="93a0a-161">Enter your administrator credentials for your Windows Azure Active Directory tenant:</span></span>

    ![](windows-azure-authentication/_static/image7.jpg)
8. <span data-ttu-id="93a0a-162">После успешной публикации приложения браузер откроет опубликованный веб-узел.</span><span class="sxs-lookup"><span data-stu-id="93a0a-162">Once your application has been successfully published, a browser will open to the published web site.</span></span>

    > [!NOTE]
    > <span data-ttu-id="93a0a-163">Он может занять до пяти минут (обычно необходимо меньше) для вашего приложения, полностью подготовки к работе с Windows Azure Active Directory после включения проверки подлинности Windows Azure для конечного узла.</span><span class="sxs-lookup"><span data-stu-id="93a0a-163">It may take up to five minutes (typically must less) for your application to be fully provisioned with Windows Azure Active Directory after enabling Windows Azure Authentication for the target host.</span></span> <span data-ttu-id="93a0a-164">При первом запуске приложения при получении ошибки ACS50001: проверяющей стороной с именем [область] не найден, подождите несколько минут и попробуйте запустить приложение еще раз.</span><span class="sxs-lookup"><span data-stu-id="93a0a-164">When you first run your application if you receive error ACS50001: Relying party with name ‘[realm]' was not found, then wait a few minutes and try running the application again.</span></span>
9. <span data-ttu-id="93a0a-165">При появлении соответствующего запроса войдите в систему как пользователь в каталоге:</span><span class="sxs-lookup"><span data-stu-id="93a0a-165">When prompted, log in as a user in your directory:</span></span>

    ![](windows-azure-authentication/_static/image8.jpg)
10. <span data-ttu-id="93a0a-166">Вы успешно выполнен вход в Azure размещенного приложения, использующего проверку подлинности Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="93a0a-166">You have now successfully logged into your Azure hosted application using Windows Azure Authentication.</span></span>  
  
     ![](windows-azure-authentication/_static/image9.jpg)

## <a name="known-issues"></a><span data-ttu-id="93a0a-167">Известные проблемы</span><span class="sxs-lookup"><span data-stu-id="93a0a-167">Known Issues</span></span>

#### <a name="role-based-authorization-fails-when-using-windows-azure-authenticationopop"></a><span data-ttu-id="93a0a-168">При использовании проверки подлинности Windows Azure < o: p >< сбой авторизации на основе ролей / o: p ></span><span class="sxs-lookup"><span data-stu-id="93a0a-168">Role-based authorization fails when using Windows Azure Authentication<o:p></o:p></span></span>

<span data-ttu-id="93a0a-169">Проверка подлинности Windows Azure не предоставляет в настоящее время утверждение необходимые роли, что можно провести авторизации на основе ролей.</span><span class="sxs-lookup"><span data-stu-id="93a0a-169">Windows Azure Authentication does not currently provide the necessary role claim so that role-based authorization can be performed.</span></span> <span data-ttu-id="93a0a-170">Роль пользователя, прошедшего проверку подлинности должна осуществляться вручную из Windows Azure Active Directory. < o: p >< / o: p ></span><span class="sxs-lookup"><span data-stu-id="93a0a-170">The role of the authenticated user must be manually retrieved from Windows Azure Active Directory.<o:p></o:p></span></span>

#### <a name="browsing-to-an-application-with-windows-azure-authentication-results-in-the-error-acs20016-the-domain-of-the-logged-in-user-livecom-does-not-match-any-allowed-domain-of-this-stsopop"></a><span data-ttu-id="93a0a-171">Просмотр приложения с результатами проверки подлинности Windows Azure в сообщении об ошибке «домен пользователя, зарегистрированного в системе (live.com) не совпадает с любой ACS20016 разрешено домена этого STS» < o: p >< / o: p ></span><span class="sxs-lookup"><span data-stu-id="93a0a-171">Browsing to an application with Windows Azure Authentication results in the error "ACS20016 The domain of the logged in user (live.com) does not match any allowed domain of this STS"<o:p></o:p></span></span>

<span data-ttu-id="93a0a-172">Если вы уже вошли в учетную запись Майкрософт (например, hotmail.com, live.com, outlook.com) и предпринимается попытка получить доступ к приложению, включил проверку подлинности Windows Azure может получить ответ ошибке 400, так как домен учетной записи Майкрософт не является службой Windows Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="93a0a-172">If you are already logged in to a Microsoft Account (for example hotmail.com, live.com, outlook.com) and you attempt to access an application that has enabled Windows Azure Authentication you may get a 400 error response because the domain of your Microsoft Account is not recognized by Windows Azure Active Directory.</span></span> <span data-ttu-id="93a0a-173">Чтобы войти в приложение, выйдите из учетной записи Майкрософт сначала. < o: p >< / o: p ></span><span class="sxs-lookup"><span data-stu-id="93a0a-173">To log into the application, log out from your Microsoft Account first.<o:p></o:p></span></span>

#### <a name="logging-into-an-application-with-windows-azure-authentication-enabled-and-a-x509certificatevalidationmode-other-than-none-results-in-certificate-validation-errors-for-the-accountsaccesscontrolwindowsnet-certificateopop"></a><span data-ttu-id="93a0a-174">Вход в приложение с включена проверка подлинности Windows Azure и X509CertificateValidationMode, отличное от None в результате ошибки проверки сертификатов для сертификата accounts.accesscontrol.windows.net < o: p >< / o: p ></span><span class="sxs-lookup"><span data-stu-id="93a0a-174">Logging into an application with Windows Azure Authentication enabled and a X509CertificateValidationMode other than None results in certificate validation errors for the accounts.accesscontrol.windows.net certificate<o:p></o:p></span></span>

<span data-ttu-id="93a0a-175">Проверка сертификата не является обязательным и следует отключить.</span><span class="sxs-lookup"><span data-stu-id="93a0a-175">Certificate validation is not required and should be left disabled.</span></span> <span data-ttu-id="93a0a-176">Отпечаток сертификата издателя проверенного WSFederationAuthenticationModule. < o: p >< / o: p ></span><span class="sxs-lookup"><span data-stu-id="93a0a-176">The thumbprint of the issuer certificate is validated by the WSFederationAuthenticationModule.<o:p></o:p></span></span>

#### <a name="when-attempting-to-enable-windows-azure-authentication-the-web-authentication-dialog-shows-the-error-acs20016-the-domain-of-the-logged-in-user-contosoonmicrosoftcom-does-not-match-any-allowed-domain-of-this-stsopop"></a><span data-ttu-id="93a0a-177">При попытке включить проверку подлинности Windows Azure веб-проверки подлинности диалоговое окно показывает ошибку «ACS20016: домен пользователя, зарегистрированного в системе (contoso.onmicrosoft.com) не совпадает с любой допустимому домену STS.» < o: p >< / o: p ></span><span class="sxs-lookup"><span data-stu-id="93a0a-177">When attempting to enable Windows Azure Authentication the Web Authentication dialog shows the error "ACS20016: The domain of the logged in user (contoso.onmicrosoft.com) does not match any allowed domain of this STS."<o:p></o:p></span></span>

<span data-ttu-id="93a0a-178">Появится это сообщение об ошибке при был ранее успешно выполнен вход с помощью Windows Azure Active Directory учетной записи из в одном процессе Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="93a0a-178">You may see this error when you have previously successfully logged in using a different Windows Azure Active Directory account from within the same Visual Studio process.</span></span> <span data-ttu-id="93a0a-179">Выйдите из указанной учетной записи или перезапустите Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="93a0a-179">Log out from the specified account or restart Visual Studio.</span></span> <span data-ttu-id="93a0a-180">Если ранее в систему и выбран параметр «Оставаться в системе», то может потребоваться очистить файлы cookie браузер. < o: p >< / o: p ></span><span class="sxs-lookup"><span data-stu-id="93a0a-180">If you previously logged in and selected the option to "Keep me signed in" then you may need to clear your browser cookies.<o:p></o:p></span></span>

## <a name="acs20012-the-request-is-not-a-valid-ws-federation-protocol-message-opop"></a><span data-ttu-id="93a0a-181">ACS20012: Запрос не является допустимым сообщением протокола WS-Federation < o: p >< / o: p ></span><span class="sxs-lookup"><span data-stu-id="93a0a-181">ACS20012: The request is not a valid WS-Federation protocol message <o:p></o:p></span></span>

<span data-ttu-id="93a0a-182">Это может произойти, если вы уже вошли с использованием некоторых других Microsoft ID к одной из служб Azure.</span><span class="sxs-lookup"><span data-stu-id="93a0a-182">This can happen if you are already logged in with some other Microsoft ID to one of the Azure services.</span></span> <span data-ttu-id="93a0a-183">Окно обозревателя используются закрытые, например InPrivate в браузере IE или анонимный в браузере Chrome или очистить все файлы cookie.</span><span class="sxs-lookup"><span data-stu-id="93a0a-183">Use Private browser window like InPrivate in IE or Incognito in Chrome or clear all the cookies.</span></span> <span data-ttu-id="93a0a-184"><o:p></o:p></span><span class="sxs-lookup"><span data-stu-id="93a0a-184"><o:p></o:p></span></span>

## <a name="additional-resources"></a><span data-ttu-id="93a0a-185">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="93a0a-185">Additional Resources</span></span>

- <span data-ttu-id="93a0a-186">[Microsoft ASP.NET Tools для Windows Azure Active Directory — Visual Studio 2012](https://blogs.msdn.com/b/vbertocci/archive/2013/02/18/microsoft-asp-net-tools-for-windows-azure-active-directory-visual-studio-2012.aspx) — Vittorio Bertocci</span><span class="sxs-lookup"><span data-stu-id="93a0a-186">[Microsoft ASP.NET Tools for Windows Azure Active Directory – Visual Studio 2012](https://blogs.msdn.com/b/vbertocci/archive/2013/02/18/microsoft-asp-net-tools-for-windows-azure-active-directory-visual-studio-2012.aspx) – Vittorio Bertocci</span></span>
- [<span data-ttu-id="93a0a-187">Windows Azure функции: удостоверение</span><span class="sxs-lookup"><span data-stu-id="93a0a-187">Windows Azure Features: Identity</span></span>](https://docs.microsoft.com/azure/active-directory/)
- [<span data-ttu-id="93a0a-188">TechNet: Windows Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="93a0a-188">TechNet: Windows Azure Active Directory</span></span>](https://technet.microsoft.com/library/hh967619.aspx)
- [<span data-ttu-id="93a0a-189">Windows Azure Active Directory: разработка приложений для вашей организации</span><span class="sxs-lookup"><span data-stu-id="93a0a-189">Windows Azure Active Directory: Develop Apps for your organization</span></span>](https://activedirectory.windowsazure.com/Develop/Single-Tenant.aspx)
- [<span data-ttu-id="93a0a-190">Windows Azure Active Directory: разработка приложений для нескольких организаций</span><span class="sxs-lookup"><span data-stu-id="93a0a-190">Windows Azure Active Directory: Develop Apps for multiple organizations</span></span>](https://activedirectory.windowsazure.com/Develop/Multi-Tenant.aspx)
- [<span data-ttu-id="93a0a-191">Как реализовать единый вход в Windows Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="93a0a-191">How to implement single sign-on with Windows Azure Active Directory</span></span>](https://github.com/Azure-Samples/active-directory-dotnet-webapp-openidconnect)
- <span data-ttu-id="93a0a-192">[Единый вход в Windows Azure Active Directory: глубокое погружение](https://blogs.msdn.com/b/vbertocci/archive/2012/07/05/single-sign-on-with-windows-azure-active-directory-a-deep-dive.aspx) — Vittorio Bertocci</span><span class="sxs-lookup"><span data-stu-id="93a0a-192">[Single Sign-On with Windows Azure Active Directory: a Deep Dive](https://blogs.msdn.com/b/vbertocci/archive/2012/07/05/single-sign-on-with-windows-azure-active-directory-a-deep-dive.aspx) – Vittorio Bertocci</span></span>
- [<span data-ttu-id="93a0a-193">Использование AD FS 2.0 для реализации и управления единым входом</span><span class="sxs-lookup"><span data-stu-id="93a0a-193">Use AD FS 2.0 to implement and manage single sign-on</span></span>](https://technet.microsoft.com/library/jj205462.aspx)
