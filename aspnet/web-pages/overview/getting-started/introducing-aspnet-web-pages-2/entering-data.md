---
uid: web-pages/overview/getting-started/introducing-aspnet-web-pages-2/entering-data
title: Введение в ASP.NET Web Pages — ввод данных базы данных с помощью форм | Документы Microsoft
author: tfitzmac
description: Этого учебника показано, как создать форму ввода, а затем введите данные, получаемые из формы в таблицу базы данных при использовании веб-страниц ASP.NET (...
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/28/2015
ms.topic: article
ms.assetid: d37c93fc-25fd-4e94-8671-0d437beef206
ms.technology: dotnet-webpages
ms.prod: .net-framework
msc.legacyurl: /web-pages/overview/getting-started/introducing-aspnet-web-pages-2/entering-data
msc.type: authoredcontent
ms.openlocfilehash: bbccf8134e90c19e29efaa5afe1e46e15320c189
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
ms.locfileid: "30897973"
---
<a name="introducing-aspnet-web-pages---entering-database-data-by-using-forms"></a>Введение в ASP.NET Web Pages — ввод данных базы данных с помощью форм
====================
по [Tom FitzMacken](https://github.com/tfitzmac)

> Этого учебника показано, как создать форму ввода, а затем введите данные, получаемые из формы в таблицу базы данных при использовании веб-страниц ASP.NET (Razor). Предполагается, что завершена ряда через [основы для HTML-форм в ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=251581).
> 
> Что вы узнаете следующее.
> 
> - Подробнее об обработке формы для ввода.
> - Инструкции по добавлению данных (insert) в базе данных.
> - Как убедитесь в том, что пользователи ввели обязательное значение в форме (как для проверки пользовательского ввода).
> - Способ отображения ошибок проверки.
> - Как перейти на другую страницу с текущей страницы.
>   
> 
> Обсуждаются функции и технологии:
> 
> - метод `Database.Execute`;
> - SQL `Insert Into` инструкции
> - `Validation` Вспомогательные.
> - метод `Response.Redirect`;


## <a name="what-youll-build"></a>Что мы создадим

В этом учебнике ранее, вы узнали, как создать базу данных, вы ввели базы данных путем изменения базы данных непосредственно в WebMatrix, работа **базы данных** рабочей области. В большинстве приложений, не является удобным способом поместить данные в базу данных, однако. Поэтому в этом учебнике вы создадите веб-интерфейс, позволяющий или другим ввод данных и сохраните его в базу данных.

Вы создадите страницы, где можно ввести новых фильмов. Эта страница будет содержать форму для ввода с полями (текстовые поля), где можно ввести название фильма, Жанр и год. Эта страница будет выглядеть страница:

![«Добавить фильма» страницы в браузере](entering-data/_static/image1.png)

Текстовые поля будут HTML `<input>` элементы, которые будут выглядеть как эта разметка:

`<input type="text" name="genre" value="" />`

## <a name="creating-the-basic-entry-form"></a>Создание формы основные операции

Создайте страницу с именем *AddMovie.cshtml*.

Замените в файле следующей разметкой. Перезаписать все; Вам предстоит добавить блок кода в верхней чуть ниже.

[!code-cshtml[Main](entering-data/samples/sample1.cshtml)]

Этот пример показывает типичный HTML для создания формы. Она использует `<input>` элементов для текстовых полей и кнопки "Отправить". Заголовки для текстовых полей, созданных с помощью стандартного `<label>` элементов. `<fieldset>` И `<legend>` элементы помещают хорошо рамку вокруг формы.

Обратите внимание, что на этой странице `<form>` элемент использует `post` значение `method` атрибута. В предыдущем учебнике вы создали форму, которая используется `get` метод. Это было правильным, так как несмотря на то, что значения на сервер отправить форму, запрос, не вносить изменения. Все, что именно сделала было извлекать данные различными способами. Однако в этой страницы вы *будет* внести изменения, вы собираетесь добавить новые записи базы данных. Таким образом, следует использовать эту форму `post` метод. (Дополнительные сведения о различиях между `GET` и `POST` операций, в разделе[GET, POST и HTTP глагол безопасности](https://go.microsoft.com/fwlink/?LinkId=251581#GET,_POST,_and_HTTP_Verb_Safety) боковой панели в предыдущем учебнике.)

Обратите внимание, что каждое текстовое поле имеет `name` элемент (`title`, `genre`, `year`). Как показано в предыдущем учебнике эти имена важны, поскольку необходимо иметь эти имена, поэтому входные данные пользователя можно получить в более поздней версии. Можно использовать любые имена. Полезно Используйте значимые имена, которые помогают запомнить, какие данные, которым вы работаете.

`value` Атрибут каждого `<input>` элемент содержит большой объем кода Razor (например, `Request.Form["title"]`). Вы узнали версии этот прием в предыдущем учебнике для сохранения значения, введенного в текстовое поле (если таковые имеются), после отправки формы.

## <a name="getting-the-form-values"></a>Получение значения формы

Добавьте код, обрабатывающий форму. В структуре вам предстоит выполнить следующее.

1. Проверьте, является ли страница отправляется (отправки). Требуется код для выполнения только в том случае, если пользователи кнопки, не при первом запуске страницы.
2. Получение значения, введенные пользователем в текстовых полях. В этом случае потому, что использование формы `POST` команд, вы получите значения формы из `Request.Form` коллекции.
3. Вставьте значения как новую запись в *фильмов* таблицы базы данных.

В верхней части файла добавьте следующий код:

[!code-cshtml[Main](entering-data/samples/sample2.cshtml)]

Первые несколько строк создайте переменные (`title`, `genre`, и `year`) для хранения значений с помощью текстовых полей. Строки `if(IsPost)` гарантирует, что переменные задаются *только* при щелчке **добавьте фильма** кнопки — то есть, когда после отправки формы.

Как видно в предыдущих учебник, получить значение текстового поля с помощью выражения, подобного `Request.Form["name"]`, где *имя* имя `<input>` элемента.

Имена переменных (`title`, `genre`, и `year`) произвольны. Как и имена, назначаемые `<input>` элементов, их можно вызывать любое название. (Имена переменных не должны совпадать атрибуты name `<input>` элементов в форме.) Но как и в `<input>` элементов, рекомендуется использовать имена переменных, которые отображают данные, которые они содержат. При написании кода, согласованные имена упрощают процесс запомнить работа идет с данными.

## <a name="adding-data-to-the-database"></a>Добавление данных в базе данных

В коде блока вы только что добавленную, просто *внутри* закрывающую фигурную скобку ( `}` ) из `if` блока (не только внутри блока кода), добавьте следующий код:

[!code-csharp[Main](entering-data/samples/sample3.cs)]

Этот пример аналогичен кода, которая использовалась в предыдущем учебнике для выборки и отображения данных. Строку, которая начинается с `db =` открывает базу данных, как и прежде и следующая строка определяет инструкцию SQL, снова как мы делали раньше. Тем не менее, это время она определяет SQL `Insert Into` инструкции. В следующем примере показано общий синтаксис `Insert Into` инструкции:

`INSERT INTO table (column1, column2, column3, ...) VALUES (value1, value2, value3, ...)`

Другими словами указать таблицы для вставки в, затем список столбцов для вставки в, а затем список значений для вставки. (Как было отмечено ранее, SQL выполняется без учета регистра, но некоторые пользователи эти ключевые слова, чтобы упростить чтение команду).

В команде уже перечислены столбцы, то вставляется — `(Title, Genre, Year)`. Особый интерес представляет как получить значения из текстовых полей в `VALUES` часть команды. Вместо фактических значений, вы видите `@0`, `@1`, и `@2`, конечно, что представляют собой заполнители. При запуске команды (на `db.Execute` строки), передать значения, полученного от текстовые поля.

**Важно!** Помните, что единственным способом, никогда не следует включать данные, вводимые через Интернет пользователем в инструкцию SQL для использования заполнители, как показано ниже (`VALUES(@0, @1, @2)`). При объединении ввод данных пользователем в инструкцию SQL, открытии самостоятельно атаке путем внедрения кода SQL, как описано в [основы формы ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=251581) (работу с предыдущим учебником).

По-прежнему внутри `if` блока, добавьте следующую строку после `db.Execute` строки:

[!code-css[Main](entering-data/samples/sample4.css)]

После вставки в базу данных новых фильмов, эта строка переходит вы (перенаправление) *фильмов* страницы, чтобы можно было видеть только что введен фильма. `~` Оператор означает «root веб-сайта». ( `~` Оператор обычно работает только на страницах ASP.NET, а не в формате HTML.)

Полный код блока выглядит как в следующем примере:

[!code-cshtml[Main](entering-data/samples/sample5.cshtml)]

## <a name="testing-the-insert-command-so-far"></a>Тестирование команды вставки (пока)

Запись еще не активирована, но теперь это подходящий момент для тестирования.

Щелкните правой кнопкой мыши в древовидном представлении файлы в WebMatrix, *AddMovie.cshtml* и нажмите кнопку **запуск в браузере**.

![«Добавить фильма» страницы в браузере](entering-data/_static/image2.png)

(При завершении на другую страницу в браузере убедитесь, что URL-адрес `http://localhost:nnnnn/AddMovie`), где *nnnnn* — номер порта, которую вы используете.)

Вы получаете страницу ошибки? В этом случае следует внимательно прочитать и убедитесь, что код выглядит точно что перечисленного ранее.

Введите в форме фильма &mdash; например, используйте «Kane частные лица», «Драма» и «1941». (Или любое другое.) Нажмите кнопку **добавьте фильма**.

Если все пойдет хорошо, вы будете перенаправлены на *фильмов* страницы. Убедитесь, что новый фильма в списке.

![Добавить страницу фильмов, показывающая вновь фильма](entering-data/_static/image3.png)

## <a name="validating-user-input"></a>Проверка пользовательского ввода

Вернитесь к *AddMovie* страницы и запустите его еще раз. Введите другой фильм, но на этот раз, введите только название &mdash; например, введите «"Войти в дождь». Нажмите кнопку **добавьте фильма**.

Вы будете перенаправлены на *фильмов* страницу еще раз. Можно найти новый фильм, но он является неполным.

![Фильмы страницы отображение новый фильм, отсутствуют некоторые значения](entering-data/_static/image4.png)

При создании *фильмов* таблицы, можно явным образом, говорят, ни одно поле может иметь значение null. Здесь у нас имеется форма ввода новых фильмов, а поля оставить пустым. Это является ошибкой.

В этом случае не вызывать базе данных фактически (или *throw*) произошла ошибка. Не предоставил жанр или года, поэтому код в *AddMovie* страницы считать эти значения так называемые *пустые строки*. Если SQL `Insert Into` выполнялась команда, Жанр и год поля не содержат полезные данные в них, но они не были значение null.

Очевидно, что вы не хотите разрешить пользователям вводить сведения о фильмах половина пустым в базу данных. Решение заключается в том, чтобы проверить введенные пользователем данные. Изначально проверки просто убедиться в том, что пользователь ввел значение для всех полей (таким образом, что ни один из них содержит пустую строку).

> [!TIP]
> 
> **NULL и пустые строки**
> 
> В программировании является различие между разных понятия «нет значения». Как правило, является значение *null* если его никогда не были заданы или инициализирована любым способом. Напротив, может быть присвоен переменной, которая ожидает символьные данные (строки) *пустая строка*. В этом случае значение не равно null; он является только что был явно указан в строку символов, длина которого равна нулю. Различие этих двух операторов:
> 
> [!code-csharp[Main](entering-data/samples/sample6.cs)]
> 
> Он немного сложнее, чем, но важно то, что `null` представляет своего рода неопределенном состоянии.
> 
> А затем важно понимать, только если значение равно null и когда это просто пустая строка. В коде *AddMovie* будет включать значения текстовых полей с помощью `Request.Form["title"]` и т. д. При первом запуске страницы (до нажатия кнопки), значение `Request.Form["title"]` имеет значение null. Но при отправке формы, `Request.Form["title"]` возвращает значение `title` текстовое поле. Не является очевидным, но пустые текстовые поля не имеет значение null; он просто содержит пустую строку. Поэтому при выполнении кода в ответ на кнопке щелкните, `Request.Form["title"]` имеет пустую строку в нем.
> 
> Почему важно различать? При создании *фильмов* таблицы, можно явным образом, говорят, ни одно поле может иметь значение null. Но здесь у нас имеется форма ввода новых фильмов и поля оставить пустым. Можно ожидать достаточно отправить жалобу при попытке сохранить новые фильмы, не имеющие значения по жанру или год базы данных. Но это точке &mdash; даже если оставить эти текстовые поля, значения не null; они пустые строки. В результате вы можете сохранить новые фильмы в базе данных с этими столбцами пустой &mdash; , но не null! значения типа &mdash;. Таким образом необходимо убедиться, что пользователи не отправляют пустая строка, это можно сделать путем проверки входных данных пользователя.


### <a name="the-validation-helper"></a>Вспомогательный объект проверки

Веб-страниц ASP.NET включает модуль поддержки &mdash; `Validation` вспомогательный &mdash; , можно использовать для убедитесь, что ввода данных, который соответствует вашим требованиям. `Validation` Вспомогательный — один из вспомогательных методов, является встроенным для ASP.NET Web Pages и нет необходимости устанавливать его как пакет с помощью NuGet, способ установки вспомогательный глобально распознаваемые в более ранних учебника.

Чтобы проверить введенные пользователем данные, вам предстоит выполнить следующее.

- Используйте код, чтобы указать, что требуются значения в текстовых полях на странице.
- Поместите тест в код, чтобы сведения о фильмах добавляется в базу данных только в том случае, если все проверяет должным образом.
- Добавьте код в разметку для отображения сообщений об ошибках.

В блоке кода в *AddMovie* вправо вверх в верхней до объявления переменных, добавьте следующий код:

[!code-csharp[Main](entering-data/samples/sample7.cs)]

Можно вызвать `Validation.RequireField` один раз для каждого поля (`<input>` элемент) место необходим аргумент. Можно также добавить сообщения о пользовательской ошибке для каждого вызова, как показано ниже. (Мы разнообразными сообщения, чтобы показать, можно поместить все, что вам нравится существует).

Если проблема, вы хотите ограничить фильма сведения об, вставляемых в базу данных. В `if(IsPost)` , используется `&&` (логическое и), чтобы добавить другое условие, который проверяет `Validation.IsValid()`. После завершения, весь `if(IsPost)` блок выглядит как следующий код:

[!code-csharp[Main](entering-data/samples/sample8.cs)]

Если ошибка проверки с любым из полей, которые зарегистрированы с помощью `Validation` вспомогательного приложения, `Validation.IsValid` метод возвращает значение false. И в этом случае ни один код в этом блоке будет запущен, поэтому нет записей недопустимый фильма будет вставлен в базе данных. Конечно не выполняется перенаправление на *фильмов* страницы.

Законченный блок кода, включая код проверки, теперь выглядит как в следующем примере:

[!code-cshtml[Main](entering-data/samples/sample9.cshtml?highlight=10)]

## <a name="displaying-validation-errors"></a>Отображение ошибок проверки

Последним шагом является отображение сообщения об ошибках. Можно отображать отдельные сообщения для каждой ошибки проверки, или можно отобразить сводные данные, или оба. В этом учебнике вы выполните оба, чтобы можно было проверить его работу.

Рядом с каждой `<input>` элемент, проверка, вызовите `Html.ValidationMessage` метод и передайте ему имя `<input>` элемент, проверка. Поместить `Html.ValidationMessage` метод прямо место отображается сообщение об ошибке. При запуске страницы, `Html.ValidationMessage` метод отрисовывает `<span>` элемент, которому будет переходить к ошибке проверки. (Если нет ошибок, `<span>` элемент отображается, но в нем отсутствует текст.)

Измените разметку страницы, чтобы оно включало `Html.ValidationMessage` метод для каждого из трех `<input>` элементов на странице, как и в этом примере:

[!code-cshtml[Main](entering-data/samples/sample10.cshtml?highlight=3,8,13)]

Чтобы увидеть, как работает сводки, также добавьте следующую разметку и код сразу после `<h1>Add a Movie</h1>` элемента на странице:

[!code-cshtml[Main](entering-data/samples/sample11.cshtml)]

По умолчанию `Html.ValidationSummary` метод отображает все сообщения проверки в списке ( `<ul>` элемент, находящийся внутри `<div>` элемент). Как и в `Html.ValidationMessage` метод, всегда отображается разметку для сводки проверки; Если ошибок нет, не элементы списка отображаются.

Сводка может быть альтернативным способом отображения сообщений проверки, а не с помощью `Html.ValidationMessage` метод для отображения каждой ошибки конкретных полей. Или можно использовать Сводка и подробные сведения. Или можно использовать `Html.ValidationSummary` метод для отображения универсальное сообщение об ошибке, а затем использовать отдельные `Html.ValidationMessage` вызовы для отображения подробных сведений.

Страница «Готово» теперь выглядит как в следующем примере:

[!code-cshtml[Main](entering-data/samples/sample12.cshtml)]

Вот и все. Теперь можно проверить страницы путем добавления фильм, но не отобразит одно или несколько полей. После этого вы видите следующую ошибку отображения:

![Добавление страницы фильм, отображение сообщений об ошибках проверки](entering-data/_static/image5.png)

## <a name="styling-the-validation-error-messages"></a>Задание стиля сообщений об ошибках проверки

Вы увидите, что сообщения об ошибках, но они не выделялись действительно очень хорошо. Отсутствует простой способ для стиля сообщения об ошибках, но.

Для стиля сообщения об отдельных ошибках, которые отображаются по `Html.ValidationMessage`, создайте класс стиля CSS, с именем `field-validation-error`. Чтобы определить вид для сводки проверки, создайте класс стиля CSS с именем `validation-summary-errors`.

Чтобы увидеть, как работает этот метод, добавьте `<style>` внутри `<head>` части страницы. Затем определите классы стилей с именем `field-validation-error` и `validation-summary-errors` , содержащие следующие правила:

[!code-cshtml[Main](entering-data/samples/sample13.cshtml?highlight=4-17)]

Обычно скорее разместить сведения о стиле в отдельную *.css* файла, но для простоты можно поместить их на странице сейчас. (Далее в этот учебник набор перемещается правила CSS в отдельную *.css* файл.)

Если ошибка проверки, `Html.ValidationMessage` метод отрисовывает `<span>` , включающий `class="field-validation-error"`. Добавление определения стиля для этого класса, можно настроить, как выглядит сообщение. Если есть ошибки, `ValidationSummary` метод аналогично динамически отображает атрибут `class="validation-summary-errors"`.

Снова запустить страницу и намеренно опустить несколько полей. Ошибки стали более заметным. (На самом деле они выполняется overdone, но это просто для того, чтобы показать, что можно сделать.)

![Добавление страницы фильм, отображение ошибок проверки, которые были со стилем](entering-data/_static/image6.png)

## <a name="adding-a-link-to-the-movies-page"></a>Добавление ссылки на страницу фильмов

Последний этап является для повышения удобства получить *AddMovie* страницы из исходного списка фильма.

Откройте *фильмов* страницу еще раз. После закрывающей `</div>` тег, который следует за `WebGrid` вспомогательного приложения, добавьте следующую разметку:

[!code-cshtml[Main](entering-data/samples/sample14.cshtml)]

Как мы делали раньше, ASP.NET интерпретирует `~` оператор в корневом веб-сайта. Нет необходимости в использовании `~` оператора; можно использовать разметку `<a href="./AddMovie">Add a movie</a>` или иным способом для определения пути, который понимает HTML. Но `~` оператор-хороший общий подход при создании ссылки на страницах Razor, поскольку это делает сайта более гибкий — при перемещении текущей страницы во вложенную папку, ссылка по-прежнему будет указывать на *AddMovie* страницы. (Следует помнить, что `~` оператор работает только *.cshtml* страниц. ASP.NET понимает его, но не стандартный код HTML).

Когда закончите, запустите *фильмов* страницы. Она будет выглядеть этой странице:

![Фильмы страницу со ссылкой на страницу «Добавление фильмов»](entering-data/_static/image7.png)

Нажмите кнопку **добавления фильма** ссылку, чтобы убедиться в том, что она ведет к *AddMovie* страницы.

## <a name="coming-up-next"></a>В ближайшее время

В следующем уроке будет рассмотрено позволяют пользователям редактировать данные, которые уже находится в базе данных.

## <a name="complete-listing-for-addmovie-page"></a>Полный пример для AddMovie страницы

[!code-cshtml[Main](entering-data/samples/sample15.cshtml)]

## <a name="additional-resources"></a>Дополнительные ресурсы

- [Введение в программирование веб-ASP.NET с использованием синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkID=202890)
- [Вставка в инструкции SQL](http://www.w3schools.com/sql/sql_insert.asp) на сайте W3Schools
- [Проверка пользовательского ввода в ASP.NET Web Pages сайтов](https://go.microsoft.com/fwlink/?LinkId=253002). Дополнительные сведения о работе с `Validation` поддержки.

> [!div class="step-by-step"]
> [Назад](form-basics.md)
> [Вперед](updating-data.md)
