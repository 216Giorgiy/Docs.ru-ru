---
uid: web-pages/overview/getting-started/11-adding-email-to-your-web-site
title: "Отправка электронной почты с веб-узла ASP.NET страниц сайта (Razor) | Документы Microsoft"
author: tfitzmac
description: "В этой главе объясняется, как отправить сообщение по электронной почте с веб-сайта."
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2014
ms.topic: article
ms.assetid: fc49bcb9-f1a9-4048-8c3f-b60951853200
ms.technology: dotnet-webpages
ms.prod: .net-framework
msc.legacyurl: /web-pages/overview/getting-started/11-adding-email-to-your-web-site
msc.type: authoredcontent
ms.openlocfilehash: 2db94088a04e87c6ab89df26a7a7b0e2a2653a1a
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="sending-email-from-an-aspnet-web-pages-razor-site"></a>Отправка электронной почты из веб-страниц (Razor) узла ASP.NET
====================
по [Tom FitzMacken](https://github.com/tfitzmac)

> В этой статье объясняется, как отправить сообщение электронной почты с веб-сайта, при использовании веб-страниц ASP.NET (Razor).
> 
> Что вы узнаете следующее.
> 
> - Как отправить сообщение электронной почты из веб-сайта.
> - Как вложить файл в сообщение электронной почты.
> 
> Это функция ASP.NET, представленные в статье:
> 
> - `WebMail` Вспомогательные.
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемая в этом учебнике
> 
> 
> - Веб-страниц ASP.NET (Razor) 3
>   
> 
> Этот учебник также работает с веб-страницы ASP.NET 2.


<a id="Sending_Email_Messages"></a>
## <a name="sending-email-messages-from-your-website"></a>Отправка сообщений электронной почты с веб-сайта

Существует множество причин, почему вам необходимо для отправки электронной почты с веб-сайта. Подтверждения сообщений могут отправлять пользователям или может отправлять уведомления в себе (например, зарегистрированного пользователя.) `WebMail` Вспомогательные упрощает для отправки электронной почты.

Для использования `WebMail` вспомогательного приложения, необходимо иметь доступ к серверу SMTP. (Расшифровывается SMTP *протокол SMTP*.) SMTP-сервер — это почтовый сервер, который только перенаправляет сообщения на сервер получателя &#8212; Это стороне исходящей электронной почты. При использовании поставщика услуг размещения веб-сайта, они, скорее всего, установить соответствующие разрешения с адресом электронной почты, и они могут понять имя сервера SMTP. При работе в корпоративной сети, администратор или ИТ-отдел обычно обеспечивает сведения о SMTP-сервер, который можно использовать. Если вы работаете дома, даже можно тестировать с помощью провайдера обычный электронной почты, можно сообщить имя своего сервера SMTP. Обычно нужно:

- Имя SMTP-сервера.
- Номер порта. Почти всегда это 25. Тем не менее поставщик услуг Интернета может потребоваться использовать порт 587. Если вы используете протокол SSL (SSL) для электронной почты, может потребоваться другой порт. Обратитесь к поставщику по электронной почте.
- Учетные данные (имя пользователя, пароль).

В этой процедуре создается две страницы. Первая страница имеет форму, которая позволяет ввести описание, как если бы они заполнив форму технической поддержки. Первая страница отправляет данные на вторую страницу. На второй странице код извлекает информацию о пользователе и отправляет сообщение электронной почты. Она также отображает сообщение, подтверждающее, что был получен отчет о проблеме.

![[image]](11-adding-email-to-your-web-site/_static/image1.jpg)

> [!NOTE]
> Для простоты в этом примере код инициализирует `WebMail` вспомогательный справа на странице, где он используется. Однако для реальных веб-сайтов, это лишним будет поместить следующий код инициализации в файл глобального, чтобы инициализировать `WebMail` вспомогательный класс для всех файлов веб-сайта. Дополнительные сведения см. в разделе [поведение Настройка сайта для веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202906#Setting_Values_For_Helpers).


1. Создание нового веб-сайта.
2. Добавление новой страницы с именем *EmailRequest.cshtml* и добавьте следующую разметку: 

    [!code-html[Main](11-adding-email-to-your-web-site/samples/sample1.html)]

    Обратите внимание, что `action` присвоено атрибута элемента form *ProcessRequest.cshtml*. Это означает, что форма будет отправлена на эту страницу, а не обратно к текущей странице.
3. Добавление новой страницы с именем *ProcessRequest.cshtml* на веб-сайт и добавьте следующую разметку и код:   

    [!code-cshtml[Main](11-adding-email-to-your-web-site/samples/sample2.cshtml)]

    В коде вы получите значения полей формы, отправленных на страницу. Затем вызовите `WebMail` помощника `Send` метод для создания и отправки сообщения электронной почты. В этом случае значения, используемые состоят из текста, объединение со значениями, которые были отправлены из формы.

    Код для этой страницы находится внутри `try/catch` блока. Если для какой-либо причине попытки отправки сообщения электронной почты не работает (например, параметры и не вправо), код в `catch` блок выполняется и задает `errorMessage` переменной возникшей ошибки. (Дополнительные сведения о `try/catch` блоков или `<text>` тег см. в разделе [введение в ASP.NET Web Pages программирование с использованием синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkID=251587#ID_HandlingErrors).)

    В теле страницы Если `errorMessage` переменная пуста (по умолчанию), пользователь увидит сообщение, которое было отправлено сообщение электронной почты. Если `errorMessage` переменная имеет значение true, который пользователь видит сообщение, что произошла ошибка при отправке сообщения.

    Обратите внимание, что в области страницы, которая отображает сообщение об ошибке, дополнительной проверки: `if(debuggingFlag)`. Это переменная, можно задать значение true, если у вас возникают проблемы при отправке сообщения электронной почты. Когда `debuggingFlag` имеет значение true, и если имеется ошибка при отправке электронной почты, отображается дополнительные сообщения об ошибках, показывающее, независимо от ASP.NET сообщил о при попытке отправить сообщение электронной почты. Справедливый предупреждение, однако: сообщения об ошибках, которые ASP.NET выдает сообщение, если он не может отправить сообщение электронной почты могут быть универсальными. Например если ASP.NET не может связаться с сервером SMTP (например, из-за ошибки в имени сервера), ошибка `Failure sending mail`.

    > [!NOTE] 
    > 
    > **Важные** при получении сообщение об ошибке из объекта исключения (`ex` в коде), выполните *не* регулярно передать сообщение через для пользователей. Объекты исключения часто содержат сведения, пользователи не должны видеть и, даже к уязвимости системы безопасности. Поэтому этот код содержит переменную `debuggingFlag` , используемое в качестве параметра для отображения сообщения об ошибке, и почему переменной по умолчанию имеет значение false. Следует задать значение true (и поэтому сообщение об ошибке) этой переменной *только* Если у вас возникают проблемы с отправкой электронной почты, и необходимо отладить. После устранения проблемы задайте `debuggingFlag` обратно в значение false.

    Изменить связанные параметры в коде, электронной почты следующие:

    - Задать `your-SMTP-host` имя SMTP-сервера, у вас есть право.
    - Задать `your-user-name-here` к имени пользователя для учетной записи сервера SMTP.
    - Задать `your-account-password` пароль пользователя для учетной записи сервера SMTP.
    - Задать `your-email-address-here` на собственный адрес электронной почты. Это адрес электронной почты отправителя сообщения. (Некоторые поставщики электронной почты не позволяют задать другую `From` адреса и будет использовать имя пользователя как `From` адрес.)

    > [!TIP] 
    > 
    > <a id="configuring_email_settings"></a>
    > ### <a name="configuring-email-settings"></a>Настройка параметров электронной почты
    > 
    > Он может быть достаточно сложным, иногда для того, чтобы убедиться в том, что у вас есть нужные параметры для SMTP-сервера, номер порта и т. д. Несколько советов:
    > 
    > - Имя SMTP-сервера часто является примерно `smtp.provider.com` или `smtp.provider.net`. Однако, если публикации сайта поставщика услуг размещения, имя SMTP-сервера на этом этапе может быть `localhost`. Это так, как вы опубликовали и сайт работает на сервере поставщика, сервера электронной почты может быть локальным с точки зрения приложения. Это изменение в имена серверов могут означать, что необходимо изменить имя SMTP-сервера в рамках процесса публикации.
    > - Номер порта обычно — 25. Тем не менее, некоторые поставщики требуют использовать порт 587 или некоторых других портов.
    > - Убедитесь, что используются правильные учетные данные. При публикации веб-узла поставщика услуг размещения, используйте учетные данные, которые поставщик указал специально предназначены для электронной почты. Они могут отличаться от учетных данных, которые можно использовать для публикации.
    > - Иногда учетные данные не требуются вообще. Если вы отправляете сообщение электронной почты с помощью ваш поставщик услуг Интернета, вашего поставщика услуг электронной почты может быть уже известен учетные данные. После публикации, может потребоваться использовать другие учетные данные, чем при проверке на локальном компьютере.
    > - Если вашего поставщика услуг электронной почты использует шифрование, необходимо задать для `WebMail.EnableSsl` для `true`.
4. Запустите *EmailRequest.cshtml* страницы в браузере. (Убедитесь, что выбран страницы **файлы** рабочей области, прежде чем запускать его.)
5. Введите свое имя и описание проблемы, а затем нажмите кнопку **отправить** кнопки. Вы будете перенаправлены на *ProcessRequest.cshtml* страница, на которой сообщения подтверждает, который отправляет сообщение электронной почты. 

    ![[image]](11-adding-email-to-your-web-site/_static/image2.jpg)

<a id="Sending_a_File"></a>
## <a name="sending-a-file-using-email"></a>Отправка файла по электронной почте

Также можно отправлять файлы, подключенные к сообщениям электронной почты. В этой процедуре создайте текстовый файл и две страницы HTML. Текстовый файл будет использоваться как вложение электронной почты.

1. Веб-сайта, добавьте новый текстовый файл и назовите его *MyFile.txt*.
2. Скопируйте следующий текст и вставьте его в файл: 

    `Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.`
3. Создайте страницу с именем *SendFile.cshtml* и добавьте следующую разметку: 

    [!code-html[Main](11-adding-email-to-your-web-site/samples/sample3.html)]
4. Создайте страницу с именем *ProcessFile.cshtml* и добавьте следующую разметку: 

    [!code-cshtml[Main](11-adding-email-to-your-web-site/samples/sample4.cshtml)]
5. Изменить связанные параметры в коде из примера, электронной почты следующие:

    - Задать `your-SMTP-host` имя SMTP-сервер, имеется доступ.
    - Задать `your-user-name-here` к имени пользователя для учетной записи сервера SMTP.
    - Задать `your-email-address-here` на собственный адрес электронной почты. Это адрес электронной почты отправителя сообщения.
    - Задать `your-account-password` пароль пользователя для учетной записи сервера SMTP.
    - Задать `target-email-address-here` на собственный адрес электронной почты. (Как до, вы обычно отправляете сообщение электронной почты другому пользователю, но для тестирования, можно отправить ее себе.)
6. Запустите *SendFile.cshtml* страницы в браузере.
7. Введите свое имя, строку темы и имя текстового файла, прилагаемого (*MyFile.txt*).
8. Нажмите кнопку `Submit`. Как и прежде, будет перенаправлен на *ProcessFile.cshtml* страница, на которой подтверждает сообщения которой отправляет вам сообщение электронной почты с вложенный файл.

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>Дополнительные ресурсы


- [Веб-страницы ASP.NET руководство по устранению неполадок (Razor)](https://go.microsoft.com/fwlink/?LinkId=253001)
- [Протокол SMTP](https://msdn.microsoft.com/en-us/library/aa480435.aspx)
- [Настройка поведения сайта для веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202906)
