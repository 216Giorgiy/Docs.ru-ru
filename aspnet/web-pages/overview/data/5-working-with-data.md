---
uid: web-pages/overview/data/5-working-with-data
title: "Введение в работу с базой данных в ASP.NET Web Pages (Razor) узлов | Документы Microsoft"
author: tfitzmac
description: "В этой главе описывается доступ к данным из базы данных и отображения веб-страниц ASP.NET."
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/18/2014
ms.topic: article
ms.assetid: 673d502f-2c16-4a6f-bb63-dbfd9a77ef47
ms.technology: dotnet-webpages
ms.prod: .net-framework
msc.legacyurl: /web-pages/overview/data/5-working-with-data
msc.type: authoredcontent
ms.openlocfilehash: 460af471a1b0650f8d782d582ce6cd9a06664d5c
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="introduction-to-working-with-a-database-in-aspnet-web-pages-razor-sites"></a>Введение в работу с базой данных в ASP.NET Web Pages (Razor) узлов
====================
по [Tom FitzMacken](https://github.com/tfitzmac)

> В этой статье описываются способы использования средств Microsoft WebMatrix для создания базы данных в веб-сайта ASP.NET Web Pages (Razor) и способ создания страниц, которые позволяют отображать, добавление, изменение и удаление данных.
> 
> **Что вы узнаете следующее.** 
> 
> - Инструкции по созданию базы данных.
> - Способ подключения к базе данных.
> - Как отобразить данные на веб-странице.
> - Способ вставки, обновления и удаления записей базы данных.
> 
> Существуют следующие функции, представленные в статье:
> 
> - Работа с базой данных Microsoft SQL Server Compact Edition.
> - Работа с запросами SQL.
> - класс `Database`;
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемая в этом учебнике
> 
> 
> - Веб-страниц ASP.NET (Razor) 2
> - WebMatrix 2
>   
> 
> Этот учебник также работает с WebMatrix 3. Можно использовать 3 веб-страниц ASP.NET и Visual Studio 2013 (или Visual Studio Express 2013 для Web); Тем не менее пользовательский интерфейс будет отличаться.


## <a name="introduction-to-databases"></a>Знакомство с базами данных

Представьте себе типичный адресной книги. Для каждой записи в адресной книге (то есть, для каждого пользователя), у вас есть несколько видов информации, такие как имя, Фамилия, адрес, адрес электронной почты и номер телефона.

Типичный способ подобные данные рисунка — как таблицу со строками и столбцами. В терминах баз данных каждая строка часто называют записи. Каждый столбец (иногда называют полями) содержит значение для каждого типа данных: имени, фамилии и т. д.

| **ID** | **FirstName** | **Фамилия** | **Адрес** | **Электронная почта** | **Телефон** |
| --- | --- | --- | --- | --- | --- |
| 1 | Джим | Abrus | 210 100 St SE Orcas WA 98031 | jim@contoso.com | 555 0100 |
| 2 | Александр | Adams | 1234 Main St. Сиэтл WA 99011 | terry@cohowinery.com | 555 0101 |

Для большинства таблиц базы данных таблица должна иметь столбец, содержащий уникальный идентификатор, например номер заказчика, номер счета, и т. д. Этот процесс известен как таблицы *первичного ключа*, и использовать его для идентификации каждой строки в таблице. В примере идентификатор столбца является первичным ключом для адресной книги.

С этой базовое представление о базах данных, вы готовы узнать, как создать простой базы данных и операций, таких как добавление, изменение и удаление данных.

> [!TIP] 
> 
> **Реляционные базы данных**
> 
> Данные можно сохранить в большом числе способами, включая текстовые файлы и электронные таблицы. Для большинства бизнес-использования, данные хранятся в реляционной базе данных.
> 
> В этой статье не очень глубоко перейдите в базах данных. Тем не менее может оказаться полезным для ознакомления с немного о них. В реляционной базе данных сведения логически состоит из отдельных таблиц. Например для учебной базы данных может содержать отдельные таблицы для учащихся и для предложений класса. База данных программного обеспечения (например, SQL Server) поддерживает мощные команды, которые позволяют динамически установления связи между таблицами. Например можно использовать реляционную базу данных для установления логическую связь между классы и студентов, чтобы создать расписание. Хранение данных в отдельных таблицах снижает сложность структуру таблицы и уменьшает необходимость поддерживать избыточных данных в таблицах.


## <a name="creating-a-database"></a>Создание базы данных

Эта процедура показано, как создать базу данных с именем SmallBakery с помощью средства разработки базы данных SQL Server Compact, включенный в WebMatrix. Несмотря на то, что можно создать базу данных с помощью кода, более типично для создания базы данных и таблицы базы данных с помощью средств разработки, как WebMatrix.

1. Запустить WebMatrix и на странице быстрого запуска нажмите **сайта из шаблона**.
2. Выберите **пустой сайт**и в **имя сайта** введите «SmallBakery» и нажмите кнопку **ОК**. Сайт создается и отображается в WebMatrix.
3. В левой области щелкните **баз данных** рабочей области.
4. На ленте щелкните **новой базы данных**. Пустая база данных создается с тем же именем, что и сайт.
5. В левой области разверните **SmallBakery.sdf** узел, а затем нажмите кнопку **таблиц**.
6. На ленте щелкните **новую таблицу**. WebMatrix откроется в конструкторе таблиц.

    ![[image]](5-working-with-data/_static/image1.jpg)
7. Нажмите кнопку в **имя** столбца и введите &quot;идентификатор&quot;.
8. В **тип данных** выберите **int**.
9. Задать **— первичный ключ?** и **— определить?** вариантов для **Да**.

    Как видно из имени, **— первичный ключ** указывает базу данных, это будет первичный ключ таблицы. **Представляет идентификатор** указывает базу данных, чтобы автоматически создать идентификаторы для каждой новой записи и назначьте его порядковый номер (начиная с 1).
10. Щелкните следующую строку. Редактор начинается определение нового столбца.
11. Значение имени введите &quot;имя&quot;.
12. Для **тип данных**, выберите &quot;nvarchar&quot; и задающий длину равной 50. *Var* частью `nvarchar` указывает базу данных, представляет собой строку, размер которого может отличаться от записи к записи данных для этого столбца. (  *n*  Префикса представляет *national*, указывающий на то, что поле может содержать символьные данные, представляющий все буквы или записи системы & #8212, то есть, это поле содержит Юникода данные.)
13. Задать **Allow Nulls** для параметра **нет**. Это обеспечит, *имя* столбца не остается пустым.
14. С помощью такой же процесс создания столбца с именем *описание*. Задать **тип данных** «nvarchar» и 50 длины, а набор **Allow Nulls** значение false.
15. Создать столбец с именем *цены*. Задать **типа данных «money»** и задайте **Allow Nulls** значение false.
16. В поле вверху, назовите таблицу &quot;продукта&quot;.

    Когда закончите, определение будет выглядеть следующим образом:

    ![[image]](5-working-with-data/_static/image2.jpg)
17. Нажмите Ctrl + S для сохранения таблицы.

## <a name="adding-data-to-the-database"></a>Добавление данных в базе данных

Теперь можно добавить к базе данных, далее в этой статье вы будете работать с образцами данных.

1. В левой области разверните **SmallBakery.sdf** узел, а затем нажмите кнопку **таблиц**.
2. Щелкните правой кнопкой мыши таблицу Product и нажмите кнопку **данные**.
3. В области редактирования введите следующие записи:

    | **Имя** | **Описание** | **Цены** |
    | --- | --- | --- |
    | Хлеб | Новая помещенного каждый день. | 2.99 |
    | Shortcake клубники | Выполненных с органических strawberries из наших сада. | 9.99 |
    | Круговой Apple | Второе только в ваша мама круговую диаграмму. | 12.99 |
    | Круговой pecan | Если вам нравится pecans, это для вас. | 10.99 |
    | Лимонная круговой | Внесены с наиболее лимонов в мире. | 11.99 |
    | Кексы | Детей и kid в вашем по достоинству оценят их. | 7.99 |

    Помните, что не нужно вводить данные для *идентификатор* столбца. При создании *идентификатор* набор столбцов, его **Is Identity** значение true, что приведет к автоматически заполнить.

    По завершении ввода данных, конструктора таблиц будет выглядеть следующим образом:

    ![[image]](5-working-with-data/_static/image3.jpg)
4. Закройте вкладку, содержащую базы данных.

## <a name="displaying-data-from-a-database"></a>Отображение данных из базы данных

После того, как база данных в ней, можно отобразить данные в веб-страницу ASP.NET. Чтобы выбрать строки таблицы для отображения, используйте инструкцию SQL, — это команда, передаваемого в базу данных.

1. В левой области щелкните **файлы** рабочей области.
2. В корневом веб-сайта, создайте новую страницу CSHTML с именем *ListProducts.cshtml*.
3. Замените существующую разметку следующей:

    [!code-cshtml[Main](5-working-with-data/samples/sample1.cshtml)]

    В первом блоке кода, откройте *SmallBakery.sdf* файла (база данных), созданного ранее. `Database.Open` Метод предполагает, что *.sdf* файл находится в веб-сайте *приложения\_данные* папки. (Обратите внимание, что не нужно указывать *.sdf* &#8212; расширения на самом деле, в противном случае `Open` метод не работает.)

    > [!NOTE]
    > *Приложения\_данные* папка является особой папке ASP.NET, которая используется для хранения файлов данных. Дополнительные сведения см. в разделе [соединения с базой данных](#SB_ConnectingToADatabase) далее в этой статье.

    Затем выполните запрос в базе данных, используя следующий запрос SQL `Select` инструкции:

    [!code-sql[Main](5-working-with-data/samples/sample2.sql)]

    В операторе `Product` определяет таблицу для запроса. `*` Знак указывает, что запрос должен возвращать все столбцы из таблицы. (Можно также указать столбцы по отдельности, разделенных запятыми, если нужно увидеть только некоторых столбцов.) `Order By` Предложение указывает порядок сортировки данных &#8212; в этом случае по *имя* столбца. Это означает, что данные отсортированы в алфавитном порядке на основе значения из *имя* столбца для каждой строки.

    В основной области страницы разметка создает таблицу HTML, который будет использоваться для отображения данных. Внутри `<tbody>` элемент, используйте `foreach` цикла искомое по отдельности каждой строки данных, возвращаемых запросом. Для каждой строки данных, создать строку таблицы HTML (`<tr>` элемент). После этого создается ячеек HTML-таблицы (`<td>` элементы) для каждого столбца. Каждый раз при переходе через цикл следующую доступную строку из базы данных находится в `row` переменной (настройте это в `foreach` инструкции). Для получения отдельного столбца в строке, можно использовать `row.Name` или `row.Description` или любое имя — столбца.
4. Запустите страницу в браузере. (Убедитесь, что выбран страницы **файлы** рабочей области, прежде чем запускать его.) На странице отображается список следующим образом:

    ![[image]](5-working-with-data/_static/image4.jpg)

> [!TIP] 
> 
> **Язык SQL (SQL)**
> 
> SQL — это язык, который используется в большинстве реляционных баз данных для управления данными в базе данных. Он включает в себя команды, которые позволяют получать данные и обновить его, а, позволяют создавать, изменять и управлять таблицами базы данных. SQL отличается от языка программирования (например, тот, который вы используете в WebMatrix) так, как с помощью SQL, идея заключается в том определить базу данных, выберите это задание базы данных, чтобы понять, как получить данные или выполнять задачи. Ниже приведены примеры некоторых команд SQL и их функции.
> 
> `SELECT Id, Name, Price FROM Product WHERE Price > 10.00 ORDER BY Name`
> 
> Извлекает это *идентификатор*, *имя*, и *цены* столбцы из записей в *продукта* таблица, если значение *цены* превышает 10 и возвращает результаты в алфавитном порядке по значениям *имя* столбца. Эта команда возвращает результирующий набор, который содержит записи, которые соответствуют критериям, или пустой набор, если нет записей, соответствующих.
> 
> `INSERT INTO Product (Name, Description, Price) VALUES ("Croissant", "A flaky delight", 1.99)`
> 
> Этот метод вставляет новую запись в *продукта* таблице, задание *имя* столбец &quot;круассан&quot;, *описание* столбец &quot; Подключением комфорт&quot;и цена 1,99.
> 
> `DELETE FROM Product WHERE ExpirationDate < "01/01/2008"`
> 
> Эта команда удаляет записи в *продукта* таблицы, которой столбец даты окончания срока действия предшествует 1 января 2008 года. (Предполагается, что *продукта* таблица имеет такой столбец, конечно.) Здесь вводится дата в формате мм/дд/гггг, но его следует вводить в формате, который используется для используемого языкового стандарта.
> 
> `Insert Into` И `Delete` команды не возвращают результирующие наборы. Вместо этого они возвращают число, которое показывает, сколько записей, затронутых командой.
> 
> Для некоторых из этих операций (например, вставка и удаление записей) процесс, который запрашивает операцию должна иметь соответствующие разрешения в базе данных. Именно поэтому для рабочих баз данных, обычно требуется указать имя пользователя и пароль при подключении к базе данных.
> 
> Существует множество команд SQL, но все они соответствуют шаблону следующим образом. Можно использовать команды SQL для создания таблиц базы данных, число записей в таблице, расчет цен и выполнять многие другие операции.


## <a name="inserting-data-in-a-database"></a>Вставка данных в базе данных

В этом разделе показано, как создать страницу, которая позволяет пользователям добавлять новый продукт на *продукта* таблицы базы данных. После вставки новой записи продукта на странице отображаются обновленные таблицы с помощью *ListProducts.cshtml* страницу, созданную в предыдущем разделе.

Страница включает проверку, чтобы убедиться в правильности данных, вводимых пользователем базы данных. Например код на странице гарантирует, что для всех обязательных столбцов было введено значение.

1. В веб-сайта, создайте новый файл CSHTML *InsertProducts.cshtml*.
2. Замените существующую разметку следующей:

    [!code-cshtml[Main](5-working-with-data/samples/sample3.cshtml)]

    Основная часть страницы содержит HTML-формы с тремя текстовыми полями, позволяющих пользователям вводить имя, описание и цену. Когда пользователь нажимает кнопку **вставить** кнопка, код в верхней части страницы открывает соединение с *SmallBakery.sdf* базы данных. Затем получите значения, которые пользователь отправил с помощью `Request` объекта и назначить эти значения локальным переменным.

    Чтобы проверить, что пользователь ввел значение для каждого требуемого столбца, зарегистрируйте каждый `<input>` элемент, который нужно проверить:

    [!code-csharp[Main](5-working-with-data/samples/sample4.cs)]

    `Validation` Вспомогательные проверяет это значение в каждом из полей, которые зарегистрированы. Проверка всех полей прошла проверку, проверив `Validation.IsValid()`, который обычно выполняется перед обработкой сведения, получаемые от пользователя:

    [!code-csharp[Main](5-working-with-data/samples/sample5.cs)]

    ( `&&` Означает оператор AND — данный тест *Если отправки формы и все поля прошли проверку*.)

    Если были проверены все столбцы (ни один не пустой), можно пойти дальше и создать инструкцию SQL для вставки данных, а затем выполните его, как показано далее:

    [!code-csharp[Main](5-working-with-data/samples/sample6.cs)]

    Для вставки значений, то местозаполнителями параметров (`@0`, `@1`, `@2`).

    > [!NOTE]
    > По соображениям безопасности всегда передайте значения в инструкцию SQL, с помощью параметров, как показано в предыдущем примере. Это дает возможность проверять данные пользователя, а также помогает обеспечить защиту от попыток отправки вредоносных команд базы данных (иногда называют атак путем внедрения кода SQL).

    Чтобы выполнить запрос, используйте эту инструкцию, передав ему переменные, содержащие значения для замены заполнителей:

    [!code-csharp[Main](5-working-with-data/samples/sample7.cs)]

    После `Insert Into` выполнения инструкции, отправить пользователю на страницу, в которой перечислены продукты, с помощью этой строки:

    [!code-javascript[Main](5-working-with-data/samples/sample8.js)]

    Если не удалось выполнить проверку, то пропустить инструкции insert. Вместо этого у вас есть модуль поддержки на странице для отображения сообщений Накопленные ошибки (если таковые имеются):

    [!code-cshtml[Main](5-working-with-data/samples/sample9.cshtml)]

    Обратите внимание, что блок стиля в разметке содержит определения класса CSS, с именем `.validation-summary-errors`. Это имя класса CSS, используемого по умолчанию для `<div>` элемент, содержащий все ошибки проверки. В этом случае класс CSS указывает Сводка ошибок и проверки, отображаются красным цветом, отмеченную полужирным шрифтом, но можно определить `.validation-summary-errors` класс, чтобы отобразить все элементы форматирования, вам нравится.

### <a name="testing-the-insert-page"></a>Тестирование страницы вставки

1. Просмотрите страницу в браузере. Страница отображает форму, похожий на тот, который показан на следующем рисунке.

    ![[image]](5-working-with-data/_static/image5.jpg)
2. Введите значения для всех столбцов, но необходимо убедиться, что оставить *цены* пустой столбец.
3. Нажмите кнопку **Вставить**. На странице отображается сообщение об ошибке, как показано на следующем рисунке. (Нет новая запись не создается).

    ![[image]](5-working-with-data/_static/image6.jpg)
4. Полностью заполнить форму и нажмите кнопку **вставить**. На этот раз *ListProducts.cshtml* страница отображается и показывает новой записи.

## <a name="updating-data-in-a-database"></a>Обновление данных в базе данных

После ввода данных в таблицу может потребоваться для его обновления. Эта процедура показано, как создать две страницы, которые похожи на те, которые вы создали для вставки данных в более ранних версий. Первая страница отображает продукты и пользователи могут выбрать одно изменение. Вторая страница предназначена для пользователей фактически внести изменения и сохранить их.

> [!NOTE] 
> 
> **Важные** в рабочий веб-сайт, вы обычно ограничивать доступ для внесения изменений в данные. Сведения о настройке членства и способы авторизации пользователей для выполнения задач на сайте см. в разделе [Добавление безопасности и членство для узла веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202904).


1. В веб-сайта, создайте новый файл CSHTML *EditProducts.cshtml*.
2. Замените существующую разметку в файле следующим кодом:

    [!code-cshtml[Main](5-working-with-data/samples/sample10.cshtml)]

    Единственное различие между этой страницы и *ListProducts.cshtml* страницы из более ранней версии, включающее дополнительный столбец, отображающий HTML-таблицы на этой странице **изменить** ссылку. Если щелкнуть эту ссылку, необходимое для *UpdateProducts.cshtml* страницы (которая будет создан далее) где можно изменить выбранную запись.

    Посмотрите на код, создающий **изменить** ссылку:

    [!code-cshtml[Main](5-working-with-data/samples/sample11.cshtml)]

    Это создает HTML- `<a>` элемент которого `href` динамически установлен атрибут. `href` Атрибут задает страницы для отображения, когда пользователь щелкает ссылку. Он также передает `Id` значение текущей строки, по ссылке. При выполнении страницы, исходный код страницы может содержать ссылки, подобные этим:

    [!code-html[Main](5-working-with-data/samples/sample12.html)]

    Обратите внимание, что `href` атрибута задано значение `UpdateProducts/n`, где  *n*  номер продукта. Когда пользователь нажимает одну из этих ссылок, полученный URL-адрес будет выглядеть примерно следующим образом:

    `http://localhost:18816/UpdateProducts/6`

    Другими словами номер продукта, который нужно изменить будут передаваться в URL-АДРЕСЕ.
3. Просмотрите страницу в браузере. На странице отображаются данные в формате следующим образом.

    ![[image]](5-working-with-data/_static/image7.jpg)

    Затем вы создадите страницу, которая позволяет пользователям фактически обновление данных. Страница обновления включает проверку для проверки данных, вводимых пользователем. Например код на странице гарантирует, что для всех обязательных столбцов было введено значение.
4. В веб-сайта, создайте новый файл CSHTML *UpdateProducts.cshtml*.
5. Замените существующую разметку в файле следующим кодом.

    [!code-cshtml[Main](5-working-with-data/samples/sample13.cshtml)]

    Текст страницы содержит HTML-формы, где отображается продукта и где можно изменить его. Чтобы получить продукта для отображения, используйте следующую инструкцию SQL:

    [!code-sql[Main](5-working-with-data/samples/sample14.sql)]

    При этом будут выбраны продукта, идентификатор которого соответствует значению, которое передается в `@0` параметра. (Поскольку *идентификатор* имеет первичный ключ и поэтому должен быть уникальным, запись только одного продукта никогда не могут быть выбраны таким образом.) Чтобы получить значение идентификатора для передачи это `Select` инструкции, можно считывать значение, которое передается на страницу как часть URL-адрес, используя следующий синтаксис:

    [!code-csharp[Main](5-working-with-data/samples/sample15.cs)]

    Чтобы фактически выборки записи продукта, используйте `QuerySingle` метод, который возвращает только одну запись:

    [!code-csharp[Main](5-working-with-data/samples/sample16.cs)]

    Отдельная строка возвращается в `row` переменной. Можно получить данные из каждого столбца и назначить его локальных переменных следующим образом:

    [!code-csharp[Main](5-working-with-data/samples/sample17.cs)]

    В разметке формы эти значения автоматически отображаются в отдельные текстовые поля с помощью внедренный код, аналогичный следующему:

    [!code-html[Main](5-working-with-data/samples/sample18.html)]

    Этот фрагмент кода отображает записи обновляемого продукта. После отображения записи пользователь может редактировать отдельных столбцов.

    Когда пользователь отправляет форму, нажав кнопку **обновление** кнопку код в `if(IsPost)` блок. Возвращает значения пользователя из `Request` , сохраняет значения переменных и проверяет, что каждый столбец было заполнено. Если проверка проходит, код создает следующие инструкции SQL Update:

    [!code-sql[Main](5-working-with-data/samples/sample19.sql)]

    В SQL `Update` statement, указать для обновления и значение, задаваемое каждого столбца. В этом коде значения задаются с помощью параметров-местозаполнителей `@0`, `@1`, `@2`, и т. д. (Как уже отмечалось ранее, для обеспечения безопасности следует всегда передавать значения в инструкции SQL с помощью параметров.)

    При вызове `db.Execute` метод, можно передавать переменные, содержащие значения в порядке, который соответствует параметрам в инструкцию SQL:

    [!code-csharp[Main](5-working-with-data/samples/sample20.cs)]

    После `Update` инструкция была выполнена, для перенаправления пользователя на страницу редактирования вызвать следующий метод:

    [!code-cshtml[Main](5-working-with-data/samples/sample21.cshtml)]

    Такой же эффект, пользователь увидит обновленный перечень данных в базе данных и редактируются другого продукта.
6. Сохраните страницу.
7. Запустите *EditProducts.cshtml* страницы (не на странице "обновления"), а затем нажмите кнопку **изменить** выбрать продукт для редактирования. *UpdateProducts.cshtml* отображается страница, показывающая запись, вы выбрали.

    ![[image]](5-working-with-data/_static/image8.jpg)
8. Внесите изменения и нажмите кнопку **обновление**. Список продуктов снова становится видимым с обновленные данные.

## <a name="deleting-data-in-a-database"></a>Удаление данных из базы данных

В этом разделе показано, как пользователи могут удалить продукт из *продукта* таблицы базы данных. Пример состоит из двух страниц. На первой странице пользователям выбрать запись для удаления. На второй странице, которое позволит им подтверждение для удаления записи отображается запись для удаления.

> [!NOTE] 
> 
> **Важные** в рабочий веб-сайт, вы обычно ограничивать доступ для внесения изменений в данные. Сведения о настройке членства и способа авторизации пользователю выполнять задачи на сайте см. в разделе [Добавление безопасности и членство для узла веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202904).


1. В веб-сайта, создайте новый файл CSHTML *ListProductsForDelete.cshtml*.
2. Замените существующую разметку следующей:

    [!code-cshtml[Main](5-working-with-data/samples/sample22.cshtml)]

    Эта страница похож на *EditProducts.cshtml* страницы из более ранних версий. Однако вместо отображения **изменить** ссылки для каждого продукта, она отображает **удалить** ссылку. **Удалить** ссылка создается с помощью следующих внедренный код в разметке:

    [!code-cshtml[Main](5-working-with-data/samples/sample23.cshtml)]

    Это создает URL-адрес, который выглядит следующим образом, когда пользователь щелкает ссылку:

    `http://<server>/DeleteProduct/4`

    URL-адрес вызывает страницу с именем *DeleteProduct.cshtml* (который будет создан далее) и передает его идентификатор продукта для удаления (в данном случае 4).
3. Сохраните файл, но оставить его открытым.
4. Создайте другой файл CHTML с именем *DeleteProduct.cshtml*. Замените существующее содержимое следующим кодом:

    [!code-cshtml[Main](5-working-with-data/samples/sample24.cshtml)]

    Эта страница вызывается *ListProductsForDelete.cshtml* и позволяет пользователям подтверждать, что они хотят удалить продукт. Чтобы вывести список продуктов для удаления, получить идентификатор продукта для удаления из URL-адрес с помощью следующий код:

    [!code-csharp[Main](5-working-with-data/samples/sample25.cs)]

    Страница затем запрашивает у пользователя нажмите кнопку, чтобы удалить запись. Эта мера безопасности: при выполнении конфиденциальных операций веб-сайта, как обновлять или удалять данные, эти операции всегда должно выполняться с помощью операции POST, а не операция GET. Если сайт настроен так, что операции удаления выполняются с помощью операции GET, любой пользователь может передать URL-адрес: `http://<server>/DeleteProduct/4` и удалять любые сведения из базы данных. Добавив подтверждение и кодирование страницы, чтобы удаление можно выполнить только с помощью POST, добавьте меру безопасности для веб-узла.

    Выполняется операция фактическое удаление, используя следующий код, который сначала подтверждает, что это операции post и идентификатор не является пустым:

    [!code-csharp[Main](5-working-with-data/samples/sample26.cs)]

    Код выполняет инструкцию SQL, которая удаляет указанную запись и перенаправляет пользователя на страницу списка.
5. Запустите *ListProductsForDelete.cshtml* в браузере.

    ![[image]](5-working-with-data/_static/image9.jpg)
6. Нажмите кнопку **удалить** ссылку для одного из этих продуктов. *DeleteProduct.cshtml* -страница подтверждения удаления этой записи.
7. Нажмите кнопку **удалить** кнопки. Удалить запись о продукте и страница обновляется с перечислением обновленного продукта.

> [!TIP] 
> 
> <a id="SB_ConnectingToADatabase"></a>
> ### <a name="connecting-to-a-database"></a>Подключение к базе данных
> 
> Можно подключиться к базе данных двумя способами. Первый заключается в использовании `Database.Open` метод и указать имя файла базы данных (меньше *.sdf* расширение):
> 
> `var db = Database.Open("SmallBakery");`
> 
> `Open` Метод предполагает, что. *SDF* файл находится на веб-сайте *приложения\_данные* папки. Эта папка предназначена специально для хранения данных. Например он имеет соответствующие разрешения, чтобы разрешить веб-сайт для чтения и записи данных, и из соображений безопасности, WebMatrix не разрешает доступ к файлам из этой папки.
> 
> Вторым способом является использование строки подключения. Строка подключения содержит сведения о подключении к базе данных. Это может быть путь к файлу или его можно включить имя базы данных SQL Server на локальном или удаленном сервере, а также имя пользователя и пароль для подключения к этому серверу. (Если данные хранятся в централизованной версии SQL Server, например на сайте поставщика услуг размещения, всегда используется строка подключения Указание сведений о подключении базы данных.)
> 
> В WebMatrix, строки подключения обычно хранятся в XML-файл с именем *Web.config*. Как следует из имен, вы можете использовать *Web.config* файл в корневом каталоге веб-сайта для хранения сведений о конфигурации сайта, включая любые строки подключения, которые могут потребовать вашего сайта. Пример строки подключения в *Web.config* файла может выглядеть следующим образом:
> 
> [!code-xml[Main](5-working-with-data/samples/sample27.xml)]
> 
> В примере строка подключения указывает на базу данных в экземпляре SQL Server, на котором выполняется на сервере, где-либо (в отличие от локального *.sdf* файла). Необходимо заменить на соответствующие имена для `myServer` и `myDatabase`и укажите значения имени входа SQL Server для `username` и `password`. (Значения имени пользователя и пароля не обязательно являются одинаковыми как учетные данные Windows или как значения, которые поставщик услуг хостинга предоставил вам для входа на их серверах. Обратитесь к администратору для точных значений, что нужно.)
> 
> `Database.Open` Метод обеспечивает высокую гибкость, так как позволяет передать имя базы данных *.sdf* файла или имя строки подключения, которая хранится в *Web.config* файла. В следующем примере показано, как подключиться к базе данных с помощью строки подключения, показано в предыдущем примере:
> 
> [!code-cshtml[Main](5-working-with-data/samples/sample28.cshtml)]
> 
> Как уже отмечалось, `Database.Open` позволяет передать имя базы данных или строку подключения, и он будет выяснить, который следует использовать. Это очень полезно при развертывании (публикации) веб-сайта. Можно использовать *.sdf* файла в *приложения\_данные* папки при разработке и тестировании веб-узла. При перемещении сайта на рабочем сервере, можно использовать строку подключения в *Web.config* файл с тем же именем, что ваш *.sdf* файл, но который указывает поставщика услуг размещения базы данных & # 8212; все это без внесения изменений в коде.
> 
> И, наконец, если требуется работать непосредственно со строкой соединения, можно вызвать `Database.OpenConnectionString` метод и передайте его строка фактическое соединения не только имя одного из объектов в *Web.config* файла. Это может быть полезно в ситуациях, где по некоторым причинам не имеют доступ к строке подключения (или значения, такие как *.sdf* имя файла) пока не начнется выполнение страницы. Однако в большинстве случаев можно использовать `Database.Open` как описано в этой статье.


## <a name="additional-resources"></a>Дополнительные ресурсы

- [SQL Server Compact](https://www.microsoft.com/sqlserver/2008/en/us/compact.aspx)
- [Подключение к SQL Server или база данных MySQL в WebMatrix](https://go.microsoft.com/fwlink/?LinkId=208661)
- [Проверка пользовательского ввода в веб-страницы узлов ASP.NET](https://go.microsoft.com/fwlink/?LinkId=253002)
