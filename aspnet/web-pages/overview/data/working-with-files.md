---
uid: web-pages/overview/data/working-with-files
title: Работа с файлами в сайт ASP.NET Web Pages (Razor) | Документы Microsoft
author: tfitzmac
description: В этой главе объясняется, как для чтения, записи, добавление, удаление и передачи файлов.
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2014
ms.topic: article
ms.assetid: eee916e4-ba4c-439a-a24e-68df7d45a569
ms.technology: dotnet-webpages
ms.prod: .net-framework
msc.legacyurl: /web-pages/overview/data/working-with-files
msc.type: authoredcontent
ms.openlocfilehash: 0f119f8fb4873e55292203f21a2efd8f26793ae4
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/10/2018
ms.locfileid: "28040227"
---
<a name="working-with-files-in-an-aspnet-web-pages-razor-site"></a>Работа с файлами в веб-страницы (Razor) узла ASP.NET
====================
по [Tom FitzMacken](https://github.com/tfitzmac)

> В этой статье объясняется, как для чтения, записи, добавления, удаления и отправить файлы на сайте ASP.NET Web Pages (Razor).
> 
> > [!NOTE]
> > Если вы хотите отправить изображения и управлять ими в (например, отражение или изменять их размер). в разделе [работа с изображениями в узел веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202897).
> 
> 
> **Что вы узнаете следующее.** 
> 
> - Способы создания текстового файла и запись данных в него.
> - Как добавить данные в существующий файл.
> - Как чтение файла и отобразить его.
> - Как удалить файлы с веб-сайта.
> - Как предоставить пользователям Отправка одного или нескольких файлов.
> 
> Ниже перечислены возможности, представленные в статье программирования ASP.NET:
> 
> - `File` Объект, который предоставляет способ для управления файлами.
> - `FileUpload` Вспомогательные.
> - `Path` Объект, который предоставляет методы, позволяющие управлять путь и имена файлов.
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемая в этом учебнике
> 
> 
> - Веб-страниц ASP.NET (Razor) 2
> - WebMatrix 2
>   
> 
> Этот учебник также работает с WebMatrix 3.


<a id="Creating_a_Text_File"></a>
## <a name="creating-a-text-file-and-writing-data-to-it"></a>Создание текстового файла и запись данных в него

Помимо использования базы данных в веб-сайта, может работать с файлами. Например можно использовать текстовые файлы как простой способ хранения данных для сайта. (Иногда называется текстовый файл, который используется для хранения данных *неструктурированного файла*.) Текстовые файлы можно представлять в различных форматах, например *.txt*, *.xml*, или *.csv* (значения с разделителями запятыми).

Если вы хотите сохранить данные в текстовый файл, можно использовать `File.WriteAllText` метод для указания имени файла для создания и записи в него данные. В этой процедуре вы создадите страницу, которая содержит простой формы с тремя `input` элементы (имя, фамилию и адрес электронной почты) и **отправить** кнопки. Когда пользователь отправляет форму, введенные пользователем данные будут храниться в текстовом файле.

1. Создайте новую папку с именем *приложения\_данные*, если он уже не существует.
2. В корневой веб-сайта, создайте новый файл с именем *UserData.cshtml*.
3. Замените существующее содержимое следующим кодом: 

    [!code-cshtml[Main](working-with-files/samples/sample1.cshtml)]

    HTML-разметка создает формы с тремя текстовыми полями. В коде, используйте `IsPost` свойство, чтобы определить, является ли страница была отправлена перед началом обработки.

    Первой задачей является ввод пользователя и назначьте его переменных. Затем код объединяет значения отдельных переменных в одну строку с разделителями запятыми, который сохраняется в отдельной переменной. Обратите внимание, что разделителем в виде запятой строку в кавычки («,»), так как запятая в больших строку, которую вы создаете буквально шрифтов. Добавьте в конце данных, которые можно объединять друг с другом, `Environment.NewLine`. При этом добавляется символ новой строки (символ перевода строки). Выполняется создание с помощью этого объединения — это строка, выглядит следующим образом:

    [!code-css[Main](working-with-files/samples/sample2.css)]

    (С невидимой разрыв строки в конце.)

    Затем создается переменная (`dataFile`), содержащий расположение и имя файла для хранения данных. Настройка расположения требует некоторых специальной обработки. В веб-сайтов, — плохая практика для ссылки в коде в абсолютные пути как *C:\Folder\File.txt* для файлов на веб-сервере. Если веб-сайт перемещается абсолютный путь будет неверным. Кроме того для размещенного веб-узла (а не на локальном компьютере) вы обычно даже неизвестен правильный путь при написании кода.

    Но иногда (например, теперь для записи в файл), вам нужен полный путь. Решение заключается в использовании `MapPath` метод `Server` объекта. Возвращает полный путь к веб-сайту. Для получения пути для корневого веб-сайта, пользователь `~` оператор (для represen узла виртуального корневого) для `MapPath`. (Можно также передать имя вложенной папки, например *~/App\_данных /*, чтобы получить путь к этой вложенной папке.) Затем можно объединить Дополнительные сведения на возвращает любой метод для создания полного пути. В этом примере добавляется имя файла. (Вы можете прочитать больше о работе с путями файлов и папок в [введение в ASP.NET Web Pages программирование с использованием синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkId=195205#ID_WorkingWithFileAndFolderPaths).)

    Файл сохраняется в *приложения\_данные* папки. Эта папка является особой папке ASP.NET, которая используется для хранения файлов данных, как описано в [введение в работу с базой данных в веб-узлы веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=195209).

    `WriteAllText` Метод `File` объекта записывает данные в файл. Этот метод принимает два параметра: имя (с путь) файла для записи и фактические данные для записи. Обратите внимание, что имя первого параметра имеет `@` символ в качестве префикса. Это сообщает ASP.NET, что вы указываете буквальная строка литерала и знаки, такие как «/» не должны интерпретироваться особым образом. (Дополнительные сведения см. в разделе [введение в ASP.NET веб-программирование с использованием синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkId=195205#ID_WorkingWithFileAndFolderPaths).)

    > [!NOTE]
    > Чтобы код, чтобы сохранять файлы в *приложения\_данные* папки, приложения должен разрешения на чтение запись для этой папки. На компьютере разработчика это не обычно проблему. Тем не менее при публикации сайта поставщика услуг размещения веб-сервере, может потребоваться явно задать эти разрешения. При выполнении этого кода на сервере поставщика услуг размещения и возникают ошибки, проверьте с помощью поставщика услуг размещения, чтобы узнать, как задать эти разрешения.

- Запустите страницу в браузере. 

    ![](working-with-files/_static/image1.jpg)
- Введите значения в поля и нажмите кнопку **отправить**.
- Закройте браузер.
- Вернитесь в проект и обновить представление.
- Откройте *data.txt* файла. В файле является данных, переданных в форме. 

    ![[image]](working-with-files/_static/image2.jpg)
- Закрыть *data.txt* файла.

<a id="Appending_Data"></a>
## <a name="appending-data-to-an-existing-file"></a>Добавление данных в существующий файл

В предыдущем примере использовался `WriteAllText` для создания текстового файла, который в нем есть лишь одна часть данных. Если снова вызвать метод и передать его тем же именем, существующий файл перезаписывается полностью. Однако после создания файла часто требуется добавлять новые данные в конец файла. Можно сделать при помощи этого `AppendAllText` метод `File` объекта.

1. На веб-сайте, создается копия *UserData.cshtml* файл и назовите ее *UserDataMultiple.cshtml*.
2. Замените блок кода перед открытием `<!DOCTYPE html>` тег с следующий блок кода: 

    [!code-cshtml[Main](working-with-files/samples/sample3.cshtml)]

    Этот код содержит одно из изменений из предыдущего примера. Вместо использования `WriteAllText`, он использует `the AppendAllText` метод. Аналогичны и методы, за исключением того, что `AppendAllText` добавляет данные в конец файла. Как и в `WriteAllText`, `AppendAllText` создает файл, если он еще не существует.
3. Запустите страницу в браузере.
4. Введите значения для полей и нажмите кнопку **отправить**.
5. Добавить дополнительные данные и снова отправьте ее.
6. Вернитесь в проект, щелкните правой кнопкой мыши папку проекта и нажмите кнопку **обновление**.
7. Откройте *data.txt* файла. Теперь в нем новые данные, только что введен. 

    ![[image]](working-with-files/_static/image3.jpg)

<a id="Reading_and_Displaying_Data"></a>
## <a name="reading-and-displaying-data-from-a-file"></a>Чтение и отображение данных из файла

Даже если не нужно записывать данные в текстовый файл, возможно, иногда необходимо считывать данные из одного. Чтобы сделать это, можно снова использовать `File` объекта. Можно использовать `File` объекта для чтения по отдельности каждой строки (разделенных разрывы строк) или для чтения отдельных элементов, независимо от того, как они разделены.

Эта процедура показано, как для чтения и отображения данных, созданный в предыдущем примере.

1. В корневой веб-сайта, создайте новый файл с именем *DisplayData.cshtml*.
2. Замените существующее содержимое следующим кодом: 

    [!code-cshtml[Main](working-with-files/samples/sample4.cshtml)]

    При чтении файла, созданного в предыдущем примере в переменной с именем начинается код `userData`, с помощью вызова этого метода:

    [!code-css[Main](working-with-files/samples/sample5.css)]

    Код для этого находится внутри `if` инструкции. Если вы хотите прочитать файл, рекомендуется использовать `File.Exists` метод, чтобы сначала определите, доступен ли файл. Код проверяет, является ли этот файл пуст.

    Основная часть страницы содержит два `foreach` циклы, вложенных друг друга. Внешний `foreach` цикла возвращает одну строку за раз в файле данных. В этом случае строки определяются разрывы строк в файле &#8212; каждого элемента данных является на отдельной строке. Внешний цикл будет создан новый элемент (`<li>` элемент) внутри упорядоченный список (`<ol>` элемент).

    Внутренний цикл каждой строки данных разбиваются на элементы (поля), через запятую в качестве разделителя. (На основании в предыдущем примере, это означает, что каждая строка содержит три поля &#8212; имя, фамилию и адрес электронной почты, отделенных друг от друга с помощью символа запятой.) Также создается внутренний цикл `<ul>` и список отображает один элемент для каждого поля в строке данных.

    Код показывает, как использовать два типа данных массива и `char` тип данных. Массив является обязательным, поскольку `File.ReadAllLines` метод возвращает данные в виде массива. `char` Тип данных является обязательным, поскольку `Split` возвращает `array` , в которой каждый элемент имеет тип `char`. (Сведения о массивах см. в разделе [введение в ASP.NET веб-программирование с использованием синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkId=202890#ID_CollectionsAndObjects).)
3. Запустите страницу в браузере. Отображаются данные, введенное для предыдущих примеров. 

    ![[image]](working-with-files/_static/image4.jpg)

> [!TIP] 
> 
> **Отображение данных из файла с разделителями запятыми Microsoft Excel**
> 
> Microsoft Excel можно использовать для сохранения данных, содержащихся в электронную таблицу в формате с разделителями запятыми (*.csv* файла). При этом файл сохраняется в виде обычного текста, а не в формате Excel. Каждая строка в таблице, разделенные разрыв строки в текстовый файл и каждого элемента данных, разделенные запятой. Код, показанный в предыдущем примере можно использовать для чтения файла с разделителями запятыми Excel только путем изменения имени файла данных в коде.


<a id="Deleting_Files"></a>
## <a name="deleting-files"></a>Удаление файлов

Чтобы удалить файлы с веб-сайта, можно использовать `File.Delete` метода. Ниже описан позволяет пользователю удалить изображение (*.jpg* файл) из *изображения* папки, если они знают имя файла.

> [!NOTE] 
> 
> **Важные** в рабочий веб-сайт, вы обычно ограничивать доступ для внесения изменений в данные. Сведения о настройке членства и способы авторизации пользователей для выполнения задач на сайте см. в разделе [Добавление безопасности и членство для узла веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202904).


1. На веб-сайте создать вложенную папку с именем *изображения*.
2. Копирование одного или нескольких *.jpg* файлы в *изображения* папки.
3. В корневом веб-сайта, создайте новый файл с именем *FileDelete.cshtml*.
4. Замените существующее содержимое следующим кодом: 

    [!code-cshtml[Main](working-with-files/samples/sample6.cshtml)]

    Эта страница содержит формы для ввода имени файла изображения. Они не вводите *.jpg* расширение имени файла; путем ограничения имени файла следующим образом, вы справки запрещает пользователям удалять произвольные файлы на вашем сайте.

    Код считывает имя файла, что пользователь ввел и затем создает полный путь. Для создания пути, в коде используется текущий путь веб-сайта (возвращенные `Server.MapPath` метод), *изображения* имя папки, имя, которое пользователь предоставил и «.jpg» как строковый литерал.

    Удаление файла, код вызывает метод `File.Delete` метод, передав ему полный путь, который только что создан. В конце разметки выводится сообщение с подтверждением удаления файла.
5. Запустите страницу в браузере. 

    ![[image]](working-with-files/_static/image5.jpg)
6. Введите имя файла для удаления и нажмите кнопку **отправить**. Если файл был удален, в нижней части страницы отображается имя файла.

<a id="Letting_Users_Upload_a_File"></a>
## <a name="letting-users-upload-a-file"></a>Разрешение пользователям передачи файла

`FileUpload` Вспомогательные позволяет отправить файлы на веб-сайт. Процедура ниже показано, как пользователи могут передать один файл.

1. Добавить библиотека вспомогательных методов ASP.NET Web веб-сайта, как описано в [Установка помощников в узел веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=252372), если не удалось добавить ранее.
2. В *приложения\_данные* папки, создайте новую папку и назовите его *UploadedFiles*.
3. В корневом, создайте новый файл с именем *FileUpload.cshtml*.
4. Замените существующее содержимое на странице с помощью следующего: 

    [!code-cshtml[Main](working-with-files/samples/sample7.cshtml)]

    Текст часть страницы использует `FileUpload` вспомогательный метод для создания, передачи и кнопки, возможно, вы знакомы с:

    ![[image]](working-with-files/_static/image6.jpg)

    Свойства, заданные для `FileUpload` вспомогательный укажите нужных одной коробке для файла для передачи и что «отправить» для чтения **отправить**. (Далее в этой статье будет добавить дополнительные поля.)

    Когда пользователь щелкает **отправить**, получает файл кода в верхней части страницы и сохраняет его. `Request` Объекта, который обычно используется для получения значений из полей формы также имеет `Files` массив, содержащий файл (или файлы) были отправлены. Вы можете получить отдельные файлы из определенной позиции в массиве &#8212; так, чтобы получить первый загруженный файл, вы получаете `Request.Files[0]`, чтобы получить второй файл, вы получаете `Request.Files[1]`, и т. д. (Помните, что в программировании подсчета обычно начинается с нуля).

    После извлечения загруженного файла, можно поместить его в переменной (здесь `uploadedFile`), чтобы можно было управлять ими. Чтобы определить имя отправленного файла, просто получить его `FileName` свойство. Тем не менее, в том случае, когда пользователь отправляет файл, `FileName` содержит исходное имя пользователя, который содержит весь путь. Он может выглядеть следующим образом:

    *C:\Users\Public\Sample.txt*

    Эти сведения пути, не следует, поскольку это путь на компьютере пользователя, не для вашего сервера. Необходимо просто фактическое имя файла (*Sample.txt*). Может удалять только файл по пути с помощью `Path.GetFileName` метод следующим образом:

    [!code-csharp[Main](working-with-files/samples/sample8.cs)]

    `Path` Объект представляет собой программу, имеет ряд методов, как это, можно использовать для удаления путей, объединение контуров и т. д.

    Все заработает имя отправленного файла, можно построить новый путь, для которой вы хотите сохранить загруженный файл веб-сайта. В этом случае можно объединить `Server.MapPath`, имена папок (*приложения\_данных/UploadedFiles*) и имя файла только что открытой, чтобы создать новый путь. Затем можно вызвать загруженный файл `SaveAs` метод фактически сохранения файла.
5. Запустите страницу в браузере. 

    ![[image]](working-with-files/_static/image7.jpg)
6. Нажмите кнопку **Обзор** и выберите файл для отправки. 

    ![[image]](working-with-files/_static/image8.jpg)

    Текстовое поле рядом с **Обзор** кнопка будет содержать путь и расположение.

    ![[image]](working-with-files/_static/image9.jpg)
7. Нажмите кнопку **Выгрузка**.
8. В веб-сайт, щелкните правой кнопкой мыши папку проекта и нажмите кнопку **обновление**.
9. Откройте *UploadedFiles* папки. Загруженный файл находится в папке. 

    ![[image]](working-with-files/_static/image10.jpg)

<a id="Letting_Users_Upload_Multiple_Files"></a>
## <a name="letting-users-upload-multiple-files"></a>Позволить пользователям отправить несколько файлов

В предыдущем примере то пользователи могут отправить один файл. Однако вы можете использовать `FileUpload` вспомогательный метод для отправки нескольких файлов одновременно. Это удобно для сценариев, таких как передачи фотографий, где трудоемкой загружать по одному файлу за раз. (Вы можете прочесть об передачи фотографий в [работа с изображениями в узел веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202897).) В этом примере показано, как пользователи могут отправить два за один раз, несмотря на то, что тот же метод можно использовать для отправки нечто большее.

1. Добавить библиотека вспомогательных методов ASP.NET Web веб-сайта, как описано в [Установка помощников в узел веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=252372), если это еще не сделано.
2. Создание новой страницы с именем *FileUploadMultiple.cshtml*.
3. Замените существующее содержимое на странице с помощью следующего:  

    [!code-cshtml[Main](working-with-files/samples/sample9.cshtml)]

    В этом примере `FileUpload` чтобы позволить пользователям загрузить два файла по умолчанию настроен вспомогательный в основной области страницы. Поскольку `allowMoreFilesToBeAdded` равно `true`, вспомогательный объект отображает ссылку, которая позволяет пользователю добавить дополнительные поля для передачи:

    ![[image]](working-with-files/_static/image11.jpg)

    Для обработки файлов, которые пользователь отправляет на сервер, код использует тот же базовый метод, который использовался в предыдущем примере &#8212; получить файл из `Request.Files` и сохраните его. (Включая различные действия необходимо выполнить, чтобы получить правильное имя файла и путь.) Инновации этого времени является, пользователь может отправки нескольких файлов, и вы не знаете многие. Чтобы узнать, можно получить `Request.Files.Count`.

    С этим номером в наличии, можно использовать цикл через `Request.Files`, в свою очередь выборки каждый файл и сохраните его. Когда следует включить в цикл известных несколько раз в коллекции, можно использовать `for` цикла следующим образом:

    [!code-csharp[Main](working-with-files/samples/sample10.cs)]

    Переменная `i` просто переходит от нуля до любой верхний предел, задать временные счетчика. В этом случае верхний предел составляет число файлов. Но так как счетчик начинается с нуля, что является типичным для подсчета сценариев в ASP.NET, верхний предел на самом деле один меньше, чем количество файлов. (Если загружаются три файла, значение счетчика равно нулю до 2.)

    `uploadedCount` Переменной суммирует все файлы, которые успешно загружен и сохранен. Этот код учитывается возможность того, что ожидаемый файл не сможет загрузить.
4. Запустите страницу в браузере. Браузер отображает страницу и его передачи два поля.
5. Выберите два файла для отправки.
6. Нажмите кнопку **добавьте другой файл**. На странице отображается новое поле передачи. 

    ![[image]](working-with-files/_static/image12.jpg)
7. Нажмите кнопку **Выгрузка**.
8. В веб-сайт, щелкните правой кнопкой мыши папку проекта и нажмите кнопку **обновление**.
9. Откройте *UploadedFiles* папку для просмотра файлов, успешно отправлен.

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>Дополнительные ресурсы


[Работа с изображениями в веб-страниц сайта ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202897)

[Экспорт в CSV-файл](https://msdn.microsoft.com/library/ms155919.aspx)
