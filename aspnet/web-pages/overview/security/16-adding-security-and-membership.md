---
uid: web-pages/overview/security/16-adding-security-and-membership
title: "Добавление безопасности и членство в ASP.NET Web Pages (Razor) сайта | Документы Microsoft"
author: tfitzmac
description: "В этой главе показано, как защитить веб-сайта таким образом, чтобы некоторые страницы доступны только для тех, кто вход. (Вы также увидите Создание tha страницы..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/24/2014
ms.topic: article
ms.assetid: 7a77c2c0-deea-4290-a9c3-97958891758e
ms.technology: dotnet-webpages
ms.prod: .net-framework
msc.legacyurl: /web-pages/overview/security/16-adding-security-and-membership
msc.type: authoredcontent
ms.openlocfilehash: af2eeb128cff554e7ae3d903e2117861087344e9
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2018
---
<a name="adding-security-and-membership-to-an-aspnet-web-pages-razor-site"></a><span data-ttu-id="2ed3c-104">Добавление безопасности и членство в ASP.NET веб-сайт страниц (Razor)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-104">Adding Security and Membership to an ASP.NET Web Pages (Razor) Site</span></span>
====================
<span data-ttu-id="2ed3c-105">по [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-105">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="2ed3c-106">В этой статье объясняется, как защитить несколько страниц, доступные только для пользователей, войдите на веб-сайт ASP.NET Web Pages (Razor).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-106">This article explains how to secure an ASP.NET Web Pages (Razor) website so that some of the pages are available only to people who log in.</span></span> <span data-ttu-id="2ed3c-107">(Вы также увидите Создание страниц, которые становятся доступным всем.)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-107">(You'll also see how to create pages that anyone can access.)</span></span>
> 
> <span data-ttu-id="2ed3c-108">**Что вы узнаете следующее.**</span><span class="sxs-lookup"><span data-stu-id="2ed3c-108">**What you'll learn:**</span></span> 
> 
> - <span data-ttu-id="2ed3c-109">Инструкции по созданию веб-сайт, который имеет страницу регистрации и входа в систему, поэтому для некоторых страниц можно ограничить доступ только элементам.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-109">How to create a website that has a registration page and a login page so that for some pages you can limit access to only members.</span></span>
> - <span data-ttu-id="2ed3c-110">Инструкции по созданию общих и доступны только для элемента страницы.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-110">How to create public and member-only pages.</span></span>
> - <span data-ttu-id="2ed3c-111">Определение роли, которые являются группами, которые имеют различные права на веб-узле, и как назначать роли пользователям.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-111">How to define roles, which are groups that have different security permissions on your site, and how to assign users to a role.</span></span>
> - <span data-ttu-id="2ed3c-112">Инструкции по использованию CAPTCHA для предотвращения создания элемента учетных записей автоматического программами (программы-роботы).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-112">How to use CAPTCHA to prevent automated programs (bots) from creating member accounts.</span></span>
>   
> 
> <span data-ttu-id="2ed3c-113">Существуют следующие функции ASP.NET, представленные в статье:</span><span class="sxs-lookup"><span data-stu-id="2ed3c-113">These are the ASP.NET features introduced in the article:</span></span>
> 
> - <span data-ttu-id="2ed3c-114">WebMatrix **начального сайта** шаблона.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-114">The WebMatrix **Starter Site** template.</span></span>
> - <span data-ttu-id="2ed3c-115">`WebSecurity` Вспомогательный и `Roles` класса.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-115">The `WebSecurity` helper and `Roles` class.</span></span>
> - <span data-ttu-id="2ed3c-116">`ReCaptcha` Вспомогательные.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-116">The `ReCaptcha` helper.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="2ed3c-117">Версии программного обеспечения, используемая в этом учебнике</span><span class="sxs-lookup"><span data-stu-id="2ed3c-117">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="2ed3c-118">Веб-страниц ASP.NET (Razor) 2</span><span class="sxs-lookup"><span data-stu-id="2ed3c-118">ASP.NET Web Pages (Razor) 2</span></span>
> - <span data-ttu-id="2ed3c-119">WebMatrix 3</span><span class="sxs-lookup"><span data-stu-id="2ed3c-119">WebMatrix 3</span></span>
> - <span data-ttu-id="2ed3c-120">Библиотека вспомогательных методов ASP.NET Web</span><span class="sxs-lookup"><span data-stu-id="2ed3c-120">ASP.NET Web Helpers Library</span></span>


<span data-ttu-id="2ed3c-121">Можно настроить веб-сайта, чтобы пользователи могут входить в &#8212; то есть, чтобы сайт поддерживает *членства*.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-121">You can set up your website so that users can log into it &#8212; that is, so that the site supports *membership*.</span></span> <span data-ttu-id="2ed3c-122">Это может быть удобно по многим причинам.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-122">This can be useful for many reasons.</span></span> <span data-ttu-id="2ed3c-123">Например у узла может быть страниц, которые должны быть доступны только для членов.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-123">For example, your site might have pages that should be available only to members.</span></span> <span data-ttu-id="2ed3c-124">В некоторых случаях может потребоваться пользователям входить в систему, чтобы отправить отзыв или оставьте комментарий.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-124">In some cases, you might require users to log in in order to send you feedback or leave a comment.</span></span>

<span data-ttu-id="2ed3c-125">Даже если веб-сайт поддерживает членства, пользователей и не обязательно требуется войти, прежде чем использовать некоторые страницы на сайте.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-125">Even if your website supports membership, users aren't necessarily required to log in before they use some of the pages on the site.</span></span> <span data-ttu-id="2ed3c-126">Пользователей, которые не вошли в называются *анонимным пользователям*.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-126">Users who aren't logged in are known as *anonymous users*.</span></span>

<span data-ttu-id="2ed3c-127">Пользователь может зарегистрировать на веб-сайт и может затем войдите на сайт.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-127">A user can register on your website and can then log in to the site.</span></span> <span data-ttu-id="2ed3c-128">Веб-сайт требует имя пользователя (адрес электронной почты) и пароль для подтверждения того, пользователи, себя выдает.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-128">The website requires a user name (an email address) and a password to confirm that users are who they claim to be.</span></span> <span data-ttu-id="2ed3c-129">Вход и подтверждение идентификатора пользователя этот процесс известен как *проверки подлинности*.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-129">This process of logging in and confirming a user's identity is known as *authentication*.</span></span>

<span data-ttu-id="2ed3c-130">Можно выполнить настройку безопасности и членство разными способами:</span><span class="sxs-lookup"><span data-stu-id="2ed3c-130">You can set up security and membership in different ways:</span></span>

- <span data-ttu-id="2ed3c-131">Если вы используете WebMatrix, легким способом является создание как новый сайт на основе **начального сайта** шаблона.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-131">If you're using WebMatrix, an easy way is to create as new site based on the **Starter Site** template.</span></span> <span data-ttu-id="2ed3c-132">Этот шаблон уже настроена для обеспечения безопасности и членство и уже страницу регистрации, страницы входа и т. д.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-132">This template is already configured for security and membership and already has a registration page, a login page, and so on.</span></span>

    <span data-ttu-id="2ed3c-133">Узел, созданный с помощью шаблона также имеет параметр, чтобы дать пользователям возможность выполнить вход с помощью внешнего узла как Facebook, Google, и Twitter.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-133">The site created by the template also has an option to let users log in using an external site like Facebook, Google, or Twitter.</span></span>
- <span data-ttu-id="2ed3c-134">Если вы хотите добавить к существующему сайту безопасности или если вы не хотите использовать **начального сайта** шаблона, можно создать собственную страницу регистрации, страницы входа и т. д.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-134">If you want to add security to an existing site, or if you don't want to use the **Starter Site** template, you can create your own registration page, login page, and so on.</span></span>

<span data-ttu-id="2ed3c-135">Эта статья посвящена первый вариант &mdash; Добавление безопасности с помощью **начального сайта** шаблона.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-135">This article focuses on the first option &mdash; how to add security by using the **Starter Site** template.</span></span> <span data-ttu-id="2ed3c-136">Он также предоставляет некоторые основные сведения о реализации собственного безопасности и затем предоставляет ссылки на дополнительные сведения о том, как сделать это.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-136">It also provides some basic information about how to implement your own security and then provides links to more information about how to do that.</span></span> <span data-ttu-id="2ed3c-137">Также есть сведения о способах включения внешних имен входа, который описан более подробно в отдельной статье.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-137">There is also information about how to enable external logins, which is described in more detail in a separate article.</span></span>

## <a name="creating-website-security-using-the-starter-site-template"></a><span data-ttu-id="2ed3c-138">Создание с помощью шаблона начальный узел безопасности веб-сайта</span><span class="sxs-lookup"><span data-stu-id="2ed3c-138">Creating Website Security Using the Starter Site Template</span></span>

<span data-ttu-id="2ed3c-139">В WebMatrix, можно использовать **начального сайта** шаблона для создания веб-сайта, который содержит следующее:</span><span class="sxs-lookup"><span data-stu-id="2ed3c-139">In WebMatrix, you can use the **Starter Site** template to create a website that contains the following:</span></span>

- <span data-ttu-id="2ed3c-140">База данных, используемая для хранения имен пользователей и паролей для членов.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-140">A database that's used to store user names and passwords for your members.</span></span>
- <span data-ttu-id="2ed3c-141">Страница регистрации, где можно зарегистрировать анонимных пользователей (новый).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-141">A registration page where anonymous (new) users can register.</span></span>
- <span data-ttu-id="2ed3c-142">Страница входа и выхода из системы.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-142">A login and logout page.</span></span>
- <span data-ttu-id="2ed3c-143">Страница восстановления и сброса пароля.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-143">A password recovery and reset page.</span></span>

<span data-ttu-id="2ed3c-144">Следующая процедура описывает, как создать сайт и настроить его.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-144">The following procedure describes how to create the site and configure it.</span></span>

1. <span data-ttu-id="2ed3c-145">Запуск WebMatrix и в **быстрый запуск** выберите **сайта из шаблона**.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-145">Start WebMatrix and in the **Quick Start** page, select **Site From Template**.</span></span>
2. <span data-ttu-id="2ed3c-146">Выберите **начального сайта** шаблона и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-146">Select the **Starter Site** template and then click **OK**.</span></span> <span data-ttu-id="2ed3c-147">WebMatrix создает новый сайт.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-147">WebMatrix creates a new site.</span></span>
3. <span data-ttu-id="2ed3c-148">В левой области щелкните **файлы** селектор рабочей области.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-148">In the left pane, click the **Files** workspace selector.</span></span>
4. <span data-ttu-id="2ed3c-149">В корневой папке веб-сайта, откройте  *\_AppStart.cshtml* файл, который является особым файлом, который содержит глобальные параметры.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-149">In the root folder of your website, open the *\_AppStart.cshtml* file, which is a special file that's used to contain global settings.</span></span> <span data-ttu-id="2ed3c-150">Она содержит некоторые инструкции, закомментированы с помощью `//` символов:</span><span class="sxs-lookup"><span data-stu-id="2ed3c-150">It contains some statements that are commented out using the `//` characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample1.cs)]

    <span data-ttu-id="2ed3c-151">Настройка этих инструкций `WebMail` вспомогательного приложения, который может использоваться для отправки электронной почты.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-151">These statements configure the `WebMail` helper, which can be used to send email.</span></span> <span data-ttu-id="2ed3c-152">Система членства может использовать электронной почты для отправки подтверждающих сообщений при регистрации пользователей или если нужно изменить свой пароль.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-152">The membership system can use email to send confirmation messages when users register or when they want to change their passwords.</span></span> <span data-ttu-id="2ed3c-153">(Например, после регистрации пользователей, получают сообщение электронной почты, содержащее ссылку, их можно щелкнуть, чтобы завершить процесс регистрации.)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-153">(For example, after users register, they get an email that includes a link that they can click in order to finish the registration process.)</span></span>

    <span data-ttu-id="2ed3c-154">Отправка электронной почты требуется доступ к SMTP-сервера, как описано в [Добавление электронной почты для узла веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202899).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-154">Sending email requires access to an SMTP server, as described in [Adding Email to an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=202899).</span></span> <span data-ttu-id="2ed3c-155">Параметры электронной почты будут храниться в этот центральный  *\_AppStart.cshtml* так, чтобы не нужно их код несколько раз на каждой странице, можно отправить по электронной почте.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-155">You'll store the email settings in this central *\_AppStart.cshtml* file so that you don't have to code them repeatedly into each page that can send email.</span></span> <span data-ttu-id="2ed3c-156">(Не нужно настроить параметры протокола SMTP для настройки регистрации базы данных требуется только параметры SMTP, если требуется проверять подлинность пользователей из их псевдоним электронной почты, пользователи могут сбросить забытый пароль.)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-156">(You don't need to configure SMTP settings to set up a registration database; you only need SMTP settings if you want to validate users from their email alias and let users reset a forgotten password.)</span></span>
5. <span data-ttu-id="2ed3c-157">Раскомментируйте инструкций, удалив `//` перед каждого из них.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-157">Uncomment the statements by removing `//` from in front of each one.</span></span>

    <span data-ttu-id="2ed3c-158">Если вы не хотите настроить подтверждение по электронной почте, можно пропустить этот шаг и следующий шаг.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-158">If you do not want to set up email confirmation, you can skip this step and the next step.</span></span> <span data-ttu-id="2ed3c-159">Если не заданы параметры SMTP, новая учетная запись немедленно доступно без подтверждения адреса электронной почты.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-159">If the SMTP values are not set, the new account is immediately available without a confirmation email.</span></span>
6. <span data-ttu-id="2ed3c-160">Измените следующие параметры с электронной почтой в коде:</span><span class="sxs-lookup"><span data-stu-id="2ed3c-160">Modify the following email-related settings in the code:</span></span>

    - <span data-ttu-id="2ed3c-161">Задать `WebMail.SmtpServer` имя SMTP-сервера, у вас есть право.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-161">Set `WebMail.SmtpServer` to the name of the SMTP server that you have access to.</span></span>
    - <span data-ttu-id="2ed3c-162">Оставить `WebMail.EnableSsl` значение `true`.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-162">Leave `WebMail.EnableSsl` set to `true`.</span></span> <span data-ttu-id="2ed3c-163">Этот параметр обеспечивает защиту учетных данных, отправляемых на сервер SMTP, путем их шифрования.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-163">This setting secures the credentials that are sent to the SMTP server by encrypting them.</span></span>
    - <span data-ttu-id="2ed3c-164">Задать `WebMail.UserName` к имени пользователя для учетной записи сервера SMTP.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-164">Set `WebMail.UserName` to the user name for your SMTP server account.</span></span>
    - <span data-ttu-id="2ed3c-165">Задать `WebMail.Password` пароль пользователя для учетной записи сервера SMTP.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-165">Set `WebMail.Password` to the password for your SMTP server account.</span></span>
    - <span data-ttu-id="2ed3c-166">Задать `WebMail.From` на собственный адрес электронной почты.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-166">Set `WebMail.From` to your own email address.</span></span> <span data-ttu-id="2ed3c-167">Это адрес электронной почты отправителя сообщения.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-167">This is the email address that the message is sent from.</span></span>

    > [!NOTE] 
    > 
    > <span data-ttu-id="2ed3c-168">**Совет** Дополнительные сведения о значениях для этих свойств см. в разделе [Настройка параметров электронной почты](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings) в [поведение Настройка сайта для веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkID=202906).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-168">**Tip** For additional information about the values for these properties, see [Configuring Email Settings](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings) in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkID=202906).</span></span>
7. <span data-ttu-id="2ed3c-169">Сохраните и закройте  *\_AppStart.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-169">Save and close *\_AppStart.cshtml*.</span></span>
8. <span data-ttu-id="2ed3c-170">Запустите *Default.cshtml* страницы в браузере.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-170">Run the *Default.cshtml* page in a browser.</span></span>

    ![безопасность членства-2](16-adding-security-and-membership/_static/image1.png)

    > [!NOTE]
    > <span data-ttu-id="2ed3c-172">Если появится сообщение об ошибке, информирующее о том, что свойство должно быть экземпляром `ExtendedMembershipProvider`, сайт не может быть настроен для использования системы членства веб-страниц ASP.NET (SimpleMembership).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-172">If you see an error that tells you that a property must be an instance of `ExtendedMembershipProvider`, the site might not be configured to use the ASP.NET Web Pages membership system (SimpleMembership).</span></span> <span data-ttu-id="2ed3c-173">Это может случиться, если по-другому, чем на локальном сервере настроен сервер поставщика услуг размещения.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-173">This can sometimes occur if a hosting provider's server is configured differently than your local server.</span></span> <span data-ttu-id="2ed3c-174">Чтобы устранить эту проблему, добавьте следующий элемент на сайт *Web.config* файла:</span><span class="sxs-lookup"><span data-stu-id="2ed3c-174">To fix this, add the following element to the site's *Web.config* file:</span></span>
    > 
    > [!code-xml[Main](16-adding-security-and-membership/samples/sample2.xml)]
    > 
    > <span data-ttu-id="2ed3c-175">Добавьте этот элемент в качестве дочернего элемента `<configuration>` элемент и как одноранговый по `<system.web>` элемента.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-175">Add this element as a child of the `<configuration>` element and as a peer of the `<system.web>` element.</span></span>
9. <span data-ttu-id="2ed3c-176">В правом верхнем углу страницы нажмите кнопку **зарегистрировать** ссылку.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-176">In the upper-right corner of the page, click the **Register** link.</span></span> <span data-ttu-id="2ed3c-177">*Register.cshtml* -страница.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-177">The *Register.cshtml* page is displayed.</span></span>
10. <span data-ttu-id="2ed3c-178">Введите имя пользователя и пароль и нажмите кнопку **зарегистрировать**.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-178">Enter a user name and password and then click **Register**.</span></span>

    ![безопасность членства-3](16-adding-security-and-membership/_static/image2.png)

    <span data-ttu-id="2ed3c-180">При создании веб-сайта из **начального сайта** шаблона, базу данных с именем *StarterSite.sdf* был создан на сайте *приложения\_данные* папки.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-180">When you created the website from the **Starter Site** template, a database named *StarterSite.sdf* was created in the site's *App\_Data* folder.</span></span> <span data-ttu-id="2ed3c-181">Во время регистрации сведения о пользователе добавляется в базу данных.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-181">During registration, your user information is added to the database.</span></span> <span data-ttu-id="2ed3c-182">Если задать значения SMTP используется, чтобы можно было завершить регистрации сообщение отправляется на адрес электронной почты.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-182">If you set the SMTP values, a message is sent to the email address you used so you can finish registering.</span></span>

    ![безопасность членства-4](16-adding-security-and-membership/_static/image3.png)
11. <span data-ttu-id="2ed3c-184">Перейдите в программу электронной почты и найти сообщение, который будет содержать код подтверждения и гиперссылку на сайт.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-184">Go to your email program and find the message, which will have your confirmation code and a hyperlink to the site.</span></span>
12. <span data-ttu-id="2ed3c-185">Щелкните гиперссылку, чтобы активировать свою учетную запись.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-185">Click the hyperlink to activate your account.</span></span> <span data-ttu-id="2ed3c-186">Подтверждение гиперссылка открывает страницу подтверждения регистрации.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-186">The confirmation hyperlink opens a registration confirmation page.</span></span>

    ![безопасность членства-5](16-adding-security-and-membership/_static/image4.png)
- <span data-ttu-id="2ed3c-188">Нажмите кнопку **входа** ссылку и снова войдите с помощью учетной записи, которое вы зарегистрировали.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-188">Click the **Login** link, and then log in using the account that you registered.</span></span>

    <span data-ttu-id="2ed3c-189">После входа в **входа** и **зарегистрировать** заменяются ссылками **выхода** ссылку.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-189">After you log in, the **Login** and **Register** links are replaced by a **Logout** link.</span></span> <span data-ttu-id="2ed3c-190">Имя для входа, отображаются в виде ссылки.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-190">Your login name is displayed as a link.</span></span> <span data-ttu-id="2ed3c-191">(Эта ссылка позволяет перейти на страницу, где можно изменить пароль.)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-191">(The link lets you go to a page where you can change your password.)</span></span>

    ![безопасность членства-6](16-adding-security-and-membership/_static/image5.png)

    > [!NOTE]
    > <span data-ttu-id="2ed3c-193">По умолчанию веб-страниц ASP.NET отправляет учетные данные на сервер в виде открытого текста (в виде удобочитаемого текста).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-193">By default, ASP.NET web pages send credentials to the server in clear text (as human-readable text).</span></span> <span data-ttu-id="2ed3c-194">Рабочего веб-сайта следует использовать защищенный HTTP (https://, также известные как *протокол SSL* или SSL) для шифрования секретной информации, которыми обмениваются с сервером.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-194">A production site should use secure HTTP (https://, also known as the *secure sockets layer* or SSL) to encrypt sensitive information that's exchanged with the server.</span></span> <span data-ttu-id="2ed3c-195">Вы можете электронной почты требуется отправлять сообщения с использованием SSL, установив `WebMail.EnableSsl=true` как в предыдущем примере.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-195">You can required email messages to be sent using SSL by setting `WebMail.EnableSsl=true` as in the previous example.</span></span> <span data-ttu-id="2ed3c-196">Дополнительные сведения о протоколе SSL см. в разделе [обеспечение безопасности веб-соединений: сертификаты SSL и https://](https://go.microsoft.com/fwlink/?LinkId=208660).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-196">For more information about SSL, see [Securing Web Communications: Certificates, SSL, and https://](https://go.microsoft.com/fwlink/?LinkId=208660).</span></span>

## <a name="additional-membership-functionality-in-the-site"></a><span data-ttu-id="2ed3c-197">Дополнительные членством на сайте</span><span class="sxs-lookup"><span data-stu-id="2ed3c-197">Additional Membership Functionality in the Site</span></span>

<span data-ttu-id="2ed3c-198">Данный узел содержит другие функции, позволяющие управлять их учетными записями пользователей.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-198">Your site contains other functionality that lets users manage their accounts.</span></span> <span data-ttu-id="2ed3c-199">Пользователи могут сделать следующее.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-199">Users can do the following:</span></span>

- <span data-ttu-id="2ed3c-200">Измените пароли.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-200">Change their passwords.</span></span> <span data-ttu-id="2ed3c-201">После входа в систему, он сможет щелкнуть имя пользователя (которое представляет собой ссылку).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-201">After logging in, they can click the user name (which is a link).</span></span> <span data-ttu-id="2ed3c-202">Это ведет к странице которой можно создать новый пароль (*Account/ChangePassword.cshtml*).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-202">This takes them to a page where they can create a new password (*Account/ChangePassword.cshtml*).</span></span>
- <span data-ttu-id="2ed3c-203">Восстановите забытый пароль.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-203">Recover a forgotten password.</span></span> <span data-ttu-id="2ed3c-204">На странице входа является ссылкой (**забыли пароль?**), принимающий пользователей на страницу (*Account/ForgotPassword.cshtml*) где они могут ввести адрес электронной почты.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-204">On the login page, there's a link (**Did you forget your password?**) that takes users to a page (*Account/ForgotPassword.cshtml*) where they can enter an email address.</span></span> <span data-ttu-id="2ed3c-205">Сайт отправляет их сообщение электронной почты, содержащее ссылку, их можно щелкнуть, чтобы задать новый пароль (*Account/PasswordReset.cshtml*).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-205">The site sends them an email message that has a link that they can click in order to set a new password (*Account/PasswordReset.cshtml*).</span></span>

<span data-ttu-id="2ed3c-206">Также можно предоставить пользователям можно также в систему с помощью внешнего узла, как описано ниже.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-206">You can also let users can also log in using an external site, as explained later.</span></span>

<a id="Creating_a_Members-Only_Page"></a>
## <a name="creating-a-members-only-page"></a><span data-ttu-id="2ed3c-207">Создание страницы только для членов</span><span class="sxs-lookup"><span data-stu-id="2ed3c-207">Creating a Members-Only Page</span></span>

<span data-ttu-id="2ed3c-208">На данный момент, любой пользователь, перейдите на любую страницу веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-208">For the time being, anyone can browse to any page in your website.</span></span> <span data-ttu-id="2ed3c-209">Однако может потребоваться страниц, которые доступны только пользователям, вошедшим в (то есть членам).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-209">But you might want to have pages that are available only to people who have logged in (that is, to members).</span></span> <span data-ttu-id="2ed3c-210">ASP.NET позволяет создавать страницы, которые можно осуществлять только члены вошедшего в систему.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-210">ASP.NET lets you create pages that can be accessed only by logged-in members.</span></span> <span data-ttu-id="2ed3c-211">Как правило если доступ к странице только для членов анонимных пользователей, вы перенаправит их на страницу входа.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-211">Typically, if anonymous users try to access a members-only page, you redirect them to the login page.</span></span>

<span data-ttu-id="2ed3c-212">В этой процедуре вы создадите папки, которая будет содержать страниц, которые доступны только для зарегистрированных пользователей.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-212">In this procedure, you'll create a folder that will contain pages that are available only to logged-in users.</span></span>

1. <span data-ttu-id="2ed3c-213">В корневом узле создайте новую папку.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-213">At the root of the site, create a new folder.</span></span> <span data-ttu-id="2ed3c-214">(На ленте щелкните стрелку, расположенную под **New** и выберите **новая папка**.)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-214">(In the ribbon, click the arrow underneath **New** and then choose **New Folder**.)</span></span>
2. <span data-ttu-id="2ed3c-215">Имя новой папки *элементы*.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-215">Name the new folder *Members*.</span></span>
3. <span data-ttu-id="2ed3c-216">Внутри *элементы* папки, создайте новую страницу с именем *MembersInformation.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-216">Inside the *Members* folder, create a new page and named it *MembersInformation.cshtml*.</span></span>
4. <span data-ttu-id="2ed3c-217">Замените существующее содержимое следующий код и разметку:</span><span class="sxs-lookup"><span data-stu-id="2ed3c-217">Replace the existing content with the following code and markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample3.cshtml)]

    <span data-ttu-id="2ed3c-218">Этот код проверяет `IsAuthenticated` свойство `WebSecurity` объекта, который возвращает `true` , если пользователь выполнил вход.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-218">This code tests the `IsAuthenticated` property of the `WebSecurity` object, which returns `true` if the user has logged in.</span></span> <span data-ttu-id="2ed3c-219">Если пользователь не выполнил вход, этот код вызывает `Response.Redirect` для отправки пользователю *Login.cshtml* страницы в *учетной записи* папки.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-219">If the user is not logged in, the code calls `Response.Redirect` to send the user to the *Login.cshtml* page in the *Account* folder.</span></span>

    <span data-ttu-id="2ed3c-220">URL-адрес перенаправления содержит `returnUrl` запрос строковое значение, которое использует `Request.Url.LocalPath` для присвоения пути к текущей страницы.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-220">The URL of the redirection includes a `returnUrl` query string value that uses `Request.Url.LocalPath` to set the path of the current page.</span></span> <span data-ttu-id="2ed3c-221">Если задать `returnUrl` значение в строке запроса следующим образом (и если возвращаемый URL-адрес является локальным путем), страница входа вернет пользователей на эту страницу после входа.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-221">If you set the `returnUrl` value in the query string like this (and if the return URL is a local path), the login page will return users to this page after they log in.</span></span>

    <span data-ttu-id="2ed3c-222">В этом коде также задаются  *\_SiteLayout.cshtml* страницу как его макет.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-222">The code also sets *\_SiteLayout.cshtml* page as its layout page.</span></span> <span data-ttu-id="2ed3c-223">(Дополнительные сведения о макете страницы см. в разделе [Создание согласованного макета в веб-узлы веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202891).)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-223">(For more about layout pages, see [Creating a Consistent Layout in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202891).)</span></span>
5. <span data-ttu-id="2ed3c-224">Запустите узел.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-224">Run the site.</span></span> <span data-ttu-id="2ed3c-225">Если вы по-прежнему входили, щелкните **выхода** кнопку в верхней части страницы.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-225">If you're still logged in, click the **Logout** button at the top of the page.</span></span>
6. <span data-ttu-id="2ed3c-226">В браузере запросите страницу */члены/MembersInformation*.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-226">In the browser, request the page */Members/MembersInformation*.</span></span> <span data-ttu-id="2ed3c-227">Например URL-адрес может выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="2ed3c-227">For example, the URL might look like this:</span></span>

    `http://localhost:38366/Members/MembersInformation`

    <span data-ttu-id="2ed3c-228">(Номер порта (38366), скорее всего, будет отличаются в URL-адрес.)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-228">(The port number (38366) will probably be different in your URL.)</span></span>

    <span data-ttu-id="2ed3c-229">Вы будете перенаправлены на *Login.cshtml* страницы, так как вы не вошли в.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-229">You're redirected to the *Login.cshtml* page, because you aren't logged in.</span></span>
- <span data-ttu-id="2ed3c-230">Войдите, используя учетную запись, созданную ранее.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-230">Log in using the account you created earlier.</span></span> <span data-ttu-id="2ed3c-231">Будет перенаправлен к *MembersInformation* страницы.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-231">You're redirected back to the *MembersInformation* page.</span></span> <span data-ttu-id="2ed3c-232">Так как вход настоящее время вы видите содержимое страницы.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-232">Because you're logged in, this time you see the page contents.</span></span>

<span data-ttu-id="2ed3c-233">Чтобы обеспечить безопасный доступ к нескольким страницам, это можно сделать:</span><span class="sxs-lookup"><span data-stu-id="2ed3c-233">To secure access to multiple pages, you can do this:</span></span>

- <span data-ttu-id="2ed3c-234">Добавьте проверку безопасности на каждой странице.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-234">Add the security check to each page.</span></span>
- <span data-ttu-id="2ed3c-235">Создание  *\_PageStart.cshtml* страницы в папке, где сохранить защищенные страницы и добавить существует проверки безопасности.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-235">Create a *\_PageStart.cshtml* page in the folder where you keep protected pages, and add the security check there.</span></span> <span data-ttu-id="2ed3c-236">*\_PageStart.cshtml* страницы действует в качестве глобального страницы для всех страниц в папке.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-236">The *\_PageStart.cshtml* page acts as a kind of global page for all the pages in the folder.</span></span> <span data-ttu-id="2ed3c-237">Этот способ является более подробно в [поведение Настройка сайта для веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-237">This technique is explained in more detail in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access).</span></span>

## <a name="creating-security-for-groups-of-users-roles"></a><span data-ttu-id="2ed3c-238">Создание системы безопасности для групп пользователей (роли)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-238">Creating Security for Groups of Users (Roles)</span></span>

<span data-ttu-id="2ed3c-239">Если узел содержит много элементов, не эффективным для проверки разрешений для каждого пользователя по отдельности, перед ее см. на странице.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-239">If your site has a lot of members, it's not efficient to check permission for each user individually before you let them see a page.</span></span> <span data-ttu-id="2ed3c-240">Вместо этого можно сделать — создавать группы, или *ролей*, что отдельные члены принадлежат.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-240">What you can do instead is to create groups, or *roles*, that individual members belong to.</span></span> <span data-ttu-id="2ed3c-241">Затем можно проверить разрешения на основе роли.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-241">You can then check permissions based on role.</span></span> <span data-ttu-id="2ed3c-242">В этом разделе вы создадите &quot;администратора&quot; роли, а затем создать страницы, доступной для пользователей, работающих в (которые входят в различные) этой роли.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-242">In this section, you'll create an &quot;admin&quot; role and then create a page that's accessible to users who are in (who belong to) that role.</span></span>

<span data-ttu-id="2ed3c-243">Система членства ASP.NET настроена для поддержки ролей.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-243">The ASP.NET membership system is set up to support roles.</span></span> <span data-ttu-id="2ed3c-244">Однако в отличие от регистрации членства и входа в систему **начального сайта** шаблон не содержит страницы, которые помогают управлять ролями.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-244">However, unlike membership registration and login, the **Starter Site** template does not contain pages that help you manage roles.</span></span> <span data-ttu-id="2ed3c-245">(Управление ролями является задачи администрирования, а не задачу пользователя.) Тем не менее можно добавлять группы непосредственно в базе данных членства в WebMatrix.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-245">(Managing roles is an administrative task rather than a user task.) However, you can add groups directly in the membership database in WebMatrix.</span></span>

1. <span data-ttu-id="2ed3c-246">В WebMatrix, щелкните **баз данных** селектор рабочей области.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-246">In WebMatrix, click the **Databases** workspace selector.</span></span>
2. <span data-ttu-id="2ed3c-247">В левой области откройте *StarterSite.sdf* открытым узлом **таблиц** узел, а затем дважды щелкните *веб-страниц\_ролей* таблицы.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-247">In the left pane, open the *StarterSite.sdf* node, open the **Tables** node, and then double-click the *webpages\_Roles* table.</span></span>

    ![безопасности, членства, 7](16-adding-security-and-membership/_static/image6.png)
3. <span data-ttu-id="2ed3c-249">Добавьте роль с именем &quot;администратора&quot;.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-249">Add a role named &quot;admin&quot;.</span></span> <span data-ttu-id="2ed3c-250">*RoleId* поле будет заполнено автоматически.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-250">The *RoleId* field is filled in automatically.</span></span> <span data-ttu-id="2ed3c-251">(Он является первичным ключом и ему было присвоено быть Идентификация поля, как описано в статье [введение в работу с базой данных в веб-узлы веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202893).)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-251">(It's the primary key and has been set to be an identify field, as explained in [Introduction to Working with a Database in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202893).)</span></span>
4. <span data-ttu-id="2ed3c-252">Обратите внимание что такое значение *RoleId* поля.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-252">Take note of what the value is for the *RoleId* field.</span></span> <span data-ttu-id="2ed3c-253">(Если это первая роль, которые вы определяете, она будет 1.)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-253">(If this is the first role you're defining, it will be 1.)</span></span>

    ![безопасность членства-8](16-adding-security-and-membership/_static/image7.png)
5. <span data-ttu-id="2ed3c-255">Закрыть *веб-страниц\_ролей* таблицы.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-255">Close the *webpages\_Roles* table.</span></span>
6. <span data-ttu-id="2ed3c-256">Откройте *UserProfile* таблицы.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-256">Open the *UserProfile* table.</span></span>
7. <span data-ttu-id="2ed3c-257">Запомните или запишите *UserId* значение одного или нескольких пользователей в таблице и затем закройте таблицу.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-257">Make a note of the *UserId* value of one or more of the users in the table and then close the table.</span></span>
8. <span data-ttu-id="2ed3c-258">Откройте *веб-страниц\_UserInRoles* таблицы и введите *UserID* и *RoleID* значение в таблицу.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-258">Open the *webpages\_UserInRoles* table and enter a *UserID* and a *RoleID* value into the table.</span></span> <span data-ttu-id="2ed3c-259">Например, чтобы поместить пользователя 2 в &quot;администратора&quot; роли, можно ввести эти значения:</span><span class="sxs-lookup"><span data-stu-id="2ed3c-259">For example, to put user 2 into the &quot;admin&quot; role, you'd enter these values:</span></span>

    ![безопасность членство — 9](16-adding-security-and-membership/_static/image8.png)
9. <span data-ttu-id="2ed3c-261">Закрыть *веб-страниц\_UsersInRoles* таблицы.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-261">Close the *webpages\_UsersInRoles* table.</span></span>

    <span data-ttu-id="2ed3c-262">Теперь, когда у вас есть определенные роли, можно настроить страницы, который доступен пользователям в этой роли.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-262">Now that you have roles defined, you can configure a page that's accessible to users who are in that role.</span></span>
10. <span data-ttu-id="2ed3c-263">В корневой папке веб-сайта, создайте новую страницу с именем *AdminError.cshtml* и заменить существующее содержимое следующим кодом.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-263">In the website root folder, create a new page named *AdminError.cshtml* and replace the existing content with the following code.</span></span> <span data-ttu-id="2ed3c-264">Это будет, если они не разрешен доступ к странице пользователи будут перенаправлены на страницу.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-264">This will be the page that users are redirected to if they aren't allowed access to a page.</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample4.cshtml)]
11. <span data-ttu-id="2ed3c-265">В корневой папке веб-сайта, создайте новую страницу с именем *AdminOnly.cshtml* и замените существующий код следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="2ed3c-265">In the website root folder, create a new page named *AdminOnly.cshtml* and replace the existing code with the following code:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample5.cshtml)]

    <span data-ttu-id="2ed3c-266">`Roles.IsUserInRole` Возвращает `true` Если текущий пользователь является членом указанной роли (в данном случае роль «Администратор»).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-266">The `Roles.IsUserInRole` method returns `true` if the current user is a member of the specified role (in this case, the "admin" role).</span></span>
12. <span data-ttu-id="2ed3c-267">Запустите *Default.cshtml* в браузере, но не заносить в журнал.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-267">Run *Default.cshtml* in a browser, but don't log in.</span></span> <span data-ttu-id="2ed3c-268">(Если вы уже вошли в, выйдите из системы.)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-268">(If you're already logged in, log out.)</span></span>
13. <span data-ttu-id="2ed3c-269">В адресной строке браузера добавьте *AdminOnly* в URL-АДРЕСЕ.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-269">In the browser's address bar, add *AdminOnly* in the URL.</span></span> <span data-ttu-id="2ed3c-270">(Другими словами, запрос *AdminOnly.cshtml* файл.) Вы будете перенаправлены на *AdminError.cshtml* страницы, так как вы не вошли в настоящее время в качестве пользователя в &quot;администратора&quot; роли.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-270">(In other words, request the *AdminOnly.cshtml* file.) You're redirected to the *AdminError.cshtml* page, because you aren't currently logged in as a user in the &quot;admin&quot; role.</span></span>
14. <span data-ttu-id="2ed3c-271">Вернитесь к *Default.cshtml* и войдите в систему как пользователь, добавляемый &quot;администратора&quot; роли.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-271">Return to *Default.cshtml* and log in as the user you added to the &quot;admin&quot; role.</span></span>
15. <span data-ttu-id="2ed3c-272">Перейдите к *AdminOnly.cshtml* страницы.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-272">Browse to *AdminOnly.cshtml* page.</span></span> <span data-ttu-id="2ed3c-273">Это время, вы увидите страницу.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-273">This time you see the page.</span></span>

## <a name="preventing-automated-programs-from-joining-your-website"></a><span data-ttu-id="2ed3c-274">Запрет присоединения веб-сайте автоматические программы</span><span class="sxs-lookup"><span data-stu-id="2ed3c-274">Preventing Automated Programs from Joining Your Website</span></span>

<span data-ttu-id="2ed3c-275">Страницы входа не будет останавливать автоматические программы (иногда называют *веб-роботов* или *программы-роботы*) регистрироваться в веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-275">The login page will not stop automated programs (sometimes referred to as *web robots* or *bots*) from registering with your website.</span></span> <span data-ttu-id="2ed3c-276">Эта процедура описывает Включение ReCaptcha тест для страницы регистрации.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-276">This procedure describes how to enable a ReCaptcha test for the registration page.</span></span>

![/media/38777/ch16securitymembership-18.jpg](16-adding-security-and-membership/_static/image1.jpg)

1. <span data-ttu-id="2ed3c-278">Регистрация веб-сайта в ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net)).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-278">Register your website at ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net)).</span></span> <span data-ttu-id="2ed3c-279">После завершения регистрации, вы сможете получить открытый ключ и закрытый ключ.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-279">When you've completed registration, you'll get a public key and a private key.</span></span>
2. <span data-ttu-id="2ed3c-280">Добавить библиотека вспомогательных методов ASP.NET Web веб-сайта, как описано в [Установка помощников в узел веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=252372), если это еще не сделано.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-280">Add the ASP.NET Web Helpers Library to your website as described in [Installing Helpers in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=252372), if you haven't already.</span></span>
3. <span data-ttu-id="2ed3c-281">В *учетной записи* папку, откройте файл с именем *Register.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-281">In the *Account* folder, open the file named *Register.cshtml*.</span></span>
4. <span data-ttu-id="2ed3c-282">В коде в верхней части страницы найдите следующие строки и раскомментируйте их, удаляя `//` символов комментария:</span><span class="sxs-lookup"><span data-stu-id="2ed3c-282">In the code at the top of the page, find the following lines and uncomment them by removing the `//` comment characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample6.cs)]
5. <span data-ttu-id="2ed3c-283">Замените `PRIVATE_KEY` с помощью собственного закрытого ключа ReCaptcha.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-283">Replace `PRIVATE_KEY` with your own ReCaptcha private key.</span></span>
6. <span data-ttu-id="2ed3c-284">В разметке страницы, удалите `@*` и `*@` символы комментария из примерно следующие строки в разметке страницы:</span><span class="sxs-lookup"><span data-stu-id="2ed3c-284">In the markup of the page, remove the `@*` and `*@` commenting characters from around the following lines in the page markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample7.cshtml)]
7. <span data-ttu-id="2ed3c-285">Замените `PUBLIC_KEY` с помощью ключа.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-285">Replace `PUBLIC_KEY` with your key.</span></span>
8. <span data-ttu-id="2ed3c-286">Если он еще не удалены уже, удалить `<div>` элемент, который содержит текст, который начинается с «Включить проверку CAPTCHA...».</span><span class="sxs-lookup"><span data-stu-id="2ed3c-286">If you haven't removed it already, remove the `<div>` element that contains text that starts with "To enable CAPTCHA verification ...".</span></span> <span data-ttu-id="2ed3c-287">(Полностью удалите `<div>` элемент и его содержимое.)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-287">(Remove the entire `<div>` element and its contents.)</span></span>

1. <span data-ttu-id="2ed3c-288">Запустите *Default.cshtml* в браузере.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-288">Run *Default.cshtml* in a browser.</span></span> <span data-ttu-id="2ed3c-289">Если вы выполнили вход в веб-узел, щелкните **выхода** ссылку.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-289">If you're logged into the site, click the **Logout** link.</span></span>
2. <span data-ttu-id="2ed3c-290">Нажмите кнопку **зарегистрировать** связывание и тестовых регистрацию, с помощью тест CAPTCHA.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-290">Click the **Register** link and test the registration using the CAPTCHA test.</span></span>

    ![безопасность членства-10](16-adding-security-and-membership/_static/image9.png)

<span data-ttu-id="2ed3c-292">Дополнительные сведения о `ReCaptcha` вспомогательного приложения, в разделе [с помощью ваш веб-сайт ASP.NET с помощью CATPCHA для предотвращения автоматической программ (программы-роботы)](https://go.microsoft.com/fwlink/?LinkId=251967).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-292">For more information about the `ReCaptcha` helper, see [Using a CATPCHA to Prevent Automated Programs (Bots) from Using Your ASP.NET Web Site](https://go.microsoft.com/fwlink/?LinkId=251967).</span></span>

<a id="Additional_Resources"></a>
## <a name="letting-users-log-in-using-an-external-site"></a><span data-ttu-id="2ed3c-293">Предоставление пользователям возможности выполнить вход с помощью внешнего узла</span><span class="sxs-lookup"><span data-stu-id="2ed3c-293">Letting Users Log In Using an External Site</span></span>

<span data-ttu-id="2ed3c-294">**Начального сайта** шаблон включает в себя код и разметку, которая позволяет пользователям вход с использованием Facebook, Windows Live, Twitter, Google или Yahoo.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-294">The **Starter Site** template includes code and markup that lets users log in using Facebook, Windows Live, Twitter, Google, or Yahoo.</span></span> <span data-ttu-id="2ed3c-295">По умолчанию эта функция не включена.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-295">By default, this functionality is not enabled.</span></span> <span data-ttu-id="2ed3c-296">Общая процедура использования информирующее пользователей в систему с помощью этих внешних поставщиков это:</span><span class="sxs-lookup"><span data-stu-id="2ed3c-296">The general procedure for using letting users log in using these external providers is this:</span></span>

- <span data-ttu-id="2ed3c-297">Решите, какой из внешних сайтов требуется поддерживать.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-297">Decide which of the external sites you want to support.</span></span>
- <span data-ttu-id="2ed3c-298">При необходимости перехода на узел и настроить приложение имени входа.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-298">If required, go to that site and set up a login app.</span></span> <span data-ttu-id="2ed3c-299">(Например, необходимо сделать это, чтобы разрешить имена входа Facebook.)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-299">(For example, you have to do this in order to allow Facebook logins.)</span></span>
- <span data-ttu-id="2ed3c-300">На сайте настройте поставщика.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-300">In your site, configure the provider.</span></span> <span data-ttu-id="2ed3c-301">В большинстве случаев достаточно раскомментируйте некоторый код в  *\_AppStart.cshtml* файла.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-301">In most cases, you just have to uncomment some code in the *\_AppStart.cshtml* file.</span></span>
- <span data-ttu-id="2ed3c-302">Добавьте разметку страницы регистрации, который позволит пользователям ссылку на внешний сайт для протоколирования.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-302">Add markup to the registration page that lets people link to the external site for logging in.</span></span> <span data-ttu-id="2ed3c-303">Обычно можно скопировать разметки необходима и немного изменить текст.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-303">You can usually copy the markup you need and change the text slightly.</span></span>

<span data-ttu-id="2ed3c-304">Пошаговые инструкции можно найти в разделе [Включение имени входа из внешних узлов в сайт веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkId=251969).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-304">You can find step-by-step instructions in the topic [Enabling Login from External Sites in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=251969).</span></span>

<span data-ttu-id="2ed3c-305">После входа пользователя с другого сайта, пользователь возвращается к веб-узла и *связывает* этого имени входа с веб-узла.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-305">After a user logs in from another site, the user returns to your site and *associates* that login with your site.</span></span> <span data-ttu-id="2ed3c-306">По сути это создает запись членства на узле для внешней учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-306">In effect, this creates a membership entry in your site for the user's external login.</span></span> <span data-ttu-id="2ed3c-307">Это позволяет использовать обычные средства членства (такие как роли) с внешней учетной записи.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-307">This lets you use the normal facilities of membership (such as roles) with the external login.</span></span>

## <a name="adding-security-to-an-existing-website"></a><span data-ttu-id="2ed3c-308">Добавление защиты в существующем веб-сайте</span><span class="sxs-lookup"><span data-stu-id="2ed3c-308">Adding Security to an Existing Website</span></span>

<span data-ttu-id="2ed3c-309">Процедуре выше в этой статье основывается на использование **начального сайта** шаблон в качестве основы для обеспечения безопасности веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-309">The procedure earlier in this article relies on using the **Starter Site** template as the basis for website security.</span></span> <span data-ttu-id="2ed3c-310">Если непрактично запуск из **начального сайта** шаблона или чтобы скопировать соответствующие страницы с узла, на основе этого шаблона, можно применить один и тот же тип безопасности в вашем собственном узле с помощью кодирования самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-310">If it isn't practical for you to start from the **Starter Site** template or to copy the relevant pages from a site based on that template, you can implement the same type of security in your own site by coding it yourself.</span></span> <span data-ttu-id="2ed3c-311">Создать одинаковые типы страниц — регистрации, имя входа и так далее — и затем использовать классы и вспомогательные методы для настройки членства.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-311">You create the same types of pages — registration, login, and so on — and then use helpers and classes to set up membership.</span></span>

<span data-ttu-id="2ed3c-312">Это основная процедура описана в записи блога [самый простой способ реализации безопасности ASP.NET Razor](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-312">The basic process is described in the blog post [THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240).</span></span> <span data-ttu-id="2ed3c-313">Большая часть работы выполняется с помощью следующих методов и свойств `WebSecurity` поддержки:</span><span class="sxs-lookup"><span data-stu-id="2ed3c-313">Most of the work is done using the following methods and properties of the `WebSecurity` helper:</span></span>

- <span data-ttu-id="2ed3c-314">[WebSecurty.UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx), [WebSecurity.CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-314">[WebSecurty.UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx), [WebSecurity.CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx).</span></span> <span data-ttu-id="2ed3c-315">Эти методы позволяют определить, является ли кто-то уже зарегистрирован и зарегистрировать их.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-315">These methods let you determine whether someone is already registered and to register them.</span></span>
- <span data-ttu-id="2ed3c-316">[WebSecurty.IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-316">[WebSecurty.IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span></span> <span data-ttu-id="2ed3c-317">Это свойство позволяет определить, вошел ли текущий пользователь.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-317">This property lets you determine whether the current user is logged in.</span></span> <span data-ttu-id="2ed3c-318">Это полезно для перенаправления пользователей на страницу входа, если они еще не зарегистрировались.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-318">This is useful to redirect users to a login page if they have not already logged in.</span></span>
- <span data-ttu-id="2ed3c-319">[WebSecurity.Login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [WebSecurity.Logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-319">[WebSecurity.Login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [WebSecurity.Logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span></span> <span data-ttu-id="2ed3c-320">Эти методы входа пользователя in или out.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-320">These methods log a user in or out.</span></span>
- <span data-ttu-id="2ed3c-321">[WebSecurity.CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-321">[WebSecurity.CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span></span> <span data-ttu-id="2ed3c-322">Это свойство можно использовать для отображения имени текущего пользователя вошедшего в систему (если пользователь вошел в).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-322">This property is useful for displaying the current user's logged-in name (if the user is logged in).</span></span>
- <span data-ttu-id="2ed3c-323">[WebSecurity.ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-323">[WebSecurity.ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span></span> <span data-ttu-id="2ed3c-324">Этот метод полезен, если вы настроили подтверждение по электронной почте для регистрации.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-324">This method is useful if you set up email confirmation for registration.</span></span> <span data-ttu-id="2ed3c-325">(Сведения приводятся в записи блога [с помощью подтверждения для безопасности веб-страниц ASP.NET](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-325">(Details are described in the blog post [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).)</span></span>

<span data-ttu-id="2ed3c-326">Для управления ролями, можно использовать [ролей](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx) и [членства](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx) классов, как описано в записи блога.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-326">To manage roles, you can use the [Roles](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx) and [Membership](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx) classes, as described in the blog entry.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="2ed3c-327">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="2ed3c-327">Additional Resources</span></span>

- [<span data-ttu-id="2ed3c-328">Настройка поведения в масштабах сайта</span><span class="sxs-lookup"><span data-stu-id="2ed3c-328">Customizing Site-Wide Behavior</span></span>](https://go.microsoft.com/fwlink/?LinkId=202906)
- [<span data-ttu-id="2ed3c-329">Обеспечение безопасности веб-соединений: Сертификаты SSL и https://</span><span class="sxs-lookup"><span data-stu-id="2ed3c-329">Securing Web Communications: Certificates, SSL, and https://</span></span>](https://go.microsoft.com/fwlink/?LinkId=208660)
- <span data-ttu-id="2ed3c-330">[Самый простой способ реализации безопасности ASP.NET Razor](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240) и [с помощью подтверждения для безопасности веб-страниц ASP.NET](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).</span><span class="sxs-lookup"><span data-stu-id="2ed3c-330">[THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240) and [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).</span></span> <span data-ttu-id="2ed3c-331">Это записи в блогах, описывающие способы реализации возможностей членства ASP.NET без использования **начального сайта** шаблона.</span><span class="sxs-lookup"><span data-stu-id="2ed3c-331">These are blog posts that describe how to implement ASP.NET membership features without using the **Starter Site** template.</span></span>
- [<span data-ttu-id="2ed3c-332">Включение входа с внешних сайтов на сайте веб-страниц ASP.NET</span><span class="sxs-lookup"><span data-stu-id="2ed3c-332">Enabling Login from External Sites in an ASP.NET Web Pages Site</span></span>](https://go.microsoft.com/fwlink/?LinkId=251969)
- <span data-ttu-id="2ed3c-333">[Справочник по API класс WebSecurity](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-333">[WebSecurity Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="2ed3c-334">[Справочник по API класс SimpleRoleProvider](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-334">[SimpleRoleProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="2ed3c-335">[Справочник по API класс SimpleMembershipProvider](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="2ed3c-335">[SimpleMembershipProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99)) (MSDN)</span></span>
