---
uid: web-pages/overview/ui-layouts-and-themes/validating-user-input-in-aspnet-web-pages-sites
title: "Проверка пользовательского ввода в ASP.NET Web Pages (Razor) узлов | Документы Microsoft"
author: tfitzmac
description: "В этой статье описывается, как для проверки сведений, получаемых от пользователей &mdash; то есть, убедитесь, что пользователь ввел допустимый сведения в формате HTML форм в как..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2014
ms.topic: article
ms.assetid: 4eb060cc-cf14-41ae-bab1-14a2c15332d0
ms.technology: dotnet-webpages
ms.prod: .net-framework
msc.legacyurl: /web-pages/overview/ui-layouts-and-themes/validating-user-input-in-aspnet-web-pages-sites
msc.type: authoredcontent
ms.openlocfilehash: 3bde2a4ea69577ebcbe3e9e89a7ee07e6ece8dd1
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="validating-user-input-in-aspnet-web-pages-razor-sites"></a>Проверка пользовательского ввода в веб-страницы (Razor) узлов ASP.NET
====================
по [Tom FitzMacken](https://github.com/tfitzmac)

> В этой статье описывается, как для проверки сведений, получаемых от пользователей &mdash; то есть, убедитесь, что пользователь ввел допустимый сведения в формате HTML форм на сайте ASP.NET Web Pages (Razor).
> 
> Что вы узнаете следующее.
> 
> - Как проверить, что ввода пользователя соответствует критериям проверки.
> - Как определить, является ли все проверочные тесты были пройдены.
> - Способ отображения ошибок проверки (и форматировать их).
> - Как проверить данные, не поступать из пользователей.
> 
> Ниже перечислены ASP.NET программирования концепции, реализованные в статье:
> 
> - `Validation` Вспомогательные.
> - `Html.ValidationSummary` И `Html.ValidationMessage` методы.
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемая в этом учебнике
> 
> 
> - Веб-страниц ASP.NET (Razor) 3
>   
> 
> Этот учебник также работает с веб-страницы ASP.NET 2.


В этом разделе содержатся следующие подразделы:

- [Общие сведения о проверка введенных пользователем данных](#Overview_of_User_Input_Validation)
- [Проверка пользовательского ввода](#Validating_User_Input)
- [Добавление проверки на стороне клиента](#Adding_Client-Side_Validation)
- [Форматирование ошибки проверки](#Formatting_Validation_Errors)
- [Проверка данных, не поступать из пользователей](#Validating_Data_That_Doesnt_Come_Directly_from_Users)

<a id="Overview_of_User_Input_Validation"></a>
## <a name="overview-of-user-input-validation"></a>Общие сведения о проверка введенных пользователем данных

Если вы запрос на ввод сведений на странице — например, в форму, очень важно, чтобы убедиться в том, что допустимы значения, которые они вводят. Например не нужно выполнять формы, в которой отсутствуют критически важной информации.

Когда пользователь вводит значения в HTML-формы, значения, которые они вводят представляют собой строки. Во многих случаях нужные значения других типов данных, такие как целые числа или даты. Таким образом необходимо также убедиться, что значения, которые пользователи вводят может правильно преобразован в соответствующий тип данных.

Может также имеют определенные ограничения на значения. Даже если пользователи неправильно введите целое число, например, может потребоваться убедитесь в том, что значение находится в пределах определенного диапазона.

![Ошибки проверки, которые используют классы стилей CSS](validating-user-input-in-aspnet-web-pages-sites/_static/image1.png)

> [!NOTE] 
> 
> **Важные** проверка пользовательского ввода также важна для обеспечения безопасности. Если ограничить значения, которые пользователи могут вводить в формах, снижается вероятность того, что кто-то можно ввести значение, которое может скомпрометировать безопасность веб-узла.


<a id="Validating_User_Input"></a>
## <a name="validating-user-input"></a>Проверка пользовательского ввода

В ASP.NET Web Pages 2 можно использовать `Validator` вспомогательный метод для поля ввода. Основной подход заключается в том, чтобы сделать следующее:

1. Определите, какие входные элементы (поля), который нужно проверить.

    Как правило проверки значений в `<input>` элементы в форме. Однако это рекомендуется проверять все входные данные, даже ввода, поступающие от элемента, ограниченного как `<select>` списка. Это помогает обеспечить, что пользователи не обхода элементов управления на странице и отправить форму.
2. В коде страницы добавьте отдельные проверки каждого входного элемента с помощью методов `Validation` вспомогательный.

    Чтобы проверить наличие обязательных полей, используйте `Validation.RequireField(field, [error message])` (для отдельных полей) или `Validation.RequireFields(field1, field2, ...))` (для получения списка полей). Для других типов проверки, используйте `Validation.Add(field, ValidationType)`. Для `ValidationType`, можно использовать следующие параметры:

    `Validator.DateTime ([error message])`  
`Validator.Decimal([error message])`  
`Validator.EqualsTo(otherField [, error message])`  
`Validator.Float([error message])`  
`Validator.Integer([error message])`  
`Validator.Range(min, max [, error message])`  
`Validator.RegEx(pattern [, error message])`  
`Validator.Required([error message])`  
`Validator.StringLength(length)`  
`Validator.Url([error message])`
3. При отправке страницы проверить, достиг ли проверка, проверив `Validation.IsValid`:

    [!code-csharp[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample1.cs)]

    В случае ошибки проверки, можно пропустить обработки обычных страниц. Например если страница предназначена для обновления базы данных, этого не сделать, пока не будут исправлены все ошибки проверки.
4. Если имеются ошибки проверки, отображать сообщения об ошибках в разметке страницы с помощью `Html.ValidationSummary` или `Html.ValidationMessage`, или оба.

Пример страницы, который иллюстрирует следующие действия.

[!code-cshtml[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample2.cshtml)]

Чтобы увидеть, как работает проверка, запустите эту страницу и намеренно делают ошибки. Например, вот как если вы забыли ввести название курса, если ввести выглядит страницы, а при вводе недопустимую дату:

![Ошибки проверки в отображаемой странице](validating-user-input-in-aspnet-web-pages-sites/_static/image2.png)

<a id="Adding_Client-Side_Validation"></a>
## <a name="adding-client-side-validation"></a>Добавление проверки на стороне клиента

По умолчанию проверяется ввод данных пользователем после отправки страницы — то есть проверка выполняется в серверном коде. Недостатком этого подхода является, что пользователи не знают, что они внесли ошибку до их после отправки страницы. Если форма является длинное или сложное, отчетов об ошибках только после отправки страницы может быть неудобным для пользователя.

Вы можете добавить поддержку для выполнения проверки в клиентского скрипта. В этом случае проверка выполняется при работе в браузере. Например предположим, что можно указать, что значение должно быть целым. Если пользователь вводит значение не целое число, как только пользователь покидает поле запись об ошибке. Пользователи получают мгновенно узнавать, что удобно при работе с ними. Проверка на основе клиента можно также уменьшить количество раз, которые есть у пользователя для отправки формы, чтобы устранить несколько ошибок.

> [!NOTE]
> Даже при использовании проверки на стороне клиента в серверном коде всегда также выполняется проверка. Выполнение проверки в серверном коде является мерой безопасности, в случае, если пользователи пропуска проверки на стороне клиента.


1. Зарегистрируйте следующие библиотеки JavaScript на странице:  

    [!code-html[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample3.html)]

 Двух библиотек могут загружаться из сети доставки содержимого (CDN), поэтому не нужно обязательно иметь их на компьютере или сервере. Тем не менее, необходимо иметь локальную копию *jquery.validate.unobtrusive.js*. Если вы уже работаете не с помощью WebMatrix шаблона (например **начального сайта** ), включает библиотеку, создайте сайт веб-страницы на основе **начального сайта**. Затем скопируйте *.js* файла для текущего веб-узла.
2. В разметке для каждого элемента, который проверка, добавьте вызов `Validation.For(field)`. Этот метод создает атрибуты, используемые для проверки на стороне клиента. (Вместо раскрытием фактический код JavaScript, метод выдает такие атрибуты, как `data-val-...`. Эти атрибуты поддерживают ненавязчивой клиентской проверки используется jQuery для выполнения работы.)

Следующая страница демонстрирует добавление функции проверки клиента в примере выше.

[!code-cshtml[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample4.cshtml?highlight=35-39,51,61,71)]

Не все проверки запуска на клиенте. В частности проверка типа данных (целое число, даты и т. д) не выполняются на клиенте. На клиенте и сервере работают следующие проверки:

- `Required`
- `Range(minValue, maxValue)`
- `StringLength(maxLength[, minLength])`
- `Regex(pattern)`
- `EqualsTo(otherField)`

В этом примере теста для допустимой датой не будет работать в клиентском коде. Тем не менее тест будет выполняться в серверном коде.

<a id="Formatting_Validation_Errors"></a>
## <a name="formatting-validation-errors"></a>Форматирование ошибки проверки

Можно управлять отображением ошибки проверки, определив классы CSS, которые имеют следующие зарезервированные имена:

- `field-validation-error`. Определяет выходные данные `Html.ValidationMessage` метод, если он отображает ошибку.
- `field-validation-valid`. Определяет выходные данные `Html.ValidationMessage` метод, если нет ошибок.
- `input-validation-error`. Определяет способ `<input>` элементы отображаются в том случае, когда возникает ошибка. (Например, этот класс можно использовать, чтобы задать цвет фона &lt;ввода&gt; элемент, цвет, если его значение недопустимо.) Этот класс CSS используется только во время проверки клиента (в ASP.NET Web Pages 2).
- `input-validation-valid`. Определяет внешний вид `<input>` элементы, когда он не содержит ошибок.
- `validation-summary-errors`. Определяет выходные данные `Html.ValidationSummary` метод, он отображает список ошибок.
- `validation-summary-valid`. Определяет выходные данные `Html.ValidationSummary` метод, если нет ошибок.

Следующие `<style>` блок показаны правила для условия ошибки.

[!code-css[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample5.css)]

Если включить этот блок стиля в примере страниц из ранее в этой статье, в случае отображения ошибок будет выглядеть как на следующем рисунке:

![Ошибки проверки, которые используют классы стилей CSS](validating-user-input-in-aspnet-web-pages-sites/_static/image3.png)

> [!NOTE]
> Если вы не используете клиентская проверка в ASP.NET Web Pages 2, классы CSS `<input>` элементы (`input-validation-error` и `input-validation-valid` не оказывает никакого воздействия.


### <a name="static-and-dynamic-error-display"></a>Отображение статических и динамических ошибок

Правила CSS возникают попарно, например `validation-summary-errors` и `validation-summary-valid`. Эти пары позволяют определять правила выполняются оба условия: условие ошибки и условие «обычный» (без ошибок). Важно понимать, что всегда отображается разметку для отображения ошибок, даже если ошибок нет. Например, если страница содержит `Html.ValidationSummary` метод в разметке исходный код страницы будет содержать следующую разметку даже при первом запросе страницы:

`<div class="validation-summary-valid" data-valmsg-summary="true"><ul></ul></div>`

Другими словами `Html.ValidationSummary` метод всегда отображает `<div>` элемент и списку, даже в том случае, если список ошибок является пустым. Аналогичным образом `Html.ValidationMessage` метод всегда отображает `<span>` элемент как заполнитель для ошибку отдельного поля, даже если нет ошибок.

В некоторых ситуациях с сообщением об ошибке может привести к странице, чтобы Перекомпоновка и может привести к элементов на странице для перемещения. Правила CSS, заканчивающиеся на `-valid` позволяют определить макет, который может помочь предотвратить возникновение этой проблемы. Например, можно определить `field-validation-error` и `field-validation-valid` на оба имеют же фиксированный размер. Таким образом, отображаемую область для поля является статическим и не изменит поток страниц, если отображается сообщение об ошибке.

<a id="Validating_Data_That_Doesnt_Come_Directly_from_Users"></a>
## <a name="validating-data-that-doesnt-come-directly-from-users"></a>Проверка данных, не поступать из пользователей

Иногда необходимо проверить информацию непосредственно из формы HTML. Типичным примером является страницей, когда значение передается в строке запроса, как показано в следующем примере:

`http://server/myapp/EditClassInformation?classid=1022`

В этом случае необходимо убедиться, что значение, которое передается на страницу (здесь 1022 значение `classid`) является допустимым. Нельзя напрямую использовать `Validation` вспомогательный метод для выполнения этой проверки. Тем не менее можно использовать другие функции проверки системы, такие как возможность отображать сообщения об ошибках проверки.

> [!NOTE] 
> 
> **Важные** всегда проверяйте все значения, получаемые из *любой* источника, включая значения поля формы, значения строки запроса и значений cookie. Он может легко изменять эти значения (возможно, для вредоносных целей). Поэтому необходимо проверять эти значения для защиты приложения.


В следующем примере показано, как может проверить значение, которое передается в строке запроса. В коде проверяется значение не указано, и что он является целым числом.

[!code-csharp[Main](validating-user-input-in-aspnet-web-pages-sites/samples/sample6.cs)]

Обратите внимание, что тест выполняется при запросе отправки формы (`if(!IsPost)`). Этот тест будет передан при первом запросе страницы, но не в том случае, если запрос является отправки формы.

Чтобы отобразить эту ошибку, можно добавить ошибки в список ошибок проверки путем вызова `Validation.AddFormError("message")`. Если страница содержит вызов `Html.ValidationSummary` метод ошибку, отображается как ошибка проверки входных данных пользователя.

<a id="AdditionalResources"></a>
## <a name="additional-resources"></a>Дополнительные ресурсы

[Работа с формами HTML веб-страниц сайтов ASP.NET](https://go.microsoft.com/fwlink/?LinkID=202892)
