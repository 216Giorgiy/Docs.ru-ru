---
uid: web-pages/overview/ui-layouts-and-themes/9-working-with-images
title: Работа с изображениями в сайт ASP.NET Web Pages (Razor) | Документы Microsoft
author: tfitzmac
description: В этой главе показано, как добавить, отображения и управления ими (изменение размера, отражение и добавить водяных знаков) веб-сайта.
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2014
ms.topic: article
ms.assetid: 778c4e58-4372-4d25-bab9-aec4a8d8e38d
ms.technology: dotnet-webpages
ms.prod: .net-framework
msc.legacyurl: /web-pages/overview/ui-layouts-and-themes/9-working-with-images
msc.type: authoredcontent
ms.openlocfilehash: 74838dd364a43f3f4c966c1417d0f0b2cc242f28
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="working-with-images-in-an-aspnet-web-pages-razor-site"></a>Работа с изображениями в веб-страницы (Razor) узла ASP.NET
====================
по [Tom FitzMacken](https://github.com/tfitzmac)

> В этой статье показано, как добавить, отображения и управления ими (изменение размера, отражение и добавить водяных знаков) в веб-сайта ASP.NET Web Pages (Razor).
> 
> Что вы узнаете следующее.
> 
> - Инструкции по добавлению изображения на страницу динамически.
> - Как разрешить пользователям загружать изображение.
> - Способ изменения размера изображения.
> - Как отражение и поворот изображения.
> - Инструкции по добавлению к изображению водяного знака.
> - Как использовать изображение в качестве водяного знака.
> 
> Ниже перечислены возможности, представленные в статье программирования ASP.NET:
> 
> - `WebImage` Вспомогательные.
> - `Path` Объект, который предоставляет методы, позволяющие управлять путь и имена файлов.
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемая в этом учебнике
> 
> 
> - Веб-страниц ASP.NET (Razor) 2
> - WebMatrix 2
>   
> 
> Этот учебник также работает с WebMatrix 3.


<a id="Adding_an_Image"></a>
## <a name="adding-an-image-to-a-web-page-dynamically"></a>Динамическое добавление изображения на веб-страницу

Можно добавлять изображения для веб-сайта и отдельных страниц во время разработки веб-сайта. Также можно позволить пользователям загрузить изображения, которые могут быть полезными для задачи, такие как сюда и добавить фотографию профиля.

Если образ уже доступны на сайте и требуется его отображения на странице, можно использовать HTML `<img>` элемент следующим образом:

[!code-html[Main](9-working-with-images/samples/sample1.html)]

В некоторых случаях, необходимо иметь возможность динамического отображения изображений & #8212; то есть вы не знаете, какие изображения, отображаемого до страницы выполняется.

В этом разделе показано, как отобразить изображение на лету, где пользователям указать имя файла изображения из списка имен образов. Имя изображения, они выберите из раскрывающегося списка и при отправке страницы отображается изображение, которое они выделены.

![[image] ] (9-working-with-images/_static/image1.jpg "ch9images 1.jpg")

1. В WebMatrix создайте новый веб-сайт.
2. Добавление новой страницы с именем *DynamicImage.cshtml*.
3. В корневой папке веб-сайта, добавьте новую папку и назовите его *изображения*.
4. Добавьте четыре изображения к *изображения* созданную папку. (Все образы у вас под рукой будет сделать, но они должна помещаться на страницу). Переименуйте изображения *Photo1.jpg*, *Photo2.jpg*, *Photo3.jpg*, и *Photo4.jpg*. (Не будет использовать *Photo4.jpg* в этой процедуре, но оно будет использоваться далее в этой статье.)
5. Убедитесь, что четыре изображения не помечены как доступные только для чтения.
6. Замените существующее содержимое на странице с помощью следующего:

    [!code-cshtml[Main](9-working-with-images/samples/sample2.cshtml)]

    Основной области страницы имеет раскрывающегося списка ( `<select>` элемент) с именем `photoChoice`. В списке есть три варианта и `value` атрибут каждого варианта список имеет имя одного из образов, которые необходимо поместить в *изображения* папки. По существу, список позволяет пользователям выбирать понятное имя, например &quot;фото 1&quot;, а затем передает *.jpg* имени файла при отправке страницы.

    В коде, можно получить, выбранным пользователем (другими словами, имя файла образа) из списка, считывая `Request["photoChoice"]`. Сначала вы видите, существует ли выделение вообще. Если нет, можно составить путь для изображения, которое содержит имя папки для образов и имя файла изображения для пользователя. (Если предпринята попытка составить путь, но был nothing в `Request["photoChoice"]`, возникает сообщение об ошибке.) Это приводит к относительный путь следующим образом:

    *изображения и Photo1.jpg*

    Путь хранится в переменной с именем `imagePath` , вам потребуется позднее на странице.

    В тексте, имеется также `<img>` элемент, используемый для отображения изображения, выбранного пользователем. `src` Атрибута не задано имя файла или URL-адрес, как и для отображения статического элемента. Вместо этого оно равно `@imagePath`, это означает, что он получает свое значение из пути, можно установить в коде.

    При первом запуске страницы, но нет не отображаемое изображение, так как не все выбранные пользователем. Это обычно означает, что `src` атрибут должен быть пустым и изображение будет отображаться красный &quot;x&quot; (или любой браузер отрисовывает, когда невозможно найти изображение). Чтобы избежать этого, поместите `<img>` элемент в `if` блок, который проверяет ли `imagePath` переменной ничего в нем. Если пользователь выделили, `imagePath` содержит путь. Если пользователь не выбирает изображения или страница отображается, если это первый раз, `<img>` даже при отображении элемента.
7. Сохраните файл и откройте страницу в браузере. (Убедитесь, что выбран страницы **файлы** рабочей области, прежде чем запускать его.)
8. Выберите изображение из раскрывающегося списка и нажмите кнопку **изображение образца**. Убедитесь, что вы видите различных изображений для различных вариантов.

<a id="Uploading_an_Image"></a>
## <a name="uploading-an-image"></a>Отправка образа

В предыдущем примере показан способ отображения изображения динамически, но он работает только с образами, которые уже были на веб-сайте. Эта процедура показано, как пользователи могут отправить изображение, которое отображается на странице. В ASP.NET, можно управлять изображениями на основе `WebImage` вспомогательного приложения, который содержит методы, позволяющие создавать, управлять и сохранения изображений. `WebImage` Вспомогательный поддерживает все общие web типы файлов изображений, включая *.jpg*, *.png*, и *.bmp*. В этой статье мы воспользуемся *.jpg* изображения, но можно использовать любой из типов изображений.

![[image] ] (9-working-with-images/_static/image2.jpg "ch9images 2.jpg")

1. Добавление новой страницы и назовите его *UploadImage.cshtml*.
2. Замените существующее содержимое на странице с помощью следующего: 

    [!code-cshtml[Main](9-working-with-images/samples/sample3.cshtml)]

    В теле текста `<input type="file">` элемент, который пользователи могут выбрать файл для отправки. При выборе **отправить**, они используются файл отправляется вместе с формой.

    Для получения отправленного изображения используйте `WebImage` вспомогательного приложения, в которой доступны все виды полезных методов для работы с изображениями. В частности, можно использовать `WebImage.GetImageFromRequest` для получения отправленного изображения (если таковые имеются) и сохранение его в переменной с именем `photo`.

    Большой объем работы в этом примере включает в себя получение и задание имена файлов и пути. Проблема заключается в необходимость получения имени (и только имя), изображения, отправленный пользователем, а затем создайте новый путь, для которой вы собираетесь сохранить изображение. Поскольку пользователи потенциально может отправить несколько образов, которые имеют одинаковое имя, используется немного дополнительного кода для создания уникальных имен и убедитесь, что пользователи не перезаписывать существующие рисунки.

    Если образ фактически отправлен (теста `if (photo != null)`), получить имя образа с помощью образа `FileName` свойство. Когда пользователь загружает изображение, `FileName` содержит исходное имя пользователя, включая путь с компьютера пользователя. Он может выглядеть следующим образом:

    *C:\Users\Joe\Pictures\SamplePhoto1.jpg*

    Вы не хотите эти сведения путь, хотя & #8212; необходимо просто фактическое имя файла (*SamplePhoto1.jpg*). Может удалять только файл по пути с помощью `Path.GetFileName` метод следующим образом:

    [!code-csharp[Main](9-working-with-images/samples/sample4.cs)]

    Создайте новое уникальное имя файла путем добавления к имени исходного идентификатора GUID. (Дополнительные сведения об идентификаторах GUID см [о GUID](#SB_AboutGUIDs) далее в этой статье.) Затем создается полный путь, который можно использовать для сохранения изображения. Сохранить путь состоит из имени файла, папки (образы) и текущее расположение веб-сайта.

    > [!NOTE]
    > Чтобы код, чтобы сохранять файлы в *изображения* папки, приложения должен разрешения на чтение запись для этой папки. На компьютере разработчика это не обычно проблему. Тем не менее при публикации сайта поставщика услуг размещения веб-сервере, может потребоваться явно задать эти разрешения. При выполнении этого кода на сервере поставщика услуг размещения и возникают ошибки, проверьте с помощью поставщика услуг размещения, чтобы узнать, как задать эти разрешения.

    Наконец, передайте сохранения путь к `Save` метод `WebImage` вспомогательный. Хранит отправленного изображения с новым именем. Сохранить метод выглядит следующим образом: `photo.Save(@"~\" + imagePath)`. Полный путь добавляется к `@"~\"`, — текущее расположение веб-сайта. (Сведения о `~` оператор, в разделе [введение в ASP.NET веб-программирование с использованием синтаксиса Razor](https://go.microsoft.com/fwlink/?LinkId=202890#ID_WorkingWithFileAndFolderPaths).)

    Как в предыдущем примере содержит основной области страницы `<img>` элемент для отображения изображения. Если `imagePath` задана, `<img>` визуализации элемента и его `src` атрибута задано значение `imagePath` значение.
3. Запустите страницу в браузере.
4. Отправить изображение и убедитесь, что он отображается на странице.
5. Откройте в веб-сайта *изображения* папки. Вы видите, что был добавлен новый файл, имя которого будет выглядеть примерно следующим образом: 

    *45ea4527-7ddd-4965-b9ca-c6444982b342\_MyPhoto.png*

    Это образ, загруженный с идентификатором GUID в качестве префикса к имени. (Собственный файл будет иметь другой GUID и, возможно, имеет имя, отличные от *MyPhoto.png*.)

> [!TIP] 
> 
> <a id="SB_AboutGUIDs"></a>
> ### <a name="about-guids"></a>Об идентификаторах GUID
> 
> Идентификатор GUID (глобальный уникальный идентификатор) является идентификатором, который обычно отображается в формате следующим образом: `936DA01F-9ABD-4d9d-80C7-02AF85C822A8`. Цифры и буквы (от A до F) отличаются для каждого идентификатора GUID, но все они следуют этому шаблону, с помощью групп 8-4-4-4-12 символов. (Технически GUID представляет 16-байтовый/128-разрядное число). Если вам требуется идентификатор GUID, можно вызвать специализированный код, который формирует идентификатор GUID для вас. Идея GUID является между огромного размера числа (3,4 x 10<sup>38</sup>) и алгоритм его создания, итоговый номер гарантированно быть одного типа. Таким образом, идентификаторы GUID — это удобный способ, при создании имен для действия, если необходимо гарантировать, что не будет использовать то же имя дважды. Недостатком, конечно, является то, что идентификаторы GUID не особенно понятное для пользователя, поэтому они обычно используются, если имя используется только в коде.


<a id="Resizing_an_Image"></a>
## <a name="resizing-an-image"></a>Изменение размера изображения

Если веб-сайт принимает изображения от пользователя, может потребоваться изменить размер изображения до отображения или сохранить их. Можно повторно использовать `WebImage` вспомогательный класс для этого.

Показано, как можно изменить размер отправленного изображения, создание эскизов и сохранить эскиза и исходное изображение на веб-сайте. Отображение эскиза на странице и использовать гиперссылки для перенаправления пользователей к полноразмерное изображение.

![[image] ] (9-working-with-images/_static/image3.jpg "ch9images 3.jpg")

1. Добавление новой страницы с именем *Thumbnail.cshtml*.
2. В *изображения* папки, создать вложенную папку с именем *палец*.
3. Замените существующее содержимое на странице с помощью следующего: 

    [!code-cshtml[Main](9-working-with-images/samples/sample5.cshtml)]

    Это тот же код из предыдущего примера. Различие заключается в том, что этот код сохраняет изображение дважды, один раз в обычном режиме и один раз после создания копии эскиза изображения. Сначала получите отправленного изображения и сохраните его в *изображения* папки. Затем создается новый путь для эскизов. Для создания эскиза, вызовите `WebImage` помощника `Resize` метод для создания образа 60 пикселей на 60 пикселей. В примере показано, как сохранить соотношение и каким образом можно предотвратить изображения увеличена (в случае нового размера будет фактически увеличить изображения). Изображение с измененным размером затем сохраненные в *палец* вложенную папку.

    В конце разметки, необходимо использовать те же `<img>` элемент с динамической `src` атрибут, который вы видели в предыдущих примерах поле для отображения изображения. В этом случае можно отобразить эскиз. Можно также использовать `<a>` элемента, который требуется создать гиперссылку на больших версию образа. Как и в `src` атрибут `<img>` задать элемент, `href` атрибут `<a>` элемента динамически на `imagePath`. Чтобы убедиться в том, что путь можно работать как URL-адрес, передайте `imagePath` для `Html.AttributeEncode` метод, который преобразует зарезервированные символы в пути символы, которые ОК в URL-АДРЕСЕ.
4. Запустите страницу в браузере.
5. Отправить фото и убедитесь, что отображается эскиз.
6. Щелкните эскиз для просмотра полного изображения.
7. В *изображения* и *изображения или палец*, обратите внимание, что были добавлены новые файлы.

<a id="Rotating_and_Flipping"></a>
## <a name="rotating-and-flipping-an-image"></a>Поворот и отражение изображения

`WebImage` Вспомогательные также позволяет отразить и поворот изображений. Эта процедура показано, как получить изображение из сервера, отражение изображения сверху вниз (по вертикали), сохраните его и затем откройте отраженное изображение на странице. В этом примере вы просто используете файл уже есть на сервере (*Photo2.jpg*). В реальном приложении, скорее всего, будет отражение изображения, имя которого вы получаете динамически, как это было сделано в предыдущих примерах.

![[image] ] (9-working-with-images/_static/image4.jpg "ch9images 4.jpg")

1. Добавление новой страницы с именем *FlipImage.cshtml*.
2. Замените существующее содержимое на странице с помощью следующего: 

    [!code-cshtml[Main](9-working-with-images/samples/sample6.cshtml)]

    Код использует `WebImage` вспомогательный метод для получения изображения с сервера. Будет создан путь к изображению, используя тот же метод, используемый в предыдущих примерах для сохранения изображений и передать этот путь при создании образа с помощью `WebImage`:

    [!code-javascript[Main](9-working-with-images/samples/sample7.js)]

    Если обнаруживается изображения, создается новый путь и имя файла, как это было сделано в предыдущих примерах. Чтобы отразить изображение, вызовите `FlipVertical` метода, а затем сохраните файл еще раз.

    Изображение снова отображается на странице с помощью `<img>` элемент с `src` атрибуту присвоено значение `imagePath`.
3. Запустите страницу в браузере. Изображение для *Photo2.jpg* отображается сверху вниз.
4. Обновите страницу или запросить страницу, чтобы проверить, что изображение отраженных справа от оператора снова.

Чтобы сменить изображение, используйте один и тот же код, но вместо вызова `FlipVertical` или `FlipHorizontal`, можно вызвать `RotateLeft` или `RotateRight`.

<a id="Adding_a_Watermark"></a>
## <a name="adding-a-watermark-to-an-image"></a>Добавление на изображение водяного знака

При добавлении изображения на веб-сайт, может потребоваться добавить водяного знака в образ, прежде чем сохранить его или ее отображение на странице. Пользователи часто используют водяных знаков, для добавления к изображению сведения об авторских правах или объявлять их название организации.

![[image] ] (9-working-with-images/_static/image5.jpg "ch9images 5.jpg")

1. Добавление новой страницы с именем *Watermark.cshtml*.
2. Замените существующее содержимое на странице с помощью следующего: 

    [!code-cshtml[Main](9-working-with-images/samples/sample8.cshtml)]

    Данный пример кода является как код в *FlipImage.cshtml* страницы из более ранней версии (несмотря на то, что это время использует *Photo3.jpg* файла). Чтобы добавить водяной знак, следует вызвать `WebImage` помощника `AddTextWatermark` метод, чтобы сохранить изображение. В вызове `AddTextWatermark`, передать текст &quot;Мои водяного знака&quot;, задать желтый цвет шрифта и значением семейство шрифта Arial. (Хотя это не показано, `WebImage` вспомогательный также можно задать прозрачность, семейство шрифтов и размер шрифта и положение текста водяного знака.) При сохранении образа он не должен быть только для чтения.

    Как вы уже видели, появляется изображение на странице с помощью `<img>` элемент с атрибутом src значение `@imagePath`.
3. Запустите страницу в браузере. Обратите внимание на текст «Мои водяного знака» в нижнем правом углу изображения.

<a id="Using_an_Image_as_a_Watermark"></a>
## <a name="using-an-image-as-a-watermark"></a>Использование изображения в качестве водяного знака

Вместо текста водяного знака, можно использовать другое изображение. Людей иногда использовать изображения эмблемы компании в качестве водяного знака или использовать водяного знака вместо текста сведения об авторских правах.

![[image] ] (9-working-with-images/_static/image6.jpg "ch9images 6.jpg")

1. Добавление новой страницы с именем *ImageWatermark.cshtml*.
2. Добавить изображение в *изображения* папку можно использовать в качестве эмблемы, а также переименовать изображение *MyCompanyLogo.jpg*. Этот образ должен быть образ, который лучше можно видеть, если он имеет значение 80 пикселей в ширину и 20 пикселей в высоту.
3. Замените существующее содержимое на странице с помощью следующего: 

    [!code-cshtml[Main](9-working-with-images/samples/sample9.cshtml)]

    Это является еще одним вариантом кода из предыдущих примерах. В этом случае вызывается `AddImageWatermark` добавление к изображению водяного знака в области образа цели (*Photo3.jpg*) при сохранении изображения. При вызове `AddImageWatermark`, значение ширины 80 пикселей и высотой до 20 пикселей. *MyCompanyLogo.jpg* изображение горизонтально в центре и выравнивание по вертикали в нижней части области образа цели. Непрозрачность имеет значение 100% и заполнение задано значение 10 точек. Если изображение водяного знака больше, чем целевого образа, ничего не происходит. Если изображение водяного знака больше, чем целевого образа и установить заполнение для изображений водяного знака равным нулю, водяной знак учитывается.

    Как и прежде, отображения изображения с помощью `<img>` элемент и динамического `src` атрибута.
4. Запустите страницу в браузере. Обратите внимание, что изображение водяного знака появляется в нижней части основного изображения.

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>Дополнительные ресурсы


[Работа с файлами в веб-страниц сайта ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202896)

[Введение в программирование с использованием синтаксиса Razor веб-страниц ASP.NET](https://go.microsoft.com/fwlink/?LinkID=251587)
