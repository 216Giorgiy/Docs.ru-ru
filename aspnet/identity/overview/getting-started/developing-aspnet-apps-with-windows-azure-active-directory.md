---
uid: identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
title: Разработка приложений ASP.NET с Azure Active Directory | Документы Microsoft
author: Rick-Anderson
description: Инструменты Microsoft ASP.NET для Azure Active Directory упрощает Включение проверки подлинности для веб-приложений, размещенных в Azure. Можно использовать предварительная пр Azure...
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/14/2014
ms.topic: article
ms.assetid: 457d7eaf-ee76-4ceb-9082-c7c1721435ad
ms.technology: ''
ms.prod: .net-framework
msc.legacyurl: /identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
msc.type: authoredcontent
ms.openlocfilehash: 9b2dc05089126fd5f4c1b0a0bd85b8a39f3041dc
ms.sourcegitcommit: 477d38e33530a305405eaf19faa29c6d805273aa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/07/2018
---
<a name="developing-aspnet-apps-with-azure-active-directory"></a>Разработка приложений ASP.NET с Azure Active Directory
====================
по [Рик Андерсон](https://github.com/Rick-Anderson)

Средства Microsoft ASP.NET для Azure Active Directory упрощает Включение проверки подлинности для веб-приложений, размещенных на [Azure](https://www.windowsazure.com/home/features/web-sites/). Проверка подлинности Azure можно использовать для проверки подлинности пользователей Office 365 в организации, корпоративных учетных записей, синхронизированные из локальной службы Active Directory или пользователей, созданных в собственный домен Azure Active Directory. Включение проверки подлинности Windows Azure настраивает приложение для проверки подлинности пользователей с помощью одного [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) клиента.

Этот учебник будет показано, как создать приложение ASP.NET, настроенная для единого входа с [Azure Active Directory](https://msdn.microsoft.com/library/azure/mt168838.aspx) (Azure AD). Вы также узнаете, как вызвать API Graph для получения сведений о пользователе, выполнившего вход и развертывание приложения в Azure.

## <a name="prerequisites"></a>Предварительные требования

1. [Visual Studio Express 2013 для Web](https://www.microsoft.com/visualstudio/eng/2013-downloads#d-2013-express) или [Visual Studio 2013](https://www.microsoft.com/visualstudio/eng/2013-downloads).
2. [Visual Studio 2013 с обновлением 4](https://www.microsoft.com/download/details.aspx?id=44921) -требуется обновление 3 или более поздней версии.
3. Учетная запись Azure. [Щелкните здесь,](https://azure.microsoft.com/pricing/free-trial/) для получения бесплатной пробной версии, если у вас еще нет учетной записи.

## <a name="add-a-global-administrator-to-your-active-directory"></a>Добавление глобального администратора в Active Directory

1. Войдите в [портала управления Azure](https://manage.windowsazure.com/).
2. Все учетные записи Azure содержат **каталог по умолчанию** --щелкните его, а затем нажмите кнопку **пользователей** вкладки в верхней части страницы (см. рисунок ниже).
3. Нажмите кнопку Добавить пользователя.  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image1.png)
4. Создайте нового пользователя с **глобального администратора** роли. Нажмите кнопку **пользователей** в верхнем меню и нажмите кнопку **добавить пользователя** кнопки на панели команд.
5. В **добавить пользователя** диалоговое окно, введите имя для нового пользователя и нажмите кнопку со стрелкой вправо.  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image2.png)
6. Введите имя пользователя и задайте для роли **глобального администратора**. Глобальные администраторы запасной адрес электронной почты требуется для восстановления пароля. После завершения работы нажмите кнопку со стрелкой вправо.  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image3.png)
7. На следующей странице диалогового окна щелкните **создать**. Временный пароль будет создан для нового пользователя и отображаются в диалоговом окне.   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image4.png)  
  
   Этот пароль будет необходимо сменить пароль после первого входа в. На следующем рисунке учетной записи администратора. Необходимо использовать Azure Active Directory могли входить в приложение, а не учетной записи Майкрософт, также отображаются на этой странице.  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image5.png)

## <a name="create-an-aspnet-application"></a>Создание приложения ASP.NET

В следующих шагах используется [Visual Studio Express 2013 для Web](https://www.microsoft.com/download/details.aspx?id=40747)и требует [Visual Studio 2013 Update 3](https://www.microsoft.com/download/details.aspx?id=43721).

1. В Visual Studio щелкните **файл** и затем **новый проект**. На **новый проект** диалоговое окно, выберите Visual C# веб-проекта в левом меню и нажмите кнопку **ОК**. Можно также снять **добавить Application Insights в проект** Если вы не хотите функциональные возможности для вашего приложения.
2. В **новый проект ASP.NET** диалогового окна выберите **MVC**, а затем нажмите кнопку **изменить аутентификацию**.   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image6.png)
3. На **изменить аутентификацию** диалогового окна выберите **учетные записи организации**. Эти параметры можно использовать для автоматической регистрации приложения в Azure AD, а также автоматически настроить приложение для интеграции с Azure AD. Нет необходимости в использовании **изменить аутентификацию** диалоговое окно для регистрации и настройки приложения, но он облегчает процесс. Если вы используете Visual Studio 2012. Например, можно вручную зарегистрировать приложение в портале управления Azure и обновите конфигурацию для интеграции с Azure AD.  
   В раскрывающемся меню, выберите **облако — одной организации** и **единый вход, чтение данных каталога**. Введите имя домена для вашего каталога Azure AD (в примере ниже изображения) *aricka0yahoo.onmicrosoft.com*, а затем нажмите кнопку **ОК**. Имя домена можно получить на вкладке «домены» для каталога по умолчанию на портале azure (см. Далее рисунок вниз).   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image7.png)  
  
   Ниже приведен имя домена на портале Azure.  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image8.png)  

    > [!NOTE]
    > При необходимости можно настроить URI идентификатора приложения, который будет зарегистрирован в Azure AD, щелкнув **Дополнительно**. URI идентификатора приложения — уникальный идентификатор для приложения, который зарегистрирован в Azure AD, который используется приложением для идентификации при взаимодействии с Azure AD. Дополнительные сведения об URI идентификатора приложения и другие свойства зарегистрированных приложений см. в разделе [в этом разделе](https://msdn.microsoft.com/library/azure/dn499820.aspx#BKMK_Registering). Установив флажок под полем URI идентификатора приложения, можно перезаписать существующую регистрацию в Azure AD, который использует тот URI ИД приложения.
4. После нажатия кнопки **ОК**, появится диалоговое окно входа в систему, и вам потребуется выполнить вход с использованием учетной записи глобального администратора (не Майкрософт учетной записи, связанной с вашей подпиской). Если ранее вы создали новую учетную запись администратора, будет необходимо изменить пароль, а затем войдите в систему, используя новый пароль.   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image9.png)
5. После вы успешно прошли проверку подлинности, **новый проект ASP.NET** диалоговом окне будут отображаться ваш выбор проверки подлинности (**организации** ) и каталог, где новое приложение будет зарегистрировано (*aricka0yahoo.onmicrosoft.com* на рисунке ниже). Ниже эти сведения, установленном флажке **узел в облаке**. Если этот флажок установлен, проект будет использован как веб-приложение Azure и будут включены для простой публикации позже. Нажмите кнопку **ОК**.   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image10.png)
6. **Настройка веб-сайта Azure** появится диалоговое окно, с помощью имени сайта, автоматически сгенерированный и региона. Также Обратите внимание, учетной записи, которую в данный момент вы вошли в в диалоговом окне. Будет необходимо убедиться, что эта учетная запись является тот, который присоединяется подписки Azure, обычно является учетной записью Майкрософт.

    > [!NOTE]
    > Этот проект требует базы данных. Необходимо выбрать один из существующих баз данных или создайте новую. Базы данных является обязательным, поскольку проект уже использует файл локальной базы данных для хранения небольшой объем данных конфигурации проверки подлинности. При развертывании приложения на веб-сайт Azure, эта база данных не упаковываются в развертывание, поэтому вам нужно выбрать один, который доступен в облаке. Нажмите кнопку **ОК**.

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image11.png)
7. Проект будет создан и вашей веб-приложения параметры и параметры проверки подлинности будут автоматически настроены с проектом. После завершения этого процесса запустите проект локально, нажав клавишу **^ F5**. Необходимо будет выполнить вход с использованием учетной записи организации. Укажите имя пользователя и пароль для учетной записи, созданной ранее и нажмите кнопку **входа**.   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image12.png)
8. После успешного входа в веб-сайте ASP.NET показывает, что вы прошли проверку подлинности, отображая имя пользователя в правом верхнем углу страницы.  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image13.png)  
  
   Если возникает ошибка.  
   Значение не может быть неопределенным или пустым. Имя параметра: linkText   
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image14.png)  
  
   в разделе [отладки](#dbg) в конце учебника.

## <a name="basics-of-the-graph-api"></a>Основные сведения о API Graph

[Graph API](https://msdn.microsoft.com/library/azure/hh974476.aspx) — это программный интерфейс, используемый для выполнения операций CRUD и других операций с объектами в каталоге Azure AD. Если выбран параметр учетной записи организации для проверки подлинности при создании нового проекта в Visual Studio 2013, приложение будет уже настроен для вызова Graph API. В этом разделе кратко показано, как работает Graph API.

1. В запущенном приложении, щелкните имя пользователя, выполнившего вход в верхней правой части страницы. Переходить на страницу профиля пользователя, что действие контроллера Home. Вы заметите, что таблица содержит сведения об учетной записи администратора созданной ранее. Эти сведения хранятся в каталоге и вызывает Graph API для получения этих сведений при загрузке страницы.   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image15.png)
2. Вернитесь в Visual Studio и разверните **контроллеров** папки, а затем откройте **HomeController.cs** файла. Вы увидите **UserProfile()** действие, которое содержит код для получения токена и затем вызывать Graph API. Этот код повторяется ниже: 

    [!code-csharp[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample1.cs?highlight=22)]

    Для вызова Graph API, сначала необходимо получить токен. При получении токена, его строковым значением должен быть добавлен в заголовок авторизации для всех последующих запросов к Graph API. Большая часть кода выше обрабатывает сведения проверки подлинности в Azure AD, чтобы получить маркер, использующее токен для вызова Graph API и затем преобразование ответ, чтобы оно может быть представлено в представлении.

    Наиболее участку обсуждение имеет следующую выделенную строку: `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`. Эта строка представляет имя пользователя, который был десериализован из ответа JSON и выводятся в представлении.

    Можно вызвать Graph API, с помощью HttpClient и самостоятельно обрабатывать необработанные данные, но более простым способом является использование [Graph клиентской библиотеки, который доступен через NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/). Клиентская библиотека обрабатывает необработанные HTTP-запросы и преобразования возвращаемых данных для вас и делает его намного легче работать с API Graph в среде .NET. Просмотрите образцы кода связанные Graph API на [GitHub.](https://github.com/AzureADSamples)

## <a name="deploy-the-application-to-azure"></a>Развертывание приложения в Azure

Ниже показано, как развернуть приложение в Azure. В предыдущих шагах подключен нового проекта с веб-приложения в Azure, поэтому он готов к опубликованию за несколько шагов.

1. В Visual Studio щелкните правой кнопкой мыши проект и выберите пункт **публикации**. **Веб-публикация** с каждым параметром, который уже настроен, появится диалоговое окно. Щелкните **Далее** кнопку, чтобы перейти к **параметры** страницы. Может быть предложено проверку подлинности; Убедитесь, что проверка подлинности с помощью учетной записи подписки Azure (обычно учетная запись Майкрософт) и не учетная запись организации, созданную ранее.  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image16.png)
2. Проверьте **включить проверку подлинности по организации** параметр. В **домена** введите домен для вашего каталога. Из **уровень доступа** раскрывающийся список, выберите **единый вход, чтение данных каталога**. Обратите внимание, что используется Прежняя база данных уже заполняется **баз данных** раздела. Нажмите кнопку **Опубликовать**.  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image17.png)
3. Visual Studio будет приступать к развертыванию веб-сайта, а затем появится новое окно браузера. Может быть предложено пройти проверку подлинности вашего каталога еще раз. Как только вы прошли проверку подлинности, вы будете перенаправлены на только что опубликованный веб-сайта в Azure.  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image18.png)

<a id="dbg"></a>
## <a name="debugging-the-app"></a>Отладка приложения

Если возникли следующие ошибки:   
 Значение не может быть неопределенным или пустым. Имя параметра: linkText   
   
![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image19.png)  
  

Замените код в *представления\общие\\_LoginPartial.cshtml* файл со следующим:

[!code-cshtml[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample2.cshtml?highlight=1-8,15-16)]

После запуска приложения, если пользователь «User Null», выйдите из системы и снова войти в учетную запись Active Directory, созданную ранее.

Рик Rainey является отличным учебника, выполните [глубокое погружение: веб-сайтов Azure и организации проверку подлинности с помощью Azure AD](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).

## <a name="more-information"></a>Дополнительные сведения

- [Подробное рассмотрение: Веб-сайтов Azure и организации проверку подлинности с помощью Azure AD](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/)
- [Общие сведения о Azure AD Graph API](https://msdn.microsoft.com/library/azure/hh974476.aspx)
- [Сценарии проверки подлинности в Azure AD](https://msdn.microsoft.com/library/azure/dn499820.aspx)
- [Примеры кода Azure AD на GitHub](https://github.com/AzureADSamples)
