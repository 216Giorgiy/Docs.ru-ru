---
uid: identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
title: Добавление ASP.NET Identity пустой или существующий веб-форм проекта | Документы Microsoft
author: raquelsa
description: Этот учебник демонстрирует добавление ASP.NET Identity (новый система членства для ASP.NET) для приложения ASP.NET. При создании нового веб-форм или MVC...
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/23/2013
ms.topic: article
ms.assetid: 1cbc0ed2-5bd6-4b62-8d34-4c193dcd8b25
ms.technology: ''
ms.prod: .net-framework
msc.legacyurl: /identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
msc.type: authoredcontent
ms.openlocfilehash: 8961e596f0d6cc4810e2439be1ec2915bddb8c78
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="adding-aspnet-identity-to-an-empty-or-existing-web-forms-project"></a><span data-ttu-id="2f66e-104">Добавление ASP.NET Identity пустой или существующий веб-форм проекта</span><span class="sxs-lookup"><span data-stu-id="2f66e-104">Adding ASP.NET Identity to an Empty or Existing Web Forms Project</span></span>
====================
<span data-ttu-id="2f66e-105">по [Raquel Soares De Almeida](https://github.com/raquelsa)</span><span class="sxs-lookup"><span data-stu-id="2f66e-105">by [Raquel Soares De Almeida](https://github.com/raquelsa)</span></span>

> <span data-ttu-id="2f66e-106">Этот учебник демонстрирует добавление [ASP.NET Identity](introduction-to-aspnet-identity.md) (новый система членства для ASP.NET) для приложения ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="2f66e-106">This tutorial shows you how to add [ASP.NET Identity](introduction-to-aspnet-identity.md) (the new membership system for ASP.NET) to an ASP.NET application.</span></span>
> 
> <span data-ttu-id="2f66e-107">При создании нового проекта веб-форм или MVC в Visual Studio 2013 RTM с отдельным учетным записям Visual Studio установите все необходимые пакеты и добавить все необходимые классы для вас.</span><span class="sxs-lookup"><span data-stu-id="2f66e-107">When you create a new Web Forms or MVC project in Visual Studio 2013 RTM with Individual Accounts, Visual Studio will install all the required packages and add all necessary classes for you.</span></span> <span data-ttu-id="2f66e-108">Этот учебник демонстрирует шаги для добавления поддержки ASP.NET Identity существующий проект веб-форм или новый пустой проект.</span><span class="sxs-lookup"><span data-stu-id="2f66e-108">This tutorial will illustrate the steps to add ASP.NET Identity support to your existing Web Forms project or a new empty project.</span></span> <span data-ttu-id="2f66e-109">Я будут указаны все пакеты NuGet, которые необходимо установить и классы, которые необходимо добавить.</span><span class="sxs-lookup"><span data-stu-id="2f66e-109">I will outline all the NuGet packages you need to install, and classes you need to add.</span></span> <span data-ttu-id="2f66e-110">Я будут рассмотрены образец веб-форм для входа в систему при выделении все основные элементы точки API-интерфейсы для управления пользователями и проверки подлинности и регистрации новых пользователей.</span><span class="sxs-lookup"><span data-stu-id="2f66e-110">I will go over sample Web Forms for registering new users and logging in while highlighting all main entry point APIs for user management and authentication.</span></span> <span data-ttu-id="2f66e-111">Этот образец использует реализацию по умолчанию ASP.NET Identity для хранения данных SQL, построенной на основе Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="2f66e-111">This sample will use the ASP.NET Identity default implementation for SQL data storage which is built on Entity Framework.</span></span> <span data-ttu-id="2f66e-112">Этого учебника мы будем использовать LocalDB для базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="2f66e-112">This tutorial, we will use LocalDB for the SQL database.</span></span>
> 
> <span data-ttu-id="2f66e-113">Этот учебник был записан с Raquel Soares De Almeida и Рик Андерсон ( [ @RickAndMSFT ](https://twitter.com/#!/RickAndMSFT) ).</span><span class="sxs-lookup"><span data-stu-id="2f66e-113">This tutorial was written by Raquel Soares De Almeida and Rick Anderson ( [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT) ).</span></span>


## <a name="getting-started-aspnet-identity"></a><span data-ttu-id="2f66e-114">Приступая к работе ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="2f66e-114">Getting Started ASP.NET Identity</span></span>

1. <span data-ttu-id="2f66e-115">Начните с установки и запуска [Visual Studio Express 2013 для Web](https://go.microsoft.com/fwlink/?LinkId=299058) или [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="2f66e-115">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span>
2. <span data-ttu-id="2f66e-116">Нажмите кнопку **новый проект** от начала страницы, или можно использовать меню и выберите **файл**, а затем **новый проект**.</span><span class="sxs-lookup"><span data-stu-id="2f66e-116">Click **New Project** from the Start page, or you can use the menu and select **File**, and then **New Project**.</span></span>
3. <span data-ttu-id="2f66e-117">Выберите **Visual C# i** n левой панели, затем **Web** , а затем выберите **веб-приложение ASP.NET**.</span><span class="sxs-lookup"><span data-stu-id="2f66e-117">Select **Visual C# i** n the left pane, then **Web** and then select **ASP.NET Web Application**.</span></span> <span data-ttu-id="2f66e-118">Назовите проект «WebFormsIdentity» и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="2f66e-118">Name your project "WebFormsIdentity" and then click **OK**.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image1.png)
4. <span data-ttu-id="2f66e-119">В **новый проект ASP.NET** диалогового окна выберите **пустой** шаблона.</span><span class="sxs-lookup"><span data-stu-id="2f66e-119">In the **New ASP.NET Project** dialog, select the **Empty** template.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image2.png)  
  
   <span data-ttu-id="2f66e-120">Обратите внимание **изменить аутентификацию** кнопка становится недоступной, и без проверки подлинности не поддерживается в этом шаблоне.</span><span class="sxs-lookup"><span data-stu-id="2f66e-120">Notice the **Change Authentication** button is disabled and no authentication support is provided in this template.</span></span> <span data-ttu-id="2f66e-121">Шаблоны веб-форм, MVC и веб-API позволяют выбрать способ проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="2f66e-121">The Web Forms, MVC and Web API templates allow you to select the authentication approach.</span></span> <span data-ttu-id="2f66e-122">Дополнительные сведения см. в разделе [обзор проверки подлинности](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth) .</span><span class="sxs-lookup"><span data-stu-id="2f66e-122">For more information, see [Overview of Authentication](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth) .</span></span>

## <a name="adding-identity-packages-to-your-app"></a><span data-ttu-id="2f66e-123">Добавление идентификаторов пакетов для приложения</span><span class="sxs-lookup"><span data-stu-id="2f66e-123">Adding Identity Packages to your App</span></span>

<span data-ttu-id="2f66e-124">В обозревателе решений щелкните правой кнопкой мыши проект и выберите **управление пакетами NuGet**.</span><span class="sxs-lookup"><span data-stu-id="2f66e-124">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="2f66e-125">В диалоговом окне поле текст поиска, введите «*Identity.E*».</span><span class="sxs-lookup"><span data-stu-id="2f66e-125">In the search text box dialog, type "*Identity.E*".</span></span> <span data-ttu-id="2f66e-126">Нажмите "установить" для этого пакета.</span><span class="sxs-lookup"><span data-stu-id="2f66e-126">Click install for this package.</span></span>   
  
![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image3.png)  
  
<span data-ttu-id="2f66e-127">Обратите внимание, что этот пакет будут установлены пакеты зависимостей: EntityFramework и Microsoft ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="2f66e-127">Note that this package will install the dependency packages: EntityFramework and Microsoft ASP.NET Identity Core.</span></span>

## <a name="adding-web-forms-to-register-users"></a><span data-ttu-id="2f66e-128">Добавление веб-формы для регистрации пользователей</span><span class="sxs-lookup"><span data-stu-id="2f66e-128">Adding Web Forms to Register Users</span></span>

1. <span data-ttu-id="2f66e-129">В **обозревателе решений**, щелкните правой кнопкой мыши проект и нажмите кнопку **добавить**, а затем **веб-формы**.</span><span class="sxs-lookup"><span data-stu-id="2f66e-129">In **Solution Explorer**, right-click your project and click **Add**, and then **Web Form**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image4.png)
2. <span data-ttu-id="2f66e-130">В **указания имени элемента** диалоговом имя новой веб-формы **зарегистрировать**, а затем нажмите кнопку **ОК**</span><span class="sxs-lookup"><span data-stu-id="2f66e-130">In the **Specify Name for Item** dialog box, name the new web form **Register**, and then click **OK**</span></span>
3. <span data-ttu-id="2f66e-131">Замените существующую разметку в созданном *Register.aspx* файла следующим кодом.</span><span class="sxs-lookup"><span data-stu-id="2f66e-131">Replace the markup in the generated *Register.aspx* file with the code below.</span></span> <span data-ttu-id="2f66e-132">Изменения в коде выделены.</span><span class="sxs-lookup"><span data-stu-id="2f66e-132">The code changes are highlighted.</span></span>   

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample1.aspx?highlight=9,12-40)]

    > [!NOTE]
    > <span data-ttu-id="2f66e-133">Это просто упрощенную версию *Register.aspx* файл, который создается при создании нового проекта веб-форм ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="2f66e-133">This is just a simplified version of the *Register.aspx* file that is created when you create a new ASP.NET Web Forms project.</span></span> <span data-ttu-id="2f66e-134">Показанная выше разметка добавляет поля формы и кнопку, чтобы зарегистрировать нового пользователя.</span><span class="sxs-lookup"><span data-stu-id="2f66e-134">The markup above adds form fields and a button to register a new user.</span></span>
4. <span data-ttu-id="2f66e-135">Откройте *Register.aspx.cs* и замените содержимое файла следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="2f66e-135">Open the *Register.aspx.cs* file and replace the contents of the file with the following code:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample2.cs)]

    > [!NOTE] 
    > 
    > 1. <span data-ttu-id="2f66e-136">Приведенный выше код является упрощенной версией *Register.aspx.cs* файл, который создается при создании нового проекта веб-форм ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="2f66e-136">The code above is a simplified version of the *Register.aspx.cs* file that is created when you create a new ASP.NET Web Forms project.</span></span>
    > 2. <span data-ttu-id="2f66e-137">*IdentityUser* класс является реализацией по умолчанию EntityFramework *IUser* интерфейса.</span><span class="sxs-lookup"><span data-stu-id="2f66e-137">The *IdentityUser* class is the default EntityFramework implementation of the *IUser* interface.</span></span> <span data-ttu-id="2f66e-138">*IUser* интерфейс — минимальный интерфейс пользователя в ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="2f66e-138">*IUser* interface is the minimal interface for a user on ASP.NET Identity Core.</span></span>
    > 3. <span data-ttu-id="2f66e-139">*UserStore* класс является реализацией EntityFramework по умолчанию хранилища пользователя.</span><span class="sxs-lookup"><span data-stu-id="2f66e-139">The *UserStore* class is the default EntityFramework implementation of a user store.</span></span> <span data-ttu-id="2f66e-140">Этот класс реализует ASP.NET Identity Core минимальным количеством интерфейсов: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* и *IUserRoleStore* .</span><span class="sxs-lookup"><span data-stu-id="2f66e-140">This class implements the ASP.NET Identity Core's minimal interfaces: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* and *IUserRoleStore*.</span></span>
    > 4. <span data-ttu-id="2f66e-141">*UserManager* класс предоставляет связанный с пользователем API-интерфейсов, который автоматически сохранит изменения *UserStore*.</span><span class="sxs-lookup"><span data-stu-id="2f66e-141">The *UserManager* class exposes user related APIs which will automatically save changes to the *UserStore*.</span></span>
    > 5. <span data-ttu-id="2f66e-142">*IdentityResult* класса представляет результат операции identity.</span><span class="sxs-lookup"><span data-stu-id="2f66e-142">The *IdentityResult* class represents the result of an identity operation.</span></span>
5. <span data-ttu-id="2f66e-143">В **обозревателе решений**, щелкните правой кнопкой мыши проект и нажмите кнопку **добавить**, **добавить папку ASP.NET** и затем **приложения\_данные**.</span><span class="sxs-lookup"><span data-stu-id="2f66e-143">In **Solution Explorer**, right-click your project and click **Add**, **Add ASP.NET Folder** and then **App\_Data**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image5.png)
6. <span data-ttu-id="2f66e-144">Откройте *Web.config* и добавьте строку подключения для базы данных, мы будем использовать для хранения информации о пользователях.</span><span class="sxs-lookup"><span data-stu-id="2f66e-144">Open the *Web.config* file and add a connection string entry for the database we will use to store user information.</span></span> <span data-ttu-id="2f66e-145">Базы данных создается во время выполнения, EntityFramework для идентификации сущности.</span><span class="sxs-lookup"><span data-stu-id="2f66e-145">The database will be created at runtime by EntityFramework for the Identity entities.</span></span> <span data-ttu-id="2f66e-146">Строка подключения похожее создается при создании нового проекта веб-форм.</span><span class="sxs-lookup"><span data-stu-id="2f66e-146">The connection string is similar to one created for you when you create a new Web Forms project.</span></span> <span data-ttu-id="2f66e-147">Выделенный код показана разметка, что следует добавить:</span><span class="sxs-lookup"><span data-stu-id="2f66e-147">The highlighted code shows the markup you should add:</span></span>

    [!code-xml[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample3.xml?highlight=11-14)]
    
    > [!NOTE] 
    > <span data-ttu-id="2f66e-148">Для Visual Studio 2015 или более поздней версии, замените `(localdb)\v11.0` с `(localdb)\MSSQLLocalDB` в строке подключения.</span><span class="sxs-lookup"><span data-stu-id="2f66e-148">For Visual Studio 2015 or higher, replace `(localdb)\v11.0` with `(localdb)\MSSQLLocalDB` in your connection string.</span></span>
    
7. <span data-ttu-id="2f66e-149">Щелкните правой кнопкой мыши файл *Register.aspx* в проект и выберите **задать в качестве начальной страницы**.</span><span class="sxs-lookup"><span data-stu-id="2f66e-149">Right click file *Register.aspx* in your project and select **Set as Start Page**.</span></span> <span data-ttu-id="2f66e-150">Нажмите клавиши Ctrl + F5 для построения и запуска веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="2f66e-150">Press Ctrl + F5 to build and run the web application.</span></span> <span data-ttu-id="2f66e-151">Введите новое имя пользователя и пароль и нажмите кнопку на **зарегистрировать**.</span><span class="sxs-lookup"><span data-stu-id="2f66e-151">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image6.png)  

    > [!NOTE]
    > <span data-ttu-id="2f66e-152">ASP.NET Identity поддерживает проверки, и в этом образце можно проверить поведение по умолчанию имя пользователя и пароль проверяющие элементы управления, поступающих из идентификаторов основного пакета.</span><span class="sxs-lookup"><span data-stu-id="2f66e-152">ASP.NET Identity has support for validation and in this sample you can verify the default behavior on User and Password validators that come from the Identity Core package.</span></span> <span data-ttu-id="2f66e-153">Проверяющий элемент управления по умолчанию для пользователя (`UserValidator`) имеет свойство `AllowOnlyAlphanumericUserNames` , имеет значение по умолчанию равно `true`.</span><span class="sxs-lookup"><span data-stu-id="2f66e-153">The default validator for User (`UserValidator`) has a property `AllowOnlyAlphanumericUserNames` that has default value set to `true`.</span></span> <span data-ttu-id="2f66e-154">Проверяющий элемент управления по умолчанию для пароля (`MinimumLengthValidator`) обеспечивает пароля, по крайней мере 6 символов.</span><span class="sxs-lookup"><span data-stu-id="2f66e-154">The default validator for Password (`MinimumLengthValidator`) ensures that password has at least 6 characters.</span></span> <span data-ttu-id="2f66e-155">Эти проверки включены свойства `UserManager` , может быть переопределен, если вы хотите использовать пользовательской проверки</span><span class="sxs-lookup"><span data-stu-id="2f66e-155">These validators are properties on `UserManager` that can be overridden if you want to have custom validation,</span></span>

## <a name="verifying-the-localdb-identity-database-and-tables-generated-by-entity-framework"></a><span data-ttu-id="2f66e-156">Проверка базы данных LocalDb удостоверений и таблицы, сформированные платформой Entity Framework</span><span class="sxs-lookup"><span data-stu-id="2f66e-156">Verifying the LocalDb Identity Database and Tables Generated by Entity Framework</span></span>

1. <span data-ttu-id="2f66e-157">В **представление** меню, нажмите кнопку **обозревателя серверов**.</span><span class="sxs-lookup"><span data-stu-id="2f66e-157">In the **View** menu, click **Server Explorer**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image7.png)
2. <span data-ttu-id="2f66e-158">Разверните **DefaultConnection (WebFormsIdentity)**, разверните **таблиц**, щелкните правой кнопкой мыши **AspNetUsers** и нажмите кнопку **Показать таблицу данных**.</span><span class="sxs-lookup"><span data-stu-id="2f66e-158">Expand **DefaultConnection (WebFormsIdentity)**, expand **Tables**, right click **AspNetUsers** and click **Show Table Data**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image8.png)  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image9.png)

## <a name="configuring-the-application-for-owin-authentication"></a><span data-ttu-id="2f66e-159">Настройка приложения для проверки подлинности OWIN</span><span class="sxs-lookup"><span data-stu-id="2f66e-159">Configuring the application for OWIN authentication</span></span>

<span data-ttu-id="2f66e-160">На этом этапе только добавлена поддержка для создания пользователей.</span><span class="sxs-lookup"><span data-stu-id="2f66e-160">At this point we have only added support for creating users.</span></span> <span data-ttu-id="2f66e-161">Теперь мы собираемся продемонстрировать, каким образом можно добавить проверки подлинности для входа в систему пользователя.</span><span class="sxs-lookup"><span data-stu-id="2f66e-161">Now, we are going to demonstrate how we can add authentication to login a user.</span></span> <span data-ttu-id="2f66e-162">ASP.NET Identity использует проверку подлинности Microsoft OWIN по промежуточного слоя для проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="2f66e-162">ASP.NET Identity uses Microsoft OWIN Authentication middleware for forms authentication.</span></span> <span data-ttu-id="2f66e-163">Проверка подлинности файла Cookie OWIN куки-файл и требует проверки подлинности на основе механизм, который может использоваться любой платформой, размещенных на [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) или IIS.</span><span class="sxs-lookup"><span data-stu-id="2f66e-163">The OWIN Cookie Authentication is a cookie and claims based authentication mechanism that can be used by any framework hosted on [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) or IIS.</span></span> <span data-ttu-id="2f66e-164">С этой моделью и те же пакеты проверки подлинности может использоваться в нескольких платформ, включая ASP.NET MVC и веб-форм.</span><span class="sxs-lookup"><span data-stu-id="2f66e-164">With this model, the same authentication packages can be used across multiple frameworks including ASP.NET MVC and Web Forms.</span></span> <span data-ttu-id="2f66e-165">Дополнительные сведения о проекте Katana и выполнения по промежуточного слоя см. в разделе, зависит от узла [Приступая к работе с проектом Katana](https://msdn.microsoft.com/magazine/dn451439.aspx).</span><span class="sxs-lookup"><span data-stu-id="2f66e-165">For more information on project Katana and how to run middleware in a host agnostic see [Getting Started with the Katana Project](https://msdn.microsoft.com/magazine/dn451439.aspx).</span></span>

## <a name="installing-authentication-packages-to-your-application"></a><span data-ttu-id="2f66e-166">Установка пакетов проверки подлинности для приложения</span><span class="sxs-lookup"><span data-stu-id="2f66e-166">Installing authentication packages to your application</span></span>

1. <span data-ttu-id="2f66e-167">В обозревателе решений щелкните правой кнопкой мыши проект и выберите **управление пакетами NuGet**.</span><span class="sxs-lookup"><span data-stu-id="2f66e-167">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="2f66e-168">В диалоговом окне поле текст поиска, введите «*Identity.Owin*».</span><span class="sxs-lookup"><span data-stu-id="2f66e-168">In the search text box dialog, type "*Identity.Owin*".</span></span> <span data-ttu-id="2f66e-169">Нажмите "установить" для этого пакета.</span><span class="sxs-lookup"><span data-stu-id="2f66e-169">Click install for this package.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image10.png)
2. <span data-ttu-id="2f66e-170">Выполните поиск пакета ***Microsoft.Owin.Host.SystemWeb*** и установить его.</span><span class="sxs-lookup"><span data-stu-id="2f66e-170">Search for package ***Microsoft.Owin.Host.SystemWeb*** and install it.</span></span>   

    > [!NOTE]
    > <span data-ttu-id="2f66e-171">**Microsoft.Aspnet.Identity.Owin** пакет содержит набор классов расширения OWIN по промежуточного слоя OWIN проверки подлинности для использования пакетов ASP.NET Identity Core настраивать и управлять ими.</span><span class="sxs-lookup"><span data-stu-id="2f66e-171">The **Microsoft.Aspnet.Identity.Owin** package contains a set of OWIN extension classes to manage and configure OWIN authentication middleware to be consumed by ASP.NET Identity Core packages.</span></span>  
    > <span data-ttu-id="2f66e-172">**Microsoft.Owin.Host.SystemWeb** пакет содержит сервере OWIN, который позволяет приложениям на основе OWIN для запуска в конвейере ASP.NET с помощью IIS.</span><span class="sxs-lookup"><span data-stu-id="2f66e-172">The **Microsoft.Owin.Host.SystemWeb** package contains an OWIN server that enables OWIN-based applications to run on IIS using the ASP.NET request pipeline.</span></span> <span data-ttu-id="2f66e-173">Дополнительные сведения см. [по промежуточного слоя OWIN в службах IIS интегрирован конвейера](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span><span class="sxs-lookup"><span data-stu-id="2f66e-173">For more information see [OWIN Middleware in the IIS integrated pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span></span>

## <a name="adding-owin-startup-and-authentication-configuration-classes"></a><span data-ttu-id="2f66e-174">Добавление запуска OWIN и классы конфигурации проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="2f66e-174">Adding OWIN Startup and Authentication Configuration Classes</span></span>

1. <span data-ttu-id="2f66e-175">В **обозревателе решений**, щелкните правой кнопкой мыши проект, нажмите кнопку **добавить**, а затем **Добавление нового элемента**.</span><span class="sxs-lookup"><span data-stu-id="2f66e-175">In **Solution Explorer**, right-click your project, click **Add**, and then **Add New Item**.</span></span> <span data-ttu-id="2f66e-176">В диалоговом окне поле текст поиска, введите «*owin*».</span><span class="sxs-lookup"><span data-stu-id="2f66e-176">In the search text box dialog, type "*owin*".</span></span> <span data-ttu-id="2f66e-177">Имя класса "*запуска*» и нажмите кнопку **добавить**.</span><span class="sxs-lookup"><span data-stu-id="2f66e-177">Name the class "*Startup*" and click **Add**.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image11.png)
2. <span data-ttu-id="2f66e-178">В файле Startup.cs-файле добавьте выделенный код, показано ниже, чтобы настроить проверку подлинности файла cookie OWIN.</span><span class="sxs-lookup"><span data-stu-id="2f66e-178">In the Startup.cs file, add the highlighted code shown below to configure OWIN cookie authentication.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample4.cs?highlight=1,3,15-19)]

    > [!NOTE]
    > <span data-ttu-id="2f66e-179">Этот класс содержит `OwinStartup` атрибут для указания класса запуска OWIN.</span><span class="sxs-lookup"><span data-stu-id="2f66e-179">This class contains the `OwinStartup` attribute for specifying the OWIN startup class.</span></span> <span data-ttu-id="2f66e-180">Каждое приложение OWIN имеет класс запуска, где указываются компоненты для конвейера приложения.</span><span class="sxs-lookup"><span data-stu-id="2f66e-180">Every OWIN application has a startup class where you specify components for the application pipeline.</span></span> <span data-ttu-id="2f66e-181">В разделе [определение класса запуска OWIN](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) Дополнительные сведения об этой модели.</span><span class="sxs-lookup"><span data-stu-id="2f66e-181">See [OWIN Startup Class Detection](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) for more info on this model.</span></span>

## <a name="adding-web-forms-for-registering-and-logging-in-users"></a><span data-ttu-id="2f66e-182">Добавление веб-формы для регистрации и входа пользователей</span><span class="sxs-lookup"><span data-stu-id="2f66e-182">Adding Web Forms for Registering and Logging in Users</span></span>

1. <span data-ttu-id="2f66e-183">Откройте *Register.cs* и добавьте следующий код, который будет вход пользователя при успешной регистрации файла.</span><span class="sxs-lookup"><span data-stu-id="2f66e-183">Open the *Register.cs* file and add the following code which will log in the user when registration succeeds.</span></span> <span data-ttu-id="2f66e-184">Изменения выделены ниже.</span><span class="sxs-lookup"><span data-stu-id="2f66e-184">The changes are highlighted below.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample5.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="2f66e-185">Поскольку ASP.NET Identity и проверки подлинности файла Cookie OWIN системы на основе утверждений, платформа требует разработчика приложений для создания [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) для пользователя.</span><span class="sxs-lookup"><span data-stu-id="2f66e-185">Since ASP.NET Identity and OWIN Cookie Authentication are claims based system, the framework requires the app developer to generate a [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) for the user.</span></span> <span data-ttu-id="2f66e-186">ClaimsIdentity приводятся сведения о всех утверждения для пользователя, такие как пользователь принадлежит к роли.</span><span class="sxs-lookup"><span data-stu-id="2f66e-186">ClaimsIdentity has information about all the claims for the user such as what Roles the user belongs to.</span></span> <span data-ttu-id="2f66e-187">На этом этапе также можно добавить дополнительные утверждения для пользователя.</span><span class="sxs-lookup"><span data-stu-id="2f66e-187">You can also add more claims for the user at this stage.</span></span>
    > - <span data-ttu-id="2f66e-188">Можно вход пользователя с помощью AuthenticationManager из OWIN и вызывая метод `SignIn` и передавая ClaimsIdentity, как показано выше.</span><span class="sxs-lookup"><span data-stu-id="2f66e-188">You can sign in the user by using the AuthenticationManager from OWIN and calling `SignIn` and passing in the ClaimsIdentity as shown above.</span></span> <span data-ttu-id="2f66e-189">Этот код будет вход пользователя и создавать также файл cookie.</span><span class="sxs-lookup"><span data-stu-id="2f66e-189">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="2f66e-190">Этот вызов является аналогом [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) используемые [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) модуля.</span><span class="sxs-lookup"><span data-stu-id="2f66e-190">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
2. <span data-ttu-id="2f66e-191">В **обозревателе решений**, щелкните правой кнопкой мыши щелкните ваш проект **добавить**, а затем **веб-формы**.</span><span class="sxs-lookup"><span data-stu-id="2f66e-191">In **Solution Explorer**, right-click your project click **Add**, and then **Web Form**.</span></span> <span data-ttu-id="2f66e-192">Имя веб-формы **входа**.</span><span class="sxs-lookup"><span data-stu-id="2f66e-192">Name the web form **Login**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image12.png)
3. <span data-ttu-id="2f66e-193">Замените содержимое *Login.aspx* файла следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="2f66e-193">Replace the contents of the *Login.aspx* file with the following code:</span></span>  

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample6.aspx)]
4. <span data-ttu-id="2f66e-194">Замените содержимое *Login.aspx.cs* файл со следующим:</span><span class="sxs-lookup"><span data-stu-id="2f66e-194">Replace the contents of the *Login.aspx.cs* file with the following:</span></span>  

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample7.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="2f66e-195">`Page_Load` Теперь проверяет состояние текущего пользователя и выполняет действие на основе его `Context.User.Identity.IsAuthenticated` состояния.</span><span class="sxs-lookup"><span data-stu-id="2f66e-195">The `Page_Load` now checks for the status of current user and takes action based on its `Context.User.Identity.IsAuthenticated` status.</span></span>  
    >     <span data-ttu-id="2f66e-196">**Отображения регистрации в имени пользователя** : Microsoft ASP.NET Identity Framework перечислил методы расширения в [System.Security.Principal.IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) , позволяющий получить `UserName` и `UserId` для Пользователь, вошедший в систему.</span><span class="sxs-lookup"><span data-stu-id="2f66e-196">**Display Logged in User Name** : The Microsoft ASP.NET Identity Framework has added extension methods on [System.Security.Principal.IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) that allows you to get the `UserName` and `UserId`  for the logged in User.</span></span> <span data-ttu-id="2f66e-197">Эти методы расширения определяются в `Microsoft.AspNet.Identity.Core` сборки.</span><span class="sxs-lookup"><span data-stu-id="2f66e-197">These extension methods are defined in the `Microsoft.AspNet.Identity.Core` assembly.</span></span> <span data-ttu-id="2f66e-198">Эти методы расширения являются заменой [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span><span class="sxs-lookup"><span data-stu-id="2f66e-198">These extension methods are the replacement for [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span></span>
    > - <span data-ttu-id="2f66e-199">Метод входа:</span><span class="sxs-lookup"><span data-stu-id="2f66e-199">SignIn method:</span></span>   
    >     <span data-ttu-id="2f66e-200">`This` метод заменяет предыдущий `CreateUser_Click` метод в этот пример и теперь выполняет вход пользователя после успешного создания пользователя.</span><span class="sxs-lookup"><span data-stu-id="2f66e-200">`This` method replaces the previous `CreateUser_Click` method in this sample and now signs in the user after successfully creating the user.</span></span>   
    >  <span data-ttu-id="2f66e-201">Платформа Microsoft OWIN добавил методы расширения `System.Web.HttpContext` , позволяющий получить ссылку на `IOwinContext`.</span><span class="sxs-lookup"><span data-stu-id="2f66e-201">The Microsoft OWIN Framework has added extension methods on `System.Web.HttpContext` that allows you to get a reference to an `IOwinContext`.</span></span> <span data-ttu-id="2f66e-202">Эти методы расширения определяются в `Microsoft.Owin.Host.SystemWeb` сборки.</span><span class="sxs-lookup"><span data-stu-id="2f66e-202">These extension methods are defined in `Microsoft.Owin.Host.SystemWeb` assembly.</span></span> <span data-ttu-id="2f66e-203">`OwinContext` Предоставляемых классами `IAuthenticationManager` свойство, которое представляет функциональные возможности по промежуточного слоя проверки подлинности, доступные в текущем запросе.</span><span class="sxs-lookup"><span data-stu-id="2f66e-203">The `OwinContext` class exposes an `IAuthenticationManager` property that represents the Authentication middleware functionality available on the current request.</span></span>  
    >  <span data-ttu-id="2f66e-204">Пользователь может войти с помощью `AuthenticationManager` из OWIN и вызывая метод `SignIn` и передача в `ClaimsIdentity` как показано выше.</span><span class="sxs-lookup"><span data-stu-id="2f66e-204">You can sign in the user by using the `AuthenticationManager` from OWIN and calling `SignIn`  and passing in the `ClaimsIdentity`  as shown above.</span></span>   
    >  <span data-ttu-id="2f66e-205">Поскольку ASP.NET Identity и проверки подлинности файла Cookie OWIN системы на основе утверждений, платформа требует приложение, чтобы создать `ClaimsIdentity` для пользователя.</span><span class="sxs-lookup"><span data-stu-id="2f66e-205">Because ASP.NET Identity and OWIN Cookie Authentication are claims-based system, the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span>   
    >  <span data-ttu-id="2f66e-206">`ClaimsIdentity` Содержит сведения о всех утверждений для пользователя, такие как пользователь принадлежит к роли.</span><span class="sxs-lookup"><span data-stu-id="2f66e-206">The `ClaimsIdentity` has information about all the claims for the user, such as what roles the user belongs to.</span></span> <span data-ttu-id="2f66e-207">На этом этапе также можно добавить дополнительные утверждения для пользователя</span><span class="sxs-lookup"><span data-stu-id="2f66e-207">You can also add more claims for the user at this stage</span></span>  
    >  <span data-ttu-id="2f66e-208">Этот код будет вход пользователя и создавать также файл cookie.</span><span class="sxs-lookup"><span data-stu-id="2f66e-208">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="2f66e-209">Этот вызов является аналогом [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) используемые [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) модуля.</span><span class="sxs-lookup"><span data-stu-id="2f66e-209">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
    > - <span data-ttu-id="2f66e-210">`SignOut` метод:</span><span class="sxs-lookup"><span data-stu-id="2f66e-210">`SignOut` method:</span></span>   
    >  <span data-ttu-id="2f66e-211">Возвращает ссылку на `AuthenticationManager` из OWIN и вызывает `SignOut`.</span><span class="sxs-lookup"><span data-stu-id="2f66e-211">Gets a reference to the `AuthenticationManager` from OWIN and calls `SignOut`.</span></span> <span data-ttu-id="2f66e-212">Это аналогично [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) метод, используемый для [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) модуля.</span><span class="sxs-lookup"><span data-stu-id="2f66e-212">This is analogous to [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) method used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
5. <span data-ttu-id="2f66e-213">Нажмите клавишу **сочетание клавиш Ctrl + F5** для построения и запуска веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="2f66e-213">Press **Ctrl + F5** to build and run the web application.</span></span> <span data-ttu-id="2f66e-214">Введите новое имя пользователя и пароль и нажмите кнопку на **зарегистрировать**.</span><span class="sxs-lookup"><span data-stu-id="2f66e-214">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image13.png)  
   <span data-ttu-id="2f66e-215">Примечание: на этом этапе новый пользователь создается и вход.</span><span class="sxs-lookup"><span data-stu-id="2f66e-215">Note: At this point, the new user is created and logged in.</span></span>
6. <span data-ttu-id="2f66e-216">Щелкните **Выход** кнопки. Вы будете перенаправлены в журнале в форме.</span><span class="sxs-lookup"><span data-stu-id="2f66e-216">Click on **Log out** button.You will be redirected to the Log in form.</span></span>
7. <span data-ttu-id="2f66e-217">Введите на недопустимое имя пользователя или пароль и нажмите кнопку **входа** кнопки.</span><span class="sxs-lookup"><span data-stu-id="2f66e-217">Enter an invalid user name or password and Click on **Log in** button.</span></span>   
   <span data-ttu-id="2f66e-218">`UserManager.Find` Метод вернет значение null, а сообщение об ошибке: « *недопустимое имя пользователя или пароль* » будет отображаться.</span><span class="sxs-lookup"><span data-stu-id="2f66e-218">The `UserManager.Find`  method will return null and the error message: " *Invalid user name or password* " will be displayed.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image14.png)
