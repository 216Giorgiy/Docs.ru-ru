---
uid: identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
title: Добавление ASP.NET Identity к пустой или существующий веб-проект форм | Документация Майкрософт
author: raquelsa
description: Этом руководстве показано, как добавление ASP.NET Identity (новая система членства для ASP.NET) в приложение ASP.NET. При создании нового веб-форм или MVC...
ms.author: aspnetcontent
ms.date: 10/23/2013
ms.assetid: 1cbc0ed2-5bd6-4b62-8d34-4c193dcd8b25
msc.legacyurl: /identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
msc.type: authoredcontent
ms.openlocfilehash: 1e7508fc2431f4e1e3c4509fbe705daf42686e8d
ms.sourcegitcommit: b28cd0313af316c051c2ff8549865bff67f2fbb4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/05/2018
ms.locfileid: "37832666"
---
<a name="adding-aspnet-identity-to-an-empty-or-existing-web-forms-project"></a><span data-ttu-id="c896a-104">Добавление ASP.NET Identity в пустой или существующий веб-проект форм</span><span class="sxs-lookup"><span data-stu-id="c896a-104">Adding ASP.NET Identity to an Empty or Existing Web Forms Project</span></span>
====================
<span data-ttu-id="c896a-105">по [Raquel Soares De Almeida](https://github.com/raquelsa)</span><span class="sxs-lookup"><span data-stu-id="c896a-105">by [Raquel Soares De Almeida](https://github.com/raquelsa)</span></span>

> <span data-ttu-id="c896a-106">Этот учебник демонстрирует добавление [ASP.NET Identity](introduction-to-aspnet-identity.md) (новая система членства для ASP.NET) для приложений ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c896a-106">This tutorial shows you how to add [ASP.NET Identity](introduction-to-aspnet-identity.md) (the new membership system for ASP.NET) to an ASP.NET application.</span></span>
> 
> <span data-ttu-id="c896a-107">При создании нового проекта веб-форм или MVC в Visual Studio 2013 RTM отдельные учетные записи Visual Studio установите все необходимые пакеты и добавить все необходимые классы для вас.</span><span class="sxs-lookup"><span data-stu-id="c896a-107">When you create a new Web Forms or MVC project in Visual Studio 2013 RTM with Individual Accounts, Visual Studio will install all the required packages and add all necessary classes for you.</span></span> <span data-ttu-id="c896a-108">Этот учебник будет покажем, как добавить поддержку ASP.NET Identity в существующий проект веб-форм или новый пустой проект.</span><span class="sxs-lookup"><span data-stu-id="c896a-108">This tutorial will illustrate the steps to add ASP.NET Identity support to your existing Web Forms project or a new empty project.</span></span> <span data-ttu-id="c896a-109">Я рассмотрю все пакеты NuGet, которые необходимо установить и классы, которые необходимо добавить.</span><span class="sxs-lookup"><span data-stu-id="c896a-109">I will outline all the NuGet packages you need to install, and classes you need to add.</span></span> <span data-ttu-id="c896a-110">Я будут рассмотрены пример веб-форм для регистрации новых пользователей и вход в систему, выделите все основные элементы точки API-интерфейсы для управления пользователями и проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="c896a-110">I will go over sample Web Forms for registering new users and logging in while highlighting all main entry point APIs for user management and authentication.</span></span> <span data-ttu-id="c896a-111">В этом примере будет использоваться реализация по умолчанию ASP.NET Identity для хранилища данных SQL, которая построена на платформе Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="c896a-111">This sample will use the ASP.NET Identity default implementation for SQL data storage which is built on Entity Framework.</span></span> <span data-ttu-id="c896a-112">Этом руководстве мы будем использовать LocalDB для базы данных SQL.</span><span class="sxs-lookup"><span data-stu-id="c896a-112">This tutorial, we will use LocalDB for the SQL database.</span></span>
> 
> <span data-ttu-id="c896a-113">Это руководство было написано с Raquel Soares De Almeida и Рик Андерсон ( [ @RickAndMSFT ](https://twitter.com/#!/RickAndMSFT) ).</span><span class="sxs-lookup"><span data-stu-id="c896a-113">This tutorial was written by Raquel Soares De Almeida and Rick Anderson ( [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT) ).</span></span>


## <a name="getting-started-aspnet-identity"></a><span data-ttu-id="c896a-114">Приступая к работе ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="c896a-114">Getting Started ASP.NET Identity</span></span>

1. <span data-ttu-id="c896a-115">Начните с установки и запуска [Visual Studio Express 2013 для Web](https://go.microsoft.com/fwlink/?LinkId=299058) или [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="c896a-115">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span>
2. <span data-ttu-id="c896a-116">Нажмите кнопку **новый проект** от начала страницы, или можно использовать меню и выберите **файл**, а затем **новый проект**.</span><span class="sxs-lookup"><span data-stu-id="c896a-116">Click **New Project** from the Start page, or you can use the menu and select **File**, and then **New Project**.</span></span>
3. <span data-ttu-id="c896a-117">Выберите **Visual C# i** n левой панели, затем **Web** , а затем выберите **веб-приложение ASP.NET**.</span><span class="sxs-lookup"><span data-stu-id="c896a-117">Select **Visual C# i** n the left pane, then **Web** and then select **ASP.NET Web Application**.</span></span> <span data-ttu-id="c896a-118">Имя проекта «WebFormsIdentity» и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="c896a-118">Name your project "WebFormsIdentity" and then click **OK**.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image1.png)
4. <span data-ttu-id="c896a-119">В **новый проект ASP.NET** диалоговом окне выберите **пустой** шаблона.</span><span class="sxs-lookup"><span data-stu-id="c896a-119">In the **New ASP.NET Project** dialog, select the **Empty** template.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image2.png)  
  
   <span data-ttu-id="c896a-120">Обратите внимание, что **изменить способ проверки подлинности** кнопка отключена, поддержка проверки подлинности, не предоставляется в этом шаблоне.</span><span class="sxs-lookup"><span data-stu-id="c896a-120">Notice the **Change Authentication** button is disabled and no authentication support is provided in this template.</span></span> <span data-ttu-id="c896a-121">Шаблоны веб-форм, MVC и веб-API позволяют выбрать подход к проверке подлинности.</span><span class="sxs-lookup"><span data-stu-id="c896a-121">The Web Forms, MVC and Web API templates allow you to select the authentication approach.</span></span> <span data-ttu-id="c896a-122">Дополнительные сведения см. в разделе [обзор проверки подлинности](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth) .</span><span class="sxs-lookup"><span data-stu-id="c896a-122">For more information, see [Overview of Authentication](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth) .</span></span>

## <a name="adding-identity-packages-to-your-app"></a><span data-ttu-id="c896a-123">Добавление пакетов удостоверений в приложение</span><span class="sxs-lookup"><span data-stu-id="c896a-123">Adding Identity Packages to your App</span></span>

<span data-ttu-id="c896a-124">В обозревателе решений щелкните правой кнопкой мыши проект и выберите **управление пакетами NuGet**.</span><span class="sxs-lookup"><span data-stu-id="c896a-124">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="c896a-125">В диалоговом поле поиска текста, введите "*Identity.E*«.</span><span class="sxs-lookup"><span data-stu-id="c896a-125">In the search text box dialog, type "*Identity.E*".</span></span> <span data-ttu-id="c896a-126">Нажмите кнопку установить для этого пакета.</span><span class="sxs-lookup"><span data-stu-id="c896a-126">Click install for this package.</span></span>   
  
![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image3.png)  
  
<span data-ttu-id="c896a-127">Обратите внимание, что этот пакет устанавливается пакеты зависимостей: EntityFramework и Microsoft ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="c896a-127">Note that this package will install the dependency packages: EntityFramework and Microsoft ASP.NET Identity Core.</span></span>

## <a name="adding-web-forms-to-register-users"></a><span data-ttu-id="c896a-128">Добавление веб-форм для регистрации пользователей</span><span class="sxs-lookup"><span data-stu-id="c896a-128">Adding Web Forms to Register Users</span></span>

1. <span data-ttu-id="c896a-129">В **обозревателе решений**, щелкните правой кнопкой мыши проект и нажмите кнопку **добавить**, а затем **веб-формы**.</span><span class="sxs-lookup"><span data-stu-id="c896a-129">In **Solution Explorer**, right-click your project and click **Add**, and then **Web Form**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image4.png)
2. <span data-ttu-id="c896a-130">В **указания имени элемента** диалоговом окне имя новой веб-формы **зарегистрировать**, а затем нажмите кнопку **ОК**</span><span class="sxs-lookup"><span data-stu-id="c896a-130">In the **Specify Name for Item** dialog box, name the new web form **Register**, and then click **OK**</span></span>
3. <span data-ttu-id="c896a-131">Замените существующую разметку в созданном *Register.aspx* файла следующим кодом.</span><span class="sxs-lookup"><span data-stu-id="c896a-131">Replace the markup in the generated *Register.aspx* file with the code below.</span></span> <span data-ttu-id="c896a-132">Изменения в коде выделены.</span><span class="sxs-lookup"><span data-stu-id="c896a-132">The code changes are highlighted.</span></span>   

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample1.aspx?highlight=9,12-40)]

    > [!NOTE]
    > <span data-ttu-id="c896a-133">Это просто упрощенную версию *Register.aspx* файл, который создается при создании нового проекта веб-форм ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c896a-133">This is just a simplified version of the *Register.aspx* file that is created when you create a new ASP.NET Web Forms project.</span></span> <span data-ttu-id="c896a-134">Приведенная выше разметка добавляет поля формы и кнопку для регистрации нового пользователя.</span><span class="sxs-lookup"><span data-stu-id="c896a-134">The markup above adds form fields and a button to register a new user.</span></span>
4. <span data-ttu-id="c896a-135">Откройте *Register.aspx.cs* файл и замените содержимое файла следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="c896a-135">Open the *Register.aspx.cs* file and replace the contents of the file with the following code:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample2.cs)]

    > [!NOTE] 
    > 
    > 1. <span data-ttu-id="c896a-136">Приведенный выше код представляет упрощенную версию *Register.aspx.cs* файл, который создается при создании нового проекта веб-форм ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c896a-136">The code above is a simplified version of the *Register.aspx.cs* file that is created when you create a new ASP.NET Web Forms project.</span></span>
    > 2. <span data-ttu-id="c896a-137">*IdentityUser* класс является реализацией по умолчанию EntityFramework *IUser* интерфейс.</span><span class="sxs-lookup"><span data-stu-id="c896a-137">The *IdentityUser* class is the default EntityFramework implementation of the *IUser* interface.</span></span> <span data-ttu-id="c896a-138">*IUser* это минимальный интерфейс для пользователя на удостоверение ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="c896a-138">*IUser* interface is the minimal interface for a user on ASP.NET Identity Core.</span></span>
    > 3. <span data-ttu-id="c896a-139">*UserStore* класс является реализацией EntityFramework по умолчанию из хранилища пользователя.</span><span class="sxs-lookup"><span data-stu-id="c896a-139">The *UserStore* class is the default EntityFramework implementation of a user store.</span></span> <span data-ttu-id="c896a-140">Этот класс реализует минимальным количеством интерфейсов ASP.NET Identity Core: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* и *IUserRoleStore* .</span><span class="sxs-lookup"><span data-stu-id="c896a-140">This class implements the ASP.NET Identity Core's minimal interfaces: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* and *IUserRoleStore*.</span></span>
    > 4. <span data-ttu-id="c896a-141">*UserManager* класс предоставляет связанный с пользователем API-интерфейсов, который автоматически сохранит изменения *UserStore*.</span><span class="sxs-lookup"><span data-stu-id="c896a-141">The *UserManager* class exposes user related APIs which will automatically save changes to the *UserStore*.</span></span>
    > 5. <span data-ttu-id="c896a-142">*IdentityResult* класса представляет результат операции identity.</span><span class="sxs-lookup"><span data-stu-id="c896a-142">The *IdentityResult* class represents the result of an identity operation.</span></span>
5. <span data-ttu-id="c896a-143">В **обозревателе решений**, щелкните правой кнопкой мыши проект и нажмите кнопку **добавить**, **добавить папку ASP.NET** и затем **приложения\_данных**.</span><span class="sxs-lookup"><span data-stu-id="c896a-143">In **Solution Explorer**, right-click your project and click **Add**, **Add ASP.NET Folder** and then **App\_Data**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image5.png)
6. <span data-ttu-id="c896a-144">Откройте *Web.config* файл и добавьте запись строки соединения для базы данных, мы будем использовать для хранения пользовательских данных.</span><span class="sxs-lookup"><span data-stu-id="c896a-144">Open the *Web.config* file and add a connection string entry for the database we will use to store user information.</span></span> <span data-ttu-id="c896a-145">Базы данных создается во время выполнения, EntityFramework для идентификации сущностей.</span><span class="sxs-lookup"><span data-stu-id="c896a-145">The database will be created at runtime by EntityFramework for the Identity entities.</span></span> <span data-ttu-id="c896a-146">Строка подключения похожа на один создаются автоматически при создании проекта веб-форм.</span><span class="sxs-lookup"><span data-stu-id="c896a-146">The connection string is similar to one created for you when you create a new Web Forms project.</span></span> <span data-ttu-id="c896a-147">Выделенный код показана разметка, который необходимо добавить:</span><span class="sxs-lookup"><span data-stu-id="c896a-147">The highlighted code shows the markup you should add:</span></span>

    [!code-xml[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample3.xml?highlight=11-14)]
    
    > [!NOTE] 
    > <span data-ttu-id="c896a-148">Для Visual Studio 2015 или более поздней версии, замените `(localdb)\v11.0` с `(localdb)\MSSQLLocalDB` в строке подключения.</span><span class="sxs-lookup"><span data-stu-id="c896a-148">For Visual Studio 2015 or higher, replace `(localdb)\v11.0` with `(localdb)\MSSQLLocalDB` in your connection string.</span></span>
    
7. <span data-ttu-id="c896a-149">Щелкните правой кнопкой мыши файл *Register.aspx* в проект, выберите **задать в качестве начальной страницы**.</span><span class="sxs-lookup"><span data-stu-id="c896a-149">Right click file *Register.aspx* in your project and select **Set as Start Page**.</span></span> <span data-ttu-id="c896a-150">Нажмите клавиши Ctrl + F5 для сборки и запуска веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="c896a-150">Press Ctrl + F5 to build and run the web application.</span></span> <span data-ttu-id="c896a-151">Введите новое имя пользователя и пароль и нажмите кнопку на **зарегистрировать**.</span><span class="sxs-lookup"><span data-stu-id="c896a-151">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image6.png)  

    > [!NOTE]
    > <span data-ttu-id="c896a-152">Удостоверение ASP.NET имеет поддержку проверки и в этом примере можно проверить поведение по умолчанию для пользователя и пароль проверяющие элементы управления, полученные из удостоверения основного пакета.</span><span class="sxs-lookup"><span data-stu-id="c896a-152">ASP.NET Identity has support for validation and in this sample you can verify the default behavior on User and Password validators that come from the Identity Core package.</span></span> <span data-ttu-id="c896a-153">Проверяющий элемент управления по умолчанию для пользователя (`UserValidator`) имеет свойство `AllowOnlyAlphanumericUserNames` , имеет значение по умолчанию, равным `true`.</span><span class="sxs-lookup"><span data-stu-id="c896a-153">The default validator for User (`UserValidator`) has a property `AllowOnlyAlphanumericUserNames` that has default value set to `true`.</span></span> <span data-ttu-id="c896a-154">Проверяющий элемент управления по умолчанию для пароля (`MinimumLengthValidator`) гарантирует, что пароль имеет по крайней мере 6 символов.</span><span class="sxs-lookup"><span data-stu-id="c896a-154">The default validator for Password (`MinimumLengthValidator`) ensures that password has at least 6 characters.</span></span> <span data-ttu-id="c896a-155">Эти проверяющие элементы управления являются свойствами на `UserManager` , можно переопределить, чтобы пользовательская проверка</span><span class="sxs-lookup"><span data-stu-id="c896a-155">These validators are properties on `UserManager` that can be overridden if you want to have custom validation,</span></span>

## <a name="verifying-the-localdb-identity-database-and-tables-generated-by-entity-framework"></a><span data-ttu-id="c896a-156">Проверка базы данных LocalDb удостоверений и таблиц, созданным Entity Framework</span><span class="sxs-lookup"><span data-stu-id="c896a-156">Verifying the LocalDb Identity Database and Tables Generated by Entity Framework</span></span>

1. <span data-ttu-id="c896a-157">В **представление** меню, щелкните **обозревателя серверов**.</span><span class="sxs-lookup"><span data-stu-id="c896a-157">In the **View** menu, click **Server Explorer**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image7.png)
2. <span data-ttu-id="c896a-158">Разверните **DefaultConnection (WebFormsIdentity)**, разверните **таблиц**, щелкните правой кнопкой мыши **AspNetUsers** и нажмите кнопку **Показать таблицу данных**.</span><span class="sxs-lookup"><span data-stu-id="c896a-158">Expand **DefaultConnection (WebFormsIdentity)**, expand **Tables**, right click **AspNetUsers** and click **Show Table Data**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image8.png)  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image9.png)

## <a name="configuring-the-application-for-owin-authentication"></a><span data-ttu-id="c896a-159">Настройка приложения для проверки подлинности OWIN</span><span class="sxs-lookup"><span data-stu-id="c896a-159">Configuring the application for OWIN authentication</span></span>

<span data-ttu-id="c896a-160">На этом этапе только добавлена поддержка создания пользователей.</span><span class="sxs-lookup"><span data-stu-id="c896a-160">At this point we have only added support for creating users.</span></span> <span data-ttu-id="c896a-161">Теперь мы собираемся продемонстрировать, как мы можем добавить проверку подлинности для входа в систему пользователя.</span><span class="sxs-lookup"><span data-stu-id="c896a-161">Now, we are going to demonstrate how we can add authentication to login a user.</span></span> <span data-ttu-id="c896a-162">ASP.NET Identity использует Microsoft OWIN по промежуточного слоя для проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="c896a-162">ASP.NET Identity uses Microsoft OWIN Authentication middleware for forms authentication.</span></span> <span data-ttu-id="c896a-163">Файл Cookie проверки подлинности OWIN, является файлом cookie и утверждений проверки подлинности на основе механизм, который может использоваться любой платформой, размещенных на [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) или IIS.</span><span class="sxs-lookup"><span data-stu-id="c896a-163">The OWIN Cookie Authentication is a cookie and claims based authentication mechanism that can be used by any framework hosted on [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) or IIS.</span></span> <span data-ttu-id="c896a-164">В этой модели можно использовать те же пакеты проверки подлинности на нескольких платформах, включая ASP.NET MVC и Web Forms.</span><span class="sxs-lookup"><span data-stu-id="c896a-164">With this model, the same authentication packages can be used across multiple frameworks including ASP.NET MVC and Web Forms.</span></span> <span data-ttu-id="c896a-165">Дополнительные сведения о проекта Katana и способах выполнения по промежуточного слоя. в разделе, зависит от узла [Приступая к работе с проектом Katana](https://msdn.microsoft.com/magazine/dn451439.aspx).</span><span class="sxs-lookup"><span data-stu-id="c896a-165">For more information on project Katana and how to run middleware in a host agnostic see [Getting Started with the Katana Project](https://msdn.microsoft.com/magazine/dn451439.aspx).</span></span>

## <a name="installing-authentication-packages-to-your-application"></a><span data-ttu-id="c896a-166">Установка пакетов проверки подлинности в приложение</span><span class="sxs-lookup"><span data-stu-id="c896a-166">Installing authentication packages to your application</span></span>

1. <span data-ttu-id="c896a-167">В обозревателе решений щелкните правой кнопкой мыши проект и выберите **управление пакетами NuGet**.</span><span class="sxs-lookup"><span data-stu-id="c896a-167">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="c896a-168">В диалоговом поле поиска текста, введите "*Identity.Owin*«.</span><span class="sxs-lookup"><span data-stu-id="c896a-168">In the search text box dialog, type "*Identity.Owin*".</span></span> <span data-ttu-id="c896a-169">Нажмите кнопку установить для этого пакета.</span><span class="sxs-lookup"><span data-stu-id="c896a-169">Click install for this package.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image10.png)
2. <span data-ttu-id="c896a-170">Найдите пакет ***Microsoft.Owin.Host.SystemWeb*** и установите его.</span><span class="sxs-lookup"><span data-stu-id="c896a-170">Search for package ***Microsoft.Owin.Host.SystemWeb*** and install it.</span></span>   

    > [!NOTE]
    > <span data-ttu-id="c896a-171">**Microsoft.Aspnet.Identity.Owin** пакет содержит набор классов расширения OWIN для управления и настройки по промежуточного слоя проверки подлинности OWIN для использования процессом пакеты ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="c896a-171">The **Microsoft.Aspnet.Identity.Owin** package contains a set of OWIN extension classes to manage and configure OWIN authentication middleware to be consumed by ASP.NET Identity Core packages.</span></span>  
    > <span data-ttu-id="c896a-172">**Microsoft.Owin.Host.SystemWeb** пакет содержит это сервер OWIN, который позволяет приложениям на базе OWIN для запуска в IIS с помощью конвейера запросов ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c896a-172">The **Microsoft.Owin.Host.SystemWeb** package contains an OWIN server that enables OWIN-based applications to run on IIS using the ASP.NET request pipeline.</span></span> <span data-ttu-id="c896a-173">Дополнительные сведения см. в разделе [по промежуточного слоя OWIN в службах IIS интегрирован конвейера](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span><span class="sxs-lookup"><span data-stu-id="c896a-173">For more information see [OWIN Middleware in the IIS integrated pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span></span>

## <a name="adding-owin-startup-and-authentication-configuration-classes"></a><span data-ttu-id="c896a-174">Добавление OWIN Startup и классы конфигурации проверки подлинности</span><span class="sxs-lookup"><span data-stu-id="c896a-174">Adding OWIN Startup and Authentication Configuration Classes</span></span>

1. <span data-ttu-id="c896a-175">В **обозревателе решений**, щелкните правой кнопкой мыши проект, нажмите кнопку **добавить**, а затем **Добавление нового элемента**.</span><span class="sxs-lookup"><span data-stu-id="c896a-175">In **Solution Explorer**, right-click your project, click **Add**, and then **Add New Item**.</span></span> <span data-ttu-id="c896a-176">В диалоговом поле поиска текста, введите "*owin*«.</span><span class="sxs-lookup"><span data-stu-id="c896a-176">In the search text box dialog, type "*owin*".</span></span> <span data-ttu-id="c896a-177">Имя класса "*запуска*" и нажмите кнопку **добавить**.</span><span class="sxs-lookup"><span data-stu-id="c896a-177">Name the class "*Startup*" and click **Add**.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image11.png)
2. <span data-ttu-id="c896a-178">В файле Startup.cs добавьте выделенный код, показано ниже, чтобы настроить проверку подлинности файла cookie OWIN.</span><span class="sxs-lookup"><span data-stu-id="c896a-178">In the Startup.cs file, add the highlighted code shown below to configure OWIN cookie authentication.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample4.cs?highlight=1,3,15-19)]

    > [!NOTE]
    > <span data-ttu-id="c896a-179">Этот класс содержит `OwinStartup` атрибут для указания класса запуска OWIN.</span><span class="sxs-lookup"><span data-stu-id="c896a-179">This class contains the `OwinStartup` attribute for specifying the OWIN startup class.</span></span> <span data-ttu-id="c896a-180">Каждое приложение OWIN имеет класс запуска, где указываются компоненты конвейера приложения.</span><span class="sxs-lookup"><span data-stu-id="c896a-180">Every OWIN application has a startup class where you specify components for the application pipeline.</span></span> <span data-ttu-id="c896a-181">См. в разделе [определение класса запуска OWIN](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) Дополнительные сведения об этой модели.</span><span class="sxs-lookup"><span data-stu-id="c896a-181">See [OWIN Startup Class Detection](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) for more info on this model.</span></span>

## <a name="adding-web-forms-for-registering-and-logging-in-users"></a><span data-ttu-id="c896a-182">Добавление веб-форм для регистрации и входа пользователей</span><span class="sxs-lookup"><span data-stu-id="c896a-182">Adding Web Forms for Registering and Logging in Users</span></span>

1. <span data-ttu-id="c896a-183">Откройте *Register.cs* файл и добавьте следующий код, который будут входить в систему пользователь при успешной регистрации.</span><span class="sxs-lookup"><span data-stu-id="c896a-183">Open the *Register.cs* file and add the following code which will log in the user when registration succeeds.</span></span> <span data-ttu-id="c896a-184">Изменения выделены ниже.</span><span class="sxs-lookup"><span data-stu-id="c896a-184">The changes are highlighted below.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample5.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="c896a-185">Так как ASP.NET Identity и OWIN файл Cookie проверки подлинности на основе утверждений системы, платформы требует, чтобы разработчик приложений для создания [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) для пользователя.</span><span class="sxs-lookup"><span data-stu-id="c896a-185">Since ASP.NET Identity and OWIN Cookie Authentication are claims based system, the framework requires the app developer to generate a [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) for the user.</span></span> <span data-ttu-id="c896a-186">ClaimsIdentity имеет сведения о все утверждения для пользователя, например пользователь принадлежит к роли.</span><span class="sxs-lookup"><span data-stu-id="c896a-186">ClaimsIdentity has information about all the claims for the user such as what Roles the user belongs to.</span></span> <span data-ttu-id="c896a-187">На этом этапе можно также добавить дополнительные утверждения для пользователя.</span><span class="sxs-lookup"><span data-stu-id="c896a-187">You can also add more claims for the user at this stage.</span></span>
    > - <span data-ttu-id="c896a-188">Можно вход пользователя с помощью AuthenticationManager из OWIN и вызывая метод `SignIn` и передавая ClaimsIdentity, как показано выше.</span><span class="sxs-lookup"><span data-stu-id="c896a-188">You can sign in the user by using the AuthenticationManager from OWIN and calling `SignIn` and passing in the ClaimsIdentity as shown above.</span></span> <span data-ttu-id="c896a-189">Этот код будет вход пользователя и создать файл cookie также.</span><span class="sxs-lookup"><span data-stu-id="c896a-189">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="c896a-190">Этот вызов является аналогом [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) используемые [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) модуля.</span><span class="sxs-lookup"><span data-stu-id="c896a-190">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
2. <span data-ttu-id="c896a-191">В **обозревателе решений**, щелкните правой кнопкой мыши проект нажимать кнопку **добавить**, а затем **веб-формы**.</span><span class="sxs-lookup"><span data-stu-id="c896a-191">In **Solution Explorer**, right-click your project click **Add**, and then **Web Form**.</span></span> <span data-ttu-id="c896a-192">Имя веб-формы **входа**.</span><span class="sxs-lookup"><span data-stu-id="c896a-192">Name the web form **Login**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image12.png)
3. <span data-ttu-id="c896a-193">Замените содержимое файла *Login.aspx* файла следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="c896a-193">Replace the contents of the *Login.aspx* file with the following code:</span></span>  

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample6.aspx)]
4. <span data-ttu-id="c896a-194">Замените содержимое файла *Login.aspx.cs* файл со следующими:</span><span class="sxs-lookup"><span data-stu-id="c896a-194">Replace the contents of the *Login.aspx.cs* file with the following:</span></span>  

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample7.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="c896a-195">`Page_Load` Теперь проверяет состояние текущего пользователя и выполняет действия на основе его `Context.User.Identity.IsAuthenticated` состояния.</span><span class="sxs-lookup"><span data-stu-id="c896a-195">The `Page_Load` now checks for the status of current user and takes action based on its `Context.User.Identity.IsAuthenticated` status.</span></span>  
    >     <span data-ttu-id="c896a-196">**Отображение зарегистрированных в имя пользователя** : The Microsoft ASP.NET Identity Framework перечислил методы расширения в [System.Security.Principal.IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) , позволит вам получить `UserName` и `UserId` для Пользователь, вошедший в систему.</span><span class="sxs-lookup"><span data-stu-id="c896a-196">**Display Logged in User Name** : The Microsoft ASP.NET Identity Framework has added extension methods on [System.Security.Principal.IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) that allows you to get the `UserName` and `UserId`  for the logged in User.</span></span> <span data-ttu-id="c896a-197">Эти методы расширения определяются в `Microsoft.AspNet.Identity.Core` сборки.</span><span class="sxs-lookup"><span data-stu-id="c896a-197">These extension methods are defined in the `Microsoft.AspNet.Identity.Core` assembly.</span></span> <span data-ttu-id="c896a-198">Эти методы расширения являются заменой [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span><span class="sxs-lookup"><span data-stu-id="c896a-198">These extension methods are the replacement for [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span></span>
    > - <span data-ttu-id="c896a-199">Метод входа:</span><span class="sxs-lookup"><span data-stu-id="c896a-199">SignIn method:</span></span>   
    >     <span data-ttu-id="c896a-200">`This` метод заменяет предыдущий `CreateUser_Click` метод в этом примере и теперь выполняет вход пользователь после успешного создания пользователя.</span><span class="sxs-lookup"><span data-stu-id="c896a-200">`This` method replaces the previous `CreateUser_Click` method in this sample and now signs in the user after successfully creating the user.</span></span>   
    >  <span data-ttu-id="c896a-201">Платформа Microsoft OWIN перечислил методы расширения в `System.Web.HttpContext` , позволит вам получить ссылку на `IOwinContext`.</span><span class="sxs-lookup"><span data-stu-id="c896a-201">The Microsoft OWIN Framework has added extension methods on `System.Web.HttpContext` that allows you to get a reference to an `IOwinContext`.</span></span> <span data-ttu-id="c896a-202">Эти методы расширения определяются в `Microsoft.Owin.Host.SystemWeb` сборки.</span><span class="sxs-lookup"><span data-stu-id="c896a-202">These extension methods are defined in `Microsoft.Owin.Host.SystemWeb` assembly.</span></span> <span data-ttu-id="c896a-203">`OwinContext` Предоставляет `IAuthenticationManager` свойство, которое представляет функциональные возможности по промежуточного слоя проверки подлинности, доступные в текущем запросе.</span><span class="sxs-lookup"><span data-stu-id="c896a-203">The `OwinContext` class exposes an `IAuthenticationManager` property that represents the Authentication middleware functionality available on the current request.</span></span>  
    >  <span data-ttu-id="c896a-204">Пользователь может войти с помощью `AuthenticationManager` из OWIN и вызвав `SignIn` и передавая `ClaimsIdentity` как показано выше.</span><span class="sxs-lookup"><span data-stu-id="c896a-204">You can sign in the user by using the `AuthenticationManager` from OWIN and calling `SignIn`  and passing in the `ClaimsIdentity`  as shown above.</span></span>   
    >  <span data-ttu-id="c896a-205">Поскольку ASP.NET Identity и OWIN файл Cookie проверки подлинности на основе утверждений система, платформа требует приложение, чтобы создать `ClaimsIdentity` для пользователя.</span><span class="sxs-lookup"><span data-stu-id="c896a-205">Because ASP.NET Identity and OWIN Cookie Authentication are claims-based system, the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span>   
    >  <span data-ttu-id="c896a-206">`ClaimsIdentity` Со сведениями о все утверждения для пользователя, например пользователь принадлежит к роли.</span><span class="sxs-lookup"><span data-stu-id="c896a-206">The `ClaimsIdentity` has information about all the claims for the user, such as what roles the user belongs to.</span></span> <span data-ttu-id="c896a-207">На этом этапе также можно добавить дополнительные утверждения для пользователя</span><span class="sxs-lookup"><span data-stu-id="c896a-207">You can also add more claims for the user at this stage</span></span>  
    >  <span data-ttu-id="c896a-208">Этот код будет вход пользователя и создать файл cookie также.</span><span class="sxs-lookup"><span data-stu-id="c896a-208">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="c896a-209">Этот вызов является аналогом [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) используемые [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) модуля.</span><span class="sxs-lookup"><span data-stu-id="c896a-209">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
    > - <span data-ttu-id="c896a-210">`SignOut` метод:</span><span class="sxs-lookup"><span data-stu-id="c896a-210">`SignOut` method:</span></span>   
    >  <span data-ttu-id="c896a-211">Получает ссылку на `AuthenticationManager` из OWIN и вызывает `SignOut`.</span><span class="sxs-lookup"><span data-stu-id="c896a-211">Gets a reference to the `AuthenticationManager` from OWIN and calls `SignOut`.</span></span> <span data-ttu-id="c896a-212">Это аналогично [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) метод, используемый [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) модуля.</span><span class="sxs-lookup"><span data-stu-id="c896a-212">This is analogous to [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) method used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
5. <span data-ttu-id="c896a-213">Нажмите клавишу **Ctrl + F5** для сборки и запуска веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="c896a-213">Press **Ctrl + F5** to build and run the web application.</span></span> <span data-ttu-id="c896a-214">Введите новое имя пользователя и пароль и нажмите кнопку на **зарегистрировать**.</span><span class="sxs-lookup"><span data-stu-id="c896a-214">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image13.png)  
   <span data-ttu-id="c896a-215">Примечание: после этого новый пользователь создается и вход.</span><span class="sxs-lookup"><span data-stu-id="c896a-215">Note: At this point, the new user is created and logged in.</span></span>
6. <span data-ttu-id="c896a-216">Щелкните **Выход** кнопки. Вы будете перенаправлены в журнале в форме.</span><span class="sxs-lookup"><span data-stu-id="c896a-216">Click on **Log out** button.You will be redirected to the Log in form.</span></span>
7. <span data-ttu-id="c896a-217">Ввести недопустимое имя пользователя или пароль и нажмите кнопку на **вход** кнопки.</span><span class="sxs-lookup"><span data-stu-id="c896a-217">Enter an invalid user name or password and Click on **Log in** button.</span></span>   
   <span data-ttu-id="c896a-218">`UserManager.Find` Метод вернет значение null, а сообщение об ошибке: " *недопустимое имя пользователя или пароль* " будет отображаться.</span><span class="sxs-lookup"><span data-stu-id="c896a-218">The `UserManager.Find`  method will return null and the error message: " *Invalid user name or password* " will be displayed.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image14.png)
