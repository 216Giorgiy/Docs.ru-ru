---
uid: signalr/overview/getting-started/tutorial-server-broadcast-with-signalr
title: "Учебник: Сервер вещание с SignalR 2 | Документы Microsoft"
author: tdykstra
description: "Этот учебник показывает, как создание веб-приложения, использующего ASP.NET SignalR 2 широковещательных функциональные возможности сервера. Рассылка сервера означает, что commun..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/13/2014
ms.topic: article
ms.assetid: 1568247f-60b5-4eca-96e0-e661fbb2b273
ms.technology: dotnet-signalr
ms.prod: .net-framework
msc.legacyurl: /signalr/overview/getting-started/tutorial-server-broadcast-with-signalr
msc.type: authoredcontent
ms.openlocfilehash: 98a7ce4991d58181177cf56976888e9fd1526987
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2018
---
<a name="tutorial-server-broadcast-with-signalr-2"></a>Учебник: Сервер вещание с SignalR 2
====================
по [Tom Dykstra](https://github.com/tdykstra), [Tom FitzMacken](https://github.com/tfitzmac)

> Этот учебник показывает, как создание веб-приложения, использующего ASP.NET SignalR 2 широковещательных функциональные возможности сервера. Рассылка сервера означает, что связям клиентам инициируются сервером. Данный сценарий требует другой подход программирования, чем сценарии одноранговая сеть, например чат приложений, в которых связям клиентам инициируются один или несколько клиентов.
> 
> Приложение, которое вы создадите в этом учебнике имитирует биржевых типичный сценарий для широковещательной рассылки функциональные возможности сервера.
> 
> В этом разделе изначально был записан с Патрик Флетчера.
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>Версии программного обеспечения, используемая в этом учебнике
> 
> 
> - [Visual Studio 2013](https://www.microsoft.com/visualstudio/eng/2013-downloads)
> - .NET 4.5
> - SignalR версии 2
>   
> 
> 
> ## <a name="using-visual-studio-2012-with-this-tutorial"></a>С помощью Visual Studio 2012 с помощью этого учебника
> 
> 
> Чтобы использовать Visual Studio 2012 с помощью этого учебника, выполните следующее:
> 
> - Обновление вашего [диспетчера пакетов](http://docs.nuget.org/docs/start-here/installing-nuget) до последней версии.
> - Установка [веб-установщика платформы](https://www.microsoft.com/web/downloads/platform.aspx).
> - Установщик веб-платформы для поиска и установки **ASP.NET и 2013.1 Web Tools для Visual Studio 2012**. Это будет установки Visual Studio шаблоны для SignalR классов, таких как **концентратора**.
> - Некоторые шаблоны (такие как **класс запуска OWIN**) будет недоступен; в этом случае используйте файл класса.
> 
> 
> ## <a name="tutorial-versions"></a>Версии учебника
> 
> Сведения о более ранних версий SignalR см. в разделе [более ранних версий SignalR](../older-versions/index.md).
> 
> ## <a name="questions-and-comments"></a>Вопросы и комментарии
> 
> Оставьте отзыв на том, как вам понравилось этого учебника и что можно улучшить в комментарии в нижней части страницы. Если у вас есть вопросы, которые не связаны непосредственно для работы с учебником, их можно разместить [форум по ASP.NET SignalR](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) или [StackOverflow.com](http://stackoverflow.com/).


## <a name="overview"></a>Обзор

В этом учебнике будет Создание биржевой приложения, которое является типичным для приложений в режиме реального времени, в которых требуется периодически «push» или широковещательной рассылки уведомлений с сервера для всех подключенных клиентов. В первой части этого учебника вы создадите упрощенную версию этого приложения с нуля. В оставшейся части руководства вы установите пакет NuGet, который содержит дополнительные функции, а также просмотреть код для этих функций.

Приложение, которое мы создадим в первой части этого учебника представлена таблица со биржевых данных.

![Начальная версия StockTicker](tutorial-server-broadcast-with-signalr/_static/image1.png)

Периодически сервер случайным образом обновляет акций и помещает обновлений для всех подключенных клиентов. В браузере чисел и символов в **изменить** и  **%**  динамически изменять столбцы в ответ на уведомления с сервера. При открытии дополнительные браузеры же URL-адрес, все они показаны те же данные и те же изменения в данные одновременно.

Этот учебник содержит следующие разделы:

- [Необходимые компоненты](#prerequisites)
- [Создание проекта](#createproject)
- [Настройка серверного кода](#server)
- [Настройка кода клиента](#client)
- [Тестирование приложения](#test)
- [Включить ведение журнала](#enablelogging)
- [Установка и просмотрите полный образец StockTicker](#fullsample)
- [Дальнейшие действия](#nextsteps)

[Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) пакет NuGet устанавливает образец смоделированные биржевой приложения в проекте Visual Studio.

> [!NOTE]
> Если вы не хотите выполнить необходимые действия по созданию приложения, можно установить пакет SignalR.Sample в новом проекте пустое веб-приложение ASP.NET. При установке пакета NuGet без выполнения шагов в этом учебнике **выполните инструкции в файле readme.txt**. Чтобы запустить пакет необходимо добавить класс запуска OWIN, который вызывает метод ConfigureSignalR в установленном пакете. Если не добавить класс запуска OWIN, возникает ошибка.


<a id="prerequisites"></a>

## <a name="prerequisites"></a>Предварительные требования

Прежде чем начать, убедитесь, что Visual Studio 2013, установленной на компьютере. Если у вас нет Visual Studio, см. раздел [загрузок ASP.NET](https://www.asp.net/downloads) для получения бесплатной Visual Studio Express 2013.

<a id="createproject"></a>

## <a name="create-the-project"></a>Создание проекта

1. Из **файл** меню, нажмите кнопку **новый проект**.
2. В **новый проект** диалогового окна разверните **C#** под **шаблоны** и выберите **Web**.
3. Выберите **пустое веб-приложение ASP.NET** шаблона, имя проекта *SignalR.StockTicker*и нажмите кнопку **ОК**.

    ![Диалоговое окно “Новый проект”](tutorial-server-broadcast-with-signalr/_static/image2.png)
4. В **новый ASP.NET** окна проекта, оставьте **пустой** флажок и нажмите кнопку **Создание проекта**.

    ![Диалоговое окно нового проекта ASP](tutorial-server-broadcast-with-signalr/_static/image3.png)

<a id="server"></a>

## <a name="set-up-the-server-code"></a>Настройка серверного кода

В этом разделе можно настроить код, который выполняется на сервере.

### <a name="create-the-stock-class"></a>Создайте класс Stock

Сначала создается класс модели Stock, будет использоваться для хранения и передачи информации о акций.

1. Создайте новый файл класса в папке проекта, назовите его *Stock.cs*, а затем замените код шаблона с помощью следующего кода:

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample1.cs)]

    Два свойства, которые можно задать при создании акции: символ (например, MSFT Майкрософт) и цену. Другие свойства зависят от того, как и когда можно задать цены. При первом запуске задать цену, значение возвращает распространяются DayOpen. В следующий раз, если задается цена, изменения и значения свойств PercentChange вычисляются на основе разницы между ценой и DayOpen.

### <a name="create-the-stockticker-and-stocktickerhub-classes"></a>Создание классов StockTicker и StockTickerHub

Интерфейс API концентратора SignalR будет использоваться для управления взаимодействием с сервера клиенту. StockTickerHub класс, производный от класса концентратора SignalR обрабатывающий получение вызовы методов и подключения от клиентов. Также необходимо поддерживать биржевых данных и выполнения объекта таймера для периодически запускать обновления цен, независимо от клиентских подключений. Эти функции нельзя поместить в классе концентратора, так как экземпляры концентратора являются временными. Экземпляр класса концентратора создается для каждой операции на концентраторе, такие как подключения и вызовов от клиента к серверу. Таким образом, механизм, который отслеживает биржевых данных, затем обновляет цены и передает изменения цены должна выполняться в отдельном классе назовем StockTicker.

![Широковещательная рассылка из StockTicker](tutorial-server-broadcast-with-signalr/_static/image5.png)

Требуется только один экземпляр класса StockTicker для запуска на сервере, поэтому вам потребуется настроить ссылку из каждого экземпляра StockTickerHub StockTicker одноэлементный экземпляр. Класс StockTicker должен иметь возможность широковещательных пакетов на клиентах, так как он имеет биржевых данных и триггеров обновлений, но StockTicker не является классом концентратора. Таким образом класс StockTicker должен получить ссылку на объект контекста подключения концентратора SignalR. Затем его можно использовать объект контекста подключения SignalR рассылка для клиентов.

1. В **обозревателе решений**, щелкните правой кнопкой мыши проект и нажмите кнопку **добавить | Класс концентратора SignalR (v2)**.
2. Назовите новый концентратор *StockTickerHub.cs*, а затем нажмите кнопку **добавить**. Пакеты SignalR NuGet будет добавлен в проект.
3. Замените код шаблона с помощью следующего кода:

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample2.cs)]

    [Концентратора](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) класс используется для определения методов, клиенты могут вызывать на сервере. Вы определяете один метод: `GetAllStocks()`. Когда клиент изначально подключается к серверу, он вызывает этот метод, чтобы получить список всех акций с их текущей цены. Метод может выполняются синхронно и возвращать `IEnumerable<Stock>` , так как он возвращает данные из памяти. Приходилось получать данные, то, что привело бы к ожидания, например, поиск в базе данных или вызов веб-службы, выполнив метод следует указать `Task<IEnumerable<Stock>>` как возвращаемое значение асинхронной обработки. Дополнительные сведения см. в разделе [ASP.NET руководство по API концентраторов SignalR - Server - если для асинхронного выполнения](../guide-to-the-api/hubs-api-guide-server.md#asyncmethods).

    Атрибут HubName указывает, как концентратор будет ссылаться в коде JavaScript на стороне клиента. Имя по умолчанию на стороне клиента, если вы не используете этот атрибут — это версия стиле Camel, от имени класса, что в этом случае было бы stockTickerHub.

    Как вы увидите позже при создании класса StockTicker, одноэлементный экземпляр этого класса создается в его статическое свойство экземпляра. Одноэлементный экземпляр StockTicker остается в памяти независимо от того, сколько клиентов или разрыв подключения, что этот экземпляр является GetAllStocks метод используется для возврата текущего биржевых данных.
4. Создайте новый файл класса в папке проекта, назовите его *StockTicker.cs*, а затем замените код шаблона с помощью следующего кода:

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample3.cs)]

    Так как несколько потоков будет выполняться один и тот же экземпляр StockTicker кода, класс StockTicker должен быть threadsafe.

    ### <a name="storing-the-singleton-instance-in-a-static-field"></a>Хранение одноэлементный экземпляр в статическом поле

    Этот код инициализирует статический \_экземпляр поля, поддерживающего свойство экземпляра с экземпляром класса, и это является единственным экземпляром класса, который может быть создан, поскольку конструктор помечен как частный. [Отложенная инициализация](https://msdn.microsoft.com/library/dd997286.aspx) используется для \_поле экземпляра, а не для повышения производительности, но чтобы убедитесь, что создание экземпляра threadsafe.

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample4.cs)]

    Каждый раз, когда клиент подключается к серверу, новый экземпляр класса StockTickerHub, работающих в отдельном потоке возвращает одноэлементный экземпляр StockTicker из статическое свойство StockTicker.Instance, как было показано ранее в классе StockTickerHub.

    ### <a name="storing-stock-data-in-a-concurrentdictionary"></a>Хранение данных об акциях в руководство.

    Конструктор инициализирует \_коллекция акций с некоторыми образец биржевых данных и GetAllStocks возвращает акции. Как показано выше, StockTickerHub.GetAllStocks этот сервер метод в классе концентратора, который клиенты смогут вызывать в свою очередь возвращается акций этой коллекции.

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample5.cs)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample6.cs)]

    Представляет собой коллекцию акции [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) тип безопасности потока. В качестве альтернативы можно использовать [словарь](https://msdn.microsoft.com/library/xfhwa508.aspx) объекта и явно заблокировать словарь при внесении изменений в него.

    Для этого примера приложения что достаточно для хранения данных приложения в памяти и потери данных при удалении экземпляра StockTicker. В реальном приложении будет работать с хранилищем данных серверной части, например к базе данных.

    ### <a name="periodically-updating-stock-prices"></a>Периодическое обновление цен на акции

    Конструктор запускается объект таймера, который периодически вызывает методы, которые обновляют цены на основе случайной выборки.

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample7.cs)]

    UpdateStockPrices вызывается таймер, который передает значения NULL в параметре state. Перед обновлением цены, устанавливается блокировка \_updateStockPricesLock объекта. Код проверяет, если другой поток уже обновление цен и затем вызывает TryUpdateStockPrice для каждой из них в списке. Метод TryUpdateStockPrice решает, следует ли изменить цены акции и объем, чтобы изменить его. При изменении цены акции BroadcastStockPrice вызывается для вещания акций изменения для всех подключенных клиентов.

    \_UpdatingStockPrices флаг помечен как [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) для обеспечения доступа к нему threadsafe.

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample8.cs)]

    Вызовите метод TryUpdateStockPrice в реальном приложении веб-службы для поиска цены. в этом коде он использует генератора случайных чисел для изменения случайным образом.

    ### <a name="getting-the-signalr-context-so-that-the-stockticker-class-can-broadcast-to-clients"></a>Получение контекста SignalR, чтобы выполнить рассылку класс StockTicker клиентам

    Поскольку изменения цен здесь приходят в объекте StockTicker, это объект, который необходимо вызвать метод updateStockPrice на всех подключенных клиентов. В классе концентратора у вас есть API для вызова методов клиента, но StockTicker не является производным от класса концентратора и не имеет ссылки на любой объект концентратора. Таким образом чтобы вещания для подключенных клиентов, класс StockTicker должно получить экземпляр контекста SignalR для класса StockTickerHub и использовать его для вызова методов, на клиентах.

    Код получает ссылку на контекст SignalR, создавая одноэлементный экземпляр класса, ссылающиеся передает в конструктор и конструктор помещает его в свойстве клиентов.

    Существует две причины, почему нужно получить контекст только один раз: контекст является ресурсоемкой операцией и получения его один раз гарантирует, что предполагаемым порядок сообщений, отправленных клиентами сохраняется.

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample9.cs)]

    Получение свойства контекста клиентов и помещение их в свойстве StockTickerClient позволяет написать код для вызова методов клиента, который выглядит так же, как если бы в классе концентратора. Например рассылка для всех клиентов можно написать Clients.All.updateStockPrice(stock).

    Метод updateStockPrice, вызываемой в BroadcastStockPrice не существует; она будет добавлена позже при написании кода, который выполняется на клиенте. Можно ссылаться на updateStockPrice здесь, поскольку Clients.All является динамической, это означает, что выражение будет вычислено во время выполнения. При вызове этого метода выполняется, SignalR отправит имя метода и значение параметра клиента и если у клиента имеется метод с именем updateStockPrice, этот метод будет вызван, и он передается значение параметра.

    Clients.All означает отправить всем клиентам. SignalR предоставляет другие параметры, чтобы указать, какие клиенты или группы клиенты для отправки. Дополнительные сведения см. в разделе [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).

### <a name="register-the-signalr-route"></a>Регистрация маршрутов SignalR

Этот сервер должен знать, какой URL-адрес для перехвата и направления для SignalR. Для этого мы добавим и класс запуска OWIN.

1. В **обозревателе решений**, щелкните правой кнопкой мыши проект и выберите команду **добавить | Класс запуска OWIN**. Имя класса **файла Startup.cs**.
2. Замените код в **файла Startup.cs** со следующими.

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample10.cs)]

Завершена настройка серверного кода. В следующем разделе составим клиента.

<a id="client"></a>

## <a name="set-up-the-client-code"></a>Настройка кода клиента

1. Создайте новый HTML-файл в папке проекта и назовите его *StockTicker.html*.
2. Замените код шаблона с помощью следующего кода.

    [!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample11.html)]

    HTML создает таблицу с 5 столбцов, строку заголовка и строку данных с одна ячейка, которая распространяется на все 5 столбцов. Строка данных отображается «Загрузка» и отображается только моментально при запуске приложения. Код JavaScript будет удалить эту строку и добавьте в строках месте биржевых данных, получаемых с сервера.

    Теги сценариев укажите jQuery файл скрипта, файла сценария SignalR core, файл скрипта прокси SignalR и файл скрипта StockTicker, которое будет создано в более поздней версии. Файл скрипта прокси SignalR, который указывает URL-адрес «/ signalr/концентраторов», формируется динамически и определяет методы прокси-сервера для методов в классе концентратора, но в этом случае для StockTickerHub.GetAllStocks. При желании можно вручную создать этот файл JavaScript с помощью [SignalR программы](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) и отключить создание динамического файла в вызове метода MapHubs.
3. > [!IMPORTANT]
 > Убедитесь, что ссылки на файл JavaScript в *StockTicker.html* заданы правильно. То есть, убедитесь в версии jQuery в ваш скрипт тег (1.10.2 в примере) аналогично версии jQuery в своем проекте *сценариев* папки и убедитесь в том, что версия SignalR в ваш скрипт тег совпадает со значением SignalR версия в своем проекте *сценариев* папки. При необходимости измените имена файлов в теги сценариев.
4. В **обозревателе решений**, щелкните правой кнопкой мыши *StockTicker.html*, а затем нажмите кнопку **задать в качестве начальной страницы**.
5. Создайте новый файл JavaScript в папке проекта и назовите его *StockTicker.js*...
6. Замените код шаблона с помощью следующего кода:

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample12.js)]

    $.connection ссылается на прокси-серверы, SignalR. Этот код возвращает ссылку на прокси-сервер для класса StockTickerHub и помещает его в переменной биржевых котировок. Имя прокси-сервер имеет имя, которое было задано с помощью атрибута [HubName]:

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample13.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample14.cs)]

    После определения переменных и функций в последней строке кода в файле инициализирует подключения SignalR путем вызова функции запуска SignalR. Функция запуска выполняется асинхронно и возвращает [объекта отложенный jQuery](http://api.jquery.com/category/deferred-object/), что означает можно вызвать функцию Готово для указания функция, вызываемая при завершении асинхронной операции...

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample15.js)]

    Init-функция вызывает функцию getAllStocks на сервере и использует сведения, сервер возвращает для обновления таблицы акций. Обратите внимание, что по умолчанию, необходимо использовать верблюжий на клиенте несмотря на то, что имя метода в стиле Pascal на сервере. Регистрах правило применяется только к методам, не объекты. Например можно ссылаться на складе. Символ и акций. Цена, не stock.symbol или stock.price.

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample16.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample17.cs)]

    Если решено использовать pascal регистр на клиентском компьютере, или если вы хотите использовать имя совершенно другой метод, может декорировать метод концентратора с атрибутом HubMethodName так же, как вы внутренним классу Hub с атрибутом HubName.

    В методе init HTML-код для строки таблицы создается для каждого объекта акций, полученных с сервера вызывающего formatStock для свойства форматирования stock-объектом, и путем вызова будут отменены (который определен в верхней части *StockTicker.js*) для замены заполнителей в переменной rowTemplate со значениями свойств stock-объектом. Затем результирующий HTML добавляется таблицы акций.

    Вызовите init, передав его в качестве функции обратного вызова, который выполняется после завершения функции асинхронного запуска. При вызове init как отдельную инструкцию после начала вызова JavaScript, функция завершится сбоем, так как оно будет выполнено немедленно, не дожидаясь завершения подключения к функции запуска. В этом случае init-функция будет выполнена попытка вызвать функцию getAllStocks, прежде чем установить соединение с сервером.

    При изменении цены сервера он вызывает updateStockPrice на подключенных клиентов. Функция добавляется свойство клиента stockTicker прокси-сервера, чтобы сделать его доступным для вызовов с сервера.

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample18.js)]

    Функция updateStockPrice форматирует получил от сервера в строке таблицы так же, как функция init stock-объектом. Тем не менее вместо того чтобы добавить строку в таблицу, он находит stock текущей строки в таблице и заменяет этой строки на новую.

<a id="test"></a>

## <a name="test-the-application"></a>Тестирование приложения

1. Нажмите клавишу F5 для запуска приложения в режиме отладки.

    Таблицы акций изначально отображает «загрузка...» строки, затем после небольшой задержки появится начальной биржевых данных, и запустите цен на акции для изменения.

    ![Загрузка](tutorial-server-broadcast-with-signalr/_static/image6.png)

    ![Начальный таблицы акций](tutorial-server-broadcast-with-signalr/_static/image7.png)

    ![Биржевые таблица, получающая изменения с сервера](tutorial-server-broadcast-with-signalr/_static/image8.png)
2. Копировать URL-адрес из адресной строки браузера и вставьте его в новый окна браузера.

    Первоначального отображения биржевых совпадает со значением первого браузера, и изменения происходить одновременно.
3. Закройте все браузеры и откройте новый браузер, перейдите к же URL-адрес.

    Для запуска на сервере, поэтому таблицы акций показывается акций продолжил изменять возобновлена StockTicker одноэлементного объекта. (Не вижу начальной таблицу с нулем Изменение фигур.)
4. Закройте браузер.

<a id="enablelogging"></a>

## <a name="enable-logging"></a>Включение ведения журнала

SignalR имеется функция встроенного ведения журнала, которые можно включить на стороне клиента для облегчения устранения неполадок. В этом разделе включите ведение журнала и примеры, которые показывают, как журналы скажет, какой из следующих методов транспорта использует SignalR в разделе:

- [WebSockets](http://en.wikipedia.org/wiki/WebSocket), поддерживаемые в IIS 8 и текущих браузерах.
- [Сервер отправил события](http://en.wikipedia.org/wiki/Server-sent_events), поддерживаемые в браузерах, отличных от Internet Explorer.
- [Непрерывно фрейма](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), поддерживаемой обозревателем Internet Explorer.
- [AJAX продолжительный опрос](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), поддерживаемые браузеры.

Для каждого соединения SignalR выбирает наилучший способ передачи, сервер и клиент поддерживают.

1. Откройте *StockTicker.js* и добавьте строку кода, чтобы включить ведение журнала непосредственно перед код, который инициализирует подключение в конце файла:

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample19.js)]
2. Нажмите клавишу F5, чтобы запустить проект.
3. Откройте окно средств разработчика в браузере и выберите консоль, чтобы просмотреть журналы. Может потребоваться обновить страницу, чтобы просмотреть журналы Signalr согласования метода транспорта для нового соединения.

    При запуске Internet Explorer 10 в Windows 8 (IIS 8), метод транспорта является WebSockets.

    ![Консоли IE 10 IIS 8](tutorial-server-broadcast-with-signalr/_static/image9.png)

    При запуске Internet Explorer 10 в Windows 7 (IIS 7.5) метода транспортировки — iframe.

    ![IE 10 консоли IIS 7.5](tutorial-server-broadcast-with-signalr/_static/image10.png)

    В Firefox установите надстройку Firebug окна консоли. При использовании Firefox 19 в Windows 8 (IIS 8), метод транспорта является WebSockets.

    ![Firefox 19 IIS 8 Websockets](tutorial-server-broadcast-with-signalr/_static/image11.png)

    При использовании Firefox 19 в Windows 7 (IIS 7.5) метода транспортировки — события отправки сервером.

    ![Firefox 19 консоли IIS 7.5](tutorial-server-broadcast-with-signalr/_static/image12.png)

<a id="fullsample"></a>

## <a name="install-and-review-the-full-stockticker-sample"></a>Установка и просмотрите полный образец StockTicker

StockTicker приложения, которая устанавливается вместе с [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) пакет NuGet включает больше возможностей, чем упрощенную версию, созданный с нуля. В этом разделе учебника установите пакет NuGet и обзор новых возможностей и код, который их реализует. При установке пакета без выполнения предыдущих шагов этого учебника, необходимо добавить в проект класс запуска OWIN. Этот шаг описан в файле readme.txt для пакета NuGet.

### <a name="install-the-signalrsample-nuget-package"></a>Установка пакета SignalR.Sample NuGet

1. В **обозревателе решений**, щелкните правой кнопкой мыши проект и нажмите кнопку **управление пакетами NuGet**.
2. В **управление пакетами NuGet** диалоговое окно, нажмите кнопку **Online**, введите *SignalR.Sample* в **поиск в Интернете** , а затем щелкните  **Установка** в **SignalR.Sample** пакета.

    ![Установить пакет SignalR.Sample](tutorial-server-broadcast-with-signalr/_static/image13.png)
3. В **обозревателе решений**, разверните *SignalR.Sample* папку, которая была создана путем установки пакета SignalR.Sample.
4. В *SignalR.Sample* папку, щелкните правой кнопкой мыши *StockTicker.html*, а затем нажмите кнопку **задать в качестве начальной страницы**.

    > [!NOTE]
    > Установка SignalR.Sample NuGet пакета может изменить версия jQuery, имеющегося в вашей *сценариев* папки. Новый *StockTicker.html* файла, который устанавливает пакет в *SignalR.Sample* папки будут синхронизированы с версии jQuery, которая устанавливает пакет, но если вы хотите запустить исходную *StockTicker.html* файл еще раз, возможно, потребуется сначала обновить ссылку на jQuery в теге script.

### <a name="run-the-application"></a>Запуск приложения

1. Нажмите клавишу F5 для запуска приложения.

    В дополнение к таблице, которая ранее видели приложение полной биржевых показывает горизонтальной прокруткой окно, отображающее же биржевых данных. При запуске приложения в первый раз, «Марка» «закрыто», и вы увидите статических сетки и биржевых котировок окна, размеры которого не прокрутки.

    ![Экран запуска StockTicker](tutorial-server-broadcast-with-signalr/_static/image14.png)

    При нажатии кнопки **Open Market**, **Live биржевых котировок акций** поле начинает выполнять прокрутку по горизонтали, и сервер запускается периодически передавать изменения акций на основе случайной выборки. При каждом запуске акций изменяется, оба **Live Stock таблицы** сетки и **Live биржевых котировок акций** поле обновляются. При изменения цены акций является положительным, показывается акций с зеленым фоном, и при изменении имеет отрицательное значение, акции отображается с красным фоном.

    ![Откройте приложение StockTicker рынка](tutorial-server-broadcast-with-signalr/_static/image15.png)

    **Закрыть рынка** кнопка останавливает изменения и останавливает прокрутки биржевых котировок и **Сброс** сбрасывает все биржевых данных в исходное состояние до начала изменения цен. Если открыть несколько окон браузера и перейдите к же URL-адрес, можно увидеть те же данные, динамически обновляется в то же время каждого браузера. Если щелкнуть одну из кнопок, все браузеры отвечать так же, как в то же время.

### <a name="live-stock-ticker-display"></a>Динамическая отображения биржевых котировок акций

**Live биржевых котировок акций** отображается неупорядоченный список элемент div, отформатированные в одну строку в стили CSS. Инициализируется биржевых котировок и обновить так же, как таблицы:, заменив заполнители в &lt;li&gt; строка шаблона и динамическое добавление &lt;li&gt; элементы &lt;ul&gt; элемент. Прокрутка выполняется с помощью функции jQuery анимировать изменение левого поля неупорядоченный список внутри div.

Биржевые сводки HTML:

[!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample20.html)]

Биржевые сводки CSS:

[!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample21.html)]

Прокрутите jQuery код, который позволяет:

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample22.js)]

### <a name="additional-methods-on-the-server-that-the-client-can-call"></a>Дополнительные методы на сервере, который клиент может вызывать

Класс StockTickerHub определяет четыре дополнительные методы, которые клиент может вызывать:

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample23.cs)]

OpenMarket, CloseMarket и сброс вызываются в ответ на кнопок в верхней части страницы. Они показывают шаблон из одного клиента, активируя изменение в состоянии, немедленно распространяются на всех клиентах. Каждый из этих методов вызывает метод в классе StockTicker которые влияют на состояние рынка изменения и затем передает новое состояние.

В классе StockTicker MarketState свойство, которое возвращает значение перечисления MarketState сохраняется состояние рынка.

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample24.cs)]

Каждый из методов, изменяющих состояние рынка этого внутри блока блокировки, так как класс StockTicker должен быть threadsafe:

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample25.cs)]

Чтобы убедиться, что этот код threadsafe, \_marketState поля, поддерживающего свойство MarketState помечен как volatile,

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample26.cs)]

Методы BroadcastMarketStateChange и BroadcastMarketReset аналогичны BroadcastStockPrice метод, который вы уже видели, за исключением того, вызываются различные методы, определенные для клиентов:

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample27.cs)]

### <a name="additional-functions-on-the-client-that-the-server-can-call"></a>Дополнительные функции на стороне клиента, сервер может вызывать

Функция updateStockPrice теперь обрабатывает сетки и отображения биржевых котировок и использует jQuery.Color мигать красным и зеленый цвета.

Новые функции в *SignalR.StockTicker.js* Включение и отключение кнопок на основе рынок состояния и остановить или запустить биржевых котировок окна горизонтальной прокрутки. Так как несколько функций, добавленных ticker.client, [jQuery расширить функции](http://api.jquery.com/jQuery.extend/) используется для их добавления.

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample28.js)]

### <a name="additional-client-setup-after-establishing-the-connection"></a>Программа установки дополнительного клиента после подключения к

После клиент устанавливает соединение, он имеет некоторые дополнительные действия, чтобы сделать: проверить, является ли рынке открытых или закрытых для вызова соответствующего marketOpened или функции marketClosed и вложить вызовы методов сервера кнопок.

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample29.js)]

Методы сервера не соединены до кнопок, пока после установки подключения, чтобы код не можете вызывать методы сервера, прежде чем они станут доступными.

<a id="nextsteps"></a>

## <a name="next-steps"></a>Следующие шаги

В этом учебнике вы узнали, как запрограммировать приложение SignalR, которое осуществляет широковещательную рассылку сообщений с сервера на все подключенные клиенты на периодической основе и в ответ на уведомления с любого клиента. Шаблон использования несколькими потоками одноэлементный экземпляр для отслеживания состояния сервера может также использоваться в сети игры скриптах многопользовательских. Пример см. в разделе [ShootR игры, который основан на SignalR](https://github.com/NTaylorMullen/ShootR).

Руководства с примерами сценариев связи одноранговая сеть, в разделе [Приступая к работе с SignalR](introduction-to-signalr.md) и [обновление в режиме реального времени с SignalR](tutorial-high-frequency-realtime-with-signalr.md).

Для получения более сложных понятиях разработки SignalR, посетите следующие сайты для SignalR исходный код и ресурсы:

- [ASP.NET SignalR](../../index.md)
- [Проект SignalR](http://signalr.net/)
- [SignalR Github и образцы](https://github.com/SignalR/SignalR)
- [Вики-сайте SignalR](https://github.com/SignalR/SignalR/wiki)

Пошаговое руководство по развертыванию приложения на SignalR для Azure см. в разделе [SignalR с помощью с веб-приложений в службе приложений Azure](../deployment/using-signalr-with-azure-web-sites.md). Подробные сведения о развертывании веб-проекта Visual Studio для веб-сайта Windows Azure см. в разделе [создать веб-приложение ASP.NET в службе приложений Azure](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-get-started/).
