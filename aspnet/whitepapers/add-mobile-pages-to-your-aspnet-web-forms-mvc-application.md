---
uid: whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
title: 'Практическое руководство: Добавление мобильных страниц на ваш веб-форм ASP.NET или MVC-приложений | Документы Microsoft'
author: rick-anderson
description: Это Практическое различные способы обслуживания страниц, оптимизированный для мобильных устройств из вашего веб-форм ASP.NET или MVC-приложения и предлагает архитектуры и...
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/20/2011
ms.topic: article
ms.assetid: 3124f28e-cc32-418a-afe3-519fa56f4c36
ms.technology: ''
ms.prod: .net-framework
msc.legacyurl: /whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
msc.type: content
ms.openlocfilehash: a8358b91ca424f4f3e576057ab43d850081dda60
ms.sourcegitcommit: 6784510cfb589308c3875ccb5113eb31031766b4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/08/2018
ms.locfileid: "30898987"
---
<a name="how-to-add-mobile-pages-to-your-aspnet-web-forms--mvc-application"></a><span data-ttu-id="b8788-103">Практическое руководство: Добавление мобильных страниц на ваш веб-форм ASP.NET и MVC-приложения</span><span class="sxs-lookup"><span data-stu-id="b8788-103">How To: Add Mobile Pages to Your ASP.NET Web Forms / MVC Application</span></span>
====================
> <span data-ttu-id="b8788-104">**Применяется к**</span><span class="sxs-lookup"><span data-stu-id="b8788-104">**Applies To**</span></span>
> 
> - <span data-ttu-id="b8788-105">Веб-форм ASP.NET версии 4.0</span><span class="sxs-lookup"><span data-stu-id="b8788-105">ASP.NET Web Forms version 4.0</span></span>
> - <span data-ttu-id="b8788-106">ASP.NET MVC версии 3.0</span><span class="sxs-lookup"><span data-stu-id="b8788-106">ASP.NET MVC version 3.0</span></span>
> 
> <span data-ttu-id="b8788-107">**Сводка**</span><span class="sxs-lookup"><span data-stu-id="b8788-107">**Summary**</span></span>
> 
> <span data-ttu-id="b8788-108">Данном разделе описывается различные способы для обслуживания страниц, оптимизированный для мобильных устройств из вашего веб-форм ASP.NET и MVC-приложении и предлагает архитектуры и проектирования проблемы, которые следует учитывать при разработке для широкого спектра устройств.</span><span class="sxs-lookup"><span data-stu-id="b8788-108">This How To describes various ways to serve pages optimized for mobile devices from your ASP.NET Web Forms / MVC application, and suggests architectural and design issues to consider when targeting a broad range of devices.</span></span> <span data-ttu-id="b8788-109">В этом документе также объясняется, почему ASP.NET мобильных элементов управления ASP.NET 2.0 до 3.5 устарели и описываются некоторые современные альтернативы.</span><span class="sxs-lookup"><span data-stu-id="b8788-109">This document also explains why the ASP.NET Mobile Controls from ASP.NET 2.0 to 3.5 are now obsolete, and discusses some modern alternatives.</span></span>


## <a name="contents"></a><span data-ttu-id="b8788-110">Описание</span><span class="sxs-lookup"><span data-stu-id="b8788-110">Contents</span></span>

- <span data-ttu-id="b8788-111">Обзор</span><span class="sxs-lookup"><span data-stu-id="b8788-111">Overview</span></span>
- <span data-ttu-id="b8788-112">Параметры архитектуры</span><span class="sxs-lookup"><span data-stu-id="b8788-112">Architectural options</span></span>
- <span data-ttu-id="b8788-113">Обнаружение браузеров и устройств</span><span class="sxs-lookup"><span data-stu-id="b8788-113">Browser and device detection</span></span>
- <span data-ttu-id="b8788-114">Как приложения веб-форм ASP.NET могут обеспечивать страницы конкретных мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="b8788-114">How ASP.NET Web Forms applications can present mobile-specific pages</span></span>
- <span data-ttu-id="b8788-115">Как представляют страницы конкретных мобильных приложений ASP.NET MVC</span><span class="sxs-lookup"><span data-stu-id="b8788-115">How ASP.NET MVC applications can present mobile-specific pages</span></span>
- <span data-ttu-id="b8788-116">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="b8788-116">Additional resources</span></span>

<span data-ttu-id="b8788-117">Загружаемые примеры кода демонстрации в этом техническом документе методы для веб-форм ASP.NET и MVC, в разделе [мобильных приложений и узлов с использованием ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview).</span><span class="sxs-lookup"><span data-stu-id="b8788-117">For downloadable code samples demonstrating this white paper's techniques for both ASP.NET Web Forms and MVC, see [Mobile Apps & Sites with ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview).</span></span>

## <a name="overview"></a><span data-ttu-id="b8788-118">Обзор</span><span class="sxs-lookup"><span data-stu-id="b8788-118">Overview</span></span>

<span data-ttu-id="b8788-119">Мобильных устройств — смартфоны, функция телефоны и планшетные ПК — продолжить рост популярности как способ доступа к веб-сайте.</span><span class="sxs-lookup"><span data-stu-id="b8788-119">Mobile devices – smartphones, feature phones, and tablets – continue to grow in popularity as a means to access the Web.</span></span> <span data-ttu-id="b8788-120">Для многих веб-разработчиков и веб ориентированном бизнеса это означает, что более важно указывать прекрасные возможности для обзора для посетителей, которые используют эти устройства.</span><span class="sxs-lookup"><span data-stu-id="b8788-120">For many web developers and web-oriented businesses, this means it's increasingly important to provide a great browsing experience for visitors using those devices.</span></span>

### <a name="how-earlier-versions-of-aspnet-supported-mobile-browsers"></a><span data-ttu-id="b8788-121">Как в более ранних версиях ASP.NET поддерживаемые браузеры для мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="b8788-121">How earlier versions of ASP.NET supported mobile browsers</span></span>

<span data-ttu-id="b8788-122">ASP.NET версии 2.0 до версии 3.5 включены *элементы управления ASP.NET для мобильных устройств*: набор серверных элементов управления для мобильных устройств в *System.Web.Mobile.dll* сборки и  *System.Web.UI.MobileControls* пространства имен.</span><span class="sxs-lookup"><span data-stu-id="b8788-122">ASP.NET versions 2.0 to 3.5 included *ASP.NET Mobile Controls*: a set of server controls for mobile devices in the *System.Web.Mobile.dll* assembly and the *System.Web.UI.MobileControls* namespace.</span></span> <span data-ttu-id="b8788-123">Сборки по-прежнему присутствует в ASP.NET 4, но она устарела.</span><span class="sxs-lookup"><span data-stu-id="b8788-123">The assembly is still included in ASP.NET 4, but it is deprecated.</span></span> <span data-ttu-id="b8788-124">Разработчикам рекомендуется перейти на более современные подходов, описанных в этом документе.</span><span class="sxs-lookup"><span data-stu-id="b8788-124">Developers are advised to migrate to more modern approaches, such as those described in this paper.</span></span>

<span data-ttu-id="b8788-125">Причина, почему были помечены как устаревшие элементы управления ASP.NET для мобильных устройств ориентирована, их разработки вокруг мобильных телефонов, которые были распространены вокруг 2005 и более ранних версий.</span><span class="sxs-lookup"><span data-stu-id="b8788-125">The reason why ASP.NET Mobile Controls have been marked as obsolete is that their design is oriented around the mobile phones that were common around 2005 and earlier.</span></span> <span data-ttu-id="b8788-126">Элементы управления главным образом предназначены для отображения разметки WML или cHTML (вместо обычных HTML) для браузеров WAP, эры.</span><span class="sxs-lookup"><span data-stu-id="b8788-126">The controls are mainly designed to render WML or cHTML markup (instead of regular HTML) for the WAP browsers of that era.</span></span> <span data-ttu-id="b8788-127">Но WAP WML и cHTML которые больше не нужны для большинства проектов, так как HTML теперь стал язык широкого разметки для мобильных и настольных браузеров одинаково.</span><span class="sxs-lookup"><span data-stu-id="b8788-127">But WAP, WML, and cHTML are no longer relevant for most projects, because HTML has now become the ubiquitous markup language for mobile and desktop browsers alike.</span></span>

### <a name="the-challenges-of-supporting-mobile-devices-today"></a><span data-ttu-id="b8788-128">Сложностей, связанных с поддержкой мобильных устройств сегодня</span><span class="sxs-lookup"><span data-stu-id="b8788-128">The challenges of supporting mobile devices today</span></span>

<span data-ttu-id="b8788-129">Хотя браузеры для мобильных устройств теперь поддерживают практически все HTML, можно будет по-прежнему сталкиваются с различными трудностями при обеспечить Создание качественной мобильных просмотра:</span><span class="sxs-lookup"><span data-stu-id="b8788-129">Even though mobile browsers now almost universally support HTML, you will still face many challenges when aiming to create great mobile browsing experiences:</span></span>

- <span data-ttu-id="b8788-130">***Размер экрана*** - мобильных устройств значительно отличаться в форме, и экраны часто намного меньше, чем мониторами.</span><span class="sxs-lookup"><span data-stu-id="b8788-130">***Screen size*** - Mobile devices vary dramatically in form, and their screens are often much smaller than desktop monitors.</span></span> <span data-ttu-id="b8788-131">Таким образом необходимо разработать совершенно разные макеты для них.</span><span class="sxs-lookup"><span data-stu-id="b8788-131">So, you may need to design completely different page layouts for them.</span></span>
- <span data-ttu-id="b8788-132">***Методы ввода*** — некоторые устройства имеют клавиатурами, некоторые из них имеют styluses, другим пользователям использовать сенсорный ввод.</span><span class="sxs-lookup"><span data-stu-id="b8788-132">***Input methods*** – Some devices have keypads, some have styluses, others use touch.</span></span> <span data-ttu-id="b8788-133">Необходимо учитывать несколько переходов механизмов и методы ввода.</span><span class="sxs-lookup"><span data-stu-id="b8788-133">You may need to consider multiple navigation mechanisms and data input methods.</span></span>
- <span data-ttu-id="b8788-134">***Соответствие стандартам*** — Многие браузеры для мобильных устройств не поддерживают последние стандарты HTML, CSS и JavaScript.</span><span class="sxs-lookup"><span data-stu-id="b8788-134">***Standards compliance*** – Many mobile browsers do not support the latest HTML, CSS, or JavaScript standards.</span></span>
- <span data-ttu-id="b8788-135">***Пропускная способность*** — совершенно зависит производительность сети для передачи данных, а некоторые пользователи находятся в тарифы, плату, мегабайт.</span><span class="sxs-lookup"><span data-stu-id="b8788-135">***Bandwidth*** – Cellular data network performance varies wildly, and some end users are on tariffs that charge by the megabyte.</span></span>

<span data-ttu-id="b8788-136">Решения нет универсальными; приложение будет выглядеть и работать по-разному в зависимости от устройства, доступ к нему.</span><span class="sxs-lookup"><span data-stu-id="b8788-136">There's no one-size-fits-all solution; your application will have to look and behave differently according to the device accessing it.</span></span> <span data-ttu-id="b8788-137">В зависимости от того, какой уровень поддержки мобильных устройств требуется это может быть больше запроса для веб-разработчиков, чем когда-либо было рабочего стола «обозревателя документы».</span><span class="sxs-lookup"><span data-stu-id="b8788-137">Depending on what level of mobile support you want, this can be a bigger challenge for web developers than the desktop "browser wars" ever was.</span></span>

<span data-ttu-id="b8788-138">Разработчики часто изначально приближается поддержка мобильных браузеров в первый раз считаете, что очень важно только для поддержки смартфонов самую современную (например, Windows Phone 7 iPhone и Android), возможно, поскольку разработчики часто личные владеет таких устройства.</span><span class="sxs-lookup"><span data-stu-id="b8788-138">Developers approaching mobile browser support for the first time often initially think it's only important to support the latest and most sophisticated smartphones (e.g., Windows Phone 7, iPhone, or Android), perhaps because developers often personally own such devices.</span></span> <span data-ttu-id="b8788-139">Тем не менее дешевле телефоны по-прежнему являются весьма популярна, и владельцы должны использовать их в Интернете — особенно в странах, где мобильных телефонов для получения проще высокоскоростное подключение.</span><span class="sxs-lookup"><span data-stu-id="b8788-139">However, cheaper phones are still extremely popular, and their owners do use them to browse the web – especially in countries where mobile phones are easier to get than a broadband connection.</span></span> <span data-ttu-id="b8788-140">Организации, необходимо решить, какой диапазон устройствах для поддержки, учитывая его вероятных заказчиков.</span><span class="sxs-lookup"><span data-stu-id="b8788-140">Your business will need to decide what range of devices to support by considering its likely customers.</span></span> <span data-ttu-id="b8788-141">При создании документации брошюр для spa работоспособности luxury, может стать деловое решение только для расширенного смартфоны, в то время как при создании билета система бронирования кинофильмов, возможно, нужно учитывать посетителей с менее мощная функция телефоны.</span><span class="sxs-lookup"><span data-stu-id="b8788-141">If you're building an online brochure for a luxury health spa, you might make a business decision only to target advanced smartphones, whereas if you're creating a ticket booking system for a cinema, you probably need to account for visitors with less powerful feature phones.</span></span>

## <a name="architectural-options"></a><span data-ttu-id="b8788-142">Параметры архитектуры</span><span class="sxs-lookup"><span data-stu-id="b8788-142">Architectural options</span></span>

<span data-ttu-id="b8788-143">Прежде чем мы приступим к конкретных технических особенностей веб-форм ASP.NET или MVC, обратите внимание, что веб-разработчиков в целом три основных возможных варианта поддержка мобильных браузеров:</span><span class="sxs-lookup"><span data-stu-id="b8788-143">Before we get to the specific technical details of ASP.NET Web Forms or MVC, note that web developers in general have three main possible options for supporting mobile browsers:</span></span>

1. <span data-ttu-id="b8788-144">***Не выполнять никаких действий —*** просто можно создавать стандартные, для рабочей среды веб-приложения и используют браузеры для мобильных устройств для воспроизведения приемлемой производительностью.</span><span class="sxs-lookup"><span data-stu-id="b8788-144">***Do nothing –*** You can simply create a standard, desktop-oriented web application, and rely on mobile browsers to render it acceptably.</span></span> 

    - <span data-ttu-id="b8788-145">**Преимущества**: дешевые вариант для реализации и обслуживания — никаких дополнительных работы</span><span class="sxs-lookup"><span data-stu-id="b8788-145">**Advantage**: It's the cheapest option to implement and maintain – no extra work</span></span>
    - <span data-ttu-id="b8788-146">**Недостаток**: дает наихудшее взаимодействие с конечным пользователем:</span><span class="sxs-lookup"><span data-stu-id="b8788-146">**Disadvantage**: Gives the worst end-user experience:</span></span> 

        - <span data-ttu-id="b8788-147">Последние смартфонов может отображаться HTML так же, как и браузер на компьютере, но пользователи по-прежнему обязательно для масштабирования и прокрутки по горизонтали и вертикали для использования содержимого, на небольшом экране.</span><span class="sxs-lookup"><span data-stu-id="b8788-147">The latest smartphones may render your HTML just as well as a desktop browser, but users will still be forced to zoom and scroll horizontally and vertically to consume your content on a small screen.</span></span> <span data-ttu-id="b8788-148">Это далеко от оптимальной.</span><span class="sxs-lookup"><span data-stu-id="b8788-148">This is far from optimal.</span></span>
        - <span data-ttu-id="b8788-149">Старые устройства и телефоны функции могут не отображаться разметке удовлетворительным образом.</span><span class="sxs-lookup"><span data-stu-id="b8788-149">Older devices and feature phones may fail to render your markup in a satisfactory way.</span></span>
        - <span data-ttu-id="b8788-150">Даже на последнюю планшетные устройства (экраны, может быть большим, чем экранах ноутбуков) применяются правила различные взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="b8788-150">Even on the latest tablet devices (whose screens can be as big as laptop screens), different interaction rules apply.</span></span> <span data-ttu-id="b8788-151">Ввод на основе Touch лучше всего работает с размером кнопок и связывает разворота дальнейшей друг от друга и нет возможности для наведите курсор мыши на вспомогательное раскрывающееся меню.</span><span class="sxs-lookup"><span data-stu-id="b8788-151">Touch-based input works best with larger buttons and links spread further apart, and there's no way to hover a mouse cursor over a fly-out menu.</span></span>
2. <span data-ttu-id="b8788-152">***Решить проблему на клиенте* —** с Аккуратное использование CSS и [прогрессивном расширении](http://en.wikipedia.org/wiki/Progressive_enhancement) можно создать разметку, стили и скрипты, адаптироваться к их работает независимо от браузера.</span><span class="sxs-lookup"><span data-stu-id="b8788-152">***Solve the problem on the client* –** With careful use of CSS and [progressive enhancement](http://en.wikipedia.org/wiki/Progressive_enhancement) you can create markup, styles, and scripts that adapt to whatever browser is running them.</span></span> <span data-ttu-id="b8788-153">Например, с помощью [медиа-запросами CSS 3](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/), можно создать многостолбцовый макет для включения устройств экраны, более узких, чем выбранные пороговые значения в одном столбце макет.</span><span class="sxs-lookup"><span data-stu-id="b8788-153">For example, with [CSS 3 media queries](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/), you could create a multi-column layout that turns into a single column layout on devices whose screens are narrower than a chosen threshold.</span></span> 

    - <span data-ttu-id="b8788-154">**Преимущества**: оптимизация отрисовки для конкретного устройства используется, даже для неизвестных будущих устройств для любого экрана и характеристики входных они имеют</span><span class="sxs-lookup"><span data-stu-id="b8788-154">**Advantage**: Optimizes rendering for the specific device in use, even for unknown future devices according to whatever screen and input characteristics they have</span></span>
    - <span data-ttu-id="b8788-155">**Преимущества**: легко позволяет совместно использовать логику на стороне сервера на всех типах устройств — минимальный дублирования кода или трудозатрат</span><span class="sxs-lookup"><span data-stu-id="b8788-155">**Advantage**: Easily lets you share server-side logic across all device types – minimal duplication of code or effort</span></span>
    - <span data-ttu-id="b8788-156">**Недостаток**: мобильные устройства, поэтому отличается от настольных компьютеров, которые действительно можно мобильных веб-страниц полностью отличались от классических страниц, с другой информацией.</span><span class="sxs-lookup"><span data-stu-id="b8788-156">**Disadvantage**: Mobile devices are so different from desktop devices that you may really want your mobile pages to be completely different from your desktop pages, showing different information.</span></span> <span data-ttu-id="b8788-157">Такие варианты может оказаться неэффективным или невозможно надежно посредством CSS сама по себе, учитывая то, как и несогласованно старые устройства интерпретации правил CSS.</span><span class="sxs-lookup"><span data-stu-id="b8788-157">Such variations can be inefficient or impossible to achieve robustly through CSS alone, especially considering how inconsistently older devices interpret CSS rules.</span></span> <span data-ttu-id="b8788-158">Это особенно верно атрибутов CSS 3.</span><span class="sxs-lookup"><span data-stu-id="b8788-158">This is particularly true of CSS 3 attributes.</span></span>
    - <span data-ttu-id="b8788-159">**Недостаток**: не поддерживает различные логику на стороне сервера и рабочие процессы для различных устройств.</span><span class="sxs-lookup"><span data-stu-id="b8788-159">**Disadvantage**: Provides no support for varying server-side logic and workflows for different devices.</span></span> <span data-ttu-id="b8788-160">Например, нельзя реализовать упрощенную покупательской корзины для покупок извлечения рабочего процесса для мобильных пользователей с помощью CSS сама по себе.</span><span class="sxs-lookup"><span data-stu-id="b8788-160">You can't, for example, implement a simplified shopping cart checkout workflow for mobile users by means of CSS alone.</span></span>
    - <span data-ttu-id="b8788-161">**Недостаток**: неэффективным пропускной способности сети.</span><span class="sxs-lookup"><span data-stu-id="b8788-161">**Disadvantage**: Inefficient bandwidth use.</span></span> <span data-ttu-id="b8788-162">Ваш сервер может потребоваться передачи разметки и стили, которые применяются для всех устройств, возможно, даже если на целевом устройстве будет использовать только подмножество этих данных.</span><span class="sxs-lookup"><span data-stu-id="b8788-162">You server may have to transmit the markup and styles that apply to all possible devices, even though the target device will only use a subset of that information.</span></span>
3. <span data-ttu-id="b8788-163">***Решить проблему на сервере* —** Если сервер знает, какое устройство имеет доступ к нему — или наименьших характеристики этого устройства, такие как размер экрана и метода ввода и будет ли это мобильное устройство, оно может работать другой логикой и выходные данные различных HTML-разметка.</span><span class="sxs-lookup"><span data-stu-id="b8788-163">***Solve the problem on the server* –** If your server knows what device is accessing it – or at least the characteristics of that device, such as its screen size and input method, and whether it's a mobile device – it can run different logic and output different HTML markup.</span></span> 

    - <span data-ttu-id="b8788-164">**Преимущество:** максимально гибкость.</span><span class="sxs-lookup"><span data-stu-id="b8788-164">**Advantage:** Maximum flexibility.</span></span> <span data-ttu-id="b8788-165">Не ограничено сколько различаются серверную логику для мобильных устройств или оптимизировать разметку для нужного макета конкретного устройства.</span><span class="sxs-lookup"><span data-stu-id="b8788-165">There's no limit to how much you can vary your server-side logic for mobiles or optimize your markup for the desired, device-specific layout.</span></span>
    - <span data-ttu-id="b8788-166">**Преимущество:** эффективный пропускной способности сети.</span><span class="sxs-lookup"><span data-stu-id="b8788-166">**Advantage:** Efficient bandwidth use.</span></span> <span data-ttu-id="b8788-167">Необходимо передавать разметки и сведения о стиле, которую планируется использовать целевое устройство.</span><span class="sxs-lookup"><span data-stu-id="b8788-167">You only need to transmit the markup and styling information that the target device is going to use.</span></span>
    - <span data-ttu-id="b8788-168">**Недостаток:** иногда вызывает повторение трудозатрат или код (например, сделав создания копии похожие, но слегка различные страницы Web Forms или представлений MVC).</span><span class="sxs-lookup"><span data-stu-id="b8788-168">**Disadvantage:** Sometimes forces repetition of effort or code (e.g., making you create similar but slightly different copies of your Web Forms pages or MVC views).</span></span> <span data-ttu-id="b8788-169">Где возможно, вам необходимо учитывать out общую логику базового уровня или службы, но, тем не менее, некоторые части кода пользовательского интерфейса или разметки возможно дублирование и затем изменяются в параллельном режиме.</span><span class="sxs-lookup"><span data-stu-id="b8788-169">Where possible you will factor out common logic into an underlying layer or service, but still, some parts of your UI code or markup may have to be duplicated and then maintained in parallel.</span></span>
    - <span data-ttu-id="b8788-170">**Недостаток:** обнаружение устройств является непростой задачей.</span><span class="sxs-lookup"><span data-stu-id="b8788-170">**Disadvantage:** Device detection is not trivial.</span></span> <span data-ttu-id="b8788-171">Он требует базы данных типов известным устройством и их характеристики (которые не всегда может быть полностью актуальные) и не обязательно точно соответствует каждого входящего запроса.</span><span class="sxs-lookup"><span data-stu-id="b8788-171">It requires a list or database of known device types and their characteristics (which may not always be perfectly up-to-date) and isn't guaranteed to accurately match every incoming request.</span></span> <span data-ttu-id="b8788-172">В этом документе описываются некоторые параметры и их проблемы позже.</span><span class="sxs-lookup"><span data-stu-id="b8788-172">This document describes some options and their pitfalls later.</span></span>

<span data-ttu-id="b8788-173">Чтобы получить наилучший результат, большинство разработчиков найти их нужно объединить параметры (2) и (3).</span><span class="sxs-lookup"><span data-stu-id="b8788-173">To get the best results, most developers find they need to combine options (2) and (3).</span></span> <span data-ttu-id="b8788-174">Незначительные отличия стилистических лучше всего объединяются на клиентах, использующих CSS или даже JavaScript, тогда как наиболее эффективно существенные различия в данных, рабочий процесс или разметки реализованы в серверный код.</span><span class="sxs-lookup"><span data-stu-id="b8788-174">Minor stylistic differences are best accommodated on the client using CSS or even JavaScript, whereas major differences in data, workflow, or markup are most effectively implemented in server-side code.</span></span>

### <a name="this-paper-focuses-on-server-side-techniques"></a><span data-ttu-id="b8788-175">Этот документ посвящен методы на стороне сервера</span><span class="sxs-lookup"><span data-stu-id="b8788-175">This paper focuses on server-side techniques</span></span>

<span data-ttu-id="b8788-176">Поскольку веб-форм ASP.NET и MVC обеих технологий в основном сервере, в этом техническом документе основное внимание уделяется серверные методы, которые позволяют создавать различные разметки и логику для браузеры для мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="b8788-176">Since ASP.NET Web Forms and MVC are both primarily server-side technologies, this white paper will focus on server-side techniques that let you produce different markup and logic for mobile browsers.</span></span> <span data-ttu-id="b8788-177">Конечно это также можно объединять с любой клиентский метод (например, CSS 3 медиа-запросами, улучшение прогрессивный JavaScript), но это более нескольких веб-дизайн чем разработки ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="b8788-177">Of course, you can also combine this with any client-side technique (e.g., CSS 3 media queries, progressive-enhancement JavaScript), but that's more a matter of web design than ASP.NET development.</span></span>

## <a name="browser-and-device-detection"></a><span data-ttu-id="b8788-178">Обнаружение браузеров и устройств</span><span class="sxs-lookup"><span data-stu-id="b8788-178">Browser and device detection</span></span>

<span data-ttu-id="b8788-179">Является знать, какие устройства использует посетителем ключа необходимым условием для всех серверных механизмов для поддержки мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="b8788-179">The key prerequisite for all server-side techniques for supporting mobile devices is to know what device your visitor is using.</span></span> <span data-ttu-id="b8788-180">На самом деле, даже лучше узнать номер изготовителя и модель этого устройства требуется знать *характеристики* устройства.</span><span class="sxs-lookup"><span data-stu-id="b8788-180">In fact, even better than knowing the manufacturer and model number of that device is knowing the *characteristics* of the device.</span></span> <span data-ttu-id="b8788-181">Характеристики могут включать:</span><span class="sxs-lookup"><span data-stu-id="b8788-181">Characteristics may include:</span></span>

- <span data-ttu-id="b8788-182">Это мобильное устройство?</span><span class="sxs-lookup"><span data-stu-id="b8788-182">Is it a mobile device?</span></span>
- <span data-ttu-id="b8788-183">Метод ввода (клавиатуры и мыши, касания, клавиатуры, джойстик,...)</span><span class="sxs-lookup"><span data-stu-id="b8788-183">Input method (mouse/keyboard, touch, keypad, joystick, …)</span></span>
- <span data-ttu-id="b8788-184">Размер экрана (физически и в точках)</span><span class="sxs-lookup"><span data-stu-id="b8788-184">Screen size (physically and in pixels)</span></span>
- <span data-ttu-id="b8788-185">Поддерживаемые форматы мультимедиа и данных</span><span class="sxs-lookup"><span data-stu-id="b8788-185">Supported media and data formats</span></span>
- <span data-ttu-id="b8788-186">И т. д.</span><span class="sxs-lookup"><span data-stu-id="b8788-186">Etc.</span></span>

<span data-ttu-id="b8788-187">Рекомендуется для принятия решений, на основе характеристик, чем номер модели, так как, а затем вы сможете более широкие возможности для обработки будущих устройствах.</span><span class="sxs-lookup"><span data-stu-id="b8788-187">It's better to make decisions based on characteristics than model number, because then you'll be better equipped to handle future devices.</span></span>

### <a name="using-aspnets-built-in-browser-detection-support"></a><span data-ttu-id="b8788-188">С помощью ASP. Поддержку обнаружения NET встроенного браузера</span><span class="sxs-lookup"><span data-stu-id="b8788-188">Using ASP.NET's built-in browser detection support</span></span>

<span data-ttu-id="b8788-189">Веб-форм ASP.NET и MVC разработчики могут сразу обнаружить важные характеристики посещаемый обозреватель путем проверки свойств *Request.Browser* объекта.</span><span class="sxs-lookup"><span data-stu-id="b8788-189">ASP.NET Web Forms and MVC developers can immediately discover important characteristics of a visiting browser by inspecting properties of the *Request.Browser* object.</span></span> <span data-ttu-id="b8788-190">Например см.</span><span class="sxs-lookup"><span data-stu-id="b8788-190">For example, see</span></span>

- <span data-ttu-id="b8788-191">Request.Browser.IsMobileDevice</span><span class="sxs-lookup"><span data-stu-id="b8788-191">Request.Browser.IsMobileDevice</span></span>
- <span data-ttu-id="b8788-192">Request.Browser.MobileDeviceManufacturer Request.Browser.MobileDeviceModel</span><span class="sxs-lookup"><span data-stu-id="b8788-192">Request.Browser.MobileDeviceManufacturer, Request.Browser.MobileDeviceModel</span></span>
- <span data-ttu-id="b8788-193">Request.Browser.ScreenPixelsWidth</span><span class="sxs-lookup"><span data-stu-id="b8788-193">Request.Browser.ScreenPixelsWidth</span></span>
- <span data-ttu-id="b8788-194">Request.Browser.SupportsXmlHttp</span><span class="sxs-lookup"><span data-stu-id="b8788-194">Request.Browser.SupportsXmlHttp</span></span>
- <span data-ttu-id="b8788-195">...и многие другие</span><span class="sxs-lookup"><span data-stu-id="b8788-195">…and many others</span></span>

<span data-ttu-id="b8788-196">В фоновом платформы ASP.NET соответствует входящего *User-Agent* заголовок HTTP (UA) от регулярных выражений в набор файлов XML определения браузера.</span><span class="sxs-lookup"><span data-stu-id="b8788-196">Behind the scenes, the ASP.NET platform matches the incoming *User-Agent* (UA) HTTP header against regular expressions in a set of Browser Definition XML files.</span></span> <span data-ttu-id="b8788-197">По умолчанию платформа включает определения для многих распространенных мобильных устройств и для других пользователей, которые намечены для распознавания можно добавить пользовательские файлы описания браузера.</span><span class="sxs-lookup"><span data-stu-id="b8788-197">By default the platform includes definitions for many common mobile devices, and you can add custom Browser Definition files for others you wish to recognize.</span></span> <span data-ttu-id="b8788-198">Дополнительные сведения см. на странице MSDN [ASP.NET серверных элементов управления и возможности браузера](https://msdn.microsoft.com/library/x3k2ssx2.aspx).</span><span class="sxs-lookup"><span data-stu-id="b8788-198">For more details, see the MSDN page [ASP.NET Web Server Controls and Browser Capabilities](https://msdn.microsoft.com/library/x3k2ssx2.aspx).</span></span>

### <a name="using-the-wurfl-device-database-via-51degreesmobi-foundation"></a><span data-ttu-id="b8788-199">С помощью базы данных устройства WURFL через 51Degrees.mobi Foundation</span><span class="sxs-lookup"><span data-stu-id="b8788-199">Using the WURFL device database via 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="b8788-200">Хотя ASP. Поддержку обнаружения NET встроенного браузера будет достаточно для многих приложений, существует два основных варианта при может быть недостаточно.</span><span class="sxs-lookup"><span data-stu-id="b8788-200">While ASP.NET's built-in browser detection support will be sufficient for many applications, there are two main cases when it might not be enough:</span></span>

- <span data-ttu-id="b8788-201">***Требуется распознавать последнюю устройства***(без создания файлов определения браузера для них вручную).</span><span class="sxs-lookup"><span data-stu-id="b8788-201">***You want to recognize the latest devices***(without manually creating Browser Definition files for them).</span></span> <span data-ttu-id="b8788-202">Обратите внимание, что файлы определений браузера .NET 4 не недостаточно актуальной для распознавания Windows Phone 7, телефонов Android, Opera Mobile браузеры или устройств Apple iPad.</span><span class="sxs-lookup"><span data-stu-id="b8788-202">Note that .NET 4's Browser Definition files are not recent enough to recognize Windows Phone 7, Android phones, Opera Mobile browsers, or Apple iPads.</span></span>
- <span data-ttu-id="b8788-203">***Более подробные сведения о возможности устройства***.</span><span class="sxs-lookup"><span data-stu-id="b8788-203">***You need more detailed information about device capabilities***.</span></span> <span data-ttu-id="b8788-204">Необходимо знать о метода ввода устройства (например, сенсорный ввод vs на цифровой клавиатуре) или какие аудио форматов браузер поддерживает.</span><span class="sxs-lookup"><span data-stu-id="b8788-204">You may need to know about a device's input method (e.g., touch vs keypad), or what audio formats the browser supports.</span></span> <span data-ttu-id="b8788-205">Эти сведения недоступны в стандартных файлах определения браузера.</span><span class="sxs-lookup"><span data-stu-id="b8788-205">This information isn't available in the standard Browser Definition files.</span></span>

<span data-ttu-id="b8788-206">[ *Файл ресурсов с универсальными беспроводной* проекта (WURFL)](http://wurfl.sourceforge.net/) поддерживает намного больше актуальные и подробные сведения о мобильных устройствах используется сегодня.</span><span class="sxs-lookup"><span data-stu-id="b8788-206">The [*Wireless Universal Resource File* (WURFL) project](http://wurfl.sourceforge.net/) maintains much more up-to-date and detailed information about mobile devices in use today.</span></span>

<span data-ttu-id="b8788-207">Хорошая новость для разработчиков .NET-ASP. Возможность обнаружения NET браузера является расширяемой, поэтому можно расширить его возможности для решения этих проблем.</span><span class="sxs-lookup"><span data-stu-id="b8788-207">The great news for .NET developers is that ASP.NET's browser detection feature is extensible, so it's possible to enhance it to overcome these problems.</span></span> <span data-ttu-id="b8788-208">Например, можно добавить открытый исходный код [ *51Degrees.mobi Foundation* ](https://github.com/51Degrees/dotNET-Device-Detection) библиотеки в проект.</span><span class="sxs-lookup"><span data-stu-id="b8788-208">For example, you can add the open source [*51Degrees.mobi Foundation*](https://github.com/51Degrees/dotNET-Device-Detection) library to your project.</span></span> <span data-ttu-id="b8788-209">Он является ASP.NET IHttpModule или поставщики возможностей (может использоваться в приложениях веб-форм и MVC), который непосредственно считывает данные WURFL и подключит его в ASP. Механизм обнаружения NET встроенного браузера.</span><span class="sxs-lookup"><span data-stu-id="b8788-209">It's an ASP.NET IHttpModule or Browser Capabilities Provider (usable on both Web Forms and MVC applications), that directly reads WURFL data and hooks it into ASP.NET's built-in browser detection mechanism.</span></span> <span data-ttu-id="b8788-210">После установки модуля, *Request.Browser* внезапно будет содержать гораздо более точными и подробные сведения: он правильно распознает многие из упомянутых выше устройств и их возможности (в том числе список Дополнительные возможности, например метода ввода).</span><span class="sxs-lookup"><span data-stu-id="b8788-210">Once you've installed the module, *Request.Browser* will suddenly contain a lot more accurate and detailed information: it will correctly recognize many of the devices previously mentioned and list their capabilities (including additional capabilities such as input method).</span></span> <span data-ttu-id="b8788-211">В документации проекта для получения дополнительных сведений.</span><span class="sxs-lookup"><span data-stu-id="b8788-211">See the project's documentation for more details.</span></span>

## <a name="how-web-forms-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="b8788-212">Как приложений веб-форм может представлять страницы конкретных мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="b8788-212">How Web Forms applications can present mobile-specific pages</span></span>

<span data-ttu-id="b8788-213">По умолчанию Вот способ отображения нового приложения Web Forms на общих мобильных устройств:</span><span class="sxs-lookup"><span data-stu-id="b8788-213">By default, here's how a brand new Web Forms application displays on common mobile devices:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image1.png)

<span data-ttu-id="b8788-214">Очевидно ни макета выглядит очень мобильной — Эта страница была разработана для больших и альбомной ориентацией монитора не для маленьком экране ориентированного книжной ориентации.</span><span class="sxs-lookup"><span data-stu-id="b8788-214">Clearly, neither layout looks very mobile-friendly – this page was designed for a large, landscape-oriented monitor, not for a small portrait-oriented screen.</span></span> <span data-ttu-id="b8788-215">Так что можно делать?</span><span class="sxs-lookup"><span data-stu-id="b8788-215">So what can you do about it?</span></span>

<span data-ttu-id="b8788-216">Как было описано ранее в этом документе, существует множество способов настройки страниц для мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="b8788-216">As discussed earlier in this paper, there are many ways to tailor your pages for mobile devices.</span></span> <span data-ttu-id="b8788-217">Некоторые методы основаны на сервере, запустить другие пользователи на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="b8788-217">Some techniques are server-based, others run on the client.</span></span>

### <a name="creating-a-mobile-specific-master-page"></a><span data-ttu-id="b8788-218">Создание мобильных обозревателей главной страницы</span><span class="sxs-lookup"><span data-stu-id="b8788-218">Creating a mobile-specific master page</span></span>

<span data-ttu-id="b8788-219">В зависимости от требований, можно использовать одного веб-форм для всех посетителей, но имеют два главных страниц разделения: один для настольных компьютеров посетителей, другой — для мобильных устройств посетителей.</span><span class="sxs-lookup"><span data-stu-id="b8788-219">Depending on your requirements, you may be able to use the same Web Forms for all visitors, but have two separate master pages: one for desktop visitors, another for mobile visitors.</span></span> <span data-ttu-id="b8788-220">Это обеспечивает гибкость изменения таблицы стилей CSS или верхнего уровня в соответствии с мобильных устройств без перезагрузки для дублирования логики страницы разметки HTML.</span><span class="sxs-lookup"><span data-stu-id="b8788-220">This gives you the flexibility of changing the CSS stylesheet or your top-level HTML markup to suit mobile devices, without forcing you to duplicate any page logic.</span></span>

<span data-ttu-id="b8788-221">Это легко сделать.</span><span class="sxs-lookup"><span data-stu-id="b8788-221">This is easy to do.</span></span> <span data-ttu-id="b8788-222">Например веб-форму можно добавить обработчик PreInit примерно следующего вида:</span><span class="sxs-lookup"><span data-stu-id="b8788-222">For example, you can add a PreInit handler such as the following to a Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample1.cs)]

<span data-ttu-id="b8788-223">Теперь создайте главную страницу вызывается Mobile.Master в папке верхнего уровня приложения и будет использоваться при обнаружении мобильного устройства.</span><span class="sxs-lookup"><span data-stu-id="b8788-223">Now, create a master page called Mobile.Master in the top-level folder of your application, and it will be used when a mobile device is detected.</span></span> <span data-ttu-id="b8788-224">Вашей мобильной главной страницы может ссылаться таблица стилей CSS конкретных мобильных устройств, при необходимости.</span><span class="sxs-lookup"><span data-stu-id="b8788-224">Your mobile master page can reference a mobile-specific CSS stylesheet if necessary.</span></span> <span data-ttu-id="b8788-225">Посетители рабочего стола будет просматривать главную страницу по умолчанию, не соответствует мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="b8788-225">Desktop visitors will still see your default master page, not the mobile one.</span></span>

### <a name="creating-independent-mobile-specific-web-forms"></a><span data-ttu-id="b8788-226">Создание независимых конкретных мобильных веб-форм</span><span class="sxs-lookup"><span data-stu-id="b8788-226">Creating independent mobile-specific Web Forms</span></span>

<span data-ttu-id="b8788-227">Для обеспечения максимальной гибкости вы можете перейти гораздо больше, чем только наличие отдельных главные страницы для разных типов устройств.</span><span class="sxs-lookup"><span data-stu-id="b8788-227">For maximum flexibility, you can go much further than just having separate master pages for different device types.</span></span> <span data-ttu-id="b8788-228">Можно реализовать двумя *полностью разделения наборов страниц веб-форм* — один набор для браузеров настольных компьютеров, другой набор для мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="b8788-228">You can implement two *totally separate sets of Web Forms pages* – one set for desktop browsers, another set for mobiles.</span></span> <span data-ttu-id="b8788-229">Это работает лучше, если вы хотите предоставлять совершенно разные сведения или рабочих процессов для мобильных устройств посетителей.</span><span class="sxs-lookup"><span data-stu-id="b8788-229">This works best if you want to present very different information or workflows to mobile visitors.</span></span> <span data-ttu-id="b8788-230">В оставшейся части этого раздела описывается этот подход подробно.</span><span class="sxs-lookup"><span data-stu-id="b8788-230">The rest of this section describes this approach in detail.</span></span>

<span data-ttu-id="b8788-231">При условии, что у вас уже есть веб-форм, предназначенной для браузеров настольных компьютеров, чтобы продолжить проще создать вложенную папку с именем «Мобильный» в проекте и построения ваших мобильных страниц.</span><span class="sxs-lookup"><span data-stu-id="b8788-231">Assuming you already have a Web Forms application designed for desktop browsers, the easiest way to proceed is to create a subfolder called "Mobile" within your project, and build your mobile pages there.</span></span> <span data-ttu-id="b8788-232">Можно создавать всего дочерних сайтов с собственными главные страницы, таблицы стилей и страниц, используя те же методы, которые используются для других приложений веб-форм.</span><span class="sxs-lookup"><span data-stu-id="b8788-232">You can construct an entire sub-site, with its own master pages, style sheets, and pages, using all the same techniques that you'd use for any other Web Forms application.</span></span> <span data-ttu-id="b8788-233">Не обязательно создавать мобильные эквивалента для *каждого* страницы на сайте рабочего стола; вы можете определить, какая часть функциональности имеет смысл для мобильных устройств посетителей.</span><span class="sxs-lookup"><span data-stu-id="b8788-233">You don't necessarily need to produce a mobile equivalent for *every* page in your desktop site; you can choose what subset of functionality makes sense for mobile visitors.</span></span>

<span data-ttu-id="b8788-234">Мобильных веб-страниц могут совместно использовать общие статические ресурсы (такие как изображения, JavaScript и CSS файлы) с вашей обычных страниц, при необходимости.</span><span class="sxs-lookup"><span data-stu-id="b8788-234">Your mobile pages can share common static resources (such as images, JavaScript, or CSS files) with your regular pages if you wish.</span></span> <span data-ttu-id="b8788-235">Так как в папке «Мобильный» будет *не* помечается как отдельное приложение при размещении в IIS (это только простой вложенной страницы веб-форм), он будет также совместно использовать те же конфигурации, данных сеанса и другой инфраструктурой, как ваш системной страницы.</span><span class="sxs-lookup"><span data-stu-id="b8788-235">Since your "Mobile" folder will *not* be marked as a separate application when hosted in IIS (it's just a simple subfolder of Web Forms pages), it will also share all the same configuration, Session data, and other infrastructure as your desktop pages.</span></span>

> [!NOTE]
> <span data-ttu-id="b8788-236">Поскольку этот подход обычно включает некоторые дублирования кода (страницах для мобильных устройств, скорее всего, для совместного использования некоторые сходства с рабочего стола страниц), очень важно отделяют любого общих кода бизнес-логики и данных access в общий базовый уровень или службу.</span><span class="sxs-lookup"><span data-stu-id="b8788-236">Since this approach usually involves some duplication of code (mobile pages are likely to share some similarities with desktop pages), it's important to factor out any common business logic or data access code into a shared underlying layer or service.</span></span> <span data-ttu-id="b8788-237">В противном случае вам потребуется выполнить double усилия на создание и обслуживание приложения.</span><span class="sxs-lookup"><span data-stu-id="b8788-237">Otherwise, you'll double the effort of creating and maintaining your application.</span></span>


#### <a name="redirecting-mobile-visitors-to-your-mobile-pages"></a><span data-ttu-id="b8788-238">Перенаправление мобильных посетителям мобильных веб-страниц</span><span class="sxs-lookup"><span data-stu-id="b8788-238">Redirecting mobile visitors to your mobile pages</span></span>

<span data-ttu-id="b8788-239">Часто бывает удобно для перенаправления мобильных посетителям страницах для мобильных устройств только в случае *первый* запрос в их сеанса просмотра (но не на каждый запрос в свой сеанс), поскольку:</span><span class="sxs-lookup"><span data-stu-id="b8788-239">It's often convenient to redirect mobile visitors to the mobile pages only on the *first* request in their browsing session (and not on every request in their session), because:</span></span>

- <span data-ttu-id="b8788-240">Затем можно легко включить посетители мобильных устройств для доступа к страницам рабочего стола по желанию — просто добавить ссылку на главной странице, идущий «Версии рабочего стола».</span><span class="sxs-lookup"><span data-stu-id="b8788-240">You can then easily allow mobile visitors to access your desktop pages if they wish – just put a link on your master page that goes to "Desktop version".</span></span> <span data-ttu-id="b8788-241">Посетитель не попасть на странице для мобильных устройств, так как это не первый запрос в свой сеанс.</span><span class="sxs-lookup"><span data-stu-id="b8788-241">The visitor won't be redirected back to a mobile page, because it's no longer the first request in their session.</span></span>
- <span data-ttu-id="b8788-242">Она позволяет избежать риска конфликта с запросов любых динамических ресурсов совместно для настольных компьютеров и мобильных устройств частей узла (например, при наличии общих веб-формы, настольных компьютеров и мобильных устройств частей узла отображения IFRAME или в определенных обработчики Ajax)</span><span class="sxs-lookup"><span data-stu-id="b8788-242">It avoids the risk of interfering with requests for any dynamic resources shared between desktop and mobile parts of your site (e.g., if you have a common Web Form that both desktop and mobile parts of your site display in an IFRAME, or certain Ajax handlers)</span></span>

<span data-ttu-id="b8788-243">Чтобы сделать это, можно разместить логику перенаправления в **сеанса\_запустить** метод.</span><span class="sxs-lookup"><span data-stu-id="b8788-243">To do this, you can place your redirection logic in a **Session\_Start** method.</span></span> <span data-ttu-id="b8788-244">Например добавьте следующий метод в файл Global.asax.cs:</span><span class="sxs-lookup"><span data-stu-id="b8788-244">For example, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample2.cs)]

#### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="b8788-245">Настройка проверки подлинности форм с соблюдением мобильных веб-страниц</span><span class="sxs-lookup"><span data-stu-id="b8788-245">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="b8788-246">Обратите внимание, что проверка подлинности форм делает определенные предположения о которых он может перенаправить посетителей, во время и после процесса проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="b8788-246">Note that Forms Authentication makes certain assumptions about where it can redirect visitors during and after the authentication process:</span></span>

- <span data-ttu-id="b8788-247">Когда пользователь должен пройти проверку подлинности, проверки подлинности форм перенаправит их на страницу входа рабочего стола, независимо от ли они настольных компьютеров или мобильных пользователей (так как только он имеет смысл *один* URL-адрес входа).</span><span class="sxs-lookup"><span data-stu-id="b8788-247">When a user needs to be authenticated, Forms Authentication will redirect them to your desktop login page, regardless of whether they're a desktop or mobile user (because it only has a concept of *one* login URL).</span></span> <span data-ttu-id="b8788-248">Предположим, что вы хотите по-разному в стиле страницы регистрации мобильных устройств, необходимо повысить страница входа рабочего стола, чтобы он перенаправляет мобильных пользователей на страницу входа отдельных мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="b8788-248">Assuming you want to style your mobile login page differently, you need to enhance your desktop login page so that it redirects mobile users to a separate mobile login page.</span></span> <span data-ttu-id="b8788-249">Например, добавьте следующий код в вашей **рабочего стола** входа страница кода:</span><span class="sxs-lookup"><span data-stu-id="b8788-249">For example, add the following code to your **desktop** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample3.cs)]
- <span data-ttu-id="b8788-250">После успешного входа пользователя формы проверки подлинности по умолчанию перенаправит их на домашнюю страницу рабочего стола (так как только он имеет смысл *один* страница по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="b8788-250">After a user successfully logs in, Forms Authentication will by default redirect them to your desktop home page (because it only has a concept of *one* default page).</span></span> <span data-ttu-id="b8788-251">Необходимо расширить страницы регистрации мобильных устройств, чтобы он перенаправляет на mobile домашнюю страницу после успешного входа в.</span><span class="sxs-lookup"><span data-stu-id="b8788-251">You need to enhance your mobile login page so that it redirects to the mobile home page after a successful log-in.</span></span> <span data-ttu-id="b8788-252">Например, добавьте следующий код в вашей **мобильных** входа страница кода:</span><span class="sxs-lookup"><span data-stu-id="b8788-252">For example, add the following code to your **mobile** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample4.cs)]
  
  <span data-ttu-id="b8788-253">Данный код предполагает, что страницы имеется элемент управления сервера имя входа с именем LoginUser, как в шаблоне проекта по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="b8788-253">This code assumes your page has a Login server control called LoginUser, as in the default project template.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="b8788-254">Работа с кэширования выходных данных</span><span class="sxs-lookup"><span data-stu-id="b8788-254">Working with Output Caching</span></span>

<span data-ttu-id="b8788-255">При использовании кэширования вывода, имейте в виду, что по умолчанию для рабочего стола пользователя посетить определенных URL-адрес (в результате чего выходных данных, чтобы кэшировать) возможна, за которым следует мобильных пользователей, которые затем получает кэшированным рабочего стола.</span><span class="sxs-lookup"><span data-stu-id="b8788-255">If you're using output caching, beware that by default it's possible for a desktop user to visit a certain URL (causing its output to be cached), followed by a mobile user who then receives the cached desktop output.</span></span> <span data-ttu-id="b8788-256">Это предупреждение относится ли вы будете просто varying главную страницу по типу устройства или реализации совершенно другого веб-форм для каждого типа устройств.</span><span class="sxs-lookup"><span data-stu-id="b8788-256">This warning applies whether you're just varying your master page by device type, or implementing totally separate Web Forms per device type.</span></span>

<span data-ttu-id="b8788-257">Чтобы избежать проблемы, можно настроить ASP.NET для изменения записи кэша в соответствии с ли посетителя с помощью мобильного устройства.</span><span class="sxs-lookup"><span data-stu-id="b8788-257">To avoid the problem, you can instruct ASP.NET to vary the cache entry according to whether the visitor is using a mobile device.</span></span> <span data-ttu-id="b8788-258">Добавьте параметр VaryByCustom объявление OutputCache на странице следующим образом.</span><span class="sxs-lookup"><span data-stu-id="b8788-258">Add a VaryByCustom parameter to your page's OutputCache declaration as follows:</span></span>

[!code-aspx[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample5.aspx)]

<span data-ttu-id="b8788-259">Затем определите *isMobileDevice* как кэш пользовательского параметра, добавив следующий метод переопределения Global.asax.cs файл:</span><span class="sxs-lookup"><span data-stu-id="b8788-259">Next, define *isMobileDevice* as a custom cache parameter by adding the following method override to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample6.cs)]

<span data-ttu-id="b8788-260">Это позволит гарантировать, что мобильных посетителями не получать выходные данные, ранее поместить в кэш рабочих столов посетителем.</span><span class="sxs-lookup"><span data-stu-id="b8788-260">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="b8788-261">Рабочий пример</span><span class="sxs-lookup"><span data-stu-id="b8788-261">A working example</span></span>

<span data-ttu-id="b8788-262">Для просмотра этих методов в действии, загрузите [примеры кода в этом техническом документе](https://docs.microsoft.com/aspnet/mobile/overview).</span><span class="sxs-lookup"><span data-stu-id="b8788-262">To see these techniques in action, download [this white paper's code samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="b8788-263">Образец приложения Web Forms автоматически перенаправляет набор страниц, относящихся к mobile во вложенной папке Mobile мобильных пользователей.</span><span class="sxs-lookup"><span data-stu-id="b8788-263">The Web Forms sample application automatically redirects mobile users to a set of mobile-specific pages in a subfolder called Mobile.</span></span> <span data-ttu-id="b8788-264">Разметка и стили этих страниц лучше оптимизирован для браузеры для мобильных устройств, как видно из следующей снимки экрана:</span><span class="sxs-lookup"><span data-stu-id="b8788-264">The markup and styling of those pages is better optimized for mobile browsers, as you can see from the following screenshots:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image2.png)

<span data-ttu-id="b8788-265">Дополнительные советы по оптимизации разметки и CSS для браузеры для мобильных устройств в разделе «Стилизация мобильных страниц для мобильных браузеров» далее в этом документе.</span><span class="sxs-lookup"><span data-stu-id="b8788-265">For more tips about optimizing your markup and CSS for mobile browsers, see the section "Styling mobile pages for mobile browsers" later in this document.</span></span>

## <a name="how-aspnet-mvc-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="b8788-266">Как представляют страницы конкретных мобильных приложений ASP.NET MVC</span><span class="sxs-lookup"><span data-stu-id="b8788-266">How ASP.NET MVC applications can present mobile-specific pages</span></span>

<span data-ttu-id="b8788-267">Так как шаблон Model-View-Controller отделяет логику приложения (в контроллерах) от логики представления (в представлениях), можно выбрать любой из следующих подходов к обработке поддержка мобильных устройств в серверный код:</span><span class="sxs-lookup"><span data-stu-id="b8788-267">Since the Model-View-Controller pattern decouples application logic (in controllers) from presentation logic (in views), you can choose from any of the following approaches to handling mobile support in server-side code:</span></span>

1. <span data-ttu-id="b8788-268">***Использовать те же контроллеры и представления для браузеров настольных компьютеров и мобильных устройств, но отображать представления с разными макетами Razor, в зависимости от типа устройства *.**</span><span class="sxs-lookup"><span data-stu-id="b8788-268">***Use the same controllers and views for both desktop and mobile browsers, but render the views with different Razor layouts depending on the device type*.**</span></span> <span data-ttu-id="b8788-269">Этот параметр работает лучше, если будет отображаться одинаковые данные на всех устройствах, но хотите просто указать различные таблицы стилей CSS или изменить несколько элементов верхнего уровня HTML для мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="b8788-269">This option works best if you're displaying identical data on all devices, but simply want to supply different CSS stylesheets or change a few top-level HTML elements for mobiles.</span></span>
2. <span data-ttu-id="b8788-270">***Использовать же контроллеров для браузеров настольных компьютеров и мобильных устройств, но отображать различные представления в зависимости от типа устройства***.</span><span class="sxs-lookup"><span data-stu-id="b8788-270">***Use the same controllers for both desktop and mobile browsers, but render different views depending on the device type***.</span></span> <span data-ttu-id="b8788-271">Этот параметр работает лучше, если отображение примерно тех же данных, а также предоставлять же рабочие процессы для конечных пользователей, но хотите отображать совсем не разметку HTML, в соответствии с устройства, используемого.</span><span class="sxs-lookup"><span data-stu-id="b8788-271">This option works best if you're displaying roughly the same data and providing the same workflows for end users, but want to render very different HTML markup to suit the device being used.</span></span>
3. <span data-ttu-id="b8788-272">***Создать отдельные области для настольных компьютеров и мобильных браузеров, реализация независимых контроллеры и представления для каждого *.**</span><span class="sxs-lookup"><span data-stu-id="b8788-272">***Create separate areas for desktop and mobile browsers, implementing independent controllers and views for each*.**</span></span> <span data-ttu-id="b8788-273">Этот вариант лучше всего применять, если вы отображать совсем не экраны, содержащий различные сведения и начальные пользователя с помощью различных рабочих процессов, оптимизированными для их типа устройства.</span><span class="sxs-lookup"><span data-stu-id="b8788-273">This option works best if you're displaying very different screens, containing different information and leading the user through different workflows optimized for their device type.</span></span> <span data-ttu-id="b8788-274">Может означать некоторые повторения кода, но можно свести к минимуму, отделение общую логику в базовый уровень или службы.</span><span class="sxs-lookup"><span data-stu-id="b8788-274">It may mean some repetition of code, but you can minimize that by factoring out common logic into an underlying layer or service.</span></span>

<span data-ttu-id="b8788-275">Если вы захотите воспользоваться **первый** параметр и изменяемые Razor layout каждого типа устройства очень просто.</span><span class="sxs-lookup"><span data-stu-id="b8788-275">If you want to take the **first** option and vary only the Razor layout per device type, it's very easy.</span></span> <span data-ttu-id="b8788-276">Просто укажите ваш \_ViewStart.cshtml файл следующим образом:</span><span class="sxs-lookup"><span data-stu-id="b8788-276">Just modify your \_ViewStart.cshtml file as follows:</span></span>

[!code-cshtml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample7.cshtml)]

<span data-ttu-id="b8788-277">Теперь можно создавать макет конкретных мобильных \_LayoutMobile.cshtml со структурой страницы и CSS правила, оптимизированный для мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="b8788-277">Now you can create a mobile-specific layout called \_LayoutMobile.cshtml with a page structure and CSS rules optimized for mobile devices.</span></span>

<span data-ttu-id="b8788-278">Если вы захотите воспользоваться **второй** отрисовки совершенно разных представлений зависимости от типа устройства посетителя см. в разделе [Скотт Хансельман блога](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).</span><span class="sxs-lookup"><span data-stu-id="b8788-278">If you want to take the **second** option render totally different views according to the visitor's device type, see [Scott Hanselman's blog post](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).</span></span>

<span data-ttu-id="b8788-279">Остальная часть этого документа основное внимание уделяется **третий** вариант — создание отдельных контроллерах *и* представления для мобильных устройств —, поэтому можно управлять точно определить, какая часть функциональности предлагается для мобильных устройств посетителей.</span><span class="sxs-lookup"><span data-stu-id="b8788-279">The rest of this paper focuses on the **third** option – creating separate controllers *and* views for mobile devices – so you can control exactly what subset of functionality is offered for mobile visitors.</span></span>

### <a name="setting-up-a-mobile-area-within-your-aspnet-mvc-application"></a><span data-ttu-id="b8788-280">Настройка мобильных области в приложении ASP.NET MVC</span><span class="sxs-lookup"><span data-stu-id="b8788-280">Setting up a Mobile area within your ASP.NET MVC application</span></span>

<span data-ttu-id="b8788-281">Можно добавить, называемое «Мобильный» для существующего приложения ASP.NET MVC обычным способом: щелкните правой кнопкой мыши имя проекта в обозревателе решений, а затем выберите Добавить à области.</span><span class="sxs-lookup"><span data-stu-id="b8788-281">You can add an area called "Mobile" to an existing ASP.NET MVC application in the normal way: right-click on your project name in Solution Explorer, then choose Add à Area.</span></span> <span data-ttu-id="b8788-282">Затем можно добавить контроллеры и представления, как для другой области в приложении ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="b8788-282">You can then add controllers and views as you would for any other area within an ASP.NET MVC application.</span></span> <span data-ttu-id="b8788-283">Например добавьте область мобильных новый контроллер вызывается HomeController в качестве домашней страницы для мобильных устройств посетителей.</span><span class="sxs-lookup"><span data-stu-id="b8788-283">For example, add to your Mobile area a new controller called HomeController to act as a homepage for mobile visitors.</span></span>

### <a name="ensuring-the-url-mobile-reaches-the-mobile-homepage"></a><span data-ttu-id="b8788-284">Обеспечение /Mobile URL-адрес достигает мобильных домашней страницы</span><span class="sxs-lookup"><span data-stu-id="b8788-284">Ensuring the URL /Mobile reaches the mobile homepage</span></span>

<span data-ttu-id="b8788-285">Если вы хотите /Mobile URL-адрес для достижения действие индекса на HomeController в вашем регионе мобильных устройств, необходимо будет внести два небольшие изменения в конфигурацию маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="b8788-285">If you want the URL /Mobile to reach the Index action on HomeController inside your Mobile area, you will need to make two small changes to your routing configuration.</span></span> <span data-ttu-id="b8788-286">Во-первых обновите ваш класс MobileAreaRegistration, чтобы HomeController контроллера по умолчанию в вашем регионе мобильных устройств, как показано в следующем коде:</span><span class="sxs-lookup"><span data-stu-id="b8788-286">First, update your MobileAreaRegistration class so that HomeController is the default controller in your Mobile area, as shown in the following code:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample8.cs)]

<span data-ttu-id="b8788-287">Это означает мобильных Главная страница теперь будет будут находиться в /Mobile, а не/Mobile домашние, так как «Home» теперь неявно имя по умолчанию контроллер для мобильных страниц.</span><span class="sxs-lookup"><span data-stu-id="b8788-287">This means the mobile homepage will now be located at /Mobile, rather than /Mobile/Home, because "Home" is now the implicitly default controller name for mobile pages.</span></span>

<span data-ttu-id="b8788-288">Далее Обратите внимание, добавляя второй HomeController в приложении (т. е. мобильных той, в дополнение к существующей один рабочий стол), то будет необходимо разорвать регулярных рабочих столов Главная страница.</span><span class="sxs-lookup"><span data-stu-id="b8788-288">Next, note that by adding a second HomeController to your application (i.e., the mobile one, in addition to the existing desktop one), you'll have broken your regular desktop homepage.</span></span> <span data-ttu-id="b8788-289">Она завершится с ошибкой «*, удовлетворяющие контроллера, с именем «Home» были найдены несколько типов*».</span><span class="sxs-lookup"><span data-stu-id="b8788-289">It will fail with the error "*Multiple types were found that match the controller named 'Home'*".</span></span> <span data-ttu-id="b8788-290">Чтобы устранить эту проблему, обновите верхнего уровня конфигурации маршрутизации (в Global.asax.cs) для указания, что ваш HomeController рабочего стола следует имеют более высокий приоритет при наличии неоднозначности:</span><span class="sxs-lookup"><span data-stu-id="b8788-290">To resolve this, update your top-level routing configuration (in Global.asax.cs) to specify that your desktop HomeController should take priority when there's ambiguity:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample9.cs)]

<span data-ttu-id="b8788-291">Теперь будет отправлена ошибки размещения и URL-адрес http://<em>данный сайт</em>/ достигнет рабочего стола домашней страницы и http://<em>данный сайт</em>/mobile/ достигнет мобильных домашней страницы.</span><span class="sxs-lookup"><span data-stu-id="b8788-291">Now the error will go away, and the URL http://<em>yoursite</em>/ will reach the desktop homepage, and http://<em>yoursite</em>/mobile/ will reach the mobile homepage.</span></span>

### <a name="redirecting-mobile-visitors-to-your-mobile-area"></a><span data-ttu-id="b8788-292">Перенаправление мобильных посетителям местный мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="b8788-292">Redirecting mobile visitors to your mobile area</span></span>

<span data-ttu-id="b8788-293">Имеется много разных расширяемости точек в ASP.NET MVC, поэтому существует множество возможных способов для добавления логики перенаправления.</span><span class="sxs-lookup"><span data-stu-id="b8788-293">There are many different extensibility points in ASP.NET MVC, so there are many possible ways to inject redirection logic.</span></span> <span data-ttu-id="b8788-294">Аккуратно один из вариантов является создание атрибут фильтра, [RedirectMobileDevicesToMobileArea], который выполняет перенаправление, если выполняются следующие условия:</span><span class="sxs-lookup"><span data-stu-id="b8788-294">One neat option is to create a filter attribute, [RedirectMobileDevicesToMobileArea], that performs a redirection if the following conditions are met:</span></span>

1. <span data-ttu-id="b8788-295">Это первый запрос в сеансе пользователя (т. е. Session.IsNewSession имеет значение true)</span><span class="sxs-lookup"><span data-stu-id="b8788-295">It's the first request in the user's session (i.e., Session.IsNewSession equals true)</span></span>
2. <span data-ttu-id="b8788-296">Запрос поступает от мобильных браузеров (т. е. Request.Browser.IsMobileDevice имеет значение true)</span><span class="sxs-lookup"><span data-stu-id="b8788-296">The request comes from a mobile browser (i.e., Request.Browser.IsMobileDevice equals true)</span></span>
3. <span data-ttu-id="b8788-297">Пользователь уже не запрашивает ресурс в области мобильных устройств (т. е. *путь* в URL-адрес не начинается с /Mobile)</span><span class="sxs-lookup"><span data-stu-id="b8788-297">The user is not already requesting a resource in the mobile area (i.e., the *path* part of the URL does not begin with /Mobile)</span></span>

<span data-ttu-id="b8788-298">Загружаемый пример, включенных в этот документ включает в себя реализацию этой логики.</span><span class="sxs-lookup"><span data-stu-id="b8788-298">The downloadable sample included with this white paper includes an implementation of this logic.</span></span> <span data-ttu-id="b8788-299">Он реализован в виде фильтра авторизации, производный от AuthorizeAttribute, это означает, что он может работать неправильно даже при использовании кэширования выходных данных (в противном случае, если рабочего стола посетитель первый обращается к определенным URL-адрес, выходные данные рабочего стола может кэшировать и затем передается в последующие мобильных посетители).</span><span class="sxs-lookup"><span data-stu-id="b8788-299">It's implemented as an authorization filter, derived from AuthorizeAttribute, which means it can work correctly even if you are using output caching (otherwise, if a desktop visitor first accesses a certain URL, the desktop output might be cached and then served to subsequent mobile visitors).</span></span>

<span data-ttu-id="b8788-300">Как фильтр, можно выбрать версию для применения определенных контроллеров и действий, например,</span><span class="sxs-lookup"><span data-stu-id="b8788-300">As it's a filter, you can choose either to apply it to specific controllers and actions, e.g.,</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample10.cs)]

<span data-ttu-id="b8788-301">…</span><span class="sxs-lookup"><span data-stu-id="b8788-301">…</span></span> <span data-ttu-id="b8788-302">или его можно применить ко всем контроллерам и действия в MVC 3 *глобального фильтра* в файле Global.asax.cs:</span><span class="sxs-lookup"><span data-stu-id="b8788-302">or you can apply it to all controllers and actions as an MVC 3 *global filter* in your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample11.cs)]

<span data-ttu-id="b8788-303">Загружаемый пример также демонстрирует, как создавать подклассы этого атрибута, перенаправление на конкретные места в вашем регионе мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="b8788-303">The downloadable sample also demonstrates how you can create subclasses of this attribute that redirect to specific locations within your mobile area.</span></span> <span data-ttu-id="b8788-304">Это означает, например, вы можете:</span><span class="sxs-lookup"><span data-stu-id="b8788-304">This means, for example, you can:</span></span>

- <span data-ttu-id="b8788-305">Зарегистрируйте глобальный фильтр как показано выше, отправляет мобильных посетителей мобильных домашнюю страницу по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="b8788-305">Register a global filter as shown above that sends mobile visitors to the mobile homepage by default.</span></span>
- <span data-ttu-id="b8788-306">Также можно примените специальные фильтр [RedirectMobileDevicesToMobileProductPage] для действия «представление продукт», принимающий мобильных посетителям мобильной версии продукта страница запрошенных ими.</span><span class="sxs-lookup"><span data-stu-id="b8788-306">Also apply a special [RedirectMobileDevicesToMobileProductPage] filter to a "view product" action that takes mobile visitors to the mobile version of whatever product page they had requested.</span></span>
- <span data-ttu-id="b8788-307">Также применяются другие специальные подклассов фильтра на выполнение определенных действий, перенаправление мобильных посетителям эквивалентные странице для мобильных устройств</span><span class="sxs-lookup"><span data-stu-id="b8788-307">Also apply other special subclasses of the filter to specific actions, redirecting mobile visitors to the equivalent mobile page</span></span>

### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="b8788-308">Настройка проверки подлинности форм с соблюдением мобильных веб-страниц</span><span class="sxs-lookup"><span data-stu-id="b8788-308">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="b8788-309">При использовании проверки подлинности форм следует отметить, что когда пользователю требуется войти, он автоматически перенаправляет пользователя один определенный «вход в» URL-адрес, который по умолчанию является **/Account/входа**.</span><span class="sxs-lookup"><span data-stu-id="b8788-309">If you're using Forms Authentication, you should note that when a user needs to log in, it automatically redirects the user to a single specific "log on" URL, which by default is **/Account/LogOn**.</span></span> <span data-ttu-id="b8788-310">Это означает, что мобильных пользователей может быть перенаправлен на действие рабочего стола «вход».</span><span class="sxs-lookup"><span data-stu-id="b8788-310">This means that mobile users may be redirected to your desktop "log on" action.</span></span>

<span data-ttu-id="b8788-311">Чтобы избежать этой проблемы, добавьте логику рабочего стола действие «вход», чтобы он перенаправляет мобильных пользователей снова мобильных действие «вход».</span><span class="sxs-lookup"><span data-stu-id="b8788-311">To avoid this problem, add logic to your desktop "log on" action so that it redirects mobile users again to a mobile "log on" action.</span></span> <span data-ttu-id="b8788-312">Если вы используете шаблон приложения ASP.NET MVC по умолчанию, обновите действия входа в систему AccountController следующим образом:</span><span class="sxs-lookup"><span data-stu-id="b8788-312">If you're using the default ASP.NET MVC application template, update AccountController's LogOn action as follows:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample12.cs)]

<span data-ttu-id="b8788-313">…</span><span class="sxs-lookup"><span data-stu-id="b8788-313">…</span></span> <span data-ttu-id="b8788-314">и реализация конкретных mobile «вход» меры на контроллер, называемый AccountController в вашем регионе мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="b8788-314">and then implement a suitable mobile-specific "log on" action on a controller called AccountController in your Mobile area.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="b8788-315">Работа с кэширования выходных данных</span><span class="sxs-lookup"><span data-stu-id="b8788-315">Working with Output Caching</span></span>

<span data-ttu-id="b8788-316">Если вы используете фильтр [OutputCache], необходимо принудительно элемент кэша, зависят от типа устройства.</span><span class="sxs-lookup"><span data-stu-id="b8788-316">If you're using the [OutputCache] filter, you must force the cache entry to vary by device type.</span></span> <span data-ttu-id="b8788-317">Например записи:</span><span class="sxs-lookup"><span data-stu-id="b8788-317">For example, write:</span></span>

[!code-javascript[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample13.js)]

<span data-ttu-id="b8788-318">Добавьте следующий метод в файл Global.asax.cs:</span><span class="sxs-lookup"><span data-stu-id="b8788-318">Then, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample14.cs)]

<span data-ttu-id="b8788-319">Это позволит гарантировать, что мобильных посетителями не получать выходные данные, ранее поместить в кэш рабочих столов посетителем.</span><span class="sxs-lookup"><span data-stu-id="b8788-319">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="b8788-320">Рабочий пример</span><span class="sxs-lookup"><span data-stu-id="b8788-320">A working example</span></span>

<span data-ttu-id="b8788-321">Для просмотра этих методов в действии, загрузите [образцы связанного кода в этом техническом документе](https://docs.microsoft.com/aspnet/mobile/overview).</span><span class="sxs-lookup"><span data-stu-id="b8788-321">To see these techniques in action, download [this white paper's code associated samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="b8788-322">Образец включает усовершенствована для поддержки мобильных устройств с помощью описанных выше методов приложения ASP.NET MVC 3 (версия-кандидат).</span><span class="sxs-lookup"><span data-stu-id="b8788-322">The sample includes an ASP.NET MVC 3 (Release Candidate) application enhanced to support mobile devices using the methods described above.</span></span>

## <a name="further-guidance-and-suggestions"></a><span data-ttu-id="b8788-323">Дополнительные советы и рекомендации</span><span class="sxs-lookup"><span data-stu-id="b8788-323">Further guidance and suggestions</span></span>

<span data-ttu-id="b8788-324">Следующее обсуждение применяется к веб-форм и MVC разработчикам, использующим технологии, описанные в этом документе.</span><span class="sxs-lookup"><span data-stu-id="b8788-324">The following discussion applies both to Web Forms and MVC developers who are using the techniques covered in this document.</span></span>

### <a name="enhancing-your-redirection-logic-using-51degreesmobi-foundation"></a><span data-ttu-id="b8788-325">Улучшение логику перенаправления, с помощью 51Degrees.mobi Foundation</span><span class="sxs-lookup"><span data-stu-id="b8788-325">Enhancing your redirection logic using 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="b8788-326">Логике перенаправления, показанные в данном документе может быть вполне достаточно для вашего приложения, но не будет работать, если вам нужно отключить сеансы, или с помощью мобильных браузеров, которые отклонить файлов cookie (они не могут иметь сеансов), так как он не знает ли данного запроса является Первый из этого посетителя.</span><span class="sxs-lookup"><span data-stu-id="b8788-326">The redirection logic shown in this document may be perfectly sufficient for your application, but it won't work if you need to disable sessions, or with mobile browsers that reject cookies (these can't have sessions), because it won't know whether a given request is the first one from that visitor.</span></span>

<span data-ttu-id="b8788-327">Вы уже узнали, как открыть источник 51Degrees.mobi Foundation можно улучшить точность ASP. Определение элемента NET обозревателя.</span><span class="sxs-lookup"><span data-stu-id="b8788-327">You already learned how the open source 51Degrees.mobi Foundation can improve the accuracy of ASP.NET's browser detection.</span></span> <span data-ttu-id="b8788-328">Имеется также встроенная возможность перенаправления мобильных посетителей определенные расположения, настроенные в файле Web.config. Он может работать без в зависимости от сеансов ASP.NET (и, следовательно куки-файлы) путем сохранения временного журнала хэшей посетителей заголовки HTTP и IP-адресов, таким образом он знает ли каждый запрос считается первый из данного vistor.</span><span class="sxs-lookup"><span data-stu-id="b8788-328">It also has a built-in ability to redirect mobile visitors to specific locations configured in Web.config. It's able to work without depending on ASP.NET Sessions (and hence cookies) by storing a temporary log of hashes of visitors' HTTP headers and IP addresses, so it knows whether or not each request is the first one from a given vistor.</span></span>

<span data-ttu-id="b8788-329">Следующий элемент, добавляемый в fiftyOne раздел файла web.config будет перенаправлять первый запрос с мобильных устройств, обнаруженных на страницу ~ / Mobile/Default.aspx.</span><span class="sxs-lookup"><span data-stu-id="b8788-329">The following element added to the fiftyOne section of the web.config file will redirect the first request from a detected mobile device to the page ~/Mobile/Default.aspx.</span></span> <span data-ttu-id="b8788-330">Все запросы на страницы в папке мобильных устройств будут *не* перенаправляться независимо от типа устройства.</span><span class="sxs-lookup"><span data-stu-id="b8788-330">Any requests to pages under the Mobile folder will *not* be redirected, regardless of device type.</span></span> <span data-ttu-id="b8788-331">Если мобильное устройство не было активности в течение 20 минут или больше устройств будет забыт и последующие запросы будут считаться новые в целях перенаправления.</span><span class="sxs-lookup"><span data-stu-id="b8788-331">If the mobile device has been inactive for a period of 20 minutes or more the device will be forgotten and subsequent requests will be treated as new ones for the purposes of redirection.</span></span>

[!code-xml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample15.xml)]

<span data-ttu-id="b8788-332">Дополнительные сведения см. в разделе [51degrees.mobi Foundation документации](https://github.com/51Degrees/dotNET-Device-Detection).</span><span class="sxs-lookup"><span data-stu-id="b8788-332">For more details, see [51degrees.mobi Foundation documentation](https://github.com/51Degrees/dotNET-Device-Detection).</span></span>

> [!NOTE]
> <span data-ttu-id="b8788-333">Вы *можно* 51Degrees.mobi Foundation использования функции перенаправления в MVC-приложениях ASP.NET, но будет необходимо определить конфигурацию перенаправление с точки зрения обычный URL-адреса, не в терминах параметров маршрутизации или путем помещения фильтров MVC в операциях.</span><span class="sxs-lookup"><span data-stu-id="b8788-333">You *can* use 51Degrees.mobi Foundation's redirection feature on ASP.NET MVC applications, but you will need to define your redirection configuration in terms of plain URLs, not in terms of routing parameters or by putting MVC filters on actions.</span></span> <span data-ttu-id="b8788-334">Это обусловлено (на момент написания статьи) 51Degrees.mobi Foundation не распознает фильтры или маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="b8788-334">This is because (at the time of writing) 51Degrees.mobi Foundation does not recognize filters or routing.</span></span>


### <a name="disabling-transcoders-and-proxy-servers"></a><span data-ttu-id="b8788-335">Отключение Транскодеры и прокси-серверы</span><span class="sxs-lookup"><span data-stu-id="b8788-335">Disabling Transcoders and Proxy Servers</span></span>

<span data-ttu-id="b8788-336">Операторы мобильной сети имеют две широкие цели в их подход к Интернету мобильных устройств:</span><span class="sxs-lookup"><span data-stu-id="b8788-336">Mobile network operators have two broad objectives in their approach to the mobile internet:</span></span>

1. <span data-ttu-id="b8788-337">Предоставить в качестве гораздо соответствующего содержимого, насколько это возможно</span><span class="sxs-lookup"><span data-stu-id="b8788-337">Provide as much relevant content as possible</span></span>
2. <span data-ttu-id="b8788-338">Максимально увеличить количество клиентов, которые могут совместно использовать пропускную способность сети только переключатель</span><span class="sxs-lookup"><span data-stu-id="b8788-338">Maximize the number of customers who can share the limited radio network bandwidth</span></span>

<span data-ttu-id="b8788-339">Поскольку большинство веб-страниц, разработанные для больших экранов размера рабочего стола и быстро фиксированной строки широкополосное подключение, использовать многие операторы *транскодеры* или *прокси-серверы* , динамическое изменение веб-содержимого.</span><span class="sxs-lookup"><span data-stu-id="b8788-339">Since most web pages were designed for large desktop-sized screens and fast fixed-line broadband connections, many operators use *transcoders* or *proxy servers* that dynamically alter web content.</span></span> <span data-ttu-id="b8788-340">Они могут изменять разметку HTML или CSS в соответствии с экране меньшего размера (особенно в случае «компонент телефоны» которых не хватает вычислительной мощности для обработки сложных макетов), и они могут повторное сжатие изображений (значительно снижает качество) для повышения скорости доставки страницы.</span><span class="sxs-lookup"><span data-stu-id="b8788-340">They may modify your HTML markup or CSS to suit smaller screens (especially for "feature phones" that lack the processing power to handle complex layouts), and they may recompress your images (significantly reducing their quality) to improve page delivery speeds.</span></span>

<span data-ttu-id="b8788-341">Но если вы прошли усилия, чтобы создать версию веб-узла, оптимизированные для мобильных устройств, возможно, необходимо исключить из сетевого оператора, взаимодействовать с ним любой дальнейшей.</span><span class="sxs-lookup"><span data-stu-id="b8788-341">But if you've taken the effort to produce a mobile-optimized version of your site, you probably don't want the network operator to interfere with it any further.</span></span> <span data-ttu-id="b8788-342">Можно добавить следующие строки на страницу\_событие загрузки в любой веб-формы ASP.NET:</span><span class="sxs-lookup"><span data-stu-id="b8788-342">You can add the following line to the Page\_Load event in any ASP.NET Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample16.cs)]

<span data-ttu-id="b8788-343">Или для контроллера ASP.NET MVC, можно добавить следующие переопределяющий метод, чтобы он применяется ко всем действиям на этом контроллере.</span><span class="sxs-lookup"><span data-stu-id="b8788-343">Or, for an ASP.NET MVC controller, you could add the following method override so that it applies to all actions on that controller:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample17.cs)]

<span data-ttu-id="b8788-344">Полученное в результате сообщение HTTP информирует совместимые — в формате W3C и прокси-серверы не для изменения содержимого.</span><span class="sxs-lookup"><span data-stu-id="b8788-344">The resulting HTTP message informs W3C compliant transcoders and proxies not to alter content.</span></span> <span data-ttu-id="b8788-345">Разумеется нет никакой гарантии, что операторы мобильной сети будут использовать это сообщение.</span><span class="sxs-lookup"><span data-stu-id="b8788-345">Of course, there is no guarantee that mobile network operators will respect this message.</span></span>

### <a name="styling-mobile-pages-for-mobile-browsers"></a><span data-ttu-id="b8788-346">Задание стиля страницах для мобильных устройств для мобильных браузеров</span><span class="sxs-lookup"><span data-stu-id="b8788-346">Styling mobile pages for mobile browsers</span></span>

<span data-ttu-id="b8788-347">Он выходит за рамки данного документа описываются подробно какие виды работ разметки HTML правильно или какие способы разработки веб повышения удобства использования на конкретных устройств.</span><span class="sxs-lookup"><span data-stu-id="b8788-347">It's beyond the scope of this document to describe in great detail what kinds of HTML markup work correctly or which web design techniques maximize usability on particular devices.</span></span> <span data-ttu-id="b8788-348">Он содержит вверх для поиска достаточно простой макет, оптимизированные для мобильных размера экрана, без использования ненадежных HTML или рекомендации позиционирования CSS.</span><span class="sxs-lookup"><span data-stu-id="b8788-348">It's up to you to find a sufficiently simple layout, optimized for a mobile-sized screen, without using unreliable HTML or CSS positioning tricks.</span></span> <span data-ttu-id="b8788-349">Одним из способов важно отметить, однако является *просмотра метатег*.</span><span class="sxs-lookup"><span data-stu-id="b8788-349">One important technique worth mentioning, however, is the *viewport meta tag*.</span></span>

<span data-ttu-id="b8788-350">Некоторые современные браузеры для мобильных устройств, на веб-страницах усилий отображения предназначен для настольных компьютеров мониторов визуализации страницы на виртуальный холст, также называется «окно просмотра» (например, виртуального окна просмотра является 980 пикселей в ширину на iPhone и 850 пикселов на Opera Mobile по умолчанию) и затем Масштабируйте результат для размещения на физических пикселей на экране.</span><span class="sxs-lookup"><span data-stu-id="b8788-350">Certain modern mobile browsers, in an effort display web pages meant for desktop monitors, render the page on a virtual canvas, also called "viewport" (e.g., the virtual viewport is 980 pixels wide on iPhone, and 850 pixels wide on Opera Mobile by default) and then scale the result down to fit onto the screen's physical pixels.</span></span> <span data-ttu-id="b8788-351">Пользователь может затем увеличить масштаб и панорамирования, окна просмотра.</span><span class="sxs-lookup"><span data-stu-id="b8788-351">The user can then zoom in and pan around that viewport.</span></span> <span data-ttu-id="b8788-352">Это имеет то преимущество, что он позволяет браузер отображения страницы в его предполагаемого макета, но также имеет недостаток заставляет масштабирования и панорамирования, который является неудобным для пользователя.</span><span class="sxs-lookup"><span data-stu-id="b8788-352">This has the advantage that it lets the browser display the page in its intended layout, but it's also has the disadvantage that it forces zooming and panning, which is inconvenient for the user.</span></span> <span data-ttu-id="b8788-353">При разработке для мобильных устройств, лучше конструктора для обычных экрана, чтобы увеличение масштаба или горизонтальной полосы прокрутки не требуется.</span><span class="sxs-lookup"><span data-stu-id="b8788-353">If you're designing for mobile, it's better to design for a narrow screen so that no zooming or horizontal scrolling is necessary.</span></span>

<span data-ttu-id="b8788-354">Заставляет мобильных браузеров ширину окна просмотра должно быть – нестандартное *просмотра* мета-тег.</span><span class="sxs-lookup"><span data-stu-id="b8788-354">A way to tell the mobile browser how wide the viewport should be is through the nonstandard *viewport* meta tag.</span></span> <span data-ttu-id="b8788-355">Например, добавьте следующий раздел HEAD страницы,</span><span class="sxs-lookup"><span data-stu-id="b8788-355">For example, if you add the following to your page's HEAD section,</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample18.html)]

<span data-ttu-id="b8788-356">…</span><span class="sxs-lookup"><span data-stu-id="b8788-356">…</span></span> <span data-ttu-id="b8788-357">затем Поддержка браузеров смартфонов будет макет страницы на полотне виртуальные 480 пикселей.</span><span class="sxs-lookup"><span data-stu-id="b8788-357">then supporting smartphone browsers will lay out the page on a 480-pixel wide virtual canvas.</span></span> <span data-ttu-id="b8788-358">Это означает, что если ваш HTML-элементов определяет их ширина в процентах, процентные показатели будут интерпретироваться по отношению к этой ширины 480 пикселей, не по умолчанию ширины окна просмотра.</span><span class="sxs-lookup"><span data-stu-id="b8788-358">This means that if your HTML elements define their widths in percentage terms, the percentages will be interpreted with respect to this 480-pixel width, not the default viewport width.</span></span> <span data-ttu-id="b8788-359">В результате пользователь скорее всего, придется изменение масштаба и сдвиг по горизонтали — значительно повышая мобильных устройств.</span><span class="sxs-lookup"><span data-stu-id="b8788-359">As a result, the user is less likely to have to zoom and pan horizontally – considerably improving the mobile browsing experience.</span></span>

<span data-ttu-id="b8788-360">Если вы хотите ширины окна просмотра для сопоставления точек физического устройства, можно указать:</span><span class="sxs-lookup"><span data-stu-id="b8788-360">If you want the viewport width to match the device's physical pixels, you can specify the following:</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample19.html)]

<span data-ttu-id="b8788-361">Чтобы это работало правильно, не должен явным образом принудительное элементов превышает эту ширину (например, с помощью *ширина* атрибут или свойство CSS), в противном случае браузер должен будет использовать больше просмотра независимо от того.</span><span class="sxs-lookup"><span data-stu-id="b8788-361">For this to work correctly, you must not explicitly force elements to exceed that width (e.g., using a *width* attribute or CSS property), otherwise the browser will be forced to use a larger viewport regardless.</span></span> <span data-ttu-id="b8788-362">См. также: [Дополнительные сведения о теге нестандартное просмотра](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).</span><span class="sxs-lookup"><span data-stu-id="b8788-362">See also: [more details about the nonstandard viewport tag](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).</span></span>

<span data-ttu-id="b8788-363">Поддерживает большинство современных смартфонов *двумя ориентации*: они могут храниться в книжном или альбомном режиме.</span><span class="sxs-lookup"><span data-stu-id="b8788-363">Most modern smartphones support *dual orientation*: they can be held in either portrait or landscape mode.</span></span> <span data-ttu-id="b8788-364">Таким образом важно не делайте никаких предположений о ширину экрана в пикселях.</span><span class="sxs-lookup"><span data-stu-id="b8788-364">So, it's important not to make assumptions about the screen width in pixels.</span></span> <span data-ttu-id="b8788-365">Не даже предполагается, что фиксирована ширины экрана, так как пользователь повторно можно разобраться своего устройства, когда они находятся на странице.</span><span class="sxs-lookup"><span data-stu-id="b8788-365">Don't even assume that the screen width is fixed, because the user can re-orient their device while they are on your page.</span></span>

<span data-ttu-id="b8788-366">Старые устройства Windows Mobile и Blackberry также может принимать следующие мета-теги в заголовке страницы, сообщите ему содержимого был оптимизирован для мобильных устройств и поэтому не должны преобразовываться.</span><span class="sxs-lookup"><span data-stu-id="b8788-366">Older Windows Mobile and Blackberry devices may also accept the following meta tags in the page header to inform them content has been optimized for mobile and therefore should not be transformed.</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample20.html)]

## <a name="additional-resources"></a><span data-ttu-id="b8788-367">Дополнительные ресурсы</span><span class="sxs-lookup"><span data-stu-id="b8788-367">Additional Resources</span></span>

<span data-ttu-id="b8788-368">Список мобильных устройств эмуляторы и симуляторы, можно использовать для тестирования веб-приложения ASP.NET мобильных устройств, см. на странице [имитировать популярных мобильных устройств для тестирования](../mobile/device-simulators.md).</span><span class="sxs-lookup"><span data-stu-id="b8788-368">For a list of mobile device emulators and simulators you can use to test your mobile ASP.NET web application, see the page [Simulate popular mobile devices for testing](../mobile/device-simulators.md).</span></span>

## <a name="credits"></a><span data-ttu-id="b8788-369">Благодарности</span><span class="sxs-lookup"><span data-stu-id="b8788-369">Credits</span></span>

- <span data-ttu-id="b8788-370">Основного автора: Андрей Сандерсон</span><span class="sxs-lookup"><span data-stu-id="b8788-370">Primary author: Steven Sanderson</span></span>
- <span data-ttu-id="b8788-371">Рецензенты / дополнительных модулей записи содержимого: Джеймс Rosewell, Майкл Söderström, Скотт Хансельман, Scott Хантер</span><span class="sxs-lookup"><span data-stu-id="b8788-371">Reviewers / additional content writers: James Rosewell, Mikael Söderström, Scott Hanselman, Scott Hunter</span></span>
