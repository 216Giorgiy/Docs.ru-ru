---
uid: whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
title: "Практическое руководство: Добавление мобильных страниц на ваш веб-форм ASP.NET или MVC-приложений | Документы Microsoft"
author: rick-anderson
description: "Это Практическое различные способы обслуживания страниц, оптимизированный для мобильных устройств из вашего веб-форм ASP.NET или MVC-приложения и предлагает архитектуры и..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/20/2011
ms.topic: article
ms.assetid: 3124f28e-cc32-418a-afe3-519fa56f4c36
ms.technology: 
ms.prod: .net-framework
msc.legacyurl: /whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
msc.type: content
ms.openlocfilehash: c7d893fb9633aaa8628f2f46a8db7f2c09f81830
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="how-to-add-mobile-pages-to-your-aspnet-web-forms--mvc-application"></a>Практическое руководство: Добавление мобильных страниц на ваш веб-форм ASP.NET и MVC-приложения
====================
> **Применяется к**
> 
> - Веб-форм ASP.NET версии 4.0
> - ASP.NET MVC версии 3.0
> 
> **Сводка**
> 
> Данном разделе описывается различные способы для обслуживания страниц, оптимизированный для мобильных устройств из вашего веб-форм ASP.NET и MVC-приложении и предлагает архитектуры и проектирования проблемы, которые следует учитывать при разработке для широкого спектра устройств. В этом документе также объясняется, почему ASP.NET мобильных элементов управления ASP.NET 2.0 до 3.5 устарели и описываются некоторые современные альтернативы.


## <a name="contents"></a>Описание

- Обзор
- Параметры архитектуры
- Обнаружение браузеров и устройств
- Как приложения веб-форм ASP.NET могут обеспечивать страницы конкретных мобильных устройств
- Как представляют страницы конкретных мобильных приложений ASP.NET MVC
- Дополнительные ресурсы

Загружаемые примеры кода демонстрации в этом техническом документе методы для веб-форм ASP.NET и MVC, в разделе [мобильных приложений и узлов с использованием ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview).

## <a name="overview"></a>Обзор

Мобильных устройств — смартфоны, функция телефоны и планшетные ПК — продолжить рост популярности как способ доступа к веб-сайте. Для многих веб-разработчиков и веб ориентированном бизнеса это означает, что более важно указывать прекрасные возможности для обзора для посетителей, которые используют эти устройства.

### <a name="how-earlier-versions-of-aspnet-supported-mobile-browsers"></a>Как в более ранних версиях ASP.NET поддерживаемые браузеры для мобильных устройств

ASP.NET версии 2.0 до версии 3.5 включены *элементы управления ASP.NET для мобильных устройств*: набор серверных элементов управления для мобильных устройств в *System.Web.Mobile.dll* сборки и  *System.Web.UI.MobileControls* пространства имен. Сборки по-прежнему присутствует в ASP.NET 4, но она устарела. Разработчикам рекомендуется перейти на более современные подходов, описанных в этом документе.

Причина, почему были помечены как устаревшие элементы управления ASP.NET для мобильных устройств ориентирована, их разработки вокруг мобильных телефонов, которые были распространены вокруг 2005 и более ранних версий. Элементы управления главным образом предназначены для отображения разметки WML или cHTML (вместо обычных HTML) для браузеров WAP, эры. Но WAP WML и cHTML которые больше не нужны для большинства проектов, так как HTML теперь стал язык широкого разметки для мобильных и настольных браузеров одинаково.

### <a name="the-challenges-of-supporting-mobile-devices-today"></a>Сложностей, связанных с поддержкой мобильных устройств сегодня

Хотя браузеры для мобильных устройств теперь поддерживают практически все HTML, можно будет по-прежнему сталкиваются с различными трудностями при обеспечить Создание качественной мобильных просмотра:

- ***Размер экрана*** - мобильных устройств значительно отличаться в форме, и экраны часто намного меньше, чем мониторами. Таким образом необходимо разработать совершенно разные макеты для них.
- ***Методы ввода*** — некоторые устройства имеют клавиатурами, некоторые из них имеют styluses, другим пользователям использовать сенсорный ввод. Необходимо учитывать несколько переходов механизмов и методы ввода.
- ***Соответствие стандартам*** — Многие браузеры для мобильных устройств не поддерживают последние стандарты HTML, CSS и JavaScript.
- ***Пропускная способность*** — совершенно зависит производительность сети для передачи данных, а некоторые пользователи находятся в тарифы, плату, мегабайт.

Решения нет универсальными; приложение будет выглядеть и работать по-разному в зависимости от устройства, доступ к нему. В зависимости от того, какой уровень поддержки мобильных устройств требуется это может быть больше запроса для веб-разработчиков, чем когда-либо было рабочего стола «обозревателя документы».

Разработчики часто изначально приближается поддержка мобильных браузеров в первый раз считаете, что очень важно только для поддержки смартфонов самую современную (например, Windows Phone 7 iPhone и Android), возможно, поскольку разработчики часто личные владеет таких устройства. Тем не менее дешевле телефоны по-прежнему являются весьма популярна, и владельцы должны использовать их в Интернете — особенно в странах, где мобильных телефонов для получения проще высокоскоростное подключение. Организации, необходимо решить, какой диапазон устройствах для поддержки, учитывая его вероятных заказчиков. При создании документации брошюр для spa работоспособности luxury, может стать деловое решение только для расширенного смартфоны, в то время как при создании билета система бронирования кинофильмов, возможно, нужно учитывать посетителей с менее мощная функция телефоны.

## <a name="architectural-options"></a>Параметры архитектуры

Прежде чем мы приступим к конкретных технических особенностей веб-форм ASP.NET или MVC, обратите внимание, что веб-разработчиков в целом три основных возможных варианта поддержка мобильных браузеров:

1. ***Не выполнять никаких действий —*** просто можно создавать стандартные, для рабочей среды веб-приложения и используют браузеры для мобильных устройств для воспроизведения приемлемой производительностью. 

    - **Преимущества**: дешевые вариант для реализации и обслуживания — никаких дополнительных работы
    - **Недостаток**: дает наихудшее взаимодействие с конечным пользователем: 

        - Последние смартфонов может отображаться HTML так же, как и браузер на компьютере, но пользователи по-прежнему обязательно для масштабирования и прокрутки по горизонтали и вертикали для использования содержимого, на небольшом экране. Это далеко от оптимальной.
        - Старые устройства и телефоны функции могут не отображаться разметке удовлетворительным образом.
        - Даже на последнюю планшетные устройства (экраны, может быть большим, чем экранах ноутбуков) применяются правила различные взаимодействия. Ввод на основе Touch лучше всего работает с размером кнопок и связывает разворота дальнейшей друг от друга и нет возможности для наведите курсор мыши на вспомогательное раскрывающееся меню.
2. ***Решить проблему на клиенте* —** с Аккуратное использование CSS и [прогрессивном расширении](http://en.wikipedia.org/wiki/Progressive_enhancement) можно создать разметку, стили и скрипты, адаптироваться к их работает независимо от браузера. Например, с помощью [медиа-запросами CSS 3](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/), можно создать многостолбцовый макет для включения устройств экраны, более узких, чем выбранные пороговые значения в одном столбце макет. 

    - **Преимущества**: оптимизация отрисовки для конкретного устройства используется, даже для неизвестных будущих устройств для любого экрана и характеристики входных они имеют
    - **Преимущества**: легко позволяет совместно использовать логику на стороне сервера на всех типах устройств — минимальный дублирования кода или трудозатрат
    - **Недостаток**: мобильные устройства, поэтому отличается от настольных компьютеров, которые действительно можно мобильных веб-страниц полностью отличались от классических страниц, с другой информацией. Такие варианты может оказаться неэффективным или невозможно надежно посредством CSS сама по себе, учитывая то, как и несогласованно старые устройства интерпретации правил CSS. Это особенно верно атрибутов CSS 3.
    - **Недостаток**: не поддерживает различные логику на стороне сервера и рабочие процессы для различных устройств. Например, нельзя реализовать упрощенную покупательской корзины для покупок извлечения рабочего процесса для мобильных пользователей с помощью CSS сама по себе.
    - **Недостаток**: неэффективным пропускной способности сети. Ваш сервер может потребоваться передачи разметки и стили, которые применяются для всех устройств, возможно, даже если на целевом устройстве будет использовать только подмножество этих данных.
3. ***Решить проблему на сервере* —** Если сервер знает, какое устройство имеет доступ к нему — или наименьших характеристики этого устройства, такие как размер экрана и метода ввода и будет ли это мобильное устройство, оно может работать другой логикой и выходные данные различных HTML-разметка. 

    - **Преимущество:** максимально гибкость. Не ограничено сколько различаются серверную логику для мобильных устройств или оптимизировать разметку для нужного макета конкретного устройства.
    - **Преимущество:** эффективный пропускной способности сети. Необходимо передавать разметки и сведения о стиле, которую планируется использовать целевое устройство.
    - **Недостаток:** иногда вызывает повторение трудозатрат или код (например, сделав создания копии похожие, но слегка различные страницы Web Forms или представлений MVC). Где возможно, вам необходимо учитывать out общую логику базового уровня или службы, но, тем не менее, некоторые части кода пользовательского интерфейса или разметки возможно дублирование и затем изменяются в параллельном режиме.
    - **Недостаток:** обнаружение устройств является непростой задачей. Он требует базы данных типов известным устройством и их характеристики (которые не всегда может быть полностью актуальные) и не обязательно точно соответствует каждого входящего запроса. В этом документе описываются некоторые параметры и их проблемы позже.

Чтобы получить наилучший результат, большинство разработчиков найти их нужно объединить параметры (2) и (3). Незначительные отличия стилистических лучше всего объединяются на клиентах, использующих CSS или даже JavaScript, тогда как наиболее эффективно существенные различия в данных, рабочий процесс или разметки реализованы в серверный код.

### <a name="this-paper-focuses-on-server-side-techniques"></a>Этот документ посвящен методы на стороне сервера

Поскольку веб-форм ASP.NET и MVC обеих технологий в основном сервере, в этом техническом документе основное внимание уделяется серверные методы, которые позволяют создавать различные разметки и логику для браузеры для мобильных устройств. Конечно это также можно объединять с любой клиентский метод (например, CSS 3 медиа-запросами, улучшение прогрессивный JavaScript), но это более нескольких веб-дизайн чем разработки ASP.NET.

## <a name="browser-and-device-detection"></a>Обнаружение браузеров и устройств

Является знать, какие устройства использует посетителем ключа необходимым условием для всех серверных механизмов для поддержки мобильных устройств. На самом деле, даже лучше узнать номер изготовителя и модель этого устройства требуется знать *характеристики* устройства. Характеристики могут включать:

- Это мобильное устройство?
- Метод ввода (клавиатуры и мыши, касания, клавиатуры, джойстик,...)
- Размер экрана (физически и в точках)
- Поддерживаемые форматы мультимедиа и данных
- И т. д.

Рекомендуется для принятия решений, на основе характеристик, чем номер модели, так как, а затем вы сможете более широкие возможности для обработки будущих устройствах.

### <a name="using-aspnets-built-in-browser-detection-support"></a>С помощью ASP. Поддержку обнаружения NET встроенного браузера

Веб-форм ASP.NET и MVC разработчики могут сразу обнаружить важные характеристики посещаемый обозреватель путем проверки свойств *Request.Browser* объекта. Например см.

- Request.Browser.IsMobileDevice
- Request.Browser.MobileDeviceManufacturer Request.Browser.MobileDeviceModel
- Request.Browser.ScreenPixelsWidth
- Request.Browser.SupportsXmlHttp
- .. и многие другие

В фоновом платформы ASP.NET соответствует входящего *User-Agent* заголовок HTTP (UA) от регулярных выражений в набор файлов XML определения браузера. По умолчанию платформа включает определения для многих распространенных мобильных устройств и для других пользователей, которые намечены для распознавания можно добавить пользовательские файлы описания браузера. Дополнительные сведения см. на странице MSDN [ASP.NET серверных элементов управления и возможности браузера](https://msdn.microsoft.com/en-us/library/x3k2ssx2.aspx).

### <a name="using-the-wurfl-device-database-via-51degreesmobi-foundation"></a>С помощью базы данных устройства WURFL через 51Degrees.mobi Foundation

Хотя ASP. Поддержку обнаружения NET встроенного браузера будет достаточно для многих приложений, существует два основных варианта при может быть недостаточно.

- ***Требуется распознавать последнюю устройства***(без создания файлов определения браузера для них вручную). Обратите внимание, что файлы определений браузера .NET 4 не недостаточно актуальной для распознавания Windows Phone 7, телефонов Android, Opera Mobile браузеры или устройств Apple iPad.
- ***Более подробные сведения о возможности устройства***. Необходимо знать о метода ввода устройства (например, сенсорный ввод vs на цифровой клавиатуре) или какие аудио форматов браузер поддерживает. Эти сведения недоступны в стандартных файлах определения браузера.

[ *Файл ресурсов с универсальными беспроводной* проекта (WURFL)](http://wurfl.sourceforge.net/) поддерживает намного больше актуальные и подробные сведения о мобильных устройствах используется сегодня.

Хорошая новость для разработчиков .NET-ASP. Возможность обнаружения NET браузера является расширяемой, поэтому можно расширить его возможности для решения этих проблем. Например, можно добавить открытый исходный код [ *51Degrees.mobi Foundation* ](https://github.com/51Degrees/dotNET-Device-Detection) библиотеки в проект. Он является ASP.NET IHttpModule или поставщики возможностей (может использоваться в приложениях веб-форм и MVC), который непосредственно считывает данные WURFL и подключит его в ASP. Механизм обнаружения NET встроенного браузера. После установки модуля, *Request.Browser* внезапно будет содержать гораздо более точными и подробные сведения: он правильно распознает многие из упомянутых выше устройств и их возможности (в том числе список Дополнительные возможности, например метода ввода). В документации проекта для получения дополнительных сведений.

## <a name="how-web-forms-applications-can-present-mobile-specific-pages"></a>Как приложений веб-форм может представлять страницы конкретных мобильных устройств

По умолчанию Вот способ отображения нового приложения Web Forms на общих мобильных устройств:

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image1.png)

Очевидно ни макета выглядит очень мобильной — Эта страница была разработана для больших и альбомной ориентацией монитора не для маленьком экране ориентированного книжной ориентации. Так что можно делать?

Как было описано ранее в этом документе, существует множество способов настройки страниц для мобильных устройств. Некоторые методы основаны на сервере, запустить другие пользователи на стороне клиента.

### <a name="creating-a-mobile-specific-master-page"></a>Создание мобильных обозревателей главной страницы

В зависимости от требований, можно использовать одного веб-форм для всех посетителей, но имеют два главных страниц разделения: один для настольных компьютеров посетителей, другой — для мобильных устройств посетителей. Это обеспечивает гибкость изменения таблицы стилей CSS или верхнего уровня в соответствии с мобильных устройств без перезагрузки для дублирования логики страницы разметки HTML.

Это легко сделать. Например веб-форму можно добавить обработчик PreInit примерно следующего вида:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample1.cs)]

Теперь создайте главную страницу вызывается Mobile.Master в папке верхнего уровня приложения и будет использоваться при обнаружении мобильного устройства. Вашей мобильной главной страницы может ссылаться таблица стилей CSS конкретных мобильных устройств, при необходимости. Посетители рабочего стола будет просматривать главную страницу по умолчанию, не соответствует мобильных устройств.

### <a name="creating-independent-mobile-specific-web-forms"></a>Создание независимых конкретных мобильных веб-форм

Для обеспечения максимальной гибкости вы можете перейти гораздо больше, чем только наличие отдельных главные страницы для разных типов устройств. Можно реализовать двумя *полностью разделения наборов страниц веб-форм* — один набор для браузеров настольных компьютеров, другой набор для мобильных устройств. Это работает лучше, если вы хотите предоставлять совершенно разные сведения или рабочих процессов для мобильных устройств посетителей. В оставшейся части этого раздела описывается этот подход подробно.

При условии, что у вас уже есть веб-форм, предназначенной для браузеров настольных компьютеров, чтобы продолжить проще создать вложенную папку с именем «Мобильный» в проекте и построения ваших мобильных страниц. Можно создавать всего дочерних сайтов с собственными главные страницы, таблицы стилей и страниц, используя те же методы, которые используются для других приложений веб-форм. Не обязательно создавать мобильные эквивалента для *каждого* страницы на сайте рабочего стола; вы можете определить, какая часть функциональности имеет смысл для мобильных устройств посетителей.

Мобильных веб-страниц могут совместно использовать общие статические ресурсы (такие как изображения, JavaScript и CSS файлы) с вашей обычных страниц, при необходимости. Так как в папке «Мобильный» будет *не* помечается как отдельное приложение при размещении в IIS (это только простой вложенной страницы веб-форм), он будет также совместно использовать те же конфигурации, данных сеанса и другой инфраструктурой, как ваш системной страницы.

> [!NOTE]
> Поскольку этот подход обычно включает некоторые дублирования кода (страницах для мобильных устройств, скорее всего, для совместного использования некоторые сходства с рабочего стола страниц), очень важно отделяют любого общих кода бизнес-логики и данных access в общий базовый уровень или службу. В противном случае вам потребуется выполнить double усилия на создание и обслуживание приложения.


#### <a name="redirecting-mobile-visitors-to-your-mobile-pages"></a>Перенаправление мобильных посетителям мобильных веб-страниц

Часто бывает удобно для перенаправления мобильных посетителям страницах для мобильных устройств только в случае *первый* запрос в их сеанса просмотра (но не на каждый запрос в свой сеанс), поскольку:

- Затем можно легко включить посетители мобильных устройств для доступа к страницам рабочего стола по желанию — просто добавить ссылку на главной странице, идущий «Версии рабочего стола». Посетитель не попасть на странице для мобильных устройств, так как это не первый запрос в свой сеанс.
- Она позволяет избежать риска конфликта с запросов любых динамических ресурсов совместно для настольных компьютеров и мобильных устройств частей узла (например, при наличии общих веб-формы, настольных компьютеров и мобильных устройств частей узла отображения IFRAME или в определенных обработчики Ajax)

Чтобы сделать это, можно разместить логику перенаправления в **сеанса\_запустить** метод. Например добавьте следующий метод в файл Global.asax.cs:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample2.cs)]

#### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a>Настройка проверки подлинности форм с соблюдением мобильных веб-страниц

Обратите внимание, что проверка подлинности форм делает определенные предположения о которых он может перенаправить посетителей, во время и после процесса проверки подлинности.

- Когда пользователь должен пройти проверку подлинности, проверки подлинности форм перенаправит их на страницу входа рабочего стола, независимо от ли они настольных компьютеров или мобильных пользователей (так как только он имеет смысл *один* URL-адрес входа). Предположим, что вы хотите по-разному в стиле страницы регистрации мобильных устройств, необходимо повысить страница входа рабочего стола, чтобы он перенаправляет мобильных пользователей на страницу входа отдельных мобильных устройств. Например, добавьте следующий код в вашей **рабочего стола** входа страница кода: 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample3.cs)]
- После успешного входа пользователя формы проверки подлинности по умолчанию перенаправит их на домашнюю страницу рабочего стола (так как только он имеет смысл *один* страница по умолчанию). Необходимо расширить страницы регистрации мобильных устройств, чтобы он перенаправляет на mobile домашнюю страницу после успешного входа в. Например, добавьте следующий код в вашей **мобильных** входа страница кода: 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample4.cs)]
  
 Данный код предполагает, что страницы имеется элемент управления сервера имя входа с именем LoginUser, как в шаблоне проекта по умолчанию.

### <a name="working-with-output-caching"></a>Работа с кэширования выходных данных

При использовании кэширования вывода, имейте в виду, что по умолчанию для рабочего стола пользователя посетить определенных URL-адрес (в результате чего выходных данных, чтобы кэшировать) возможна, за которым следует мобильных пользователей, которые затем получает кэшированным рабочего стола. Это предупреждение относится ли вы будете просто varying главную страницу по типу устройства или реализации совершенно другого веб-форм для каждого типа устройств.

Чтобы избежать проблемы, можно настроить ASP.NET для изменения записи кэша в соответствии с ли посетителя с помощью мобильного устройства. Добавьте параметр VaryByCustom объявление OutputCache на странице следующим образом.

[!code-aspx[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample5.aspx)]

Затем определите *isMobileDevice* как кэш пользовательского параметра, добавив следующий метод переопределения Global.asax.cs файл:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample6.cs)]

Это позволит гарантировать, что мобильных посетителями не получать выходные данные, ранее поместить в кэш рабочих столов посетителем.

### <a name="a-working-example"></a>Рабочий пример

Для просмотра этих методов в действии, загрузите [примеры кода в этом техническом документе](https://docs.microsoft.com/aspnet/mobile/overview). Образец приложения Web Forms автоматически перенаправляет набор страниц, относящихся к mobile во вложенной папке Mobile мобильных пользователей. Разметка и стили этих страниц лучше оптимизирован для браузеры для мобильных устройств, как видно из следующей снимки экрана:

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image2.png)

Дополнительные советы по оптимизации разметки и CSS для браузеры для мобильных устройств в разделе «Стилизация мобильных страниц для мобильных браузеров» далее в этом документе.

## <a name="how-aspnet-mvc-applications-can-present-mobile-specific-pages"></a>Как представляют страницы конкретных мобильных приложений ASP.NET MVC

Так как шаблон Model-View-Controller отделяет логику приложения (в контроллерах) от логики представления (в представлениях), можно выбрать любой из следующих подходов к обработке поддержка мобильных устройств в серверный код:

1. ***Использовать те же контроллеры и представления для браузеров настольных компьютеров и мобильных устройств, но отображать представления с разными макетами Razor, в зависимости от типа устройства*.** Этот параметр работает лучше, если будет отображаться одинаковые данные на всех устройствах, но хотите просто указать различные таблицы стилей CSS или изменить несколько элементов верхнего уровня HTML для мобильных устройств.
2. ***Использовать же контроллеров для браузеров настольных компьютеров и мобильных устройств, но отображать различные представления в зависимости от типа устройства***. Этот параметр работает лучше, если отображение примерно тех же данных, а также предоставлять же рабочие процессы для конечных пользователей, но хотите отображать совсем не разметку HTML, в соответствии с устройства, используемого.
3. ***Создать отдельные области для настольных компьютеров и мобильных браузеров, реализация независимых контроллеры и представления для каждого*.** Этот вариант лучше всего применять, если вы отображать совсем не экраны, содержащий различные сведения и начальные пользователя с помощью различных рабочих процессов, оптимизированными для их типа устройства. Может означать некоторые повторения кода, но можно свести к минимуму, отделение общую логику в базовый уровень или службы.

Если вы захотите воспользоваться **первый** параметр и изменяемые Razor layout каждого типа устройства очень просто. Просто укажите ваш \_ViewStart.cshtml файл следующим образом:

[!code-cshtml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample7.cshtml)]

Теперь можно создавать макет конкретных мобильных \_LayoutMobile.cshtml со структурой страницы и CSS правила, оптимизированный для мобильных устройств.

Если вы захотите воспользоваться **второй** отрисовки совершенно разных представлений зависимости от типа устройства посетителя см. в разделе [Скотт Хансельман блога](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).

Остальная часть этого документа основное внимание уделяется **третий** вариант — создание отдельных контроллерах *и* представления для мобильных устройств —, поэтому можно управлять точно определить, какая часть функциональности предлагается для мобильных устройств посетителей.

### <a name="setting-up-a-mobile-area-within-your-aspnet-mvc-application"></a>Настройка мобильных области в приложении ASP.NET MVC

Можно добавить, называемое «Мобильный» для существующего приложения ASP.NET MVC обычным способом: щелкните правой кнопкой мыши имя проекта в обозревателе решений, а затем выберите Добавить à области. Затем можно добавить контроллеры и представления, как для другой области в приложении ASP.NET MVC. Например добавьте область мобильных новый контроллер вызывается HomeController в качестве домашней страницы для мобильных устройств посетителей.

### <a name="ensuring-the-url-mobile-reaches-the-mobile-homepage"></a>Обеспечение /Mobile URL-адрес достигает мобильных домашней страницы

Если вы хотите /Mobile URL-адрес для достижения действие индекса на HomeController в вашем регионе мобильных устройств, необходимо будет внести два небольшие изменения в конфигурацию маршрутизации. Во-первых обновите ваш класс MobileAreaRegistration, чтобы HomeController контроллера по умолчанию в вашем регионе мобильных устройств, как показано в следующем коде:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample8.cs)]

Это означает мобильных Главная страница теперь будет будут находиться в /Mobile, а не/Mobile домашние, так как «Home» теперь неявно имя по умолчанию контроллер для мобильных страниц.

Далее Обратите внимание, добавляя второй HomeController в приложении (т. е. мобильных той, в дополнение к существующей один рабочий стол), то будет необходимо разорвать регулярных рабочих столов Главная страница. Она завершится с ошибкой «*, удовлетворяющие контроллера, с именем «Home» были найдены несколько типов*». Чтобы устранить эту проблему, обновите верхнего уровня конфигурации маршрутизации (в Global.asax.cs) для указания, что ваш HomeController рабочего стола следует имеют более высокий приоритет при наличии неоднозначности:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample9.cs)]

Теперь будет отправлена ошибки размещения и URL-адрес http://*данный сайт*/ достигнет рабочего стола домашней страницы и http://*данный сайт*/mobile/ достигнет мобильных домашней страницы.

### <a name="redirecting-mobile-visitors-to-your-mobile-area"></a>Перенаправление мобильных посетителям местный мобильных устройств

Имеется много разных расширяемости точек в ASP.NET MVC, поэтому существует множество возможных способов для добавления логики перенаправления. Аккуратно один из вариантов является создание атрибут фильтра, [RedirectMobileDevicesToMobileArea], который выполняет перенаправление, если выполняются следующие условия:

1. Это первый запрос в сеансе пользователя (т. е. Session.IsNewSession имеет значение true)
2. Запрос поступает от мобильных браузеров (т. е. Request.Browser.IsMobileDevice имеет значение true)
3. Пользователь уже не запрашивает ресурс в области мобильных устройств (т. е. *путь* в URL-адрес не начинается с /Mobile)

Загружаемый пример, включенных в этот документ включает в себя реализацию этой логики. Он реализован в виде фильтра авторизации, производный от AuthorizeAttribute, это означает, что он может работать неправильно даже при использовании кэширования выходных данных (в противном случае, если рабочего стола посетитель первый обращается к определенным URL-адрес, выходные данные рабочего стола может кэшировать и затем передается в последующие мобильных посетители).

Как фильтр, можно выбрать версию для применения определенных контроллеров и действий, например,

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample10.cs)]

… или его можно применить ко всем контроллерам и действия в MVC 3 *глобального фильтра* в файле Global.asax.cs:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample11.cs)]

Загружаемый пример также демонстрирует, как создавать подклассы этого атрибута, перенаправление на конкретные места в вашем регионе мобильных устройств. Это означает, например, вы можете:

- Зарегистрируйте глобальный фильтр как показано выше, отправляет мобильных посетителей мобильных домашнюю страницу по умолчанию.
- Также можно примените специальные фильтр [RedirectMobileDevicesToMobileProductPage] для действия «представление продукт», принимающий мобильных посетителям мобильной версии продукта страница запрошенных ими.
- Также применяются другие специальные подклассов фильтра на выполнение определенных действий, перенаправление мобильных посетителям эквивалентные странице для мобильных устройств

### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a>Настройка проверки подлинности форм с соблюдением мобильных веб-страниц

При использовании проверки подлинности форм следует отметить, что когда пользователю требуется войти, он автоматически перенаправляет пользователя один определенный «вход в» URL-адрес, который по умолчанию является **/Account/входа**. Это означает, что мобильных пользователей может быть перенаправлен на действие рабочего стола «вход».

Чтобы избежать этой проблемы, добавьте логику рабочего стола действие «вход», чтобы он перенаправляет мобильных пользователей снова мобильных действие «вход». Если вы используете шаблон приложения ASP.NET MVC по умолчанию, обновите действия входа в систему AccountController следующим образом:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample12.cs)]

… и реализация конкретных mobile «вход» меры на контроллер, называемый AccountController в вашем регионе мобильных устройств.

### <a name="working-with-output-caching"></a>Работа с кэширования выходных данных

Если вы используете фильтр [OutputCache], необходимо принудительно элемент кэша, зависят от типа устройства. Например записи:

[!code-javascript[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample13.js)]

Добавьте следующий метод в файл Global.asax.cs:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample14.cs)]

Это позволит гарантировать, что мобильных посетителями не получать выходные данные, ранее поместить в кэш рабочих столов посетителем.

### <a name="a-working-example"></a>Рабочий пример

Для просмотра этих методов в действии, загрузите [образцы связанного кода в этом техническом документе](https://docs.microsoft.com/aspnet/mobile/overview). Образец включает усовершенствована для поддержки мобильных устройств с помощью описанных выше методов приложения ASP.NET MVC 3 (версия-кандидат).

## <a name="further-guidance-and-suggestions"></a>Дополнительные советы и рекомендации

Следующее обсуждение применяется к веб-форм и MVC разработчикам, использующим технологии, описанные в этом документе.

### <a name="enhancing-your-redirection-logic-using-51degreesmobi-foundation"></a>Улучшение логику перенаправления, с помощью 51Degrees.mobi Foundation

Логике перенаправления, показанные в данном документе может быть вполне достаточно для вашего приложения, но не будет работать, если вам нужно отключить сеансы, или с помощью мобильных браузеров, которые отклонить файлов cookie (они не могут иметь сеансов), так как он не знает ли данного запроса является Первый из этого посетителя.

Вы уже узнали, как открыть источник 51Degrees.mobi Foundation можно улучшить точность ASP. Определение элемента NET обозревателя. Имеется также встроенная возможность перенаправления мобильных посетителей определенные расположения, настроенные в файле Web.config. Он может работать без в зависимости от сеансов ASP.NET (и, следовательно куки-файлы) путем сохранения временного журнала хэшей посетителей заголовки HTTP и IP-адресов, таким образом он знает ли каждый запрос считается первый из данного vistor.

Следующий элемент, добавляемый в fiftyOne раздел файла web.config будет перенаправлять первый запрос с мобильных устройств, обнаруженных на страницу ~ / Mobile/Default.aspx. Все запросы на страницы в папке мобильных устройств будут *не* перенаправляться независимо от типа устройства. Если мобильное устройство не было активности в течение 20 минут или больше устройств будет забыт и последующие запросы будут считаться новые в целях перенаправления.

[!code-xml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample15.xml)]

Дополнительные сведения см. в разделе [51degrees.mobi Foundation документации](https://github.com/51Degrees/dotNET-Device-Detection).

> [!NOTE]
> Вы *можно* 51Degrees.mobi Foundation использования функции перенаправления в MVC-приложениях ASP.NET, но будет необходимо определить конфигурацию перенаправление с точки зрения обычный URL-адреса, не в терминах параметров маршрутизации или путем помещения фильтров MVC в операциях. Это обусловлено (на момент написания статьи) 51Degrees.mobi Foundation не распознает фильтры или маршрутизации.


### <a name="disabling-transcoders-and-proxy-servers"></a>Отключение Транскодеры и прокси-серверы

Операторы мобильной сети имеют две широкие цели в их подход к Интернету мобильных устройств:

1. Предоставить в качестве гораздо соответствующего содержимого, насколько это возможно
2. Максимально увеличить количество клиентов, которые могут совместно использовать пропускную способность сети только переключатель

Поскольку большинство веб-страниц, разработанные для больших экранов размера рабочего стола и быстро фиксированной строки широкополосное подключение, использовать многие операторы *транскодеры* или *прокси-серверы* , динамическое изменение веб-содержимого. Они могут изменять разметку HTML или CSS в соответствии с экране меньшего размера (особенно в случае «компонент телефоны» которых не хватает вычислительной мощности для обработки сложных макетов), и они могут повторное сжатие изображений (значительно снижает качество) для повышения скорости доставки страницы.

Но если вы прошли усилия, чтобы создать версию веб-узла, оптимизированные для мобильных устройств, возможно, необходимо исключить из сетевого оператора, взаимодействовать с ним любой дальнейшей. Можно добавить следующие строки на страницу\_событие загрузки в любой веб-формы ASP.NET:

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample16.cs)]

Или для контроллера ASP.NET MVC, можно добавить следующие переопределяющий метод, чтобы он применяется ко всем действиям на этом контроллере.

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample17.cs)]

Полученное в результате сообщение HTTP информирует совместимые — в формате W3C и прокси-серверы не для изменения содержимого. Разумеется нет никакой гарантии, что операторы мобильной сети будут использовать это сообщение.

### <a name="styling-mobile-pages-for-mobile-browsers"></a>Задание стиля страницах для мобильных устройств для мобильных браузеров

Он выходит за рамки данного документа описываются подробно какие виды работ разметки HTML правильно или какие способы разработки веб повышения удобства использования на конкретных устройств. Он содержит вверх для поиска достаточно простой макет, оптимизированные для мобильных размера экрана, без использования ненадежных HTML или рекомендации позиционирования CSS. Одним из способов важно отметить, однако является *просмотра метатег*.

Некоторые современные браузеры для мобильных устройств, на веб-страницах усилий отображения предназначен для настольных компьютеров мониторов визуализации страницы на виртуальный холст, также называется «окно просмотра» (например, виртуального окна просмотра является 980 пикселей в ширину на iPhone и 850 пикселов на Opera Mobile по умолчанию) и затем Масштабируйте результат для размещения на физических пикселей на экране. Пользователь может затем увеличить масштаб и панорамирования, окна просмотра. Это имеет то преимущество, что он позволяет браузер отображения страницы в его предполагаемого макета, но также имеет недостаток заставляет масштабирования и панорамирования, который является неудобным для пользователя. При разработке для мобильных устройств, лучше конструктора для обычных экрана, чтобы увеличение масштаба или горизонтальной полосы прокрутки не требуется.

Заставляет мобильных браузеров ширину окна просмотра должно быть – нестандартное *просмотра* мета-тег. Например, добавьте следующий раздел HEAD страницы,

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample18.html)]

… затем Поддержка браузеров смартфонов будет макет страницы на полотне виртуальные 480 пикселей. Это означает, что если ваш HTML-элементов определяет их ширина в процентах, процентные показатели будут интерпретироваться по отношению к этой ширины 480 пикселей, не по умолчанию ширины окна просмотра. В результате пользователь скорее всего, придется изменение масштаба и сдвиг по горизонтали — значительно повышая мобильных устройств.

Если вы хотите ширины окна просмотра для сопоставления точек физического устройства, можно указать:

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample19.html)]

Чтобы это работало правильно, не должен явным образом принудительное элементов превышает эту ширину (например, с помощью *ширина* атрибут или свойство CSS), в противном случае браузер должен будет использовать больше просмотра независимо от того. См. также: [Дополнительные сведения о теге нестандартное просмотра](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).

Поддерживает большинство современных смартфонов *двумя ориентации*: они могут храниться в книжном или альбомном режиме. Таким образом важно не делайте никаких предположений о ширину экрана в пикселях. Не даже предполагается, что фиксирована ширины экрана, так как пользователь повторно можно разобраться своего устройства, когда они находятся на странице.

Старые устройства Windows Mobile и Blackberry также может принимать следующие мета-теги в заголовке страницы, сообщите ему содержимого был оптимизирован для мобильных устройств и поэтому не должны преобразовываться.

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample20.html)]

## <a name="additional-resources"></a>Дополнительные ресурсы

Список мобильных устройств эмуляторы и симуляторы, можно использовать для тестирования веб-приложения ASP.NET мобильных устройств, см. на странице [имитировать популярных мобильных устройств для тестирования](../mobile/device-simulators.md).

## <a name="credits"></a>Благодарности

- Основного автора: Андрей Сандерсон
- Рецензенты / дополнительных модулей записи содержимого: Джеймс Rosewell, Майкл Söderström, Скотт Хансельман, Scott Хантер
