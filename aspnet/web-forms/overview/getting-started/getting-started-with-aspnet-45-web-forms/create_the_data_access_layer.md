---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/create_the_data_access_layer
title: Создание уровня доступа к данным | Документы Microsoft
author: Erikre
description: Этот учебник ряд описываются основы построения приложения веб-форм ASP.NET с помощью ASP.NET 4.5 и Microsoft Visual Studio Express 2013 для мы...
ms.author: aspnetcontent
manager: wpickett
ms.date: 09/08/2014
ms.topic: article
ms.assetid: 0bbf7a6e-d7eb-4091-91e4-fff892777f32
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/create_the_data_access_layer
msc.type: authoredcontent
ms.openlocfilehash: 671d1bbf661dfb3e56c6ccd67ce0d383990918d6
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="create-the-data-access-layer"></a>Создание уровня доступа к данным
====================
по [Эрик Reitan](https://github.com/Erikre)

[Загрузите образец проекта Wingtip Toys (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) или [загрузить электронную (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)

> Этот учебник ряд описываются основы построения с помощью ASP.NET 4.5 и Microsoft Visual Studio Express 2013 для веб-приложения веб-форм ASP.NET. Visual Studio 2013 [проект с исходным кодом C#](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) доступен по следующему этого учебника ряда.


Этот учебник описывает создание, доступ и просматривать данные из базы данных с помощью веб-форм ASP.NET и Entity Framework Code First. Этот учебник основана на работу с предыдущим учебником «Создать проект» и является частью учебника по магазину игрушек Wingtip ряда. После завершения этого учебника вы сможете создать группу классов доступа к данным, которые находятся в *моделей* папку проекта.

## <a name="what-youll-learn"></a>Что вы узнаете следующее.

- Инструкции по созданию моделей данных.
- Как для инициализации и инициализировать базу данных.
- Как обновить и настроить приложение для поддержки базы данных.

### <a name="these-are-the-features-introduced-in-the-tutorial"></a>Существуют следующие функции, представленные в этом учебнике:

- Платформа Entity Framework Code First
- LocalDB
- Заметки к данным

## <a name="creating-the-data-models"></a>Создание модели данных

[Платформа Entity Framework](https://msdn.microsoft.com/data/aa937723) платформу объектно реляционного сопоставления (ORM). Он позволяет работать с реляционными данными как с объектами, устраняя большую часть кода доступа к данным, обычно необходимо записать. С помощью платформы Entity Framework, можно выполнять запросы с помощью [LINQ](https://msdn.microsoft.com/library/bb397926.aspx), получения и работы с данными в виде строго типизированных объектов. Технология LINQ предоставляет шаблоны для запросов и обновления данных. Entity Framework позволяет сосредоточиться на создании остальной части приложения, а не сосредоточиться на данных основы доступа. Далее в этой серии учебника мы покажем, как использовать данные для заполнения запросы навигации и продукта.

Entity Framework поддерживает парадигмы разработки, в вызове *Code First*. Код сначала можно определить с помощью классов модели данных. Класс — это конструкция, которая позволяет создавать собственные пользовательские типы путем группирования переменных других типов, методов и событий. Можно сопоставить классы для существующей базы данных или использовать их для создания базы данных. В этом учебнике вы создадите моделей данных, написав классы модели данных. Затем сообщим создания базы данных на лету из этих новых классов Entity Framework.

Сначала путем создания классов сущностей, определения моделей данных для приложения веб-форм. Затем создается класс контекста, управляет классы сущностей и предоставляет доступ к базе данных. Также создается класс инициализатора, который будет использоваться для заполнения базы данных.

### <a name="entity-framework-and-references"></a>Entity Framework и ссылки

По умолчанию, Entity Framework включается при создании нового **веб-приложение ASP.NET** с помощью **Web Forms** шаблона. Entity Framework можно установить, удален и обновить как пакет NuGet.

Этот пакет NuGet входят следующие **среды выполнения** сборки в проекте:

- EntityFramework.dll — все общие кода среды выполнения, используемые платформой Entity Framework
- EntityFramework.SqlServer.dll — поставщик Microsoft SQL Server для Entity Framework

### <a name="entity-classes"></a>Классы сущностей

Классы, создайте для определения схемы данных, называются классы сущностей. Если вы не знакомы с проектированием баз данных, считаете классы сущностей определения таблиц базы данных. Каждое свойство в классе, задает столбец в таблице базы данных. Эти классы предоставляют простой и объектно реляционного интерфейс между кодом, объектно ориентированного и структура таблицы реляционной базы данных.

В этом учебнике начните путем добавления простого объекта классы, представляющие схемы для категорий и продуктов. Класс продуктов будет содержать определения для каждого продукта. Имя каждого из членов класса продуктов будет `ProductID`, `ProductName`, `Description`, `ImagePath`, `UnitPrice`, `CategoryID`, и `Category`. Класс категории будет содержать определения для каждой категории, продукт может принадлежать, например автомобиля, Boat или плоскости. Имя каждого из элементов категории класса будет `CategoryID`, `CategoryName`, `Description`, и `Products`. Каждый продукт будет принадлежать к одной из категорий. Эти классы сущностей будут добавлены в проект существующие *моделей* папки.

1. В **обозревателе решений**, щелкните правой кнопкой мыши *моделей* папки, а затем выберите **добавить**  - &gt; **новый элемент**. 

    ![Создание уровня доступа к данным — новый элемент меню](create_the_data_access_layer/_static/image1.png)

   Откроется диалоговое окно **Добавление нового элемента**.
2. В разделе **Visual C#** из **установленные** панели слева выберите **кода**. 

    ![Создание уровня доступа к данным — новый элемент меню](create_the_data_access_layer/_static/image2.png)
3. Выберите **класса** в средней области и назовите этот новый класс *Product.cs*.
4. Нажмите кнопку **Добавить**.  
   В редакторе отображается новый файл класса.
5. Замените код по умолчанию следующим кодом:   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample1.cs)]
6. Создайте еще один класс, повторив шаги с 1 по 4, однако имя для нового класса *Category.cs* и замените код по умолчанию следующим кодом:  

    [!code-csharp[Main](create_the_data_access_layer/samples/sample2.cs)]

Как упоминалось ранее, `Category` класс представляет тип продукта, является приложение предназначен для продажи (такие как <a id="a"> </a> &quot;автомобилей&quot;, &quot;лодок&quot;, &quot;Rockets&quot;и так далее) и `Product` класс представляет отдельные продукты (toys) в базе данных. Каждый экземпляр `Product` объекта будет соответствовать строки в таблице реляционной базы данных, а каждое свойство класса Product сопоставляются со столбцом в таблице реляционной базы данных. Далее в этом учебнике будет просматривать данные в базе данных.

### <a name="data-annotations"></a>Заметки к данным

Можно заметить наличие определенных членов класса атрибутов, указав сведения об элементе, например `[ScaffoldColumn(false)]`. Это *заметок к данным*. Атрибуты заметок данных можно описать как проверки пользовательского ввода для этого элемента, чтобы задать формат для него и для указания того, как он моделируется при создании базы данных.

### <a name="context-class"></a>Класс Context

Чтобы начать использование классов для доступа к данным, необходимо определить класс контекста. Как упоминалось ранее, класс контекста управляет классов сущностей (например, `Product` класса и `Category` класса) и предоставляет доступ к базе данных.

Эта процедура добавляет новый класс C# контекст для *моделей* папки.

1. Щелкните правой кнопкой мыши *моделей* папки, а затем выберите **добавить**  - &gt; **новый элемент**.   
   Откроется диалоговое окно **Добавление нового элемента**.
2. Выберите **класса** в средней области, назовите его *ProductContext.cs* и нажмите кнопку **добавить**.
3. Замените код по умолчанию, содержащиеся в классе с помощью следующего кода:   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample3.cs)]

Этот код добавляет `System.Data.Entity` пространства имен, чтобы получить доступ к основным функциям платформы Entity Framework, которая включает возможность для запроса, вставка, обновление и удаление данных при работе со строго типизированных объектов.

`ProductContext` Класс представляет контекст базы данных Entity Framework продукта, который обрабатывает выборка, хранения и обновления `Product` класса экземпляров в базе данных. `ProductContext` Класс является производным от `DbContext` базового класса, предоставляемых Entity Framework.

### <a name="initializer-class"></a>Инициализатор класса

Необходимо будет выполнить определенную настраиваемую логику для инициализации базы данных при первом запуске контекст используется. Это позволит начальное значение данных для добавления в базу данных, чтобы немедленно отобразить продукты и категории.

Эта процедура добавляет новый класс C# инициализатор для *моделей* папки.

1. Создайте другой `Class` в *моделей* папки и назовите его *ProductDatabaseInitializer.cs*.
2. Замените код по умолчанию, содержащиеся в классе с помощью следующего кода:   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample4.cs)]

Как видно в приведенном выше коде при создании и инициализации базы данных `Seed` свойство переопределено и установлено. Когда `Seed` имеет значение свойства, значения из категорий и продуктов используются для заполнения базы данных. При попытке обновить данные инициализации, изменив приведенный выше код после создания базы данных, вы не увидите обновлений при запуске веб-приложения. Причина заключается в приведенный выше код использует реализацию `DropCreateDatabaseIfModelChanges` класса для распознавания, изменилась ли модели (схема), перед сбросом данных начального значения. Если изменения не вносятся в `Category` и `Product` классы сущностей, базы данных будет не будут повторно инициализированы с данными начальное значение.

> [!NOTE] 
> 
> Если требуется, чтобы в базе данных быть созданы повторно при каждом запуске приложения, можно использовать `DropCreateDatabaseAlways` вместо класса `DropCreateDatabaseIfModelChanges` класса. Однако для этого учебника ряда использовать `DropCreateDatabaseIfModelChanges` класса.


На этом этапе в этом учебнике будет иметь *моделей* папки с четыре новых классов и класса одно значение по умолчанию:

![Создание уровня доступа к данным — папки моделей](create_the_data_access_layer/_static/image3.png)

### <a name="configuring-the-application-to-use-the-data-model"></a>Настройка приложения для использования модели данных

После создания классов, которые представляют данные, необходимо настроить приложение для использования классов. В *Global.asax* файл, добавьте код, который инициализирует модель. В *Web.config* файл, добавить сведения, которое сообщает приложению, что база данных будет использоваться для хранения данных, представленного новые классы данных. *Global.asax* файл может использоваться для обработки событий или методов приложения. *Web.config* файл позволяет изменять конфигурацию веб-приложения ASP.NET.

#### <a name="updating-the-globalasax-file"></a>Обновление файла Global.asax

Для инициализации моделей данных при запуске приложения, потребуется обновить `Application_Start` обработчик в *Global.asax.cs* файла.

> [!NOTE] 
> 
> В обозревателе решений, можно выбрать *Global.asax* файл или *Global.asax.cs* файл для редактирования *Global.asax.cs* файла.


1. Добавьте следующий код, выделены желтым цветом, позволяя `Application_Start` метод в *Global.asax.cs* файла.   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample5.cs?highlight=9-10,22-23)]

> [!NOTE] 
> 
> Браузер должен поддерживать HTML5, чтобы просмотреть код, выделены желтым цветом, при просмотре этого учебника ряда в браузере.


Как показано в приведенном выше коде, при запуске приложения, оно указывает, что инициализатора, который будет выполняться во время выполнения первого данных осуществляется. Требуются две дополнительные пространства имен для доступа к `Database` объекта и `ProductDatabaseInitializer` объекта.

 Изменение файла Web.Config 

Несмотря на то, что Entity Framework Code First будет создать базу данных для вас в расположении по умолчанию при заполнении базы данных с данными начальное значение, добавление в приложение данные подключения обеспечивает контроль над расположение базы данных. Укажите это подключение базы данных, используя строку подключения в приложении *Web.config* файл в корневой папке проекта. Добавление новой строки соединения, вы можете указать расположение базы данных (*wingtiptoys.mdf*) для сборки в каталог данных приложения (*приложения\_данные*), вместо значения по умолчанию расположение. Внесение этого изменения будет позволяют найти и проверить файл базы данных далее в этом учебнике.

1. В **обозревателе решений**, найдите и откройте *Web.config* файла.
2. Добавьте строку подключения, выделены желтым цветом, позволяя `<connectionStrings>` раздел *Web.config* следующим образом:  

    [!code-xml[Main](create_the_data_access_layer/samples/sample6.xml?highlight=4-7)]

При первом запуске приложения, то производится построение базы данных в расположении, указанном в строке подключения. Однако перед запуском приложения, давайте ее первая сборка.

## <a name="building-the-application"></a>Построение приложения

Убедиться, что работают все классы и изменения в веб-приложение, необходимо построить приложение.

1. Из **отладки** последовательно выберите пункты **построения WingtipToys**.  
 **Вывода** откроется окно и в случае успешной, вы увидите *успешно* сообщения.  

    ![Создание уровня доступа к данным — выходных данных Windows](create_the_data_access_layer/_static/image4.png)

Если возникли ошибки, проверьте указанные выше шаги. Сведения в **вывода** окна покажет, какой файл возникли проблемы и где требуется изменение в файле. Эта информация позволит определить, какая часть описанные выше действия для просмотра и исправлена в своем проекте.

## <a name="summary"></a>Сводка

В этом учебнике ряда можно создания модели данных, а также, дополнительный код, который будет использоваться для инициализации и инициализировать базу данных. Также вы настроили приложение для использования модели данных при запуске приложения.

В следующем уроке будет обновление пользовательского интерфейса, добавьте навигации и получения данных из базы данных. Это приведет к базе данных создаются автоматически на основании классов сущностей, созданной в этом учебнике.

## <a name="additional-resources"></a>Дополнительные ресурсы

[Общие сведения об Entity Framework](https://msdn.microsoft.com/library/bb399567.aspx)   
[Общие сведения о ADO.NET Entity Framework](https://msdn.microsoft.com/data/ee712907)   
[Первый разработки с Entity Framework Code](http://www.msteched.com/2010/Europe/DEV212) (видео)   
[Код Fluent API первой связи](https://msdn.microsoft.com/data/hh134698)   
[Код первого заметок к данным](https://msdn.microsoft.com/data/gg193958)  
[Платформа Entity Framework средств повышения производительности](https://blogs.msdn.com/b/efdesign/archive/2010/06/21/productivity-improvements-for-the-entity-framework.aspx?wa=wsignin1.0)

> [!div class="step-by-step"]
> [Назад](create-the-project.md)
> [Вперед](ui_and_navigation.md)
