---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/url-routing
title: Маршрутизация URL-адрес | Документы Microsoft
author: Erikre
description: Этот учебник ряд описываются основы построения приложения веб-форм ASP.NET с помощью ASP.NET 4.5 и Microsoft Visual Studio Express 2013 для мы...
ms.author: aspnetcontent
manager: wpickett
ms.date: 09/08/2014
ms.topic: article
ms.assetid: 4f4bf092-c400-471f-a876-78fda0417890
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/url-routing
msc.type: authoredcontent
ms.openlocfilehash: a195b36517bcae4bbeaf43fe7386e7787fd00212
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="url-routing"></a>Маршрутизация URL-адресов
====================
по [Эрик Reitan](https://github.com/Erikre)

[Загрузите образец проекта Wingtip Toys (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) или [загрузить электронную (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)

> Этот учебник ряд описываются основы построения с помощью ASP.NET 4.5 и Microsoft Visual Studio Express 2013 для веб-приложения веб-форм ASP.NET. Visual Studio 2013 [проект с исходным кодом C#](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) доступен по следующему этого учебника ряда.


В этом учебнике предстоит изменить пример приложения Wingtip Toys для поддержки маршрутизации URL-адрес. Маршрутизация позволяет использовать URL-адреса, понятное, легче запомнить и лучше поддерживается поисковыми веб-приложения. Этот учебник основана на работу с предыдущим учебником «Членство и администрирование» и является частью учебника по серии Wingtip Toys.

## <a name="what-youll-learn"></a>Что вы узнаете следующее.

- Способы регистрации маршрутов для приложения веб-форм ASP.NET.
- Как добавить маршруты на веб-страницу.
- Как выбрать данные из базы данных для поддержки маршрутов.

## <a name="aspnet-routing-overview"></a>Общие сведения о маршрутизации ASP.NET

Маршрутизация URL-адресов можно настроить приложение для принятия запроса URL-адреса, которые не сопоставлены с физическими файлами. URL-АДРЕСЕ запроса — это просто URL-адрес, пользователь вводит в своем браузере для поиска страницы на веб-сайте. Маршрутизация используется для определения URL-адресов, которые семантически может применяться для пользователей и возможность оптимизации поисковой системы (SEO).

По умолчанию шаблон веб-форм включает [ASP.NET Friendly URLs](http://www.nuget.org/packages/Microsoft.AspNet.FriendlyUrls/). Большая часть базовых маршрутизации работы будет реализован с помощью *Friendly URLs*. Однако в этом учебнике вы добавите пользовательские функции маршрутизации.

Перед началом настройки маршрутизации URL-адрес, пример приложения Wingtip Toys можно связать с продуктом, указав следующий URL-адрес.

`https://localhost:44300/ProductDetails.aspx?productID=2`

Внеся изменения в URL-адрес маршрутизации, пример приложения Wingtip Toys свяжет того же продукта с помощью более удобными для чтения URL-адрес:

`https://localhost:44300/Product/Convertible%20Car`

### <a name="routes"></a>Маршруты

Маршрут — шаблон URL-адреса, который сопоставляется с обработчиком. Обработчик может быть физического файла, например ASPX-файл в приложении Web Forms. Обработчик также может быть класс, который обрабатывает запрос. Чтобы определить маршрут, создать экземпляр класса маршрута, указав шаблон URL-адреса, обработчик и при необходимости имя маршрута.

Чтобы добавить маршрут в приложение, добавив `Route` объекта статического `Routes` свойство `RouteTable` класса. Свойство маршруты `RouteCollection` объект, который хранит все маршруты для приложения.

### <a name="url-patterns"></a>Шаблоны URL-адресов

Шаблон URL-адреса может содержать литеральные значения и заполнители для переменных (которые называются параметрами URL-адрес). Литералы и заполнители расположены в сегменты URL-адреса, которые разделяются косой черты (`/`) символов.

При запросе в веб-приложение, URL-адрес разбирается на сегменты и заполнители, и значения переменных, позволяющих обработчик запроса. Этот процесс аналогично тому, как данные в строке запроса анализируется и передается в обработчик запроса. В обоих случаях сведения о переменных включается в URL-адрес и переданы в обработчик в виде пар "ключ значение". Для строк запросов ключи и значения находятся в URL-адрес. Для маршрутов ключи являются именами заполнителей, определенной в шаблоне URL-адрес, и в URL-АДРЕСЕ находятся только значения.

В шаблон URL-адреса заполнители задаются путем их заключения в фигурные скобки ( `{` и `}` ). Можно определить несколько заполнителей в сегмент, но заполнители должны разделяться литералом. Например `{language}-{country}/{action}` является допустимым шаблоном маршрута. Однако `{language}{country}/{action}` не является допустимым шаблоном, так как нет литеральное значение или разделитель между. Таким образом маршрутизации не может определить, куда следует отделять значение местозаполнителя языка из значения заполнителя страны.

### <a name="mapping-and-registering-routes"></a>Сопоставление и регистрации маршрутов

Перед включением маршруты к страницам Wingtip Toys образца приложения необходимо зарегистрировать маршруты при запуске приложения. Чтобы зарегистрировать маршруты, изменить `Application_Start` обработчика событий.

1. В **обозревателе решений**Visual Studio, поиск и открытие *Global.asax.cs* файла.
2. Добавьте код, выделены желтым цветом, позволяя *Global.asax.cs* следующим образом:   

    [!code-csharp[Main](url-routing/samples/sample1.cs?highlight=30-31,34-46)]

Если Wingtip Toys образец приложения, он вызывает `Application_Start` обработчика событий. В конце этого обработчика событий `RegisterCustomRoutes` вызывается метод. `RegisterCustomRoutes` Метод добавляет каждый маршрут путем вызова `MapPageRoute` метод `RouteCollection` объекта. Маршруты определены, используя имя маршрута, URL-адрес маршрута и физический URL-адрес.

Первый параметр («`ProductsByCategoryRoute`») — имя маршрута. Он используется для вызова маршрута, когда он необходим. Второй параметр (»`Category/{categoryName}`«) Определяет понятное замены, URL-адрес, который может быть динамическим на основе кода. При заполнении элемента управления данными со ссылками, которые создаются на основе данных, используйте этот маршрут. Маршрут отображается следующим образом:

[!code-csharp[Main](url-routing/samples/sample2.cs)]

Второй параметр маршрута включает динамическое значение, указанное в фигурные скобки (`{ }`). В этом случае `categoryName` является переменной, которая будет использоваться для определения правильного пути маршрутизации.

> [!NOTE] 
> 
> **Необязательный**
> 
> Может оказаться проще управлять, переместив код `RegisterCustomRoutes` метод в отдельный класс. В *логику* папке создайте отдельное `RouteActions` класса. Переместить выше `RegisterCustomRoutes` метод *Global.asax.cs* файл в новый `RoutesActions` класса. Используйте `RoleActions` класса и `createAdmin` метод в качестве примера того, как вызвать `RegisterCustomRoutes` метод *Global.asax.cs* файла.


Возможно, вы также заметили `RegisterRoutes` вызов метода с помощью `RouteConfig` объекта в начале `Application_Start` обработчика событий. Этот вызов выполняется для маршрутизации по умолчанию. При создании приложения с помощью шаблона веб-форм Visual Studio было включить как код по умолчанию.

## <a name="retrieving-and-using-route-data"></a>Получение и использование данных о маршруте

Как упоминалось выше, можно определить маршруты. Код, который вы добавили `Application_Start` обработчик событий в *Global.asax.cs* файл для загрузки устанавливаемых маршруты.

### <a name="setting-routes"></a>Настройка маршрутов

Маршруты необходимо добавить дополнительный код. В этом учебнике используется привязка модели для получения `RouteValueDictionary` объект, используемый при создании маршрутов, с помощью данных из элемента управления данными. `RouteValueDictionary` Объекта будет содержать список названий продуктов, относящихся к определенной категории продуктов. Для каждого продукта на основе данных и маршрут создается связь.

#### <a name="enable-routes-for-categories-and-products"></a>Включить маршруты для категорий и продуктов

Затем предстоит обновить приложение для использования `ProductsByCategoryRoute` для определения правильного маршрута для включения для каждого канала категории продукта. Вы также сможете обновить *ProductList.aspx* страницу, чтобы включить перенаправленное ссылку для каждого продукта. Ссылки отображаются как до изменения, однако теперь используются ссылки маршрутизация URL-адресов.

1. В **обозревателе решений**откройте *Site.Master* страницы, если он еще не открыт.
2. Обновление **ListView** управления с именем «`categoryList`» с изменениями, выделены желтым цветом, поэтому разметку выглядит следующим образом:   

    [!code-aspx[Main](url-routing/samples/sample3.aspx?highlight=7-9)]
3. В **обозревателе решений**откройте *ProductList.aspx* страницы.
4. Обновление `ItemTemplate` элемент *ProductList.aspx* страницы с обновлениями, выделены желтым цветом, поэтому разметку выглядит следующим образом:   

    [!code-aspx[Main](url-routing/samples/sample4.aspx?highlight=6-9,14-16)]
5. Откройте код программной части *ProductList.aspx.cs* и добавьте следующее пространство имен, как видно из желтый:  

    [!code-csharp[Main](url-routing/samples/sample5.cs?highlight=9)]
6. Замените `GetProducts` метода из кода (*ProductList.aspx.cs*) с помощью следующего кода:   

    [!code-csharp[Main](url-routing/samples/sample6.cs)]

#### <a name="add-code-for-product-details"></a>Добавьте код для сведений о продукте

Теперь обновите код программной части (*ProductDetails.aspx.cs*) для *ProductDetails.aspx* страницу, чтобы использовать данные о маршруте. Обратите внимание, что новый `GetProduct` метод также принимает значение строки запроса для случая, где пользователь имеет связь с закладками, который использует старую без понятного имени, без маршрутизации URL-адрес.

1. Замените `GetProduct` метода из кода (*ProductDetails.aspx.cs*) с помощью следующего кода:   

    [!code-csharp[Main](url-routing/samples/sample7.cs)]

## <a name="running-the-application"></a>Запуск приложения

Можно запустить приложение для просмотра обновленных маршрутов.

1. Нажмите клавишу **F5** для запуска образца приложения Wingtip Toys.  
 Браузер откроется со *Default.aspx* страницы.
2. Нажмите кнопку **продуктов** ссылку в верхней части страницы.  
 Все продукты, отображаются на *ProductList.aspx* страницы. Для браузера отображается следующий URL-адрес (используя свой номер порта).  
    `https://localhost:44300/ProductList`
3. Далее щелкните **автомобилей** категории ссылок в верхней части страницы.  
 Только автомобилей, отображаются на *ProductList.aspx* страницы. Для браузера отображается следующий URL-адрес (используя свой номер порта).  
    `https://localhost:44300/Category/Cars`
4. Щелкните ссылку, содержащую имя первого автомобиля, перечисленные на странице («**автомобиль приводимым**») чтобы отобразить сведения о продукте.  
 Для браузера отображается следующий URL-адрес (используя свой номер порта).  
    `https://localhost:44300/Product/Convertible%20Car`
5. Затем введите следующие без маршрутизации URL-адрес (используя свой номер порта) в браузер:  
    `https://localhost:44300/ProductDetails.aspx?productID=2`  
 Код по-прежнему распознает URL-адрес, который включает строку запроса для случая, когда у пользователя есть ссылка с закладками.

## <a name="summary"></a>Сводка

В этом учебнике вы добавили маршруты для категорий и продуктов. Вы узнали, как маршруты могут интегрироваться с элементами управления данными, использующих привязки модели. В следующем уроке будет реализовать обработку ошибок глобального.

## <a name="additional-resources"></a>Дополнительные ресурсы

[ASP.NET Friendly URLs](http://www.nuget.org/packages/Microsoft.AspNet.FriendlyUrls/)  
[Развертывание приложения безопасного ASP.NET Web Forms членства, OAuth и базы данных SQL в службе приложений Azure](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)  
[Microsoft Azure — бесплатная пробная версия](https://azure.microsoft.com/pricing/free-trial/)

> [!div class="step-by-step"]
> [Назад](membership-and-administration.md)
> [Вперед](aspnet-error-handling.md)
