---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/shopping-cart
title: "Корзина для покупок | Документы Microsoft"
author: Erikre
description: "Этот учебник ряд описываются основы построения приложения веб-форм ASP.NET с помощью ASP.NET 4.5 и Microsoft Visual Studio Express 2013 для мы..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 09/08/2014
ms.topic: article
ms.assetid: 6898c601-6c31-432f-8388-e6843f8a17cb
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/shopping-cart
msc.type: authoredcontent
ms.openlocfilehash: 9fe6f28685d6a423b03f9c7abe753283b89344e1
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2018
---
<a name="shopping-cart"></a>Корзина для покупок
====================
По [Эрик Reitan](https://github.com/Erikre)

[Загрузите образец проекта Wingtip Toys (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) или [загрузить электронную (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)

> Этот учебник ряд описываются основы построения с помощью ASP.NET 4.5 и Microsoft Visual Studio Express 2013 для веб-приложения веб-форм ASP.NET. Visual Studio 2013 [проект с исходным кодом C#](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) доступен по следующему этого учебника ряда.


В данном учебнике бизнес-логики, которые требуется добавить в корзину Wingtip Toys примера приложения веб-форм ASP.NET. Этот учебник основана на работу с предыдущим учебником «Отобразить данные элементов и сведения о» и является частью учебника по магазину игрушек Wingtip ряда. После завершения этого учебника, пользователи образец приложения смогут добавлять, удалять и изменять продуктов в его корзине.

## <a name="what-youll-learn"></a>Что вы узнаете следующее.

1. Инструкции по созданию корзины для веб-приложения.
2. Как предоставить пользователям возможность добавлять элементы в корзину.
3. Добавление [GridView](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview(v=vs.110).aspx#introduction) элемента управления для отображения сведений о корзине для покупок.
4. Порядок вычисления и отображения итоговой суммы заказа.
5. Удаление и обновление элементов в корзину.
6. Как включить корзину покупок счетчика.

## <a name="code-features-in-this-tutorial"></a>Код функции в этом учебнике:

1. Платформа Entity Framework Code First
2. Заметки к данным
3. Строго типизированные элементы управления данными
4. Привязка модели

## <a name="creating-a-shopping-cart"></a>Создание корзины

Ранее в этой серии учебника вы добавили страниц и код для просмотра сведений о продуктах из базы данных. В этом учебнике вы создадите корзины для управления продуктами, пользователи заинтересованные в покупке. Пользователи смогут просматривать и добавлять элементы в корзину покупок, даже если они не зарегистрированы или не вошел в систему. Для управления доступом к покупательской корзины, будет назначить пользователей уникальный `ID` с помощью глобальный уникальный идентификатор (GUID), когда пользователь обращается к покупок корзину в первый раз. Это будут храниться `ID` использования состояния сеанса ASP.NET.

> [!NOTE] 
> 
> Состояние сеанса ASP.NET — удобное место для хранения сведений о пользователе которого истекает после пользователь покидает сайт. Во время использования состояния сеанса влияют на производительность для больших сайтов, светло-использование работает состояния сеанса для демонстрационных целей. Пример проекта Wingtip Toys демонстрируется использование состояния сеанса без внешнего поставщика состояния сеанса где хранимые в процессе на веб-сервере сайта. Для больших сайтов, которые предоставляют несколько экземпляров приложения или на сайтах, работающих на разных серверах несколько экземпляров приложения рассмотрите возможность использования **службы кэша Windows Azure**. Эта служба кэша предоставляет службы распределенного кэширования, внешних по отношению к веб-сайта и позволяет решить проблему с помощью состояния сеанса в процессе. Дополнительные сведения см. в разделе [как использовать состояние сеанса ASP.NET с Windows Azure Web Sites](https://docs.microsoft.com/azure/redis-cache/cache-aspnet-session-state-provider).


### <a name="add-cartitem-as-a-model-class"></a>Добавить CartItem в качестве класса модели

Ранее в данной серии учебных курсов определенные схемы для категорий и продуктов данных путем создания `Category` и `Product` классы в *моделей* папки. Теперь добавьте новый класс для определения схемы для корзины для покупок. Далее в этом руководстве вы добавите класс осуществлять доступ к данным `CartItem` таблицы. Этот класс предоставит бизнес-логики, чтобы добавлять, удалять и обновлять элементы в список покупок.

1. Щелкните правой кнопкой мыши *моделей* папку и выберите **добавить**  - &gt; **новый элемент**. 

    ![Корзина для покупок - новый элемент](shopping-cart/_static/image1.png)
2. Откроется диалоговое окно **Добавление нового элемента**. Выберите **кода**, а затем выберите **класса**. 

    ![Корзина для покупок - новое диалоговое окно добавления элемента](shopping-cart/_static/image2.png)
3. Назовите этот новый класс *CartItem.cs*.
4. Нажмите кнопку **Добавить**.  
 В редакторе отображается новый файл класса.
5. Замените код по умолчанию следующим кодом:   

    [!code-csharp[Main](shopping-cart/samples/sample1.cs)]

`CartItem` Класс содержит схему, которая будет определен каждый продукт, пользователь добавляет в корзину. Этот класс похоже на другие классы схемы, созданный ранее в этой серии учебника. По соглашению Entity Framework Code First ожидает, первичный ключ для `CartItem` таблица будет либо `CartItemId` или `ID`. Однако код переопределяет поведение по умолчанию с помощью заметки данных `[Key]` атрибута. `Key` Указывает, что атрибут свойства ItemId `ItemID` свойство является первичным ключом.

`CartId` Свойство указывает `ID` пользователя, связанный с элементом на покупку. Вы добавите код для создания этого пользователя `ID` когда пользователь обращается к покупательской корзине. Это `ID` также будут храниться в виде переменной сеанса ASP.NET.

### <a name="update-the-product-context"></a>Обновление контекста продукта

Помимо добавления `CartItem` класса, будет необходимо обновить класс контекста базы данных, управляющий классы сущностей и предоставляющий доступ к базе данных. Чтобы сделать это, мы добавим вновь созданный `CartItem` класс для модели `ProductContext` класса.

1. В **обозревателе решений**, найдите и откройте *ProductContext.cs* файла в *моделей* папки.
2. Добавьте код, выделенный для *ProductContext.cs* следующим образом:  

    [!code-csharp[Main](shopping-cart/samples/sample2.cs?highlight=14)]

Как упоминалось ранее в данной серии учебных курсов, код в *ProductContext.cs* добавляет файл `System.Data.Entity` пространства имен, чтобы получить доступ к основным функциям платформы Entity Framework. Эта функция включает в себя возможность запроса, вставки, обновления и удаления данных при работе со строго типизированных объектов. `ProductContext` Класс добавляет доступа к недавно добавленному `CartItem` класс модели.

### <a name="managing-the-shopping-cart-business-logic"></a>Управление бизнес-логики покупательской корзины

Затем вы создадите `ShoppingCart` класса в новом *логику* папки. `ShoppingCart` Класс обрабатывает доступ к данным `CartItem` таблицы. Класс также входят бизнес-логики, чтобы добавлять, удалять и обновлять элементы в список покупок.

Корзина покупок логики, который будет добавлен будет содержать функциональные возможности управления следующие действия:

1. Добавление элементов в корзину покупок
2. Удаление элементов из корзины
3. Для получения идентификатора покупательской корзины
4. Получение элементов из корзины
5. Группировка сумму всех покупок Корзина
6. Обновление данных корзины

Корзина покупок страницы (*ShoppingCart.aspx*) и класс покупательской корзины будет совместно использоваться для доступа к данных корзины. Страница покупательской корзины для покупок отобразит все элементы, которые пользователь добавляет в корзину для покупок. Помимо корзины страницы и класса, вы создадите страницы (*AddToCart.aspx*) для добавления продукты в корзину для покупок. Добавим код к *ProductList.aspx* страницы и *ProductDetails.aspx* страницу, которая будет указана ссылка на *AddToCart.aspx* страницы, чтобы добавить пользователя продукты в корзину для покупок.

В примере ниже показан базовый процесс, когда пользователь добавляет продукт в корзину для покупок.

![Корзина для покупок - Добавление в список покупок](shopping-cart/_static/image3.png)

Когда пользователь щелкает **Add To Cart** ссылку на одном *ProductList.aspx* страницы или *ProductDetails.aspx* страницы, приложение будет переходить к *AddToCart.aspx* страницы и затем автоматически как *ShoppingCart.aspx* страницы. *AddToCart.aspx* страницы добавьте Выбор продукта в корзину покупок посредством вызова метода в классе ShoppingCart. *ShoppingCart.aspx* странице отобразятся продукты, которые были добавлены в корзину для покупок.

#### <a name="creating-the-shopping-cart-class"></a>Создание класс покупательской корзины

`ShoppingCart` Класс будет добавлен в отдельную папку, в приложении, таким образом, будет четкое разделение между модели (модели, папки), страницах (корневая папка) и логику (папка логикой).

1. В **обозревателе решений**, щелкните правой кнопкой мыши **WingtipToys**проект и выберите **добавить**-&gt;**новую папку**. Имя новой папки *логику*.
2. Щелкните правой кнопкой мыши *логику* папки, а затем выберите **добавить**  - &gt; **новый элемент**.
3. Добавьте новый файл класса с именем *ShoppingCartActions.cs*.
4. Замените код по умолчанию следующим кодом:   

    [!code-csharp[Main](shopping-cart/samples/sample3.cs)]

`AddToCart` Метод, который позволяет отдельные продукты, которые будут включены в зависимости от продукта в корзину для покупок `ID`. Добавления продукта в корзину, или если покупок уже содержит элемент для этого продукта, количество увеличивается.

`GetCartId` Метод возвращает покупок `ID` для пользователя. Корзина `ID` используется для отслеживания элементов, которые пользователь имеет в его корзине. Если пользователь не имеет существующих покупок `ID`, новый покупок `ID` созданные для них. Если пользователь выполнил качестве зарегистрированного пользователя для покупок `ID` равным имени пользователя. Тем не менее если пользователь не вошел в корзине `ID` задано уникальное значение (GUID). Идентификатор GUID гарантирует, что для каждого пользователя на основе сеанса создается, только один покупок.

`GetCartItems` Метод возвращает список покупок элементы корзины для покупок для пользователя. Далее в этом учебнике вы увидите, что привязка модели используется для отображения элементов покупок в корзину для покупок с помощью `GetCartItems` метод.

### <a name="creating-the-add-to-cart-functionality"></a>Создание функции Add To Cart

Как упоминалось ранее, вы создадите обработки страницу с именем *AddToCart.aspx* будет использоваться для добавления новых продуктов в корзине пользователя. Эта страница будет вызывать `AddToCart` метод в `ShoppingCart` класс, который вы только что создали. *AddToCart.aspx* страницы будет ожидать, что продукт `ID` передается в него. Этот продукт `ID` будет использоваться при вызове `AddToCart` метод `ShoppingCart` класса.

> [!NOTE] 
> 
> Изменение кода (*AddToCart.aspx.cs*) для этой страницы не страницы пользовательского интерфейса (*AddToCart.aspx*).


#### <a name="to-create-the-add-to-cart-functionality"></a>Для создания Add-To-Cart функциональные возможности:

1. В **обозревателе решений**, щелкните правой кнопкой мыши **WingtipToys**проекта, нажмите кнопку **добавить**  - &gt; **новый элемент**.  
 Откроется диалоговое окно **Добавление нового элемента**.
2. Добавление новой стандартной страницы (веб-формы) в приложение с именем *AddToCart.aspx*. 

    ![Корзина для покупок - добавить веб-форму](shopping-cart/_static/image4.png)
3. В **обозревателе решений**, щелкните правой кнопкой мыши *AddToCart.aspx* и нажмите кнопку **Просмотр кода**. *AddToCart.aspx.cs* файл кода открывается в редакторе.
4. Замените существующий код в *AddToCart.aspx.cs* кода следующим:   

    [!code-csharp[Main](shopping-cart/samples/sample4.cs)]

Когда *AddToCart.aspx* загрузить страницу, продукт `ID` извлекается из строки запроса. Далее создается и используется для вызова экземпляра класс покупательской корзины `AddToCart` метод, который был добавлен ранее в этом учебнике. `AddToCart` Метод, содержащихся в *ShoppingCartActions.cs* файла, включает логику для добавления выбранного продукта в корзину покупок или увеличить количество продукта выбранного продукта. Если продукт не была добавлена в список покупок, добавляется продукта `CartItem` таблицы базы данных. Если продукт уже был добавлен в корзину и пользователь добавляет еще один элемент того же продукта, количество продукта увеличивается в `CartItem` таблицы. Наконец, страница перенаправляет *ShoppingCart.aspx* страницы, которую вы добавите в следующем шаге, где пользователь видит обновленный список элементов в корзине.

Как упоминалось ранее, пользователь `ID` используется для определения продуктов, которые связаны с конкретным пользователем. Это `ID` добавляется в строку в `CartItem` таблицы при каждом добавлении продукта в корзину для покупок.

### <a name="creating-the-shopping-cart-ui"></a>Создание пользовательского интерфейса в корзину

*ShoppingCart.aspx* странице отобразятся продукты, которые пользователь добавил в его корзине. Кроме того, он предоставляет возможность добавлять, удалять и обновлять элементы в список покупок.

1. В **обозревателе решений**, щелкните правой кнопкой мыши **WingtipToys**, нажмите кнопку **добавить**  - &gt; **новый элемент**.  
 Откроется диалоговое окно **Добавление нового элемента**.
2. Добавление новой страницы (веб-формы), включающий главную страницу, выбрав **веб-форма, использующая главную страницу**. Имя новой страницы *ShoppingCart.aspx*.
3. Выберите **Site.Master** для присоединения главной страницы в только что созданный *.aspx* страницы.
4. В *ShoppingCart.aspx* страницы, замените существующую разметку следующей разметкой:   

    [!code-aspx[Main](shopping-cart/samples/sample5.aspx)]

*ShoppingCart.aspx* страница содержит **GridView** управления с именем `CartList`. Этот элемент управления используется привязка модели для привязки данных корзины из базы данных для **GridView** элемента управления. При задании `ItemType` свойство **GridView** управления выражение привязки данных `Item` доступен в разметку элемента управления и элемент управления становится со строго типизированными. Как упоминалось ранее в этой серии учебника, можно выбрать сведения о `Item` с помощью IntelliSense. Чтобы настроить элемент управления данных, используемый для выбора данных привязки модели, необходимо задать `SelectMethod` свойства элемента управления. В разметке выше задайте `SelectMethod` использовать метод GetShoppingCartItems, который возвращает список `CartItem` объектов. **GridView** управления данных вызывает метод в соответствующее время жизненного цикла страницы и автоматически связывает возвращаемых данных. `GetShoppingCartItems` По-прежнему необходимо добавить метод.

#### <a name="retrieving-the-shopping-cart-items"></a>Получение покупательской корзины элементов

Затем добавьте код, чтобы *ShoppingCart.aspx.cs* кода для получения и заполнения пользовательский Интерфейс корзины покупок.

1. В **обозревателе решений**, щелкните правой кнопкой мыши *ShoppingCart.aspx* и нажмите кнопку **Просмотр кода**. *ShoppingCart.aspx.cs* файл кода открывается в редакторе.
2. Замените существующий код следующим кодом:  

    [!code-csharp[Main](shopping-cart/samples/sample6.cs)]

Как было сказано выше, `GridView` вызывает элемент управления данными `GetShoppingCartItems` метод в соответствующее время жизни страницы цикла и автоматически связывает возвращаемых данных. `GetShoppingCartItems` Метод создает экземпляр `ShoppingCartActions` объекта. Затем код использует этот экземпляр, чтобы вернуть элементы в корзине, вызвав `GetCartItems` метод.

### <a name="adding-products-to-the-shopping-cart"></a>Добавление продукты в корзину покупок

При любом *ProductList.aspx* или *ProductDetails.aspx* страница отображается, пользователь сможет добавить в корзину для покупок с помощью ссылки продукт. При щелчке по ссылке приложение переходит к странице обработки с именем *AddToCart.aspx*. *AddToCart.aspx* страницы будет вызывать `AddToCart` метод `ShoppingCart` класса, который был добавлен ранее в этом учебнике.

Теперь вы добавите **добавить в тележку для закупок** ссылку, чтобы оба *ProductList.aspx* страницы и *ProductDetails.aspx* страницы. Эта ссылка будет включать продукта `ID` , извлекается из базы данных.

1. В **обозревателе решений**, найдите и откройте страницу с именем *ProductList.aspx*.
2. Добавьте разметку, выделены желтым цветом, позволяя *ProductList.aspx* страницы отображения всей страницы следующим образом:  

    [!code-aspx[Main](shopping-cart/samples/sample7.aspx?highlight=50-54)]

### <a name="testing-the-shopping-cart"></a>Тестирование в корзину для покупок

Запустите приложение, чтобы увидеть, как добавить продукты в корзину для покупок.

1. Нажмите клавишу **F5** для запуска приложения.  
 После проекта повторно создает базу данных, обозреватель и Показать *Default.aspx* страницы.
2. Выберите **автомобилей** меню навигации категории.  
 *ProductList.aspx* страница отображается только продуктами, включенных в категорию «Автомобили». 

    ![Корзина для покупок - автомобили](shopping-cart/_static/image5.png)
3. Нажмите кнопку **добавить в тележку для закупок** ссылку рядом с первым продуктом в списке (преобразовать класс car).   
 *ShoppingCart.aspx* отображается страница, показывающая выделение в корзине для покупок. 

    ![Корзина для покупок - покупок](shopping-cart/_static/image6.png)
4. Просмотр дополнительных продуктов, выбрав **плоскости** меню навигации категории.
5. Нажмите кнопку **добавить в тележку для закупок** ссылку рядом с первым продуктом в списке.  
 *ShoppingCart.aspx* страницы отображается дополнительный элемент.
6. Закройте браузер.

### <a name="calculating-and-displaying-the-order-total"></a>Вычисление и отображение итог заказа

Помимо добавления продукты в корзину покупок, мы добавим `GetTotal` метод `ShoppingCart` класса и отображение Общая сумма заказа в странице корзину для покупок.

1. В **обозревателе решений**откройте *ShoppingCartActions.cs* файла в *логику* папки.
2. Добавьте следующие `GetTotal` выделены желтым цветом, позволяя метод `ShoppingCart` класса, чтобы класс имеет следующий вид:   

    [!code-csharp[Main](shopping-cart/samples/sample8.cs?highlight=85-97)]

Во-первых, `GetTotal` метод получает идентификатор корзины для покупок для пользователя. Затем метод возвращает покупок общее путем умножения цена товара на количество продуктов для каждого продукта, перечисленного в корзине.

> [!NOTE] 
> 
> Приведенный выше код использует допускающий значение NULL тип "`int?`«. Типы, допускающие значение NULL может представлять все значения базового типа, а также как значение null. Дополнительные сведения см. в разделе [Использование допускающих значение NULL типов](https://msdn.microsoft.com/library/2cf62fcy(v=vs.110).aspx).


### <a name="modify-the-shopping-cart-display"></a>Изменение отображения покупательской корзины для покупок

Далее предстоит изменить код для *ShoppingCart.aspx* странице вызывать `GetTotal` метод и отображения эту сумму на *ShoppingCart.aspx* страницы при загрузке страницы.

1. В **обозревателе решений**, щелкните правой кнопкой мыши *ShoppingCart.aspx* и выберите **Просмотр кода**.
2. В *ShoppingCart.aspx.cs* файла, обновить `Page_Load` обработчика, добавив следующий код, выделены желтым цветом:   

    [!code-csharp[Main](shopping-cart/samples/sample9.cs?highlight=16-31)]

Когда *ShoppingCart.aspx* загрузки страницы, он загружает объект покупательской корзины, а затем извлекает покупательской корзины всего путем вызова `GetTotal` метод `ShoppingCart` класса. Если Корзина пуста, сообщение об ошибке отображается.

### <a name="testing-the-shopping-cart-total"></a>Тестирование общее покупательской корзины для покупок

Запустите приложение теперь, чтобы увидеть, как можно не только добавить продукт в корзину для покупок, но можно увидеть общее покупательской корзины для покупок.

1. Нажмите клавишу **F5** для запуска приложения.  
 Обозреватель и Показать *Default.aspx* страницы.
2. Выберите **автомобилей** меню навигации категории.
3. Нажмите кнопку **Add To Cart** ссылку рядом с первым продуктом.   
 *ShoppingCart.aspx* откроется страница с итоговой суммы заказа. 

    ![Корзина для покупок - всего покупок](shopping-cart/_static/image7.png)
4. Добавьте в корзину некоторыми другими продуктами (например, плоскости).
5. *ShoppingCart.aspx* откроется страница с обновленной общей для всех продуктов, которые были добавлены. 

    ![Корзина для покупок - несколько продуктов](shopping-cart/_static/image8.png)
6. Остановите выполняющееся приложение, закрыв окно браузера.

### <a name="adding-update-and-checkout-buttons-to-the-shopping-cart"></a>Добавление обновления и извлечения кнопок в корзину покупок

Чтобы разрешить пользователям изменять покупательской корзины, мы добавим **обновление** кнопки и **извлечение** кнопку на страницу корзину для покупок. **Извлечение** кнопка не используется заранее, до этого учебника ряда.

1. В **обозревателе решений**откройте *ShoppingCart.aspx* страницы в корне проекта веб-приложения.
2. Чтобы добавить **обновления** кнопки и **извлечения** кнопки *ShoppingCart.aspx* добавьте разметку, выделены желтым цветом, позволяя существующую разметку, как показано в Следующий код:   

    [!code-aspx[Main](shopping-cart/samples/sample10.aspx?highlight=36-45)]

Когда пользователь щелкает **обновление** кнопки `UpdateBtn_Click` будет вызван обработчик событий. Этот обработчик событий вызывает код, который вы добавите в следующем шаге.

Затем можно обновить код, содержащийся в *ShoppingCart.aspx.cs* файл перебор элементов покупок и вызовите `RemoveItem` и `UpdateItem` методы.

1. В **обозревателе решений**откройте *ShoppingCart.aspx.cs* файл в корне проекта веб-приложения.
2. Добавьте следующие разделы кода, выделяются желтым цветом, позволяя *ShoppingCart.aspx.cs* файла:   

    [!code-csharp[Main](shopping-cart/samples/sample11.cs?highlight=9-11,33,44-89)]

Когда пользователь щелкает **обновление** кнопку *ShoppingCart.aspx* страницы, вызывается метод UpdateCartItems. Метод UpdateCartItems получает обновленные значения для каждого элемента в список покупок. Затем вызывает метод UpdateCartItems `UpdateShoppingCartDatabase` метод (добавлены и описано в следующем шаге) для добавления или удаления элементов из корзины. После обновления базы данных для отражения обновления в корзину покупок **GridView** обновлен элемент управления на странице покупательской корзины, вызвав `DataBind` метод **GridView**. Кроме того Общая сумма заказа на странице покупательской корзине обновляется для отражения обновленного списка элементов.

### <a name="updating-and-removing-shopping-cart-items"></a>Обновление и удаление элементов корзину покупок

На *ShoppingCart.aspx* страницы, можно увидеть, были добавлены элементы управления для обновления количества товара и удалении элементов. Теперь можно добавьте код, который сделает эти элементы управления работают.

1. В **обозревателе решений**откройте *ShoppingCartActions.cs* файла в *логику* папки.
2. Добавьте следующий код, выделены желтым цветом, позволяя *ShoppingCartActions.cs* файл класса:   

    [!code-csharp[Main](shopping-cart/samples/sample12.cs?highlight=99-213)]

`UpdateShoppingCartDatabase` Метод с именем из `UpdateCartItems` метод *ShoppingCart.aspx.cs* страницы, содержит логику для обновления или удаления элементов из корзины. `UpdateShoppingCartDatabase` Метод выполняет итерацию всех строк в списке корзину для покупок. Если в корзину покупок элемент был помечен для удаления, или количество меньше единицы `RemoveItem` вызывается метод. В противном случае — элемент покупательской корзины проверяется для обновлений при `UpdateItem` вызывается метод. После удаления или обновления элемента корзину покупок сохраняются изменения базы данных.

`ShoppingCartUpdates` Структура используется для хранения покупательской корзины элементов. `UpdateShoppingCartDatabase` Использует метод `ShoppingCartUpdates` структуру, чтобы определить, какие-либо элементы требуется обновить или удалить.

В следующем уроке будет использовать `EmptyCart` метод, чтобы удалить покупок корзину после приобретения продуктов. Но теперь будут использовать `GetCount` метод, который только что добавленные *ShoppingCartActions.cs* файл, чтобы определить, сколько элементов в список покупок.

### <a name="adding-a-shopping-cart-counter"></a>Добавление счетчика покупательской корзины

Чтобы разрешить пользователю просмотр общее число элементов в список покупок, мы добавим счетчик для *Site.Master* страницы. Значение этого счетчика будет действовать как ссылку в корзину для покупок.

1. В **обозревателе решений**откройте *Site.Master* страницы.
2. Измените разметку, добавив ссылку на корзину покупок счетчиков, как показано желтым в раздел перехода, так выглядит следующим образом:  

    [!code-html[Main](shopping-cart/samples/sample13.html?highlight=6)]
3. Затем обновите код программной части *Site.Master.cs* файла путем добавления кода, выделены желтым цветом следующим образом:  

    [!code-csharp[Main](shopping-cart/samples/sample14.cs?highlight=11,77-84)]

Прежде чем страницы подготавливается к просмотру как HTML, `Page_PreRender` событие. В `Page_PreRender` обработчик, общее число покупательской корзине определяется путем вызова `GetCount` метод. Возвращаемое значение добавляется к `cartCount` области, включенные в разметке *Site.Master* страницы. `<span>` Теги позволяет внутренних элементов должен быть правильно подготовлен к просмотру. При отображении страницы сайта будет отображаться общее покупательской корзины для покупок. Пользователь также может щелкнуть общее покупательской корзины для покупок для отображения в корзину для покупок.

## <a name="testing-the-completed-shopping-cart"></a>Тестирование завершенного корзины

Можно запустить приложение теперь, чтобы увидеть, как можно добавить, удаления и обновления элементов в список покупок. Покупательской корзины всего будет отражать стоимость всех элементов в список покупок.

1. Нажмите клавишу **F5** для запуска приложения.  
 Браузер откроется со *Default.aspx* страницы.
2. Выберите **автомобилей** меню навигации категории.
3. Нажмите кнопку **Add To Cart** ссылку рядом с первым продуктом.   
 *ShoppingCart.aspx* откроется страница с итоговой суммы заказа.
4. Выберите **плоскости** меню навигации категории.
5. Нажмите кнопку **Add To Cart** ссылку рядом с первым продуктом.
6. Укажите количество первого элемента в корзине для 3 и выберите **удалить элемент** флажок второго элемента.<a id="a"></a>
7. Нажмите кнопку **обновление** кнопку, чтобы обновить страницу в корзину покупок и отображения новых итоговой суммы заказа. 

    ![Список покупок - обновление покупок](shopping-cart/_static/image9.png)

## <a name="summary"></a>Сводка

В этом учебнике вы создали корзины для образца приложения Wingtip Toys веб-форм. В данном руководстве используется Entity Framework Code First, заметок к данным, элементы управления строго типизированных данных и привязки модели.

Список покупок поддерживает добавление, удаление и обновление элементов, которые пользователь выбрал для покупки. Помимо реализации покупательской корзины функциональность, вы изучили отображения корзины покупок в **GridView** управления и вычисления суммы заказа.

## <a name="addition-information"></a>Дополнительную информацию

[Общие сведения о состоянии сеанса ASP.NET](https://msdn.microsoft.com/library/ms178581.aspx)

>[!div class="step-by-step"]
[Назад](display_data_items_and_details.md)
[Вперед](checkout-and-payment-with-paypal.md)
