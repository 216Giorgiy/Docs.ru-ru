---
uid: web-forms/overview/getting-started/hands-on-labs/whats-new-in-web-forms-in-aspnet-45
title: "Новые возможности в веб-форм в ASP.NET 4.5 | Документы Microsoft"
author: rick-anderson
description: "В новой версии веб-форм ASP.NET представлен ряд улучшений, ориентированы на улучшение взаимодействия с пользователем при работе с данными. В предыдущих версиях..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/18/2013
ms.topic: article
ms.assetid: 0a1f88bd-97da-4ed1-86f1-605199dc75a4
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/getting-started/hands-on-labs/whats-new-in-web-forms-in-aspnet-45
msc.type: authoredcontent
ms.openlocfilehash: 560f949f79be8ba4936e4a6f8ee8ee32ef15acbf
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2018
---
<a name="whats-new-in-web-forms-in-aspnet-45"></a>Новые возможности веб-форм в ASP.NET 4.5
====================
по [Web лагеря команды](https://twitter.com/webcamps)

> В новой версии веб-форм ASP.NET представлен ряд улучшений, ориентированы на улучшение взаимодействия с пользователем при работе с данными.
> 
> В предыдущих версиях веб-формы, при использовании привязки данных для порождения значение элемента объекта вы использовали Bind() или Eval() выражения привязки данных. В новой версии ASP.NET имеют возможность объявлять, какие типы данных элемент управления будет привязан к с помощью новое свойство ItemType. Установка этого свойства позволит использовать строго типизированную переменную для получения всеми преимуществами возможности разработки Visual Studio, такие как IntelliSense, элемент навигации и проверки во время компиляции.
> 
> С элементами управления с привязкой к данным теперь можно также указать пользовательские методы для выбора, обновления, удаления и вставки данных, упрощая взаимодействие элементов управления на странице и логику приложения. Кроме того были добавлены возможности привязки модели ASP.NET, это означает, что вы можете сопоставить данные со страницы непосредственно в параметры типа для метода.
> 
> Проверка пользовательского ввода должен быть проще с последней версией веб-форм. Теперь можно снабдить классами модели с атрибутами проверки **System.ComponentModel.DataAnnotations** пространство имен и запрос, который управляет вашего сайта проверки введенных данных с помощью этих сведений. Проверка на стороне клиента в веб-форм теперь интегрирован с jQuery, предоставляя очистки код на стороне клиента и возможностями ненавязчивого JavaScript.
> 
> В области проверки запроса для упрощения выборочно отключить проверку запросов для конкретной части приложения или считывании недействительным запрос данных внесены изменения.
> 
> Некоторые были внесены усовершенствования для веб-форм серверные элементы управления, чтобы воспользоваться преимуществами новых функций HTML5:
> 
> - Свойство TextMode элемента управления TextBox обновлен для поддержки новых типов входных HTML5 как электронной почты, datetime и т. д.
> - Элемент управления FileUpload теперь поддерживает несколько передачи файлов с помощью браузеров, поддерживающих эту функцию HTML5.
> - Проверяющие элементы управления теперь поддержки проверки HTML5 входных элементов.
> - Новые элементы HTML5 атрибутами, которые представляют URL-адрес теперь поддерживает runat =&quot;сервера&quot;. В результате можно использовать ASP.NET соглашения в пути URL-адресов как ~ оператор для представления корня приложения (например, &lt;видео runat =&quot;сервера&quot; src =&quot;~/myVideo.wmv&quot; &gt; &lt;/видео&gt;).
> - Для поддержки полей ввода учета HTML5 исправлена управления UpdatePanel.
> 
> На портале официальный ASP.NET можно найти дополнительные примеры новых возможностей в веб-форм ASP.NET 4.5: [новые возможности в ASP.NET 4.5 и Visual Studio 2012](../../../../whitepapers/whats-new-in-aspnet-45-and-visual-studio-2012.md#_Toc318097385)
> 
> Все образцы кода и фрагменты кода включаются в Web лагеря комплект учебных материалов, доступных в [https://go.microsoft.com/fwlink/?LinkID=248297&clcid=0x409](https://go.microsoft.com/fwlink/?LinkID=248297&clcid=0x409).


<a id="Objectives"></a>
### <a name="objectives"></a>Цели

В этой практической вы узнаете, как:

- Использовать строго типизированного выражения привязки данных
- Использовать новые возможности привязки модели веб-форм
- Использование поставщиков значений для сопоставления страницы данных методам кода
- Использование заметок данных для проверки ввода данных
- Принимать advange из unobstrusive проверки на стороне клиента с помощью jQuery в веб-форм
- Реализуйте гранулярная проверка запросов
- Реализации асинхронной обработки страницы в веб-форм

<a id="Prerequisites"></a>
### <a name="prerequisites"></a>Предварительные требования

Необходимо иметь следующие элементы для этой лаборатории.

- [Microsoft Visual Studio Express 2012 для Web](https://www.microsoft.com/visualstudio/eng/products/visual-studio-express-for-web) или выше (чтение [приложение A](#AppendixA) инструкции по его установке).

<a id="Setup"></a>
### <a name="setup"></a>Установка

**Установка фрагменты кода**

Для удобства большая часть кода, который вы планируете управлять вдоль этой лаборатории доступна как фрагменты кода Visual Studio. Чтобы установить фрагменты кода запуска **.\Source\Setup\CodeSnippets.vsi** файла.

Если вы не знакомы с фрагментов кода Visual Studio и хотите узнать о способах их использования, можно ссылаться в приложение из этого документа &quot; [фрагменты кода с помощью приложение C:](#AppendixC)&quot;.

<a id="Exercises"></a>
## <a name="exercises"></a>Упражнения

Данная практическая работа включает следующие упражнения:

1. [Упражнение 1: Привязки в веб-форм ASP.NET модели](#Exercise1)
2. [Упражнение 2: Проверка данных](#Exercise2)
3. [Упражнение 3: Асинхронной обработки страницы в ASP.NET Web Forms](#Exercise3)

> [!NOTE]
> Каждого упражнения сопровождается **окончания** папку, содержащую полученное в результате решение, должен быть получен после завершения выполнения упражнений. Это решение можно использовать как руководство, если вам нужна дополнительная помощь при выполнении упражнений.


Предполагаемое время для выполнения этого занятия: **60 минут**.

<a id="Exercise1"></a>

<a id="Exercise_1_Model_Binding_in_ASPNET_Web_Forms"></a>
### <a name="exercise-1-model-binding-in-aspnet-web-forms"></a>Упражнение 1: Привязки в веб-форм ASP.NET модели

В новой версии веб-форм ASP.NET появился ряд улучшений, ориентированы на улучшение качества при работе с данными. В рамках этого упражнения будут сведения о строго типизированные элементы управления данными и привязки модели.

<a id="Task_1_-_Using_Strongly-Typed_Data-Bindings"></a>
#### <a name="task-1---using-strongly-typed-data-bindings"></a>Задача 1 — с помощью привязки данных в строго типизированный

В этой задаче будет обнаруживать новых строго типизированных привязок в ASP.NET 4.5.

1. Откройте **начать** решений, расположенный **источника или сервера Ex1-ModelBinding/Begin/** папки.

    1. Необходимо загрузить несколько отсутствующих пакетов NuGet прежде чем продолжить. Чтобы сделать это, нажмите кнопку **проекта** и выбрать пункт **управление пакетами NuGet**.
    2. В **управление пакетами NuGet** диалоговое окно, нажмите кнопку **восстановить** чтобы скачивать отсутствующие пакеты.
    3. Наконец, постройте решение, нажав кнопку **построения** | **построить решение**.

    > [!NOTE]
    > Одним из преимуществ использования NuGet является у вас не указан для отправки всех библиотек в вашем проекте, уменьшив размер проекта. С помощью NuGet Power Tools указав версий пакета в файле Packages.config можно для загрузки всех необходимых библиотек первый раз, при запуске проекта. Вот почему необходимо будет выполнить эти шаги после открытия существующего решения в этой лаборатории.
2. Откройте **Customers.aspx** страницы. Место дополнительного списка в главном элементе управления и включать управления повторителем внутри для вывода каждого клиента. Задайте имя повторителя **customersRepeater** как показано в следующем коде.

    В предыдущих версиях веб-формы при использовании привязки данных для порождения значение члена объекта вы привязки данных, используется выражение привязки данных, наряду с вызова метода Eval, передавая имя члена как строка.

    Во время выполнения эти вызовы Eval будет использовать отражение для объекта, к которому имеется привязка для чтения значение элемента с заданным именем и отображения результата в формате HTML. Этот подход упрощает очень для привязки данных для произвольного unshaped данных.

    К сожалению Вы потеряете доступ ко многим функциям прекрасные возможности времени разработки в Visual Studio, включая IntelliSense для имен членов, поддержка навигации (такие как перейти к определению) и проверки во время компиляции.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample1.aspx)]
3. Откройте **Customers.aspx.cs** файла.
4. Добавьте следующий код с помощью инструкции.

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample2.cs)]
5. В **страницы\_нагрузки** метод, добавьте код для заполнения повторителя со списком клиентов.

    (Фрагмент - кода *веб-источнику данных клиентов привязки лаборатории - Ex01 - форм*)

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample3.cs)]

    В решении используются EntityFramework вместе с CodeFirst для создания и доступа к базе данных. В следующем коде customersRepeater привязан к материализованные запрос, возвращающий всех клиентов из базы данных.
6. Нажмите клавишу **F5** для запуска решения и перейдите к **клиентов** страницу, чтобы просмотреть повторителя в действии. Как решение использует CodeFirst, базы данных будет создана и заполняется в локальном экземпляре SQL Express, при запуске приложения.

    ![Со списком клиентов с повторитель](whats-new-in-web-forms-in-aspnet-45/_static/image1.png "со списком клиентов с повторитель")

    *Со списком клиентов с повторитель*

    > [!NOTE]
    > В Visual Studio 2012 IIS Express является сервер по умолчанию веб-разработки.
7. Закройте окно браузера и вернитесь в Visual Studio.
8. Теперь замените реализацию использовать строго типизированный привязки. Откройте **Customers.aspx** страницы и используйте новую **ItemType** атрибута в повторителя задаваемое **клиента** с типом привязки.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample4.aspx)]

    Свойство ItemType позволяет объявлять какой тип данных элемента управления необходимо привязать к и позволяет использовать строго типизированные привязки внутри элемента управления с привязкой к данным.
9. Замените содержимое следующим кодом ItemTemplate.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample5.aspx)]

    Один из недостатков перечисленных выше методов является вызовы Eval() и Bind() позднего связывания - это означает, что при передаче строк для представления имен свойств. Это означает, что для имен членов, поддержку для навигации по коду (например, перейти к определению), а также поддержку проверки во время компиляции не получить доступ к Intellisense.

    Свойство ItemType, две новые типизированные переменные должны быть созданы в область выражения привязки данных: **элемент** и **BindItem**. Можно использовать эти строго типизированные переменные в выражениях привязки данных и получаете все преимущества среду разработки Visual Studio.

    &quot; **:** &quot; В выражении будут автоматически HTML-кодирование вывода во избежание проблем безопасности (например, межсайтовых атак с использованием сценариев). Такая запись была доступна с момента .NET 4, для записи ответа, но теперь доступен и в выражениях привязки данных.

    > [!NOTE]
    > Члену элемента работает односторонние привязки. Если вы хотите выполнить двустороннюю привязку использования **BindItem** член.

    ![Поддержку IntelliSense в строго типизированных привязки](whats-new-in-web-forms-in-aspnet-45/_static/image2.png "поддержку IntelliSense в строго типизированных привязки")

    *Поддержка IntelliSense в строго типизированных привязки*
10. Нажмите клавишу **F5** для запуска решения и перейдите к странице клиенты, убедитесь, что изменения работать должным образом.

    ![Перечисление сведения о клиенте](whats-new-in-web-forms-in-aspnet-45/_static/image3.png "сведения клиента списка")

    *Сведения о вхождении клиента*
11. Закройте окно браузера и вернитесь в Visual Studio.

<a id="Task_2_-_Introducing_Model_Binding_in_Web_Forms"></a>
#### <a name="task-2---introducing-model-binding-in-web-forms"></a>Задача 2 — Общие сведения о модели привязки в веб-форм

В предыдущих версиях веб-форм ASP.NET Если вы хотите выполнять двухстороннюю привязку данных, как получение и обновление данных, необходимо использовать объект источника данных. Это может быть объекта источника данных, источник данных SQL, источника данных LINQ и т. д. Однако если сценарию требуется пользовательский код для обработки данных, необходимые для использования источника данных объекта, и это оперативный некоторые недостатки. Например необходимыми для избежания сложных типов и необходимые для обработки исключений при выполнении логику проверки.

В новой версии веб-форм ASP.NET с привязкой к данным элементы управления поддерживают привязки модели. Это означает, что можно указать выберите, обновлять, вставке и удалении методы непосредственно в элементе управления с привязкой к данным для вызова логики из файла кода или из другого класса.

Дополнительные сведения об этом, вы воспользуетесь GridView для приведены категории продукта, с использованием нового **SelectMethod** атрибута. Этот атрибут позволяет указать метод для доступа к данным GridView.

1. Откройте **Products.aspx** страницы и включают **GridView**. Настройте GridView, как показано ниже, использование строго типизированных привязки и включить сортировку и разбиение по страницам.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample6.aspx)]
2. Используйте новую **SelectMethod** атрибута для настройки GridView для вызова **GetCategories** метод для выбора данных.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample7.aspx)]
3. Откройте **Products.aspx.cs** кода и добавьте следующие операторы using.

    (Фрагмент - кода *веб-пространства имен форм лаборатории - Ex01 -*)

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample8.cs)]
4. Добавьте закрытый элемент в **продуктов** класса и назначить новый экземпляр **ProductsContext**. Это свойство будет хранить контекста данных Entity Framework, которая предоставляет возможность подключения к базе данных.

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample9.cs)]
5. Создание **GetCategories** метод, чтобы получить список категорий с помощью LINQ. Этот запрос будет содержать **продуктов** свойство так, чтобы GridView может показывать объем продуктов в каждой категории. Обратите внимание, что этот метод возвращает необработанный объект IQueryable, представляющие запрос был выполнен позднее жизненного цикла страницы.

    (Фрагмент - кода *веб-форм GetCategories лаборатории - Ex01 -*)

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample10.cs)]

    > [!NOTE]
    > В предыдущих версиях веб-форм ASP.NET Включение сортировку и разбиение по страницам использовать собственную логику репозитория в контексте объекта источника данных необходимо написать собственный код и получать все необходимые параметры. Теперь, как методы привязки данных могут возвращать IQueryable, и это представляет запрос по-прежнему должны быть выполнены ASP.NET заняться изменение запроса для добавления правильную сортировку и разбиение на страницы параметров.
6. Нажмите клавишу **F5** Начало отладки сайта и перейти на страницу продуктов. Вы увидите, что категорий, возвращенный методом GetCategories заполняется GridView.

    ![Заполнение элемента управления GridView с использованием привязки модели](whats-new-in-web-forms-in-aspnet-45/_static/image4.png "заполнение элемента управления GridView с использованием привязки модели")

    *Заполнение элемента управления GridView с использованием привязки модели*
7. Нажмите клавишу **SHIFT**+**F5** остановить отладку.

<a id="Task_3_-_Value_Providers_in_Model_Binding"></a>
#### <a name="task-3---value-providers-in-model-binding"></a>Задача 3 - поставщики значений в привязки модели

Привязка модели не только позволяет указать настраиваемые методы для работы с данными непосредственно в элементе управления с привязкой к данным, но также позволяет сопоставить данные на странице в параметры из этих методов. Для параметра метода атрибуты поставщика значение можно использовать для указания источника данных для значения. Пример:

- Элементы управления на странице
- Значения строки запроса
- Просмотр данных
- Состояние сеанса
- Файлы cookie
- Отправленной формы данных
- Состояние представления
- Также поддерживаются поставщиках пользовательских значений

При использовании ASP.NET MVC 4, вы заметите, что аналогично поддержку привязки модели. На самом деле эти функции были взяты из ASP.NET MVC и перемещают **System.Web** сборки можно также использовать их на веб-форм.

В этой задаче будет обновлена GridView для фильтрации результатов по объему продуктов в каждой категории получает параметр фильтра с использованием привязки модели.

1. Вернитесь к **Products.aspx** страницы.
2. В верхней части GridView, добавьте **метка** и **ComboBox** для выбора количества продуктов в каждой категории, как показано ниже.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample11.aspx)]
3. Добавить **EmptyDataTemplate** к GridView, чтобы показать сообщение при наличии категории не с выбранного количества продуктов.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample12.aspx)]
4. Откройте **Products.aspx.cs** кода и добавьте следующий код с помощью инструкции.

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample13.cs)]
5. Изменить **GetCategories** способ получения целое **minProductsCount** аргумент и фильтрации возвращаемых результатов. Для этого замените метод следующий код.

    (Фрагмент - кода *веб-форм лаборатории - Ex01 - GetCategories 2*)

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample14.cs)]

    Новый **[элемент управления]** атрибут **minProductsCount** аргумент позволит узнать, его значение должны быть заполнены с помощью элемента управления на странице ASP.NET. ASP.NET будет выглядеть для любого элемента управления, соответствующие данному имени аргумента (minProductsCount) и выполнить необходимое сопоставление и преобразования для заполнения параметра значение элемента управления.

    Кроме того атрибут предоставляет перегруженный конструктор, можно задать элемент управления, с которого следует получить значение.

    > [!NOTE]
    > Одна из целей возможности привязки данных — чтобы уменьшить объем кода, разработанный для взаимодействия страницы. Помимо поставщика значений [элемент управления] в параметрах метода можно использовать других поставщиков привязки модели. Некоторые из них перечислены во введении задачи.
6. Нажмите клавишу **F5** Начало отладки сайта и перейти на страницу продуктов. Выберите количество продуктов в раскрывающемся списке и обратите внимание на то, как теперь обновляется GridView.

    ![Фильтрация GridView с помощью раскрывающегося списка значение](whats-new-in-web-forms-in-aspnet-45/_static/image5.png "фильтрации GridView с значение раскрывающегося списка")

    *Фильтрация GridView с значение раскрывающегося списка*
7. Остановите отладку.

<a id="Task_4_-_Using_Model_Binding_for_Filtering"></a>
#### <a name="task-4---using-model-binding-for-filtering"></a>Задача 4 - с помощью модели привязки для фильтрации.

В этой задаче вы добавите второго дочернего GridView для отображения продуктов в выбранной категории.

1. Откройте **Products.aspx** странице и обновить категории GridView автоматически создает кнопка выбора.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample15.aspx)]
2. Добавьте второй **GridView** с именем **productsGrid** внизу. Задать **ItemType** для **WebFormsLab.Model.Product**, **DataKeyNames** для **ProductId** и **SelectMethod**  для **GetProducts**. Задать **AutoGenerateColumns** для **false** и добавление столбцов ProductId, ProductName, описание и цена.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample16.aspx)]
3. Откройте **Products.aspx.cs** файл кода программной части. Реализуйте **GetProducts** метод для получения идентификатора категории из категории GridView и фильтрации продуктов. Привязка модели будет задать с помощью выбранной строки в значение параметра **categoriesGrid**. Поскольку имя аргумента и имя элемента управления не совпадают, следует указать имя элемента управления в поставщике значений элемента управления.

    (Фрагмент - кода *веб-форм лаборатории - Ex01 - GetProducts*)

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample17.cs)]

    > [!NOTE]
    > Этот подход упрощает модульного тестирования этих методов. В контексте модульного теста, где веб-формы не выполняется, атрибут [элемент управления] не выполняет какие-либо действия.
4. Откройте **Products.aspx** страницы и найдите продуктов GridView. Обновление продуктов GridView, чтобы показать ссылки для изменения выбранного продукта.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample18.aspx)]
5. Откройте **ProductDetails.aspx** страница кода и замените **SelectProduct** метод следующим кодом.

    (Фрагмент - кода *веб-форм лаборатории - Ex01 - SelectProduct метод*)

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample19.cs)]

    > [!NOTE]
    > Обратите внимание, что **[запроса]** атрибут используется для заполнения параметра метода на основе параметра productId в строке запроса.
6. Нажмите клавишу **F5** Начало отладки сайта и перейти на страницу продуктов. Выберите одну из категорий из категорий GridView и обратите внимание, что продукты GridView обновляется.

    ![Отображаются продукты из выбранной категории](whats-new-in-web-forms-in-aspnet-45/_static/image6.png "продуктами из выбранной категории")

    *Отображаются продукты из выбранной категории*
7. Нажмите кнопку **представление** ссылки продукт, чтобы открыть страницу ProductDetails.aspx.

    Обратите внимание, что страница извлекает продукт с SelectMethod, с помощью параметра productId из строки запроса.

    ![Просмотр сведений о продукции](whats-new-in-web-forms-in-aspnet-45/_static/image7.png "Просмотр сведений о продукции")

    *Просмотр сведений о продукции*

    > [!NOTE]
    > В следующем упражнении будет реализована возможность введите описание в формате HTML.

<a id="Task_5_-_Using_Model_Binding_for_Update_Operations"></a>
#### <a name="task-5---using-model-binding-for-update-operations"></a>Задача 5 - с помощью модели привязки для операции обновления

В предыдущей задаче используется главным образом для выбора данных привязки модели, в этой задаче вы узнаете, как использовать привязку модели в операциях обновления.

Потребуется обновить категории GridView, в котором пользователь может обновить категории.

1. Откройте **Products.aspx** странице и обновить категории GridView кнопка правки автоматически создает и использовать новую **UpdateMethod** атрибут для указания **UpdateCategory**метод обновления выбранного элемента.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample20.aspx)]

    Атрибут DataKeyNames в GridView определения, которые являются членами, которые уникальным образом идентифицировать объект привязкой модели и таким образом, которые являются параметры, метод update по крайней мере должен получать.
2. Откройте **Products.aspx.cs** файл кода программной части и реализуйте **UpdateCategory** метод. Метод должен получать идентификатор категории для загрузки текущей категории, заполните значения из GridView и затем обновить категорию.

    (Фрагмент - кода *веб-форм лаборатории - Ex01 - UpdateCategory*)

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample21.cs)]

    Новый **TryUpdateModel** метод в классе страницы отвечает по добавлению объект модели, используя значения из элементов управления на странице. В этом случае заменит обновленные значения из текущей строки GridView, редактируемого в **категории** объекта.

    > [!NOTE]
    > Решается объясняется использование ModelState.IsValid для проверки данных, введенные пользователем при изменении объекта.
3. Запустите сайт и перейдите на страницу продуктов. Измените категорию. Введите новое имя и нажмите кнопку **обновление** для сохранения изменений.

    ![Редактирование категории](whats-new-in-web-forms-in-aspnet-45/_static/image8.png "редактирование категории")

    *Редактирование категории*

<a id="Exercise2"></a>

<a id="Exercise_2_Data_Validation"></a>
### <a name="exercise-2-data-validation"></a>Упражнение 2: Проверка данных

В этом упражнении вы узнаете о новых функциях проверки данных в ASP.NET 4.5. Извлечет новые возможности ненавязчивой проверки в веб-форм. И, наконец, вы узнаете, как включить или отключить проверку запросов на отдельные элементы управления на странице будет использовать заметок к данным в классах модель приложения для проверки ввода данных

<a id="Task_1_-_Unobtrusive_Validation"></a>
#### <a name="task-1---unobtrusive-validation"></a>Задача 1 - ненавязчивой проверки

Формы со сложными данными, включая проверяющие элементы управления, как правило, для создания слишком большого объема кода JavaScript на странице, которую может представлять 60% кода. С ненавязчивого включена проверка HTML-код будет выглядеть более понятные и упорядочить свое.

В этом разделе вы включите ненавязчивой проверки в ASP.NET для сравнения HTML-код, сгенерированный конструктором обеих конфигураций.

1. Откройте **Visual Studio 2012** и откройте **начать** решение находится в **Source\Ex2 Validation\Begin** папку части этой лаборатории. Кроме того можно продолжить работу с существующие решения в предыдущем упражнении.

    1. Если вы открыли указанных **начать** решение, необходимо будет загрузить несколько отсутствующих пакетов NuGet прежде чем продолжить. Для этого в обозревателе решений щелкните **WebFormsLab** проекта **управление пакетами NuGet**.
    2. В **управление пакетами NuGet** диалоговое окно, нажмите кнопку **восстановить** чтобы скачивать отсутствующие пакеты.
    3. Наконец, постройте решение, нажав кнопку **построения** | **построить решение**.

    > [!NOTE]
    > Одним из преимуществ использования NuGet является у вас не указан для отправки всех библиотек в вашем проекте, уменьшив размер проекта. С помощью NuGet Power Tools указав версий пакета в файле Packages.config можно для загрузки всех необходимых библиотек первый раз, при запуске проекта. Вот почему необходимо будет выполнить эти шаги после открытия существующего решения в этой лаборатории.
2. Нажмите клавишу **F5** для запуска веб-приложения. Перейдите к клиентам и нажмите кнопку **добавления нового клиента** ссылку.
3. Щелкните правой кнопкой мыши на странице «обозреватель» и выберите **источник** параметр, чтобы открыть HTML-код, создаваемые приложением.

    ![Отображение страницы HTML-код](whats-new-in-web-forms-in-aspnet-45/_static/image9.png "отображении страницы HTML-код")

    *Отображение страницы HTML-код*
4. Прокрутите страницу исходный код и обратите внимание, что ASP.NET помещает JavaScript кода и данных, проверяющие элементы управления на странице для выполнения проверок и Показать список ошибок.

    ![Проверка кода JavaScript в страницу CustomerDetails](whats-new-in-web-forms-in-aspnet-45/_static/image10.png "код JavaScript для проверки CustomerDetails страницы")

    *Проверка кода JavaScript в CustomerDetails страницы*
5. Закройте окно браузера и вернитесь в Visual Studio.
6. Теперь вы включите ненавязчивой проверки. Откройте **Web.Config** и найдите **ValidationSettings:UnobtrusiveValidationMode** ключа в **AppSettings** раздел **.** Установите значение ключа **WebForms**.

    [!code-xml[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample22.xml)]

    > [!NOTE]
    > Это свойство можно также задать &quot; **страницы\_нагрузки** &quot; события в случае потребуется включить ненавязчивой проверки только для некоторых страниц.
7. Откройте **CustomerDetails.aspx** и нажмите клавишу **F5** для запуска веб-приложения.
8. Открытие средств разработчика IE, нажмите клавишу F12. После открытия средства разработчика, перейдите на вкладку сценария. Выберите **CustomerDetails.aspx** из меню и примите Обратите внимание, что скрипты должны запускаться jQuery на странице были загружены в браузере с локального сайта.

    ![Загрузка jQuery JavaScript файлы непосредственно с локального сервера IIS](whats-new-in-web-forms-in-aspnet-45/_static/image11.png "загрузке jQuery JavaScript файлы непосредственно с локального сервера IIS")

    *Загрузка файлов JavaScript jQuery непосредственно с локального сервера IIS*
9. Закройте браузер, чтобы вернуться в Visual Studio. Откройте **Site.Master** еще раз и найдите **ScriptManager**. Добавьте атрибут **EnableCdn** свойству значение **True**. Это заставит jQuery для загрузки из документации по URL-адреса, а не с URL-адрес локального узла.
10. Откройте **CustomerDetails.aspx** в Visual Studio. Нажмите клавишу F5 для запуска сайта. Как только откроется браузер Internet Explorer, нажмите клавишу F12, чтобы открыть средства разработчика. Выберите **сценарий** вкладку, а затем просмотрите раскрывающегося списка. Обратите внимание, что файлы JavaScript jQuery больше не загружаются с локального сайта, но вместо из сети CDN jQuery.

    ![Загрузка jQuery JavaScript файлов из CDN](whats-new-in-web-forms-in-aspnet-45/_static/image12.png "jQuery JavaScript загрузку файлов из CDN")

    *Загрузка файлов jQuery JavaScript из CDN*
11. Откройте исходный код страницы HTML, снова с помощью параметра исходного представления в браузере. Обратите внимание, что путем включения ненавязчивого проверки ASP.NET заменены введенного кода JavaScript данные - \*атрибуты.

    ![Код проверки ненавязчивого](whats-new-in-web-forms-in-aspnet-45/_static/image13.png "ненавязчивой проверки кода")

    *Код проверки ненавязчивого*

    > [!NOTE]
    > В этом примере показано, как с помощью заметок к данным сводки проверки была упрощена, чтобы несколько HTML и JavaScript строк. Ранее без проверки ненавязчивого, дополнительные проверяющие элементы управления, которые вы добавляете, тем больше код проверки JavaScript будет увеличиваться.

<a id="Task_2_-_Validating_the_Model_with_Data_Annotations"></a>
#### <a name="task-2---validating-the-model-with-data-annotations"></a>Задача 2 - Проверка модели с помощью заметок к данным

ASP.NET 4.5 появился проверки данных заметок для веб-форм. Вместо проверяющий элемент управления для каждого входного параметра, можно определить ограничения в классах модели и использовать их во всех веб-приложения. В этом разделе вы узнаете, как использовать заметки данных для проверки клиента форму создания или изменения.

1. Откройте **CustomerDetail.aspx** страницы. Обратите внимание, что клиент сначала имя и отчество в **EditItemTemplate** и **InsertItemTemplate** разделы проверяются с помощью элементов управления RequiredFieldValidator. Каждый проверяющий элемент управления связан с определенного условия, поэтому необходимо включить столько проверяющие элементы управления в качестве условия для проверки.
2. Добавление заметок к данным для проверки модели классу "Customer". Откройте **Customer.cs** класса в **модели** папки и *декорировать* каждого свойства, используя атрибуты данных заметок.

    (Фрагмент - кода *веб-форм заметок к данным лаборатории - Ex02 -*)

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample23.cs)]

    > [!NOTE]
    > .NET framework 4.5 расширила коллекции заметок существующих данных. Ниже приведено несколько заметок к данным можно использовать: [CreditCard] [Phone] [EmailAddress] [диапазон] [сравнение], [Url] [FileExtensions], [Required], [ключ], [регулярное выражение].
    > 
    > Некоторые примеры использования:
    > 
    > [ключ]: Specifies that an attribute is the unique identifier
    > 
    > [Range(0.4, 0.5, ErrorMessage=&quot;{Write an error message}&quot;]: Double range
    > 
    > [EmailAddress(ErrorMessage=&quot;Invalid Email&quot;), MaxLength(56)]: Two annotations in the same line.
    > 
    > Можно также определить собственные сообщения об ошибках в рамках каждого атрибута.
3. Откройте **CustomerDetails.aspx** и удалите все RequiredFieldvalidators для поля имени и фамилии в EditItemTemplate и InsertItemTemplate разделов управления FormView.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample24.aspx)]

    > [!NOTE]
    > Одно из преимуществ использования заметок к данным — что логику проверки не дублируются на страницах приложения. Он определяется один раз в модели и использовать его на всех страницах приложения, которые позволяют управлять данными.
4. Откройте **CustomerDetails.aspx** кода и найдите метод SaveCustomer. Этот метод вызывается при вставке нового клиента и получает параметр клиента из значения элемента управления FormView. Если сопоставление элементов управления страницы истек период объект параметра, будет выполнен в ASP.NET модели проверку все заметки к данным в атрибуты и заполнения словарь ModelState ошибок, если таковые имеются.

    ModelState.IsValid будет возвращать только значение true, если все поля в модели являются действительными после выполнения проверки.

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample25.cs)]
5. Добавить **ValidationSummary** элемента управления в конце CustomerDetails страницу, чтобы показать список ошибок модели.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample26.aspx)]

    **ShowModelStateErrors** это новое свойство для элемента управления ValidationSummary элемент управления, если задано значение **true**, элемент управления будет отображать ошибки из словаря ModelState. Эти ошибки возникают из проверки данных заметок.
6. Нажмите клавишу **F5** для запуска веб-приложения. Заполните форму с некоторые ошибочные значения и нажмите кнопку **Сохранить** для выполнения проверки. Обратите внимание, ошибка сводки в нижней.

    ![Проверка с помощью заметок к данным](whats-new-in-web-forms-in-aspnet-45/_static/image14.png "проверка с помощью заметок к данным")

    *Проверка с помощью заметок к данным*

<a id="Task_3_-_Handling_Custom_Database_Errors_with_ModelState"></a>
#### <a name="task-3---handling-custom-database-errors-with-modelstate"></a>Задача 3. Обработка ошибок пользовательской базы данных с ModelState

В предыдущей версии Web Forms обработка ошибок базы данных, например, слишком длинная строка или нарушения уникальных ключей может включать создание исключений в коде репозитория, а затем на обработке исключений в коде программной для отображения ошибки. Большой объем кода, необходимо сделать что-либо относительно проста.

В Web Forms 4.5 объект ModelState используется для отображения ошибок на страницу из модели или из базы данных, согласованным образом.

В этой задаче будет добавлен код для правильной обработки исключений базы данных и отображать соответствующее сообщение для пользователя, используя объект ModelState.

1. Пока приложение выполняется, попробуйте обновить имя категории, с помощью повторяющиеся значения.

    ![Обновление с повторяющееся имя категории](whats-new-in-web-forms-in-aspnet-45/_static/image15.png "обновление с повторяющееся имя категории")

    *Обновление с повторяющееся имя категории*

    Обратите внимание, что исключение из-за &quot;уникальный&quot; ограничение **CategoryName** столбца.

    ![Исключение для категории повторяющиеся имена](whats-new-in-web-forms-in-aspnet-45/_static/image16.png "исключение для категории повторяющиеся имена")

    *Исключение для категории повторяющиеся имена*
2. Остановите отладку. В **Products.aspx.cs** файл кода, обновление **UpdateCategory** метод для обработки исключения, создаваемые базы данных. Метод SaveChanges() вызова и добавить ошибку, которая **ModelState** объекта.

    Новый **TryUpdateModel** метод обновляет объект категории, полученных из базы данных, с помощью формы данных, предоставленных пользователем.

    (Фрагмент - кода *веб-форм лаборатории - Ex02 - UpdateCategory обрабатывают ошибки*)

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample27.cs)]

    > [!NOTE]
    > В идеальном случае пришлось бы определить причину DbUpdateException и проверьте, является ли основной причины нарушения ограничения уникального ключа.
3. Откройте **Products.aspx** и добавьте **ValidationSummary** управления под категории GridView для отображения списка ошибок модели.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample28.aspx)]
4. Запустите сайт и перейдите на страницу продуктов. Попробуйте обновить имя категории, повторяющиеся значения.

    Обратите внимание, что исключение было обработано и появляется сообщение об ошибке в **ValidationSummary** элемента управления.

    ![Повторяющиеся ошибки категории](whats-new-in-web-forms-in-aspnet-45/_static/image17.png "дублируется категории ошибок")

    *Повторяющийся категории ошибок*

<a id="Task_4_-_Request_Validation_in_ASPNET_Web_Forms_45"></a>
#### <a name="task-4---request-validation-in-aspnet-web-forms-45"></a>Задача 4. запрос проверки в веб-форм ASP.NET 4.5

Средство проверки запросов в ASP.NET обеспечивает определенный уровень защиты по умолчанию от атак межсайтовых сценариев (XSS). В предыдущих версиях ASP.NET проверка запроса была включена по умолчанию и может отсутствовать только для всей страницы. В новой версии веб-форм ASP.NET теперь отключить проверку запросов для одного элемента управления, выполняют проверку отложенной запросов или доступа к данным непроверенный запрос (Будьте внимательны при этом!).

1. Нажмите клавишу **Ctrl + F5** запустить без отладки веб-сайт и перейти на страницу продуктов. Выберите категорию, а затем нажмите кнопку **изменить** ссылку на любой из этих продуктов.
2. Введите описание, содержащая потенциально опасное содержимое, например в том числе теги HTML. Легко отследить исключение из-за проверку запросов.

    ![Изменяет продукт, потенциально опасное содержимое](whats-new-in-web-forms-in-aspnet-45/_static/image18.png "редактирование продукт с потенциально опасное содержимое")

    *Изменяет продукт, потенциально опасное содержимое*

    ![Исключение из-за проверки запроса](whats-new-in-web-forms-in-aspnet-45/_static/image19.png "исключение из-за проверку запросов")

    *Исключение из-за проверку запросов*
3. Закройте страницу, а в Visual Studio нажмите клавишу **SHIFT + F5** остановить отладку.
4. Откройте **ProductDetails.aspx** страницы и найдите **описание** текстового поля.
5. Добавьте новые **ValidateRequestMode** свойства текстового поля и присвойте ему значение **отключено**.

    Новый **ValidateRequestMode** атрибут позволяет отключать проверку запросов детализацией для каждого элемента управления. Это полезно в том случае, если вы хотите использовать входных данных, может получить код HTML, но сохранить проверки работы для остальной части страницы.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample29.aspx)]
6. Нажмите клавишу **F5** для запуска веб-приложения. Снова откройте страницы правки продукта и полное описание продуктов, в том числе теги HTML. Обратите внимание, что теперь можно добавить HTML-содержимое для описания.

    ![Проверка отключены для описания продукта запросов](whats-new-in-web-forms-in-aspnet-45/_static/image20.png "отключена для описания продукта проверки запроса")

    *Проверка запросов отключен для описания продукта*

    > [!NOTE]
    > В реальном приложении, следует очистить HTML-код, введенный пользователем вносить вводились только безопасные HTML-тегов (например, существуют не &lt;сценарий&gt; теги). Чтобы сделать это, можно использовать [защиты библиотеки Microsoft Web](https://www.nuget.org/packages/AntiXSS).
7. Снова измените продукта. Введите код HTML в поле «имя» и нажмите кнопку **Сохранить**. Обратите внимание, что проверка запроса только отключена для поля «Описание» и остальная часть поля re по-прежнему проверяются относительно потенциально опасное содержимое.

    ![Включено в остальных полях проверки запроса](whats-new-in-web-forms-in-aspnet-45/_static/image21.png "проверки, которые включены в остальные поля запроса")

    *Проверка запросов включена в остальные поля*

    Веб-форм ASP.NET 4.5 включает новый режим проверки запроса для выполнения проверки запроса неактивно. С режимом проверки запроса **4.5**, если фрагмент кода обращается к *Request.Form [&quot;ключ&quot;]*, проверки запроса только триггер проверки запроса будет ASP.NET 4.5 для этого конкретного элемента в коллекции форм.

    Кроме того ASP.NET 4.5 теперь содержит основной кодировки подпрограммы из библиотеки Microsoft Anti-XSS v4.0. Процедуры кодирования реализуются новый Anti-XSS *AntiXssEncoder* тип, доступный в новом **System.Web.Security.AntiXss** пространства имен. С **encoderType** настроен для использования параметра *AntiXssEncoder*, весь вывод кодирования в ASP.NET автоматически использует новые процедуры кодирования.
8. Проверка ASP.NET 4.5 запроса также поддерживает непроверенный доступ к данным запроса. ASP.NET 4.5 добавляет новые свойства коллекции **HttpRequest** объекта с именем **Unvalidated**. При переходе в **HttpRequest.Unvalidated** у вас есть доступ ко всем общие составляющие данных запроса, включая формы, QueryStrings, файлы cookie, URL-адреса и т. д.

    ![Объект Request.Unvalidated](whats-new-in-web-forms-in-aspnet-45/_static/image22.png "Request.Unvalidated объекта")

    *Объект Request.Unvalidated*

    > [!NOTE]
    > **Используйте свойство HttpRequest.Unvalidated осторожно!** Убедитесь, что вы тщательно выполнять пользовательскую проверку на основе данных необработанный запрос, чтобы убедиться, что опасный текст не обхода и визуализацией пользователей!

<a id="Exercise3"></a>

<a id="Exercise_3_Asynchronous_Page_Processing_in_ASPNET_Web_Forms"></a>
### <a name="exercise-3-asynchronous-page-processing-in-aspnet-web-forms"></a>Упражнение 3: Асинхронной обработки страницы в ASP.NET Web Forms

В этом упражнении будет представлена новая страница асинхронной обработки возможностей в веб-форм ASP.NET.

<a id="Task_1_-_Updating_the_Product_Details_Page_to_Upload_and_Show_Images"></a>
#### <a name="task-1---updating-the-product-details-page-to-upload-and-show-images"></a>Задача 1 - обновлении продукта сведений страницы для загрузки и отображения изображений

В этой задаче будет обновить страницу сведений о продукте, чтобы разрешить пользователю указать URL-адрес изображения для продукта и его отображения в режиме только для чтения. Вы создадите локальную копию заданного изображения можно загрузить в синхронном режиме. В следующей задаче будет обновлена Эта реализация для работы в асинхронном режиме.

1. Откройте **Visual Studio 2012** и загрузить **начать** решение находится в **Source\Ex3 Async\Begin** из папки этой лаборатории. Кроме того можно продолжить работу с существующие решения от предыдущих упражнений.

    1. Если вы открыли указанных **начать** решение, необходимо будет загрузить несколько отсутствующих пакетов NuGet прежде чем продолжить. Для этого в обозревателе решений щелкните **WebFormsLab** проект и выберите **управление пакетами NuGet**.
    2. В **управление пакетами NuGet** диалоговое окно, нажмите кнопку **восстановить** чтобы скачивать отсутствующие пакеты.
    3. Наконец, постройте решение, нажав кнопку **построения** | **построить решение**.

    > [!NOTE]
    > Одним из преимуществ использования NuGet является у вас не указан для отправки всех библиотек в вашем проекте, уменьшив размер проекта. С помощью NuGet Power Tools указав версий пакета в файле Packages.config можно для загрузки всех необходимых библиотек первый раз, при запуске проекта. Вот почему необходимо будет выполнить эти шаги после открытия существующего решения в этой лаборатории.
2. Откройте **ProductDetails.aspx** источника и добавьте поля в FormView ItemTemplate для показа изображения продукта.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample30.aspx)]
3. Добавьте поле, чтобы указать URL-адрес изображения в FormView EditTemplate.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample31.aspx)]
4. Откройте **ProductDetails.aspx.cs** кода и добавьте следующие директивы пространства имен.

    (Фрагмент - кода *веб-пространства имен форм лаборатории - Ex03 -*)

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample32.cs)]
5. Создание **UpdateProductImage** метод для хранения удаленных изображений в локальном **изображения** папки и обновление сущности «продукт» с новым значением расположение образа.

    (Фрагмент - кода *веб-форм лаборатории - Ex03 - UpdateProductImage*)

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample33.cs)]
6. Обновление **UpdateProduct** метод, вызываемый **UpdateProductImage** метод.

    (Фрагмент - кода *Forms лаборатории - Ex03 - UpdateProductImage вызова веб-*)

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample34.cs)]
7. Запустите приложение и попробуйте передать изображение для продукта. Например, можно использовать следующий URL-адрес изображения из отсеченной искусство Office: [ [http://officeimg.vo.msecnd.net/images/MB900437099.jpg](http://officeimg.vo.msecnd.net/images/MB900437099.jpg)](http://officeimg.vo.msecnd.net/images/MB900437099.jpg)

    ![Задание изображения для продукта](whats-new-in-web-forms-in-aspnet-45/_static/image23.png "изображение продукта")

    *Задание изображения для продукта*

<a id="Task_2_-_Adding_Asynchronous_Processing_to_the_Product_Details_Page"></a>
#### <a name="task-2---adding-asynchronous-processing-to-the-product-details-page"></a>Задача 2 - Добавление асинхронной обработки на странице сведений о продукте

В этой задаче будет обновить страницу сведений о продукте для работы в асинхронном режиме. Долго выполняемая задача - процесс загрузки изображения - поможет повысить эффективность с помощью ASP.NET 4.5 асинхронной обработки страницы.

Асинхронные методы в веб-приложениях можно использовать для оптимизации способ использования пулов потоков ASP.NET. В ASP.NET существует ограниченное число потоков в пуле потоков за участие запросы, таким образом, если все потоки заняты, ASP.NET отклоняет подключение новых запросов, отправляет сообщения об ошибках приложения и делает недоступным веб-узла.

Длительные операции на веб-сайте отлично подходят для асинхронного программирования, так как они занимают назначенного потока в течение долгого времени. Сюда входят долго выполняющихся запросов, в которых требуется выполнение автономных операций, такие запросы к базе данных или доступ к внешней веб-сервер страницы с большим количеством различных элементов и страницы. Преимущество заключается в том, что при использовании асинхронных методов для выполнения этих операций во время обработки страницы потока освобождается и возвращается в поток пула и может использоваться для участия в новый запрос страницы. Это означает, страница начнет обработку в один поток из пула потоков и обработки в другой, могут завершиться, после завершения обработки асинхронного.

1. Откройте **ProductDetails.aspx** страницы. Добавить **Async** атрибута в **страницы** элемент и присвойте ему значение **true**. Этот атрибут сообщает ASP.NET для реализации интерфейса IHttpAsyncHandler.


    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample35.aspx)]
2. Добавьте метку в нижней части страницы, чтобы отобразить подробные сведения на странице выполнения потоков.

    [!code-aspx[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample36.aspx)]
3. Откройте **ProductDetails.aspx.cs** и добавьте следующие директивы пространства имен.

    (Фрагмент - кода *веб-пространства имен лаборатории - Ex03 - Forms 2*)

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample37.cs)]
4. Изменить **UpdateProductImage** метод для загрузки образа с асинхронной задачи. Будет заменено **WebClient** **DownloadFile** метод с **DownloadFileTaskAsync** метод и включать **await** ключевое слово.

    (Фрагмент - кода *веб-форм лаборатории - Ex03 - UpdateProductImage Async*)

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample38.cs)]

    Метод RegisterAsyncTask регистрирует новую асинхронную задачу страницы для выполнения в другом потоке. Он получает лямбда-выражение с задачей (t) для выполнения. **Await** ключевое слово в **DownloadFileTaskAsync** метод преобразует оставшейся части метода в обратный вызов, вызываемый после асинхронного **DownloadFileTaskAsync** метод завершения. ASP.NET будет возобновить выполнение метода, автоматическое обслуживание всех HTTP запроса исходные значения. Новые модели асинхронного программирования в .NET 4.5 можно написать асинхронный код, который внешне похожи синхронного кода и позвольте компилятору для преодоления сложностей функции обратного вызова или код продолжения.
    > [!NOTE]
    > Метод RegisterAsyncTask и PageAsyncTask были уже доступны с момента .NET 2.0. Ключевого слова await является новым в асинхронной модели программирования .NET 4.5 и может использоваться, а также новые методы TaskAsync из объекта .NET WebClient.
5. Добавьте код для отображения потоков, в которых код запуска и завершения выполнения. Для этого обновления **UpdateProductImage** метод следующим кодом.

    (Фрагмент - кода *Web Forms лаборатории - Ex03 - Показать потоки*)

    [!code-csharp[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample39.cs)]
6. Открыть веб-сайт **Web.config** файла. Добавьте следующую переменную appSetting.

    [!code-xml[Main](whats-new-in-web-forms-in-aspnet-45/samples/sample40.xml)]
7. Нажмите клавишу **F5** для запуска приложения и передать изображение для продукта. Обратите внимание, идентификатор потоков, где может быть другой код запуска и окончания. Это так, как выполнить асинхронные задачи в отдельном потоке из пула потоков ASP.NET. По завершении задачи ASP.NET помещает задачи в очередь и присваивает любой из доступных потоков.

    ![Асинхронную загрузку изображения](whats-new-in-web-forms-in-aspnet-45/_static/image24.png "асинхронную загрузку изображения")

    *Асинхронную загрузку изображения*

> [!NOTE]
> Кроме того, можно развернуть это приложение в Azure ниже [приложение б. публикация приложения ASP.NET MVC 4 с помощью веб-развертывания](#AppendixB).


* * *

<a id="Summary"></a>
## <a name="summary"></a>Сводка

В этой практической рассмотрены следующие основные понятия и показано:

- Использовать строго типизированного выражения привязки данных
- Использовать новые возможности привязки модели веб-форм
- Использование поставщиков значений для сопоставления страницы данных методам кода
- Использование заметок данных для проверки ввода данных
- Принимать advange из unobstrusive проверки на стороне клиента с помощью jQuery в веб-форм
- Реализуйте гранулярная проверка запросов
- Реализации асинхронной обработки страницы в веб-форм

<a id="AppendixA"></a>

<a id="Appendix_A_Installing_Visual_Studio_Express_2012_for_Web"></a>
## <a name="appendix-a-installing-visual-studio-express-2012-for-web"></a>Приложение а. Установка Visual Studio Express 2012 для Web

Можно установить **Microsoft Visual Studio Express 2012 для Web** или другой &quot;Express&quot; версию, используя  **[Microsoft Web Platform Installer](https://www.microsoft.com/web/downloads/platform.aspx)** . Следующие инструкции описывают действия, необходимые для установки *Visual studio Express 2012 для Web* с помощью *Microsoft Web Platform Installer*.

1. Последовательно выберите пункты [ [https://go.microsoft.com/?linkid=9810169](https://go.microsoft.com/?linkid=9810169)](https://go.microsoft.com/?linkid=9810169). Кроме того, если вы уже установили установщика веб-платформы, можно открыть его и выполните поиск продукта &quot; *Visual Studio Express 2012 для Web с пакетом Azure SDK*&quot;.
2. Щелкните **установить сейчас**. Если у вас **Web Platform Installer** вы будете перенаправлены, чтобы загрузить и установить ее сначала.
3. Один раз **Web Platform Installer** открыто, нажмите кнопку **установить** для запуска программы установки.

    ![Установка Visual Studio Express](whats-new-in-web-forms-in-aspnet-45/_static/image25.png "установка Visual Studio Express")

    *Установка Visual Studio Express*
4. Чтение всех продуктов лицензий и условия и нажмите кнопку **принимаю** для продолжения.

    ![Принятие условий лицензионного соглашения](whats-new-in-web-forms-in-aspnet-45/_static/image26.png)

    *Принятие условий лицензионного соглашения*
5. Дождитесь завершения процесса загрузки и установки.

    ![Ход установки](whats-new-in-web-forms-in-aspnet-45/_static/image27.png)

    *Ход выполнения установки*
6. По завершении установки нажмите кнопку **Готово**.

    ![Установка завершена](whats-new-in-web-forms-in-aspnet-45/_static/image28.png)

    *Установка завершена*
7. Нажмите кнопку **выхода** закрыть установщик веб-платформы.
8. Чтобы открыть Visual Studio Express для Web, перейдите к **запустить** экрана и начинается запись &quot; **VS Express**&quot;, выберите команду **VS Express для Web** Плитка.

    ![VS Express для Web плитки](whats-new-in-web-forms-in-aspnet-45/_static/image29.png)

    *VS Express для Web плитки*

<a id="AppendixB"></a>

<a id="Appendix_B_Publishing_an_ASPNET_MVC_4_Application_using_Web_Deploy"></a>
## <a name="appendix-b-publishing-an-aspnet-mvc-4-application-using-web-deploy"></a>Приложение б. публикация приложения ASP.NET MVC 4 с помощью веб-развертывания

В этом приложении будет показано, как создать новый веб-сайт на портале Azure и публикация приложения, получить, выполнив в лаборатории преимуществами средство публикации веб-развертывания, предоставляемых Azure.

<a id="ApxBTask1"></a>

<a id="Task_1_-_Creating_a_New_Web_Site_from_the_Windows_Azure_Portal"></a>
#### <a name="task-1---creating-a-new-web-site-from-the-azure-portal"></a>Задача 1. Создание нового веб-узла с помощью портала Azure

1. Последовательно выберите пункты [портала управления Azure](https://manage.windowsazure.com/) и войдите с использованием учетных данных Майкрософт, связанную с вашей подпиской.

    > [!NOTE]
    > С помощью Azure можно бесплатно размещения 10 веб-сайтов ASP.NET и затем масштабирование по мере увеличения трафика. Вы можете зарегистрироваться [здесь](http://aka.ms/aspnet-hol-azure).

    ![Войдите на портал Windows Azure](whats-new-in-web-forms-in-aspnet-45/_static/image30.png "входа на портал Windows Azure")

    *Войдите в портал*
2. Нажмите кнопку **New** на панели команд.

    ![Создание нового веб-сайта](whats-new-in-web-forms-in-aspnet-45/_static/image31.png "создания нового веб-сайта")

    *Создание нового веб-сайта*
3. Нажмите кнопку **вычислений** | **веб-сайт**. Выберите **быстрое создание** параметр. Укажите URL-адрес доступен для нового веб-сайта и нажмите кнопку **Создание веб-сайта**.

    > [!NOTE]
    > Azure размещается веб-приложение, работающее в облаке, вы можете управлять. Параметр быстрого создания позволяет развертывать завершенного веб-приложения в Azure из вне портала. Он не включает действия по настройке базы данных.

    ![Создание нового веб-сайта с помощью быстрого создания](whats-new-in-web-forms-in-aspnet-45/_static/image32.png "создания нового веб-сайта с помощью быстрого создания")

    *Создание нового веб-сайта с помощью быстрого создания*
4. Подождите, пока новый **веб-сайт** создается.
5. После создания веб-сайта по ссылке **URL-адрес** столбца. Проверьте, что новый веб-сайт работает.

    ![Просмотр новых веб-сайт](whats-new-in-web-forms-in-aspnet-45/_static/image33.png "просмотра на новый веб-сайт")

    *Просмотр новых веб-сайт*

    ![Веб-сайта под управлением](whats-new-in-web-forms-in-aspnet-45/_static/image34.png "веб-сайта под управлением")

    *Запуск веб-сайта*
6. Вернитесь на портал и щелкните имя веб-сайта в разделе **имя** столбец для отображения страницы управления.

    ![Открытие страницы управления веб-сайт](whats-new-in-web-forms-in-aspnet-45/_static/image35.png "Открытие страниц управления веб-сайта")

    *Открытие страницы управления веб-сайта*
7. В **панели мониторинга** в разделе **беглого** щелкните **загрузить профиль публикации** ссылку.

    > [!NOTE]
    > *Профиль публикации* содержит все сведения, необходимые для публикации веб-приложения в Azure для каждого разрешенного метода публикации. Профиль публикации содержит URL-адреса, учетные данные пользователя и строк базы данных, необходимых для подключения и проверки подлинности с каждой из конечных точек, для которых включен метода публикации. **Microsoft WebMatrix 2**, **Microsoft Visual Studio Express для Web** и **Microsoft Visual Studio 2012** поддерживают чтение профилей публикации для автоматизации настройки этих программ для Публикация веб-приложения в Azure.

    ![Профиль публикации веб-сайт загрузки](whats-new-in-web-forms-in-aspnet-45/_static/image36.png "профиль публикации веб-сайта загрузки")

    *Профиль публикации веб-сайта загрузки*
8. Загрузите файл профиля публикации в известном расположении. Далее в этом упражнении вы увидите как использовать этот файл для публикации веб-приложения в Azure из Visual Studio.

    ![Сохранить файл профиля публикации](whats-new-in-web-forms-in-aspnet-45/_static/image37.png "Сохранение профиля публикации")

    *Сохранить файл профиля публикации*

<a id="ApxBTask2"></a>

<a id="Task_2_-_Configuring_the_Database_Server"></a>
#### <a name="task-2---configuring-the-database-server"></a>Задача 2 - Настройка сервера базы данных

Если приложение использует SQL Server базы данных, необходимо будет создать сервер базы данных SQL. Если вы хотите развернуть простое приложение, которое не использует SQL Server может пропустить эту задачу.

1. Сервер базы данных SQL необходимо для хранения базы данных приложения. Можно просматривать серверы базы данных SQL из подписки на портале управления Azure на **баз данных Sql** | **серверы** | **мониторинга сервера**. Если у вас на сервер, созданный, можно создать ее, используя **добавить** кнопки на панели команд. Обратите внимание **имя сервера и URL-адрес, имя входа администратора и пароль**, как будет использовать их в следующие задачи. Не следует создавать базу данных, как он будет создан в более поздней стадии.

    ![Панель мониторинга базы данных SQL Server](whats-new-in-web-forms-in-aspnet-45/_static/image38.png "панель мониторинга базы данных SQL Server")

    *Панель мониторинга базы данных SQL Server*
2. В следующей задаче требуется проверить подключение к базе данных из Visual Studio, по этой причине необходимо включить локальный IP-адреса в список серверов **разрешенные IP-адреса**. Чтобы сделать это, нажмите кнопку **Настройка**, выберите IP-адрес из **текущий IP-адрес клиента** и вставьте его на **начальный IP-адрес** и **конечный IP-адрес** текстовые поля и нажмите кнопку ![add-client-ip-address-ok-button](whats-new-in-web-forms-in-aspnet-45/_static/image39.png) кнопки.

    ![Добавление IP-адрес клиента](whats-new-in-web-forms-in-aspnet-45/_static/image40.png)

    *Добавление IP-адрес клиента*
3. Один раз **IP-адрес клиента** добавляется разрешенных IP-адресов выберите на **Сохранить** для подтверждения изменения.

    ![Подтверждение изменений](whats-new-in-web-forms-in-aspnet-45/_static/image41.png)

    *Подтверждение изменений*

<a id="ApxBTask3"></a>

<a id="Task_3_-_Publishing_an_ASPNET_MVC_4_Application_using_Web_Deploy"></a>
#### <a name="task-3---publishing-an-aspnet-mvc-4-application-using-web-deploy"></a>Задача 3. публикация приложения ASP.NET MVC 4 с помощью веб-развертывания

1. Вернитесь в решении ASP.NET MVC 4. В **обозревателе решений**, щелкните правой кнопкой мыши проект веб-сайта и выберите **публикации**.

    ![Публикация приложения](whats-new-in-web-forms-in-aspnet-45/_static/image42.png "публикация приложения")

    *Публикация веб-сайта*
2. Импортируйте профиль публикации, сохраненный в первой задаче.

    ![Импорт профиля публикации](whats-new-in-web-forms-in-aspnet-45/_static/image43.png "Импорт профиля публикации")

    *Импорт профиля публикации*
3. Нажмите кнопку **Проверка подключения**. После завершения проверки нажмите кнопку **Далее**.

    > [!NOTE]
    > Проверка завершена, как только вы увидите зеленый флажок рядом с "Проверить подключение".

    ![Проверка подключения](whats-new-in-web-forms-in-aspnet-45/_static/image44.png "Проверка подключения")

    *Проверка подключения*
4. В **параметры** в разделе **баз данных** статьи, нажмите кнопку рядом с текстового поля для подключения к базе данных (т. е. **DefaultConnection**).

    ![Конфигурация веб-развертывания](whats-new-in-web-forms-in-aspnet-45/_static/image45.png "конфигурация веб-развертывания")

    *Конфигурация веб-развертывания*
5. Настройте подключение к базе данных следующим образом.

    - В **имя сервера** введите ваш URL-адрес сервера базы данных SQL с помощью *tcp:* префикс.
    - В **имя пользователя** введите имя входа администратора сервера.
    - В **пароль** введите пароль входа администратора сервера.
    - Введите имя новой базы данных.

    ![Настройка строки подключения назначения](whats-new-in-web-forms-in-aspnet-45/_static/image46.png "Настройка целевой строки подключения")

    *Настройка целевой строки подключения*
6. Затем нажмите кнопку **ОК**. Когда появится запрос на создание базы данных щелкните **Да**.

    ![Создание базы данных](whats-new-in-web-forms-in-aspnet-45/_static/image47.png "Создание строки базы данных")

    *Создание базы данных*
7. Строка подключения, используемого для подключения к базе данных SQL Azure отображается внутри текстового поля по умолчанию соединения. Затем нажмите кнопку **Далее**.

    ![Строка подключения, указывающий базу данных SQL](whats-new-in-web-forms-in-aspnet-45/_static/image48.png "строку соединения, указывающий базу данных SQL")

    *Строка подключения, указывающий базу данных SQL*
8. В **предварительного просмотра** щелкните **публикации**.

    ![Публикация веб-приложения](whats-new-in-web-forms-in-aspnet-45/_static/image49.png "публикации веб-приложения")

    *Публикация веб-приложения*
9. После завершения процесса публикации в браузере по умолчанию откроется опубликованного веб-узла.

<a id="AppendixC"></a>

<a id="Appendix_C_Using_Code_Snippets"></a>
## <a name="appendix-c-using-code-snippets"></a>Приложение в. фрагменты кода

С помощью фрагментов кода у вас есть весь код, который требуется под рукой. Документ лаборатории сообщает только при их использовании, как показано на следующем рисунке.

![Фрагменты кода Visual Studio для вставки кода в проекте](whats-new-in-web-forms-in-aspnet-45/_static/image50.png "фрагменты кода с помощью Visual Studio вставьте код в проект")

*Фрагменты кода Visual Studio для вставки кода в проекте*

***Добавление фрагмента кода, с помощью клавиатуры (только C#)***

1. Поместите курсор в место вставки кода.
2. Начните вводить имя фрагмента (без пробелов и дефисы).
3. Смотрите, как IntelliSense отображает, совпадающие с именами фрагменты.
4. Выберите правильный фрагмент (или продолжите ввод, пока не будет выделен весь фрагмент имени).
5. Нажмите клавишу Tab дважды, чтобы вставить фрагмент в положении курсора.

![Начните вводить имя фрагмента](whats-new-in-web-forms-in-aspnet-45/_static/image51.png "начните вводить имя фрагмента")

*Начните вводить имя фрагмента*

![Нажмите клавишу Tab, чтобы выделить выделенный фрагмент](whats-new-in-web-forms-in-aspnet-45/_static/image52.png "нажмите клавишу Tab, чтобы выделить выделенный фрагмент")

*Нажмите клавишу Tab, чтобы выделить выделенный фрагмент*

![Снова нажмите клавишу Tab и фрагмент будет расширен](whats-new-in-web-forms-in-aspnet-45/_static/image53.png "будет расширен, снова нажмите клавишу Tab и фрагмента кода")

*Снова нажмите клавишу Tab и фрагмент будет расширен*

***Добавление фрагмента кода, с помощью мыши (C#, Visual Basic и XML)*** 1. Щелкните правой кнопкой мыши место вставки фрагмента кода.

1. Выберите **вставить фрагмент** следуют **Мои фрагменты кода**.
2. Выберите соответствующий фрагмент из списка, щелкнув по ней.

![Щелкните правой кнопкой мыши место для вставки фрагмента кода и выбора вставить фрагмент](whats-new-in-web-forms-in-aspnet-45/_static/image54.png "место для вставки фрагмента кода и выбора вставить фрагмент кода щелкните правой кнопкой мыши")

*Щелкните правой кнопкой мыши в место вставки фрагмента кода и выберите Вставить фрагмент*

![Выберите из списка, соответствующего фрагмента, щелкнув его](whats-new-in-web-forms-in-aspnet-45/_static/image55.png "выбрать соответствующий фрагмент из списка, щелкнув по ней")

*Выберите соответствующий фрагмент из списка, щелкнув по ней*
