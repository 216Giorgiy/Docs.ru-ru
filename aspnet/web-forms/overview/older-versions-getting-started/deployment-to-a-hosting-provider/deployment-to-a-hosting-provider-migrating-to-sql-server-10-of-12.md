---
uid: web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12
title: 'Развертывание веб-приложения ASP.NET с SQL Server Compact с помощью Visual Studio или Visual Web Developer: миграция на SQL Server - 10 12 | Документы Microsoft'
author: tdykstra
description: Ряд учебниках показано развертывание ASP.NET (публикации) проекта веб-приложения, который содержит базу данных SQL Server Compact с помощью Visual Stu...
ms.author: aspnetcontent
manager: wpickett
ms.date: 11/17/2011
ms.topic: article
ms.assetid: a89d6f32-b71b-4036-8ff7-5f8ac2a6eca8
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12
msc.type: authoredcontent
ms.openlocfilehash: 25a829f1d3c730c7bb3b174f075ce8163999e482
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
ms.locfileid: "30892099"
---
<a name="deploying-an-aspnet-web-application-with-sql-server-compact-using-visual-studio-or-visual-web-developer-migrating-to-sql-server---10-of-12"></a>Развертывание веб-приложения ASP.NET с SQL Server Compact с помощью Visual Studio или Visual Web Developer: миграция на SQL Server - 10 12
====================
по [Tom Dykstra](https://github.com/tdykstra)

[Загрузите начальный проект](http://code.msdn.microsoft.com/Deploying-an-ASPNET-Web-4e31366b)

> Ряд учебниках показано развертывание ASP.NET (публикации) проекта веб-приложения, который содержит базу данных SQL Server Compact с помощью Visual Studio 2012 RC или Visual Studio Express 2012 RC для Web. Также можно использовать Visual Studio 2010, при установке обновления публикации Web. Введение ряда см. в разделе [в первом учебнике ряда](deployment-to-a-hosting-provider-introduction-1-of-12.md).
> 
> Учебник, в котором показаны возможности развертывания, появившиеся после выпуска версии-КАНДИДАТА Visual Studio 2012, показано, как развернуть выпусках SQL Server, отличных от SQL Server Compact и показано, как для развертывания на веб-приложениях службы приложений Azure, в разделе [развертывания веб-приложения ASP.NET с помощью Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).


## <a name="overview"></a>Обзор

Этого учебника показано, как перенести из SQL Server Compact в SQL Server. Одна из причин для этого может потребоваться — воспользоваться преимуществами функций SQL Server, которые SQL Server Compact не поддерживаются, например хранимые процедуры, триггеры, представления или репликации. Дополнительные сведения о различиях между SQL Server Compact и SQL Server см. в разделе [развертывание SQL Server Compact](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12.md) учебника.

### <a name="sql-server-express-versus-full-sql-server-for-development"></a>SQL Server Express или полный сервер SQL для разработки приложений

Если вы решили выполнить обновление до SQL Server, может потребоваться использовать SQL Server или SQL Server Express в средах разработки и тестирования. Помимо различий в средства поддержки и в функциях ядра СУБД существуют различия в реализации поставщика SQL Server Compact и других версий SQL Server. Эти отличия могут вызвать один и тот же код для создания различных результатов. Таким образом Если необходимо сохранить в SQL Server Compact, как базы данных разработки, необходимо тщательно протестировать веб-узла в SQL Server или SQL Server Express в тестовой среде, прежде чем каждое развертывание в рабочей среде.

В отличие от SQL Server Compact SQL Server Express является по сути тот же механизм базы данных и использует один и тот же поставщик .NET как полный SQL Server. При тестировании с SQL Server Express, можно быть уверенным начало те же результаты, как будет с помощью SQL Server. Можно использовать большинство тех же средств базы данных с SQL Server Express, который можно использовать вместе с SQL Server (заметным исключением, [SQL Server Profiler](https://msdn.microsoft.com/library/ms181091.aspx)), и он поддерживает другие возможности SQL Server, как хранимые процедуры, представления, триггеры, и репликация. (Обычно необходимо использовать полную SQL Server в рабочий веб-сайт, однако. SQL Server Express можно запускать в общей среде размещения, но он не предназначен для, и не поддерживают многие поставщики услуг размещения.)

При использовании Visual Studio 2012, обычно выбирается SQL Server Express LocalDB для среды разработки так, как это установленных по умолчанию вместе с Visual Studio. Тем не менее LocalDB не работает в службах IIS, поэтому для тестовой среды следует использовать SQL Server или SQL Server Express.

### <a name="combining-databases-versus-keeping-them-separate"></a>Объединение и сохранения их в отдельных баз данных

Приложение Contoso университета имеет две базы данных SQL Server Compact: база данных членства (*aspnet.sdf*) и базы данных приложения (*School.sdf*). При миграции, можно перенести эти базы данных для двух разных баз данных или для одной базы данных. Можно объединять их для упрощения базы данных соединения между базы данных приложения и базы данных членства. План размещения также может указать причину их объединение. Например поставщик услуг размещения начислить более для нескольких баз данных или не даже позволить более одной базы данных. Это относится к Cytanium Lite, размещение учетная запись, используемая в этом учебнике позволяет только одной базы данных SQL Server.

В этом учебнике предстоит перенести две базы данных таким образом:

- Перенос две базы данных LocalDB в среде разработки.
- Перенос две базы данных на SQL Server Express в тестовой среде.
- Перенос одного объединенного полной базы данных SQL Server в рабочей среде.

Напоминание: Если вы получаете сообщение об ошибке или что-то не работает, как пройти учебник, не забудьте проверить [страницу устранения неполадок](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).

## <a name="installing-sql-server-express"></a>Установка SQL Server Express

SQL Server, экспресс-выпуск автоматически устанавливается по умолчанию вместе с Visual Studio 2010, но по умолчанию они не установлены с помощью Visual Studio 2012. Чтобы установить SQL Server 2012 Express, перейдите по следующей ссылке

- [Экспресс-выпуска SQL Server 2012](https://www.microsoft.com/download/details.aspx?id=29062)

Выберите *x64/ENU/SQLEXPR\_x64\_ENU.exe* или *x86/ENU/SQLEXPR\_x86\_ENU.exe*и в мастере установки примите имя по умолчанию Параметры. Дополнительные сведения о параметрах установки см. в разделе [Установка SQL Server 2012 с помощью мастера установки (программа установки)](https://msdn.microsoft.com/library/ms143219.aspx).

## <a name="creating-sql-server-express-databases-for-the-test-environment"></a>Создание баз данных SQL Server Express для среды тестирования

Следующим шагом является создание членства ASP.NET и базы данных School.

Из **представление** меню выберите **обозревателя серверов** (**обозреватель баз данных** в Visual Web Developer), щелкните правой кнопкой мыши **подключения к данным**и выберите **Создание новой базы данных SQL Server**.

![Selecting_Create_New_SQL_Server_Database](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image1.png)

В **Создание новой базы данных SQL Server** диалогового окна введите «. \SQLExpress» в **имя сервера** поле и aspnet тестирования»» **новое имя базы данных** , а затем нажмите кнопку **ОК**.

![Create_New_SQL_Server_Database_aspnet](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image2.png)

Создать новую базу данных School, экспресс-выпуск SQL Server с именем «School Test» с помощью той же процедуры.

(Добавляются «Test» эти имена баз данных, так как позже вы создадите дополнительный экземпляр каждой базы данных для среды разработки и необходимо иметь возможность различать два набора баз данных.)

**Обозреватель серверов** теперь отображаются два новых баз данных.

![New_databases_in_Server_Explorer](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image3.png)

## <a name="creating-a-grant-script-for-the-new-databases"></a>Создание скрипта предоставления для новых баз данных

При выполнении приложения в IIS на компьютере разработчика, приложение обращается к базе данных, используя учетные данные пула приложений по умолчанию. Тем не менее по умолчанию удостоверение пула приложений имеет разрешение на открытие баз данных. Поэтому необходимо выполнить скрипт для предоставления этого разрешения. В этом разделе создайте скрипт, что вы будете запускать приложение более поздней версии, чтобы убедиться в том, что приложение может быть открыта баз данных при запуске в IIS.

В решении *SolutionFiles* папку, созданную в [развертывание в рабочей среде](deployment-to-a-hosting-provider-deploying-to-the-production-environment-7-of-12.md) учебник, создать новый файл SQL с именем *Grant.sql*. Скопируйте следующие команды SQL в файл и затем сохраните и закройте файл:

[!code-sql[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample1.sql)]

> [!NOTE]
> Этот скрипт предназначен для работы с SQL Server 2008 и параметры IIS в Windows 7, как они указаны в этом учебнике. При использовании другой версии SQL Server или Windows, или можно настроить IIS на компьютере по-разному, может потребоваться внести изменения в этот сценарий. Дополнительные сведения о скриптах SQL Server см. в разделе [электронной документации по SQL Server](https://go.microsoft.com/fwlink/?LinkId=132511).


> [!NOTE] 
> 
> **Примечание по безопасности** этот сценарий предоставляет db\_права владельца для пользователя, который обращается к базе данных во время выполнения, что является будете иметь производственной среды. В некоторых сценариях может потребоваться задать пользователь, имеющий всей базы данных схемы обновить разрешения только для развертывания и указать для времени выполнения другого пользователя с разрешениями только на чтение и запись данных. Дополнительные сведения см. в разделе **просмотрев автоматические изменения Web.config Code First Migrations** в [развертывание в IIS в тестовой среде](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12.md).


## <a name="configuring-database-deployment-for-the-test-environment"></a>Настройка развертывания базы данных для среды тестирования

Далее предстоит настроить Visual Studio, чтобы он будет выполнять следующие задачи для каждой базы данных:

- Создание скрипта SQL, который создает структуру базы данных-источника (таблицы, столбцы, ограничения и т. д.) в целевой базе данных.
- Создание скрипта SQL, который вставляет исходной базы данных в таблицы в целевой базе данных.
- Запустите сформированные скрипты и предоставьте скрипт, который был создан в целевой базе данных.

Откройте **свойства проекта** и выберите **упаковка и публикация SQL** вкладки.

Убедитесь, что **Активная (Release)** или **выпуска** выбран в **конфигурации** раскрывающегося списка.

Нажмите кнопку **включить эту страницу**.

![Package_Publish_SQL_tab_Enable_This_page](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image4.png)

**Упаковка и публикация SQL** вкладка обычно отключена, поскольку он указывает метод развертывания устаревших версий. В большинстве случаев следует настроить развертывание базы данных в **веб-публикация** мастера. Миграция из SQL Server Compact в SQL Server или SQL Server Express является особым случаем, для которого этот метод является хорошим выбором.

Нажмите кнопку **импорта из файла Web.config**.

![Selecting_Import_from_Web.config](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image5.png)

Visual Studio осуществляет поиск строки подключения в *Web.config* файла, находит одного для базы данных членства и базы данных School и добавляет строку, соответствующую каждой строки подключения в **записи базы данных**  таблицы. Находит строки подключения для существующих баз данных SQL Server Compact и следующим шагом будет Настройка способа и места для развертывания этих баз данных.

Введите параметры развертывания базы данных в **Подробности записи базы данных** ниже **записи базы данных** таблицы. Параметры, отображаемые в **Подробности записи базы данных** раздела относятся к какое значение строки в **записи базы данных** выбрана таблица, как показано на следующем рисунке.

![Database_Entry_Details_section_of_Package_Publish_SQL_tab](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image6.png)

### <a name="configuring-deployment-settings-for-the-membership-database"></a>Настройка параметров развертывания для базы данных членства

Выберите **DefaultConnection развертывания** строки в **записи базы данных** таблица для параметров, которые применяются к базе данных членства.

В **строку подключения для целевой базы данных**, введите строку соединения, указывающий на базе членства SQL Server Express. Можно получить из строки подключения **обозревателя серверов**. В **обозревателя серверов**, разверните **подключения к данным** и выберите **aspnetTest** базы данных, затем на **свойства** окно копирования **Строка подключения** значение.

![aspnet_connection_string_in_Server_Explorer](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image7.png)

Та же строка подключения воспроизведен здесь:

[!code-console[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample2.cmd)]

Скопируйте и вставьте эту строку подключения в **строку подключения для целевой базы данных** в **упаковка и публикация SQL** вкладки.

Убедитесь, что **данных и (или) схему из существующей базы данных по запросу** выбран. Это, в каком случае сценарии SQL, автоматически создается и выполняются в целевой базе данных.

**Строку подключения для базы данных-источника** значение извлекается из *Web.config* файл и точек для разработки базы данных SQL Server Compact. Это исходной базы данных, который будет использоваться для создания сценариев, в которых будет выполняться далее в целевой базе данных. Так как вы хотите развернуть в рабочей версии базы данных, измените «aspnet Dev.sdf» на «aspnet Prod.sdf».

Изменение **параметры скрипта базы данных** из **только схема** для **схему и данные**, поскольку требуется скопировать данные (учетные записи пользователей и роли), а также структуру базы данных.

Для настройки развертывания для выполнения скриптов grant, созданной ранее, необходимо добавить их в **скриптов базы данных** раздела. Нажмите кнопку **добавить скрипт**и в **добавить скрипты SQL** диалоговом окне перейдите в папку для хранения сценарий предоставления (это папку, содержащую файл решения). Выберите файл с именем *Grant.sql*и нажмите кнопку **откройте**.

[![Select_File_dialog_box_grant_script](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image9.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image8.png)

Параметры для **DefaultConnection развертывания** строки в **записи базы данных** выглядеть как на следующем рисунке:

![Database_Entry_Details_for_DefaultConnection_Test](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image10.png)

### <a name="configuring-deployment-settings-for-the-school-database"></a>Настройка параметров развертывания для базы данных School

Затем выберите **SchoolContext развертывания** строки в **записи базы данных** таблицы, чтобы настроить параметры развертывания для базы данных School.

Можно использовать тот же метод, который вы использовали для получения строки подключения для новой базы данных SQL Server Express. Скопируйте строку подключения в **строку подключения для целевой базы данных** в **упаковка и публикация SQL** вкладки.

[!code-console[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample3.cmd)]

Убедитесь, что **данных и (или) схему из существующей базы данных по запросу** выбран.

**Строку подключения для базы данных-источника** значение извлекается из *Web.config* файл и точек для разработки базы данных SQL Server Compact. Измените «School Dev.sdf» на «School-Prod.sdf» для развертывания в рабочей версии базы данных. (Файл School Prod.sdf никогда не был создан в приложении\_папке данных, поэтому будет скопировать этот файл из среды тестирования приложения\_данные в папку ContosoUniversity проекта позже.)

Изменение **параметры скрипта базы данных** для **схему и данные**.

Также можно запустить скрипт, чтобы предоставить чтения и записи пула приложений разрешения для этой базы данных, поэтому добавьте *Grant.sql* файл скрипта, как и для базы данных членства.

После завершения, параметры **SchoolContext развертывания** строки в **записи базы данных** выглядеть как на следующем рисунке:

![Database_Entry_Details_for_SchoolContext_Test](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image11.png)

Сохранить изменения в **упаковка и публикация SQL** вкладки.

Копировать *School-Prod.sdf* файл из *c:\inetpub\wwwroot\ContosoUniversity\App\_данные* папку для *приложения\_данных* папки в проект ContosoUniversity.

### <a name="specifying-transacted-mode-for-the-grant-script"></a>Указание режима транзакций для сценария предоставления

Процесс развертывания создает скрипты, которые развертывания схемы базы данных и данных. По умолчанию эти сценарии выполняются в транзакции. Однако пользовательские скрипты (например, сценарии grant) по умолчанию не запускаются в транзакции. Если процесс развертывания содержатся одновременно режимы транзакций, скрипты выполняются во время развертывания может появиться ошибка тайм-аута. В этом разделе отредактируйте файл проекта, чтобы настроить пользовательские скрипты для выполнения в транзакции.

В **обозревателе решений**, щелкните правой кнопкой мыши **ContosoUniversity** проект и выберите **выгрузить проект**.

![Unload_Project_in_Solution_Explorer](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image12.png)

Затем щелкните правой кнопкой мыши проект и выберите **изменить ContosoUniversity.csproj**.

![Edit_Project_in_Solution_Explorer](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image13.png)

В редакторе Visual Studio показывает, XML-содержимое файла проекта. Обратите внимание, что существует несколько `PropertyGroup` элементов. (На рисунке содержимое `PropertyGroup` элементы опущены.)

![Окно редактора файла проекта](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image15.png)

Первый и не имеет `Condition` атрибут, для настройки применяются независимо от конфигурации построения. Один `PropertyGroup` элемент применяется только к отладочной конфигурации построения (Примечание `Condition` атрибут), один относится только к конфигурации построения выпуска, и один применяется только к конфигурации построения для тестирования. В пределах `PropertyGroup` элемента конфигурации построения выпуска, вы увидите `PublishDatabaseSettings` элемент, содержащий параметры, введенные на **упаковка и публикация SQL** вкладки. Отсутствует `Object` элемента, соответствующего каждому скриптов grant заданных (Обратите внимание два экземпляра класса «Grant.sql»). По умолчанию `Transacted` атрибут `Source` элемент для каждого сценария предоставления `False`.

![Transacted_false](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image16.png)

Измените значение `Transacted` атрибут `Source` элемент `True`.

![Transacted_true](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image17.png)

Сохраните и закройте файл проекта щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **перезагрузить проект**.

![Reload_project](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image18.png)

## <a name="setting-up-webconfig-transformations-for-the-connection-strings"></a>Настройка преобразования Web.Config для строки подключения

Строки подключения для нового SQL Express баз данных, который введен в **упаковка и публикация SQL** вкладку, используются веб-развертывание только для обновления целевой базы данных во время развертывания. Все равно необходимо настроить *Web.config* преобразования, чтобы строки подключения в развернутой *Web.config* файл точку для новых баз данных SQL Server Express. (При использовании **упаковка и публикация SQL** вкладку, нельзя настроить строки подключения в профиле публикации.)

Откройте *Web.Test.config* и замените `connectionStrings` элемент с `connectionStrings` элемент в следующем примере. (Убедитесь, что копировать только элемент connectionStrings не окружающий код, показанный здесь, чтобы предоставить контекст.)

[!code-xml[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample4.xml?highlight=2-11)]

Этот код вызывает `connectionString` и `providerName` атрибуты каждого `add` элемента, заменяемого в развернутой *Web.config* файла. Эти строки подключения не идентичны тем, введенного в **упаковка и публикация SQL** вкладки. Параметр «MultipleActiveResultSets = True» будет добавлен к ним, так как он является обязательным, Entity Framework и универсальные поставщики.

## <a name="installing-sql-server-compact"></a>Установка SQL Server Compact

Пакет SqlServerCompact NuGet предоставляет базе данных SQL Server Compact engine сборок для приложения Contoso университета. Но теперь он не является приложение, но веб-развертывания, которые должны поддерживать только для чтения к базе данных SQL Server Compact, чтобы создать скрипты для выполнения в базах данных SQL Server. Чтобы включить веб-развертывания для чтения базы данных SQL Server Compact, установите SQL Server Compact на компьютере разработчика, используя следующую ссылку: [Microsoft SQL Server Compact 4.0](https://www.microsoft.com/downloads/details.aspx?FamilyID=15F7C9B3-A150-4AD2-823E-E4E0DCF85DF6).

## <a name="deploying-to-the-test-environment"></a>Развертывание в тестовой среде

Для публикации в тестовой среде, необходимо создать профиль публикации, который настроен для использования **упаковка и публикация SQL** вкладки для базы данных публикации, а не параметры базы данных профиля публикации.

Сначала удалите существующий профиль теста.

В **обозревателе решений**, щелкните правой кнопкой мыши проект ContosoUniversity и нажмите кнопку **публикации**.

Выберите **профиль** вкладки.

Нажмите кнопку **управления профилями**.

Выберите **теста**, нажмите кнопку **удалить**, а затем нажмите кнопку **закрыть**.

Закрыть **веб-публикация** мастера, чтобы сохранить эти изменения.

Затем создайте новую конфигурацию теста и использовать его для публикации проекта.

В **обозревателе решений**, щелкните правой кнопкой мыши проект ContosoUniversity и нажмите кнопку **публикации**.

Выберите **профиль** вкладки.

Выберите **&lt;новые... &gt;** из раскрывающегося списка и введите «Test» в качестве имени профиля.

В **URL-адрес службы** введите *localhost*.

В **сайт и приложение** введите *веб-сайта по умолчанию или ContosoUniversity*.

В **URL-адрес назначения** введите `http://localhost/ContosoUniversity/`.

Нажмите кнопку **Далее**.

**Параметры** вкладка предупреждает, **упаковка и публикация SQL** вкладку был настроен, и дает возможность переопределить их, нажав кнопку включения публикации усовершенствования новой базы данных. Для этого развертывания не требуется переопределять **упаковка и публикация SQL** значений параметров, поэтому просто нажмите кнопку **Далее**.

![Publish_Web_wizard_Settings_tab_Migrate](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image19.png)

Сообщение на **предварительного просмотра** вкладка указывает, что **не выбраны базы данных для публикации**, но это только означает, что публикация баз данных не настроена в профиле публикации.

Нажмите кнопку **Опубликовать**.

![Publish_Web_wizard_Preview_tab_Migrate](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image20.png)

Visual Studio развертывает приложение и открывает в браузере домашнюю страницу сайта в тестовой среде. Запустите страницу инструкторов, чтобы увидеть, отображаются те же данные, что вы уже видели раньше. Запустите **добавьте учащихся** , Добавление нового студента и затем просмотреть нового студента в **учащихся** страницы. Проверяет, что можно обновлять базы данных. Выберите **обновление кредиты** (необходимо выполнить вход) страницы для убедитесь, что база данных членства была развернута и у вас есть доступ к нему.

## <a name="creating-a-sql-server-database-for-the-production-environment"></a>Создание базы данных SQL Server для рабочей среды

Теперь, когда вы развернули в тестовую среду, можно настроить развертывание в рабочей среде. Сначала, как это было сделано для тестовой среды, создав базу данных для развертывания. Как вы помните из обзора, Cytanium Lite плана размещения допускает только одной базы данных SQL Server, необходимо настроить только одну базу данных, не как два. Все таблицы и данные из базы данных School SQL Server Compact и членства будут развернуты в одну базу данных SQL Server в рабочей среде.

Перейдите на панель управления Cytanium в [ http://panel.cytanium.com ](http://panel.cytanium.com). Наведите указатель мыши на **баз данных** и нажмите кнопку **SQL Server 2008**.

[![Selecting_Databases_in_Control_Panel](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image22.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image21.png)

В **SQL Server 2008** щелкните **Create Database**.

[![Selecting_Create_Database](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image24.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image23.png)

Имя базы данных «School» и нажмите кнопку **Сохранить**. (Страница автоматически добавляет префикс «contosou», таким образом, действующие имя «contosouSchool».)

[![Naming_the_database](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image26.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image25.png)

На этой же странице щелкните **Create User**. На серверах Cytanium, а не с помощью встроенной безопасности Windows и позволяя удостоверение пула приложений открыть базу данных создается пользователь, который имеет право открыть базу данных. Вы добавите учетные данные пользователя для строки подключения, перейдите в производстве *Web.config* файла. На этом шаге создайте эти учетные данные.

[![Creating_a_database_user](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image28.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image27.png)

Заполните обязательные поля в **свойства пользователя SQL** страницы:

- Введите «ContosoUniversityUser» в качестве имени.
- Введите пароль.
- Выберите **contosouSchool** как базы данных по умолчанию.
- Выберите **contosouSchool** флажок.

[![SQL_User_Properties_page](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image30.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image29.png)

## <a name="configuring-database-deployment-for-the-production-environment"></a>Настройка базы данных развертывания для рабочей среды

Теперь вы готовы к настройке параметров развертывания базы данных в **упаковка и публикация SQL** вкладки, как это было ранее для тестовой среды.

Откройте **свойства проекта** выберите **упаковка и публикация SQL** вкладку и убедитесь, что **Активная (Release)** или **выпуска** — выбранный в **конфигурации** раскрывающегося списка.

При настройке параметров развертывания для каждой базы данных, в том, как настроить строки подключения — основное различие между что делать в производственной среде и тестовых средах. Для среды тестирования вы ввели другой целевой строки подключения базы данных, но для рабочей среды целевой строки подключения будет одинаковым для обеих баз данных. Это так, как вы развертываете обеих баз данных к одной базе данных в рабочей среде.

### <a name="configuring-deployment-settings-for-the-membership-database"></a>Настройка параметров развертывания для базы данных членства

Чтобы настроить параметры, которые применяются к базе данных членства, выберите **DefaultConnection развертывания** строки в **записи базы данных** таблицы.

В **строку подключения для целевой базы данных**, введите строку соединения, указывающий на новую базу данных SQL Server производства только что созданный. Строку подключения можно получить из вашей приветственное сообщение электронной почты. Нужная часть сообщения электронной почты содержит следующий образец строки соединения:

[!code-console[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample5.cmd)]

После замены три переменные строку подключения, необходимые выглядит как в следующем примере:

[!code-console[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample6.cmd)]

Скопируйте и вставьте эту строку подключения в **строку подключения для целевой базы данных** в **упаковка и публикация SQL** вкладки.

Убедитесь, что **данных и (или) схему из существующей базы данных по запросу** по-прежнему выбран, и что **параметры скрипта базы данных** по-прежнему **схему и данные**.

В **скриптов базы данных** снимите флажок рядом с Grant.sql сценария.

![Disable_Grant_script](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image31.png)

### <a name="configuring-deployment-settings-for-the-school-database"></a>Настройка параметров развертывания для базы данных School

Затем выберите **SchoolContext развертывания** строки в **записи базы данных** таблицы для настройки параметров базы данных School.

Скопируйте одну и ту же строку подключения в **строку подключения для целевой базы данных** , скопированные в это поле для базы данных членства.

Убедитесь, что **данных и (или) схему из существующей базы данных по запросу** по-прежнему выбран, и что **параметры скрипта базы данных** по-прежнему **схему и данные**.

В **скриптов базы данных** снимите флажок рядом с Grant.sql сценария.

Сохранить изменения в **упаковка и публикация SQL** вкладки.

## <a name="setting-up-webconfig-transforms-for-the-connection-strings-to-production-databases"></a>Настройки Web.Config преобразует для строки подключения для рабочих баз данных

Далее необходимо настроить *Web.config* преобразования, чтобы строки подключения в развернутой *Web.config* файл, чтобы она указывала на новый рабочей базы данных. Строка подключения, введенных на **упаковка и публикация SQL** вкладки для веб-развертывания для использования является таким же, как приложение должно использовать, за исключением добавления `MultipleResultSets` параметр.

Откройте *Web.Production.config* и замените `connectionStrings` элемент с `connectionStrings` элемент, который выглядит как в следующем примере. (Копирование только `connectionStrings` элемент, не окружающей теги, которые показывают контексте.)

[!code-xml[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample7.xml?highlight=2-11)]

Иногда видеть советы о том, чтобы всегда шифрования строк подключения в *Web.config* файла. Это может быть целесообразным, если развертывание для серверов в сети вашей организации. При развертывании в общей среде размещения, доверяющих рекомендации по обеспечению безопасности поставщика услуг размещения и он является необязательным и удобным для шифрования строк подключения.

## <a name="deploying-to-the-production-environment"></a>Развертывание в рабочей среде

Теперь все готово для развертывания в рабочей среде. Веб-развертывание будет считывать базах данных SQL Server Compact в своем проекте *приложения\_данные* папки и заново создайте все таблицы и данных в SQL Server рабочей базы данных. Для публикации с помощью **Пакет/Публикация веб-сайта** параметры табуляции, необходимо создать новый профиль публикации для рабочей среды.

Сначала удалите существующий профиль производства, как это было ранее тестовый профиль.

В **обозревателе решений**, щелкните правой кнопкой мыши проект ContosoUniversity и нажмите кнопку **публикации**.

Выберите **профиль** вкладки.

Нажмите кнопку **управления профилями**.

Выберите **рабочей**, нажмите кнопку **удалить**, а затем нажмите кнопку **закрыть**.

Закрыть **веб-публикация** мастера, чтобы сохранить эти изменения.

Затем создайте новый профиль рабочей и использовать его для публикации проекта.

В **обозревателе решений**, щелкните правой кнопкой мыши проект ContosoUniversity и нажмите кнопку **публикации**.

Выберите **профиль** вкладки.

Нажмите кнопку **импорта**и выберите загруженный ранее файл PUBLISHSETTINGS.

На **подключения** измените **URL-адрес назначения** правильный временный URL-адрес в этом примере является http://contosouniversity.com.vserver01.cytanium.com.

Переименование профиля в рабочей среде. (Выберите **профиль** и нажмите кнопку **Управление профилями** для этого).

Закрыть **веб-публикация** мастер, чтобы сохранить изменения.

В реальном приложении, в котором при обновлении базы данных в рабочей среде необходимо выполнить две дополнительные действия теперь перед публикацией.

1. Отправка *приложения\_offline.htm*, как показано в [развертывание в рабочей среде](deployment-to-a-hosting-provider-deploying-to-the-production-environment-7-of-12.md) учебника.
2. Используйте **диспетчера файлов** компонент панели управления Cytanium для копирования *aspnet Prod.sdf* и *School-Prod.sdf* файлов из рабочего сайта в *Приложения\_данные* папку проекта ContosoUniversity. Это гарантирует, что данные, которые необходимо развернуть новую базу данных SQL Server включает последние изменения, внесенные в рабочий веб-сайт.

В **веб-публикация одним щелкните** инструментов, убедитесь, что **рабочей** выбран, а затем нажмите кнопку **публикации**.

Если вы отправили <em>приложения\_offline.htm</em> перед публикацией, необходимо использовать <strong>диспетчера файлов</strong> служебной программы на панели управления Cytanium удалить <em>приложения\_вне сети.</em> htm, прежде чем тестировать. Можно также одновременно удалить <em>.sdf</em> файлов из <em>приложения\_данные</em> папки.

Теперь можно откройте браузер и перейдите по URL-адресу общего узла тестирование приложения так же, как это было сделано после развертывания в среде тестирования.

## <a name="switching-to-sql-server-express-localdb-in-development"></a>Переключение на SQL Server Express LocalDB в разработке

Как было описано в обзоре, рекомендуется использовать один и тот же механизм базы данных в разработке, используемой в тестовой и рабочей. (Помните, что преимуществом использования SQL Server Express в разработке, что базы данных будет работать же в средах разработки, тестирования и эксплуатации.) В этом разделе составим ContosoUniversity проекта для использования SQL Server Express LocalDB, при запуске приложения из Visual Studio.

Самый простой способ выполнения миграции позволяет Code First и система членства создать оба новые базы данных разработки для вас. С помощью этого метода для миграции состоит из трех действий:

1. Изменение строк подключения для указания новых баз данных SQL Express LocalDB.
2. Запустите средство администрирования веб-сайта для создания пользователя-администратора. Это создает базу данных членства.
3. Используйте команду update-database Code First Migrations для создания и инициализации базы данных приложения.

### <a name="updating-connection-strings-in-the-webconfig-file"></a>Обновление строки подключения в файле Web.config

Откройте *Web.config* и замените `connectionStrings` следующим кодом:

[!code-xml[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample8.xml)]

### <a name="creating-the-membership-database"></a>Создание базы данных членства

В **обозревателе решений**, выберите проект ContosoUniversity, а затем нажмите кнопку **конфигурации ASP.NET** в **проекта** меню.

Перейдите на вкладку Безопасность.

Нажмите кнопку **Создание или управление ролями**, а затем создать **администратора** роли.

Вернитесь на вкладку Безопасность.

Нажмите кнопку **создать пользователя**, а затем выберите **администратора** флажок и создать пользователя с именем администратора.

Закрыть **Web Site Administration Tool**.

### <a name="creating-the-school-database"></a>Создание базы данных School

Откройте окно консоли диспетчера пакетов.

В **проекта по умолчанию** раскрывающегося списка выберите ContosoUniversity.DAL проект.

Введите следующую команду:

[!code-powershell[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample9.ps1)]

Code First Migrations применяет исходный миграции, которая создает базу данных, а затем применяет AddBirthDate миграции, а затем он выполняет метод начальное значение.

Запустите сайт, нажав клавишу F5 элемента управления. Как и для тестовой и рабочей средах, запустите **добавьте учащихся** , Добавление нового студента и затем просмотреть нового студента в **учащихся** страницы. Проверка создания и инициализации базы данных School и иметь чтение и запись в его.

Выберите **обновление кредиты** страницы и войдите в систему, чтобы убедиться, что база данных членства была развернута и наличие доступа к нему. Если не перенести учетные записи пользователей, создайте учетную запись администратора, а затем выберите **обновление кредиты** страницу, чтобы убедиться, что он работает.

## <a name="cleaning-up-sql-server-compact-files"></a>Очистка файлы SQL Server Compact

Ненужные файлы и пакеты NuGet, которые были включены для поддержки SQL Server Compact. Если вы хотите (этот шаг не требуется), можно удалить ненужные файлы и ссылки.

В **обозревателе решений**, удалить *.sdf* файлов из *приложения\_данные* папки и *amd64* и *x86* папок из *bin* папки.

В **обозревателе решений**, щелкните правой кнопкой мыши решение (не один из проектов) и нажмите кнопку **управление пакетами NuGet для решения**.

В левой области **управление пакетами NuGet** выберите **установленных пакетов**.

Выберите **EntityFramework.SqlServerCompact** пакета и нажмите кнопку **управление**.

В **выберите проекты** диалоговом выбраны оба проекта. Чтобы удалить пакет в обоих проектах, снимите оба флажка, а затем нажмите кнопку **ОК**.

В диалоговом окне с вопросом, следует ли также удалить зависимые пакеты, нажмите кнопку "Нет". Один из них — пакет Entity Framework, которую необходимо сохранить.

Выполните ту же процедуру для удаления **SqlServerCompact** пакета. (Пакеты необходимо удалить в указанном порядке, так как **EntityFramework.SqlServerCompact** зависит от пакета **SqlServerCompact** пакета.)

Теперь успешно перенесены на SQL Server Express и полную SQL Server. В следующем учебнике вам предстоит другой изменения базы данных, после чего будет отображен развертывание изменений в базе данных при тестовой и рабочей базы данных с помощью SQL Server Express и полного сервера SQL.

> [!div class="step-by-step"]
> [Назад](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12.md)
> [Вперед](deployment-to-a-hosting-provider-deploying-a-sql-server-database-update-11-of-12.md)
