---
uid: web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12
title: "Развертывание веб-приложения ASP.NET с SQL Server Compact с помощью Visual Studio или Visual Web Developer: преобразования файла Web.Config - 3 12 | Документы Microsoft"
author: tdykstra
description: "Ряд учебниках показано развертывание ASP.NET (публикации) проекта веб-приложения, который содержит базу данных SQL Server Compact с помощью Visual Stu..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 11/17/2011
ms.topic: article
ms.assetid: 2b0df3d9-450b-4ea6-b315-4c9650722cad
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12
msc.type: authoredcontent
ms.openlocfilehash: ed78b55d2b0315cf428f137c56ad85b29a95e1c5
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2018
---
<a name="deploying-an-aspnet-web-application-with-sql-server-compact-using-visual-studio-or-visual-web-developer-webconfig-file-transformations---3-of-12"></a>Развертывание веб-приложения ASP.NET с SQL Server Compact с помощью Visual Studio или Visual Web Developer: преобразования файла Web.Config - 3 12
====================
По [Tom Dykstra](https://github.com/tdykstra)

[Загрузите начальный проект](http://code.msdn.microsoft.com/Deploying-an-ASPNET-Web-4e31366b)

> Ряд учебниках показано развертывание ASP.NET (публикации) проекта веб-приложения, который содержит базу данных SQL Server Compact с помощью Visual Studio 2012 RC или Visual Studio Express 2012 RC для Web. Также можно использовать Visual Studio 2010, при установке обновления публикации Web. Введение ряда см. в разделе [в первом учебнике ряда](deployment-to-a-hosting-provider-introduction-1-of-12.md).
> 
> Учебник, в котором показаны возможности развертывания, появившиеся после выпуска версии-КАНДИДАТА Visual Studio 2012, показано, как развернуть выпусках SQL Server, отличных от SQL Server Compact и показано, как для развертывания на веб-приложениях службы приложений Azure, в разделе [развертывания веб-приложения ASP.NET с помощью Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).


## <a name="overview"></a>Обзор

Этот учебник показывает, как автоматизировать процесс изменения *Web.config* файла при его развертывании в другой целевой среды. Большинство приложений имеют параметры *Web.config* файл, должны быть разными, при развертывании приложения. Автоматизация процесса внесения этих изменений позволяет из того, чтобы сделать их вручную каждый раз при развертывании, который может оказаться трудоемкой и ошибкам.

Напоминание: Если вы получаете сообщение об ошибке или что-то не работает, как пройти учебник, не забудьте проверить [страницу устранения неполадок](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).

## <a name="webconfig-transformations-versus-web-deploy-parameters"></a>Параметры развертывания преобразования Web.config и Web

Существует два способа для автоматизации процесса изменения *Web.config* параметры: [преобразования Web.config](https://msdn.microsoft.com/library/dd465326.aspx) и [параметры веб-развертывания](https://msdn.microsoft.com/library/ff398068.aspx). Объект *Web.config* преобразования файл содержит XML-разметку, которая определяет способ изменения *Web.config* файла при его развертывании. Можно указать различные изменения для конкретной конфигурации построения и для конкретных профилей публикации. По умолчанию конфигурации построения, отладки и выпуска, и можно создать пользовательские конфигурации построения. Профиль публикации обычно соответствует в целевой среде. (Вы узнаете о дополнительных сведений о публикации профилей в [развертывание в IIS в тестовой среде](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12.md) учебник.)

Параметры веб-развертывания можно использовать для указания различных параметров, которые должны быть настроены во время развертывания, включая параметры, которые находятся в *Web.config* файлов. Используемый для задания *Web.config* изменения в файле, для настройки параметров веб-развертывание более сложны, но они полезны, если вы не знаете значение для установки, пока не будет развернут. Например, в среде предприятия можно создать *пакета развертывания* и присвойте ему человека в ИТ-отдел для установки в рабочей среде и у другого пользователя есть возможность введите строки подключения или пароли, которые не знаете.

Для сценария, в этом учебнике, вы знаете все, что необходимо сделать для *Web.config* файл, поэтому необходимо использовать параметры веб-развертывания. Следует настроить некоторые преобразования, различаются в зависимости от конфигурации построения, который используется, и некоторые, различаются в зависимости от того, используется профиль публикации.

## <a name="creating-transformation-files-for-publish-profiles"></a>Создание файлов преобразования для профили публикации

В **обозревателе решений**, разверните *Web.config* для просмотра *Web.Debug.config* и *Web.Release.config* преобразования файлов создаются по умолчанию для конфигурации построения два заданных по умолчанию.

![Web.config_transform_files](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image1.png)

Можно создать файлы преобразования для конфигураций настраиваемой сборки, щелкнув правой кнопкой мыши файл Web.config и выбрав **добавить преобразования конфигурации** в контекстном меню, но для этого учебника не требуется для этого.

Вам нужен двух дополнительных файлов преобразования для изменения, которые связаны назначение развертывания, а не конфигурацию сборки настройки. Типичный пример такого рода параметра является конечной точки WCF, отличается для теста и производства. На следующих занятиях рассматривается, вы создадите публикации профилей с именем теста и рабочей среде, поэтому требуется *Web.Test.config* файла и *Web.Production.config* файла.

Необходимо вручную создать файлы преобразования, которые связаны с профилей публикации. В **обозревателе решений**, щелкните правой кнопкой мыши проект ContosoUniversity и выберите **открыть папку в проводнике Windows**.

![Open_folder_in_Windows_Explorer](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image2.png)

В **Проводник**выберите *Web.Release.config* файл, скопируйте файл и вставьте две копии. Переименовать эти копии *Web.Production.config* и *Web.Test.config*, затем закройте **Проводник**.

В **обозревателе решений**, нажмите кнопку **обновление** для отображения новых файлов.

Выберите новые файлы, щелкните правой кнопкой мыши и выберите команду **включить в проект** в контекстном меню.

![Включая файлы конфигурации для рабочего и тестового проекта](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image3.png)

Чтобы предотвратить эти файлы, развертывание, выберите их в **обозревателе решений**и затем в **свойства** окно Изменение **действие при построении** свойство из **Содержимого** для **нет**. (Преобразование файлов, основанные на конфигурации построения автоматически запрещена развертывание.)

Теперь вы готовы для ввода *Web.config* преобразования в *Web.config* файлы преобразования.

## <a name="limiting-error-log-access-to-administrators"></a>Ограничение доступа к журналу ошибок для администраторов

Если возникает ошибка во время выполнения приложения, приложение отображает страницу универсальное сообщение об ошибке вместо ошибки, сформированные системой и использует [пакет Elmah NuGet](http://www.hanselman.com/blog/NuGetPackageOfTheWeek7ELMAHErrorLoggingModulesAndHandlersWithSQLServerCompact.aspx) для регистрации ошибок и отчетности. `customErrors` Элемент в *Web.config* файла указывает на страницу ошибки:

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample1.xml)]

Чтобы открыть страницу ошибки, временно изменить `mode` атрибут `customErrors` элемента «RemoteOnly» для «On» и запустите приложение из Visual Studio. Вызывает ошибку, запрашивая недопустимый URL-адрес, например *Studentsxxx.aspx*. Вместо страницу ошибки созданный IIS «страница не найдена» вы видите *GenericErrorPage.aspx* страницы.

[![Error_page](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image5.png)](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image4.png)

Чтобы просмотреть журнал ошибок, замените все содержимое в URL-адрес после номера порта с *elmah.axd* (например, на снимке экрана, `http://localhost:51130/elmah.axd`) и нажмите клавишу ВВОД:

[![Elmah_log_page](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image7.png)](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image6.png)

Не забудьте задать `customErrors` элемент обратно в режим «RemoteOnly» после завершения.

На компьютере разработчика удобно Разрешить свободный доступ к странице журнала ошибки, но в производственной среде, может представлять угрозу безопасности. Для рабочего сайта, можно добавить правило авторизации, которое ограничивает доступ к журналу ошибок только для администраторов, настроив преобразование в *Web.Production.config* файла.

Откройте *Web.Production.config* и добавьте новую `location` сразу после открытия элемента `configuration` тег, как показано ниже. (Убедитесь, что можно добавить только `location` элемента и не окружающей разметки, как показано здесь только для предоставления некоторый контекст.)

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample2.xml?highlight=2-9)]

`Transform` Значение атрибута «Insert» вызывает это `location` добавлен как одноуровневый для любой существующий элемент `location` элементов в *Web.config* файла. (Уже имеется один `location` элемент, который задает авторизации правил для **обновление кредиты** страницы.) Если при проверке рабочего сайта после развертывания, вы сможете протестировать, чтобы убедиться, что действует это правило авторизации.

Не нужно для ограничения доступа к журналу ошибок в тестовой среде, поэтому не нужно добавить этот код в *Web.Test.config* файла.

> [!NOTE] 
> 
> **Примечание по безопасности** никогда не отображать сведения об ошибке для просмотра в реальном приложении, или хранения этих сведений в общедоступном расположении. Злоумышленники могут использовать сведения об ошибках для обнаружения уязвимостей в узле. Если в приложении используется ELMAH, убедитесь, что для изучения способов настройки ELMAH чтобы свести к минимуму угрозы безопасности. В примере ELMAH в этом учебнике не следует считать Рекомендуемая конфигурация. Это пример, в котором был выбран для демонстрации обработки необходимо, приложение может создавать файлы в папку.


## <a name="setting-an-environment-indicator"></a>Настройка индикатора среды

Распространенным сценарием является возможность *Web.config* параметры, которые должны быть разными в каждой среде, которое развертывается в файл. Например приложение, которое вызывает службу WCF может потребоваться другой конечной точке в тестовой и рабочей сред. Приложение Contoso университета также включает параметр этого типа. Этот параметр определяет, отображается индикатор на страницах сайта о том, какая среда используется, например разработки, тестирования или производства. Значение параметра определяет приложения, которые будут добавлены «(Dev)» или «(Test)» для основного заголовка в *Site.Master* главной страницы:

[![Environment_indicator](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image9.png)](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/_static/image8.png)

Индикатор среды учитывается, если приложение выполняется в рабочей среде.

Веб-страницы университета Contoso чтения значение, которое задано в `appSettings` в *Web.config* файл, чтобы определить, какой приложение выполняется в политике:

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample3.xml)]

Значение должно быть «Test» в тестовой среде, а «Prod» в рабочей среде.

Откройте *Web.Production.config* и добавьте `appSettings` элемент непосредственно перед открывающим тегом элемента `location` элемент, добавленный ранее:

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample4.xml)]

`xdt:Transform` «SetAttributes» указывает, что это преобразование предназначено для изменения значений атрибутов существующего элемента в значении атрибута *Web.config* файла. `xdt:Locator` Значение «Match(key)» указывает, что элемента для изменения одного атрибута которого `key` атрибут соответствует `key` атрибут, указанный здесь. Только атрибут из `add` элемент `value`, и что будут изменены в развернутой *Web.config* файла. Этот код вызывает `value` атрибут `Environment` `appSettings` элемента требуется задать значение «Prod» *Web.config* файла, который развернут в рабочей среде.

После этого применить такое же изменение в *Web.Test.config* файла, за исключением набора `value` «Тест» вместо «Prod». Когда вы закончите, `appSettings` статьи *Web.Test.config* будет выглядеть как в следующем примере:

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample5.xml)]

## <a name="disabling-debug-mode"></a>Отключение режима отладки

Для сборки выпуска вы не требуется запускать независимо от того, какая среда выполняется развертывание. По умолчанию *Web.Release.config* файла преобразования создается автоматически с кодом, который удаляет `debug` атрибута из `compilation` элемента:

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample6.xml)]

`Transform` Атрибут причины `debug` к исключению атрибута из развернутой *Web.config* файла каждый раз, когда развертывание выпуска.

Это же преобразование возможности рабочего и тестового файлы преобразования, так как они созданы, скопировав файл преобразования выпуска. Не нужно его дублирование существует, откройте каждый из этих файлов, удалите **компиляции** элемент и сохраните и закройте файлы.

## <a name="setting-connection-strings"></a>Задание строк подключения

В большинстве случаев вы не обязательно для настройки преобразования строки подключения, так как строки подключения можно указать в профиле публикации. Но существует одно исключение при развертывании базы данных SQL Server Compact, а вы используете Entity Framework Code First Migrations обновление базы данных на целевом сервере. Для этого сценария необходимо указать строку дополнительные подключения, который будет использоваться для обновления схемы базы данных на сервере. Для настройки этого преобразования, добавьте  **&lt;connectionStrings&gt;**  сразу после открытия элемента  **&lt;конфигурации&gt;**  в оба тега *Web.Test.config* и *Web.Production.config* преобразования файлов:

[!code-xml[Main](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12/samples/sample7.xml)]

`Transform` Атрибут указывает, что эта строка подключения будет добавлен к *connectionStrings* элемент в развернутой *Web.config* файла. (Процесс публикации автоматически создает эту строку дополнительные подключения для вас, если он не существует, но по умолчанию **providerName** атрибут получает значение `System.Data.SqlClient`, который не работает не для SQL Server Compact. Добавив строку подключения вручную, сохраняются в процессе развертывания в создание элемент строки подключения с именем неверного поставщика.)

Вы указали теперь все *Web.config* преобразования, необходимые для развертывания университета Contoso приложения для тестирования и производства. В этом руководстве вы будете аккуратно задач настройки развертывания, которые требуется установить для свойства проекта.

## <a name="more-information"></a>Дополнительные сведения

Дополнительные сведения о подразделах, рассматриваемых в этом учебнике содержатся в сценарии преобразования Web.config в [Карта содержимого развертывания ASP.NET](https://msdn.microsoft.com/library/bb386521.aspx).

>[!div class="step-by-step"]
[Назад](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12.md)
[Вперед](deployment-to-a-hosting-provider-configuring-project-properties-4-of-12.md)
