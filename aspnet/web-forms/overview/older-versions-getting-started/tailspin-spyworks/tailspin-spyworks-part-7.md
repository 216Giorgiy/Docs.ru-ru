---
uid: web-forms/overview/older-versions-getting-started/tailspin-spyworks/tailspin-spyworks-part-7
title: 'Часть 7: Добавление функций | Документы Microsoft'
author: JoeStagner
description: Этот учебник ряд подробно описываются шаги, необходимые для построения образца приложения Tailspin Spyworks. Часть 7 добавляет дополнительные компоненты, например росмотреть учетной записи...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/21/2010
ms.topic: article
ms.assetid: 50223ee9-11b9-4cf3-bca2-e2f10bf471f3
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/tailspin-spyworks/tailspin-spyworks-part-7
msc.type: authoredcontent
ms.openlocfilehash: 17f068155f6726047901e2f7d580d375a4e07c87
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="part-7-adding-features"></a>Часть 7: Добавление функции
====================
по [(Joe Stagner)](https://github.com/JoeStagner)

> Tailspin Spyworks показано, как чрезвычайно простой можно создавать мощные и масштабируемые приложения для платформы .NET. Он показывает как использовать новые возможности в ASP.NET 4 для создания Интернет-магазина, включая покупок, извлечения и администрирования.
> 
> Этот учебник ряд подробно описываются шаги, необходимые для построения образца приложения Tailspin Spyworks. Часть 7 добавляет дополнительные функции, такие как проверка учетной записи, обзоров продуктов и «популярных элементов» и «также приобретенных» пользовательские элементы управления.


## <a id="_Toc260221673"></a>  Добавление компонентов

Пользователи могут просматривать наш каталог, поместите элементы в его корзине и завершить процесс извлечения, но существует ряд вспомогательных функций, чтобы улучшить наш сайт будет включено.

1. Проверка учетной записи (список заказов разместить и просмотреть сведения.)
2. Добавьте содержимое определенного контекста к началу страницы.
3. Добавьте компонент, чтобы позволить пользователям просмотр продуктов в каталоге.
4. Создайте пользовательский элемент управления для отображения элементов популярных и месте, управляющие на первой странице.
5. Создание элемента управления пользователя «Также приобретенных» и добавьте его к странице сведений о продукте.
6. Добавить контакт страницы.
7. Добавить о странице.
8. Глобальные ошибки

## <a id="_Toc260221674"></a>  Проверка учетной записи

В папке «Учетная запись» создайте две страницы ASPX один именованный OrderList.aspx и именованные OrderDetails.aspx

OrderList.aspx будет использовать элементы управления GridView и EntityDataSoure так же, как у нас есть ранее.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample1.aspx)]

EntityDataSoure Выбор записей из таблицы заказов, отфильтрованные по имени пользователя (см. WhereParameter) которого задается в переменной сеанса при входе этого пользователя.

Обратите внимание, эти параметры в HyperlinkField элемента управления GridView:

[!code-xml[Main](tailspin-spyworks-part-7/samples/sample2.xml)]

Они указывают ссылку, чтобы Просмотр подробностей заказа для каждого продукта, указывая в качестве параметра строки запроса к странице OrderDetails.aspx поле OrderID.

## <a id="_Toc260221675"></a>  OrderDetails.aspx

Мы будем использовать элемент управления EntityDataSource для доступа к заказов и FormView для отображения данных о заказе и другой EntityDataSource, с помощью GridView для отображения строк элементов заказа.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample3.aspx)]

В файле кода программной части (OrderDetails.aspx.cs) у нас есть два мало биты обслуживания.

Сначала необходимо убедиться, что OrderDetails всегда получает OrderId.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample4.cs)]

Нам также нужно вычислить и отобразить общее из элементов строк заказа.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample5.cs)]

## <a id="_Toc260221676"></a>  Домашняя страница

Давайте добавим некоторые статическое содержимое на страницу Default.aspx.

Сначала я создам папкой «Содержимое» и в ней папку Images (и будет включать изображения для использования на домашней странице).

В нижней заполнитель страницу Default.aspx добавьте следующую разметку.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample6.aspx)]

## <a id="_Toc260221677"></a>  Обзоров продуктов

Сначала мы добавим кнопки со ссылкой на форму, можно использовать для ввода Обзор продукта.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample7.aspx)]

![](tailspin-spyworks-part-7/_static/image1.jpg)

Обратите внимание, что мы передаем значение поля в строке запроса

Далее добавим страницу с именем ReviewAdd.aspx

Эта страница будет использовать набор элементов управления ASP.NET AJAX. Если вы еще не сделали, загрузите ее с [DevExpress](http://devexpress.com/act) и рекомендации по настройке в набор инструментов для использования с Visual Studio здесь [ https://www.asp.net/learn/ajax-videos/video-76.aspx ](../../../videos/ajax-control-toolkit/how-do-i-get-started-with-the-aspnet-ajax-control-toolkit.md).

В режиме конструктора перетащите элементы управления и проверяющие элементы управления из области элементов и создания формы, аналогичный приведенному ниже.

![](tailspin-spyworks-part-7/_static/image2.jpg)

Разметка будет выглядеть примерно следующим образом.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample8.aspx)]

Теперь, когда мы можем ввести обзоры, позволяет отображать эти проверки на странице продукта.

Добавьте этот разметку страницы ProductDetails.aspx.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample9.aspx)]

Теперь приложение под управлением и переход к продукту показывает сведения о продукте, включая отзывы клиентов.

![](tailspin-spyworks-part-7/_static/image3.jpg)

## <a id="_Toc260221678"></a>  Популярные элементов управления (создания пользовательских элементов управления)

Чтобы увеличить продажи на веб-сайте мы добавим ваши возможности популярных или связанные продукты «непристойные продаж».

Первый из этих функций будет список более популярных продуктов в наш каталог продукции.

Мы создадим «Пользовательский элемент управления» для отображения наиболее продаваемых товаров на домашней странице приложения. Поскольку это будет элемент управления, можно использовать на любой странице, просто перетащив элемент управления в конструкторе Visual Studio на любой странице, который мы.

В обозревателе решений Visual Studio щелкните правой кнопкой мыши имя решения и создайте новый каталог с именем «Элементы управления». Не является необходимым, мы поможет сохранить наш проект по созданию всех наших пользовательских элементов управления в каталоге «Элементам управления».

Правой кнопкой мыши папку элементов управления и выберите «Новый элемент».

![](tailspin-spyworks-part-7/_static/image4.jpg)

Укажите имя для наших управления «PopularItems». Обратите внимание, что расширение файла для пользовательских элементов управления .ascx не .aspx.

Наш распространенных пользовательских элементов управления определяются следующим образом.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample10.aspx)]

Здесь мы используем метод, еще не используемых в этом приложении. Мы используем элементе управления повторителем и вместо использования элемента управления источником данных мы выполняем привязку элементе управления повторителем к результатам запроса LINQ to Entities.

В коде можем контролировать нам сделать следующим образом.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample11.cs)]

Обратите внимание, эта важные строка в верхней части разметки можем контролировать.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample12.aspx)]

Поскольку наиболее популярных элементы не будут изменены на основе минуты к минуте мы можем добавить директиву болью для повышения производительности приложения. Эта директива вызовет код элементов управления, чтобы выполнить только после истечения срока действия кэшированного вывода элемента управления. В противном случае будет использоваться кэшированная версия вывода элемента управления.

Теперь все, что нужно сделать — добавить наш новый элемент управления в нашу страницу Default.aspc.

Используйте перетаскивание для размещения экземпляра элемента управления в столбце откройте нашу форму по умолчанию.

![](tailspin-spyworks-part-7/_static/image5.jpg)

Теперь когда мы запускаем наше приложение на домашней странице отображаются наиболее популярных элементы.

![](tailspin-spyworks-part-7/_static/image6.jpg)

## <a id="_Toc260221679"></a>  «Также Куплено» управляют (пользовательские элементы управления с параметрами)

Второй пользовательский элемент управления, который мы создадим займет непристойные продаж на следующий уровень, добавив специфичность контекста.

Логика для вычисления с основными элементами «Также приобретенных» является нетривиальной.

Выбирает OrderDetails записей (ранее уже приобрел) для текущего выбранного ProductID и захватите OrderIDs для каждого заказа уникальными, находящийся наш элемент управления «Также приобрести».

Затем мы выберем al продукты из этих заказов и количества приобретенных sum. Мы отсортировать продукты по количество, сумма которых составляет и отображения пять элементов.

Учитывая сложность этой логики, мы будем реализовывать этот алгоритм как хранимую процедуру.

Ниже приведен код T-SQL для хранимой процедуры.

[!code-sql[Main](tailspin-spyworks-part-7/samples/sample13.sql)]

Обратите внимание, что эта хранимая процедура (SelectPurchasedWithProducts) существовали в базе данных мы включили в приложении, и при создании модели EDM, указанный в дополнение к таблиц и представлений, которые нужны, модели EDM следует включить эту хранимую процедуру.

Для доступа к хранимой процедуре из нам нужно импортировать функция модели EDM.

Дважды щелкните модель данных сущности в обозревателе решений, чтобы открыть его в конструкторе и откройте обозреватель моделей, затем щелкните правой кнопкой мыши в конструкторе и выберите команду Добавить функции «импорт».

![](tailspin-spyworks-part-7/_static/image1.png)

Таким образом будет открыть это диалоговое окно.

![](tailspin-spyworks-part-7/_static/image2.png)

Заполните поля, как показано выше, при выборе «SelectPurchasedWithProducts» и использовать имя процедуры в качестве имени нашей импортированной функции.

Нажмите кнопку «ОК».

Этого, мы просто написать программный код хранимой процедуры, как мы может любой элемент в модели.

Таким образом в нашем папке «Элементы управления» создайте новый пользовательский элемент управления с именем AlsoPurchased.ascx.

Разметку для этого элемента управления будет очень знакомыми к элементу управления PopularItems.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample14.aspx)]

Заметное отличие состоит в том, не кэшируется выходных данных так, как должен быть подготовлен к просмотру элемента будут отличаться по продукту.

Значение поля будет «свойство» к элементу управления.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample15.cs)]

В обработчике события PreRender элемента управления мы eed для выполнения трех задач.

1. Убедитесь в том, что значение ProductID.
2. См. Если есть какие-либо продукты, приобретенные с текущей строкой.
3. Выводить некоторые элементы, как определено в #2.

Обратите внимание на то, как просто можно вызвать хранимую процедуру через модель.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample16.cs)]

Определив, что» также приобретенных» мы просто привязать повторителя результатов, возвращенных запросом.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample17.cs)]

Если не все элементы «также приобретенных» будет просто отобразить других популярных элементов из наших каталога.

[!code-csharp[Main](tailspin-spyworks-part-7/samples/sample18.cs)]

Чтобы просмотреть элементы «Также приобрести», откройте страницу ProductDetails.aspx и перетащите элемент управления AlsoPurchased из обозревателя решений, чтобы он отображался в этом месте в разметке.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample19.aspx)]

Таким образом будет создать ссылку на элемент управления в верхней части страницы ProductDetails.

[!code-aspx[Main](tailspin-spyworks-part-7/samples/sample20.aspx)]

Так как пользовательский элемент управления AlsoPurchased требуется номер ProductId мы установим свойство ProductID наш элемент управления с помощью инструкции Eval для текущего элемента модели данных страницы.

![](tailspin-spyworks-part-7/_static/image3.png)

Когда мы сборки и выполнения теперь и перейдите к продукту мы отображены элементы «Также приобрести».

![](tailspin-spyworks-part-7/_static/image7.jpg)

> [!div class="step-by-step"]
> [Назад](tailspin-spyworks-part-6.md)
> [Вперед](tailspin-spyworks-part-8.md)
