---
uid: web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-web-services
title: "Основные сведения о веб-служб ASP.NET AJAX | Документы Microsoft"
author: scottcate
description: "Веб-службы являются неотъемлемой частью .NET framework, которую обеспечивают кросс платформенных решение для обмена данными между распределенных систем. Несмотря на то что Web..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/28/2008
ms.topic: article
ms.assetid: 3332d6e7-e2e1-4144-b805-e71d51e7e415
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-web-services
msc.type: authoredcontent
ms.openlocfilehash: 8eb3486c9b3f4ddb6a8bc2c1cdcac774a6852574
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="understanding-aspnet-ajax-web-services"></a>Основные сведения о веб-служб ASP.NET AJAX
====================
по [Scott кате](https://github.com/scottcate)

[Скачать PDF](http://download.microsoft.com/download/C/1/9/C19A3451-1D14-477C-B703-54EF22E197EE/AJAX_tutorial05_Web_Services_with_MS_Ajax_cs.pdf)

> Веб-службы являются неотъемлемой частью .NET framework, которую обеспечивают кросс платформенных решение для обмена данными между распределенных систем. Несмотря на то, что веб-службы обычно используются для разрешения различных операционных системах, объектные модели и языки программирования для отправки и получения данных, они могут также использоваться для динамически вставки данных в страницы ASP.NET AJAX или отправлять данные со страницы в обслуживающей системе. Все это можно сделать без обращения к операций обратной передачи.


## <a name="calling-web-services-with-aspnet-ajax"></a>Вызов веб-служб с помощью ASP.NET AJAX

Дэн Wahlin

Веб-службы являются неотъемлемой частью .NET framework, которую обеспечивают кросс платформенных решение для обмена данными между распределенных систем. Несмотря на то, что веб-службы обычно используются для разрешения различных операционных системах, объектные модели и языки программирования для отправки и получения данных, они могут также использоваться для динамически вставки данных в страницы ASP.NET AJAX или отправлять данные со страницы в обслуживающей системе. Все это можно сделать без обращения к операций обратной передачи.

Хотя элемент управления ASP.NET AJAX UpdatePanel предоставляет простой способ AJAX включить любой страницы ASP.NET, могут возникнуть ситуации, когда требуется динамического доступа к данным на сервере без использования элемента управления UpdatePanel. В этой статье вы увидите, как это сделать, создание и использование веб-служб на страницах ASP.NET AJAX.

В этой статье основное внимание уделяется функциональные возможности, доступные в расширения AJAX ASP.NET core, а также включить веб-службу управления в наборе ASP.NET AJAX, называется AutoCompleteExtender. Рассматриваются определение веб-служб с поддержкой AJAX, создания клиентского прокси-серверов и вызов веб-служб с использованием JavaScript. Вы также увидите, как можно было выполнять вызовы веб-службы непосредственно в методы страницы ASP.NET.

## <a name="web-services-configuration"></a>Настройка веб-служб

При создании нового проекта веб-сайта с помощью Visual Studio 2008, файл web.config содержит ряд новых дополнений, которые могут быть незнакомы для пользователей предыдущих версий Visual Studio. Чтобы можно было использовать на страницах, пока другие определения, необходимые HttpHandlers и HttpModules некоторые из этих изменений сопоставить префикс «asp» элементов управления ASP.NET AJAX. Листинг 1 показывает изменения, вносимые `<httpHandlers>` элемента в файле web.config, который влияет на вызовы веб-службы. Значение по умолчанию HttpHandler используется для обработки вызовов .asmx является удаляются и заменяются ScriptHandlerFactory класс находится в сборке System.Web.Extensions.dll. System.Web.Extensions.dll содержит все основные функциональные возможности, используемые ASP.NET AJAX.

**Пример 1. Конфигурация обработчика ASP.NET AJAX веб-служб**

[!code-xml[Main](understanding-asp-net-ajax-web-services/samples/sample1.xml)]

Это HttpHandler замещения чтобы разрешить JavaScript Object Notation (JSON) вызовов из страницы ASP.NET AJAX для веб-служб .NET с использованием прокси JavaScript веб-службы. ASP.NET AJAX отправляет сообщения JSON веб-служб в отличие от стандартных звонки Simple Object Access Protocol (SOAP), обычно связанные с веб-служб. Это приводит к меньшего размера запроса и общую ответных сообщений. Он также позволяет более эффективную обработку клиентских данных, так как библиотека ASP.NET AJAX JavaScript оптимизирован для работы с объектами JSON. Пример 2 и примеры Показать листинге 3 веб-службы сообщений запросов и ответов сериализован в формат JSON. Сообщение запроса, который показан в списке 2 передает параметр страны со значением «Бельгия» во время ответного сообщения в списке 3 передает массив объектов клиента и связанные с ними свойства.

**Пример 2. Запрос веб-службы сообщение, преобразуется в формат JSON**

[!code-json[Main](understanding-asp-net-ajax-web-services/samples/sample2.json)]

> *>[!NOTE] имя операции, определяется как часть URL-адрес веб-службы; Кроме того, сообщения запроса не всегда передаются через JSON. Веб-службы можно использовать атрибут ScriptMethod с параметром UseHttpGet, равным true, вследствие чего параметры для передачи через параметры строки запроса.*


**Пример 3. Ответ веб-службы сообщение, преобразуется в формат JSON**

[!code-json[Main](understanding-asp-net-ajax-web-services/samples/sample3.json)]

В следующем разделе вы увидите, как создать веб-службы для обработки сообщения запроса JSON и отвечать на запросы с простых и сложных типов.

## <a name="creating-ajax-enabled-web-services"></a>Создание с поддержкой AJAX веб-служб

ASP.NET AJAX framework предоставляет несколько способов вызова веб-служб. Можно использовать элемент управления AutoCompleteExtender (доступно в наборе AJAX ASP.NET) или JavaScript. Тем не менее перед вызовом службы необходимо включить AJAX его, чтобы он может вызываться из кода клиентского скрипта.

Независимо от того, имеется ли вы не знакомы с веб-служб ASP.NET, вы найдете его легко создавать и службы с поддержкой AJAX. Платформа .NET framework поддерживается создание веб-служб ASP.NET с момента первоначального выпуска в 2002 г. и расширения AJAX ASP.NET предоставляют дополнительные функциональные возможности AJAX, который построен на основе .NET framework по умолчанию набор функций. Visual Studio .NET 2008 бета-версии 2 имеет встроенную поддержку для создания .asmx файлов веб-службы и автоматически наследует класс System.Web.Services.WebService связан код рядом с классами. Как можно добавить методы в класс, необходимо применить атрибут WebMethod для них будет вызвана потребителей веб-службы.

Листинг 4 показан пример применения атрибута WebMethod метод с именем GetCustomersByCountry().

**Пример 4. С помощью атрибута WebMethod в веб-службе**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample4.cs)]

Метод GetCustomersByCountry() принимает в качестве параметра страны и возвращает массив объектов клиента. Значение страны, передаваемый в метод передается бизнес уровня класса, который в свою очередь вызывает класс уровень данных для извлечения данных из базы данных, свойства объекта клиента заполнить данными и возвращать массив.

## <a name="using-the-scriptservice-attribute"></a>С помощью атрибута ScriptService

При добавлении атрибута позволяет вызвать метод GetCustomersByCountry() для вызова клиентами, отправлять стандартные сообщения SOAP в веб-службу веб-метода, он не допускает вызовов JSON из приложений ASP.NET AJAX без дополнительной настройки. Чтобы разрешить вызовы JSON, создаваемую в применении расширения AJAX ASP.NET `ScriptService` атрибут класс веб-службы. Это позволяет для отправки сообщений-ответов в формате JSON с помощью веб-службы и клиентский сценарий для вызова службы, отправляя сообщения JSON.

Список 5 показан пример применения атрибута ScriptService класс веб-службы с именем CustomersService.

**Пример 5. С помощью атрибута ScriptService AJAX-Включение веб-службы**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample5.cs)]

Атрибут ScriptService выступает в качестве маркера, который указывает, что он может вызываться из кода скрипта AJAX. Он не обрабатывает фактически любой задачи сериализации или десериализации JSON, которые возникают в фоновом. ScriptHandlerFactory (настраивается в файле web.config) и другие классы выполняют основную часть обработки JSON.

## <a name="using-the-scriptmethod-attribute"></a>С помощью атрибута ScriptMethod

Атрибут ScriptService является единственным атрибутом ASP.NET AJAX, должен быть определен в .NET веб-службы, его можно использовать в страницах ASP.NET AJAX. Тем не менее с именем ScriptMethod другой атрибут также может применяться непосредственно к веб-методов в службе. ScriptMethod определяет три свойства, включая `UseHttpGet`, `ResponseFormat` и `XmlSerializeString`. Изменение значений этих свойств может быть полезно в случаях, где тип запроса, принимаемое веб-метода необходимо изменить для GET, когда веб-метод должен возвращать необработанные XML-данные в виде `XmlDocument` или `XmlElement` объект или если данные, возвращаемые  Служба всегда должно быть сериализовано как XML вместо JSON.

UseHttpGet, свойство может использоваться при веб-метод должен принимать получение запросов, в отличие от запросов POST. Запросы, отправляемые с помощью URL-адреса с входными параметрами веб-метода, переведенную в параметры строки запроса. UseHttpGet свойство по умолчанию имеет значение false и только следует присвоить значение `true` при операции известно, что надежными, а также когда конфиденциальные данные не передается в веб-службу. Перечисление 6 показан пример использования данного атрибута ScriptMethod со свойством UseHttpGet.

**Пример 6. С помощью атрибута ScriptMethod со свойством UseHttpGet.**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample6.cs)]

Примером заголовки, отправленные при вызове веб-метода HttpGetEcho показано перечисление 6 показаны далее:

`GET /CustomerViewer/DemoService.asmx/HttpGetEcho?input=%22Input Value%22 HTTP/1.1`

Помимо выдачи веб-методов принять запросы HTTP GET, атрибут ScriptMethod может также использоваться при XML-ответов должны быть возвращены из службы, а не JSON. Например веб-служба может получить RSS-канал с удаленного узла и возврат его как объект XmlDocument или XmlElement. Обработка XML-данных затем возникают на стороне клиента.

Листинг 7 показан пример использования свойства ResponseFormat, чтобы указать, что XML-данные должны быть возвращены из веб-метода.

**Листинг 7. С помощью атрибута ScriptMethod со свойством ResponseFormat.**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample7.cs)]

Свойство ResponseFormat также может использоваться вместе со свойством XmlSerializeString. Свойство XmlSerializeString имеет значение false, это означает, что все возвращаемые типы, за исключением строк, возвращаемых методом веб-сериализуются в XML по умолчанию при `ResponseFormat` свойству `ResponseFormat.Xml`. Когда `XmlSerializeString` равно `true`, все типы, возвращаемые из веб-метода сериализуются в формат XML, включая строковые типы. Если свойство ResponseFormat имеет значение `ResponseFormat.Json` XmlSerializeString свойство игнорируется.

Перечисление 8 показан пример использования свойства XmlSerializeString для принудительного строк должно быть сериализовано как XML.

**Пример 8. С помощью атрибута ScriptMethod со свойством XmlSerializeString**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample8.cs)]

Значение, возвращаемое из вызова метода веб-GetXmlString, показано в список 8 показан далее:

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample9.cs)]

Несмотря на то, что формат JSON по умолчанию сокращает общий размер сообщений запросов и ответов и более легко использовать клиентами ASP.NET AJAX в определенном браузерах, могут быть свойства ResponseFormat и XmlSerializeString используются, когда клиент приложениям, например Internet Explorer версии 5 или более поздней версии нужно XML-данных, возвращаемых методом веб.

## <a name="working-with-complex-types"></a>Работа со сложными типами

Список 5 был приведен пример возвращает сложный тип с именем Customer из веб-службы. Классу "Customer" определяет несколько различных типов простой внутренне как свойства, такие как FirstName и LastName. Сложные типы, используемые в качестве входного параметра и тип возвращаемого значения на основе AJAX веб-метода сериализуются автоматически в JSON перед его отправкой на стороне клиента. Однако вложенные сложные типы (которые в другой тип, определенный внутри) не становятся доступными клиенту качестве автономных объектов по умолчанию.

В случаях, где вложенным сложным типом, используемых веб-службой также должно использоваться страницей клиента можно добавить атрибут ASP.NET AJAX GenerateScriptType в веб-службу. Например, класс CustomerDetails, показанный на 9 со списком содержит адрес и пол свойства которого ***представляют вложенные сложные типы.***

**Листинг 9. Класс CustomerDetails, показанный здесь содержит две вложенные сложные типы.**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample10.cs)]

Адрес и пол объекты, определенные в классе CustomerDetails, показанный на 9 со списком не будет автоматически доступны для использования на стороне клиента через JavaScript, так как они представляют собой вложенные типы (адрес — это класс и Пол является перечислением). В ситуациях, где вложенный тип, используемый веб-службы должен быть доступен на стороне клиента, можно использовать приведенные выше атрибута GenerateScriptType (см. список 10). Этот атрибут можно добавить несколько раз в случаях, когда другой вложенные сложные типы возвращенный из службы. Оно может применяться непосредственно к класс веб-службы или выше отдельные веб-методы.

**Список 10. С помощью атрибута GenerateScriptService для определения вложенных типов, которые должны быть доступны клиенту.**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample11.cs)]

Применяя `GenerateScriptType` атрибута в веб-службы, адрес и пол типы автоматически станут доступны для использования в код ASP.NET AJAX JavaScript на стороне клиента. Пример JavaScript, который автоматически создается и отправляются на клиент, добавив атрибут GenerateScriptType веб-службы показан вывод 11. Вы увидите, как использовать вложенные сложные типы далее в этой статье.

**Перечисление 11. Вложенные сложные типы, доступная для страницы ASP.NET AJAX.**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample12.cs)]

Теперь, когда вы знаете, как создать веб-службы и сделайте его доступным для страницы ASP.NET AJAX, давайте рассмотрим, как создавать и использовать прокси-серверы JavaScript, чтобы данные можно извлечь или отправить на веб-службы.

## <a name="creating-javascript-proxies"></a>Создание прокси-серверы JavaScript

Вызов стандартных веб-службы (.NET или другую платформу) обычно включает в себя создание прокси-объект, который абстрагирует вас от необходимости отправки сообщений запроса и ответа SOAP. С вызовами веб-службы ASP.NET AJAX можно создать прокси-серверы JavaScript и позволяет без труда вызвать службы, не беспокоясь о сериализации и десериализации сообщений JSON. Прокси-серверы JavaScript можно создавать автоматически с помощью элемента управления ASP.NET AJAX ScriptManager.

Создание прокси-сервера JavaScript, который может вызывать веб-службы выполняется с помощью свойства служб ScriptManager. Это свойство позволяет определить одну или несколько служб, которые страницы ASP.NET AJAX можно асинхронный вызов для отправки и получения данных, не требуя операций обратной передачи. Определение службы с помощью ASP.NET AJAX `ServiceReference` управления и назначения URL веб-службы для элемента управления `Path` свойство. Пример 12 показан пример ссылки на службы, с именем CustomersService.asmx.

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample13.aspx)]

**Пример 12. Определение веб-службы, используемых в страницы ASP.NET AJAX.**

Добавление ссылки на CustomersService.asmx через элемент управления ScriptManager вызывает прокси JavaScript для динамически сгенерированных и ссылается страница. Прокси-сервер внедряется с помощью &lt;сценарий&gt; теги и динамически загружается путем вызова CustomersService.asmx файла и добавления /js в конец. В следующем примере показано, как внедренные прокси JavaScript на странице при отладка была отключена в файле web.config:

[!code-html[Main](understanding-asp-net-ajax-web-services/samples/sample14.html)]

> *>[!NOTE] Если вы хотите получить фактический код прокси-сервера JavaScript, который создается можно ввести URL-адрес для нужного веб-службы .NET в поле адреса Internet Explorer и добавьте в конец /js.*


Если отладка включена в файле web.config, отладочная версия прокси-сервера JavaScript будет внедрен в страницу, как показано далее:

[!code-html[Main](understanding-asp-net-ajax-web-services/samples/sample15.html)]

Прокси-сервера JavaScript, созданные ScriptManager также могут встраиваться непосредственно в страницу, а не с помощью &lt;сценарий&gt; атрибут src тега. Это можно сделать, задав свойству InlineScript ServiceReference элемента управления значение true (по умолчанию — false). Это полезно в том случае, когда прокси-сервер, не являющихся общими на нескольких страницах и при необходимости уменьшить количество сетевых вызовов, выполняемых к серверу. Если InlineScript имеет значение true, скрипт прокси-сервера не будет кэшироваться браузером, значение по умолчанию false рекомендуется в случаях, когда прокси-сервер используется несколько страниц в приложении ASP.NET AJAX. Далее показан пример использования свойства InlineScript:

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample16.aspx)]

## <a name="using-javascript-proxies"></a>С помощью прокси-серверы JavaScript

После страницы ASP.NET AJAX с помощью элемента управления ScriptManager ссылается на веб-службы, может быть вызов веб-службы и возвращаемые данные могут обрабатываться с помощью функции обратного вызова. Веб-служба вызывается (если такой существует), создание ссылок на пространства имен, имя класса и имя веб-метода. Любые параметры, передаваемые в веб-службы можно определить вместе с функцию обратного вызова, который обрабатывает полученные данные.

Пример использования прокси JavaScript для вызова веб-метода с именем GetCustomersByCountry() отображается в Листинг 13. Функция GetCustomersByCountry() вызывается, когда пользователь нажимает кнопку на странице.

**Листинг 13. Вызов веб-службы с прокси JavaScript.**

[!code-javascript[Main](understanding-asp-net-ajax-web-services/samples/sample17.js)]

Этот вызов ссылается на пространство имен InterfaceTraining, класс CustomersService и веб-метода GetCustomersByCountry определенной в службе. Он передает значение страны, полученное от текстового поля, а также функцию обратного вызова с именем OnWSRequestComplete, который должен быть запущен при возвращении асинхронного вызова веб-службы. OnWSRequestComplete обрабатывает массив объектов клиента, возвращаемые службой и преобразует их в таблицу, которая отображается на странице. На рисунке 1 показана выходных данных, полученных из вызова.


[![Привязка данных, полученные путем внесения асинхронный вызов AJAX в веб-службу.](understanding-asp-net-ajax-web-services/_static/image2.png)](understanding-asp-net-ajax-web-services/_static/image1.png)

**Рис. 1**: привязки данных, полученные путем внесения асинхронный вызов AJAX в веб-службу.  ([Просмотр полноразмерное изображение](understanding-asp-net-ajax-web-services/_static/image3.png))


Прокси-серверы JavaScript также может направлять односторонние вызовы к веб-службам в случаях, когда веб-метод должен вызываться, но прокси-сервер не должен ожидать ответа. Например можно вызвать веб-службу для запуска процесса, такие как поток операций, но не ожидает значение, возвращаемое из службы. В случаях, где должен выполняться в службу односторонний вызов функции обратного вызова, приведен в Листинг 13 просто может быть опущено. Так как функция обратного вызова не определен объект прокси-сервера не будут ожидать веб-службы для возврата данных.

## <a name="handling-errors"></a>Обработка ошибок

Асинхронные обратные вызовы веб-служб могут возникнуть различные типы ошибок, такие как сети отключен, веб-служба недоступна или возвращается исключение. К счастью JavaScript прокси-объекты, созданные ScriptManager разрешить нескольких обратных вызовов необходимо определить для обработки ошибок и сбоев в дополнение к успешный обратный вызов, представленный выше. Функция обратного вызова ошибки можно определить сразу после функции standard обратного вызова в вызове метода веб-как показано в 14 со списком.

**Перечисление 14. Определение функции обратного вызова ошибки и отображения ошибок.**

[!code-javascript[Main](understanding-asp-net-ajax-web-services/samples/sample18.js)]

Любые ошибки, возникающие при вызове веб-службы вызовет функцию обратного вызова OnWSRequestFailed() для вызова, принимающий объект, представляющий ошибку как параметр. Ошибка объект предоставляет несколько различных функций, чтобы определить причину ошибки, хорошо ли вызов истекло время ожидания. Перечисление 14 показан пример использования функции различных ошибок и на рисунке 2 показан пример выходные данные функции.


[![Выходные данные, созданные путем вызова функции обработки ошибок ASP.NET AJAX.](understanding-asp-net-ajax-web-services/_static/image5.png)](understanding-asp-net-ajax-web-services/_static/image4.png)

**На рисунке 2**: выходные данные, созданные путем вызова функции обработки ошибок ASP.NET AJAX.  ([Просмотр полноразмерное изображение](understanding-asp-net-ajax-web-services/_static/image6.png))


## <a name="handling-xml-data-returned-from-a-web-service"></a>Обработка XML-данные, возвращенные из веб-службы

Ранее было показано, как веб-метод может возвращать необработанные данные XML с помощью атрибута ScriptMethod вместе с его свойство ResponseFormat. Если ResponseFormat имеет значение ResponseFormat.Xml, данные, возвращенные из веб-службы сериализуется как XML, а не в JSON. Это полезно в том случае, если XML-данные необходимо передать непосредственно клиенту для обработки с помощью JavaScript и XSLT. В настоящее время Internet Explorer 5 или более поздней версии обеспечивает лучшую модель объекта на стороне клиента для синтаксического анализа и фильтрация XML-данных из-за его встроенную поддержку MSXML.

Получение XML-данных из веб-службы ничем не отличается от получения других типов данных. Начните с прокси-сервера JavaScript вызовите нужную функцию и определить функцию обратного вызова. После возвращения вызова можно приступить к обработке данных в функции обратного вызова.

Перечисление 15 показан пример вызова веб-метода с именем GetRssFeed(), который возвращает объект XmlElement. GetRssFeed() принимает один параметр, представляющий URL-адрес RSS-канала для получения.

**Перечисление 15. Работа с XML-данные, возвращенные из веб-службы.**

[!code-html[Main](understanding-asp-net-ajax-web-services/samples/sample19.html)]

Этот пример передает URL-адрес RSS-канала и обрабатывает полученные данные XML в функции OnWSRequestComplete(). OnWSRequestComplete() сначала проверяет, находится ли браузер Internet Explorer, чтобы выяснить, доступен ли средство синтаксического анализа MSXML. Если это так, инструкции XPath используется для поиска всех &lt;элемент&gt; теги в RSS-канала. Каждый элемент затем итерация по и связанное с ним &lt;заголовок&gt; и &lt;ссылку&gt; расположен теги и их обработки в отображения каждого элемента данных. На рисунке 3 показан пример выходных внести какие-либо вызов через прокси JavaScript в веб-метода GetRssFeed() AJAX ASP.NET.

## <a name="handling-complex-types"></a>Обработка сложных типов

Сложные типы приняты или возвращаемых веб-службой, автоматически предоставляются через прокси JavaScript. Однако вложенные сложные типы не доступны непосредственно на стороне клиента Если атрибут GenerateScriptType не применяется к службе, как было сказано ранее. Зачем вам нужно использовать вложенного сложного типа на стороне клиента?

Чтобы ответить на этот вопрос, предполагается, что страницы ASP.NET AJAX отображаются данные клиентов и позволяет конечным пользователям обновлять адреса клиента. Если веб-служба указывает, что тип адреса (сложный тип, определенный в классе CustomerDetails) можно отправить клиенту процесс обновления может быть разделена на отдельные функции для улучшения кода повторного использования.


[![Создание из вызова веб-службы, который возвращает данные RSS выходные данные.](understanding-asp-net-ajax-web-services/_static/image8.png)](understanding-asp-net-ajax-web-services/_static/image7.png)

**Рис. 3**: Output создание из вызова веб-службы, который возвращает данные RSS.  ([Просмотр полноразмерное изображение](understanding-asp-net-ajax-web-services/_static/image9.png))


Перечисление 16 показывает пример клиентский код, вызывающий объект адрес, определенный в пространстве имен модели, заполняет его с использованием новых данных и присваивает его свойству объекта CustomerDetails адрес. CustomerDetails объект затем передается в веб-службу для обработки.

**Перечисление 16. Используя вложенные сложные типы**

[!code-javascript[Main](understanding-asp-net-ajax-web-services/samples/sample20.js)]

## <a name="creating-and-using-page-methods"></a>Создание и использование методов страницы

Веб-службы предоставляют прекрасный способ предоставления доступа к службам, повторно используется для различных клиентов, включая страницы ASP.NET AJAX. Тем не менее могут быть случаи, когда страницы необходимо извлекать данные, которые никогда не будет использоваться или общими для других страниц. В этом случае внесения ASMX-файл, чтобы разрешить доступ к данным страницы может показаться чрезмерными, поскольку служба используется только с одной страницы.

ASP.NET AJAX предоставляет еще один механизм для выполнения вызовов веб-службы по принципу без создания автономного ASMX-файлов. Для этого с помощью метода, называемый «страница методы». Страница метода являются статические (совместно используемый в VB.NET) внедряется в файл страницы или побочного кода, имеющие атрибут WebMethod, применяемый к ним. Путем применения атрибута WebMethod их можно вызывать с помощью специальных объекта JavaScript с именем PageMethods, который создается динамически во время выполнения. Объект PageMethods выступает в качестве прокси, который абстрагирует вам в процессе сериализации или десериализации JSON. Обратите внимание, что для использования объекта PageMethods необходимо ScriptManager EnablePageMethods свойству присвоено значение true.

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample21.aspx)]

Перечисление 17 показан пример определения две страницы методов в классе с кодом ASP.NET. Эти методы получения данных из бизнес-слоя классе в приложении\_папки с кодом веб-сайта.

**Перечисление 17. Определение методов страницы.**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample22.cs)]

Обнаружив веб-методов наличия ScriptManager на странице, он создает динамическую ссылку на объект PageMethods, приведенные выше. Вызов веб-метода достигается путем ссылки на класс PageMethods, за которым следует имя метода и все данные обязательный параметр, который должен быть передан. Перечисление 18 показаны примеры вызова двух методов страницы, показанного выше.

**Перечисление 18. Вызов методов страницы с PageMethods JavaScript объектом.**

[!code-javascript[Main](understanding-asp-net-ajax-web-services/samples/sample23.js)]

С помощью объекта PageMethods очень похоже на использование прокси-объект JavaScript. Сначала необходимо указать все данных параметра, которые должны быть переданы в метод страницы, а затем определите функцию обратного вызова, который должен вызываться при возвращении асинхронного вызова. Также можно указать обратный вызов ошибки (см. в список 14 пример обработки ошибок).

## <a name="the-autocompleteextender-and-the-aspnet-ajax-toolkit"></a>AutoCompleteExtender и набора средств ASP.NET AJAX

Набор средств ASP.NET AJAX (доступные из [http://ajax.asp.net](http://ajax.asp.net)) предлагает несколько элементов управления, которые могут использоваться для доступа к веб-служб. В частности, этот набор содержит полезные элемент управления с именем `AutoCompleteExtender` может использоваться для вызова веб-служб и отображение данных на страницах вообще без написания никакой код JavaScript.

AutoCompleteExtender управления можно использовать для расширения существующих функциональных возможностей текстового поля и помогают пользователям дополнительные упрощает поиск данных, которые они ищете. Вводе в текстовое поле элемента управления можно использовать для запроса веб-службе и динамически показывает результаты под текстовым полем. Рис. 4 приведен пример использования элемента управления AutoCompleteExtender, чтобы просмотреть идентификаторы клиента для поддержки приложения. Как пользователь вводит различные символы в текстовое поле, различных элементов отображается под ней на основе их входных данных. Затем пользователи могут выбрать идентификатор нужного клиента.

AutoCompleteExtender внутри страницы ASP.NET AJAX с помощью требует, что файл AjaxControlToolkit.dll сборки были добавлены в папку bin веб-сайта. После добавления сборку набора будет необходимо ссылаться на него в файле web.config, чтобы элементы управления, содержащиеся в нем доступны для всех страниц в приложении. Это можно сделать, добавив следующий тег в web.config &lt;элементов управления&gt; тег:

[!code-xml[Main](understanding-asp-net-ajax-web-services/samples/sample24.xml)]

В случаях, когда вам требуется использование элемента управления в определенную страницу можно создать ссылку путем добавления директивы ссылок в верхней части страницы, как показано далее, а не обновление файла web.config:

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample25.aspx)]


[![С помощью элемента управления AutoCompleteExtender.](understanding-asp-net-ajax-web-services/_static/image11.png)](understanding-asp-net-ajax-web-services/_static/image10.png)

**Рис. 4**: с помощью элемента управления AutoCompleteExtender.  ([Просмотр полноразмерное изображение](understanding-asp-net-ajax-web-services/_static/image12.png))


После настройки веб-сайт для использования набора средств ASP.NET AJAX, элемент управления AutoCompleteExtender можно добавить на страницу гораздо так, будто бы добавить регулярных серверный элемент управления ASP.NET. Перечисление 19 показан пример использования элемента управления для вызова веб-службы.

**Перечисление 19. С помощью элемента управления ASP.NET AJAX Toolkit AutoCompleteExtender.**

[!code-aspx[Main](understanding-asp-net-ajax-web-services/samples/sample26.aspx)]

AutoCompleteExtender имеет несколько различных свойств, включая стандартные свойства ID и runat, найденных на серверных элементов управления. Помимо этого можно задать число знаков, типов конечных пользователей перед веб-службы запрашиваются данные. Свойства MinimumPrefixLength, показанного в листинг 19 приводит к служба должна вызываться каждый раз, когда символ в текстовом поле. Может потребоваться следите за тем, что установка этого значения, так как каждый раз при вводе очередного знака веб-службы будет вызван для поиска значений, соответствующих символов в текстовом поле. Для вызова веб-службы, а также указывать веб-метода определяются с помощью свойства ServicePath и ServiceMethod, соответственно. Наконец свойство TargetControlID указывает какие текстовое отключают AutoCompleteExtender элемента управления.

Вызов веб-службы должен иметь атрибут ScriptService как было сказано ранее и целевой веб-метода должно принимать два параметра с именем prefixText и count. Параметр prefixText представляет вводимые конечным пользователем символы и параметр count представляет количество элементов для возврата (значение по умолчанию — 10). Перечисление 20 показан пример вызывается элементом управления AutoCompleteExtender, приведенными выше в листинг 19 GetCustomerIDs веб-метода. Веб-метод вызывает метод слоя бизнеса, в свою очередь вызывает данных слоя метод, обрабатывающий фильтрации данных и возвращения результатов сопоставления. Код для метода уровня данных отображается в листинг 21.

**Перечисление 20. Фильтрация данных, отправленных из элемента управления AutoCompleteExtender.**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample27.cs)]

**Перечисление 21. Фильтрация результатов на основе входных данных конечного пользователя.**

[!code-csharp[Main](understanding-asp-net-ajax-web-services/samples/sample28.cs)]

## <a name="conclusion"></a>Заключение

ASP.NET AJAX предоставляет отличную поддержку для вызова веб-служб без написания большого объема настраиваемый код JavaScript для обработки сообщений запросов и ответов. В этой статье рассмотрены способы AJAX enable .NET веб-служб, чтобы включить их для обработки сообщений JSON и определения прокси-серверы JavaScript с помощью элемента управления ScriptManager. Также вы знаете, как JavaScript, прокси-серверы можно использовать для вызова веб-службы обработки простых и сложных типов и обрабатывать сбои. Наконец вы знаете, как методы страницы позволяет упростить процесс создания и вызова веб-службы и как AutoCompleteExtender управления можно предоставить справку для конечных пользователей при их вводе. Несмотря на то, что в ASP.NET AJAX UpdatePanel наверняка будет управления выбором для многие программисты AJAX из-за его простоты, зная, как вызвать веб-служб через прокси JavaScript можно использовать во многих приложениях.

## <a name="bio"></a>Биография

Дэн Wahlin (наиболее ценные Майкрософт для ASP.NET и веб-служб XML) — .NET разработки инструктора и архитектура консультант по технической подготовке интерфейса ([http://www.interfacett.com](http://www.interfacett.com)). Дэн основал XML для разработчиков веб-сайт ASP.NET ([www.XMLforASP.NET](http://www.XMLforASP.NET)), на динамик является бюро и выступает на конференции несколько. Dan, выпущенной ДНК Windows Professional (Wrox) ASP.NET: советы, учебники и код (SAM), ASP.NET 1.1 предварительной оценки решений, Professional ASP.NET 2.0 AJAX (Wrox), взломает MVP ASP.NET 2.0 и XML, созданные для разработчиков на ASP.NET (SAM). Когда он не записывает код, статей или книг, Dan получает записи и записи музыки и воспроизведения Гольф и Баскетбольная с его жена и детей.

Скотт кате работает с веб-технологиями Майкрософт с 1997 и – президент myKB.com ([www.myKB.com](http://www.myKB.com)) приложений, основное внимание уделено базы знаний программные решения, где он специализируется на написание ASP.NET на основе. Скотт можно обратиться по электронной почте [ scott.cate@myKB.com ](mailto:scott.cate@myKB.com) или его блог по [ScottCate.com](http://ScottCate.com)

>[!div class="step-by-step"]
[Назад](understanding-asp-net-ajax-localization.md)
[Вперед](understanding-asp-net-ajax-debugging-capabilities.md)
