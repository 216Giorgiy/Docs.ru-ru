---
uid: web-forms/overview/older-versions-getting-started/master-pages/interacting-with-the-content-page-from-the-master-page-cs
title: "Взаимодействие со страницей содержимого из главной страницы (C#) | Документы Microsoft"
author: rick-anderson
description: "Рассматривается вызывать методы, задайте свойства, т. д., страницы содержимого из кода на главной странице."
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/11/2008
ms.topic: article
ms.assetid: 3282df5e-516c-4972-8666-313828b90fb5
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/master-pages/interacting-with-the-content-page-from-the-master-page-cs
msc.type: authoredcontent
ms.openlocfilehash: 4d7f6eeac084f3516ab470adf8973351cf08a7f1
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2018
---
<a name="interacting-with-the-content-page-from-the-master-page-c"></a><span data-ttu-id="9a5ff-103">Взаимодействие со страницей содержимого из главной страницы (C#)</span><span class="sxs-lookup"><span data-stu-id="9a5ff-103">Interacting with the Content Page from the Master Page (C#)</span></span>
====================
<span data-ttu-id="9a5ff-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="9a5ff-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="9a5ff-105">[Загрузить код](http://download.microsoft.com/download/1/8/4/184e24fa-fcc8-47fa-ac99-4b6a52d41e97/ASPNET_MasterPages_Tutorial_07_CS.zip) или [скачать PDF](http://download.microsoft.com/download/e/b/4/eb4abb10-c416-4ba4-9899-32577715b1bd/ASPNET_MasterPages_Tutorial_07_CS.pdf)</span><span class="sxs-lookup"><span data-stu-id="9a5ff-105">[Download Code](http://download.microsoft.com/download/1/8/4/184e24fa-fcc8-47fa-ac99-4b6a52d41e97/ASPNET_MasterPages_Tutorial_07_CS.zip) or [Download PDF](http://download.microsoft.com/download/e/b/4/eb4abb10-c416-4ba4-9899-32577715b1bd/ASPNET_MasterPages_Tutorial_07_CS.pdf)</span></span>

> <span data-ttu-id="9a5ff-106">Рассматривается вызывать методы, задайте свойства, т. д., страницы содержимого из кода на главной странице.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-106">Examines how to call methods, set properties, etc. of the Content Page from code in the Master Page.</span></span>


## <a name="introduction"></a><span data-ttu-id="9a5ff-107">Вступление</span><span class="sxs-lookup"><span data-stu-id="9a5ff-107">Introduction</span></span>

<span data-ttu-id="9a5ff-108">Предыдущего учебника рассматривалось имеют программного взаимодействия с главной страницей по страницы содержимого.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-108">The preceding tutorial examined how to have the content page programmatically interact with its master page.</span></span> <span data-ttu-id="9a5ff-109">Отзыв, обновлены главной страницы для включения элемента управления GridView, перечислены пять недавно добавлены продуктов.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-109">Recall that we updated the master page to include a GridView control that listed the five most recently added products.</span></span> <span data-ttu-id="9a5ff-110">Затем мы создали страницу содержимого, с помощью которой пользователь может добавить новый продукт.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-110">We then created a content page from which the user could add a new product.</span></span> <span data-ttu-id="9a5ff-111">При добавлении нового продукта, страницы содержимого необходимо указать главную страницу, чтобы обновить его GridView, чтобы он включает только что добавленные продукта.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-111">Upon adding a new product, the content page needed to instruct the master page to refresh its GridView so that it would include the just-added product.</span></span> <span data-ttu-id="9a5ff-112">Эта функциональность выполнялось путем добавления открытого метода на главную страницу, чтобы обновить данные, привязанные к GridView и затем вызова этого метода со страницы содержимого.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-112">This functionality was accomplished by adding a public method to the master page that refreshed the data bound to the GridView, and then invoking that method from the content page.</span></span>

<span data-ttu-id="9a5ff-113">Наиболее распространенная форма взаимодействие главной страницы и содержимое исходит от содержимого страницы.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-113">The most common form of content and master page interaction originates from the content page.</span></span> <span data-ttu-id="9a5ff-114">Тем не менее возможно для главной страницы для Русом текущей страницы содержимого в действие, и такие функциональные возможности, которые могут быть необходимы, если главная страница содержит элементы пользовательского интерфейса, которые позволяют пользователям изменять данные, также отображается на странице содержимого.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-114">However, it is possible for the master page to rouse the current content page into action, and such functionality may be needed if the master page contains user interface elements that enable users to modify data that is also displayed on the content page.</span></span> <span data-ttu-id="9a5ff-115">Рассмотрим страницы содержимого, что контролировать отображение сведений о продуктах в элементе управления GridView и управлять Главная страница, отображается кнопка, при нажатии, удваивает цены всех продуктов.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-115">Consider a content page that displays the products information in a GridView control and a master page that includes a Button control that, when clicked, doubles the prices of all products.</span></span> <span data-ttu-id="9a5ff-116">Подобно примере в предыдущем учебнике GridView нуждается в обновлении после двойной цену, которая кнопки, чтобы он отображал новым ценам, но в этом случае это главной страницы, которую нужно Русом содержимого страницы в действие.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-116">Much like the example in the preceding tutorial, the GridView needs to be refreshed after the double price Button is clicked so that it displays the new prices, but in this scenario it's the master page that needs to rouse the content page into action.</span></span>

<span data-ttu-id="9a5ff-117">Этот учебник демонстрирует, как с имеют вызова функций, определенных на странице содержимого главной страницы.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-117">This tutorial explores how to have the master page invoke functionality defined in the content page.</span></span>

### <a name="instigating-programmatic-interaction-via-an-event-and-event-handlers"></a><span data-ttu-id="9a5ff-118">Instigating программного взаимодействия с помощью события и обработчики событий</span><span class="sxs-lookup"><span data-stu-id="9a5ff-118">Instigating Programmatic Interaction via an Event and Event Handlers</span></span>

<span data-ttu-id="9a5ff-119">Вызов функции страницы содержимого на главной странице сложнее, чем в обратном направлении.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-119">Invoking content page functionality from a master page is more challenging than the other way around.</span></span> <span data-ttu-id="9a5ff-120">Так как страницы содержимого имеет одну главную страницу, при instigating программного взаимодействия со страницы содержимого мы знаем, что открытые методы и свойства, в своем распоряжении.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-120">Because a content page has a single master page, when instigating the programmatic interaction from the content page we know what public methods and properties are at our disposal.</span></span> <span data-ttu-id="9a5ff-121">Однако главной страницы, может иметь много различных страницы содержимого, каждый из которых свой собственный набор свойств и методов.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-121">A master page, however, can have many different content pages, each with its own set of properties and methods.</span></span> <span data-ttu-id="9a5ff-122">Как это сделать затем мы пишут код на главной странице, для выполнения некоторых операций на странице его содержимого, если не знаете, какие страницы содержимого будет вызываться до времени выполнения?</span><span class="sxs-lookup"><span data-stu-id="9a5ff-122">How, then, can we write code in the master page to perform some action in its content page when we don't know what content page will be invoked until runtime?</span></span>

<span data-ttu-id="9a5ff-123">Рассмотрите возможность элемента управления ASP.NET, такие как элемент управления Button.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-123">Consider an ASP.NET Web control, such as the Button control.</span></span> <span data-ttu-id="9a5ff-124">Элемент управления Button может использоваться в любом количестве страниц ASP.NET и необходим механизм, с помощью которого можно предупредить страницы, она была нажата.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-124">A Button control can appear on any number of ASP.NET pages and needs a mechanism by which it can alert the page that it has been clicked.</span></span> <span data-ttu-id="9a5ff-125">Это достигается с помощью *события*.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-125">This is accomplished using *events*.</span></span> <span data-ttu-id="9a5ff-126">В частности, этот элемент управления вызывает его `Click` событие при щелчке; страница ASP.NET, которая содержит кнопку, при необходимости может отвечать на уведомления о через *обработчик событий*.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-126">In particular, the Button control raises its `Click` event when it is clicked; the ASP.NET page that contains the Button can optionally respond to that notification via an *event handler*.</span></span>

<span data-ttu-id="9a5ff-127">Можно использовать этот же шаблон имеет функции, триггера главной страницы в его страниц:</span><span class="sxs-lookup"><span data-stu-id="9a5ff-127">This same pattern can be used to have a master page trigger functionality in its content pages:</span></span>

1. <span data-ttu-id="9a5ff-128">Добавьте событие на главную страницу.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-128">Add an event to the master page.</span></span>
2. <span data-ttu-id="9a5ff-129">Вызов событий, при необходимости взаимодействовать с его страницы содержимого главной страницы.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-129">Raise the event whenever the master page needs to communicate with its content page.</span></span> <span data-ttu-id="9a5ff-130">Например если главная страница должен его содержимого страница оповещений, что пользователь возросло вдвое цены, событию должно порождаться сразу после удвоения цены.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-130">For example, if the master page needs to alert its content page that the user has doubled the prices, its event would be raised immediately after the prices have been doubled.</span></span>
3. <span data-ttu-id="9a5ff-131">Создайте обработчик событий на этих страницах, потребуется выполнить некоторые действия.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-131">Create an event handler in those content pages that need to take some action.</span></span>

<span data-ttu-id="9a5ff-132">В остальной части этого учебника реализует пример, описанные во введении; а именно страницы содержимого, в которой перечислены продукты, в базе данных и Главная страница, отображается кнопка Управление дважды цены.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-132">This remainder of this tutorial implements the example outlined in the Introduction; namely, a content page that lists the products in the database and a master page that includes a Button control to double the prices.</span></span>

## <a name="step-1-displaying-products-in-a-content-page"></a><span data-ttu-id="9a5ff-133">Шаг 1: Отображение продукты на странице содержимого</span><span class="sxs-lookup"><span data-stu-id="9a5ff-133">Step 1: Displaying Products in a Content Page</span></span>

<span data-ttu-id="9a5ff-134">Наш компаниям в первую очередь является создание страницы содержимого, в которой перечислены продукты из базы данных Northwind.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-134">Our first order of business is to create a content page that lists the products from the Northwind database.</span></span> <span data-ttu-id="9a5ff-135">(Мы добавили базы данных Northwind в проект в предыдущем учебнике [ *взаимодействия с главной страницы на странице содержимого*](interacting-with-the-master-page-from-the-content-page-cs.md).) Начните с добавления новой страницы ASP.NET `~/Admin` папку с именем `Products.aspx`, позволяя следует привязать его к `Site.master` главной страницы.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-135">(We added the Northwind database to the project in the preceding tutorial, [*Interacting with the Master Page from the Content Page*](interacting-with-the-master-page-from-the-content-page-cs.md).) Start by adding a new ASP.NET page to the `~/Admin` folder named `Products.aspx`, making sure to bind it to the `Site.master` master page.</span></span> <span data-ttu-id="9a5ff-136">Рис. 1 показан обозреватель решений после добавления этой страницы на веб-сайт.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-136">Figure 1 shows the Solution Explorer after this page has been added to the website.</span></span>


<span data-ttu-id="9a5ff-137">[![Добавить новую страницу ASP.NET в папку Admin](interacting-with-the-content-page-from-the-master-page-cs/_static/image2.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="9a5ff-137">[![Add a New ASP.NET Page to the Admin Folder](interacting-with-the-content-page-from-the-master-page-cs/_static/image2.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image1.png)</span></span>

<span data-ttu-id="9a5ff-138">**На рисунке 01**: добавьте новую страницу ASP.NET в `Admin` папку ([Просмотр полноразмерное изображение](interacting-with-the-content-page-from-the-master-page-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="9a5ff-138">**Figure 01**: Add a New ASP.NET Page to the `Admin` Folder ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image3.png))</span></span>


<span data-ttu-id="9a5ff-139">Помните, что в [ *указанием заголовка, мета-теги и другие заголовки HTML на главной странице* ](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md) учебник, созданную пользовательскую страницу базовый класс с именем `BasePage` , создающий заголовок страницы, если это не так явным образом задайте.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-139">Recall that in the [*Specifying the Title, Meta Tags, and Other HTML Headers in the Master Page*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md) tutorial we created a custom base page class named `BasePage` that generates the page's title if it is not explicitly set.</span></span> <span data-ttu-id="9a5ff-140">Последовательно выберите пункты `Products.aspx` на странице кода класса и его производные от `BasePage` (вместо из `System.Web.UI.Page`).</span><span class="sxs-lookup"><span data-stu-id="9a5ff-140">Go to the `Products.aspx` page's code-behind class and have it derive from `BasePage` (instead of from `System.Web.UI.Page`).</span></span>

<span data-ttu-id="9a5ff-141">Наконец, обновите `Web.sitemap` файл, чтобы включить запись для этого занятия.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-141">Finally, update the `Web.sitemap` file to include an entry for this lesson.</span></span> <span data-ttu-id="9a5ff-142">Добавьте следующую разметку под `<siteMapNode>` содержимого взаимодействия страницы Master занятию:</span><span class="sxs-lookup"><span data-stu-id="9a5ff-142">Add the following markup beneath the `<siteMapNode>` for the Content to Master Page Interaction lesson:</span></span>


[!code-xml[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample1.xml)]

<span data-ttu-id="9a5ff-143">Добавление этого `<siteMapNode>` элемент отражается на занятиях списком (см. рис. 5).</span><span class="sxs-lookup"><span data-stu-id="9a5ff-143">The addition of this `<siteMapNode>` element is reflected in the Lessons list (see Figure 5).</span></span>

<span data-ttu-id="9a5ff-144">Вернитесь к `Products.aspx`.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-144">Return to `Products.aspx`.</span></span> <span data-ttu-id="9a5ff-145">В элементе управления содержимым для `MainContent`, добавление элемента управления GridView и назовите его `ProductsGrid`.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-145">In the Content control for `MainContent`, add a GridView control and name it `ProductsGrid`.</span></span> <span data-ttu-id="9a5ff-146">Привязка GridView для нового элемента управления SqlDataSource с именем `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-146">Bind the GridView to a new SqlDataSource control named `ProductsDataSource`.</span></span>


<span data-ttu-id="9a5ff-147">[![Привязка GridView для нового элемента управления SqlDataSource](interacting-with-the-content-page-from-the-master-page-cs/_static/image5.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="9a5ff-147">[![Bind the GridView to a New SqlDataSource Control](interacting-with-the-content-page-from-the-master-page-cs/_static/image5.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image4.png)</span></span>

<span data-ttu-id="9a5ff-148">**На рисунке 02**: привязка GridView для нового элемента управления SqlDataSource ([Просмотр полноразмерное изображение](interacting-with-the-content-page-from-the-master-page-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="9a5ff-148">**Figure 02**: Bind the GridView to a New SqlDataSource Control  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image6.png))</span></span>


<span data-ttu-id="9a5ff-149">Настройте мастер, чтобы он использовал базу данных Northwind.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-149">Configure the wizard so that it uses the Northwind database.</span></span> <span data-ttu-id="9a5ff-150">Если вы работали через работу с предыдущим учебником, то необходимо иметь строка подключения с именем `NorthwindConnectionString` в `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-150">If you worked through the previous tutorial then you should already have a connection string named `NorthwindConnectionString` in `Web.config`.</span></span> <span data-ttu-id="9a5ff-151">Выберите из раскрывающегося списка, эта строка подключения, как показано на рис. 3.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-151">Choose this connection string from the drop-down list, as shown in Figure 3.</span></span>


<span data-ttu-id="9a5ff-152">[![Настройка SqlDataSource для использования базы данных Northwind](interacting-with-the-content-page-from-the-master-page-cs/_static/image8.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="9a5ff-152">[![Configure the SqlDataSource to Use the Northwind Database](interacting-with-the-content-page-from-the-master-page-cs/_static/image8.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image7.png)</span></span>

<span data-ttu-id="9a5ff-153">**На рисунке 03**: Настройка SqlDataSource для использования базы данных Northwind ([Просмотр полноразмерное изображение](interacting-with-the-content-page-from-the-master-page-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="9a5ff-153">**Figure 03**: Configure the SqlDataSource to Use the Northwind Database  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image9.png))</span></span>


<span data-ttu-id="9a5ff-154">Затем укажите элемента управления источником данных `SELECT` инструкции, выбрав таблицы Products из раскрывающегося списка и возвращение `ProductName` и `UnitPrice` столбцов (см. рис. 4).</span><span class="sxs-lookup"><span data-stu-id="9a5ff-154">Next, specify the data source control's `SELECT` statement by choosing the Products table from the drop-down list and returning the `ProductName` and `UnitPrice` columns (see Figure 4).</span></span> <span data-ttu-id="9a5ff-155">Нажмите кнопку Далее, а затем завершить работу мастера настройки источника данных.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-155">Click Next and then Finish to complete the Configure Data Source wizard.</span></span>


<span data-ttu-id="9a5ff-156">[![Возвращают ProductName и UnitPrice поля из таблицы Products](interacting-with-the-content-page-from-the-master-page-cs/_static/image11.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="9a5ff-156">[![Return the ProductName and UnitPrice Fields from the Products Table](interacting-with-the-content-page-from-the-master-page-cs/_static/image11.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image10.png)</span></span>

<span data-ttu-id="9a5ff-157">**На рисунке 04**: возвращать `ProductName` и `UnitPrice` поля из `Products` таблицы ([Просмотр полноразмерное изображение](interacting-with-the-content-page-from-the-master-page-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="9a5ff-157">**Figure 04**: Return the `ProductName` and `UnitPrice` Fields from the `Products` Table  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image12.png))</span></span>


<span data-ttu-id="9a5ff-158">Это все, чтобы он!</span><span class="sxs-lookup"><span data-stu-id="9a5ff-158">That's all there is to it!</span></span> <span data-ttu-id="9a5ff-159">После завершения работы мастера Visual Studio добавляет два стояли GridView зеркальное отображение двух полей, возвращаемых элементом управления SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-159">After completing the wizard Visual Studio adds two BoundFields to the GridView to mirror the two fields returned by the SqlDataSource control.</span></span> <span data-ttu-id="9a5ff-160">Разметка GridView и SqlDataSource управления следует.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-160">The GridView and SqlDataSource controls' markup follows.</span></span> <span data-ttu-id="9a5ff-161">На рисунке 5 показаны результаты при просмотре через браузер.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-161">Figure 5 shows the results when viewed through a browser.</span></span>


[!code-aspx[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample2.aspx)]


<span data-ttu-id="9a5ff-162">[![Указано каждого продукта и его цена в GridView](interacting-with-the-content-page-from-the-master-page-cs/_static/image14.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="9a5ff-162">[![Each Product and its Price is Listed in the GridView](interacting-with-the-content-page-from-the-master-page-cs/_static/image14.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image13.png)</span></span>

<span data-ttu-id="9a5ff-163">**На рисунке 05**: указано каждого продукта и его цена в GridView ([Просмотр полноразмерное изображение](interacting-with-the-content-page-from-the-master-page-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="9a5ff-163">**Figure 05**: Each Product and its Price is Listed in the GridView  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image15.png))</span></span>


> [!NOTE]
> <span data-ttu-id="9a5ff-164">Вы можете очистить внешний вид элемента управления GridView.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-164">Feel free to clean up the appearance of the GridView.</span></span> <span data-ttu-id="9a5ff-165">Некоторые рекомендации включают форматирования отображаемого значения UnitPrice как денежное значение и использование шрифтов и цветов фона для улучшить внешний вид сетки.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-165">Some suggestions include formatting the displayed UnitPrice value as a currency and using background colors and fonts to improve the grid's appearance.</span></span> <span data-ttu-id="9a5ff-166">Дополнительные сведения о отображения и форматирования данных в ASP.NET см. в мой [работа с учебника ряда данных](../../data-access/index.md).</span><span class="sxs-lookup"><span data-stu-id="9a5ff-166">For more information on displaying and formatting data in ASP.NET, refer to my [Working with Data tutorial series](../../data-access/index.md).</span></span>


## <a name="step-2-adding-a-double-prices-button-to-the-master-page"></a><span data-ttu-id="9a5ff-167">Шаг 2: Добавление кнопки двойные цены на главную страницу</span><span class="sxs-lookup"><span data-stu-id="9a5ff-167">Step 2: Adding a Double Prices Button to the Master Page</span></span>

<span data-ttu-id="9a5ff-168">Теперь нам является, чтобы добавить кнопку веб-элемент управления, в образце странице, при щелчке будет double цену всех продуктов в базе данных.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-168">Our next task is to add a Button Web control to the master page that, when clicked, will double the price of all products in the database.</span></span> <span data-ttu-id="9a5ff-169">Откройте `Site.master` главную страницу и перетащите кнопку из панели элементов в конструктор, поместив ее под `RecentProductsDataSource` управления SqlDataSource, мы добавили в предыдущем учебнике.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-169">Open the `Site.master` master page and drag a Button from the Toolbox onto the Designer, placing it beneath the `RecentProductsDataSource` SqlDataSource control we added in the previous tutorial.</span></span> <span data-ttu-id="9a5ff-170">Настроить кнопку `ID` свойства `DoublePrice` и его `Text` свойства «Double цены продуктов».</span><span class="sxs-lookup"><span data-stu-id="9a5ff-170">Set the Button's `ID` property to `DoublePrice` and its `Text` property to "Double Product Prices".</span></span>

<span data-ttu-id="9a5ff-171">Добавьте элемент управления SqlDataSource главной страницы, присвоив ему имя `DoublePricesDataSource`.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-171">Next, add a SqlDataSource control to the master page, naming it `DoublePricesDataSource`.</span></span> <span data-ttu-id="9a5ff-172">Это SqlDataSource будет использоваться для выполнения `UPDATE` инструкции удвоить цены.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-172">This SqlDataSource will be used to execute the `UPDATE` statement to double all prices.</span></span> <span data-ttu-id="9a5ff-173">В частности, необходимо установить его `ConnectionString` и `UpdateCommand` свойства в строке подключения соответствующий и `UPDATE` инструкции.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-173">Specifically, we need to set its `ConnectionString` and `UpdateCommand` properties to the appropriate connection string and `UPDATE` statement.</span></span> <span data-ttu-id="9a5ff-174">Затем нужно вызвать этот элемент управления SqlDataSource `Update` метод при `DoublePrice` кнопки.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-174">Then we need to call this SqlDataSource control's `Update` method when the `DoublePrice` Button is clicked.</span></span> <span data-ttu-id="9a5ff-175">Чтобы задать `ConnectionString` и `UpdateCommand` свойства, выберите элемент управления SqlDataSource и перейдите в окно «Свойства».</span><span class="sxs-lookup"><span data-stu-id="9a5ff-175">To set the `ConnectionString` and `UpdateCommand` properties, select the SqlDataSource control and then go to the Properties window.</span></span> <span data-ttu-id="9a5ff-176">`ConnectionString` Строк подключения в уже сохранены в списках свойств `Web.config` в раскрывающемся списке; выберите `NorthwindConnectionString` как показано на рис. 6.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-176">The `ConnectionString` property lists those connection strings already stored in `Web.config` in a drop-down list; choose the `NorthwindConnectionString` option as shown in Figure 6.</span></span>


<span data-ttu-id="9a5ff-177">[![Настройка SqlDataSource для использования NorthwindConnectionString](interacting-with-the-content-page-from-the-master-page-cs/_static/image17.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="9a5ff-177">[![Configure the SqlDataSource to Use the NorthwindConnectionString](interacting-with-the-content-page-from-the-master-page-cs/_static/image17.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image16.png)</span></span>

<span data-ttu-id="9a5ff-178">**На рисунке 06**: Настройка SqlDataSource для использования `NorthwindConnectionString` ([Просмотр полноразмерное изображение](interacting-with-the-content-page-from-the-master-page-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="9a5ff-178">**Figure 06**: Configure the SqlDataSource to Use the `NorthwindConnectionString` ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image18.png))</span></span>


<span data-ttu-id="9a5ff-179">Чтобы задать `UpdateCommand` свойство, найдите параметр UpdateQuery в окне «Свойства».</span><span class="sxs-lookup"><span data-stu-id="9a5ff-179">To set the `UpdateCommand` property, locate the UpdateQuery option in the Properties window.</span></span> <span data-ttu-id="9a5ff-180">Это свойство, если флажок установлен, отображается кнопка с многоточием; Нажмите эту кнопку, чтобы отобразить диалоговое окно «Редактор команд и параметров» показано на рисунке 7.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-180">This property, when selected, displays a button with ellipses; click this button to display the Command and Parameter Editor dialog box shown in Figure 7.</span></span> <span data-ttu-id="9a5ff-181">Введите следующую команду `UPDATE` инструкции в текстовое поле диалогового окна:</span><span class="sxs-lookup"><span data-stu-id="9a5ff-181">Type the following `UPDATE` statement into the dialog box's textbox:</span></span>


[!code-sql[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample3.sql)]

<span data-ttu-id="9a5ff-182">Эта инструкция, при выполнении возрастет `UnitPrice` значение для каждой записи в `Products` таблицы.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-182">This statement, when executed, will double the `UnitPrice` value for each record in the `Products` table.</span></span>


<span data-ttu-id="9a5ff-183">[![Установите свойство UpdateCommand элемента SqlDataSource](interacting-with-the-content-page-from-the-master-page-cs/_static/image20.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="9a5ff-183">[![Set SqlDataSource's UpdateCommand Property](interacting-with-the-content-page-from-the-master-page-cs/_static/image20.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image19.png)</span></span>

<span data-ttu-id="9a5ff-184">**На рисунке 07**: задать SqlDataSource `UpdateCommand` свойство ([щелкните, чтобы просмотреть полноразмерное изображение](interacting-with-the-content-page-from-the-master-page-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="9a5ff-184">**Figure 07**: Set SqlDataSource's `UpdateCommand` Property  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image21.png))</span></span>


<span data-ttu-id="9a5ff-185">После настройки этих свойств, кнопки и SqlDataSource элементы управления должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="9a5ff-185">After setting these properties, your Button and SqlDataSource controls' declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample4.aspx)]

<span data-ttu-id="9a5ff-186">Остается только вызвать его `Update` метод при `DoublePrice` кнопки.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-186">All that remains is to call its `Update` method when the `DoublePrice` Button is clicked.</span></span> <span data-ttu-id="9a5ff-187">Создание `Click` обработчик событий для `DoublePrice` кнопку и добавьте следующий код:</span><span class="sxs-lookup"><span data-stu-id="9a5ff-187">Create a `Click` event handler for the `DoublePrice` Button and add the following code:</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample5.cs)]

<span data-ttu-id="9a5ff-188">Чтобы протестировать эти функции, посетите `~/Admin/Products.aspx` страницы, мы создали в шаге 1 и нажмите кнопку «Double цены продуктов».</span><span class="sxs-lookup"><span data-stu-id="9a5ff-188">To test this functionality, visit the `~/Admin/Products.aspx` page we created in Step 1 and click the "Double Product Prices" button.</span></span> <span data-ttu-id="9a5ff-189">Нажмите кнопку вызывает обратную передачу и выполняет `DoublePrice` кнопки `Click` обработчика событий, удваивать цены всех продуктов.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-189">Clicking the button causes a postback and executes the `DoublePrice` Button's `Click` event handler, doubling the prices of all products.</span></span> <span data-ttu-id="9a5ff-190">Затем повторно отображении страницы и разметку возвращается и снова отображается в браузере.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-190">The page is then re-rendered and the markup is returned and re-displayed in the browser.</span></span> <span data-ttu-id="9a5ff-191">GridView страницу содержимого, тем не менее, перечисляет цены такими же, как перед «Double цены продуктов» была нажата кнопка.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-191">The GridView in the content page, however, lists the same prices as before the "Double Product Prices" button was clicked.</span></span> <span data-ttu-id="9a5ff-192">Это из-за его состоянием, сохраненным в состояние представления, если это не запрещено повторно не загружаются при обратных передачах данных начальной загрузки в GridView.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-192">This is because the data initially loaded in the GridView had its state stored in view state, so it's not reloaded on postbacks unless instructed otherwise.</span></span> <span data-ttu-id="9a5ff-193">Если другой странице, а затем вернитесь к `~/Admin/Products.aspx` страницы, вы увидите обновленные цены.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-193">If you visit a different page and then return to the `~/Admin/Products.aspx` page you'll see the updated prices.</span></span>

## <a name="step-3-raising-an-event-when-the-prices-are-doubled"></a><span data-ttu-id="9a5ff-194">Шаг 3: Вызов события при цены вдвое</span><span class="sxs-lookup"><span data-stu-id="9a5ff-194">Step 3: Raising an Event When the Prices are Doubled</span></span>

<span data-ttu-id="9a5ff-195">Так как GridView в `~/Admin/Products.aspx` страницы не отражает немедленно удваивает цены, пользователь разумеется может показаться, что они не выбиралась кнопка «Double цены продуктов» или его не удалось запустить.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-195">Because the GridView in the `~/Admin/Products.aspx` page does not immediately reflect the price doubling, a user may understandably think that they did not click the "Double Product Prices" button, or that it didn't work.</span></span> <span data-ttu-id="9a5ff-196">Они могут щелкните правой кнопкой мыши кнопку еще несколько раз, снова и снова удваивает цены.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-196">They may try clicking the button a few more times, doubling the prices again and again.</span></span> <span data-ttu-id="9a5ff-197">Чтобы исправить это должен быть в содержимом сетки страница отображаться новым ценам, сразу же после их в два раза.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-197">To fix this we need to have the grid in the content page display the new prices immediately after they are doubled.</span></span>

<span data-ttu-id="9a5ff-198">Как было описано ранее в этом учебнике, необходимо инициировать событие на главной странице, когда пользователь нажимает `DoublePrice` кнопки.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-198">As discussed earlier in this tutorial, we need to raise an event in the master page whenever the user clicks the `DoublePrice` Button.</span></span> <span data-ttu-id="9a5ff-199">Событие — это возможность для одного класса (издатель событий) уведомления другой набор других классов (подписчики на события), что произошло что-нибудь интересное.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-199">An event is a way for one class (an event publisher) to notify another a set of other classes (the event subscribers) that something interesting has occurred.</span></span> <span data-ttu-id="9a5ff-200">В этом примере главная страница является издатель событий; их содержимое страницы, когда важна `DoublePrice` кнопки являются подписчиками.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-200">In this example, the master page is the event publisher; those content pages that care about when the `DoublePrice` Button is clicked are the subscribers.</span></span>

<span data-ttu-id="9a5ff-201">Класс подписывается на событие путем создания *обработчик событий*, — метод, который выполняется в ответ на события.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-201">A class subscribes to an event by creating an *event handler*, which is a method that is executed in response to the event being raised.</span></span> <span data-ttu-id="9a5ff-202">Издатель определяет события, которые он вызывает, определив *делегат события*.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-202">The publisher defines the events he raises by defining an *event delegate*.</span></span> <span data-ttu-id="9a5ff-203">Делегат события указывает, какие входные параметры, необходимо принять обработчик события.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-203">The event delegate specifies what input parameters the event handler must accept.</span></span> <span data-ttu-id="9a5ff-204">В платформе .NET Framework делегаты событий не возвращать значение и принимает два входных параметра:</span><span class="sxs-lookup"><span data-stu-id="9a5ff-204">In the .NET Framework, event delegates do not return any value and accept two input parameters:</span></span>

- <span data-ttu-id="9a5ff-205">`Object`, Который идентифицирует источник событий и</span><span class="sxs-lookup"><span data-stu-id="9a5ff-205">An `Object`, which identifies the event source, and</span></span>
- <span data-ttu-id="9a5ff-206">Класс, производный от`System.EventArgs`</span><span class="sxs-lookup"><span data-stu-id="9a5ff-206">A class derived from `System.EventArgs`</span></span>

<span data-ttu-id="9a5ff-207">Второй параметр, передаваемый обработчику событий может включать дополнительные сведения о событии.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-207">The second parameter passed to an event handler can include additional information about the event.</span></span> <span data-ttu-id="9a5ff-208">Хотя базовый `EventArgs` класса не передать информацию, платформа .NET Framework включает ряд классов, расширяющих `EventArgs` и включают в себя дополнительные свойства.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-208">While the base `EventArgs` class does not pass along any information, the .NET Framework includes a number of classes that extend `EventArgs` and encompass additional properties.</span></span> <span data-ttu-id="9a5ff-209">Например `CommandEventArgs` обработчиков событий, которые отвечают на передается экземпляр `Command` события и содержит два свойства информационное: `CommandArgument` и `CommandName`.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-209">For example, a `CommandEventArgs` instance is passed to event handlers that respond to the `Command` event, and includes two informational properties: `CommandArgument` and `CommandName`.</span></span>

> [!NOTE]
> <span data-ttu-id="9a5ff-210">Дополнительные сведения о создании вызову и обработке событий см. [события и делегаты](https://msdn.microsoft.com/library/17sde2xt.aspx) и [делегаты для событий в простой английской](http://www.codeproject.com/KB/cs/eventdelegates.aspx).</span><span class="sxs-lookup"><span data-stu-id="9a5ff-210">For more information on creating, raising, and handling events, see [Events and Delegates](https://msdn.microsoft.com/library/17sde2xt.aspx) and [Event Delegates in Simple English](http://www.codeproject.com/KB/cs/eventdelegates.aspx).</span></span>


<span data-ttu-id="9a5ff-211">Для определения события используйте следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="9a5ff-211">To define an event use the following syntax:</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample6.cs)]

<span data-ttu-id="9a5ff-212">Так как нам нужно оповещать страницы содержимого, когда пользователь нажал кнопку `DoublePrice` кнопку и нет необходимости передачи дополнительной информации, мы можем делегат события `EventHandler`, который определяет обработчик событий, который принимает как второй Тип объекта параметра `System.EventArgs`.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-212">Because we only need to alert the content page when the user has clicked the `DoublePrice` Button and do not need to pass along any other additional information, we can use the event delegate `EventHandler`, which defines an event handler that accepts as its second parameter an object of type `System.EventArgs`.</span></span> <span data-ttu-id="9a5ff-213">Чтобы создать событие на главной странице, добавьте следующую строку кода класса с выделенным кодом главной страницы:</span><span class="sxs-lookup"><span data-stu-id="9a5ff-213">To create the event in the master page, add the following line of code to the master page's code-behind class:</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample7.cs)]

<span data-ttu-id="9a5ff-214">Этот код добавляет открытое событие Главная страница с именем `PricesDoubled`.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-214">The above code adds a public event to the master page named `PricesDoubled`.</span></span> <span data-ttu-id="9a5ff-215">Теперь нам нужно вызывать это событие после удвоения цены.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-215">We now need to raise this event after the prices have been doubled.</span></span> <span data-ttu-id="9a5ff-216">Для вызова события используйте следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="9a5ff-216">To raise an event use the following syntax:</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample8.cs)]

<span data-ttu-id="9a5ff-217">Где *отправителя* и *eventArgs* — это значения, которые требуется передать в обработчик событий подписчика.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-217">Where *sender* and *eventArgs* are the values you want to pass to the subscriber's event handler.</span></span>

<span data-ttu-id="9a5ff-218">Обновление `DoublePrice` `Click` обработчик событий следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="9a5ff-218">Update the `DoublePrice` `Click` event handler with the following code:</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample9.cs)]

<span data-ttu-id="9a5ff-219">Как и раньше `Click` обработчик события запускается путем вызова `DoublePricesDataSource` управления SqlDataSource `Update` метод удвоить цены всех продуктов.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-219">As before, the `Click` event handler starts by calling the `DoublePricesDataSource` SqlDataSource control's `Update` method to double the prices of all products.</span></span> <span data-ttu-id="9a5ff-220">После того, что существуют две функции обработчика событий.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-220">Following that there are two additions to the event handler.</span></span> <span data-ttu-id="9a5ff-221">Во-первых, `RecentProducts` обновления данных в GridView.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-221">First, the `RecentProducts` GridView's data is refreshed.</span></span> <span data-ttu-id="9a5ff-222">Это GridView в предыдущем учебнике был добавлен на главную страницу и отображает продукты пять наиболее недавно был добавлен.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-222">This GridView was added to the master page in the preceding tutorial and displays the five most recently-added products.</span></span> <span data-ttu-id="9a5ff-223">Нам нужно обновить в этой сетке, чтобы отобразить его только что вдвое цены для этих пяти продуктов.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-223">We need to refresh this grid so that it shows the just-doubled prices for these five products.</span></span> <span data-ttu-id="9a5ff-224">Вслед за этим `PricesDoubled` события.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-224">Following that, the `PricesDoubled` event is raised.</span></span> <span data-ttu-id="9a5ff-225">Ссылка на главную страницу сам (`this`) отправляется в обработчик событий как источник события и пустой `EventArgs` объект отправляется как аргументы события.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-225">A reference to the master page itself (`this`) is sent to the event handler as the event source and an empty `EventArgs` object is sent as the event arguments.</span></span>

## <a name="step-4-handling-the-event-in-the-content-page"></a><span data-ttu-id="9a5ff-226">Шаг 4: Обработка событий на странице содержимого</span><span class="sxs-lookup"><span data-stu-id="9a5ff-226">Step 4: Handling the Event in the Content Page</span></span>

<span data-ttu-id="9a5ff-227">На этом этапе главной страницы вызывает его `PricesDoubled` событие каждый раз, когда `DoublePrice` нажатии кнопки элемента управления.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-227">At this point the master page raises its `PricesDoubled` event whenever the `DoublePrice` Button control is clicked.</span></span> <span data-ttu-id="9a5ff-228">Тем не менее это только залог успеха: нам по-прежнему необходимо обработать событие в подписчике.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-228">However, this is only half the battle - we still need to handle the event in the subscriber.</span></span> <span data-ttu-id="9a5ff-229">Это происходит в два этапа: Создание обработчика событий и Добавление события код, чтобы при возникновении события выполняется обработчик события.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-229">This involves two steps: creating the event handler and adding event wiring code so that when the event is raised the event handler is executed.</span></span>

<span data-ttu-id="9a5ff-230">Для начала необходимо создать обработчик событий с именем `Master_PricesDoubled`.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-230">Start by creating an event handler named `Master_PricesDoubled`.</span></span> <span data-ttu-id="9a5ff-231">Из-за как мы определили `PricesDoubled` событий на главной странице два входных параметра обработчик события должны иметь типы `Object` и `EventArgs`соответственно.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-231">Because of how we defined the `PricesDoubled` event in the master page the event handler's two input parameters must be of types `Object` and `EventArgs`, respectively.</span></span> <span data-ttu-id="9a5ff-232">В вызове обработчика событий `ProductsGrid` элемента GridView `DataBind` метода для повторной привязки данных в сетке.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-232">In the event handler call the `ProductsGrid` GridView's `DataBind` method to rebind the data to the grid.</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample10.cs)]

<span data-ttu-id="9a5ff-233">Полный код для обработчика событий, но еще не знаем передачи главной страницы `PricesDoubled` события в этот обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-233">The code for the event handler is complete but we've yet to wire the master page's `PricesDoubled` event to this event handler.</span></span> <span data-ttu-id="9a5ff-234">Подписчик связывает событие обработчика событий, используется следующий синтаксис:</span><span class="sxs-lookup"><span data-stu-id="9a5ff-234">The subscriber wires an event to an event handler via the following syntax:</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample11.cs)]

<span data-ttu-id="9a5ff-235">*издатель* является ссылкой на объект, который предоставляет события *eventName*, и *имя_метода* имя обработчика событий, определенных в подписчике, имеет соответствующий подписи Чтобы *eventDelegate*.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-235">*publisher* is a reference to the object that offers the event *eventName*, and *methodName* is the name of the event handler defined in the subscriber that has a signature corresponding to the *eventDelegate*.</span></span> <span data-ttu-id="9a5ff-236">Другими словами, если делегата события — `EventHandler`, затем *имя_метода* должно быть имя метода в подписчике, который не возвращает значение и принимает два входных параметра типов `Object` и `EventArgs`, соответственно.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-236">In other words, if the event delegate is `EventHandler`, then *methodName* must be the name of a method in the subscriber that does not return a value and accepts two input parameters of types `Object` and `EventArgs`, respectively.</span></span>

<span data-ttu-id="9a5ff-237">Этот код события должна быть выполнена на первом посещении страницы и последующих обратных передачах и должно выполняться в момент, предшествующий при событие может быть вызвано жизненного цикла страницы.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-237">This event wiring code must be executed on the first page visit and subsequent postbacks and should occur at a point in the page lifecycle that precedes when the event may be raised.</span></span> <span data-ttu-id="9a5ff-238">Подходящий момент, чтобы добавить событие код находится в стадии PreInit происходит очень рано в жизненном цикле страницы.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-238">A good time to add event wiring code is in the PreInit stage, which occurs very early in the page lifecycle.</span></span>

<span data-ttu-id="9a5ff-239">Откройте `~/Admin/Products.aspx` и создать `Page_PreInit` обработчик событий:</span><span class="sxs-lookup"><span data-stu-id="9a5ff-239">Open `~/Admin/Products.aspx` and create a `Page_PreInit` event handler:</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample12.cs)]

<span data-ttu-id="9a5ff-240">Чтобы завершить этот код нужно программную ссылку на главную страницу со страницы содержимого.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-240">In order to complete this wiring code we need a programmatic reference to the master page from the content page.</span></span> <span data-ttu-id="9a5ff-241">Как отмечалось в предыдущем учебнике, существует два способа это сделать:</span><span class="sxs-lookup"><span data-stu-id="9a5ff-241">As noted in the previous tutorial, there are two ways to do this:</span></span>

- <span data-ttu-id="9a5ff-242">Путем приведения слабо типизированной `Page.Master` свойство в тип соответствующей главной страницы или</span><span class="sxs-lookup"><span data-stu-id="9a5ff-242">By casting the loosely-typed `Page.Master` property to the appropriate master page type, or</span></span>
- <span data-ttu-id="9a5ff-243">Добавив `@MasterType` директиву `.aspx` страницы, а затем использовать строго типизированный `Master` свойство.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-243">By adding a `@MasterType` directive in the `.aspx` page and then using the strongly-typed `Master` property.</span></span>

<span data-ttu-id="9a5ff-244">Воспользуемся последний подход.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-244">Let's use the latter approach.</span></span> <span data-ttu-id="9a5ff-245">Добавьте следующую `@MasterType` директиву в начало декларативная разметка страницы:</span><span class="sxs-lookup"><span data-stu-id="9a5ff-245">Add the following `@MasterType` directive to the top of the page's declarative markup:</span></span>


[!code-aspx[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample13.aspx)]

<span data-ttu-id="9a5ff-246">Затем добавьте следующий код привязки событий в `Page_PreInit` обработчик событий:</span><span class="sxs-lookup"><span data-stu-id="9a5ff-246">Then add the following event wiring code in the `Page_PreInit` event handler:</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample14.cs)]

<span data-ttu-id="9a5ff-247">Этот код в месте, GridView на странице содержимого обновляется каждый раз, когда `DoublePrice` кнопки.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-247">With this code in place, the GridView in the content page is refreshed whenever the `DoublePrice` Button is clicked.</span></span>

<span data-ttu-id="9a5ff-248">Это поведение иллюстрируют цифры 8 и 9.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-248">Figures 8 and 9 illustrate this behavior.</span></span> <span data-ttu-id="9a5ff-249">На рисунке 8 показана при первом посещении страницы.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-249">Figure 8 shows the page when first visited.</span></span> <span data-ttu-id="9a5ff-250">Обратите внимание, что значения по цене в обоих `RecentProducts` GridView (в левом столбце главной страницы) и `ProductsGrid` GridView (на странице содержимого).</span><span class="sxs-lookup"><span data-stu-id="9a5ff-250">Note that price values in both the `RecentProducts` GridView (in the left column of the master page) and the `ProductsGrid` GridView (in the content page).</span></span> <span data-ttu-id="9a5ff-251">Рис. 9 показана же экране сразу после `DoublePrice` была нажата кнопка.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-251">Figure 9 shows the same screen immediately after the `DoublePrice` Button has been clicked.</span></span> <span data-ttu-id="9a5ff-252">Как видите, новым ценам мгновенно отражаются в обоих GridViews.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-252">As you can see, the new prices are instantaneously reflected in both GridViews.</span></span>


<span data-ttu-id="9a5ff-253">[![Значения начального цен](interacting-with-the-content-page-from-the-master-page-cs/_static/image23.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="9a5ff-253">[![The Initial Price Values](interacting-with-the-content-page-from-the-master-page-cs/_static/image23.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image22.png)</span></span>

<span data-ttu-id="9a5ff-254">**На рисунке 08**: начальные значения цены ([Просмотр полноразмерное изображение](interacting-with-the-content-page-from-the-master-page-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="9a5ff-254">**Figure 08**: The Initial Price Values  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image24.png))</span></span>


<span data-ttu-id="9a5ff-255">[![В GridViews отображаются цены Just-Doubled](interacting-with-the-content-page-from-the-master-page-cs/_static/image26.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="9a5ff-255">[![The Just-Doubled Prices are Displayed in the GridViews](interacting-with-the-content-page-from-the-master-page-cs/_static/image26.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image25.png)</span></span>

<span data-ttu-id="9a5ff-256">**На рисунке 09**: The Just-Doubled цены отображаются в GridViews ([Просмотр полноразмерное изображение](interacting-with-the-content-page-from-the-master-page-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="9a5ff-256">**Figure 09**: The Just-Doubled Prices are Displayed in the GridViews  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image27.png))</span></span>


## <a name="summary"></a><span data-ttu-id="9a5ff-257">Сводка</span><span class="sxs-lookup"><span data-stu-id="9a5ff-257">Summary</span></span>

<span data-ttu-id="9a5ff-258">В идеальном случае главной страницы и его страниц полностью отделены друг от друга и уровень взаимодействия не требуется.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-258">Ideally, a master page and its content pages are completely separate from one another and require no level of interaction.</span></span> <span data-ttu-id="9a5ff-259">Тем не менее, при наличии главной страницы или страницы содержимого, которое отображает данные, которые могут быть изменены из главной страницы или страницы содержимого, затем может необходимо иметь на главную страницу предупреждения страницы содержимого (или наоборот a) при изменении данных, чтобы можно было обновить отображение.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-259">However, if you have a master page or content page that displays data that can be modified from the master page or content page, then you may need to have the master page alert the content page (or vice-a-versa) when data is modified so that the display can be updated.</span></span> <span data-ttu-id="9a5ff-260">В предыдущем учебнике мы узнали, как содержимое страницы программного взаимодействия с главной страницей по; в этом учебнике мы рассматривали как с главной страницы, инициирующего взаимодействие.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-260">In the preceding tutorial we saw how to have a content page programmatically interact with its master page; in this tutorial we looked at how to have a master page initiate the interaction.</span></span>

<span data-ttu-id="9a5ff-261">Хотя программного взаимодействия между содержимым и главной страницы могут исходить из главной страницы или содержимое, взаимодействие шаблон, используемый зависит от происхождения.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-261">While programmatic interaction between a content and master page can originate from either the content or master page, the interaction pattern used depends on the origination.</span></span> <span data-ttu-id="9a5ff-262">Имеются различия, из-за того, что страница содержимого состоит из одной главной страницы, но главная страница может иметь много различных страницы содержимого.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-262">The differences are due to the fact that a content page has a single master page, but a master page can have many different content pages.</span></span> <span data-ttu-id="9a5ff-263">Вместо того чтобы использовать главную страницу непосредственно взаимодействовать со страницей содержимого, лучше всего иметь главной страницы, которые вызывают события, чтобы сообщить, что некоторые было выполнено действие.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-263">Rather than having a master page directly interact with a content page, a better approach is to have the master page raise an event to signal that some action has taken place.</span></span> <span data-ttu-id="9a5ff-264">Эти страницы содержимого, которых интересует действие возможно создание обработчиков событий.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-264">Those content pages that care about the action can create event handlers.</span></span>

<span data-ttu-id="9a5ff-265">Программирование довольны!</span><span class="sxs-lookup"><span data-stu-id="9a5ff-265">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="9a5ff-266">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="9a5ff-266">Further Reading</span></span>

<span data-ttu-id="9a5ff-267">Дополнительные сведения по темам, рассматриваемые в этом учебнике см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="9a5ff-267">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="9a5ff-268">Просмотр и обновление данных в ASP.NET</span><span class="sxs-lookup"><span data-stu-id="9a5ff-268">Accessing and Updating Data in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/011106-1.aspx)
- [<span data-ttu-id="9a5ff-269">События и делегаты</span><span class="sxs-lookup"><span data-stu-id="9a5ff-269">Events and Delegates</span></span>](https://msdn.microsoft.com/library/17sde2xt.aspx)
- [<span data-ttu-id="9a5ff-270">Передача сведений об между содержимым и главных страниц</span><span class="sxs-lookup"><span data-stu-id="9a5ff-270">Passing Information Between Content and Master Pages</span></span>](http://aspnet.4guysfromrolla.com/articles/013107-1.aspx)
- [<span data-ttu-id="9a5ff-271">Работа с данными в учебниках ASP.NET</span><span class="sxs-lookup"><span data-stu-id="9a5ff-271">Working with Data in ASP.NET Tutorials</span></span>](../../data-access/index.md)

### <a name="about-the-author"></a><span data-ttu-id="9a5ff-272">Об авторе</span><span class="sxs-lookup"><span data-stu-id="9a5ff-272">About the Author</span></span>

<span data-ttu-id="9a5ff-273">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор по ASP/ASP.NET и основатель 4GuysFromRolla.com, работает с веб-технологиями Майкрософт с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-273">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="9a5ff-274">Скотт — независимый консультант, trainer и записи.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-274">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="9a5ff-275">Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 3.5 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="9a5ff-275">His latest book is [*Sams Teach Yourself ASP.NET 3.5 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco).</span></span> <span data-ttu-id="9a5ff-276">Скотт может быть достигнута по [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com) или через его блог по [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="9a5ff-276">Scott can be reached at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="9a5ff-277">Благодарности</span><span class="sxs-lookup"><span data-stu-id="9a5ff-277">Special Thanks To</span></span>

<span data-ttu-id="9a5ff-278">Этот учебник ряд прошел проверку многие полезные рецензентов.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-278">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="9a5ff-279">Основной рецензент этого учебника было Банерджи Suchi.</span><span class="sxs-lookup"><span data-stu-id="9a5ff-279">Lead reviewer for this tutorial was Suchi Banerjee.</span></span> <span data-ttu-id="9a5ff-280">Объясняются моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="9a5ff-280">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="9a5ff-281">Если Да, напишите мне по[mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9a5ff-281">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="9a5ff-282">[Назад](interacting-with-the-master-page-from-the-content-page-cs.md)
[Вперед](master-pages-and-asp-net-ajax-cs.md)</span><span class="sxs-lookup"><span data-stu-id="9a5ff-282">[Previous](interacting-with-the-master-page-from-the-content-page-cs.md)
[Next](master-pages-and-asp-net-ajax-cs.md)</span></span>
