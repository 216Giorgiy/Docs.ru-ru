---
uid: web-forms/overview/older-versions-getting-started/master-pages/interacting-with-the-master-page-from-the-content-page-cs
title: "Взаимодействие с главной страницы на странице содержимого (C#) | Документы Microsoft"
author: rick-anderson
description: "Рассматривается вызывать методы, задайте свойства, т. д., из главной страницы из кода на странице содержимого."
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/11/2008
ms.topic: article
ms.assetid: 32d54638-71b2-491d-81f4-f7417a13a62f
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/master-pages/interacting-with-the-master-page-from-the-content-page-cs
msc.type: authoredcontent
ms.openlocfilehash: 054c67ec7d7eec38d46933417930161a0edd5a60
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="interacting-with-the-master-page-from-the-content-page-c"></a>Взаимодействие с главной страницы на странице содержимого (C#)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить код](http://download.microsoft.com/download/1/8/4/184e24fa-fcc8-47fa-ac99-4b6a52d41e97/ASPNET_MasterPages_Tutorial_06_CS.zip) или [скачать PDF](http://download.microsoft.com/download/e/b/4/eb4abb10-c416-4ba4-9899-32577715b1bd/ASPNET_MasterPages_Tutorial_06_CS.pdf)

> Рассматривается вызывать методы, задайте свойства, т. д., из главной страницы из кода на странице содержимого.


## <a name="introduction"></a>Вступление

В течение последних пяти учебников рассматривалось как создание главной страницы, определить области содержимого, привязать к главной страницы страницы ASP.NET и содержимое страницы. Когда посетитель запрашивает определенной страницы содержимого, содержимое и главные страницы разметки совмещенного во время выполнения, возникающие при отрисовке иерархии единой системы управления. Таким образом, мы уже видели другом — способ главной страницы и один из его страниц могут взаимодействовать: страницы содержимого подробно рассматриваются разметки для transfuse в элементы управления ContentPlaceHolder главной страницы.

То, что у нас есть еще для анализа является главной страницы и страницы содержимого взаимодействие программными средствами. Кроме определения разметки для элементов управления ContentPlaceHolder на главной странице, страницы содержимого можно назначить значения свойствам открытого главной страницы и вызова его открытых методов. Аналогичным образом главной страницы может взаимодействовать с его страниц. Хотя программный взаимодействие между главной и содержимого страницы реже, чем взаимодействие между их декларативный пометки, существует множество сценариев, где требуются такие программного взаимодействия.

В этом учебнике рассматриваются как страницу содержимого программного взаимодействия с главной страницей по; в следующем уроке мы рассмотрим аналогично взаимодействие главной страницы с его страниц.

## <a name="examples-of-programmatic-interaction-between-a-content-page-and-its-master-page"></a>Примеры программного взаимодействия между содержимым и его главной страницы

При определенной области страницы должна быть настроена на основе страницу за страницей, мы используем управления ContentPlaceHolder. Но как обстоят дела ситуации, где большая часть страниц необходимо создавать определенные выходные данные, но небольшом количестве страниц требуется настроить его, чтобы увидеть что-нибудь еще? Например, который мы рассмотрели в [ *несколько и содержимого по умолчанию* ](multiple-contentplaceholders-and-default-content-cs.md) учебника предполагает отображение интерфейс входа на каждой странице. Хотя большая часть страниц должны включать интерфейс входа, должно быть подавлено для небольшое число страниц, таких как: страницы входа основной (`Login.aspx`); страницы; Создание учетной записи и других страниц, которые доступны только пользователям, прошедшим проверку. [ *Несколько и содержимого по умолчанию* ](multiple-contentplaceholders-and-default-content-cs.md) учебника было показано, как определить содержимое по умолчанию для ContentPlaceHolder на главной странице и затем его переопределение в этих страницах where нежелательно содержимого по умолчанию.

Другой вариант — создать открытые свойства или метода в главной страницы, которое указывает, следует ли отображать или скрывать интерфейс входа. Например, Главная страница может включать открытое свойство с именем `ShowLoginUI` , значение которого используется для задания `Visible` свойства элемента управления на главной странице входа. Эти страницы содержимого, где следует отключить пользовательский интерфейс входа в систему может затем программно задать `ShowLoginUI` свойства `false`.

Возможно наиболее распространенным примером взаимодействие главной страницы и содержимое возникает, когда данные отображаются в главной страницы должна обновляться после задан некоторых операций на странице содержимого. Рассмотрите возможность главной странице, которая содержит GridView, отображающий пять наиболее часто добавить записи из таблицы, определенной базы данных и что один из его страниц включает интерфейс для добавления новых записей в этой же таблицы.

Когда пользователь открывает страницу, чтобы добавить новую запись, она видит, что пяти добавленной самой последней записи в главной страницы. После заполнения значения для столбцов новой записи, она отправляет форму. Предположим, что имеется GridView на главной странице его `EnableViewState` свойство установлено в значение true (по умолчанию), его содержимое загружается из состояния представления и, соответственно, отображаются пять же записи, несмотря на то, что новая запись был только что добавлен в базу данных. Это может запутать пользователя.

> [!NOTE]
> Даже при отключении состояния представления GridView, чтобы он выполняет повторную привязку в источнике данных для каждой обратной передачи, он по-прежнему могут не отобразиться только что добавленные записи, так как данные будут привязаны к GridView ранее жизненного цикла страницы, чем при добавлении новой записи базы данных ASE.


Чтобы это исправить, чтобы отображалось только что добавленные записи на главной странице в GridView при обратной передаче, нам нужно указать GridView для повторной привязки к источнику данных *после* новой записи был добавлен в базу данных. Это требует взаимодействия между содержимым и главные страницы, так как интерфейс для добавления новой записи (и соответствующих обработчиков событий) находятся в страницы содержимого, но GridView, который должен быть обновлен на главной странице.

Поскольку обновление экрана главной страницы из обработчика событий на странице содержимого является одним из наиболее распространенных потребностей для содержимого и взаимодействия с главной страницы, давайте рассмотрим в этом разделе более подробно. В этом учебнике загружаемый файл содержит базы данных Microsoft SQL Server 2005 Express Edition, с именем `NORTHWIND.MDF` на веб-сайте `App_Data` папки. Базы данных Northwind хранит продукта, сотрудников и сведения о продажах для вымышленной компании Northwind Traders.

Шаг 1 последовательно описан отображения пяти недавно добавлено продуктов в GridView на главной странице. Шаг 2 создает страницу содержимого для добавления новых продуктов. Шаг 3 рассматривается создание открытым свойствам и методам в главной страницы и шаг 4 показано, как программным образом взаимодействовать с этим свойствам и методам со страницы содержимого.

> [!NOTE]
> Этот учебник не углубимся в особенности работы с данными в ASP.NET. Действия по настройке главной страницы для отображения данных и странице содержимого для вставки данных, завершено, пока breezy. Более подробное рассмотрение отображение и вставка данных с помощью элементов управления SqlDataSource и GridView, можно найти в источниках в разделе "Дополнительные материалы" в конце этого учебника.


## <a name="step-1-displaying-the-five-most-recently-added-products-in-the-master-page"></a>Шаг 1: Отображение пять недавно добавлено продуктов на главной странице

Откройте `Site.master` главную страницу и добавить метку и элемента управления GridView для `leftContent` `<div>`. Очистить метки `Text` , установите его `EnableViewState` свойству значение false и его `ID` свойства `GridMessage`; присвоить свойству `ID` свойства `RecentProducts`. Затем из конструктора, разверните GridView смарт-тег и выберите привязать его к новому источнику данных. Запустится мастер настройки источника данных. Так как база данных Northwind в `App_Data` папки — это база данных Microsoft SQL Server, выберите для создания SqlDataSource путем выбора (см. рис. 1); имя SqlDataSource `RecentProductsDataSource`.


[![Привязать элемент управления SqlDataSource с именем RecentProductsDataSource GridView](interacting-with-the-master-page-from-the-content-page-cs/_static/image2.png)](interacting-with-the-master-page-from-the-content-page-cs/_static/image1.png)

**На рисунке 01**: привязка GridView для элемента управления SqlDataSource с именем `RecentProductsDataSource` ([Просмотр полноразмерное изображение](interacting-with-the-master-page-from-the-content-page-cs/_static/image3.png))


Следующий шаг появляется запрос, чтобы указать, что базы данных для подключения к. Выберите `NORTHWIND.MDF` файла из раскрывающегося списка базы данных и нажмите кнопку Далее. Поскольку это первый раз, мы использовали эту базу данных, мастер предложит сохранить строку подключения в `Web.config`. Их хранение строки подключения, используя имя `NorthwindConnectionString`.


[![Подключиться к базе данных "Борей"](interacting-with-the-master-page-from-the-content-page-cs/_static/image5.png)](interacting-with-the-master-page-from-the-content-page-cs/_static/image4.png)

**На рисунке 02**: подключиться к базе данных "Борей" ([Просмотр полноразмерное изображение](interacting-with-the-master-page-from-the-content-page-cs/_static/image6.png))


Мастер настройки источника данных предоставляет два средства, с помощью которых можно указать запрос, используемый для извлечения данных:

- Указав пользовательские инструкции SQL или хранимой процедуры или
- Путем выбора таблицы или представления, а затем указать столбцы, возвращаемые

Поскольку нам требуется возвратить только пять недавно добавлен продуктов, нам нужно указать пользовательские инструкции SQL. Используйте следующий запрос SELECT:


[!code-sql[Main](interacting-with-the-master-page-from-the-content-page-cs/samples/sample1.sql)]

`TOP 5` Ключевое слово возвращает только первых пяти записей из запроса. `Products` Первичного ключа таблицы `ProductID`, является `IDENTITY` столбец, который гарантирует, что каждый новый продукт, добавляемой в таблицу будет больше предыдущей записи. Поэтому Сортировка результатов по `ProductID` в порядке убывания возвращает продуктов, начиная с наиболее недавно созданный из них.


[![Возвращает последнее добавленное пяти продуктов](interacting-with-the-master-page-from-the-content-page-cs/_static/image8.png)](interacting-with-the-master-page-from-the-content-page-cs/_static/image7.png)

**Рисунок 03**: возвращать пять наиболее недавно добавлено товаров ([Просмотр полноразмерное изображение](interacting-with-the-master-page-from-the-content-page-cs/_static/image9.png))


По завершении работы мастера Visual Studio создает два стояли для GridView для отображения `ProductName` и `UnitPrice` полей, возвращаемых из базы данных. На этом этапе декларативная разметка главной страницы должен содержать разметку следующего вида:


[!code-aspx[Main](interacting-with-the-master-page-from-the-content-page-cs/samples/sample2.aspx)]

Как видите, содержащий разметку: метка веб-управления (`GridMessage`); GridView `RecentProducts`с двумя стояли; и элемента управления SqlDataSource, возвращающий пять наиболее недавно добавленных продуктов.

С данным GridView создан и его настройки, управления SqlDataSource посетите веб-сайт с помощью браузера. Как показано на рис. 4, вы увидите, что сетки в левом нижнем углу, перечислены пять самых недавно добавлено продуктов.


[![GridView отображает последнее добавленное пяти продуктов](interacting-with-the-master-page-from-the-content-page-cs/_static/image11.png)](interacting-with-the-master-page-from-the-content-page-cs/_static/image10.png)

**На рисунке 04**: GridView отображает пять наиболее недавно добавлено продукты ([Просмотр полноразмерное изображение](interacting-with-the-master-page-from-the-content-page-cs/_static/image12.png))


> [!NOTE]
> Вы можете очистить внешний вид элемента управления GridView. Некоторые рекомендации включают форматирование отображаемых `UnitPrice` значение в виде валюты и с помощью фоновых цветов и шрифтов для улучшения внешнего вида сетки.


## <a name="step-2-creating-a-content-page-to-add-new-products"></a>Шаг 2: Создание страницы содержимого для добавления новых продуктов

Теперь нам является создание страницы содержимого, из которого пользователь может добавлять новый продукт на `Products` таблицы. Добавление новой страницы содержимого для `Admin` папку с именем `AddProduct.aspx`, позволяя следует привязать его к `Site.master` главной страницы. Рис. 5 показан обозреватель решений после добавления этой страницы на веб-сайт.


[![Добавить новую страницу ASP.NET в папку Admin](interacting-with-the-master-page-from-the-content-page-cs/_static/image14.png)](interacting-with-the-master-page-from-the-content-page-cs/_static/image13.png)

**На рисунке 05**: добавьте новую страницу ASP.NET в `Admin` папку ([Просмотр полноразмерное изображение](interacting-with-the-master-page-from-the-content-page-cs/_static/image15.png))


Помните, что в [ *указанием заголовка, мета-теги и другие заголовки HTML на главной странице* ](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md) учебник, созданную пользовательскую страницу базовый класс с именем `BasePage` , создавшей заголовок страницы, если она была не задан явно. Последовательно выберите пункты `AddProduct.aspx` на странице кода класса и его производные от `BasePage` (вместо из `System.Web.UI.Page`).

Наконец, обновите `Web.sitemap` файл, чтобы включить запись для этого занятия. Добавьте следующую разметку под `<siteMapNode>` занятия проблемы именования идентификатор элемента управления:


[!code-xml[Main](interacting-with-the-master-page-from-the-content-page-cs/samples/sample3.xml)]

Как показано на рис. 6, добавление данного объекта `<siteMapNode>` элемент отражается в списке занятий.

Вернитесь к `AddProduct.aspx`. В элементе управления содержимым для `MainContent` ContentPlaceHolder, добавление элемента управления DetailsView и назовите его `NewProduct`. Привязать DetailsView новый элемент управления SqlDataSource с именем `NewProductDataSource`. Например, в SqlDataSource на шаге 1, мастер настройки, чтобы он использовал базу данных Northwind и указать пользовательские инструкции SQL. Поскольку DetailsView будет использоваться для добавления элементов в базу данных, необходимо указать оба `SELECT` инструкции и `INSERT` инструкции. Используйте следующие `SELECT` запроса:


[!code-sql[Main](interacting-with-the-master-page-from-the-content-page-cs/samples/sample4.sql)]

Из вкладки «Вставка» добавить следующий `INSERT` инструкции:


[!code-sql[Main](interacting-with-the-master-page-from-the-content-page-cs/samples/sample5.sql)]

После завершения работы мастера перейдите DetailsView смарт-тег и установите флажок «Включить Вставка». Это добавляет CommandField DetailsView с его `ShowInsertButton` свойству задано значение true. Так как этот DetailsView будет использоваться исключительно для вставки данных, задайте DetailsView `DefaultMode` свойства `Insert`.

Это все, чтобы он! Давайте протестируем эту страницу. Посетите `AddProduct.aspx` через браузер, введите имя и цена (см. рис. 6).


[![Добавить новый продукт в базе данных](interacting-with-the-master-page-from-the-content-page-cs/_static/image17.png)](interacting-with-the-master-page-from-the-content-page-cs/_static/image16.png)

**На рисунке 06**: добавить новый продукт в базе данных ([Просмотр полноразмерное изображение](interacting-with-the-master-page-from-the-content-page-cs/_static/image18.png))


После вводить имя и цену для нового продукта, нажмите кнопку "Добавить". Это приводит к обратной передаче. При обратной передаче управления SqlDataSource элемента `INSERT` инструкция выполняется; его два параметра, заполняются введенных пользователем значений в двух элементах управления TextBox DetailsView. К сожалению нет не визуальное представление, которое происходит вставка. Было бы полезно обеспечить соответствующее сообщение, подтверждающее, что добавлена запись новой. Я это поле оставить в качестве упражнения для модуля чтения. Кроме того, после добавления новой записи в DetailsView GridView в главной страницы по-прежнему показывает же пятью записями как перед; он не включает запись только что добавлен. Мы рассмотрим, как это исправить в следующих действиях.

> [!NOTE]
> Помимо добавления определенные виды визуальную обратную связь, операция вставки завершилась успешно, я рекомендую также обновить интерфейсу вставки DetailsView, включая проверку. В настоящее время нет никаких проверок. Если пользователь вводит недопустимое значение для `UnitPrice` поля, такие как «слишком много ресурсов,» будет создано исключение при обратной передаче, если система пытается преобразовать эту строку в десятичное число. Дополнительные сведения о настройке Вставка интерфейса см. [ *Настройка интерфейса изменения данных* учебника](../../data-access/editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) из моей [работа с учебника ряда данных](../../data-access/index.md).


## <a name="step-3-creating-public-properties-and-methods-in-the-master-page"></a>Шаг 3: Создание открытым свойствам и методам в главной страницы

На шаге 1, мы добавили метка веб-элемент управления с именем `GridMessage` выше GridView на главной странице. Эта метка предназначен для вывода сообщения при необходимости. Например, добавив новую запись для `Products` таблицы, мы хотим видеть следующее сообщение: «*ProductName* был добавлен в базу данных.» Вместо того чтобы жестко текста для метки на главной странице может потребоваться сообщений настраивается с помощью содержимого страницы.

Поскольку элемент управления Label реализован в виде переменной защищенный элемент на главной странице недоступными непосредственно из содержимого страницы. Для работы с меткой в пределах главной страницы на странице содержимого (или фактически, любые веб-элемент управления на главной странице), нам нужно создать общее свойство на главной странице, который предоставляет веб-элемент управления или выступает в роли прокси-сервера, с помощью которого можно одним из его свойств  доступ к. Добавьте следующий синтаксис кода класс главной страницы, чтобы предоставлять метку `Text` свойство:


[!code-csharp[Main](interacting-with-the-master-page-from-the-content-page-cs/samples/sample6.cs)]

При добавлении новой записи `Products` таблицы из страницы содержимого `RecentProducts` GridView на главной странице необходимо привязать его базового источника данных. Для повторной привязки вызов GridView его `DataBind` метод. Так как GridView на главной странице не программного доступа к страницы содержимого, нам необходимо создать открытый метод в главной страницы, при вызове, выполняет повторную привязку данных к GridView. Добавьте следующий метод класса с выделенным кодом главной страницы:


[!code-csharp[Main](interacting-with-the-master-page-from-the-content-page-cs/samples/sample7.cs)]

С `GridMessageText` свойство и `RefreshRecentProductsGrid` метод на месте любой страницы содержимого можно программно задать или прочитать значение `GridMessage` метки `Text` свойство или привяжите данные к `RecentProducts` GridView. Шаг 4 рассматривается для доступа к открытым свойствам и методам главной страницы из страницы содержимого.

> [!NOTE]
> Не забудьте пометить главной страницы свойств и методов, как `public`. Если вы не указывают явно эти свойства и методы, как `public`, они не будут доступны на странице содержимого.


## <a name="step-4-calling-the-master-pages-public-members-from-a-content-page"></a>Шаг 4: Вызов открытые члены главной страницы из страницы содержимого

Теперь, когда главная страница имеет необходимые открытым свойствам и методам, мы готовы для вызова этих свойств и методов из `AddProduct.aspx` страницы содержимого. В частности, нам нужно указать главную страницу `GridMessageText` свойство и вызвать его `RefreshRecentProductsGrid` метод после добавления нового продукта в базу данных. Все данные Web элементы управления ASP.NET порождения событий, непосредственно перед и после завершения различные задачи, которые облегчают разработчикам выполнение некоторых действий программный до или после задачи. Например, когда пользователь нажимает кнопку вставки DetailsView, на обратную передачу DetailsView вызывает его `ItemInserting` событий перед началом вставку рабочего процесса. Затем он вставляет запись в базу данных. Вслед за этим вызывает DetailsView его `ItemInserted` событий. Таким образом, чтобы работать с главной страницы, после добавления нового продукта, можно создать обработчик событий для элемента DetailsView `ItemInserted` событий.

Существует два способа, страницы содержимого программными средствами могут взаимодействовать с главной страницей по:

- С помощью `Page.Master` свойство, которое возвращает ссылку слабо типизированной главной страницы, или
- Укажите страницу главной страницы типа или путь к файлу через `@MasterType` директив; это автоматически добавляет строго типизированным свойством на страницу с именем `Master`.

Давайте рассмотрим оба подхода.

### <a name="using-the-loosely-typedpagemasterproperty"></a>С помощью слабо типизированной`Page.Master`свойство

Все веб-страницах ASP.NET должны быть производными от `Page` класс, который находится в `System.Web.UI` пространства имен. `Page` Класс включает [ `Master` свойство](https://msdn.microsoft.com/en-us/library/system.web.ui.page.master.aspx) , возвращающее ссылку на главную страницу. Если страница не имеет главной страницы `Master` возвращает `null`.

`Master` Свойство возвращает объект типа [ `MasterPage` ](https://msdn.microsoft.com/en-us/library/system.web.ui.masterpage.aspx) (также расположен в `System.Web.UI` пространства имен) которого является базовым типом, от которого наследуют все главные страницы. Таким образом, чтобы использовать открытые свойства или методы, определенные в нашем сайте главной страницы, нам необходимо привести `MasterPage` объект, возвращенный из `Master` свойство к соответствующему типу. Так как мы назвали наш файл главной страницы `Site.master`, класс кода `Site`. Таким образом, следующий пример кода преобразует `Page.Master` свойство для экземпляра класса сайта.


[!code-csharp[Main](interacting-with-the-master-page-from-the-content-page-cs/samples/sample8.cs)]

Теперь, когда у нас есть приведено слабо типизированной `Page.Master` свойства `Site` тип мы можно ссылаться на свойства и методы, определенные для сайта. Как показано на рис. 7, открытое свойство `GridMessageText` отображается в раскрывающемся списке IntelliSense.


[![IntelliSense отображает общие свойства и методы нашей главной страницы](interacting-with-the-master-page-from-the-content-page-cs/_static/image20.png)](interacting-with-the-master-page-from-the-content-page-cs/_static/image19.png)

**На рисунке 07**: IntelliSense отображает общие свойства и методы нашей главной страницы ([Просмотр полноразмерное изображение](interacting-with-the-master-page-from-the-content-page-cs/_static/image21.png))


> [!NOTE]
> Если имя главного файла подкачки `MasterPage.master` является имя класса кода программной части главной страницы `MasterPage`. Это может привести к неоднозначным кода при приведении из типа `System.Web.UI.MasterPage` для вашей `MasterPage` класса. Иными словами необходимо полностью определить тип, к которому выполняется приведение, который может быть немного сложным, при использовании модели проекта веб-сайта. Мое предложение было бы либо убедитесь, что при создании главной странице присвоить файлу имя, что-то отличное от `MasterPage.master` или даже лучше, создайте строго типизированную ссылку на главную страницу.


### <a name="creating-a-strongly-typed-reference-with-themastertypedirective"></a>Создание ссылки на строго типизированные ссылки`@MasterType`директивы

Если внимательно вы увидите, что класс кода страницы ASP.NET — это разделяемый класс (Примечание `partial` ключевого слова в определении класса). Разделяемые классы были представлены в C# и Visual Basic, построенной при помощи.NET Framework 2.0 и, по сути, разрешить членам класс определен в нескольких файлах. Файл класса кода программной - `AddProduct.aspx.cs`, например - содержит код, который мы разработчик страницы создания. Помимо наш код обработчика ASP.NET автоматически создает отдельный файл класса со свойствами и обработчики событий в том, что переводиться декларативная разметка страницы иерархии классов.

Автоматическое генерирование кода, выполняемую при посещении страницы ASP.NET создает условия для некоторых вместо источником интересных и полезных возможностей. В случае главные страницы, если мы сообщаем ядро ASP.NET главную страницу используется нашу страницу содержимого он создает строго типизированной `Master` свойство для нас.

Используйте [ `@MasterType` директивы](https://msdn.microsoft.com/en-us/library/ms228274.aspx) для оповещения подсистемы тип страницы содержимого главной страницы ASP.NET. `@MasterType` Директива может принимать либо имя типа главной страницы или пути к файлу. Чтобы указать, что `AddProduct.aspx` страница использует `Site.master` как его Главная страница, добавьте следующую директиву в начало `AddProduct.aspx`:


[!code-aspx[Main](interacting-with-the-master-page-from-the-content-page-cs/samples/sample9.aspx)]

Эта директива модулю ASP.NET добавить строго типизированную ссылку на главную страницу через свойство с именем `Master`. С `@MasterType` директив на месте, можно вызвать `Site.master` главный открытые свойства и методы, которые напрямую с помощью страницы `Master` свойство без любого приведения.

> [!NOTE]
> Если не указан `@MasterType` директивы, синтаксис `Page.Master` и `Master` возвращают одно и то же самое: слабо типизированный объект для главной страницы. При включении `@MasterType` директива затем `Master` возвращает строго типизированную ссылку на указанную главную страницу. `Page.Master`, однако по-прежнему возвращает слабо типизированную ссылку. Для более глубокого разговор о том, почему это происходит и как `Master` свойство создается при `@MasterType` включении директивы см. в разделе [к. Скотт Аллен](http://odetocode.com/blogs/scott/default.aspx)в записи блога [ `@MasterType` в ASP.NET 2.0](http://odetocode.com/Blogs/scott/archive/2005/07/16/1944.aspx).


### <a name="updating-the-master-page-after-adding-a-new-product"></a>Обновление главной страницы после добавления нового продукта

Теперь, когда мы знаем, как вызывать общие свойства и методы из страницы содержимого главной страницы, все готово для обновления `AddProduct.aspx` страницы, чтобы главная страница обновляется после добавления нового продукта. В начале шага 4 мы создали обработчик событий для элемента управления DetailsView `ItemInserting` событие, которое выполняется сразу после новый продукт был добавлен в базу данных. Добавьте следующий код для этого обработчика событий:


[!code-csharp[Main](interacting-with-the-master-page-from-the-content-page-cs/samples/sample10.cs)]

Приведенный выше код используется как слабо типизированный `Page.Master` свойство и строго типизированные `Master` свойство. Обратите внимание, что `GridMessageText` свойство имеет значение «*ProductName* сетке...» Значения только что добавленные продукта, доступны через `e.Values` коллекции; так как вы видите, только что добавленные `ProductName` значение возможен только через `e.Values["ProductName"]`.

На рисунке 8 показана `AddProduct.aspx` страницу сразу же после нового продукта - Скотта Soda - был добавлен в базу данных. Обратите внимание, название продукта, только что добавленные, указывается в метке главной страницы и что GridView обновления для включения продукта и его цену.


[![Метка главной страницы и GridView Показать только что добавленные продукта](interacting-with-the-master-page-from-the-content-page-cs/_static/image23.png)](interacting-with-the-master-page-from-the-content-page-cs/_static/image22.png)

**На рисунке 08**: метка и GridView главной страницы отображаются продукты Just-Added ([Просмотр полноразмерное изображение](interacting-with-the-master-page-from-the-content-page-cs/_static/image24.png))


## <a name="summary"></a>Сводка

В идеальном случае главной страницы и его страниц полностью отделены друг от друга и уровень взаимодействия не требуется. Хотя главные страницы и страницы содержимого должны разрабатываться с этой целью в, существует ряд распространенных сценариев, в которых страницу содержимого необходимо взаимодействовать с главной страницей по. Одной из наиболее распространенных причин основано на обновление конкретной части экрана главной страницы, на основе некоторые действия, который задан на странице содержимого.

Хорошие новости — это относительно простой для программного взаимодействия с главной страницей по содержимого страницы. Начните с создания открытые свойства или методы в главной страницей, инкапсулирующие функциональные возможности, что должно быть инициировано страницу содержимого. Затем на странице содержимого доступными свойства и методы главной страницы через слабо типизированные `Page.Master` свойства или используйте `@MasterType` директивы для создания строго типизированную ссылку на главную страницу.

В следующем уроке мы рассмотрим, как у главной страницы программного взаимодействия с помощью одного из его страниц.

Программирование довольны!

### <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, рассматриваемые в этом учебнике см. в следующих ресурсах:

- [Просмотр и обновление данных в ASP.NET](http://aspnet.4guysfromrolla.com/articles/011106-1.aspx)
- [Главные страницы ASP.NET: Советы, рекомендации и ловушек](http://www.odetocode.com/articles/450.aspx)
- [`@MasterType`в ASP.NET 2.0](http://odetocode.com/Blogs/scott/archive/2005/07/16/1944.aspx)
- [Передача сведений об между содержимым и главных страниц](http://aspnet.4guysfromrolla.com/articles/013107-1.aspx)
- [Работа с данными в учебниках ASP.NET](../../data-access/index.md)

### <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор по ASP/ASP.NET и основатель 4GuysFromRolla.com, работает с веб-технологиями Майкрософт с 1998 года. Скотт — независимый консультант, trainer и записи. Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 3.5 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco). Скотт может быть достигнута по [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com) или через его блог по [http://ScottOnWriting.NET](http://scottonwriting.net/).

### <a name="special-thanks-to"></a>Благодарности

Этот учебник ряд прошел проверку многие полезные рецензентов. Основной рецензент этого учебника было Зак Джонс. Объясняются моих последующих статей для MSDN? Если Да, напишите мне по[mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)

>[!div class="step-by-step"]
[Назад](control-id-naming-in-content-pages-cs.md)
[Вперед](interacting-with-the-content-page-from-the-master-page-cs.md)
