---
uid: web-forms/overview/older-versions-getting-started/master-pages/nested-master-pages-cs
title: "Вложенные главные страницы (C#) | Документы Microsoft"
author: rick-anderson
description: "Показано, как вложить одну главную страницу в другом."
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/28/2008
ms.topic: article
ms.assetid: 32b7fb6e-d74b-4048-91f8-70631b2523ee
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/master-pages/nested-master-pages-cs
msc.type: authoredcontent
ms.openlocfilehash: 97513a5a6ac7a958a03626f16a328ecb0b85c03f
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2018
---
<a name="nested-master-pages-c"></a>Вложенные главные страницы (C#)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить код](http://download.microsoft.com/download/d/6/6/d66ad554-afdd-409e-a5c3-201b774fbb31/ASPNET_MasterPages_Tutorial_10_CS.zip) или [скачать PDF](http://download.microsoft.com/download/d/6/6/d66ad554-afdd-409e-a5c3-201b774fbb31/ASPNET_MasterPages_Tutorial_10_CS.pdf)

> Показано, как вложить одну главную страницу в другом.


## <a name="introduction"></a>Вступление

В ходе предыдущих девять учебных мы увидели, как реализовать макет сайта с главными страницами. По сути главные страницы позволяют нам, разработчику страницы, для определения общих разметки на главной странице вместе с разных регионов, которые могут быть настроены на основе страницы содержимого, содержимого страницы. Элементы управления ContentPlaceHolder на главной странице указать настраиваемые области; настраиваемые разметки для элементов управления ContentPlaceHolder определены на странице содержимого через элементы управления содержимым.

Главная страница приемов, которые мы рассматривали в данный момент удобны, если у вас есть один макет в масштабах всего сайта. Однако много больших веб-сайтов иметь макет узла, который настроен на различные разделы. Например рассмотрим здравоохранения приложения применяется для управления информацией о пациентах, действий и выставление счетов больницы персонала. Возможны три типа веб-страницы в приложении:

- Персонал конкретного члена страницы, где штатных сотрудников можно обновить доступности, Просмотр расписаний или запроса отпуска.
- Страницы конкретных Patient которой штатных сотрудников просмотреть или изменить сведения для конкретного пациента.
- Страницы конкретных выставления счетов, где Бухгалтерия просмотреть текущий утверждений состояния и финансовые отчеты.

Каждой странице могут совместно использовать общий макет, такие как меню в верхней части и ряд часто используемых ссылок в нижней. Но персонала, пациента и страниц, относящихся к выставления счетов может потребоваться настроить этого универсального макета. Например может быть всех страниц, относящихся к персоналу должны содержать список календаря и задач, доступности и ежедневного расписания текущему пользователю. Возможно всех страниц, относящихся к patient необходимо отобразить имя, адрес и страхования сведения для данного пациента, сведения о которой изменяется.

Можно создать такие настраиваемые макеты с помощью *вложенные главные страницы*. Чтобы реализовать приведенный выше сценарий, будет начнем с создания главной страницы, определенные сайта макета, меню и нижний колонтитулы, с ContentPlaceHolders Определение настраиваемых областей. Затем мы создадим три вложенные главные страницы, для каждого типа веб-страницы. Каждой вложенной главной страницы будет определять содержимое между типом содержимого страниц, использующих главной страницы. Другими словами вложенном шаблоне страницы для конкретного пациента страниц будет содержат разметку и программная логика для отображения сведений о пациенте редактируется. При создании новой страницы конкретного пациента, мы бы привязать его к этой вложенной главной страницы.

Этот учебник начинает, информацию о преимуществах вложенные главные страницы. Затем показано, как создавать и использовать вложенные главные страницы.

> [!NOTE]
> Вложенные главные страницы были возможных начиная с версии 2.0 платформы .NET Framework. Тем не менее в Visual Studio 2005 отсутствовала поддержка вложенные главные страницы во время разработки. Хорошо то, что Visual Studio 2008 предлагает широкие возможности времени разработки для вложенных главных страниц. Если вы хотите использовать вложенные главные страницы, но по-прежнему с помощью Visual Studio 2005, извлечь [Скотт Гатри](https://weblogs.asp.net/scottgu/)в записи блога [советы по вложенные главные страницы во время разработки VS 2005](https://weblogs.asp.net/scottgu/archive/2005/11/11/430382.aspx).


## <a name="the-benefits-of-nested-master-pages"></a>Преимущества вложенные главные страницы

У многих веб-сайтов, перекрывающих узел конструктора, а также более пользовательские макеты отдельных типов страниц. Для экземпляра, в нашем Демонстрация веб-приложения был создан элементарного разделе "Администрирование" (на страницах `~/Admin` папки). В настоящее время на веб-страницах `~/Admin` папку использовать одну главную страницу, как эти страницы не в разделе "Администрирование" (а именно, `Site.master` или `Alternate.master`, в зависимости от выбора пользователя).

> [!NOTE]
> Теперь представьте, что наш сайт имеет только одну главную страницу `Site.master`. Рассматривается использование вложенных главных страниц с помощью двух (или более) главных страниц, начиная с «С помощью вложенных Master для администрирования раздел страницы» далее в этом учебнике.


Предположим, что мы была поставлена задача для настройки макета страницы администрирования для включения дополнительных сведений или ссылки, которые иначе не были бы представлены на других страницах на сайте. Существует четыре методики для реализации этого требования:

1. Вручную добавить администрирования сведения и ссылки на каждую страницу содержимого `~/Admin` папки.
2. Обновление `Site.master` основании ли одной из страниц администрирования посещений главной страницы, чтобы включить сведения об особенностях раздел администрирования и ссылки, а затем добавьте код на главную страницу, чтобы показать или скрыть эти разделы.
3. Создание новой главной страницы специально для в разделе "Администрирование" скопировать разметка из `Site.master`, добавлять администрирования разделе конкретные сведения и ссылки и затем обновлять страницы содержимого в `~/Admin` папки для использования этого нового шаблона страница.
4. Создание вложенной главной страницы, который привязывает `Site.master` и страницы содержимого в `~/Admin` папку использовать этот новый вложенной главной страницы. Это вложенном шаблоне страницы будет включать только Дополнительные сведения и ссылки, относящиеся к страницам администрирования и не нужно повторять разметки, уже определен в `Site.master`.

Первый параметр — бы удобной. Основной смысл использование главных страниц — для перемещения придется вручную скопировать и вставить общие разметки на новые страницы ASP.NET. Второй параметр является допустимым, но делает приложение более простым в обслуживании, как он bulks копирование главных страниц с разметку, которая отображается только время от времени и требует от разработчиков редактирования главной страницы для временного решения этой разметки и не забудьте точно определенных разметки отображается и был скрыт. Такой подход будет менее tenable как настройки из больше типы веб-страниц, необходимых для будет выполнено с этой одной главной страницы.

Третий вариант удаляет лишних и сложность проблемы отображается второй вариант. Основным недостатком параметр три элемента то, что он требует скопируйте и вставьте общий макет из `Site.master` для новой главной страницы администрирования определенного раздела. Если мы потребовалось изменить макет сайта, у нас есть, необходимо изменить его в двух местах.

Четвертый параметр вложенные главные страницы, пришлите нам наиболее второй и третий параметры. Сведения о макете-узла сохраняется в одном файле - верхнего уровня главной страницы -, пока содержимое, относящиеся к конкретной области выделены в разных файлах.

Этот учебник начинается с рассмотрим создание и использование простого вложенном шаблоне страницы. Мы создаем новый главной страницы верхнего уровня, две вложенные главные страницы и две страницы содержимого. Начиная с «С помощью вложенных Master для администрирования раздел страницы», мы рассмотрим обновление нашей существующую архитектуру главной страницы и включают в себя использование вложенные главные страницы. В частности, создать вложенную главную страницу и использовать его для включения дополнительных настраиваемое содержимое для страницы содержимого в `~/Admin` папки.

## <a name="step-1-creating-a-simple-top-level-master-page"></a>Шаг 1: Создание простого главной страницы верхнего уровня

Создание вложенного шаблона на основе одного из существующих основных страниц и последующего обновления существующей страницы содержимого для использования этой новой вложенной главной страницы вместо верхнего уровня главной страницы влечет за собой некоторые сложности поскольку существующей страницы содержимого уже ожидает определенные Элементы управления ContentPlaceHolder, определенные в главной страницы верхнего уровня. Таким образом вложенном шаблоне страницы необходимо также включить таким же контролем ContentPlaceHolder с теми же именами. Кроме того, наши определенного демонстрационное приложение имеет два главных страниц (`Site.master` и `Alternate.master`), которые динамически назначены страницу содержимого на основе параметров пользователя, который добавляет дополнительные сложности. Мы рассмотрим обновление существующего приложения для использования далее в этом учебнике вложенные главные страницы, но давайте сначала изучить простой вложенные главные страницы пример.

Создайте новую папку с именем `NestedMasterPages` и добавьте новый файл главной страницы в эту папку с именем `Simple.master`. (См. рис. 1 для снимок экрана обозревателя решений после добавления этой папки и файла.) Перетащите `AlternateStyles.css` файла таблицы стилей из обозревателя решений в конструктор. Это добавляет `<link>` элемента файла таблицы стилей в `<head>` элемент, после которого главной страницы `<head>` разметку элемента должен выглядеть так:


[!code-aspx[Main](nested-master-pages-cs/samples/sample1.aspx)]

Добавьте следующую разметку в веб-формы из `Simple.master`:


[!code-aspx[Main](nested-master-pages-cs/samples/sample2.aspx)]

Эта разметка отображает ссылку под названием «Вложенные главные страницы (простое)» в верхней части страницы крупным шрифтом белого на темно-синего цвета фона. Под, `MainContent` ContentPlaceHolder. На рисунке 1 показано `Simple.master` главной страницы при загрузке в конструкторе Visual Studio.


[![Вложенная Главная страница определяет связана с содержимым на страницы в разделе "Администрирование"](nested-master-pages-cs/_static/image2.png)](nested-master-pages-cs/_static/image1.png)

**На рисунке 01**: вложенные Master страницы определяет содержимого конкретных на страницы в разделе "Администрирование" ([Просмотр полноразмерное изображение](nested-master-pages-cs/_static/image3.png))


## <a name="step-2-creating-a-simple-nested-master-page"></a>Шаг 2: Создание простого вложенной главной страницы

`Simple.master`содержит два элемента управления ContentPlaceHolder: `MainContent` ContentPlaceHolder, мы добавили в веб-форма, вместе с `head` ContentPlaceHolder `<head>` элемента. Если страница содержимого и привяжите его к `Simple.master` страницы содержимого будет иметь двух элементов управления содержимым, ссылающиеся на два ContentPlaceHolders. Аналогично Если мы Создание вложенной главной страницы и привяжите его к `Simple.master` вложенном шаблоне страницы будет иметь два элемента управления содержимым.

Давайте добавим новый вложенном шаблоне страницы для `NestedMasterPages` папку с именем `SimpleNested.master`. Щелкните правой кнопкой мыши `NestedMasterPages` папку и выберите команду Добавить новый элемент. Откроется диалоговое окно Добавление нового элемента, показанный на рисунке 2. Выберите тип шаблона главной страницы и введите имя новой главной страницы. Для указания вызова новой главной страницы вложенном шаблоне страницы, установите флажок «Выбрать главную страницу».

Затем нажмите кнопку Добавить. Выберите же появится главная страница диалоговое окно появляется, если привязка страницы содержимого на главную страницу (см. рис. 3). Выберите `Simple.master` главной страницы в `NestedMasterPages` папку и нажмите кнопку ОК.

> [!NOTE]
> Если вы создали веб-сайта ASP.NET, с помощью модели проекта веб-приложения, вместо модели проекта веб-сайта не появится флажок «Выбрать главную страницу» в диалоговом окне Добавление нового элемента, показанный на рисунке 2. Создание вложенной главной страницы при использовании модели проекта веб-приложения необходимо выбрать шаблон вложенной главной страницы (вместо шаблона главной страницы). После выбора шаблона вложенной главной страницы и нажмите кнопку Добавить, же Выбор главной страницы, появится диалоговое окно показано на рисунке 3.


[![Проверьте &quot;выбрать главную страницу&quot; флажок, чтобы добавить вложенные главной страницы](nested-master-pages-cs/_static/image5.png)](nested-master-pages-cs/_static/image4.png)

**На рисунке 02**: установите флажок «Выбрать главную страницу» для добавления вложенной главной страницы ([Просмотр полноразмерное изображение](nested-master-pages-cs/_static/image6.png))


[![Привязать вложенная Главная страница Simple.master главной страницы](nested-master-pages-cs/_static/image8.png)](nested-master-pages-cs/_static/image7.png)

**Рисунок 03**: привязка вложенные Главная страница `Simple.master` главной страницы ([Просмотр полноразмерное изображение](nested-master-pages-cs/_static/image9.png))


Декларативная разметка вложенном шаблоне страницы, показанная ниже, содержит двух элементов управления содержимым, ссылающиеся на два ContentPlaceHolder элемента управления верхнего уровня главной страницы.


[!code-aspx[Main](nested-master-pages-cs/samples/sample3.aspx)]

За исключением `<%@ Master %>` директив, вложенном шаблоне страницы начальной декларативная разметка идентична разметку, которая изначально создается при привязке страницу содержимого в одну главную страницу верхнего уровня. Страницы содержимого, например `<%@ Page %>` директивы, `<%@ Master %>` здесь директива включает `MasterPageFile` атрибут, указывающий вложенном шаблоне страницы родительской главной страницы. Основное различие между вложенном шаблоне страницы и страницы содержимого, связанные с одной главной страницей верхнего уровня — Включение элементов управления ContentPlaceHolder вложенной главной страницы. Элементы управления ContentPlaceHolder вложенном шаблоне страницы определяют области, где страницы содержимого можно настроить разметку.

Обновите этот вложенном шаблоне страницы так, чтобы он отображает текст «Hello, из SimpleNested!» в элементе управления содержимым, который соответствует `MainContent` управления ContentPlaceHolder.


[!code-aspx[Main](nested-master-pages-cs/samples/sample4.aspx)]

После внесения это дополнение, сохранить вложенном шаблоне страницы и затем добавьте новую страницу содержимого `NestedMasterPages` папку с именем `Default.aspx`и привяжите его к `SimpleNested.master` главной страницы. После добавления этой страницы читателей может удивить увидеть, что в нем нет элементов управления содержимым (см. рис. 4)! Страница содержимого доступны только его *родительского* главные страницы ContentPlaceHolders. `SimpleNested.master`не содержит все элементы ContentPlaceHolder; Таким образом все страницы содержимого, связанные с этой главной страницей, не может содержать любые элементы управления содержимым.


[![Новая страница содержимого не содержит содержимого элементов управления](nested-master-pages-cs/_static/image11.png)](nested-master-pages-cs/_static/image10.png)

**На рисунке 04**: новые страницы содержит нет содержимого элементов управления содержимым ([Просмотр полноразмерное изображение](nested-master-pages-cs/_static/image12.png))


Нам нужно выполнить является обновление вложенной главной страницы (`SimpleNested.master`) для включения элемента управления ContentPlaceHolder. Обычно нужно вложенные главные страницы для включения ContentPlaceHolder для каждого ContentPlaceHolder определяется его родительской главной страницы, тем самым позволяя ее дочернюю главную страницу или страницы содержимого для работы с любыми ContentPlaceHolder верхнего уровня главной страницы элементы управления.

Обновление `SimpleNested.master` главной страницы для включения ContentPlaceHolder в два содержимого элемента управления. Присвойте имя, совпадающее с именем элемента управления ContentPlaceHolder их содержимого элемента управления ссылается на элементы управления ContentPlaceHolder. То есть добавьте элемент управления ContentPlaceHolder `MainContent` содержимого элемента управления в `SimpleNested.master` ссылающийся `MainContent` ContentPlaceHolder `Simple.master`. Выполните ту же процедуру, в элементе управления содержимым, который ссылается на `head` ContentPlaceHolder.

> [!NOTE]
> Хотя я рекомендую именования элементов управления ContentPlaceHolder вложенном шаблоне страницы таким же, как ContentPlaceHolders в главной страницы верхнего уровня, этот баланс именования не является обязательным. Можно предоставлять ContentPlaceHolder элементы управления в вложенной главной странице любое имя по своему выбору. Тем не менее, мы рекомендуем запомнить соответствуют ContentPlaceHolders с какой области страницы, если Мои главной страницы верхнего уровня и вложенные главные страницы используются одинаковые имена.


После внесения этих изменений ваш `SimpleNested.master` Главная страница должна выглядеть следующим образом:


[!code-aspx[Main](nested-master-pages-cs/samples/sample5.aspx)]

Удалить `Default.aspx` только что созданная страница содержимого и снова добавьте его, привязав его к `SimpleNested.master` главной страницы. Это время Visual Studio добавляет два элементы управления содержимым к `Default.aspx`, ссылающиеся на ContentPlaceHolders определен в `SimpleNested.master` (см. рис. 6). Добавьте текст «Hello, из Default.aspx!» в содержимом элемента управления, на который ссылка `MainContent`.

Рис. 5 показано три сущности, связанные - `Simple.master`, `SimpleNested.master`, и `Default.aspx` - и как они связаны друг с другом. Как показано на схеме, вложенном шаблоне страницы реализует элементы управления содержимым для ContentPlaceHolder родительского элемента. Если эти области должны быть доступны на странице содержимого, вложенном шаблоне страницы необходимо добавить свой собственный ContentPlaceHolders к элементам управления содержимым.


[![Верхнего уровня и вложенные главные страницы определяют макета содержимого страницы](nested-master-pages-cs/_static/image14.png)](nested-master-pages-cs/_static/image13.png)

**На рисунке 05**: верхнего уровня и вложенные главные страницы определяют макета содержимого страницы ([Просмотр полноразмерное изображение](nested-master-pages-cs/_static/image15.png))


Это показывает, как страницы содержимого или главную страницу только представление о его родительской главной страницы. Это поведение также обозначается конструктора Visual Studio. Рис. 6 показан конструктор для `Default.aspx`. Хотя конструктор ясно показывает, какие области являются изменяемыми со страницы содержимого, а не частей, не устранить неоднозначность, каковы неизменяемые области с вложенной главной страницы и области — из главной страницы верхнего уровня.


[![Содержимое страницы теперь включает элементы управления содержимым для ContentPlaceHolders вложенная Главная страница](nested-master-pages-cs/_static/image17.png)](nested-master-pages-cs/_static/image16.png)

**На рисунке 06**: содержимого страницы теперь включает элементы управления содержимым для главной страницы вложенных ContentPlaceHolders ([Просмотр полноразмерное изображение](nested-master-pages-cs/_static/image18.png))


## <a name="step-3-adding-a-second-simple-nested-master-page"></a>Шаг 3: Добавление второго простой вложенной главной страницы

Преимуществом вложенные главные страницы становится очевидным, при наличии нескольких вложенных главных страниц. Чтобы проиллюстрировать это преимущество, создайте другой вложенной главной страницы в `NestedMasterPages` папки; назовите эту новую вложенной главной страницы `SimpleNestedAlternate.master` и привяжите его к `Simple.master` главной страницы. Добавьте элементы управления ContentPlaceHolder в элементах управления содержимым двух вложенном шаблоне страницы, как мы делали на шаге 2. Также добавьте текст «Hello, из SimpleNestedAlternate!» в элементе управления содержимым, соответствующий верхнего уровня главной страницы `MainContent` ContentPlaceHolder. После внесения этих изменений новой вложенной главной страницы должна выглядеть следующим образом:


[!code-aspx[Main](nested-master-pages-cs/samples/sample6.aspx)]

Страница содержимого с именем `Alternate.aspx` в `NestedMasterPages` папки и привяжите его к `SimpleNestedAlternate.master` вложенной главной страницы. Добавьте текст «Hello, из альтернативного!» в элементе управления содержимым, который соответствует `MainContent`. На рисунке 7 показано `Alternate.aspx` при просмотре через конструктор Visual Studio.


[![Alternate.aspx привязан к SimpleNestedAlternate.master главной страницы](nested-master-pages-cs/_static/image20.png)](nested-master-pages-cs/_static/image19.png)

**На рисунке 07**: `Alternate.aspx` привязан к `SimpleNestedAlternate.master` главной страницы ([Просмотр полноразмерное изображение](nested-master-pages-cs/_static/image21.png))


Сравните конструктор на рис. 7 в конструктор на рис. 6. Обе страницы содержимого совместно использовать тот же макет, определенные в главной страницы верхнего уровня (`Simple.master`), а именно заголовок «Вложенные страницы Master учебник (простое)». Еще имеют уникальные содержимое, определенное в свои родительские главные страницы - текст «Hello, из SimpleNested!» на рис. 6 и «Hello, из SimpleNestedAlternate!» на рисунке 7. Конечно, здесь эти различия просты, но может быть расширен для включения информативности различия в этом примере. Например `SimpleNested.master` страница может содержать меню с параметрами, относящиеся к его страниц, тогда как `SimpleNestedAlternate.master` , возможно, сведения, относящиеся к страницы содержимого, которые привязаны к нему.

Теперь предположим, что нам нужно внести изменения в перекрывающих макет узла. Например предположим, мы хотим добавить список ссылок, общие для всех страниц содержимого. Для этого мы обновления главной страницы верхнего уровня, `Simple.master`. Любые изменения немедленно отражаются в его вложенные главные страницы, а также их содержимого страницы.

Чтобы продемонстрировать легкость, с помощью которого можно изменить макет перекрывающих узла, откройте `Simple.master` главную страницу и добавьте следующую разметку между `topContent` и `mainContent` `<div>` элементов:


[!code-aspx[Main](nested-master-pages-cs/samples/sample7.aspx)]

Это добавляет две ссылки в верхней части каждой страницы, которая связывает `Simple.master`, `SimpleNested.master`, или `SimpleNestedAlternate.master`; эти изменения немедленно применяются для всех вложенных главных страниц и их содержимого страницы. На рисунке 8 показана `Alternate.aspx` при просмотре через браузер. Обратите внимание, добавление ссылок в верхней части страницы (по сравнению с рис. 7).


[![Изменено на главную страницу верхнего уровня, немедленно отражаются в его вложенные главные страницы и их содержимого страницы](nested-master-pages-cs/_static/image23.png)](nested-master-pages-cs/_static/image22.png)

**На рисунке 08**: изменено на главную страницу верхнего уровня, немедленно отражаются в его вложенные главные страницы и их содержимого страницы ([Просмотр полноразмерное изображение](nested-master-pages-cs/_static/image24.png))


## <a name="using-a-nested-master-page-for-the-administration-section"></a>С помощью вложенной главной страницы для области администрирования

На этом этапе мы рассматривали преимущества вложенными главными страницами и было показано, как создать и использовать их в приложении ASP.NET. Примеры на шаге 1, 2 и 3, тем не менее, влияющих на создание новой главной страницы верхнего уровня, вложенные главные страницы и новые страницы содержимого. Как насчет добавления новой вложенной главной страницы на веб-сайт с существующие верхнего уровня главной страницы и страницы содержимого?

Интеграция вложенном шаблоне страницы в существующий веб-сайт и связывание его с существующие страницы содержимого требует больше усилий, чем начинать с нуля. Шаги 4, 5, 6 и 7 просмотра этих проблем, которые мы дополнять демонстрация приложения для включения новой вложенной главной страницы с именем `AdminNested.master` , содержащее инструкции для администратора и используемых страниц ASP.NET в `~/Admin` папки.

Интеграция вложенном шаблоне страницы в нашем примере приложения появились следующие препятствий.

- Существующее содержимое страниц в `~/Admin` папки имеются определенные ожидания из их главную страницу. Во-первых ожидают, что некоторые элементы управления ContentPlaceHolder должны присутствовать. Кроме того `~/Admin/AddProduct.aspx` и `~/Admin/Products.aspx` страницы вызывать public главной страницы `RefreshRecentProductsGrid` задать метод, его `GridMessageText` свойства, или обработчика событий для его `PricesDoubled` событий. Следовательно нашей вложенном шаблоне страницы необходимо предоставить же ContentPlaceHolders и открытых членов.
- В предыдущем учебнике мы улучшили `BasePage` класса для динамического `Page` объекта `MasterPageFile` на основе свойства в переменной сеанса. Как для мы поддерживает динамические главные страницы при использовании вложенные главные страницы?

Эти две задачи обнаружатся мы построении вложенном шаблоне страницы и использовать его из наших существующей страницы содержимого. Мы будем исследовать и преодоления этих проблем при их возникновении.

## <a name="step-4-creating-the-nested-master-page"></a>Шаг 4: Создание вложенной главной страницы

Наш первой задачей является создание вложенной главной страницы, используемые страницы в разделе "Администрирование". Как было показано в шаге 2, при добавлении нового вложенных главной страницы, нам нужно указать вложенном шаблоне страницы родительской главной страницы. Но у нас есть две страницы верхнего уровня master: `Site.master` и `Alternate.master`. Напомним, что мы создали `Alternate.master` в предыдущем учебнике и был создан код `BasePage` класса, который задан объект страницы `MasterPageFile` свойства во время выполнения либо `Site.master` или `Alternate.master` в зависимости от значения `MyMasterPage` Переменной сеанса.

Как мы настраиваем нашей вложенном шаблоне страницы, чтобы он использовал соответствующей главной страницы верхнего уровня? У нас есть два варианта:

- Создайте две вложенные главные страницы, `AdminNestedSite.master` и `AdminNestedAlternate.master`и привязывать их к верхнего уровня главные страницы `Site.master` и `Alternate.master`соответственно. В `BasePage`, затем мы устанавливаем `Page` объекта `MasterPageFile` для соответствующей вложенной главной страницы.
- Создайте один вложенном шаблоне страницы и страницы содержимого использовать главную страницу. Затем, во время выполнения, необходимо задать вложенном шаблоне страницы `MasterPageFile` свойства верхнего уровня соответствующей главной страницы во время выполнения. (Как вы может разобрались к этому моменту, главные страницы также имеют `MasterPageFile` свойство.)

Давайте использовать второй вариант. Создание одного вложенного файла главной страницы в `~/Admin` папку с именем `AdminNested.master`. Так как оба `Site.master` и `Alternate.master` имеют один и тот же набор элементов управления ContentPlaceHolder, неважно, какой главной страницы его привязать, несмотря на то, что я рекомендую привяжите его к `Site.master` ради согласованности элемента.


[![Добавление вложенной главной страницы в папку ~/Admin.](nested-master-pages-cs/_static/image26.png)](nested-master-pages-cs/_static/image25.png)

**Рисунок 09**: Добавление вложенной главной страницы для `~/Admin` папки. ([Просмотр полноразмерное изображение](nested-master-pages-cs/_static/image27.png))


Поскольку вложенном шаблоне страницы привязан к главной страницы с четырьмя элементами управления ContentPlaceHolder, Visual Studio добавляет четыре средств управления содержимым для первоначальной разметки новый файл вложенной главной страницы. Как мы делали на шагах 2 и 3, добавьте элемент управления ContentPlaceHolder в каждый элемент управления содержимым, предоставляя ему имя, совпадающее с именем управления ContentPlaceHolder верхнего уровня главной страницы. Также добавьте следующую разметку для управления содержимым, который соответствует `MainContent` ContentPlaceHolder:


[!code-html[Main](nested-master-pages-cs/samples/sample8.html)]

Затем определите `instructions` класса CSS в `Styles.css` и `AlternateStyles.css` CSS-файлах. Следующие правила CSS, привести к HTML-элементов с `instructions` класса отображается светлый желтый цвет фона и черной сплошная граница:


[!code-css[Main](nested-master-pages-cs/samples/sample9.css)]

Так как эта разметка будет добавлен вложенном шаблоне страницы, оно будет отображаться только на этих страницах, использующих вложенном шаблоне страницы (а именно, страницы в разделе "Администрирование").

После внесения этих изменений на вложенном шаблоне страницы, его должна выглядеть следующим образом:


[!code-aspx[Main](nested-master-pages-cs/samples/sample10.aspx)]

Обратите внимание, что каждый элемент управления содержимым и управления ContentPlaceHolder, элементы управления ContentPlaceHolder `ID` свойствам назначается совпадают со значениями соответствующих элементов управления ContentPlaceHolder на главной странице верхнего уровня. Кроме того, появляется раздел администрирования-разметку в `MainContent` ContentPlaceHolder.

На рисунке 10 показано `AdminNested.master` вложенном шаблоне страницы, при просмотре с помощью конструктора Visual Studio. Вы увидите инструкции в окне «желтый» в верхней части `MainContent` элемент управления содержимым.


[![Вложенная Главная страница расширяет главную страницу верхнего уровня инструкции для администратора.](nested-master-pages-cs/_static/image29.png)](nested-master-pages-cs/_static/image28.png)

**Рис. 10**: вложенная Главная страница расширяет главную страницу верхнего уровня инструкции для администратора. ([Просмотр полноразмерное изображение](nested-master-pages-cs/_static/image30.png))


## <a name="step-5-updating-the-existing-content-pages-to-use-the-new-nested-master-page"></a>Шаг 5: Обновление существующей страницы содержимого для использования новой вложенной главной страницей

Каждый раз, когда мы добавьте новую страницу содержимого в разделе "Администрирование" необходимо привязать его к `AdminNested.master` главной страницы, мы только что создали. Но что делать с существующие содержимого страницы? В настоящее время являются производными от всех страниц содержимого на сайте `BasePage` класс, который программно задает страницы содержимого главной страницы во время выполнения. Это не ожидаемому поведению для содержимого страницы в разделе "Администрирование". Вместо этого мы хотим, чтобы эти страницы содержимого, следует всегда использовать `AdminNested.master` страницы. Он будет иметь ответственность за вложенном шаблоне страницы, выбрать страницу вправо верхнего уровня содержимого во время выполнения.

Лучший способ добиться этого требуемой поведение является создание новой пользовательской страницы базовый класс с именем `AdminBasePage` , расширяющий `BasePage` класса. `AdminBasePage`Затем можно переопределить `SetMasterPageFile` и задайте `Page` объекта `MasterPageFile` для жестко запрограммированных значений «~ / Admin/AdminNested.master». Таким образом, любой страницы, производный от `AdminBasePage` будет использовать `AdminNested.master`, тогда как любую страницу, производный от `BasePage` будет иметь его `MasterPageFile` свойство динамически принимать значение «~ / Site.master» или «~ / Alternate.master» на основе значения `MyMasterPage` Переменной сеанса.

Начните с добавления новый файл класса для `App_Code` папку с именем `AdminBasePage.cs`. У `AdminBasePage` расширить `BasePage` и затем переопределить `SetMasterPageFile` метод. В этом методе назначить `MasterPageFile` значение «~ / Admin/AdminNested.master». После внесения этих изменений ваш класс файл должен выглядеть следующим образом:


[!code-csharp[Main](nested-master-pages-cs/samples/sample11.cs)]

Теперь нам нужно иметь существующего содержимого страницы в разделе, являются производными от администрирования `AdminBasePage` вместо `BasePage`. Откройте файл класса кода программной части для каждой страницы содержимого, в `~/Admin` папки и внести это изменение. Например, в `~/Admin/Default.aspx` изменит объявление класса из кода:


[!code-csharp[Main](nested-master-pages-cs/samples/sample12.cs)]

В:


[!code-csharp[Main](nested-master-pages-cs/samples/sample13.cs)]

Рис. 11 показана способ главной страницы верхнего уровня (`Site.master` или `Alternate.master`), вложенной главной страницы (`AdminNested.master`), и страницы администрирования содержимого раздела связаны друг с другом.


[![Вложенная Главная страница определяет связана с содержимым на страницы в разделе "Администрирование"](nested-master-pages-cs/_static/image32.png)](nested-master-pages-cs/_static/image31.png)

**Рис. 11**: вложенные Master страницы определяет содержимого конкретных на страницы в разделе "Администрирование" ([Просмотр полноразмерное изображение](nested-master-pages-cs/_static/image33.png))


## <a name="step-6-mirroring-the-master-pages-public-methods-and-properties"></a>Шаг 6: Открытые методы и свойства главной страницы зеркальному

Помните, что `~/Admin/AddProduct.aspx` и `~/Admin/Products.aspx` страниц программного взаимодействия с главной страницы: `~/Admin/AddProduct.aspx` вызовы главной страницы открытый `RefreshRecentProductsGrid` метод и устанавливает его `GridMessageText` свойства; `~/Admin/Products.aspx` имеет обработчик событий для `PricesDoubled` события. В предыдущем учебнике мы создали абстрактный `BaseMasterPage` класс, который определен этих открытых членов.

`~/Admin/AddProduct.aspx` И `~/Admin/Products.aspx` страниц предполагается их главной страницы является производным от `BaseMasterPage` класса. `AdminNested.master` Страницы, однако в настоящее время расширяет `System.Web.UI.MasterPage` класса. Таким образом, при посещении `~/Admin/Products.aspx` `InvalidCastException` исключение с сообщением: «не удалось привести объект типа "ASP.admin\_adminnested\_master" к типу «BaseMasterPage».»

Чтобы исправить это должен быть `AdminNested.master` расширить класс кода программной `BaseMasterPage`. Обновление объявление класса кода программной вложенном шаблоне страницы из:


[!code-csharp[Main](nested-master-pages-cs/samples/sample14.cs)]

В:


[!code-csharp[Main](nested-master-pages-cs/samples/sample15.cs)]

Мы все еще не завершена. Поскольку `BaseMasterPage` класс является абстрактным, то необходимо переопределить `abstract` члены, `RefreshRecentProductsGrid` и `GridMessageText`. Эти элементы используются главные страницы верхнего уровня для обновления своих пользовательских интерфейсов. (На самом деле, только `Site.master` Главная страница использует эти методы, несмотря на то, что оба верхнего уровня главные страницы реализовать эти методы, поскольку оба расширить `BaseMasterPage`.)

Хотя мы должны реализовать эти члены в `AdminNested.master`, все эти реализации нужно — просто вызвать тот же элемент верхнего уровня главной страницы, используемые вложенной главной страницы. Например, в том случае, если со страницей содержимого в разделе "Администрирование" вызывает вложенном шаблоне страницы `RefreshRecentProductsGrid` метод, все вложенном шаблоне страницы должен выполнить, в свою очередь, вызовите `Site.master` или `Alternate.master` `RefreshRecentProductsGrid` метод.

Чтобы добиться этого, начните с добавления следующие `@MasterType` директиву в начало `AdminNested.master`:


[!code-aspx[Main](nested-master-pages-cs/samples/sample16.aspx)]

Помните, что `@MasterType` директивы добавляет свойство строго типизированный класс кода `Master`. Затем Переопределите `RefreshRecentProductsGrid` и `GridMessageText` члены и просто передать вызов `Master`к соответствующему метод:


[!code-csharp[Main](nested-master-pages-cs/samples/sample17.cs)]

Этот код в месте можно посетить и содержимого страницы в разделе "Администрирование" можно использовать. Рис. 12 показан `~/Admin/Products.aspx` страниц при просмотре через браузер. Как видите, страница содержит поле администрирования инструкции, определенному в вложенном шаблоне страницы.


[![Страницы содержимого, в разделе "Администрирование" включать инструкции в верхней части каждой страницы](nested-master-pages-cs/_static/image35.png)](nested-master-pages-cs/_static/image34.png)

**Рис. 12**: В содержимого страницы в инструкциях включить раздел администрирования в начало каждой странице ([Просмотр полноразмерное изображение](nested-master-pages-cs/_static/image36.png))


## <a name="step-7-using-the-appropriate-top-level-master-page-at-runtime"></a>Шаг 7: С помощью соответствующих главную страницу верхнего уровня во время выполнения

Хотя полнофункциональные все содержимое страницы в разделе "Администрирование", они используют одну главную страницу верхнего уровня и выбранного пользователем на главную страницу `ChooseMasterPage.aspx`. Такое поведение является тем, что вложенные Главная страница имеет его `MasterPageFile` статическое свойство `Site.master` в его `<%@ Master %>` директивы.

Чтобы использовать главную страницу верхнего уровня, конечным пользователем, нам нужно указать `AdminNested.master` `MasterPageFile` значение в свойства `MyMasterPage` переменной сеанса. Так как мы устанавливаем страницы содержимого `MasterPageFile` свойства в `BasePage`, вы можете считать, что мы бы установили вложенном шаблоне страницы `MasterPageFile` свойство в `BaseMasterPage` или в `AdminNested.master`элемента класса кода программной. Это не будет работать, однако, поскольку мы задали `MasterPageFile` свойство к концу PreInit рабочей области. Самое раннее время, предоставляющую мы программными средствами в жизненном цикле страницы на главной странице находится на этапе инициализации (которое производится после завершения этапа PreInit).

Таким образом, нам нужно указать вложенном шаблоне страницы `MasterPageFile` свойство из содержимого страницы. Только содержимое страниц, использующих `AdminNested.master` главной страницы являются производными от `AdminBasePage`. Таким образом мы смогли разместить эту логику существует. На шаге 5 используемое `SetMasterPageFile` метод, установка `Page` объекта `MasterPageFile` свойства «~ / Admin/AdminNested.master». Обновление `SetMasterPageFile` присвоить главной страницы `MasterPageFile` свойства результата, хранимого в сеансе:


[!code-csharp[Main](nested-master-pages-cs/samples/sample18.cs)]

`GetMasterPageFileFromSession` Метод, который мы добавили в `BasePage` класса в предыдущем учебнике возвращает путь к файлу соответствующей главной страницы, основанный на значении переменной сеанса.

После этого изменения на месте главной страницы, выбранным пользователем переносится в разделе "Администрирование". Рис. 13 показана та же страница рис. 12, а после пользователь изменил свой выбор главной страницы для `Alternate.master`.


[![На странице администрирования вложенных используется верхнего уровня главной страницы, выбранные пользователем](nested-master-pages-cs/_static/image38.png)](nested-master-pages-cs/_static/image37.png)

**Рис. 13**: вложенные страницы администрирования использует верхнего уровня образец страницы выбранного пользователем ([Просмотр полноразмерное изображение](nested-master-pages-cs/_static/image39.png))


## <a name="summary"></a>Сводка

Объем like страницы как содержимого можно привязать к главной страницы, имеется возможность создавать вложенные главные страницы, задав дочерняя главная страница привязки к родительской главной страницы. Дочерняя главная страница может определять элементы управления содержимым для каждого из его родительского элемента ContentPlaceHolders; его можно добавить собственные элементы управления ContentPlaceHolder (а также другие элементы разметки) для этих элементов управления содержимым. Вложенные главные страницы являются весьма полезно в больших веб-приложениях, где все страницы имеют перекрывающих внешний вид и поведение, но отдельные части сайта требуется уникальный настроек.

Программирование довольны!

### <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, рассматриваемые в этом учебнике см. в следующих ресурсах:

- [Вложенные главные страницы ASP.NET](https://msdn.microsoft.com/library/x2b3ktt7.aspx)
- [Советы по вложенные главные страницы и во время разработки VS 2005](https://weblogs.asp.net/scottgu/archive/2005/11/11/430382.aspx)
- [Поддержка страницы Master вложенные VS 2008](https://weblogs.asp.net/scottgu/archive/2007/07/09/vs-2008-nested-master-page-support.aspx)

### <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор по ASP/ASP.NET и основатель 4GuysFromRolla.com, работает с веб-технологиями Майкрософт с 1998 года. Скотт — независимый консультант, trainer и записи. Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 3.5 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco). Скотт может быть достигнута по [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com) или через его блог по [http://ScottOnWriting.NET](http://scottonwriting.net/).

### <a name="special-thanks-to"></a>Благодарности

Этот учебник ряд прошел проверку многие полезные рецензентов. Объясняются моих последующих статей для MSDN? Если Да, напишите мне по[mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)

>[!div class="step-by-step"]
[Назад](specifying-the-master-page-programmatically-cs.md)
[Вперед](creating-a-site-wide-layout-using-master-pages-vb.md)
