---
uid: web-forms/overview/older-versions-getting-started/master-pages/specifying-the-master-page-programmatically-cs
title: "Программным путем указания главной страницы (C#) | Документы Microsoft"
author: rick-anderson
description: "Анализирует задание страницы содержимого главной страницы программно через обработчик событий PreInit."
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/28/2008
ms.topic: article
ms.assetid: 7c4a3445-2440-4aee-b9fd-779c05e6abb2
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/master-pages/specifying-the-master-page-programmatically-cs
msc.type: authoredcontent
ms.openlocfilehash: 15efb8e2f38b7a405da0c0e12e447e5c3146f025
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2018
---
<a name="specifying-the-master-page-programmatically-c"></a>Программным путем указания главной страницы (C#)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить код](http://download.microsoft.com/download/d/6/6/d66ad554-afdd-409e-a5c3-201b774fbb31/ASPNET_MasterPages_Tutorial_09_CS.zip) или [скачать PDF](http://download.microsoft.com/download/d/6/6/d66ad554-afdd-409e-a5c3-201b774fbb31/ASPNET_MasterPages_Tutorial_09_CS.pdf)

> Анализирует задание страницы содержимого главной страницы программно через обработчик событий PreInit.


## <a name="introduction"></a>Вступление

После первых пример в [ *Создание сайта макета с помощью главных страниц*](creating-a-site-wide-layout-using-master-pages-cs.md), все содержимое страницы ссылка на их главную страницу декларативно через `MasterPageFile` атрибута в `@Page`директивы. Например, следующая `@Page` директивы ссылок страницы содержимого на главную страницу `Site.master`:


[!code-aspx[Main](specifying-the-master-page-programmatically-cs/samples/sample1.aspx)]

[ `Page` Класса](https://msdn.microsoft.com/library/system.web.ui.page.aspx) в `System.Web.UI` пространство имен включает [ `MasterPageFile` свойство](https://msdn.microsoft.com/library/system.web.ui.page.masterpagefile.aspx) возвращает путь к странице содержимого главной страницы; это — это свойство, которое задается параметром `@Page` директивы. Это свойство также может использоваться для программно задать страницы содержимого главной страницы. Этот подход полезен, если требуется динамическое назначение главной страницы, в зависимости от внешних факторов, таких как пользователя, посетив страницу.

В этом учебнике мы добавить второй главную страницу на наш веб-сайт и динамически решать, какие главной страницы, используемой во время выполнения.

## <a name="step-1-a-look-at-the-page-lifecycle"></a>Шаг 1: Просмотрите жизненного цикла страницы

При получении запроса на веб-сервер для страницы ASP.NET, которая является страницей содержимого, обработчик ASP.NET необходимо объединять страницы содержимого элементов управления в главную страницу к соответствующему ContentPlaceHolder элементов управления. Это fusion создает иерархию один элемент управления, затем можно перейти по циклу обычной страницы.

Рис. 1 показан этот fusion. На шаге 1 на рисунке 1 показано исходного содержимого и управления иерархиями главной страницы. В конце заключительного этапа PreInit содержимое на странице добавляются соответствующие ContentPlaceHolders на главной странице (шаг 2). После этого fusion главной страницы служит в качестве корневого элемента иерархии плавким элемента управления. Это совмещенного управления добавляется страница для создания иерархии завершенных элементов управления (шаг 3) иерархии. Конечным результатом становится, иерархии элементов управления страницы включает иерархию плавким элементов управления.


[![Главная страница и страницы содержимого элемента управления иерархии расположены совмещенного друг с другом на этапе PreInit](specifying-the-master-page-programmatically-cs/_static/image2.png)](specifying-the-master-page-programmatically-cs/_static/image1.png)

**Рисунок 01**: главная страница и страницы содержимого элемента управления иерархии расположены совмещенного друг с другом на этапе PreInit ([Просмотр полноразмерное изображение](specifying-the-master-page-programmatically-cs/_static/image3.png))


## <a name="step-2-setting-themasterpagefileproperty-from-code"></a>Шаг 2: Установка`MasterPageFile`в коде свойство

Partakes главную страницу в этом fusion зависит от значения `Page` объекта `MasterPageFile` свойство. Установка `MasterPageFile` атрибута в `@Page` директива имеет результатом применения назначение `Page` `MasterPageFile` свойства на этапе инициализации, который является самый первый этап жизненного цикла страницы. Мы также это свойство можно задать программным образом. Тем не менее важно задать это свойство перед fusion на рис. 1.

В начале этапа PreInit `Page` объекта вызывает его [ `PreInit` событий](https://msdn.microsoft.com/library/system.web.ui.page.preinit.aspx) и вызывает его [ `OnPreInit` метод](https://msdn.microsoft.com/library/system.web.ui.page.onpreinit.aspx). Установка на главную страницу программным способом, затем можно либо создать обработчик событий для `PreInit` событий или переопределение `OnPreInit` метод. Давайте взглянем на оба подхода.

Сначала откройте `Default.aspx.cs`, файл кода класса для домашней страницы в нашем сайте. Добавить обработчик событий для этой страницы `PreInit` событий, введя в следующем коде:


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample2.cs)]

Здесь можно задать `MasterPageFile` свойства. Обновите код так, чтобы он присваивает значение «~ / Site.master» для `MasterPageFile` свойства.


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample3.cs)]

Если установить точку останова и запуск с отладкой, вы увидите, что всякий раз, когда `Default.aspx` посещенные страницы или каждый раз, когда имеется обратную передачу на эту страницу `Page_PreInit` выполняется обработчик события и `MasterPageFile` назначается свойство «~ / Site.master».

Кроме того, можно переопределить `Page` класса `OnPreInit` метод и набор `MasterPageFile` существует свойство. В этом примере не зададим главной страницы в определенную страницу, а лишь из `BasePage`. Помните, мы создали пользовательского базового класса страницы (`BasePage`) в [ *указанием заголовка, мета-теги и другие заголовки HTML на главной странице* ](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md) учебника. В настоящее время `BasePage` переопределяет `Page` класса `OnLoadComplete` метод, где он задает страницу `Title` свойства, основанные на данных карты сайта. Давайте обновление `BasePage` также переопределить `OnPreInit` метод, чтобы программно задать главной страницы.


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample4.cs)]

Поскольку все наши страницы содержимого являются производными от `BasePage`, все они получили их главной страницы назначены программными методами. На этом этапе `PreInit` обработчик событий в `Default.aspx.cs` является избыточным; вы можете удалить его.

### <a name="what-about-thepagedirective"></a>Как насчет`@Page`директива?

Что может быть несколько запутанным является, страницы содержимого `MasterPageFile` теперь были указаны свойства в двух местах: программными средствами в `BasePage` класса `OnPreInit` метод также с помощью `MasterPageFile` атрибута в каждой странице содержимого `@Page` директивы.

Первый этап жизненного цикла страницы является стадии инициализации. На этом этапе `Page` объекта `MasterPageFile` присваивается значение `MasterPageFile` атрибута в `@Page` директивы (если он указан). В рабочей области PreInit следует этап инициализации, и именно здесь где программным образом задается `Page` объекта `MasterPageFile` свойства, перезаписывая значения, присвоенного из `@Page` директивы. Поскольку `Page` объекта `MasterPageFile` свойство программным образом, можно устранить `MasterPageFile` атрибута из `@Page` директивы, не затрагивая конечного пользователя. Убедить самостоятельно этого пойти дальше и удалите `MasterPageFile` атрибута из `@Page` директиву `Default.aspx` и затем перейдите на страницу с помощью браузера. Как и следовало ожидать, выходные данные совпадает со значением прежде чем атрибут был удален.

Ли `MasterPageFile` свойству через `@Page` директива или программным образом не имеет значения для конечного пользователя. Тем не менее `MasterPageFile` атрибута в `@Page` директива используется средой Visual Studio во время разработки для создания WYSIWYG представление в конструкторе. Если возвращается значение `Default.aspx` в Visual Studio и перейдите в конструктор вы увидите сообщение об ошибке, «ошибка главной страницы: страница содержит элементы управления, которые требуют наличия ссылки главной страницы, но он не задан» (см. рис. 2).

Иными словами, необходимо оставить `MasterPageFile` атрибута в `@Page` директива более широкие возможности разработки в Visual Studio.


[![Visual Studio использует @Page атрибута директивы MasterPageFile для подготовки к просмотру в режиме конструктора](specifying-the-master-page-programmatically-cs/_static/image5.png)](specifying-the-master-page-programmatically-cs/_static/image4.png)

**На рисунке 02**: Visual Studio использует `@Page` директивы `MasterPageFile` атрибут для просмотра в режиме конструктора ([щелкните, чтобы просмотреть полноразмерное изображение](specifying-the-master-page-programmatically-cs/_static/image6.png))


## <a name="step-3-creating-an-alternative-master-page"></a>Шаг 3: Создание альтернативой главную страницу

Так как страница содержимого главной страницы могут быть заданы программно во время выполнения можно динамически загружать определенной главной страницы на основе некоторых внешних условий. Эта функция может быть полезно в ситуациях, где сайта макет должен изменяться в зависимости от пользователя. Для экземпляра веб-приложении обработчик блогов, позволяют пользователи могут выбрать макет для их блога которой каждая структура связан с другой главной страницы. Во время выполнения просматривая блога пользователя посетителя веб-приложения необходимо определить макет блога и динамически связывать соответствующей главной страницы со страницей содержимого.

Давайте рассмотрим способ динамической загрузки главной страницы во время выполнения на основе некоторых внешних условий. Наш веб-сайт в настоящее время содержит только одну главную страницу (`Site.master`). Нам нужна другая главная страница для иллюстрации Выбор главной страницы во время выполнения. Этот шаг фокусируется на создание и настройка новой главной страницы. Шаг 4 анализирует определение главную страницу для использования во время выполнения.

Создание новой главной страницы в корневой папке с именем `Alternate.master`. Также добавьте новую таблицу стилей на веб-сайт с именем `AlternateStyles.css`.


[![Добавьте еще один главную страницу и CSS файла на веб-сайт](specifying-the-master-page-programmatically-cs/_static/image8.png)](specifying-the-master-page-programmatically-cs/_static/image7.png)

**На рисунке 03**: добавить другой главной страницы и CSS-файл на веб-сайт ([Просмотр полноразмерное изображение](specifying-the-master-page-programmatically-cs/_static/image9.png))


Я разработал `Alternate.master` главной страницы, чтобы иметь заголовок, отображаемый в верхней части страницы, по центру и темно-синего цвета фона. Я выданных левого столбца и перемещен, содержимое, расположенное под `MainContent` управления ContentPlaceHolder, который теперь распространяется на всю ширину страницы. Кроме того, одобрила неупорядоченный список занятия и заменены горизонтальный список выше `MainContent`. Также обновим шрифты и цвета, используемые на главной странице (и, по расширению его страниц). На рисунке 4 показаны `Default.aspx` при использовании `Alternate.master` главной страницы.

> [!NOTE]
> ASP.NET включает в себя возможность определить *темы*. Тема — это совокупность изображений, файлов CSS и относящихся к стилю параметров веб-элемент управления свойства, может применяться к странице во время выполнения. Темы — это способ макеты веб-узла, отличаются только в изображений, отображаемых и их правил CSS. Если макетами более значительно отличаются, например с помощью различных веб-элементов управления или having радикально структуру, затем будет необходимо использовать отдельный главные страницы. В конце этого учебника, Дополнительные сведения о темах см. в разделе Дополнительные материалы.


[![Наши страницы содержимого, теперь можно использовать новый внешний вид и поведение](specifying-the-master-page-programmatically-cs/_static/image11.png)](specifying-the-master-page-programmatically-cs/_static/image10.png)

**На рисунке 04**: страницах содержимого теперь можно использовать новый внешний вид и поведение ([Просмотр полноразмерное изображение](specifying-the-master-page-programmatically-cs/_static/image12.png))


Когда в окне совмещенного главным и разметки страницы содержимого, `MasterPage` класс проверяет, убедитесь, что каждый содержимое ссылается элемент управления на странице содержимого ContentPlaceHolder на главной странице. Если найден элемент управления содержимым, который ссылается на несуществующий ContentPlaceHolder исключение. Другими словами, крайне важно наличие ContentPlaceHolder главной страницы, назначаемый страницы содержимого для каждого содержимого элемента управления на странице содержимого.

`Site.master` Главной страницы содержит четыре элемента управления ContentPlaceHolder:

- `head`
- `MainContent`
- `QuickLoginUI`
- `LeftColumnContent`

Некоторые страницы содержимого в нашем сайте включают только одного или двух элементов управления содержимым; для каждого из доступных ContentPlaceHolders другим пользователям включать элемент управления содержимым. Если нашей новой главной страницы (`Alternate.master`) никогда не может назначаться для этих страниц, имеющих элементы управления содержимым для всех ContentPlaceHolders в `Site.master` то очень важно, `Alternate.master` также включать те же элементы управления ContentPlaceHolder как `Site.master`.

Для получения вашего `Alternate.master` выглядеть аналогично интеллектуальный анализ (см. рис. 4), начинается с определения стилей главной страницы на главную страницу `AlternateStyles.css` таблицы стилей. Добавьте следующие правила в `AlternateStyles.css`:


[!code-css[Main](specifying-the-master-page-programmatically-cs/samples/sample5.css)]

Добавьте следующую разметку декларативный, чтобы `Alternate.master`. Как видите, `Alternate.master` с четырьмя элементами управления ContentPlaceHolder с тем же `ID` значения, что и элементы управления ContentPlaceHolder `Site.master`. Кроме того он включает элемент управления ScriptManager, который необходим для этих страниц в наш веб-сайт, использующих платформу ASP.NET AJAX.


[!code-aspx[Main](specifying-the-master-page-programmatically-cs/samples/sample6.aspx)]

### <a name="testing-the-new-master-page"></a>Тестирование новой главной страницей

Чтобы проверить это новое обновление главной страницы `BasePage` класса `OnPreInit` метод, чтобы `MasterPageFile` присваивается значение «~ / Alternate.maser» и посетите веб-сайт. Каждой странице будет работать без ошибок, за исключением двух: `~/Admin/AddProduct.aspx` и `~/Admin/Products.aspx`. Добавление продукта в DetailsView в `~/Admin/AddProduct.aspx` приводит к `NullReferenceException` из строки кода, который пытается установить главной страницы `GridMessageText` свойство. При посещении `~/Admin/Products.aspx` `InvalidCastException` возникает исключение при загрузке страницы со следующим сообщением: «не удалось привести объект типа "ASP.alternate\_master" к типу "ASP.site\_master".»

Эти ошибки возникают из-за `Site.master` кода класс содержит открытые события, свойства и методы, которые не определены в `Alternate.master`. Часть разметки эти две страницы имеют `@MasterType` директиву, которая ссылается на `Site.master` главной страницы.


[!code-aspx[Main](specifying-the-master-page-programmatically-cs/samples/sample7.aspx)]

Кроме того, DetailsView `ItemInserted` обработчик событий в `~/Admin/AddProduct.aspx` включает приведение слабо типизированной `Page.Master` свойство для объекта типа `Site`. `@MasterType` Директива (используется таким образом) и приведения в `ItemInserted` жестко связывает обработчик событий `~/Admin/AddProduct.aspx` и `~/Admin/Products.aspx` страниц к `Site.master` главной страницы.

Прервать тесной связи у `Site.master` и `Alternate.master` являются производными от общего базового класса, который содержит определения для открытых членов. После этого можно обновить `@MasterType` директивы ссылок на этот общий базовый тип.

### <a name="creating-a-custom-base-master-page-class"></a>Создание класса Base пользовательской главной страницы

Добавьте файл класса для `App_Code` папку с именем `BaseMasterPage.cs` и его производные от `System.Web.UI.MasterPage`. Необходимо определить `RefreshRecentProductsGrid` метод и `GridMessageText` свойство в `BaseMasterPage`, но мы невозможно просто переместить туда, из `Site.master` , так как эти элементы работать с веб-элементов управления, которые относятся к `Site.master` главной страницы ( `RecentProducts` GridView и `GridMessage` метки).

Нам нужно выполнить настроен `BaseMasterPage` таким образом, что эти элементы определены существует, но фактически реализуются с `BaseMasterPage`производных классах (`Site.master` и `Alternate.master`). Этот тип наследования возможна, помечая классе и его членах как `abstract`. Иными словами, добавление `abstract` объявляет ключевое слово для двух членов, `BaseMasterPage` еще не реализован `RefreshRecentProductsGrid` и `GridMessageText`, но будет его производных классов.

Необходимо также определить `PricesDoubled` события в `BaseMasterPage` и предоставляют средства, производными классами для создания события. Узор, используемый в .NET Framework для упрощения такое поведение является создание открытое событие в базовом классе и добавьте защищенный, `virtual` метод с именем `OnEventName`. Производные классы могут затем вызвать этот метод для вызова события или можно переопределить для выполнения кода непосредственно перед или после возникновения события.

Обновление вашего `BaseMasterPage` класса, чтобы он содержал следующий код:


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample8.cs)]

Теперь перейдите к `Site.master` кода, что он является производным от `BaseMasterPage`. Поскольку `BaseMasterPage` — `abstract` нам нужно переопределяют `abstract` членов в `Site.master`. Добавить `override` ключевое слово для определения методов и свойств. Также обновить код, который вызывает `PricesDoubled` события в `DoublePrice` кнопки `Click` обработчик событий на вызов базового класса `OnPricesDoubled` метод.

После этих изменений `Site.master` класс кода должен содержать следующий код:


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample9.cs)]

Необходимо также обновить `Alternate.master`являются производными от класса кода программной `BaseMasterPage` и переопределите два `abstract` члены. Но поскольку `Alternate.master` не содержит GridView, что списки самые последние продукты и метку, которая выводит сообщение после нового продукта не добавляется в базу данных, эти методы не обязательно должны выполнять никаких действий.


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample10.cs)]

### <a name="referencing-the-base-master-page-class"></a>Ссылка на класс страницы базы Master

Теперь, когда мы завершили `BaseMasterPage` класса и имеете наши две главные страницы, ее расширение, последним этапом является обновление `~/Admin/AddProduct.aspx` и `~/Admin/Products.aspx` страниц для ссылки на этот общий тип. Сначала измените `@MasterType` директив в обе страницы из:


[!code-aspx[Main](specifying-the-master-page-programmatically-cs/samples/sample11.aspx)]

В:


[!code-aspx[Main](specifying-the-master-page-programmatically-cs/samples/sample12.aspx)]

Вместо ссылки на путь к файлу, `@MasterType` свойство теперь ссылается на базовый тип (`BaseMasterPage`). Следовательно, строго типизированный `Master` свойство используется в классах кода обе страницы больше не типа `BaseMasterPage` (вместо типа `Site`). Это изменение на месте повторное использование `~/Admin/Products.aspx`. Ранее, это привело к ошибке приведения, так как страница настроена для использования `Alternate.master` главной страницы, но `@MasterType` директивы ссылки на `Site.master` файла. Но теперь отображает без ошибок. Это вызвано `Alternate.master` главной страницы может быть приведен к объекту типа `BaseMasterPage` (поскольку он расширяет его).

Имеется одно небольшое изменение, которое должно выполняться в `~/Admin/AddProduct.aspx`. Элемент управления DetailsView `ItemInserted` обработчик событий использует оба строго типизированный `Master` свойство и слабо типизированный `Page.Master` свойство. Мы исправили строго типизированную ссылку, когда мы обновили `@MasterType` директива, но мы все еще нуждаются в обновлении слабо типизированные ссылки. Замените следующий код:


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample13.cs)]

Следующую команду, которая приводит `Page.Master` к базовому типу:


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample14.cs)]

## <a name="step-4-determining-what-master-page-to-bind-to-the-content-pages"></a>Шаг 4: Определение какие главной страницы для связывания страницы содержимого

Наш `BasePage` класс в настоящее время устанавливает все содержимое страницы `MasterPageFile` свойства для жестко запрограммированных значений в рабочей области PreInit жизненного цикла страницы. Можно изменить этот код для главной страницы на внешних признакам. Возможно главной страницы для загрузки зависит от параметров текущего пользователя. В этом случае необходимо написать код в `OnPreInit` метод `BasePage` , выполняет поиск в настоящее время выполняется посещение пользовательские настройки главной страницы.

Давайте создадим веб-страницы, который пользователь может выбрать главную страницу для использования - `Site.master` или `Alternate.master` - и сохранить этот выбор в переменной сеанса. Начните с создания нового веб-страницы в корневом каталоге с именем `ChooseMasterPage.aspx`. При создании этой странице (или другие содержимого страницы исходя из) не требуется привязать его к главной страницы, так как для главной страницы задано программным способом `BasePage`. Тем не менее, если новая страница не привязан к главной странице выберите новую страницу по умолчанию декларативная разметка содержит веб-формы и другое содержимое, предоставляемые на главную страницу. Вам потребуется вручную заменить Эта разметка соответствующие элементы управления содержимым. По этой причине я проще привязать новую страницу ASP.NET в главную страницу.

> [!NOTE]
> Поскольку `Site.master` и `Alternate.master` иметь же набор элементов управления ContentPlaceHolder неважно, выбран при создании новой страницы содержимого главную страницу. Для обеспечения согласованности, я полагаю, с помощью `Site.master`.


[![Добавление новой страницы содержимого на веб-сайт](specifying-the-master-page-programmatically-cs/_static/image14.png)](specifying-the-master-page-programmatically-cs/_static/image13.png)

**На рисунке 05**: Добавление новой страницы содержимого на веб-сайт ([Просмотр полноразмерное изображение](specifying-the-master-page-programmatically-cs/_static/image15.png))


Обновление `Web.sitemap` файл, чтобы включить запись для этого занятия. Добавьте следующую разметку под `<siteMapNode>` главные страницы и ASP.NET AJAX занятия:


[!code-xml[Main](specifying-the-master-page-programmatically-cs/samples/sample15.xml)]

Прежде чем добавлять любое содержимое, `ChooseMasterPage.aspx` страницы занять некоторое время для обновления кода классов страницы, чтобы он был производным от `BasePage` (а не `System.Web.UI.Page`). Далее добавьте на страницу элемент управления DropDownList, задайте его `ID` свойства `MasterPageChoice`, и добавление двух элементов ListItem с `Text` значения «~ / Site.master» и «~ / Alternate.master».

Добавьте кнопку веб-элемент управления на страницу и задайте его `ID` и `Text` свойства `SaveLayout` и «Выбор макета сохранить», соответственно. На этом этапе на странице должна выглядеть следующим образом:


[!code-aspx[Main](specifying-the-master-page-programmatically-cs/samples/sample16.aspx)]

При первом посещении страницы необходимо отобразить выбранный Главная страница выбора пользователя. Создание `Page_Load` обработчик событий и добавьте следующий код:


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample17.cs)]

Приведенный выше код выполняется только при первом посещении страницы (а не при последующих обратных передачах). Он сначала проверяет переменную сеанса `MyMasterPage` существует. Если это так, он пытается найти соответствующий ListItem в `MasterPageChoice` DropDownList. Если найден соответствующий ListItem его `Selected` свойству `true`.

Также нужны код, сохраняющий выбора пользователя в `MyMasterPage` переменной сеанса. Создайте обработчик событий для `SaveLayout` кнопки `Click` событий и добавьте следующий код:


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample18.cs)]

> [!NOTE]
> К моменту `Click` обработчик будет выполняться при обратной передаче, главной страницы уже выбран. Таким образом выбранных пользователем раскрывающемся списке не будут действовать, пока обратитесь к следующей странице. `Response.Redirect` Заставляет браузер, чтобы повторно запросить `ChooseMasterPage.aspx`.


С `ChooseMasterPage.aspx` страница полностью нашей последнее это имеют `BasePage` назначить `MasterPageFile` свойства на основе значения `MyMasterPage` переменной сеанса. Если не задана переменная сеанса `BasePage` по умолчанию `Site.master`.


[!code-csharp[Main](specifying-the-master-page-programmatically-cs/samples/sample19.cs)]

> [!NOTE]
> После перемещения кода, который назначает `Page` объекта `MasterPageFile` свойство из `OnPreInit` обработчик событий и на два отдельных метода. Это первый метод `SetMasterPageFile`, назначает `MasterPageFile` свойства равным значению, возвращенному методом второй `GetMasterPageFileFromSession`. Внесены `SetMasterPageFile` метод `virtual` , чтобы будущих классы, расширяющие `BasePage` при необходимости его можно изменить для реализации пользовательской логики, при необходимости. Мы рассмотрим пример переопределения `BasePage`в `SetMasterPageFile` свойство в следующем уроке.


Этот код в месте, посетите `ChooseMasterPage.aspx` страницы. Изначально `Site.master` Главная страница является выбранного (см. рис. 6), но пользователь может выбрать другую главную страницу из раскрывающегося списка.


[![Страницы содержимого, отображаются с использованием Site.master главной страницы](specifying-the-master-page-programmatically-cs/_static/image17.png)](specifying-the-master-page-programmatically-cs/_static/image16.png)

**На рисунке 06**: страницы содержимого, отображаются с помощью `Site.master` главной страницы ([Просмотр полноразмерное изображение](specifying-the-master-page-programmatically-cs/_static/image18.png))


[![Страницы содержимого отображаются с помощью Alternate.master главной страницы](specifying-the-master-page-programmatically-cs/_static/image20.png)](specifying-the-master-page-programmatically-cs/_static/image19.png)

**На рисунке 07**: страницы содержимого, отображаются с помощью `Alternate.master` главной страницы ([Просмотр полноразмерное изображение](specifying-the-master-page-programmatically-cs/_static/image21.png))


## <a name="summary"></a>Сводка

При посещении страницы содержимого, его элементы управления содержимым совмещенного с элементами управления ContentPlaceHolder главной страницы. Страницы содержимого главной страницы обозначается `Page` класса `MasterPageFile` свойство, которое назначено `@Page` директивы `MasterPageFile` атрибута во время стадии инициализации. Как этого учебника, показали, что мы можно присвоить значение `MasterPageFile` свойства при условии, что мы делаем до окончания PreInit рабочей области. Возможность программно задать главной страницы создает предпосылки для более сложных сценариев, таких как динамическое связывание страницы содержимого на главную страницу, в зависимости от внешних факторов.

Программирование довольны!

### <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, рассматриваемые в этом учебнике см. в следующих ресурсах:

- [Схема жизненного цикла страницы ASP.NET](http://emanish.googlepages.com/Asp.Net2.0Lifecycle.PNG)
- [Общие сведения о жизненного цикла страницы ASP.NET](https://msdn.microsoft.com/library/ms178472.aspx)
- [Обзор обложки и темы ASP.NET](https://msdn.microsoft.com/library/ykzx33wh.aspx)
- [Главных страниц: Советы, рекомендации и ловушек](http://www.odetocode.com/articles/450.aspx)
- [Темы в ASP.NET](http://www.odetocode.com/articles/423.aspx)

### <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор по ASP/ASP.NET и основатель 4GuysFromRolla.com, работает с веб-технологиями Майкрософт с 1998 года. Скотт — независимый консультант, trainer и записи. Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 3.5 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco). Скотт может быть достигнута по [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com) или через его блог по [http://ScottOnWriting.NET](http://scottonwriting.net/).

### <a name="special-thanks-to"></a>Благодарности

Этот учебник ряд прошел проверку многие полезные рецензентов. Основной рецензент этого учебника было Банерджи Suchi. Объясняются моих последующих статей для MSDN? Если Да, напишите мне по[mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)

>[!div class="step-by-step"]
[Назад](master-pages-and-asp-net-ajax-cs.md)
[Вперед](nested-master-pages-cs.md)
