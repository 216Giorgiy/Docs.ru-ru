---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-cs
title: Записи сведений об ошибках с состоянием системы ASP.NET мониторинга (C#) | Документы Microsoft
author: rick-anderson
description: Система мониторинга работоспособности корпорации Майкрософт предоставляет простой и настраиваемый способ входа различных веб-события, включая необработанных исключений. В этом учебнике представлены фи...
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/09/2009
ms.topic: article
ms.assetid: b1abb452-642a-4ff3-8504-37b85590ff79
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-cs
msc.type: authoredcontent
ms.openlocfilehash: 370f19b36628a9811a31e263e468453897cb7d92
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
ms.locfileid: "30888527"
---
<a name="logging-error-details-with-aspnet-health-monitoring-c"></a>Записи сведений об ошибках с состоянием системы ASP.NET мониторинга (C#)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить код](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_CS.zip) или [скачать PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_cs.pdf)

> Система мониторинга работоспособности корпорации Майкрософт предоставляет простой и настраиваемый способ входа различных веб-события, включая необработанных исключений. Этот учебник Пошаговое руководство по настройке системы мониторинга работоспособности для журнала необработанных исключений в базе данных и для уведомления разработчиков через сообщение электронной почты.


## <a name="introduction"></a>Вступление

Ведение журнала — это эффективное средство для мониторинга работоспособности развернутого приложения и диагностики проблем, которые могут возникнуть. Это особенно важно в журнал ошибок, возникающих в развернутом приложении, чтобы их можно исправить. `Error` Событие вызывается каждый раз, когда происходит необработанное исключение в приложении ASP.NET; [предыдущего учебника](processing-unhandled-exceptions-cs.md) было показано, как уведомить разработчик ошибки и регистрировать ее данные путем создания обработчика событий для `Error` событий. Однако создание `Error` обработчик событий для журнала сведения об ошибке и уведомления разработчик необязателен, как эта задача может выполнять ASP. NET *система наблюдения за работоспособностью*.

Система наблюдения за работоспособностью появилась в ASP.NET 2.0 и предназначен для мониторинга работоспособности развернутого приложения ASP.NET с помощью записи событий, возникающих во время или время существования запроса приложения. События, записанные система наблюдения за работоспособностью, называются *событий мониторинга работоспособности* или *веб-события*и включают:

- События жизненного цикла приложения, например, когда приложение запускает или останавливает
- События безопасности, включая неудачных попыток входа и неудачных запросов авторизации URL-адрес
- Ошибки приложения, включая необработанные исключения, состояние представления анализа исключений, запрос проверки исключений и ошибок компиляции, среди других типов ошибок.

Когда возникает событие мониторинга работоспособности его можно записать на любое число указанного *входа источников*. Система наблюдения за работоспособностью поставляется с источников журнала, которые журналов веб-событий базы данных Microsoft SQL Server, в журнал событий Windows или через сообщение электронной почты, в частности. Также можно создавать собственные источники журнала.

События, система наблюдения за работоспособностью журналов вместе с источников журнала, используемых, определяются в `Web.config`. Всего несколько строк конфигурации разметки можно использовать для входа в базу данных все необработанные исключения и с уведомлением об исключении по электронной почте мониторинга работоспособности.

## <a name="exploring-the-health-monitoring-systems-configuration"></a>Просмотр конфигурации системы наблюдения за работоспособностью

Сведения о конфигурации, который находится в определяется поведение системы наблюдения за работоспособностью [ `<healthMonitoring>` элемент](https://msdn.microsoft.com/library/2fwh2ss9.aspx) в `Web.config`. Этот раздел конфигурации определяет, помимо прочего, следующие три важных аспекта сведений:

1. События мониторинга работоспособности, когда возникло, должно быть записано
2. Источники журналов и
3. Сопоставление каждого события, определенные в (1) мониторинга состояния источников журнала определены в (2).

Эти данные определяются через три дочерние элементы конфигурации: [ `<eventMappings>` ](https://msdn.microsoft.com/library/yc5yk01w.aspx), [ `<providers>` ](https://msdn.microsoft.com/library/zaa41kz1.aspx), и [ `<rules>` ](https://msdn.microsoft.com/library/fe5wyxa0.aspx)соответственно.

Сведения о конфигурации системы мониторинга работоспособности по умолчанию можно найти в `Web.config` файла в `%WINDIR%\Microsoft.NET\Framework\version\CONFIG` папки. Данные конфигурации по умолчанию, с некоторую разметку удалены для краткости показан ниже:

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample1.xml)]

Работоспособность определенных событий мониторинга интерес в `<eventMappings>` элемент, который предоставляет имя понятную для класса событий мониторинга работоспособности. В разметке выше `<eventMappings>` элемент присваивает имя понятную «Всех ошибок» для мониторинга событий типа состояния `WebBaseErrorEvent` и имя «аудит отказов» для мониторинга событий типа состояния `WebFailureAuditEvent`.

`<providers>` Элемент определяет источники журналов, предоставляя им имя понятную и указания сведений для журнала настройки конкретного источника. Первый `<add>` элемент определяет поставщика «EventLogProvider», который заносит в журнал мониторинга событий с помощью указанного состояния `EventLogWebEventProvider` класса. `EventLogWebEventProvider` Класс регистрирует событие в журнал событий Windows. Второй `<add>` элемент определяет поставщика «SqlWebEventProvider», который записывает события в базу данных Microsoft SQL Server через `SqlWebEventProvider` класса. Конфигурация «SqlWebEventProvider» указывает строку подключения базы данных (`connectionStringName`) среди других параметров конфигурации.

`<rules>` Элемент сопоставляет события, указанного в `<eventMappings>` элемент вход источников `<providers>` элемента. По умолчанию веб-приложений ASP.NET журнала всех необработанных исключений и отказов в журнал событий Windows.

## <a name="logging-events-to-a-database"></a>События ведения журнала для базы данных

Конфигурация по умолчанию системы мониторинга работоспособности можно настроить на основе приложений, веб-приложение web путем добавления `<healthMonitoring>` раздел в приложение `Web.config` файл. Можно включить дополнительные элементы в `<eventMappings>`, `<providers>`, и `<rules>` разделы с помощью `<add>` элемента. Для удаления параметров с использованием конфигурации по умолчанию `<remove>` элемент или используйте `<clear />` для удаления всех значений по умолчанию из одного из этих разделов. Настроим рецензий веб-приложения в журнал все необработанные исключения в базе данных Microsoft SQL Server с помощью `SqlWebEventProvider` класса.

`SqlWebEventProvider` Класс является частью система мониторинга работоспособности и регистрирует события в указанную базу данных SQL Server мониторинга состояния. `SqlWebEventProvider` Класс ожидает, что указанная база данных содержит хранимую процедуру с именем `aspnet_WebEvent_LogEvent`. Эта хранимая процедура передается сведений о событии и работать с хранением сведений о событии. Хорошо то необязательно создавать Эта хранимая процедура, ни таблицы для хранения сведений о событии. Можно добавить эти объекты базы данных с помощью `aspnet_regsql.exe` средства.

> [!NOTE]
> `aspnet_regsql.exe` Средство обсуждались в [ *Настройка веб-сайт, использующий службы приложений* учебника](configuring-a-website-that-uses-application-services-cs.md) когда мы добавили поддержку ASP. Службы приложений в сети. Следовательно, веб-сайт рецензий база данных уже содержит `aspnet_WebEvent_LogEvent` хранимой процедуры, в которой хранятся сведения о событии в таблицу с именем `aspnet_WebEvent_Events`.


После создания необходимой хранимой процедуры и таблица, добавленная в базе данных остается для указания для входа в базу данных все необработанные исключения мониторинга работоспособности. Это можно сделать, добавив следующую разметку на веб-сайт `Web.config` файла:

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample2.xml)]

Конфигурация разметки выше используется наблюдения за работоспособностью `<clear />` элементы для мониторинга сведений о конфигурации из предварительно определенного состояния очистки `<eventMappings>`, `<providers>`, и `<rules>` разделы. Единственная запись добавит в следующих разделах.

- `<eventMappings>` Элемент определяет одного состояния событие с именем «Всех ошибок», которое вызывается каждый раз, когда происходит необработанное исключение.
- `<providers>` Определяет источник одного журнала с именем «SqlWebEventProvider», который использует `SqlWebEventProvider` класса. `connectionStringName` Установлен атрибут «ReviewsConnectionString», имя подключения строку, определенную в `<connectionStrings>` раздела.
- Наконец &lt;правила&gt; элемент указывает, когда процесс при возникновении события «Всех ошибок», его занесение с помощью поставщика «SqlWebEventProvider».

Данные конфигурации указывает, что в журнал все необработанные исключения в базу данных рецензий наблюдения за работоспособностью.

> [!NOTE]
> `WebBaseErrorEvent` Событие вызывается только для ошибок сервера; оно не возникает ошибок HTTP, например запрос для ресурса ASP.NET, не найден. Это отличается от поведения `HttpApplication` класса `Error` события, которое вызывается для сервера и ошибки HTTP.


Для просмотра работоспособности, наблюдение за системой в действии, посетите веб-сайт и сформировать ошибку во время выполнения, посетив `Genre.aspx?ID=foo`. Должна отобразиться страница соответствующее сообщение об ошибке - исключение сведения желтый экрана из смерти (при посещении локально) или настраиваемой страницы ошибки (при посещении сайта в производственной среде). В фоновом система наблюдения за работоспособностью журнал сведений об ошибке в базу данных. Должна существовать одна запись в `aspnet_WebEvent_Events` таблицы (см. **рис. 1**); эта запись содержит сведения о только что возникшей ошибки среды выполнения.

[![](logging-error-details-with-asp-net-health-monitoring-cs/_static/image2.png)](logging-error-details-with-asp-net-health-monitoring-cs/_static/image1.png)

**Рис. 1**: сведения об ошибке занесенных `aspnet_WebEvent_Events` таблицы  
([Просмотр полноразмерное изображение](logging-error-details-with-asp-net-health-monitoring-cs/_static/image3.png))

### <a name="displaying-the-error-log-in-a-web-page"></a>Отображение журнала ошибок на веб-странице

Текущая конфигурация веб-сайта система наблюдения за работоспособностью входит все необработанные исключения в базу данных. Тем не менее наблюдение за работоспособностью предоставляет механизм для просмотра журнала ошибок через веб-страницу. Тем не менее можно строить страницы ASP.NET, которая отображает информацию из базы данных. (Как мы увидим моментально, вы можете иметь сведения об ошибке отправляется в сообщении электронной почты.)

При создании такой страницы, убедитесь, что выполнить шаги, чтобы разрешить только авторизованные пользователи могут просматривать сведения об ошибке. Если сайт уже использует учетные записи пользователей можно использовать правила авторизации URL-адреса для ограничения доступа к странице для определенных пользователей или ролей. Дополнительные сведения о том, как предоставить или ограничить доступ к веб-страницы на основе пользователя, вошедшего в систему см. в мой [учебники безопасности веб-сайта](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).

> [!NOTE]
> Последующие учебника изучает альтернативных Ошибка ведения журнала и уведомления о системе с именем ELMAH. ELMAH включает встроенный механизм для просмотра журнала ошибок с веб-страницы и как RSS-канал.


## <a name="logging-events-to-email"></a>Ведение журнала событий, к электронной почте

Система наблюдения за работоспособностью включает регистратор источника ««регистрирует событие в журнале в сообщении электронной почты. Источник журнала содержит те же сведения, который вошел в базу данных в теле сообщения электронной почты. Этот источник журнала можно использовать для уведомления разработчик, при возникновении определенных событий мониторинга работоспособности.

Давайте обновление конфигурации веб-сайта, чтобы мы получили сообщение электронной почты каждый раз, когда исключение происходит рецензий на книги. Для этого необходимо выполнить три задачи:

1. Настройте веб-приложение ASP.NET для отправки электронной почты. Это достигается путем указания способа отправки сообщений электронной почты через `<system.net>` элемента конфигурации. Дополнительные сведения об отправке сообщения электронной почты сообщения в приложении ASP.NET, относятся к [отправки электронной почты в ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx) и [System.Net.Mail часто задаваемые вопросы о](http://systemnetmail.com/).
2. Регистрация поставщика источника журнала по электронной почте в `<providers>` элемент, и
3. Добавить запись `<rules>` элемент, сопоставленный события «Все ошибки» источник регистратор, добавленный в шаге (2).

Система наблюдения за работоспособностью включает два класса поставщика источника журнала по электронной почте: `SimpleMailWebEventProvider` и `TemplatedMailWebEventProvider`. [ `SimpleMailWebEventProvider` Класса](https://msdn.microsoft.com/library/system.web.management.simplemailwebeventprovider.aspx) отправляет сообщение электронной почты в виде обычного текста, включающий событие сведений и обеспечивает Настройка текст сообщения. С [ `TemplatedMailWebEventProvider` класса](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) укажите страницы ASP.NET, отображения разметки используется в теле сообщения электронной почты. [ `TemplatedMailWebEventProvider` Класс](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) предоставляет гораздо больший контроль над содержимое и формат сообщения электронной почты, но требует больше усилий переднего плана, как требуется, чтобы создать страницу ASP.NET, создающий текст сообщения электронной почты. Этот учебник посвящен использованию `SimpleMailWebEventProvider` класса.

Обновление системы наблюдения за работоспособностью `<providers>` элемент в `Web.config` файла следует включить источник журнала для `SimpleMailWebEventProvider` класса:

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample3.xml)]

Выше разметка использует `SimpleMailWebEventProvider` класса в качестве источника регистратора и присваивает его понятное имя «EmailWebEventProvider». Кроме того `<add>` атрибута включает дополнительные параметры конфигурации, такие как Кому и адресам сообщения электронной почты.

С источника журнала по электронной почте, определенного остается для указания система должна использовать этот источник для необработанных исключений «вход» наблюдения за работоспособностью. Это достигается путем добавления нового правила в `<rules>` раздела:

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample4.xml)]

`<rules>` Раздел теперь включает два правила. Первая из них, с именем «Все ошибки для сообщения электронной почты», отправляет все необработанные исключения источник журнала «EmailWebEventProvider». Это правило действует как при отправке сведений об ошибках веб-сайта в указанный адрес. Правило «Всех ошибок для базы данных» записывает сведения об ошибке базы данных сайта. Следовательно каждый раз, когда происходит необработанное исключение на сайте сведений о нем оба регистрироваться в базе и отправляются в указанный адрес электронной почты.

**На рисунке 2** показано сообщение электронной почты, созданных `SimpleMailWebEventProvider` класса при посещении `Genre.aspx?ID=foo`.

[![](logging-error-details-with-asp-net-health-monitoring-cs/_static/image5.png)](logging-error-details-with-asp-net-health-monitoring-cs/_static/image4.png)

**На рисунке 2**: сведения об ошибках отправляются в сообщении электронной почты  
([Просмотр полноразмерное изображение](logging-error-details-with-asp-net-health-monitoring-cs/_static/image6.png))

## <a name="summary"></a>Сводка

Система мониторинга работоспособности ASP.NET позволяет администраторам отслеживать работоспособность развернутого веб-приложения. События мониторинга работоспособности вызываются в том случае, когда unfold определенные действия, например, при остановке приложения, когда пользователь успешно входит на сайт или при возникновении необработанного исключения. Эти события могут регистрироваться с любым количеством источников журнала. Этого учебника были рассмотрены способы записи сведений о необработанных исключений в базе данных и по электронной почте.

Этот учебник основное внимание уделено с помощью мониторинга для необработанных исключений, но имейте в виду, что наблюдение за работоспособностью предназначена для измерения работоспособности развернутого приложения ASP.NET и содержат множество событий мониторинга работоспособности и войти в систему источники не работоспособности изучена здесь. Дополнительные возможности, можно создать собственные мониторинг событий и источники журналов работоспособности в случае необходимости возникнуть. Если нужны дополнительные сведения об наблюдения за работоспособностью, первым шагом является прочитать [Reitan Эрик](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx) [мониторинга часто задаваемые вопросы о работоспособности](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx). После этого обратитесь к [How To: наблюдение за работоспособностью используется в ASP.NET 2.0](https://msdn.microsoft.com/library/ms998306.aspx).

Программирование довольны!

### <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, рассматриваемые в этом учебнике см. в следующих ресурсах:

- [Общие сведения о мониторинге состояния ASP.NET](https://msdn.microsoft.com/library/bb398933.aspx)
- [Настройка и изменение системы ASP.NET наблюдения за работоспособностью](http://dotnetslackers.com/articles/aspnet/ConfiguringAndCustomizingTheHealthMonitoringSystemOfASPNET.aspx)
- [Часто задаваемые вопросы — в ASP.NET 2.0 мониторинга работоспособности](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)
- [Практическое руководство: Отправка электронной почты для уведомлений мониторинга работоспособности](https://msdn.microsoft.com/library/ms227553.aspx)
- [Практическое руководство: Использование, мониторинг работоспособности в ASP.NET](https://msdn.microsoft.com/library/ms998306.aspx)
- [В ASP.NET мониторинга работоспособности](http://aspnet.4guysfromrolla.com/articles/031407-1.aspx)

> [!div class="step-by-step"]
> [Назад](processing-unhandled-exceptions-cs.md)
> [Вперед](logging-error-details-with-elmah-cs.md)
