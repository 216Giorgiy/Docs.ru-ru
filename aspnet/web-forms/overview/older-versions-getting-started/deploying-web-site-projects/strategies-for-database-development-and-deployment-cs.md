---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/strategies-for-database-development-and-deployment-cs
title: "Стратегии разработки баз данных и развертывания (C#) | Документы Microsoft"
author: rick-anderson
description: "При развертывании приложения на основе данных в первый раз, можно просто скопируйте базу данных в среде разработки в рабочую среду. Б..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/23/2009
ms.topic: article
ms.assetid: 3e8b0627-3eb7-488e-807e-067cba7cec05
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/strategies-for-database-development-and-deployment-cs
msc.type: authoredcontent
ms.openlocfilehash: 21d63b175eb52838ac9a12e33efc59fded4ed87d
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="strategies-for-database-development-and-deployment-c"></a>Стратегии разработки баз данных и развертывания (C#)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Скачать PDF](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial10_DBDevel_cs.pdf)

> При развертывании приложения на основе данных в первый раз, можно просто скопируйте базу данных в среде разработки в рабочую среду. Однако выполнение вслепую копию в последующих развертываниях перезапишет любые данные, введенные в производственной базы данных. Вместо этого развертывание базы данных подразумевает применение изменения, внесенные в базу данных разработки с момента последнего развертывания в рабочей базе данных. Этот учебник проверяет эти проблемы и предлагает различные стратегии по их chronicling и применения изменений, внесенных в базу данных с момента последнего развертывания.


## <a name="introduction"></a>Вступление

Как отмечалось в предыдущих учебниках, развертывание приложения ASP.NET влечет за собой копирование нужные содержимого из среды разработки в рабочую среду. Развертывания не однократного события, но вместо то, что происходит каждый раз при выпуске новой версии программного обеспечения, или если ошибки или идентифицировать и описываются проблемы безопасности. При копировании страниц ASP.NET, изображения, файлы JavaScript и других таких файлов в рабочей среде необходимо заниматься как эти файлы изменены с момента последнего развертывания. Можно просто скопировать файл в рабочей среде, перезапись существующего содержимого. К сожалению этой простоты не распространяется на развертывания базы данных.

При развертывании приложения на основе данных в первый раз, можно просто скопируйте базу данных в среде разработки в рабочую среду. Однако выполнение вслепую копию в последующих развертываниях перезапишет любые данные, введенные в производственной базы данных. Вместо этого развертывание базы данных подразумевает применение *изменения* разработки базы данных, выполненных с момента последнего развертывания в рабочей базе данных. Этот учебник проверяет эти проблемы и предлагает различные стратегии по их chronicling и применения изменений, внесенных в базу данных с момента последнего развертывания.

## <a name="the-challenges-of-deploying-a-database"></a>Сложность развертывания базы данных

Перед развертыванием приложения, управляемые данными в первый раз существует только одна база данных, а именно базы данных в среде разработки, поэтому при развертывании приложения на основе данных в первый раз можно просто скопировать базу данных в среда разработки в рабочую среду. Но после развертывания приложения существует две копии базы данных: один в разработке, а другой в рабочей среде.

Между развертываниями разработки и эксплуатации базы данных может стать синхронизированы. Во время схему s рабочей базы данных не изменяется, можно изменить схему s разработки базы данных, по мере добавления новых функций. Может добавить или удалить столбцы, таблицы, представления или хранимые процедуры. Также могут быть важные данные, которые добавляются в базу данных разработки. Многие приложения, управляемые данными включают таблицы подстановки, заполненной данными жестко, относящихся к приложению, недоступны для изменения пользователем. Например, на аукционе веб-сайт может иметь раскрывающегося списка для выбора, описывающие условия auctioned элемента: New, как новые, хорошо и удовлетворительные. Вместо того чтобы жестко запрограммированные этих параметров непосредственно в раскрывающемся списке обычно лучше поместить их в таблицу базы данных. Если во время разработки, новое условие с именем плохо добавляется к таблице нажмите при развертывании приложения этой же записи должен быть добавлен к таблице подстановки рабочей базы данных.

В идеальном случае развертывания базы данных будет включать в себя копирование базы данных из среды разработки в рабочую среду. Но следует помнить, что после развертывания приложения и возобновить разработки рабочей базы данных заполняется с реальными данными от реальных пользователей. Таким образом Если нужно просто скопировать базу данных из среды разработки в рабочей среде во время следующего развертывания необходимо перезаписать рабочей базы данных и потерять его существующих данных. Конечным результатом становится, что развертывание базы данных сводится к применение изменений, внесенных в базу данных разработки с момента последнего развертывания.

Развертывание базы данных подразумевает применение изменений в схеме и, возможно, данные с момента последнего развертывания, журнал изменений должна поддерживать (или определить во время развертывания), чтобы эти изменения могут применяться в рабочей среде. Существуют различные методы для управления и применения изменений в модель данных.

### <a name="defining-the-baseline"></a>Определение базового плана

Для сохранения изменений для базы данных s приложения необходимо иметь некоторые начальное состояние базового плана, к которой применяются изменения. С одной стороны начальное состояние может быть пустой базы данных без таблиц, представлений или хранимых процедур. Такие базовые показатели приводит журнала значительные изменения, так как она должна включать создание всех таблиц базы данных s, представления и хранимые процедуры, а также любые изменения, внесенные после первоначального развертывания. На другом конце спектра базового плана может быть установлено как версия базы данных, сначала развертывается в рабочей среде. Этот выбор приводит гораздо меньшего размера журнала изменений, так как он включает только изменения, внесенные в базу данных после первого развертывания. Именно этот подход, который я предпочитаю. И конечно можно выбрать дополнительные среднего подхода road определение базового плана в какой-то момент между первоначальное Создание базы данных и базы данных после первоначального развертывания.

При наличии зависимости от выбранного базового плана рассмотрите возможность создания скрипт SQL, который может быть выполнен для повторного создания базовой версии. Такой сценарий позволяет быстро повторно создать базовую версию базы данных. Эта функция особенно полезна в крупных проектах, где может быть несколько разработчиков, работающих на проект или дополнительных сред, таких как тестирование или промежуточной, каждая из которых требуется свою собственную копию базы данных.

Существует ряд средств в вашем распоряжении для создания скрипта SQL для базовой версии. Из SQL Server Management Studio (SSMS) вы можете щелкнуть базу данных, перейдите в подменю «задачи» и выберите параметр создания скриптов. Будет запущен мастер скрипт, который можно настроить для создания файла, содержащего команды SQL для создания базы данных s объектов. Другой вариант — мастер публикации базы данных, который может быть создан команды SQL не только для создания схемы базы данных, но данные в таблицах базы данных. Мастер публикации базы данных были проверены подробно обратно в *развертывание базы данных* учебника. Независимо от того, какое средство используется, в конечном счете, необходимо иметь файл скрипта, который можно использовать для повторного создания базовой версии базы данных, в случае необходимости возникнуть.

## <a name="documenting-the-database-changes-in-prose"></a>Документирование базы данных, изменения в тексте

Для записи изменений в тексте является самым простым способом вести журнал изменений в модель данных на этапе разработки. Например, если во время разработки приложения уже развернут добавить новый столбец в `Employees` таблицы, удаления столбца из `Orders` таблицу и добавить новую таблицу (`ProductCategories`), будет поддерживать текстового файла или документа Microsoft Word с журналом, следующие:

<a id="0.4_table01"></a>


| **Дата изменения** | **Изменить сведения о** |
| --- | --- |
| 2009-02-03: | Добавленный столбец `DepartmentID` (`int`, NOT NULL) для `Employees` таблицы. Добавить ограничение внешнего ключа из `Departments.DepartmentID` для `Employees.DepartmentID`. |
| 2009-02-05: | Удален столбец `TotalWeight` из `Orders` таблицы. Связанные данные уже `OrderDetails` записей. |
| 2009-02-12: | Создать `ProductCategories` таблицы. Имеются три столбца: `ProductCategoryID` (`int`, `IDENTITY`, `NOT NULL`), `CategoryName` (`nvarchar(50)`, `NOT NULL`), и `Active` (`bit`, `NOT NULL`). Добавить ограничение первичного ключа для `ProductCategoryID`и значение по умолчанию 1, `Active`. |


Существует ряд недостатки этого подхода. Во-первых есть без возможности автоматизации. В любое время эти изменения должны применяться к базе данных — например, при развертывании приложения — разработчик вручную необходимо реализовать каждый изменить, по одному. Кроме того Если необходимо восстановить базу данных из базового плана, журнал изменений с помощью конкретной версии, это таким образом займет больше времени по мере роста размера журнала. Другим недостатком этого метода является ясность и уровень детализации для каждой записи в журнале изменений остается пользователю, запись изменения. В команде с несколькими разработчиками некоторые может сделать дополнительные, более удобном для чтения или более точное записей, чем другие. Кроме того возможны опечатки и других ошибок ввода данных, связанных с человека.

Основным преимуществом Документирование базы данных, изменения в тексте заключается в простоте. Вы не хотите t необходимость знакомый синтаксис SQL для создания и изменения объектов базы данных. Вместо этого можно записать изменения в тексте и реализовать их через графический пользовательский интерфейс s SQL Server Management Studio.

Ведение журналов изменений в тексте, конечно, не является очень сложных и реализованных работать с определенных проектов, например те, которые имеют большой размер, в области видимости, имеет частые изменения в модель данных, или включать несколько разработчиков. Но я видел такой подход вполне подходят для небольших в нем проектов, имеющих только случайные изменения в модель данных и где соло разработчик не имеет большой опыт в синтаксис SQL для создания и изменения объектов базы данных.

> [!NOTE]
> Хотя сведения в журнале изменений, технически необходим только до развертывания времени, рекомендуется хранение журнала изменений. Однако вместо поддержание один, когда-либо увеличении файла журнала изменений, рассмотрите возможность установки другое изменение файла журнала для каждой версии базы данных. Обычно требуется версия базы данных каждый раз, когда она развернута. Поддерживая журнал журналы изменений можно начиная с базового плана, повторно создать любой версии базы данных, выполнив сценарии изменения журнала, начиная с версии 1 и продолжить вплоть до версии необходимо создать повторно.


## <a name="recording-the-sql-change-statements"></a>Запись изменения инструкции SQL

Ведение журнала изменений в тексте основной недостаток заключается в отсутствии автоматизации. В идеальном случае реализации изменений базы данных в производственной базе данных во время развертывания будет так же легко, как нажатие кнопки для выполнения скрипта, вместо того чтобы вручную выполнить список инструкций. Такие автоматизации возможна, сохраняя изменения журнала, содержащего эти команды SQL, используемая для изменения модели данных.

Синтаксис SQL включает количество инструкций для создания и изменения различных объектов базы данных. Например [ *инструкции CREATE TABLE*](https://msdn.microsoft.com/en-us/library/ms174979.aspx), во время выполнения создает новую таблицу с указанными столбцами и ограничениями. [ *Инструкции ALTER TABLE* ](https://msdn.microsoft.com/en-us/library/ms190273.aspx) изменяет существующую таблицу, добавления, удаления или изменения его столбцы и ограничения. Существуют также инструкции для создания, изменения и удаления индексов, представлений, определяемых пользователем функций, хранимых процедур, триггеров и других объектов базы данных.

Возврат в примере выше образа, который во время разработки, добавьте новый столбец в уже развернутые приложения `Employees` таблицы, удаления столбца из `Orders` таблицу и добавить новую таблицу (`ProductCategories`). Такие действия, приведет к появлению файла журнала изменений с помощью следующих команд SQL:

[!code-sql[Main](strategies-for-database-development-and-deployment-cs/samples/sample1.sql)]

Помещает эти изменения в производственной базе данных во время развертывания — это операция одним щелчком: Откройте SQL Server Management Studio, подключитесь к рабочей базе данных, откройте окно нового запроса, вставьте содержимое журнала изменений и нажмите кнопку выполнить, чтобы запустить скрипт.

## <a name="using-a-comparison-tool-to-synchronize-the-data-models"></a>С помощью средства сравнения для синхронизации модели данных

Документирование изменений базы данных в тексте достаточно, однако для реализации изменений необходимо разработчика для выполнения каждого изменения на одной рабочей базы данных во время. Документирование команды SQL изменение позволяет применить эти изменения на рабочей базы данных как простой и быстрый как нажатие кнопки, но требует обучения, а также захвата инструкций SQL и синтаксис для создания и изменения объектов базы данных. Инструменты для баз данных сравнения себя лучшие из обоих подходов и отклонить худший.

Средство сравнения базы данных, сравнение схем или данных двух баз данных и отображает сводный отчет, показывающий отличия баз данных. Затем нажатием кнопки, можно создавать команды SQL для синхронизации один или несколько объектов базы данных. По сути, средство сравнения базы данных можно использовать для сравнения разработки и рабочих баз данных на развертывание времени, создание файла, который содержит SQL, команд, при выполнении применяют изменения в схему базы данных s производства так что он отражает схему базы данных s разработки.

Существуют разнообразные средства сравнения базы данных сторонних разработчиков, предлагаемые разными поставщиками. Пример — [ *SQL Compare*](http://www.red-gate.com/products/SQL_Compare/), [ *компании Red Gate Software*](http://www.red-gate.com/). Позвольте выполнить весь процесс с помощью SQL Compare сравнивать и синхронизировать схемы базы данных разработки и эксплуатации s.

> [!NOTE]
> На момент написания этой статьи текущая версия SQL Compare был версии 7.1, с оценкой затрат 395 выпуска Standard Edition. Можно продолжить работу, загрузив бесплатную пробную версию 14 дней.


При запуске SQL Compare откроется диалоговое окно проекты сравнения, отображая сохраненные проекты SQL Compare. Создайте новый проект. Запустится мастер конфигурации проекта, который запрашивает сведения о базах данных для сравнения (см. рис. 1). Введите сведения для баз данных среда разработки и эксплуатации.


[![Сравнение разработки и рабочих баз данных](strategies-for-database-development-and-deployment-cs/_static/image2.jpg)](strategies-for-database-development-and-deployment-cs/_static/image1.jpg)

**Рис. 1**: сравнение разработки и рабочих баз данных ([Просмотр полноразмерное изображение](strategies-for-database-development-and-deployment-cs/_static/image3.jpg))


> [!NOTE]
> Если среда разработки базы данных является файлом базы данных SQL Express Edition в `App_Data` папку веб-сайта, вам потребуется зарегистрировать базу данных на сервере базы данных SQL Server Express, чтобы выбрать его в диалоговом окне показаны на рисунке 1. Чтобы открыть SQL Server Management Studio (SSMS), соединиться с сервером базы данных SQL Server Express и присоедините базу данных — самый простой способ выполнения этой задачи. Если у вас на компьютере установлена среда SSMS можно загрузить и установить бесплатную [ *версии SQL Server 2008 Management Studio Basic*](https://www.microsoft.com/downloads/details.aspx?FamilyId=7522A683-4CB2-454E-B908-E805E9BD4E28&amp;displaylang=en).


Помимо выбора баз данных для сравнения, можно также указать различные параметры сравнения на вкладке «Параметры». Один из вариантов, вы можете включить — «игнорировать ограничения и индекса имена.» Помните, что в предыдущем учебнике мы добавляемые объекты базы данных для разработки и эксплуатации базы данных служб приложений. Если вы использовали `aspnet_regsql.exe` средства для создания этих объектов в рабочей базе данных, то вы обнаружите, что первичный ключ и ограничение уникальности имен отличаются между базами данных разработки и эксплуатации. В результате SQL Compare помечаются все приложения службы таблиц как отличающийся. Можно либо оставить «игнорировать ограничения и индекса имена» снят флажок и синхронизировать имена ограничений, или поручить SQL Compare игнорировать эти различия.

После выбора базы данных для сравнения и просмотр параметров сравнения, нажмите кнопку теперь сравнения, чтобы начать сравнение. На следующих нескольких секунд SQL Compare проверяет схем двух баз данных и создает отчет о том, как они отличаются. Я хранить намеренно внесены некоторые изменения в базу данных разработки, чтобы показать, как такие расхождения отмечаются в интерфейсе SQL Compare. Как показано на рисунке 2, я хранить добавлены `BirthDate` столбец `Authors` таблица, удаляется `ISBN` столбец из `Books` таблицу и добавить новую таблицу, `Ratings`, которая предназначена для посетителей сайта скорость проверки электронной.

> [!NOTE]
> Для демонстрации использования средство сравнения базы данных были выполнены изменения модели данных, сделанные в этом учебнике. Не позволяет найти эти изменения в базе данных в будущих учебниках.


[![Сравнение SQL перечислены различия между разработкой и производственных баз данных](strategies-for-database-development-and-deployment-cs/_static/image5.jpg)](strategies-for-database-development-and-deployment-cs/_static/image4.jpg)

**На рисунке 2**: сравнение SQL перечислены различия между разработки и рабочих баз данных ([Просмотр полноразмерное изображение](strategies-for-database-development-and-deployment-cs/_static/image6.jpg))


Сравнение SQL разбивает объектов базы данных на группы, быстро отображаются объекты, которые существуют в обеих базах данных, но различаются, объекты существуют в одной базе данных, но не в другом и объектов, которые идентичны. Как видите, существует два объекта, которые существуют в обеих базах данных, но различаются: `Authors` таблицу, которая содержит столбец, добавленный, и `Books` таблицу, которая имеет один удалены. Один объект, который существует только в базе данных разработки, а именно вновь созданный `Ratings` таблицы. И 117 объекты, которые совпадают в обеих базах данных.

При выборе объекта базы данных отображаются окном различия SQL, в котором показано, как эти объекты отличаются. Выделяет окна SQL различий, отображаемой в нижней на рис. 2, `Authors` таблицы в базе данных разработки `BirthDate` столбец, который не найден в `Authors` таблицы в рабочей базе данных.

После просмотра различий и выбора какие объекты, которые требуется синхронизировать, следующим шагом является создают команды SQL, необходимые для обновления схемы s рабочей базы данных данными из базы данных разработки. Это можно сделать через мастер синхронизации. Мастер синхронизации подтверждает, что объекты для синхронизации и приводится краткое описание действия плана (см. рис. 3). Можно немедленно синхронизировать базы данных или создать скрипт с командами SQL, которые могут быть запущены в свободное время.


[![Воспользуйтесь мастером синхронизации для синхронизации схем баз данных](strategies-for-database-development-and-deployment-cs/_static/image8.jpg)](strategies-for-database-development-and-deployment-cs/_static/image7.jpg)

**Рис. 3**: используйте мастер синхронизации, чтобы синхронизировать свои схемы базы данных ([Просмотр полноразмерное изображение](strategies-for-database-development-and-deployment-cs/_static/image9.jpg))


Сравнение инструменты для баз данных, например Red Gate Software s SQL Compare сделать применяет эти изменения в схему базы данных разработки в производственной базе данных так же легко, как точку и нажмите кнопку.

> [!NOTE]
> Сравнение SQL сравнивает и синхронизирует две базы данных *схемы*. К сожалению оно не сравнивать и синхронизировать данные в таблицах двух баз данных. Компании Red Gate Software предлагают продукт с именем [ *сравнение данных SQL* ](http://www.red-gate.com/products/SQL_Data_Compare/) , сравнение и синхронизация данных между двумя базами данных, но он является отдельным продуктом из SQL Compare и обходится другой 395.


## <a name="taking-the-application-offline-during-deployment"></a>Используя приложение в автономный режим во время развертывания

Как мы хранять убедились в других частях этих учебников развертывания является процессом, который состоит из нескольких этапов: копирование страницы ASP.NET, главные страницы, CSS файлы, JavaScript файлы, изображения и другие необходимые содержимое из среды разработки в рабочей среде Среда; Копирование сведений о конфигурации, относящиеся к среде производства, при необходимости; и применения изменений в модель данных с момента последнего развертывания. В зависимости от числа файлов и сложности изменения базы данных эти действия может занять от нескольких секунд до нескольких минут для завершения. Во время этого периода веб-приложения является меняется и пользователей, на узле, могут возникнуть ошибки или непредвиденное поведение.

При развертывании веб-сайта рекомендуется отключить веб-приложение «» до завершения развертывания. Перевод приложения в автономный режим (и ее перевод создайте резервную копию после завершения процесса развертывания) можно так же легко, как передача файла и удалив ее. Начиная с ASP.NET 2.0, явное присутствие файла с именем `app_offline.htm` в s приложения корневой каталог занимает весь веб-сайт, «сети». Любой запрос на странице ASP.NET на данном сайте автоматически выводила содержимое `app_offline.htm` файла. После удаления этого файла приложение становится доступной.

Создание приложение в автономный режим во время развертывания, затем — сложнее, чем отправка `app_offline.htm` файла в рабочей среде s корневой каталог перед началом процесса развертывания и удалив ее (или переименование его на другое), после развертывания завершена. Дополнительные сведения об этом приеме, обратитесь к статье s Джон Питерсон, выполнив [ *автономных приложений ASP.NET*](http://www.15seconds.com/issue/061207.htm).

## <a name="summary"></a>Сводка

Основная сложность в развертывание приложения, управляемые данными основано на развертывание базы данных. Так как существуют две версии базы данных — в среде разработки — и в рабочей среде эти две базы данных схемы могут быть синхронизированы по мере добавления новых возможностей в разработке. Какие дополнительные, так как рабочей базы данных как заполняемый с реальными данными от реальных пользователей, невозможно перезаписать рабочей базы данных с базой данных измененный разработки как и при развертывании файлов, которые составляют приложение (страниц ASP.NET, s файлы изображений и т. д). Вместо этого развертывание базы данных влечет за собой реализации точный набор изменений, внесенных в базу данных разработки в рабочей базе данных с момента последнего развертывания.

Этот учебник также рассмотрены три метода для поддержания и применение журнала изменений базы данных. Самым простым подходом является для записи изменений в тексте. Хотя это делает применение этих изменений на производственной базы данных вручную, он не требует знаний команд SQL для создания и изменения объектов базы данных. Для записи изменений как ряд команд SQL является более сложный подход и другой, более удобной в больших проектов или проектов с несколькими разработчиками. Это значительно hastens развертывание этих изменений в целевую базу данных. Преимущества обоих подходов может осуществляться с помощью средства сравнения базы данных, таких как SQL Compare s Red Gate Software.

Этот учебник завершает задачей корпорации Майкрософт о развертывании приложения, управляемые данными. Следующий набор учебники рассказывается, как реагировать на ошибки в рабочей среде. Мы рассмотрим способы отображения страницы сообщением об ошибке вместо вместо желтый экрана смерти. И мы рассмотрим способы входа s сведения об ошибке и предупреждает при возникновении таких ошибок.

Программирование довольны!

>[!div class="step-by-step"]
[Назад](configuring-a-website-that-uses-application-services-cs.md)
[Вперед](displaying-a-custom-error-page-cs.md)
