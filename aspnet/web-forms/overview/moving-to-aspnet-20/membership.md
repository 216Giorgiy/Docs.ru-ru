---
uid: web-forms/overview/moving-to-aspnet-20/membership
title: "Членство | Документы Microsoft"
author: microsoft
description: "Строит членства в ASP.NET в случае успешного выполнения модели проверки подлинности форм из ASP.NET 1.x. Проверка подлинности форм ASP.NET предоставляет удобный способ incorp..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2005
ms.topic: article
ms.assetid: f2339485-5d78-4c5e-8c0a-dc9b8a315345
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/membership
msc.type: authoredcontent
ms.openlocfilehash: 7e6bff33e9ec1de03c591de6eee2e632c7b7509d
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="membership"></a>Членство
====================
по [Microsoft](https://github.com/microsoft)

> Строит членства в ASP.NET в случае успешного выполнения модели проверки подлинности форм из ASP.NET 1.x. Проверка подлинности форм ASP.NET предоставляет удобный способ включения формы входа в приложение ASP.NET и проверки пользователей от базы данных или другом хранилище данных.


Строит членства в ASP.NET в случае успешного выполнения модели проверки подлинности форм из ASP.NET 1.x. Проверка подлинности форм ASP.NET предоставляет удобный способ включения формы входа в приложение ASP.NET и проверки пользователей от базы данных или другом хранилище данных. Члены класса FormsAuthentication позволяют обрабатывать файлы cookie для проверки подлинности, проверки является допустимым именем входа, входа пользователя, и т. д. Однако реализация проверки подлинности форм в приложении ASP.NET 1.x может потребовать большого объема кода.

Членство в ASP.NET 2.0 – крупное улучшение по сравнению с использованием только проверки подлинности форм. (Членство самые надежные в сочетании с помощью форм, но с помощью форм, не обязательно). Как скоро можно будет увидеть, можно использовать членство ASP.NET и элементы управления входом в ASP.NET 2.0 для реализации системы членства мощные вообще без написания кода.

## <a name="implementing-membership-in-aspnet-20"></a>Реализация членства в ASP.NET 2.0

Членство реализуется следующие четыре шага. Имейте в виду, что существует множество действий, а также дополнительная настройка, которую можно реализовать также участвующих. Эти действия предназначены для демонстрации общую картину Настройка членства.

1. Создание базы данных членства (если SQL Server используется в качестве хранилища членства.)
2. Укажите параметры членства в файлах конфигурации приложения. (Членство включен по умолчанию).
3. Определите тип хранилища членства, который вы хотите использовать. Доступны следующие параметры. 

    - Microsoft SQL Server (версии 7.0 или более поздней версии)
    - Хранилище Active Directory
    - Пользовательского поставщика членства
4. Настройте приложение для проверки подлинности форм ASP.NET. Опять же членство позволяет воспользоваться преимуществами проверки подлинности форм, но с помощью форм проверки подлинности не требуется.
5. Определите учетные записи пользователей для членства и настроить роли, при необходимости.

## <a name="creating-the-membership-database"></a>Создание базы данных членства

Если нужно определить, с помощью SQL Server 7.0 или более поздней версии, как хранилище членства можно использовать aspnet\_regsql программы (доступно, проще всего из Visual Studio .NET 2005 командной строки) для настройки базы данных. Aspnet\_regsql программа может использоваться в качестве средства командной строки или с помощью графического интерфейса мастера. Метод мастер является самым простым способом настройки базы данных. Чтобы открыть мастер, просто выполните следующую команду:

`aspnet_regsql W`

После выполнения этой команды откроется с помощью мастера установки ASP.NET SQL Server как показано ниже.


![](membership/_static/image1.jpg)

**Рис. 1**


Мастер установки SQL Server ASP.NET создает веб-сайт в экземпляр, который указывается в мастере. Тем не менее ASP.NET использует строку подключения в файле machine.config для подключения к базе данных. По умолчанию, эта строка подключения указывает на экземпляр SQL Server 2005, поэтому если вы используете экземпляр SQL Server 2000 или SQL Server 7.0, необходимо изменить строку подключения в файле machine.config. Здесь можно найти эту строку подключения:

[!code-xml[Main](membership/samples/sample1.xml)]

К сожалению Если не изменить строку подключения, ASP.NET не предоставит описательное сообщение об ошибке. Он просто продолжать жалуются, о том, что база данных еще не создана. В нашем случае выше я изменил строку подключения, чтобы она указывала на мой локальный экземпляр SQL Server 2000.

## <a name="specifying-configuration-and-adding-users-and-roles"></a>Указание конфигурации и добавление пользователей и ролей

Следующим шагом в настройке членства является добавление необходимой информации в файл web.config приложения. В ASP.NET 1.x, изменив файл web.config был иногда сложно из-за использования lowerCamelCase и отсутствие Intellisense. Visual Studio .NET 2005 задачи значительно упрощает с поддержкой технологии Intellisense для файлов конфигурации, но ASP.NET 2.0 делает больше, предоставляя веб-интерфейса для изменения файлов конфигурации.

Веб-интерфейса можно запустить, нажав кнопку конфигурации ASP.NET на панели инструментов обозревателя решений, как показано ниже. Можно также запустить веб-интерфейс через всплывающие окна, которые отображаются при вставке элементов управления входом.


![](membership/_static/image2.jpg)

**Рис. 2**


Будет запущен ASP.NET Web Site Administration Tool, показано ниже. Администрирование веб-сайта ASP.NET — это интерфейс четыре вкладки, который облегчает управление параметрами приложения. Доступны следующие вкладки:

- **Домашняя**
- **Безопасность** настройки пользователей, роли и доступ.
- **Приложение** настройки параметров приложения.
- **Поставщик** Настройка и тестирование приложений поставщик членства.

Web Site Administration Tool позволяет легко создавать новых пользователей, создать новые роли и для управления пользователями и ролями. Эта возможность доступна не во интерфейса Windows. Интерфейс Windows позволяет легко определять параметры авторизации и добавление, удаление и управление поставщиками, возможности, которые не находятся в Web Site Administration Tool.

Для запуска интерфейса Windows, откройте оснастку служб IIS, щелкните правой кнопкой мыши на приложение и выберите пункт Свойства. Перейдите на вкладку ASP.NET, а затем нажмите кнопку Изменить конфигурацию. (Приложения должен быть запущен в среде ASP.NET 2.0 для кнопки изменения конфигурации должно быть включено. Можно настроить ASP.NET версии в диалоговом окне ASP.NET.) Диалоговое окно параметров конфигурации ASP.NET отображается в том случае, как показано ниже.


![](membership/_static/image3.jpg)

**Рис. 3**


На вкладке "Общие" перечисляются строки подключения и параметры приложения. Все параметры курсивом определенные в родительском файле конфигурации (machine.config или web.config на более высоком уровне) и параметров не курсивом из файла конфигурации приложения. Если добавляется параметр, удалены или изменены на уровне приложения ASP.NET будет добавить, удалить или изменить параметр в web.config уровня приложения вместо удаление настройки из файла конфигурации, из которого он унаследован.

Ниже показана вкладка проверки подлинности. Это происходит, где вы настроите параметры членства. Форм поставщиков членства, параметры проверки подлинности и поставщиков ролей можно настроить здесь.


![](membership/_static/image4.jpg)

**Рис. 4**


## <a name="implementing-membership-in-your-application"></a>Реализации членства в приложении

Самый простой способ реализации членства в ASP.NET 2.0 в приложении является использование указанных элементов управления входа в систему. Этот метод позволяет реализовать основы членства в ASP.NET 2.0 без написания кода вообще.

В ASP.NET 2.0 доступны следующие элементы управления входа в систему.

## <a name="login-control"></a>Элемент управления входа

Входа в систему управления предоставляет интерфейс для пользователя для входа в систему членства. Он позволяет использовать имя пользователя и пароль textboxt и кнопки входа. Многие другие часто используемые функции например ссылку для регистрации пользователей, которые еще не сделано, флажок, позволяющий пользователю автоматически имя входа при последующих посещениях, ссылку напоминание пароля и т. д. Все функции управления входом можно настроить через свойства элемента управления.

В ASP.NET 1.x, разработчикам приходилось писать большого объема кода для сверки при использовании проверки подлинности форм. С помощью членства в ASP.NET 2.0 можно выполнять проверку вообще без написания любого кода. ASP.NET автоматически выполнит поиск пользователя. (При использовании элемента управления для входа без использования членства ASP.NET, можно использовать **OnAuthenticate** метод для проверки пользователя.)

## <a name="loginview-control"></a>Элемент управления LoginView

Элемент управления LoginView является шаблонный элемент управления, который предоставляет два шаблона по умолчанию. AnonymousTemplate и LoggedInTemplate. Шаблон, который отображается, определяется ли пользователь вошел в систему членства. Этот элемент управления обычно используется для отображения управления входа, когда пользователь еще не выполнил вход и элемента управления LoginStatus и/или других элементов управления входа, когда пользователь выполнил вход. При использовании в приложении ASP.NET управление ролями элемента управления LoginView можно отобразить конкретный шаблон на основе ролей пользователей. (Более на ASP.NET управление ролями будет рассматриваться позже.)

## <a name="passwordrecovery-control"></a>Элемент управления PasswordRecovery

Управления PasswordRecovery дает пользователям возможность получать сообщение электронной почты с свой текущий пароль или сбросить свой пароль. Открытым текстом и зашифрованные пароли можно восстановить и по электронной почте для пользователей. Если пароль хэшируется, его будет невозможно. Вместо этого пользователю потребуется сбросить пароль.

## <a name="loginstatus-control"></a>Управления LoginStatus

Управления LoginStatus используется для отображения индикатора имени входа для пользователей, которые не регистрируются в и индикатор выхода для пользователей, которые выполнили вход в. Свойство Request.IsAuthenticated используется для определения, какие индикатор, предназначенный для отображения. Значок, отображаемый элементом управления LoginStatus может быть текстом (реализуются с помощью **LoginText** и **LogoutText** свойства) или изображений (реализуются с помощью **LoginImageUrl**и **LogoutImageUrl** свойства.)

Когда пользователь выходит из системы через управления LoginStatus, он или она перенаправляется в URL-адрес указанный **LogoutPageUrl** свойство. Если это свойство не задано, обновляются текущей страницы. Поскольку скорее всего сайт защищен с помощью проверки подлинности форм, обновление текущей страницы будет перенаправлять пользователя на страницу входа для сайта.

## <a name="loginname-control"></a>Элемент управления LoginName

Элемент управления LoginName отображает имя пользователя, вошедшего на сайт.

## <a name="createuserwizard-control"></a>Управления CreateUserWizard

Элемент управления CreateUserWizard предоставляет пользователям удобный способ регистрации для системы членства. Действия (реализованный как коллекция WizardSteps) можно добавить в интерфейсе, показано ниже.


![](membership/_static/image5.jpg)

**Рис. 5**


CreateUserWizard — шаблонный элемент управления, который является производным от класса мастера и предоставляет следующие шаблоны:

- **HeaderTemplate** этот шаблон определяет внешний вид заголовка мастера.
- **SidebarTemplate** этот шаблон управляет внешним видом боковой панели мастера.
- **StartNavigationTemplate** этот шаблон определяет внешний вид панели навигации находятся на этапе запуска мастера.
- **StepNavigationTemplate** этот шаблон определяет внешний вид области навигации в случае начала или окончания шаг.
- **FinishNavigationTemplate** этот шаблон определяет внешний вид области навигации на шаге завершения.

Кроме того для каждого шага, добавить в мастере, ASP.NET будет создавать пользовательский шаблон, который содержит ContentTemplate и CustomNavigationTemplate для данного шага. Чтобы получить подробные сведения о настройке CreateUserWizard см. в документации VS.NET 2005:

## <a name="changepassword-control"></a>Элемент управления ChangePassword

Элемент управления ChangePassword позволяет пользователям менять свой пароль. Если свойство DisplayUserName имеет значение true (по умолчанию значение false), пользователь может изменить свой пароль, когда они не регистрируются. Если пользователь *—* зарегистрировались и свойство DisplayUserName имеет значение true, пользователь сможет изменить пароль другого пользователя, который не вошел в предоставлении знают идентификатор пользователя для этого пользователя.

Имейте в виду, что если требуется, чтобы пользователи могли изменять пароли без необходимости входить, необходимо будет убедитесь, что страница, на которой отображается элемент управления ChangePassword разрешает анонимный доступ. Очевидно, что пользователям придется указать свой старый пароль для смены пароля.

## <a name="role-management"></a>Управление ролями

Управление ролями позволяет назначить пользователей в определенной роли, а затем ограничить доступ к определенным файла или папки на основе этой роли. Управление ролями предоставляет интерфейс API, чтобы можно программно определить роль someones или определить, все пользователи в определенной роли и отреагировать соответствующим образом.

Управление ролями не является обязательным в членства ASP.NET, а также является обязательным для использования управления ролями членства. Однако два хорошо дополняют друг друга и вполне вероятно, что разработчиков будет использовать их в сочетании друг с другом.

Чтобы включить управление ролями в приложении, внести следующие изменения в файл web.config:

[!code-xml[Main](membership/samples/sample2.xml)]

Когда **cacheRolesInCookie** атрибута задано значение true, ASP.NET кэширует членство в роли пользователей в файле cookie на клиентском компьютере. Это позволяет выполнять поиск роли без RoleProvider к вызову. При использовании этого атрибута, разработчики должны убедиться, что **cookieProtection** атрибута будет присвоено значение All. (Это значение по умолчанию). Это гарантирует, что данные cookie шифруются и помогает обеспечить содержимое файлов "cookie" еще не был изменен. Роли можно добавлять с помощью средства администрирования веб-сайта. Он позволяет легко определить роли, настроить доступ к элементам узла, на основе этих ролей и назначать роли пользователям.


![](membership/_static/image6.jpg)

**Рис. 6**


Как показано выше, можно добавить новые роли, просто введите имя роли, выберите команду Добавить роль. Существующие роли можно управлять или удалить, щелкнув соответствующую ссылку в списке существующих ролей.

При управлении роли можно добавлять или удалять пользователей, как показано ниже.


![](membership/_static/image7.jpg)

**Рис. 7**


С помощью флажков пользователь в роли можно легко добавлять пользователя в определенной роли. ASP.NET автоматически обновляться соответствующие записи базы данных членства. Кроме того, потребуется настроить правила доступа для приложения. ASP.NET 1.x разработчики знакомы с делать это через &lt;авторизации&gt; элемент в файле web.config, а этот параметр по-прежнему доступен в ASP.NET 2.0. Тем не менее упрощает управление доступом правила, использующие Web Site Administration Tool как показано ниже.


![](membership/_static/image8.jpg)

**Рис. 8**


В этом случае выделяется папке администрирования (его трудно увидеть так, как средство выделяет его светло-серый цвет) и роли "Администраторы" был предоставлен доступ. Все остальные пользователи — нет. Можно щелкнуть значок головного выберите правило, а затем использовать кнопки вверх и вниз, чтобы настроить правила. Как и в ASP.NET &lt;авторизации&gt; элемента правила обрабатываются в порядке, в котором они отображаются. Другими словами Если порядок правил на приведенном выше снимке были отменены, никто не будет иметь доступ к папке администрирования так как первое правило возникли ASP.NET будет правило, запрещающее всем пользователям в папку.

ASP.NET 2.0 добавляет файл web.config в папку, для которой вы указываете правило доступа. Правила доступа можно изменить файл конфигурации или с помощью Web Site Administration Tool. Другими словами Web Site Administration Tool является просто интерфейсом, через который можно изменить файл конфигурации в понятных среды.

## <a name="using-roles-in-code"></a>С помощью ролей в коде

API для управления ролями не изменялась после версии 1.x. **IsInRole** метод используется для определения того, является ли пользователь в определенной роли.

[!code-csharp[Main](membership/samples/sample3.cs)]

ASP.NET также создает экземпляр RolePrincipal создан как член текущего контекста. Объект RolePrincipal создан может использоваться для получения всех ролей, к которым принадлежит пользователь следующим образом:

[!code-csharp[Main](membership/samples/sample4.cs)]

## <a name="using-rolegroups-with-the-loginview-control"></a>С помощью групп ролей с помощью элемента управления LoginView

Теперь, когда представление управления роли и членство позволяет кратко рассматриваются как элемента управления LoginView использует преимущества этой возможности в ASP.NET 2.0. Как отмечалось ранее элемент управления LoginView является шаблонный элемент управления, содержащий два шаблона по умолчанию. AnonymousTemplate и LoggedInTemplate. В рамках LoginView задачи, которые диалоговое окно является ссылкой (см. ниже), можно изменять группы ролей.


![](membership/_static/image9.jpg)

**Рис. 9**


Каждый объект RoleGroup содержит массив строк, который определяет, какие роли, к которым применяется RoleGroup. Чтобы добавить новый RoleGroup элемента управления LoginView, щелкните ссылку Изменить группы ролей. На приведенном выше рисунке видно, что я добавил новый RoleGroup для администраторов. Выбрав этот RoleGroup (RoleGroup[0]) из раскрывающегося списка представлений можно настроить шаблон, который будет отображаться только членам роли "Администраторы". На рисунке ниже я добавил новый RoleGroup, который применяется к членам роли Sales и распространения. Это добавляет второй RoleGroup представления раскрывающегося списка в диалоговом окне Задачи LoginView и ничего добавлен в шаблон этой отображаются любым пользователем в продаж или распространения роли.


![](membership/_static/image10.jpg)

**Рис. 10**


## <a name="overriding-the-existing-membership-provider"></a>Переопределение существующего поставщика членства

Существует несколько способов, что позволяет расширить функциональные возможности членства ASP.NET. Во-первых очевидно, что можно изменить существующие функциональные возможности класса SqlMembershipProvider, унаследованный от него, а также путем переопределения его методов. Например если необходимо реализовать собственную функциональность пользователей при их создании, можно создать свой собственный класс, наследующий от SqlMembershipProvider следующим образом:

[!code-csharp[Main](membership/samples/sample5.cs)]

Если, с другой стороны, вы хотите создать собственный поставщик (чтобы сохранить данные о членстве в базы данных, например), можно создать собственного поставщика.

## <a name="creating-your-own-membership-provider"></a>Создание поставщика членства

Чтобы создать поставщик членства, сначала необходимо создать класс, наследующий от класса MembershipProvider. Если вы используете VB.NET, Visual Studio 2005 добавит заглушки для всех методов, которые необходимо переопределить. Если вы используете C#, надо добавить заглушки ее вверх.

Необходимо переопределить следующие:

- Свойство ApplicationName
- Функция ChangePassword
- Функция ChangePasswordQuestionAndAnswer
- Функция CreateUser
- Функция DeleteUser
- Свойство EnablePasswordReset
- Свойство EnablePasswordRetrieval
- Функция FindUsersByEmail
- Функция FindUsersByName
- Функция GetAllUsers
- Функция GetNumberOfUsersOnline
- Функция GetPassword
- Функция GetUser
- Функция GetUserNameByEmail
- Свойство MaxInvalidPasswordAttempts
- Свойство MinRequiredNonAlphanumericCharacters
- Свойство значения MinRequiredPasswordLength
- Свойство PasswordAttemptWindow
- Свойство PasswordFormat
- Свойство PasswordStrengthRegularExpression
- Свойство RequiresQuestionAndAnswer
- Свойство RequiresUniqueEmail
- Функция ResetPassword
- Разблокировать пользовательской функции
- Функция UpdateUser
- Функция ValidateUser

Thats список для реализации разработчиков C#. Может оказаться проще создавать класс в VB.NET без какой-либо реализации и затем использовать для преобразования в коде C# .NET Reflector или аналогичное средство.

Строка подключения и другие свойства должно быть присвоено их значения по умолчанию в методе Initialize. (Метод Initialize возникает, когда поставщик загружается во время выполнения.) Второй параметр метода инициализации типа System.Collections.Specialized.NameValueCollection и является ссылкой на &lt;добавить&gt; элемента, связанного с помощью пользовательского поставщика в файле web.config. Этот элемент выглядит следующим образом:

[!code-xml[Main](membership/samples/sample6.xml)]

Ниже приведен пример метода инициализации.

[!code-csharp[Main](membership/samples/sample7.cs)]

Чтобы проверить пользователя, при отправке формы входа в систему, необходимо использовать метод ValidateUser. Этот метод применяется, когда пользователь нажимает кнопку входа в элементе управления входа в систему. Поместите код, выполняющий поиск пользователя в этом методе.

Как можно видеть, запись поставщик членства не является сложной операцией и позволяет расширить эту эффективную функцию ASP.NET 2.0.
