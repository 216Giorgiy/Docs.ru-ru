---
uid: web-forms/overview/moving-to-aspnet-20/data-source-controls
title: Элементы управления источником данных | Документы Microsoft
author: microsoft
description: Элемент управления DataGrid в ASP.NET 1.x помечено как значительные улучшения в доступ к данным в веб-приложений. Однако это не было же прост, как были бы...
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2005
ms.topic: article
ms.assetid: 78fd0e92-f9c6-4e96-a5e9-0375b307a828
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/data-source-controls
msc.type: authoredcontent
ms.openlocfilehash: b1ac7fb62767d61c97fe00338bc0f5087f4863b5
ms.sourcegitcommit: a510f38930abc84c4b302029d019a34dfe76823b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/30/2018
ms.locfileid: "28885899"
---
<a name="data-source-controls"></a>Элементы управления источников данных
====================
по [Microsoft](https://github.com/microsoft)

> Элемент управления DataGrid в ASP.NET 1.x помечено как значительные улучшения в доступ к данным в веб-приложений. Однако это не было же прост, как были бы. Он по-прежнему требуется значительный объем кода, чтобы получить много полезных функций. Это модель при всех он стремится доступа к данным в 1.x.


Элемент управления DataGrid в ASP.NET 1.x помечено как значительные улучшения в доступ к данным в веб-приложений. Однако это не было же прост, как были бы. Он по-прежнему требуется значительный объем кода, чтобы получить много полезных функций. Это модель при всех он стремится доступа к данным в 1.x.

ASP.NET 2.0 решает эту проблему с частично с элементами управления источника данных. Элементы управления источниками данных в ASP.NET 2.0 предоставляют разработчикам декларативную модель для получения данных, отображение данных и изменения данных. Элементы управления источниками данных предназначена для согласованного представления данных к элементам управления с привязкой к данным независимо от источника этих данных. В основе источников данных в ASP.NET 2.0 — это абстрактный класс DataSourceControl. Класс DataSourceControl предоставляет базовую реализацию интерфейса IDataSource, а также интерфейса IListSource, который позволяет назначить элемент управления источником данных в качестве источника данных элемента управления с привязкой к данным (через свойство DataSourceId обсуждается далее) и предоставляют данные, указанные в виде списка. Каждый список данных из элемента управления источником данных представляется как объект DataSourceView. Интерфейс IDataSource предоставляется доступ к экземплярам DataSourceView. Например метод GetViewNames возвращает ICollection, который позволяет перечислять DataSourceViews связанного с элементом управления источником данных, а метод GetView позволяет получить доступ к конкретному экземпляру DataSourceView по имени.

Элементы управления источников данных имеют пользовательский интерфейс. Они реализуются как серверные элементы управления, можно обеспечить декларативного синтаксиса и, чтобы они имели доступ к состоянию страницы при необходимости. Элементы управления источниками данных не отображают разметку HTML для клиента.

> [!NOTE]
> Как вы увидите позже, существует также кэшируется преимущества, полученные с помощью элементов управления источниками данных.


## <a name="storing-connection-strings"></a>Хранение строк подключений

Прежде чем мы перейдем по настройке источников данных, мы должны охватывать новая возможность в ASP.NET 2.0, касающиеся строк подключения. ASP.NET 2.0 появился новый раздел в файле конфигурации, который позволяет легко хранить строки подключения, которые можно считать динамически во время выполнения. &lt;ConnectionStrings&gt; раздел позволяет легко хранить строки подключения.

В приведенном ниже фрагменте добавляет новую строку подключения.

[!code-xml[Main](data-source-controls/samples/sample1.xml)]

> [!NOTE]
> Как и в случае с &lt;appSettings&gt; разделе &lt;connectionStrings&gt; раздел появляется за пределами &lt;system.web&gt; в файле конфигурации.


Чтобы использовать эту строку подключения, можно использовать следующий синтаксис, при задании атрибут ConnectionString серверного элемента управления.

[!code-aspx[Main](data-source-controls/samples/sample2.aspx)]

&lt;ConnectionStrings&gt; раздел может быть также зашифрован, чтобы конфиденциальные сведения не предоставляются. Эту возможность будет рассматриваться в более поздней версии модуля.

## <a name="caching-data-sources"></a>Кэширование источников данных

Каждый DataSourceControl предоставляет четыре свойства для настройки кэширования; EnableCaching CacheDuration, CacheExpirationPolicy и CacheKeyDependency.

## <a name="enablecaching"></a>EnableCaching

EnableCaching — это логическое свойство, которое определяет ли кэширование включено для элемента управления источником данных.

## <a name="cacheduration-property"></a>Свойство CacheDuration

Свойства CacheDuration задает число секунд, кэш остается допустимым. Присвоение этому свойству **0** приводит кэша остается действительным, пока не будет явно недействительными.

## <a name="cacheexpirationpolicy-property"></a>Свойство CacheExpirationPolicy

Свойство CacheExpirationPolicy можно задать либо **абсолютный** или **скользящий**. Установка абсолютный означает, что количество секунд, указанных в свойстве CacheDuration максимальное количество времени, данные будут кэшироваться. Присвойте ему значение скользящий, срок действия сбрасывается при выполнении каждой операции.

## <a name="cachekeydependency-property"></a>Свойство CacheKeyDependency

Если указано строковое значение для свойства CacheKeyDependency, ASP.NET будет установлен новый зависимости кэша на основе этой строки. Это позволяет явно делают кэш недействительным путем изменения или удаления CacheKeyDependency.

**Важные**: Если олицетворение включено и доступ к источнику данных и/или содержимое данных основаны на учетных данных клиента, рекомендуется, кэширование отключено, установив EnableCaching значение False. Если включено кэширование в этом сценарии, пользователя, отличного от пользователя, запросившего данные первоначально выдает запрос на авторизацию для источника данных не применяется. Данные просто будет предоставляться из кэша.

## <a name="the-sqldatasource-control"></a>Элемент управления SqlDataSource

Элемент управления SqlDataSource позволяет разработчику для доступа к данным, которые хранятся в реляционной базе данных, поддерживающий ADO.NET. Он может получить доступ к базы данных SQL Server, поставщик System.Data.OleDb, поставщик System.Data.Odbc или System.Data.OracleClient поставщик для доступа к Oracle поставщиком System.Data.SqlClient. Таким образом SqlDataSource наверняка не используется только для доступа к данным в базе данных SQL Server.

Чтобы использовать SqlDataSource, вы просто предоставить значение для свойства ConnectionString и укажите команду SQL или хранимую процедуру. Элемент управления SqlDataSource берет на себя работы с базовой архитектуры ADO.NET. Он открывается соединение, запрашивает источник данных или выполняет хранимую процедуру, возвращает данные и затем закрывает подключение.

> [!NOTE]
> Поскольку класс DataSourceControl автоматически закрывает подключение, его следует уменьшить число вызовов клиента, созданные утечка подключения к базе данных.


Приведенный далее фрагмент кода привязывает элемент управления DropDownList для элемента управления SqlDataSource с помощью строки подключения, которая хранится в файле конфигурации, как показано выше.

[!code-aspx[Main](data-source-controls/samples/sample3.aspx)]

Как показано выше, свойство DataSourceMode SqlDataSource режим для источника данных. В приведенном выше примере DataSourceMode имеет значение DataReader. В этом случае SqlDataSource вернет объект IDataReader, с помощью курсора однонаправленные и только для чтения. Указанный тип объекта, возвращаемого управляется поставщиком, который используется. В этом случае используется поставщиком System.Data.SqlClient, указанное в &lt;connectionStrings&gt; раздел файла web.config. Таким образом, возвращаемый объект будет иметь тип SqlDataReader. Указывая значение DataSourceMode набора данных, данные могут храниться в наборе данных на сервере. Этот режим позволяет добавлять компоненты, такие как сортировка, разбиение на страницы и т. д. Если я было привязки данных SqlDataSource для элемента управления GridView, я бы выбрали режим набора данных. Однако в случае DropDownList DataReader режим — правильный выбор.

> [!NOTE]
> При кэшировании SqlDataSource или AccessDataSource, свойство DataSourceMode должно быть присвоено набора данных. Включение кэширования с DataSourceMode объекта DataReader, возникнет исключение.


## <a name="sqldatasource-properties"></a>Свойства SqlDataSource

Ниже приведены некоторые свойства элемента управления SqlDataSource.

### <a name="cancelselectonnullparameter"></a>CancelSelectOnNullParameter

Логическое значение, указывающее, отменяется ли команды select, если один из параметров имеет значение null. Значение true означает, что по умолчанию.

### <a name="conflictdetection"></a>ConflictDetection

В ситуации, когда несколько пользователей может обновление источника данных в то же время свойство ConflictDetection определяет поведение элемента управления SqlDataSource. Это свойство возвращает одно из значений перечисления ConflictOptions. Эти значения являются **CompareAllValues** и **OverwriteChanges**. Если задано значение OverwriteChanges последнего пользователя для записи данных в источнике данных перезаписывает все предыдущие изменения. Однако если свойство ConflictDetection равно CompareAllValues, создается для столбцов, возвращаемых методом SelectCommand параметры и параметры также создаются для хранения исходных значений в каждом из этих столбцов, позволяя SqlDataSource для Определите ли, что значения изменились с момента выполнения SelectCommand.

### <a name="deletecommand"></a>DeleteCommand

Задает или возвращает строку SQL, используемую для удаления строк из базы данных. Это может быть SQL-запрос или имя хранимой процедуры.

### <a name="deletecommandtype"></a>DeleteCommandType

Задает или возвращает тип команды delete, либо SQL-запрос (текст) или хранимой процедуры (Хранимая_процедура).

### <a name="deleteparameters"></a>DeleteParameters

Возвращает параметры, используемые DeleteCommand SqlDataSourceView объекта, связанного с элементом управления SqlDataSource.

### <a name="oldvaluesparameterformatstring"></a>OldValuesParameterFormatString

Это свойство используется для указания формата исходное значение параметров в случаях, где ConflictDetection является свойство CompareAllValues. Значение по умолчанию — {0}, это означает, что первоначальных параметров значение будет иметь имя, совпадающее с именем исходный параметр. Другими словами, если имя поля EmployeeID, исходное значение параметра будет @EmployeeID.

### <a name="selectcommand"></a>SelectCommand

Задает или получает строку SQL, которая используется для получения данных из базы данных. Это может быть SQL-запрос или имя хранимой процедуры.

### <a name="selectcommandtype"></a>SelectCommandType

Задает или возвращает тип команды select, либо SQL-запрос (текст) или хранимой процедуры (Хранимая_процедура).

### <a name="selectparameters"></a>SelectParameters

Возвращает параметры, используемые SqlDataSourceView объекта, связанного с элементом управления SqlDataSource SelectCommand.

### <a name="sortparametername"></a>SortParameterName

Возвращает или задает имя параметра хранимой процедуры, используемый при сортировке данных элемента управления источником данных. Допустимо только в том случае, если хранимая процедура имеет значение SelectCommandType.

### <a name="sqlcachedependency"></a>SqlCacheDependency

Строка, указывающая баз данных и таблиц, используемых в зависимости кэша SQL Server, разделенных точкой с запятой. (Зависимости кэша SQL обсуждаются в модуле в более поздней версии.)

### <a name="updatecommand"></a>UpdateCommand

Задает или получает строку SQL, которая используется при обновлении данных в базе данных. Это может быть SQL-запрос или имя хранимой процедуры.

### <a name="updatecommandtype"></a>UpdateCommandType

Задает или возвращает тип команды обновления, либо SQL-запрос (текст) или хранимой процедуры (Хранимая_процедура).

### <a name="updateparameters"></a>UpdateParameters

Возвращает параметры, используемые UpdateCommand SqlDataSourceView объекта, связанного с элементом управления SqlDataSource.

## <a name="the-accessdatasource-control"></a>Элемент управления AccessDataSource

Элемент управления AccessDataSource является производным от класса SqlDataSource и используется для привязки данных к базе данных Microsoft Access. Свойство ConnectionString для элемента управления AccessDataSource является свойством только для чтения. Вместо свойства ConnectionString, свойство DataFile используется для указания базы данных Access, как показано ниже.

[!code-aspx[Main](data-source-controls/samples/sample4.aspx)]

AccessDataSource, всегда устанавливает ProviderName базовый SqlDataSource System.Data.OleDb и подключается к базе данных с помощью поставщика Microsoft.Jet.OLEDB.4.0 OLE DB. Элемент управления AccessDataSource нельзя использовать для подключения к базе данных Access защищен паролем. При наличии подключения к базе данных защищен паролем, следует использовать элемент управления SqlDataSource.

> [!NOTE]
> Доступа к базам данных, хранящихся в веб-сайт должен быть помещен в приложение\_каталог данных. ASP.NET не позволит сохранять файлы в этом каталоге для просмотра. Необходимо предоставить разрешения на чтение и запись в приложение учетной записи процесса\_каталог данных при использовании базы данных Access.


## <a name="the-xmldatasource-control"></a>Элемент управления XmlDataSource

XmlDataSource позволяет выполнить привязку данных XML-данных к элементам управления с привязкой к данным. Можно привязать к XML-файл, используя свойство DataFile или можно привязать к XML-строку, используя свойство данных. XmlDataSource предоставляет XML-атрибуты в виде привязываемых полей. В случаях, когда нужно выполнить привязку к значениям, которые не представлены в виде атрибутов необходимо использовать преобразование XSL. Можно также использовать выражения XPath к XML-данные фильтра.

Рассмотрим следующий XML-файл.

[!code-xml[Main](data-source-controls/samples/sample5.xml)]

Обратите внимание, что XmlDataSource использует свойство XPath *люди/Person* для фильтрации по просто &lt;лицо&gt; узлов. Элемент DropDownList затем привязывает данные с помощью свойства DataTextField атрибуту «Фамилия».

Хотя управления XmlDataSource в основном используется для привязки данных к XML-данных только для чтения, можно изменить файл данных XML. Обратите внимание, что в таких случаях автоматическая вставка, обновление и удаление данных в XML-файле не происходит автоматически, как и с другими элементами управления источниками данных. Вместо этого необходимо написать код, чтобы вручную изменить данные с помощью следующих методов элемента управления XmlDataSource.

### <a name="getxmldocument"></a>GetXmlDocument

Возвращает объект XmlDocument, содержащий код XML, получаемых XmlDataSource.

### <a name="save"></a>Сохранение

Сохраняет в памяти XmlDocument в источнике данных.

Важно понимать, что метод Save будет работать только в том случае, если выполняются два следующих условия:

1. Свойство DataFile XmlDataSource использует для привязки в XML-файл, а не свойство данных для привязки к данным XML в памяти.
2. Преобразования не указана с помощью преобразования или TransformFile свойства.

Обратите внимание, что метод Save может привести к непредвиденным результатам при вызове несколькими пользователями одновременно.

## <a name="the-objectdatasource-control"></a>Элемент управления ObjectDataSource

Элементы управления источников данных, которые мы рассмотрели вопросы к данному моменту являются отлично варианта 2 уровневого приложения где управления источником данных непосредственно подключается к хранилищу данных. Однако во многих приложениях реальных, многоуровневые приложения где элемент управления источником данных может потребоваться связаться с бизнес-объект, который в свою очередь, взаимодействует с уровнем данных. В таких ситуациях ObjectDataSource заполняет спецификации хорошо. ObjectDataSource работает совместно с исходным объектом. Элемент управления ObjectDataSource создать экземпляр исходного объекта, вызывает указанный метод и удаления экземпляра объекта в области одного запроса, если объект имеет методы экземпляра вместо статических методов (Shared в Visual Basic). Таким образом ваш объект должен быть без сохранения состояния. То есть объект должен получить и освободить все необходимые ресурсы в диапазоне одного запроса. Можно выбрать способ создания исходного объекта путем обработки события ObjectCreating элемента управления ObjectDataSource. Можно создать экземпляр объекта источника и задайте для свойства ObjectInstance класса ObjectDataSourceEventArgs к этому экземпляру. Элемент управления ObjectDataSource будет использовать экземпляр, созданные в событии ObjectCreating вместо того чтобы создавать свой собственный экземпляр.

Если исходный объект для элемента управления ObjectDataSource предоставляет открытые статические методы (Shared в Visual Basic), которые могут быть вызваны для извлечения и изменения данных, элемент управления ObjectDataSource будет вызывать эти методы напрямую. Если элемент управления ObjectDataSource необходимо создать экземпляр исходного объекта для вызова метода, объект должен включать открытый конструктор, который не принимает никаких параметров. Элемент управления ObjectDataSource будет вызвать этот конструктор, когда он создает новый экземпляр объекта источника.

Если исходный объект не содержит открытый конструктор без параметров, можно создать экземпляр исходного объекта, который будет использоваться элементом управления ObjectDataSource в событии ObjectCreating.

## <a name="specifying-object-methods"></a>Задание методов объекта

Исходный объект для элемента управления ObjectDataSource может содержать любое число методов, используемых для выбора, вставки, обновления или удаления данных. Эти методы вызываются с помощью элемента управления ObjectDataSource на основе имени метода, определяемого с помощью элемента управления ObjectDataSource свойство SelectMethod, InsertMethod, UpdateMethod и DeleteMethod. Исходный объект также может включать необязательный SelectCount метод, который определяется с помощью элемента управления ObjectDataSource, используя свойство SelectCountMethod, которое возвращает количество общее число объектов в источнике данных. Элемент управления ObjectDataSource вызовет метод SelectCount после вызова метода Select для получения общее число записей в источнике данных для использования при разбиении на страницы.

## <a name="lab-using-data-source-controls"></a>Лаборатории с использованием элементов управления источниками данных

## <a name="exercise-1---displaying-data-with-the-sqldatasource-control"></a>Упражнение 1. Отображение данных с помощью элемента управления SqlDataSource

Следующее упражнение использует элемент управления SqlDataSource для подключения к базе данных Northwind. Предполагается, что имеется доступ к базе данных "Борей" в экземпляре SQL Server 2000.

1. Создайте новый веб-узел ASP.NET.
2. Добавьте новый файл web.config.

    1. Правой кнопкой мыши проект в обозревателе решений и выберите команду Добавить новый элемент.
    2. Выберите файл веб-конфигурации из списка шаблонов и нажмите кнопку Добавить.
3. Изменить &lt;connectionStrings&gt; следующим образом: 

    [!code-aspx[Main](data-source-controls/samples/sample6.aspx)]
4. Переключитесь в представление кода и добавьте атрибут ConnectionString и SelectCommand атрибут для &lt;asp: SqlDataSource&gt; управления следующим образом: 

    [!code-aspx[Main](data-source-controls/samples/sample7.aspx)]
5. В режиме конструктора добавьте новый элемент управления GridView.
6. Из раскрывающегося списка выберите источник данных, в меню Задачи GridView выберите SqlDataSource1.
7. Щелкните правой кнопкой мыши файл Default.aspx и выберите представление в браузере, в меню. Нажмите кнопку "Да", при запросе на сохранение.
8. GridView отображает данные из таблицы Products.

## <a name="exercise-2---editing-data-with-the-sqldatasource-control"></a>Упражнение 2 - изменение данных с помощью элемента управления SqlDataSource

Следующее упражнение демонстрирует для связывания данных DropDownList управлять с помощью декларативного синтаксиса и позволяет изменять данные, представленные в DropDownList.

1. В режиме конструктора удалите элемент управления GridView из Default.aspx. 

    **Важные**: пропустить этот элемент управления SqlDataSource на странице.
2. Добавьте элемент управления DropDownList Default.aspx.
3. Переключитесь в режим конструктора.
4. Добавьте атрибут DataSourceId DataTextField и DataValueField используются, чтобы &lt;asp: DropDownList&gt; управления следующим образом: 

    [!code-aspx[Main](data-source-controls/samples/sample8.aspx)]
5. Сохраните файл Default.aspx и откройте его в браузере. Обратите внимание, что DropDownList содержит все продукты из базы данных Northwind.
6. Закройте браузер.
7. В представлении источника Default.aspx добавьте новый элемент управления TextBox под элементом управления DropDownList. Измените свойство идентификатора текстового поля на txtProductName.
8. В разделе управления TextBox добавьте новый элемент управления Button. Измените свойство ID кнопки btnUpdate и значение свойства Text на **обновление название продукта**.
9. В представлении источника Default.aspx добавьте свойство UpdateCommand и два новых UpdateParameters SqlDataSource тег следующим образом: 

    [!code-aspx[Main](data-source-controls/samples/sample9.aspx)]

    > [!NOTE]
    > Обратите внимание, что два обновления параметры (ProductName и ProductID), добавленные в этот код. Эти параметры сопоставляются с свойство Text txtProductName текстовое поле и свойство SelectedValue ddlProducts DropDownList.
10. Переключитесь в конструктор и дважды щелкните элемент управления Button, чтобы добавить обработчик событий.
11. Добавьте следующий код btnUpdate\_щелкните кода: 

    [!code-csharp[Main](data-source-controls/samples/sample10.cs)]
12. Щелкните правой кнопкой мыши файл Default.aspx и выберите для просмотра в браузере. Когда будет предложено сохранить все изменения, нажмите кнопку "Да".
13. ASP.NET 2.0 разрешить разделяемых классов для компиляции во время выполнения. Создать приложение, чтобы вступили в силу изменения кода необязательно.
14. Выберите продукт в элементе управления DropDownList.
15. Введите новое имя для выбранного продукта в текстовом поле и нажмите кнопку обновления.
16. Имя продукта будет обновлено в базе данных.

## <a name="exercise-3-using-the-objectdatasource-control"></a>Упражнение 3, с помощью элемента управления ObjectDataSource

В этом упражнении будет показано использование элемента управления ObjectDataSource и исходный объект для взаимодействия с базой данных "Борей".

1. Правой кнопкой мыши проект в обозревателе решений и выберите команду Добавить новый элемент.
2. В списке шаблонов выберите веб-форма. Измените имя на object.aspx и нажмите кнопку Добавить.
3. Правой кнопкой мыши проект в обозревателе решений и выберите команду Добавить новый элемент.
4. В списке шаблонов выберите класс. Измените имя класса NorthwindData.cs и нажмите кнопку Добавить.
5. Нажмите "Да" при появлении запроса добавьте в класс приложения\_папки с кодом.
6. Добавьте следующий код в файл NorthwindData.cs: 

    [!code-csharp[Main](data-source-controls/samples/sample11.cs)]
7. Добавьте следующий код к представлению источника object.aspx: 

    [!code-aspx[Main](data-source-controls/samples/sample12.aspx)]
8. Сохранить все файлы и обзор object.aspx.
9. Взаимодействовать с интерфейсом, просмотрев сведения, редактирование сотрудников, добавление сотрудников и удаление сотрудников.
