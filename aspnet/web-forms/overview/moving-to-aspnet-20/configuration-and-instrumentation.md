---
uid: web-forms/overview/moving-to-aspnet-20/configuration-and-instrumentation
title: "Конфигурации и инструментирования | Документы Microsoft"
author: microsoft
description: "Существуют значительные изменения в конфигурации и инструментирования в ASP.NET 2.0. ASP.NET configuration API позволяет сделать pr изменения конфигурации..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2005
ms.topic: article
ms.assetid: 21ebbaee-7ed8-45ae-b6c1-c27c88342e48
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/configuration-and-instrumentation
msc.type: authoredcontent
ms.openlocfilehash: 16dfe3c899dfa028d8a52b4b5f9c2868887e8fa9
ms.sourcegitcommit: a510f38930abc84c4b302029d019a34dfe76823b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/30/2018
---
<a name="configuration-and-instrumentation"></a>Конфигурации и инструментирования
====================
по [Microsoft](https://github.com/microsoft)

> Существуют значительные изменения в конфигурации и инструментирования в ASP.NET 2.0. Новый API конфигурации ASP.NET позволяет программным путем вносить изменения конфигурации. Кроме того, существует множество новые параметры конфигурации позволяют новые конфигурации и инструментария.


Существуют значительные изменения в конфигурации и инструментирования в ASP.NET 2.0. Новый API конфигурации ASP.NET позволяет программным путем вносить изменения конфигурации. Кроме того, существует множество новые параметры конфигурации позволяют новые конфигурации и инструментария.

В этом модуле мы обсудим ASP.NET configuration API относительно чтение и запись в файлы конфигурации ASP.NET, а также рассмотрены инструментария ASP.NET. Также мы расскажем о новых возможностях в трассировке ASP.NET.

## <a name="aspnet-configuration-api"></a>API конфигурации ASP.NET

API конфигурации ASP.NET позволяет разработки, развертывания и управления данными конфигурации приложения с помощью единого интерфейса программирования. API конфигурации можно использовать для разработки и изменения всей конфигурации ASP.NET программными средствами без непосредственного редактирования XML-данные в файлах конфигурации. Кроме того можно использовать API-Интерфейс настройки в консольных приложениях и скриптах, разрабатываемых, веб средства управления и оснастки консоли управления (MMC).

Следующие два средства управления конфигурацией использовать API-Интерфейс настройки и входят в состав .NET Framework версии 2.0.

- Оснастку консоли MMC ASP.NET, которая использует API-Интерфейс настройки для упрощения выполнения задач администрирования, обеспечивая интегрированное представление локальных данных со всех уровней иерархии конфигурации.
- Средство администрирования веб-сайта, который позволяет управлять параметрами конфигурации для локальных и удаленных приложений, включая размещенные узлы.

API конфигурации ASP.NET состоит из набора объектов управления ASP.NET, которые можно использовать для программной настройки веб-сайтов и приложений. Объекты управления реализуются как библиотеки классов .NET Framework. Модель программирования API конфигурации гарантирует согласованность и надежность кода с помощью типов данных во время компиляции. Чтобы упростить управление конфигурацией приложения API конфигурации дает возможность просмотра данных, который создается объединением всех точек в иерархии конфигурации виде единой коллекции, вместо Просмотр данных в виде отдельных коллекций из различных файлы конфигурации. Кроме того API-Интерфейс настройки позволяет манипулировать всей конфигурацией приложения без непосредственного редактирования XML-данные в файлах конфигурации. Наконец API-Интерфейс упрощает задачи настройки, поддержке административных средств, таких как средство администрирования веб-сайта. API-Интерфейс настройки упрощает разработку за счет поддержки создания конфигурационных файлов на компьютере и выполнения сценариев настройки на нескольких компьютерах.

> [!NOTE]
> Конфигурация API не поддерживает создание приложений IIS.


## <a name="working-with-local-and-remote-configuration-settings"></a>Работа с параметрами локальной и удаленной конфигурации

Объект конфигурации представляет объединенное представление параметров конфигурации, применяемых к определенной физической сущности, например компьютер, или логической сущности, например, приложение или веб-сайта. Указанная логическая сущность может существовать на локальном компьютере или на удаленном сервере. Если файл конфигурации не существует для указанной сущности, объект конфигурации представляет параметры конфигурации по умолчанию, в соответствии с определением в файле Machine.config.

Объект конфигурации можно получить с помощью одного из открытых методов конфигурации от следующих классов:

1. Класс ConfigurationManager, если сущностью является клиентское приложение.
2. Класс WebConfigurationManager, если сущностью является веб-приложения.

Эти методы возвращают объект конфигурации, который в свою очередь, предоставляет требуемые методы и свойства для обработки базовых файлов конфигурации. Можно получить доступ к этим файлам для чтения или записи.

### <a name="reading"></a>Чтение

Используйте метод GetSection или GetSectionGroup для считывания данных конфигурации. Пользователь или процесс, который считывает должна разрешения на чтение всех файлов конфигурации в иерархии.

> [!NOTE]
> При использовании статического GetSection метода, принимающего параметр пути, параметр path должен ссылаться на приложение, в котором код. В противном случае этот параметр игнорируется и возвращается информация о конфигурации для текущего выполняемого приложения.


### <a name="writing"></a>Запись

Используйте один из способов сохранения для записи сведений о конфигурации. Пользователь или процесс, который записывает должен иметь разрешения на файл конфигурации и каталог на текущем уровне иерархии конфигурации запись, а также разрешения на чтение всех файлов конфигурации в иерархии.

Для создания файла конфигурации, который представляет унаследованные параметры конфигурации для указанной сущности, используйте один из следующих методов сохранения конфигурации:

1. Метод Save, чтобы создать новый файл конфигурации.
2. Метод SaveAs для создания нового файла конфигурации в другом месте.

## <a name="configuration-classes-and-namespaces"></a>Классы конфигурации и пространства имен

Многие классы и методы конфигурации похожи друг с другом. Ниже перечислены наиболее часто используемые конфигурации классов и пространств имен.

| **Класс конфигурации или пространство имен** | **Описание** |
| --- | --- |
| [System.Configuration](https://msdn.microsoft.com/library/system.configuration.aspx) namespace | Содержит классы основной конфигурации для всех приложений .NET Framework. Для получения данных конфигурации для раздела с методами, такими как GetSection и GetSectionGroup используются классы обработки. Эти два метода не являются статическими. |
| Класс System.Configuration.Configuration | Представляет набор данных конфигурации для компьютера, приложения, веб-каталога или другого ресурса. Этот класс содержит методы, такие как GetSection и GetSectionGroup, для обновления параметров конфигурации и получения ссылок на разделы и группы разделов. Этот класс используется в качестве возвращаемого типа для методов получения данных конфигурации во время разработки, например методы классов WebConfigurationManager и ConfigurationManager. |
| Пространство имен System.Web.Configuration | Содержит классы обработки разделов конфигурации ASP.NET, определенных в [параметры конфигурации ASP.NET](https://msdn.microsoft.com/library/b5ysx397.aspx). Для получения данных конфигурации для раздела с методами, такими как GetSection и GetSectionGroup используются классы обработки. |
| Класс System.Web.Configuration.WebConfigurationManager | Предоставляет методы для получения ссылок на параметры конфигурации времени выполнения и во время разработки. Эти методы System.Configuration.Configuration класс как тип возвращаемого значения. Статический метод GetSection этого класса или метода GetSection нестатических System.Configuration.ConfigurationManager класса можно использовать попеременно. Для конфигураций веб-приложений рекомендуется использовать класс System.Web.Configuration.WebConfigurationManager вместо System.Configuration.ConfigurationManager класса. |
| [System.Configuration.Provider](https://msdn.microsoft.com/library/system.configuration.provider.aspx) namespace | Предоставляет способ для настройки и расширения поставщика конфигурации. Это базовый класс для всех классов поставщиков в системе конфигурации. |
| [System.Web.Management](https://msdn.microsoft.com/library/system.web.management.aspx) пространства имен | Содержит классы и интерфейсы для управления и наблюдения за исправностью веб-приложений. Строго говоря это пространство имен не является частью конфигурации API. Например трассировки и события достигается классы в этом пространстве имен. |
| [System.Management.Instrumentation](https://msdn.microsoft.com/library/system.management.instrumentation.aspx) пространства имен | Предоставляет классы, необходимые для инструментирования приложений для предоставления информации и событий потенциальным потребителям через инструментарий управления Windows (WMI). Наблюдение за работоспособностью ASP.NET использует WMI для доставки событий. Строго говоря это пространство имен не является частью конфигурации API. |

## <a name="reading-from-aspnet-configuration-files"></a>Чтение из файлов конфигурации ASP.NET

Класс WebConfigurationManager является основным классом для чтения данных из файлов конфигурации ASP.NET. Существует по существу три шага для чтения файлов конфигурации ASP.NET.

1. Получите объект конфигурации, с помощью метода OpenWebConfiguration.
2. Получите ссылку на нужный раздел в файле конфигурации.
3. Считать нужные сведения из файла конфигурации.

Конфигурации, который представляет объект не представляет определенного файла конфигурации. Вместо этого он представляет объединенное представление о конфигурации компьютера, приложения или веб-сайта. В следующем образце кода создается объект конфигурации, представляющий конфигурацию веб-приложения вызывается *ProductInfo*.

[!code-csharp[Main](configuration-and-instrumentation/samples/sample1.cs)]

> [!NOTE]
> Обратите внимание, что если /ProductInfo путь не существует, приведенный выше код возвращает конфигурацию по умолчанию, как указано в файле machine.config.


Получив объект конфигурации, можно затем использовать метод GetSection или GetSectionGroup для детализации в параметрах конфигурации. Следующий пример возвращает ссылку на параметры олицетворения для приложения выше ProductInfo:

[!code-csharp[Main](configuration-and-instrumentation/samples/sample2.cs)]

## <a name="writing-to-aspnet-configuration-files"></a>Запись в файлы конфигурации ASP.NET

Как и чтение из файлов конфигурации класс WebConfigurationManager — ядро для записи файлов конфигурации Asp.NET. Существует три способа для записи в файлах конфигурации ASP.NET.

1. Получите объект конфигурации, с помощью метода OpenWebConfiguration.
2. Получите ссылку на нужный раздел в файле конфигурации.
3. Запись нужные сведения из файла конфигурации, с помощью «сохранить» или «сохранить как метод.

В следующем примере кода изменения **отладки** атрибут &lt;компиляции&gt; элемента значение false:

[!code-csharp[Main](configuration-and-instrumentation/samples/sample3.cs)]

При выполнении этого кода **отладки** атрибут &lt;компиляции&gt; элемент будет иметь значение false для *веб-приложение* в файле web.config.

## <a name="systemwebmanagement-namespace"></a>Пространство имен System.Web.Management

Пространство имен System.Web.Management предоставляет классы и интерфейсы для управления и наблюдения за работоспособностью приложений ASP.NET.

Ведение журнала выполняется с помощью определения правила, которое связывает события с помощью поставщика. Правило определяет тип события, отправляемые поставщику. Для входа доступны следующие базовые события:

| **WebBaseEvent** | Класс базовым для всех событий. Содержит необходимые свойства для всех событий, таких как код события, подробный код события, дату и время, когда возникло событие, порядковый номер, сообщение об ошибке и сведения о событии. |
| --- | --- |
| **WebManagementEvent** | Класс базового события для управления событиями, например время существования приложения, запрос, ошибки и события аудита. |
| **WebHeartbeatEvent** | События, создаваемые приложением через равные промежутки времени для сбора данных о состоянии полезные среды выполнения. |
| **WebAuditEvent** | Базовый класс для событий аудита безопасности, которые используются для пометки условия, например, сбой авторизации Ошибка расшифровки *и т. д.* |
| **WebRequestEvent** | Базовый класс для всех событий информационное запроса. |
| **WebBaseErrorEvent** | Базовый класс для всех событий, указывающих условия ошибки. |

Типы поставщиков, доступных разрешение на отправку выходных данных событий в средстве просмотра событий, SQL Server, инструментария управления Windows (WMI) и электронной почты. Предварительно настроенные поставщики и сопоставления событий уменьшить объем работ, необходимых для получения выходных данных событий в журнал.

ASP.NET 2.0 использует журнал событий поставщика out-of--box в журнал событий по доменов приложений, запуск и остановка, а также ведение журнала все необработанные исключения. Это помогает рассмотрены некоторые из основных сценариев. Например предположим, что приложение вызывает исключение, но пользователь не сохраняет ошибку и не удается воспроизвести ее. Правило по умолчанию журнал событий будет иметь возможность собирать информацию исключения и стек, чтобы понять, какие ошибки произошла. Еще один пример применяется, если приложение теряет состояние сеанса. В этом случае можно найти в журнале событий для определения перезапуска домена приложения, и почему домен приложения в первую очередь остановлена.

Кроме того система мониторинга состояния является расширяемым. Например можно определить пользовательские веб-события, их запуска в приложении и затем определите правила для отправки сведений о событии для поставщика, например ваш адрес электронной почты. Это позволяет легко привязать к инструментирования поставщики мониторинга работоспособности. Например может инициировать событие каждый раз, порядок обработки и настроить правило, которое отправляет каждое событие в базу данных SQL Server. Может также инициировать событие при пользователю не удается выполнить вход несколько раз подряд, а также настроить события, чтобы использовать поставщики на основе электронной почты.

В файле Web.config глобального хранится конфигурация для поставщиков по умолчанию и событий. Глобальный файл Web.config хранит все веб-параметры, сохраненные в файле Machine.config в ASP.NET 1 x. Глобальный файл Web.config находится в следующем каталоге:

`%windir%\Microsoft.Net\Framework\v2.0.*\config\Web.config`

&lt;HealthMonitoring&gt; раздел глобальный файл Web.config содержит по умолчанию параметры конфигурации. Можно переопределить эти параметры или настроить собственные параметры, реализовав &lt;healthMonitoring&gt; раздела в файле Web.config для приложения.

&lt;HealthMonitoring&gt; раздел глобальный файл Web.config содержит следующие элементы:

| **providers** | Содержит поставщики для просмотра событий, WMI и SQL Server. |
| --- | --- |
| **eventMappings** | Содержит сопоставления для различных классов WebBase. Этот список можно расширить, если создать свой собственный класс событий. Создание собственного класса событий дает большая степень детализации через поставщиков, которые отправляют сведения на. Например можно настроить необработанные исключения, отправляемых в SQL Server при отправке пользовательские события, к электронной почте. |
| **правила** | Связывает eventMappings поставщика. |
| **buffering** | Используется с поставщиками SQL Server и электронной почты для определения часто записи на диск для поставщика событий. |

Ниже приведен пример кода из глобального файла Web.config.

[!code-xml[Main](configuration-and-instrumentation/samples/sample4.xml)]

## <a name="how-to-store-events-to-event-viewer"></a>Сохранение событий в средство просмотра событий

Как упоминалось ранее, для ведения журнала событий поставщик событий средства просмотра будет настроена для глобального файла Web.config. По умолчанию на основе всех событий **WebBaseErrorEvent** и **WebFailureAuditEvent** регистрируются. Можно добавить дополнительные правила для регистрации дополнительных сведений в журнал событий. Например, если требуется записывать все события (*т. е.*, на основе каждого события **WebBaseEvent**), можно добавить в файл Web.config следующее правило:

[!code-xml[Main](configuration-and-instrumentation/samples/sample5.xml)]

Это правило будет связывать **все события** схема событий в регистратор событий. EventMapping и поставщика, включаются в глобальный файл Web.config.

## <a name="how-to-store-events-to-sql-server"></a>Сохранение событий в SQL Server

Этот метод использует **ASPNETDB** базы данных, созданный служебной программой Aspnet\_regsql.exe средства. Поставщик по умолчанию использует LocalSqlServer строка соединения, которая использует либо на основе файла базы данных в приложении\_данных папку или локальный экземпляр SQLExpress SQL Server. Строка подключения LocalSqlServer и SqlProvider настраиваются в глобальный файл Web.config.

LocalSqlServer строку подключения в файле Web.config глобального выглядит следующим образом:

[!code-xml[Main](configuration-and-instrumentation/samples/sample6.xml)]

Если вы хотите использовать другой экземпляр SQL Server, необходимо использовать Aspnet\_regsql.exe средства, которое можно найти в % windir%\Microsoft.Net\Framework\v2.0.\* папки. Используйте Aspnet\_regsql.exe средства для создания пользовательского **ASPNETDB** базы данных на экземпляре SQL Server, а затем добавьте строку подключения в файл конфигурации приложения и добавьте поставщика с помощью нового Строка подключения. После получения **ASPNETDB** базы данных создана, необходимо задать правило для связывания eventMapping sqlProvider.

Используйте значение по умолчанию SqlProvider или настроить собственный поставщик, необходимо добавить правило, поставщик с картой событий связывания. Следующее правило связывает новый поставщик, созданный выше **все события** схема событий. Это правило будет записывать все события, на основе **WebBaseEvent** и отправить их MySqlWebEventProvider, который будет использовать строку подключения MYASPNETDB. Следующий код добавляет правило для связывания поставщика с картой событий:

[!code-xml[Main](configuration-and-instrumentation/samples/sample7.xml)]

Если требуется только отправлять ошибки в SQL Server, можно добавить следующее правило:

[!code-xml[Main](configuration-and-instrumentation/samples/sample8.xml)]

## <a name="how-to-forward-events-to-wmi"></a>Как перенаправить события WMI

Можно также переслать события инструментария WMI. Поставщик WMI является настроена для глобального файла Web.config по умолчанию.

В следующем примере кода добавляется правило для пересылки событий WMI:

[!code-xml[Main](configuration-and-instrumentation/samples/sample9.xml)]

Необходимо будет добавить правило, чтобы связать eventMapping поставщика и прослушиватель WMI для прослушивания событий. Следующий пример кода добавляет правило для связывания поставщика WMI для **все события** схема событий:

[!code-xml[Main](configuration-and-instrumentation/samples/sample10.xml)]

## <a name="how-to-forward-events-to-email"></a>Как нужно перенаправить события электронной почты

Можно также переслать события к электронной почте. Следует с осторожностью какие правила событий, можно сопоставить с вашего поставщика услуг электронной почты, можно непреднамеренно отправлять самостоятельно большой объем данных, возможно, лучше всего подходят для SQL Server и журнал событий. Существует два электронной почты; SimpleMailWebEventProvider и TemplatedMailWebEventProvider. Каждый имеет те же атрибуты конфигурации, за исключением атрибутов «шаблон» и «detailedTemplateErrors», которые доступны только на TemplatedMailWebEventProvider.

> [!NOTE]
> Ни один из этих поставщиков электронной почты настраивается автоматически. Необходимо добавить их в файл Web.config.


Основное различие между поставщиками этих двух электронной почты — что SimpleMailWebEventProvider отправляет сообщения электронной почты в универсального шаблона, который не может быть изменен. Пример файла Web.config добавляет этого поставщика услуг электронной почты в список настроенных поставщиков, используя следующее правило:

[!code-xml[Main](configuration-and-instrumentation/samples/sample11.xml)]

Для поставщика услуг электронной почты для перегрузки также добавляется следующее правило **все события** схема событий:

[!code-xml[Main](configuration-and-instrumentation/samples/sample12.xml)]

## <a name="aspnet-20-tracing"></a>ASP.NET 2.0 трассировки

Существуют три основные усовершенствования трассировки в ASP.NET 2.0.

1. Функции интегрированной трассировки.
2. Программный доступ к сообщениям трассировки.
3. Улучшенная трассировка на уровне приложения

## <a name="integrated-tracing-functionality"></a>Функции интегрированной трассировки.

Теперь можно направить сообщения класса System.Diagnostics.Trace для ASP.NET, выходные данные трассировки и маршрутизации сообщений трассировки ASP.NET для System.Diagnostics.Trace. Можно также переслать события инструментария ASP.NET для System.Diagnostics.Trace. Эта функциональность обеспечивается благодаря новой **writeToDiagnosticsTrace** атрибут &lt;трассировки&gt; элемента. При этом логическое значение равно true, инфраструктура трассировки System.Diagnostics для использования, перенаправляются сообщения трассировки ASP.NET прослушивателями, которые зарегистрированы для отображения сообщений трассировки.

## <a name="programmatic-access-to-trace-messages"></a>Программный доступ к сообщения трассировки

ASP.NET 2.0 обеспечивает программный доступ для всех сообщений трассировки через **TraceContextRecord** класса и **TraceRecords** коллекции. Наиболее эффективный способ доступа к сообщения трассировки является регистрация **TraceContextEventHandler** делегата (также новые возможности ASP.NET 2.0) для обработки нового **TraceFinished** событий. Затем можно перебрать сообщения трассировки по своему усмотрению.

Это показано в следующем образце кода:

[!code-csharp[Main](configuration-and-instrumentation/samples/sample13.cs)]

В приведенном выше примере я перебор коллекции TraceRecords, а затем написать каждого сообщения в поток ответа.

## <a name="improved-application-level-tracing"></a>Улучшенная трассировка на уровне приложения

Улучшена трассировка на уровне приложения через введение нового **mostRecent** атрибут &lt;трассировки&gt; элемента. Этот атрибут указывает ли отображаются последние данные трассировки на уровне приложения, и их количество превышает порог, заданный параметром requestLimit старые данные отбрасываются. Если значение равно false, данные трассировки отображаются для запросов до достижения requestLimit атрибута.

## <a name="aspnet-command-line-tools"></a>Средства командной строки для ASP.NET

Существует несколько средств командной строки для упрощения конфигурации ASP.NET. Разработчики ASP.NET должны быть знакомы с aspnet\_regiis.exe средства. ASP.NET 2.0 предоставляет три средств, помогающих в конфигурации.

Доступны следующие средства командной строки:

| **Tool** | **Use** |
| --- | --- |
| **aspnet\_regiis.exe** | Позволяет регистрация ASP.NET в IIS. Существует две версии этого средства, которые поставляются с ASP.NET 2.0: для 32-разрядных систем (в папке Framework) и для 64-разрядных систем (в папке Framework64.) 64-разрядная версия не будет устанавливаться на 32-разрядной операционной системе. |
| **aspnet\_regsql.exe** | Средство регистрации ASP.NET SQL Server используется для создания базы данных Microsoft SQL Server для использования с поставщиками SQL Server в ASP.NET, добавить или удалить параметры из существующей базы данных. Aspnet\_regsql.exe файл расположен в папке «[drive:]\WINDOWS\Microsoft.NET\Framework\versionNumber» на веб-сервере. |
| **aspnet\_regbrowsers.exe** | Средство регистрации браузера ASP.NET выполняет синтаксический анализ и компилирует все определения системных браузеров в сборку и устанавливает сборку в глобальный кэш сборок. Средство использует файлы определений браузера (. Файлы ОБОЗРЕВАТЕЛЯ) из подкаталога браузеры .NET Framework. Это средство можно найти в каталоге %SystemRoot%\Microsoft.NET\Framework\version\. |
| **aspnet\_compiler.exe** | Средство компиляции ASP.NET позволяет компилировать веб-приложения ASP.NET, на месте или для развертывания в целевом расположении, например на рабочем сервере. Компиляция на месте повышает производительность приложения, поскольку конечные пользователи не возникает задержка при первом запросе к приложению во время компиляции приложения. |

Поскольку aspnet\_regiis.exe средство не является новым для ASP.NET 2.0, не обсуждаются его здесь.

## <a name="aspnet-sql-server-registration-tool---aspnetregsqlexe"></a>Средство регистрации сервера ASP.NET SQL - aspnet\_regsql.exe

Можно задать несколько типов параметров, с помощью средства регистрации ASP.NET SQL Server. Можно указать SQL-соединение, указать, какие службы приложений ASP.NET использовать SQL Server для управления информацией, указать, какие таблицы или базы данных используется для зависимости кэша SQL и добавить или удалить поддержку использования SQL Server для хранения процедур и состояния сеанса.

Несколько служб приложений ASP.NET поставщик отвечает за управление хранения и извлечения данных из источника данных. Каждый поставщик относится только к источнику данных. ASP.NET содержит поставщик SQL Server со следующими функциями ASP.NET:

- Членство ( [SqlMembershipProvider](https://msdn.microsoft.com/library/system.web.security.sqlmembershipprovider.aspx) класса).
- Управление ролями ( [SqlRoleProvider](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx) класса).
- Профиль ( [SqlProfileProvider](https://msdn.microsoft.com/library/system.web.profile.sqlprofileprovider.aspx) класса).
- Персонализация веб-частей ( [SqlPersonalizationProvider](https://msdn.microsoft.com/library/system.web.ui.webcontrols.webparts.sqlpersonalizationprovider.aspx) класса).
- Веб-событий ( [SqlWebEventProvider](https://msdn.microsoft.com/library/system.web.management.sqlwebeventprovider.aspx) класса).

При установке ASP.NET файл Machine.config для сервера включает элементы конфигурации, определяющие поставщиков SQL Server для каждой из функций ASP.NET, которые зависят от поставщика. Эти поставщики настроены по умолчанию для подключения к экземпляру SQL Server Express 2005 локального пользователя. Если изменить строку подключения по умолчанию, используемую поставщиками, затем перед использованием функциями ASP.NET, настроенными в конфигурации компьютера, необходимо установить базу данных SQL Server и элементы базы данных для выбранного компонента с помощью Aspnet\_regsql.exe. Если базы данных, укажите с помощью средства регистрации SQL еще не существует (aspnetdb будет базы данных по умолчанию, если конфигурация не указана в командной строке), то текущий пользователь должен иметь права на создание баз данных в SQL Server и на создание схемы элементам в базе данных.

### <a name="sql-cache-dependency"></a>Зависимость кэша SQL

Дополнительной возможностью кэширования выходных данных ASP.NET является зависимость кэша SQL. Зависимости кэша SQL поддерживает два разных режима работы: использующая реализацию ASP.NET опроса таблицы, а второй режим, который использует функции уведомления о запросах SQL Server 2005. Средство регистрации SQL можно использовать для настройки режима опроса таблиц операции.

### <a name="session-state"></a>Состояние сеанса

По умолчанию значения состояния сеанса и сведения хранятся в памяти в процессе ASP.NET. Кроме того можно хранить данные сеанса в базе данных SQL Server, где его могут совместно использоваться несколькими веб-серверами. Если базы данных, задать для состояния сеанса с помощью средства регистрации SQL еще не существует, то текущий пользователь должны иметь права на создание баз данных в SQL Server, а также создание элементов схемы в базе данных. Если база данных существует, текущий пользователь должен иметь права на создание элементов схемы в существующей базе данных.

Для установки базы данных состояния сеанса на сервере SQL Server, запустите Aspnet\_regsql.exe средства и укажите следующие сведения с помощью команды:

- Имя SQL Server экземпляра с помощью **-S** параметр.
- Учетные данные входа для учетной записи, имеющей разрешение на создание базы данных на сервере SQL Server. Используйте **-E** используется имя текущего пользователя или воспользоваться **- U** параметр, чтобы указать идентификатор пользователя вместе с **-P** параметр, чтобы указать пароль.
- **- Ssadd** параметр командной строки для добавления базы данных состояния сеанса.

По умолчанию нельзя использовать Aspnet\_regsql.exe средство для установки базы данных состояния сеанса на компьютере под управлением SQL Server 2005 Express Edition.

### <a name="the-aspnet-browser-registration-tool---aspnetregbrowsersexe"></a>Средство регистрации браузера ASP.NET - aspnet\_regbrowsers.exe

В ASP.NET версии 1.1, файл Machine.config содержится раздел под названием &lt;browserCaps&gt;. В этом разделе содержится ряд записей XML, определенные настройки для различных браузеров, на основе регулярного выражения. Для ASP.NET версии 2.0 новый. Файл БРАУЗЕРА определяет параметры конкретного браузера с помощью записи XML. Добавьте сведения о новом окне обозревателя путем добавления нового. БРАУЗЕР файл в папку %SystemRoot%\Microsoft.NET\Framework\version\CONFIG\Browsers в системе.

Так как приложение не считывает файл .config каждый раз, ему требуется информация обозревателя, можно создать новый. Файл БРАУЗЕРА и выполнения Aspnet\_regbrowsers.exe для добавления необходимых изменений в сборку. Это позволяет серверу мгновенно получить доступ к новым данным обозревателя, необходимо завершить работу каких-либо приложений для получения сведений. Приложение может получить доступ к возможности браузера через свойство браузера текущего HttpRequest.

Следующие параметры доступны при выполнении aspnet\_regbrowser.exe:

| **Параметр** | **Описание** |
| --- | --- |
| **-?** | Отображает Aspnet\_regbbrowsers.exe текст справки в окне команд. |
| **-i** | Создает сборку возможностей браузера времени выполнения и устанавливает ее в глобальный кэш сборок. |
| **-u** | Удаляет сборку возможностей браузера времени выполнения из глобального кэша сборок. |

## <a name="the-aspnet-compilation-tool---aspnetcompilerexe"></a>Средство компиляции ASP.NET - aspnet\_compiler.exe

Средство компиляции ASP.NET можно использовать двумя способами: для компиляции на месте и компиляции для развертывания, где указан целевой выходной каталог.

### <a name="compiling-an-application-in-placehttpsmsdnmicrosoftcomlibraryms229863aspx"></a>[Компиляция приложения на месте](https://msdn.microsoft.com/library/ms229863.aspx)

Средство компиляции ASP.NET можно компилировать приложение на месте, то есть он имитирует поведение выполнения нескольких запросов к приложению, тем самым вызывая обычной компиляции. Пользователи предварительно скомпилированного сайта не возникнут задержки, вызванные компиляции страницы при первом запросе.

При предварительной компиляции узла на месте, применяются следующие элементы:

- Узел сохраняет свою структуру каталогов и файлов.
- Необходимо наличие компиляторов для всех языков программирования, используемых сайтом на сервере.
- Если происходит сбой компиляции любого файла, компиляция завершается всего сайта.

Также можно перекомпилировать приложение на месте после добавления к нему новых исходных файлов. Программа компилирует только новые или измененные файлы, если они не включены **- c** параметр.

> [!NOTE]
> Компиляция приложения, содержащего вложенные приложение не компилирует вложенного приложения. Необходимо скомпилировать вложенного приложения отдельно.


### <a name="compiling-an-application-for-deploymenthttpsmsdnmicrosoftcomlibraryms229863aspx"></a>[Компиляция приложения для развертывания](https://msdn.microsoft.com/library/ms229863.aspx)

Скомпилируйте приложение для развертывания (компиляция в целевое расположение), указав параметр targetDir. TargetDir может быть конечное расположение для веб-приложения или скомпилированное приложение может быть развернуто Далее. С помощью **-u** компилирует приложение таким образом, можно внести изменения в файлы, определенные в скомпилированном приложении без повторной компиляции. ASPNET\_compiler.exe различает статические и динамические типы файлов и обрабатывает их по-разному при создании результирующего приложения.

- Статические типы файлов — это те, которые не имеют связанного компилятора или поставщика компоновки, таких как файлы, именованный имеют расширения, такие как CSS-файлах, .gif, .htm, .html, .jpg, .js и т. д. Эти файлы просто копируются в целевое расположение, с сохранением относительных положений в структуре каталогов.
- Динамические типы файлов, которые имеют связанный компилятор или поставщик компоновки, включая файлы с расширениями имен файлов только для ASP.NET, например .asax, .ascx, .ashx, .aspx, с расширением BROWSER, master и т. д. Средство компиляции ASP.NET создает сборки на основе этих файлов. Если **-u** параметр опущен, программа также создает файлы с расширением имени файла. COMPILED, сопоставить исходные файлы для своей сборки. Чтобы убедиться, что структура каталогов источника приложения сохраняется, это средство создает файлы заполнитель в соответствующих расположениях в целевом приложении.

Необходимо использовать **-u** параметр, чтобы указать, что содержимое скомпилированное приложение может быть изменено. В противном случае последующие изменения игнорируются или вызвать ошибки во время выполнения.

В следующей таблице описаны как компиляции ASP.NET средство обрабатывает различные типы файлов при **-u** параметр включен.

| **Тип файла** | **Действие компилятора** |
| --- | --- |
| .ascx, .aspx, .master | Эти файлы разделяются на разметку и исходный код, который включает файлы кода и любой код, заключенный в &lt;скрипт runat = «server»&gt; элементов. Исходный код компилируется в сборки, имена которых получены с помощью алгоритма хэширования и сборки размещаются в каталоге Bin. Любой встроенный код, заключенный кода  **&lt; %**  и  **% &gt;**  квадратных скобок, относится к разметке и не компилируется. Новые файлы с тем же именем, что и исходные файлы создаются для содержания разметки и помещаются в соответствующие выходные каталоги. |
| .ashx, .asmx | Эти файлы не компилируются и перемещаются в выходные каталоги и не компилируется. Если вы хотите иметь компилировать код обработки, поместите его в файлы исходного кода в приложении\_каталога кода. |
| .cs, .vb, расширением JSL, .cpp (не включая файлы кода для типов файлов, перечисленных выше) | Эти файлы компилируются и включаются в качестве ресурсов в сборках, которые на них ссылаются. Исходные файлы не копируются в выходной каталог. Если не ссылается на файл кода, она не компилируется. |
| Особые типы файлов | Эти файлы не компилируются. Эти файлы копируются в соответствующие выходные каталоги. |
| Файлы исходного кода в приложении\_подкаталога кода | Эти файлы компилируются в сборки и размещаются в каталоге Bin. |
| файлы .resx и .resource в приложении\_подкаталог GlobalResources | Эти файлы компилируются в сборки и размещаются в каталоге Bin. Ни одно приложение\_в главном выходном каталоге создается подкаталог GlobalResources, а не файлы .resx или .resources, расположенном в каталоге источника копируются выходные каталоги. |
| файлы .resx и .resource в приложении\_подкаталог LocalResources | Эти файлы не компилируются и копируются в соответствующие выходные каталоги. |
| файлы обложки в приложении\_подкаталог темы | Файлы обложки и статические файлы тем не компилируются и копируются в соответствующие выходные каталоги. |
| файл Web.config статического типа BROWSER типы сборки уже существует в каталоге Bin | Эти файлы копируются в выходные каталоги. |

В следующей таблице описаны как компиляции ASP.NET средство обрабатывает различные типы файлов при **-u** параметр пропущен.

| **Тип файла** | **Действие компилятора** |
| --- | --- |
| .aspx, .asmx, .ashx, .master | Эти файлы разделяются на разметку и исходный код, который включает файлы кода и любой код, заключенный в &lt;скрипт runat = «server»&gt; элементов. Исходный код компилируется в сборки, имена которых получены с помощью алгоритма хэширования. Полученные сборки размещаются в каталоге Bin. Любой встроенный код, заключенный кода  **&lt; %**  и  **% &gt;**  квадратных скобок, относится к разметке и не компилируется. Компилятор создает новые файлы для содержания разметки с тем же именем, что и исходные файлы. Полученные файлы помещаются в каталог Bin. Компилятор также создает файлы с тем же именем, что и исходные файлы, но с расширением. COMPILED, содержат сведения о сопоставлении. . СКОМПИЛИРОВАННЫЕ файлы помещаются в каталоги выходные данные, соответствующие в исходное расположение исходных файлов. |
| .ascx | Эти файлы разделяются на разметку и исходный код. Исходный код компилируется в сборки и размещаются в каталоге Bin с именами, которые являются производными от хэш-алгоритма. Файлы разметки не создаются. |
| .cs, .vb, расширением JSL, .cpp (не включая файлы кода для типов файлов, перечисленных выше) | Исходный код, на который ссылается сборок, созданных из .ascx, .ashx или ASPX-файлы компилируются в сборки и поместить в каталог Bin. Исходные файлы не копируются. |
| Особые типы файлов | Эти файлы компилируются как динамические. В зависимости от типа файла, в которых они основаны компилятор может разместить файлы сопоставления в выходные каталоги. |
| Файлы в приложении\_подкаталога кода | Файлы исходного кода в этом подкаталоге компилируются в сборки и размещаются в каталоге Bin. |
| Файлы в приложении\_подкаталог GlobalResources | Эти файлы компилируются в сборки и размещаются в каталоге Bin. Ни одно приложение\_в главном выходном каталоге создается подкаталог GlobalResources. Если в файле конфигурации указываются appliesTo = «All» .resx и .resources файлы копируются в выходные каталоги. Они не копируются, если они ссылаются [BuildProvider](https://msdn.microsoft.com/library/system.web.configuration.buildprovider.aspx). |
| файлы .resx и .resource в приложении\_подкаталог LocalResources | Эти файлы компилируются в сборки с уникальными именами и размещаются в каталоге Bin. Файлы RESX или Resource копируются в выходные каталоги. |
| файлы обложки в приложении\_подкаталог темы | Темы компилируются в сборки и размещаются в каталоге Bin. Файлы-заглушки создаются для файлов обложки и помещаются в соответствующий выходной каталог. Статические файлы (такие как .css) копируются в выходные каталоги. |
| файл Web.config статического типа BROWSER типы сборки уже существует в каталоге Bin | Эти файлы копируются в выходной каталог. |

### <a name="fixed-assembly-nameshttpsmsdnmicrosoftcomlibraryms229863aspx"></a>[Фиксированные имена сборок](https://msdn.microsoft.com/library/ms229863.aspx##)

Некоторые сценарии, такие как развертывание веб-приложения с помощью установщика Windows, требуют использования согласованных имен файлов и содержимое, а также согласованных структур каталогов для определения сборки или параметры конфигурации для обновления. В таких случаях можно использовать **- fixednames** параметр, чтобы указать, что средство компиляции ASP.NET требуется компилировать сборку для каждого исходного файла, вместо использования нескольких страниц, компилируются в сборки. Это может привести к большое число сборок, поэтому если вас интересуют масштабируемость этот параметр следует использовать с осторожностью.

### <a name="strong-name-compilationhttpsmsdnmicrosoftcomlibraryms229863aspx"></a>[Компиляция со строгим именем](https://msdn.microsoft.com/library/ms229863.aspx##)

**- Aptca**, **- delaysign**, **- keycontainer** и **- keyfile** предоставляются параметры, чтобы можно было использовать Aspnet\_ Compiler.exe для создания строго с именем сборки без использования [средство строгих имен (Sn.exe)](https://msdn.microsoft.com/library/k5b5tt23.aspx) отдельно. Эти параметры соответствуют, соответственно, в **AllowPartiallyTrustedCallersAttribute**, **AssemblyDelaySignAttribute**, **AssemblyKeyNameAttribute**и  **AssemblyKeyFileAttribute**.

Описание этих атрибутов находится за пределами этого курса.

## <a name="labs"></a>Практические работы

Каждый из следующих labs основан на предыдущих labs. Необходимо будет выполнить их последовательно.

## <a name="lab-1-using-the-configuration-api"></a>Практическое занятие 1: С помощью API-Интерфейс настройки

1. Создайте новый веб-сайт называется *mod9lab*.
2. Добавьте новый файл веб-конфигурации к узлу.
3. Добавьте следующее в файл web.config:


[!code-xml[Main](configuration-and-instrumentation/samples/sample14.xml)]

Это гарантирует, что имеется разрешение на сохранение изменений в файле web.config.

1. Добавьте новый элемент управления Label Default.aspx и измените идентификатор на **lblDebugStatus**.
2. Добавьте новый элемент управления Button на Default.aspx.
3. Измените идентификатор элемента управления Button для **btnToggleDebug** и текст, **переключить состояние отладки**.
4. Откройте представление кода для файла кода для файла Default.aspx и добавьте **с помощью** инструкции для **System.Web.Configuration** следующим образом:


[!code-csharp[Main](configuration-and-instrumentation/samples/sample15.cs)]

1. Добавьте две закрытых переменных к классу и страницы\_метод инициализации, как показано ниже:


[!code-csharp[Main](configuration-and-instrumentation/samples/sample16.cs)]

1. Добавьте следующий код к странице\_нагрузки:


[!code-csharp[Main](configuration-and-instrumentation/samples/sample17.cs)]

1. Сохраните и обзор default.aspx. Обратите внимание, что элемент управления Label отображает его текущее состояние отладки.
2. Дважды щелкните элемент управления "Кнопка" в конструкторе и добавьте следующий код в событие Click для кнопки:


[!code-csharp[Main](configuration-and-instrumentation/samples/sample18.cs)]

1. Сохранить и просмотреть файл default.aspx и нажмите кнопку.
2. Откройте файл web.config после каждой кнопке перейдите и просмотрите **отладки** атрибута в &lt;компиляции&gt; раздела.

## <a name="lab-2-logging-application-restarts"></a>Лабораторное занятие 2: Перезапусков приложения, ведение журнала

В этой лабораторной работы создается код, который позволит вам включить или отключить ведение журнала для завершения работы приложения, запусков и перекомпиляции в средстве просмотра событий.

1. Добавьте DropDownList default.aspx и измените идентификатор на ddlLogAppEvents.
2. Задать **AutoPostBack** свойство DropDownList для **true**.
3. Добавьте три элемента в коллекцию элементов для DropDownList. Сделать **текст** для первого элемента *Select Value* и значение -1. Сделать **текст** и **значение** второго элемента **True** и **текст** и **значение** третьего элемента **False**.
4. Добавьте новую метку на default.aspx. Измените идентификатор на **lblLogAppEvents**.
5. Откройте представление кода для default.aspx и добавьте новое объявление переменной типа HealthMonitoringSection, как показано ниже:


[!code-csharp[Main](configuration-and-instrumentation/samples/sample19.cs)]

1. Добавьте следующий код в существующий код на странице\_Init:


[!code-csharp[Main](configuration-and-instrumentation/samples/sample20.cs)]

1. Дважды щелкните на DropDownList и добавьте следующий код в событие SelectedIndexChanged:


[!code-csharp[Main](configuration-and-instrumentation/samples/sample21.cs)]

1. Обзор default.aspx.
2. Значение раскрывающегося списка **False**.
3. Очистите журнал приложений в средстве просмотра событий.
4. Нажмите кнопку, чтобы изменить атрибут отладки для приложения.
5. Обновите журнал приложений в средстве просмотра событий. 

    1. Все события были зарегистрированы?
    2. Почему или почему?
6. Значение раскрывающегося списка **значение True.**
7. Нажмите кнопку для переключения атрибута отладки для приложения.
8. Обновите имя входа приложение просмотра событий. 

    1. Все события были зарегистрированы?
    2. Была причины завершения работы приложения?
9. Поэкспериментируйте с Включение и выключение ведения журнала и просмотрите изменения, внесенные в файл web.config.

## <a name="more-information"></a>Дополнительные сведения:

ASP.NET 2.0 поставщик модели можно создавать собственные поставщики не только инструментирования приложений, но для многих других нагрузками, также как членство, профили и т. д. Подробные сведения о создании пользовательского поставщика в журнал событий приложений в текстовый файл на сайте [эту ссылку](https://msdn.microsoft.com/library/default.asp?url=/library/dnaspp/html/ASPNETProvMod_Prt6.asp).
