---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/understanding-the-build-process
title: "Основные сведения о процессе построения | Документы Microsoft"
author: jrjlee
description: "В этом разделе Пошаговое руководство по процессом построения и развертывания корпоративного уровня. Подход, описанный в этом разделе использует пользовательские Денис сборки Microsoft..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/04/2012
ms.topic: article
ms.assetid: 5b982451-547b-4a2f-a5dc-79bc64d84d40
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/understanding-the-build-process
msc.type: authoredcontent
ms.openlocfilehash: 3efcefc40dc135ff42f55911036f8b38b5aa13b1
ms.sourcegitcommit: 493a215355576cfa481773365de021bcf04bb9c7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/15/2018
---
<a name="understanding-the-build-process"></a>Основные сведения о процессе построения
====================
по [Джейсон Lee](https://github.com/jrjlee)

[Скачать PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе Пошаговое руководство по процессом построения и развертывания корпоративного уровня. Подход, описанный в этом разделе использует пользовательские файлы проекта Microsoft Build Engine (MSBuild) для обеспечения точного управления всех аспектов процесса. В файлах проектов пользовательские целевые объекты MSBuild используются для запуска программы развертывания, как средство веб-развертывания Internet Information Services (IIS) (MSDeploy.exe) и VSDBCMD.exe программы развертывания базы данных.
> 
> > [!NOTE]
> > Предыдущего раздела [основные сведения о файле проекта](understanding-the-project-file.md), описаны основные компоненты файла проекта MSBuild и представляет концепцию разделенные файлы проекта для поддержки развертывания в различных целевых средах. Если вы не знакомы с этими понятиями, следует просмотреть [основные сведения о файле проекта](understanding-the-project-file.md) перед началом работы с этим разделом.


Этот раздел входит в состав серию учебников, исходя из требования к развертыванию enterprise вымышленная компания Fabrikam, Inc. Этот учебник ряд использует образец решения & #x 2014; [решения диспетчера контактов](the-contact-manager-solution.md)& #x 2014; для представления веб-приложения с реалистичных уровень сложности, включая приложения ASP.NET MVC 3, Windows Службы Communication Foundation (WCF) и проект базы данных.

Метод развертывания, в основе этих учебников основан на разбиение проекта файл подход, описанный в [основные сведения о файле проекта](understanding-the-project-file.md), в которой процесс построения управляется двух проектов файлы & #x 2014; один с построение инструкции, которые применяются для каждой целевой среде и, содержащий параметры построения и развертывания конкретной среды. Во время построения файла проекта среды объединяется в файл проекта зависит от среды, образуют полный набор инструкций построения.

## <a name="build-and-deployment-overview"></a>Обзор развертывания и сборки

В [решения диспетчера контактов](the-contact-manager-solution.md), три файла управления процессом построения и развертывания:

- Объект *файл универсального проекта* (*Publish.proj*). Содержит инструкции построения и развертывания, которые не изменяют между средами назначения.
- *Файл проекта среды* (*Env Dev.proj*). Содержит параметры построения и развертывания, которые относятся к определенной целевой среде. Например, можно использовать *Env Dev.proj* файл, чтобы указать параметры для разработчика или тестовой среде и создать альтернативный файл с именем *Env Stage.proj* для предоставления параметров для промежуточного хранения Среда.
- Объект *командный файл* (*Dev.cmd публикации*). Этот элемент содержит MSBuild.exe команду, которая указывает, какой проект файлами, которые требуется выполнить. Можно создать командный файл для каждой целевой среде, где каждый файл содержит команду MSBuild.exe, задает файл на другой проект конкретной среды. Это позволяет разработчикам развертывать в различных средах просто путем запуска файла соответствующую команду.

В образце решения можно найти эти три файла в папке публикации решения.

![](understanding-the-build-process/_static/image1.png)

Прежде чем рассмотреть эти файлы более подробно, давайте взглянем на работе процесс построения при использовании этого подхода. На высоком уровне в процессе построения и развертывания выглядит следующим образом:

![](understanding-the-build-process/_static/image2.png)

Первое, что произойдет, — что два проекта файлы & #x 2014; одна из которых содержит универсальной сборки и инструкции по развертыванию и одна из которых содержит параметры, относящиеся к среде & #x 2014; объединяются в один файл проекта. Затем MSBuild работают, минуя инструкции в файле проекта. Он создает все проекты в решении, с использованием файла проекта для каждого проекта. Затем вызывается для других средств, таких как веб-развертывания (MSDeploy.exe) и служебную программу VSDBCMD для развертывания веб-содержимого и баз данных в целевой среде.

От начала до окончания процесса построения и развертывания выполняет следующие задачи:

1. Удаляет содержимое в выходной каталог, в процессе подготовки к новой сборки.
2. Он создает каждый проект в решении:

    1. Для веб-проектов & #x 2014; в этом случае веб-приложение ASP.NET MVC и WCF, веб-службы & #x 2014; процесс построения создает пакет веб-развертывания для каждого проекта.
    2. Для проектов баз данных в процесс построения создает манифест развертывания (DEPLOYMANIFEST-файл) для каждого проекта.
3. Он использует служебную программу VSDBCMD.exe развертывание каждого проекта базы данных в решении, с помощью различных свойств из файлов проекта & #x 2014; целевая строка подключения и имя базы данных & #x 2014; а также DEPLOYMANIFEST-файл.
4. Он использует MSDeploy.exe программы для развертывания каждого веб-проекта в решении, с помощью различных свойств в файлы проекта для управления процессом развертывания.

Пример решения можно использовать для трассировки этот процесс более подробно.

> [!NOTE]
> Рекомендации по настройке файлы проекта, относящихся к среде для серверных сред см. в разделе [настройки свойств развертывания для целевой среды](../configuring-server-environments-for-web-deployment/configuring-deployment-properties-for-a-target-environment.md).


## <a name="invoking-the-build-and-deployment-process"></a>Вызов сборки и процесса развертывания

Для развертывания решения диспетчера контактов в тестовой среде разработчика, разработчик работает *Dev.cmd публикации* командный файл. При этом вызывается MSBuild.exe, указав *Publish.proj* как файл проекта для выполнения и *Env Dev.proj* как значение параметра.


[!code-console[Main](understanding-the-build-process/samples/sample1.cmd)]


> [!NOTE]
> **/Fl** переключения (сокращенно **/fileLogger**) записывает выходные данные сборки в файл с именем *msbuild.log* в текущем каталоге. Дополнительные сведения см. в разделе [Справочник по командной строке MSBuild](https://msdn.microsoft.com/library/ms164311.aspx).


На этом этапе MSBuild запускается, загружает *Publish.proj* файл и начинает обработку инструкции внутри него. Первая инструкция сообщает MSBuild для импорта в проект файла, который **TargetEnvPropsFile** указывает параметр.


[!code-xml[Main](understanding-the-build-process/samples/sample2.xml)]


**TargetEnvPropsFile** указывает *Env Dev.proj* файл, поэтому MSBuild объединяет содержимое *Env Dev.proj* файла в  *Publish.proj* файл.

Следующие элементы, которые MSBuild находит в файле проекта объединенные являются группы свойств. Свойства, обрабатываются в порядке, в котором они появляются в файле. MSBuild создает пару ключ значение для каждого свойства, обеспечивая любой определенных условий. Свойства, определенные в более поздней версии в файле перезапишет любые свойства с тем же именем, ранее определенные в файле. Например, рассмотрим **OutputRoot** свойства.


[!code-xml[Main](understanding-the-build-process/samples/sample3.xml)]


Когда MSBuild обрабатывает первый **OutputRoot** элемент, предоставляя таким же именем параметр не задан, он определяет значение **OutputRoot** свойства **... \Publish\Out**. При обнаружении второго **OutputRoot** элемента, если условие принимает значение **true**, будут перезаписаны значение **OutputRoot** свойство со значением **OutDir** параметра.

На элемент, который обнаруживает MSBuild — группа один элемент, содержащий элемент с именем **ProjectsToBuild**.


[!code-xml[Main](understanding-the-build-process/samples/sample4.xml)]


MSBuild обрабатывает эту инструкцию, построение списка элементов с именем **ProjectsToBuild**. В этом случае в списке элементов содержит одно значение & #x 2014; путь и имя файла решения.

На этом этапе оставшиеся элементы, целевые объекты. Целевые объекты обрабатываются по-разному из & #x 2014 свойства и элементы, по существу, целевые объекты, не обрабатываются так, если они являются явно заданное пользователем или вызван другой конструкции в файле проекта. Помните, что открывающий **проекта** тег содержит **DefaultTargets** атрибута.


[!code-xml[Main](understanding-the-build-process/samples/sample5.xml)]


Это указывает, что MSBuild для вызова **FullPublish** целевой объект, если целевые объекты не задан вызова MSBuild.exe. **FullPublish** цели не содержит каких-либо задач; вместо этого оно просто определяет список зависимостей.


[!code-xml[Main](understanding-the-build-process/samples/sample6.xml)]


Эта зависимость сообщает MSBuild, чтобы выполнить **FullPublish** целевого объекта, он должен вызывать этот список целевых объектов в указанном порядке:

1. Он должен вызывать **Очистить** цели.
2. Он должен вызывать **BuildProjects** цели.
3. Он должен вызывать **GatherPackagesForPublishing** цели.
4. Он должен вызывать **PublishDbPackages** цели.
5. Он должен вызывать **PublishWebPackages** цели.

### <a name="the-clean-target"></a>Цели "Очистить"

**Очистить** целевой сущности удаляет выходную папку и все ее содержимое при подготовке к новой сборки.


[!code-xml[Main](understanding-the-build-process/samples/sample7.xml)]


Обратите внимание, что целевой объект включает **ItemGroup** элемента. При определении свойств или элементов в пределах **целевой** элемент, которую вы создаете *динамическое* свойства и элементы. Другими словами свойств или элементов не обрабатываться, пока целевой объект выполняется. Выходной каталог не может существовать или содержать все файлы до начала процесса построения, поэтому не может создать  **\_FilesToDelete** списка в качестве статического элемента, вам нужно подождать, пока идет выполнение. Таким образом можно составить список как динамический элемент в целевой объект.

> [!NOTE]
> В этом случае из-за **Очистить** целевой является первым для выполнения, нет необходимости в использовании динамических элементов группы real. Тем не менее рекомендуется использовать динамические свойства и элементы в таких случаях, как может потребоваться запустить выполнение целевых объектов в другом порядке, в определенный момент.  
> Также следует стремиться не объявляйте элементы, которые не будут использоваться. При наличии элементов, которые будут использоваться только для определенной цели, рассмотрите возможность разместить их в целевой объект для удаления любой ненужных затрат ресурсов на процесс построения.


Динамические элементы, **Очистить** целевой достаточно прост и используют встроенные **сообщение**, **удаление**, и **RemoveDir**задач:

1. Отправьте сообщение в средство ведения журнала.
2. Создает список удаляемых файлов.
3. Удалите файлы.
4. Удалите выходной каталог.

### <a name="the-buildprojects-target"></a>Целевой объект BuildProjects

**BuildProjects** целевой сущности построение всех проектов в решении образца.


[!code-xml[Main](understanding-the-build-process/samples/sample8.xml)]


Этот целевой объект была описана в предыдущем разделе, некоторые сведения [основные сведения о файле проекта](understanding-the-project-file.md), чтобы продемонстрировать, как задачи и цели ссылки на свойства и элементы. На этом этапе вы заинтересованы в основном в **MSBuild** задачи. Эту задачу можно использовать для построения несколько проектов. Задача не создает новый экземпляр MSBuild.exe; для построения каждого проекта используется текущего выполняемого экземпляра. Основные особенности в этом примере приведены свойства развертывания.

- **DeployOnBuild** свойство предписывает MSBuild для выполнения любой инструкции по развертыванию в параметрах проекта по завершении сборки каждого проекта.
- **DeployTarget** свойство идентифицирует целевой объект, который нужно вызывать после построения проекта. В этом случае **пакета** целевой встраивает выходных файлов проекта в веб-развертывания пакета.

> [!NOTE]
> **Пакета** цель вызывает Web публикации конвейера (WPP), который обеспечивает интеграцию MSBuild и веб-развертывания. Если вы хотите взгляните на встроенные целевые объекты, которые предоставляет WPP, просмотрите *Microsoft.Web.Publishing.targets* файл в папке % PROGRAMFILES (x 86) %\MSBuild\Microsoft\VisualStudio\v10.0\Web.


### <a name="the-gatherpackagesforpublishing-target"></a>Целевой объект GatherPackagesForPublishing

Если изучить **GatherPackagesForPublishing** целевого объекта, вы заметите, что она не содержит фактически все задачи. Вместо этого он содержит группу один элемент, определяющий три динамических элементов.


[!code-xml[Main](understanding-the-build-process/samples/sample9.xml)]


Эти элементы ссылаться на пакеты развертывания, которые были созданы при **BuildProjects** целевой была выполнена. Не удалось определения этих элементов статически в файле проекта, так как файлы, на которые ссылаются элементы не существуют до **BuildProjects** выполнения целевого объекта. Вместо этого элементы должны быть определены динамически в целевой объект, который не вызывается до после **BuildProjects** выполнения целевого объекта.

Элементы не используются в этой цели & #x 2014; этот целевой объект просто создает элементы и метаданные, связанные со значением каждого элемента. После обработки этих элементов, **PublishPackages** элемента будет содержать два значения, путь к *ContactManager.Mvc.deploy.cmd* файла и путь к  *ContactManager.Service.deploy.cmd* файл. Веб-развертывания создает эти файлы как часть веб-пакет для каждого проекта, и они представляют собой файлы, которые необходимо выполнить на целевом сервере для развертывания пакетов. Если открыть один из этих файлов, по сути появится команда MSDeploy.exe с различных значений параметров, относящихся к сборке.

**DbPublishPackages** элемента будет содержать один символ, путь к *ContactManager.Database.deploymanifest* файла.

> [!NOTE]
> DEPLOYMANIFEST-файл создается при построении проекта базы данных, и она использует ту же схему, что файл проекта MSBuild. Он содержит все сведения, необходимые для развертывания базы данных, включая расположение схема базы данных (DBSCHEMA) и сведения о любых скриптов до и после развертывания. Дополнительные сведения см. в разделе [Обзор для построения базы данных и развертывания](https://msdn.microsoft.com/library/aa833165.aspx).


Дополнительные сведения о том, как создать и использовать в пакеты развертывания и манифесты развертывания базы данных [построения и упаковки проектов веб-приложений](building-and-packaging-web-application-projects.md) и [развертывание проектов базы данных](deploying-database-projects.md).

### <a name="the-publishdbpackages-target"></a>Целевой объект PublishDbPackages

Кратко говоря, **PublishDbPackages** цель вызывает программу VSDBCMD развертывание **ContactManager** базы данных в целевой среде. Настройка развертывания базы данных включает в себя множество решений и особенности и Дополнительные сведения об этом [развертывание проектов базы данных](deploying-database-projects.md) и [Настройка развертывания базы данных для нескольких сред](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md). В этом разделе мы рассмотрим фактически функционирование этот целевой объект.

Во-первых, обратите внимание, что открывающий тег включает **выходов** атрибута.


[!code-xml[Main](understanding-the-build-process/samples/sample10.xml)]


Это пример *Пакетная обработка целевых объектов*. В файлах проектов MSBuild Пакетная обработка — это метод для прохода по коллекции. Значение **выходов** атрибут, **«% (DbPublishPackages.Identity)»**, ссылается на **удостоверение** свойство метаданных **DbPublishPackages**  список элементов. Такая запись **Outputs=%***(ItemList.ItemMetadataName)*, преобразуется следующим образом:

- Разделить элементы в **DbPublishPackages** на пакеты элементов, которые содержат одинаковый **удостоверение** значение метаданных.
- Выполнение целевого один раз в каждом пакете.

> [!NOTE]
> **Удостоверение** является одним из [встроенные метаданные значения](https://msdn.microsoft.com/library/ms164313.aspx) , которое присваивается при создании каждого элемента. Он ссылается на значение **Include** атрибута в **элемента** элемент & #x 2014; другими словами, путь и имя элемента.


Таким образом так как никогда не должна быть более одного элемента с тем же путь и имя файла, мы фактически работаем с размером пакета одного. Целевой объект выполняется один раз для каждого пакета базы данных.

Вы увидите примерно нотация в  **\_Cmd** свойство, которое создает команду VSDBCMD с соответствующими параметрами.


[!code-xml[Main](understanding-the-build-process/samples/sample11.xml)]


В этом случае **%(DbPublishPackages.DatabaseConnectionString)**, **%(DbPublishPackages.TargetDatabase)**, и **%(DbPublishPackages.FullPath)** ссылаются значения метаданных **DbPublishPackages** коллекции элементов.  **\_Cmd** используется свойство **Exec** задачу, которая вызывает команду.


[!code-xml[Main](understanding-the-build-process/samples/sample12.xml)]


В результате такой записи **Exec** задача создаст пакеты на основании уникальных комбинаций **DatabaseConnectionString**, **TargetDatabase**и **FullPath** значения метаданных и эта задача выполняется один раз для каждого пакета. Это пример *Пакетная обработка задач*. Тем не менее, поскольку целевого уровня пакетной обработки уже поделила наш набор элементов на пакеты одним элементом, **Exec** задача будет выполняться только один раз для каждой итерации целевого объекта. Другими словами эта задача вызывает программу VSDBCMD один раз для каждого пакета базы данных в решении.

> [!NOTE]
> Дополнительные сведения о целевой и пакетная обработка задач см. в разделе MSBuild [Пакетная обработка](https://msdn.microsoft.com/library/ms171473.aspx), [метаданные элементов в пакетной обработке целевых объектов](https://msdn.microsoft.com/library/ms228229.aspx), и [метаданные элементов в пакетной обработке задач](https://msdn.microsoft.com/library/ms171474.aspx).


### <a name="the-publishwebpackages-target"></a>Целевой объект PublishWebPackages

К этому моменту были активированы **BuildProjects** цели, которая создает пакет веб-развертывания для каждого проекта в решении образца. Каждый пакет, сопровождающие — *deploy.cmd* файл, содержащий MSDeploy.exe команд, необходимых для развертывания пакета в целевой среде, и *SetParameters.xml* файл, который указывает необходимые сведения в целевой среде. Также были активированы **GatherPackagesForPublishing** целевой объект, который создает элемент коллекция, содержащая *deploy.cmd* файлы, которые вас интересуют. По существу **PublishWebPackages** целевой выполняет следующие функции:

- Он управляет *SetParameters.xml* файл для каждого пакета включить правильные сведения для целевой среды с помощью **XmlPoke** задачи.
- Он вызывает *deploy.cmd* файл для каждого пакета, с помощью нужных параметров.

Так же, как **PublishDbPackages** цели, **PublishWebPackages** цель использует Пакетная обработка целевых объектов для убедитесь, что целевой объект выполняется один раз для каждого веб-пакета.


[!code-xml[Main](understanding-the-build-process/samples/sample13.xml)]


В целевом объекте **Exec** задача используется для запуска *deploy.cmd* файл для каждого веб-пакета.


[!code-xml[Main](understanding-the-build-process/samples/sample14.xml)]


Дополнительные сведения о настройке развертывания веб-пакетов см. в разделе [построения и упаковки проектов веб-приложений](building-and-packaging-web-application-projects.md).

## <a name="conclusion"></a>Заключение

В этом разделе предоставляется пошаговое руководство по использованию разделенные файлы проекта для управления процессом построения и развертывания от начала до конца для примера решения диспетчера контактов. Этот подход позволяет запуском комплексного, развертывания корпоративного уровня одного repeatable шаг, просто выполнив конкретных командный файл.

## <a name="further-reading"></a>Дополнительные сведения

Более подробные сведения о файлы проекта и WPP см. в разделе [внутри Microsoft Build Engine: с помощью MSBuild и Team Foundation Build](http://amzn.com/0735645248) Sayed Ibrahim Hashimi и Bartholomew Уильям, ISBN: 978-0-7356-4524-0.

>[!div class="step-by-step"]
[Назад](understanding-the-project-file.md)
[Вперед](building-and-packaging-web-application-projects.md)
