---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
title: Развертывание проектов базы данных | Документы Microsoft
author: jrjlee
description: 'Примечание: В большом числе корпоративный сценарий развертывания, необходимо также возможности публиковать добавочные обновления в развернутую базу данных. Другая возможность — это повторно создать...'
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/04/2012
ms.topic: article
ms.assetid: 832f226a-1aa3-4093-8c29-ce4196793259
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
msc.type: authoredcontent
ms.openlocfilehash: a0b3871ea098b549271bce2b9d5f0c24f9ca8a9c
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="deploying-database-projects"></a>Развертывание проектов базы данных
====================
по [Джейсон Lee](https://github.com/jrjlee)

[Скачать PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> [!NOTE]
> В большом числе корпоративный сценарий развертывания требуется возможность публикации добавочные обновления в развернутой базе данных. Вместо него следует использовать — это повторно создать базу данных на каждом развертывании, это означает, что будут потеряны все данные в существующую базу данных. При работе с Visual Studio 2010 с помощью VSDBCMD является рекомендуемым методом Добавочная публикация баз данных. Однако следующей версии Visual Studio и конвейер публикации Web (WPP) будет включать инструментарием, который поддерживает добавочную публикацию напрямую.


При открытии диспетчера контактов образец решения в Visual Studio 2010, вы увидите, что проект базы данных включает свойства папку, содержащую четыре файла.

![](deploying-database-projects/_static/image1.png)

Вместе с файлом проекта (*ContactManager.Database.dbproj* в данном случае), эти файлы управлять различными аспектами процесса построения и развертывания:

- *Database.sqlcmdvars* файл предоставляет значения всех переменных SQLCMD, используется при развертывании проекта. Каждая конфигурация решения (например, отладки и выпуска) можно указать другой SQLCMDVARS-файл.
- *Database.sqldeployment* файл содержит параметры, относящиеся к развертыванию, как и следует ли использовать параметры сортировки, определенных в проекте или параметры сортировки конечного сервера, следует ли повторно создать целевую базу данных каждые время, или просто исправить существующую базу данных, чтобы обновить его и т. д. Каждой конфигурации решения можно указать различные .sqldeployment файл.
- *Database.sqlpermissions* файл является XML-документа, можно использовать для задания разрешений, на которые вы хотите добавить в целевую базу данных. Все конфигурации решения используют же sqlpermissions-файл.
- *Database.sqlsettings* файл задает свойства уровня базы данных для использования при создании базы данных, такие как параметры сортировки для использования поведение операторов сравнения и т. д. Все конфигурации решения используют же sqlsettings-файл.

Есть смысл вас эти файлы можно открывать в Visual Studio и ознакомиться с содержимым.

При построении проекта базы данных, процесс построения создает два файла:

- Объект *схемы базы данных* (DBSCHEMA-файл). Это описание схемы базы данных, которую нужно создать в формате XML.
- Объект *манифест развертывания* (DEPLOYMANIFEST-файл). Этот файл содержит все сведения, необходимые для создания и развертывания базы данных. Он ссылается на DBSCHEMA-файл, а также другие ресурсы, такие как инструкции по развертыванию (файл .sqldeployment) и любых скриптов SQL до или после развертывания.

Это показывает связь между этими ресурсами:

![](deploying-database-projects/_static/image2.png)

Как видите, sqlsettings-файл и sqlpermissions-файл, входные данные для процесса построения. Вместе с файлом проекта базы данных эти файлы используются для создания файла схемы базы данных. SQLDEPLOYMENT-файл и SQLCMDVARS-файл, проходят через процесс построения без изменений. Манифест развертывания указывает на расположение схемы базы данных, SQLDEPLOYMENT-файл, SQLCMDVARS-файл и любые скрипты SQL до или после развертывания.

## <a name="why-use-vsdbcmd-to-deploy-a-database-project"></a>Зачем использовать VSDBCMD для развертывания проекта базы данных?

Существуют различные подходы к развертывание проектов базы данных. Однако не все из них подходят для развертывания проекта базы данных на удаленных серверах в среде предприятия. Помните, что следует из развертывания проекта базы данных. В корпоративных сценариях развертывания скорее всего, необходимо:

- Возможность развертывания проекта базы данных из удаленного расположения.
- Возможность вносить добавочные обновления существующей базы данных.
- Возможность включить скрипты перед развертыванием или после развертывания.
- Возможность настроить развертывания в различных средах назначения.
- Возможность развертывания проекта базы данных как часть большего размера, обычно на основе сценария, развертывания решения на один шаг.

Существует три основных подходов, которые можно использовать для развертывания проекта базы данных.

- Функциональность развертывания можно использовать с типом проекта базы данных в Visual Studio 2010. При построении и развертывании проекта базы данных в Visual Studio 2010, процесс развертывания использует манифест развертывания для создания развертывания на основе SQL-файла, относящегося к конфигурации построения. Это будет создать базу данных, если он уже не существует или внесите необходимые изменения в базу данных, если он уже существует. Можно использовать SQLCMD.exe для запуска этого файла на конечном сервере, или можно установить Visual Studio для создания и выполнения файла. Недостатком этого подхода является доступны только ограниченные контролировать параметры развертывания. Часто также может потребоваться изменить файл развертывания SQL для задания значений переменных среды. Этот подход с компьютера, можно использовать только с Visual Studio 2010 установлена, и разработчику необходимо знать и укажите строки подключения и учетные данные для всех сред назначения.
- Можно использовать средство Internet Information Services (IIS) веб-развертывания (Web Deploy) для [развертывание базы данных как часть проект веб-приложения](https://msdn.microsoft.com/library/dd465343.aspx). Однако этот подход гораздо сложнее, если вы хотите развернуть проект базы данных, а не просто реплицировать существующей локальной базы данных на конечном сервере. Вы можете настроить веб-развертывания для выполнения скрипта развертывания SQL, создающий проект базы данных, но чтобы сделать это, необходимо создать пользовательский файл WPP целевых объектов для проекта веб-приложения. Это добавляет значительный объем сложности в процессе развертывания. Кроме того веб-развертывания не поддерживает напрямую добавочные обновления к существующим базам данных. Дополнительные сведения об этом подходе см. в разделе [расширение конвейера публикации в Интернете в проект базы данных пакета развертывания файла SQL](https://go.microsoft.com/?linkid=9805121).
- Развертывание базы данных, с помощью схемы базы данных или манифест развертывания, можно использовать служебную программу VSDBCMD. VSDBCMD.exe можно вызывать из целевой объект MSBuild, который служит для публикации баз данных в рамках процесса развертывания крупных и сценариев. Можно переопределить переменные в SQLCMDVARS-файл и множество других свойств базы данных из команды VSDBCMD, который позволяет настроить развертывание для разных сред без создания нескольких конфигураций построения. VSDBCMD функциональная различиями, это означает, что это сделает только необходимые изменения, чтобы выровнять в целевую базу данных с помощью схемы базы данных. VSDBCMD также предлагает широкий спектр параметров командной строки, которые предоставляют строгий контроль над процессом развертывания.

В этом обзоре вы увидите, что VSDBCMD с MSBuild является подход, подходящих для типичных корпоративных сценарий развертывания:

|  | Visual Studio 2010 | Web Deploy 2.0 | VSDBCMD.exe |
| --- | --- | --- | --- |
| Поддерживает удаленное развертывание? | Да | Да | Да |
| Поддерживает добавочные обновления? | Да | Нет | Да |
| Поддерживает сценарии до и после развертывания? | Да | Да | Да |
| Поддержка нескольких среды развертывания? | Ограниченный | Ограниченный | Да |
| Поддерживает скрипт развертывания? | Ограниченный | Да | Да |

В оставшейся части этого раздела описывается использование VSDBCMD с помощью MSBuild для развертывания проектов базы данных.

## <a name="understanding-the-deployment-process"></a>Основные сведения о процессе развертывания

Служебную программу VSDBCMD позволяет развернуть базу данных с помощью схемы базы данных (DBSCHEMA-файл) или манифест развертывания (DEPLOYMANIFEST-файл). На практике почти всегда будет использовать манифест развертывания, как манифест развертывания, которая позволяет предоставить значения по умолчанию для различных свойств развертывания и определите все до или после развертывания SQL-сценарии, которые требуется выполнить. Например, эта команда VSDBCMD используется для развертывания **ContactManager** базы данных на сервере базы данных в тестовой среде:


[!code-console[Main](deploying-database-projects/samples/sample1.cmd)]


В этом случае:

- **/A** (или **/Action**) — указывает желаемый VSDBCMD делать. Вы можете задать **импорта** или **развернуть**. **Импорта** параметр используется для создания файла с расширением DBSCHEMA из существующей базы данных и **развернуть** параметр используется для развертывания таких файлов в целевой базе данных.
- **/Manifest** (или **/ManifestFile**) коммутатора идентифицирует DEPLOYMANIFEST-файл, вы хотите развернуть. Если нужно вместо этого используйте DBSCHEMA-файл, следует использовать **/модели** (или **/ModelFile**) переключения.
- **/Cs** (или **/ConnectionString**) коммутатор предоставляет строку подключения для базы данных целевого сервера. Обратите внимание, что это не включать имя базы данных&#x2014;VSDBCMD должен подключиться к серверу для создания базы данных; он не требуется для подключения к отдельной базы данных. Если DEPLOYMANIFEST-файл содержит строку соединения, можно опустить этот параметр. Если все равно использовать параметр значение переключателя переопределит значение .deploymanifest.
- <strong>/P:TargetDatabase</strong> предоставляет имя вы хотите назначить в целевую базу данных в момент создания. Это значение переопределяет значение <strong>TargetDatabase</strong> свойство в DEPLOYMANIFEST-файл. Можно использовать <strong>/p:</strong> <em>[имя свойства]</em>синтаксис для задания широкий набор свойств развертывания и переопределить все переменные SQLCMD, объявленные в SQLCMDVARS-файл.
- **/Dd+** (или **/DeployToDatabase+**) параметр указывает, что для создания развертывания и его развертывания в целевой среде. При указании **/dd-**, или ключ пропущен, VSDBCMD будет создать скрипт развертывания, но не будет выполнять развертывание его в целевой среде. Этот ключ часто является источником проблем и является более подробно в следующем разделе.
- **/Script** (или **/DeploymentScriptFile**) — указывает, где требуется создать скрипт развертывания. Это значение не влияет на процесс развертывания.

Дополнительные сведения о VSDBCMD см. в разделе [Справочник по командной строке для VSDBCMD. EXE (развертывание и импорт схемы)](https://msdn.microsoft.com/library/dd193283.aspx) и [как: Подготовка базы данных для развертывания из командной строки с помощью программы VSDBCMD. EXE](https://msdn.microsoft.com/library/dd193258.aspx).

Пример того, как использовать VSDBCMD из файла проекта MSBuild см. в разделе [основные сведения о процессе построения](understanding-the-build-process.md). Примеры того, как настроить параметры развертывания базы данных для нескольких сред см. в разделе [Настройка развертывания базы данных для нескольких сред](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).

## <a name="understanding-the-deploytodatabase-switch"></a>Основные сведения о коммутаторе DeployToDatabase

Поведение **/dd** или **/DeployToDatabase** коммутатора зависит от того, используете ли вы VSDBCMD с DBSCHEMA-файл или DEPLOYMANIFEST-файл. Если вы используете файл DBSCHEMA, поведение не очевиден:

- При указании **/dd+** или **/dd**, VSDBCMD создаст скрипт развертывания и развертывания базы данных.
- При указании **/dd-** или ключ пропущен, VSDBCMD создаст только скрипт развертывания.

Если вы используете DEPLOYMANIFEST-файл, поведение не гораздо сложнее. Это обусловлено DEPLOYMANIFEST-файл содержит имя свойства **DeployToDatabase** , определяющий, является ли база данных развернута.


[!code-xml[Main](deploying-database-projects/samples/sample2.xml)]


Это свойство имеет значение в соответствии с свойств проекта базы данных. Если задать **развертывания** для **создать скрипт развертывания (.sql)**, это значение будет равно **False**. Если задать **развертывания** для **создать скрипт развертывания (.sql) и развернуть в базе данных**, это значение будет равно **True**.

> [!NOTE]
> Эти параметры связаны с конкретной сборки конфигурации и платформы. Например, если настроить параметры для **отладки** конфигурации, а затем опубликовать с помощью **выпуска** конфигурации, параметры не будут использоваться.


![](deploying-database-projects/_static/image3.png)

> [!NOTE]
> В этом сценарии **развертывания** всегда должен иметь значение **создать скрипт развертывания (.sql)**, так как вы не хотите Visual Studio 2010 для развертывания базы данных. Другими словами **DeployToDatabase** свойство всегда должно быть **False**.


При **DeployToDatabase** свойство указано, **/dd** коммутатора только переопределяют свойства, если свойство имеет значение **false**:

- Если **DeployToDatabase** свойство **False**, и указать **/dd+** или **/dd**, переопределяют VSDBCMD  **DeployToDatabase** свойство и развертывания базы данных.
- Если **DeployToDatabase** свойство **False**, и указать **/dd-** или ключ пропущен, VSDBCMD не будет выполнять развертывание базы данных.
- Если **DeployToDatabase** свойство **True**, VSDBCMD будет игнорировать коммутатора и развертывания базы данных.
- В каждом случае, независимо от того, развертывании базы данных также формируется скрипт развертывания.

## <a name="conclusion"></a>Заключение

В этом разделе предоставляется обзор процесса построения и развертывания для проектов баз данных в Visual Studio 2010. Также описывается, как использовать VSDBCMD.exe с помощью MSBuild для поддержки развертывания корпоративного уровня базы данных.

Дополнительные сведения о том, как это работает на практике см. в разделе [Настройка развертывания базы данных для нескольких сред](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).

## <a name="further-reading"></a>Дополнительные сведения

Сведения о том, как настроить развертывание базы данных путем создания файла конфигурации отдельное развертывание для каждой среды см. в разделе [Настройка развертывания базы данных для нескольких сред](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md). Рекомендации по настройке членства в роли базы данных с помощью скрипта после развертывания см. в разделе [развертывание членство роли базы данных для тестовых сред](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md). Рекомендации по управлению некоторые уникальные задачи это членство баз данных накладывают см. в разделе [развертывание базы данных членства для корпоративных средах](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).

В этих разделах в библиотеке MSDN содержатся более широкой рекомендации и общие сведения о проектах базы данных Visual Studio и процесс развертывания базы данных:

- [Проекты базы данных Visual Studio 2010 SQL Server](https://msdn.microsoft.com/library/ff678491.aspx)
- [Управление изменениями в базе данных](https://msdn.microsoft.com/library/aa833404.aspx)
- [Как: Подготовка базы данных для развертывания из командной строки с помощью программы VSDBCMD. EXE-ФАЙЛА](https://msdn.microsoft.com/library/dd193258.aspx)
- [Общие сведения о базе данных построения и развертывания](https://msdn.microsoft.com/library/aa833165.aspx)

> [!div class="step-by-step"]
> [Назад](deploying-web-packages.md)
> [Вперед](creating-and-running-a-deployment-command-file.md)
