---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
title: "Создание веб-приложений вне сети с помощью веб-развертывание | Документы Microsoft"
author: jrjlee
description: "В этом разделе описывается перевод веб-приложения вне сети в течение о ра Web Internet Information Services (IIS) с помощью автоматизированного развертывания..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/04/2012
ms.topic: article
ms.assetid: 3e9f6e7d-8967-4586-94d5-d3a122f12529
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
msc.type: authoredcontent
ms.openlocfilehash: 1c262ec7b834107524a18c6552b171f731452c91
ms.sourcegitcommit: 493a215355576cfa481773365de021bcf04bb9c7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/15/2018
---
<a name="taking-web-applications-offline-with-web-deploy"></a>Создание веб-приложений вне сети с помощью веб-развертывания
====================
по [Джейсон Lee](https://github.com/jrjlee)

[Скачать PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе описывается перевод веб-приложении автономный режим на время автоматического развертывания, используя средство Internet Information Services (IIS) веб-развертывания (Web Deploy). Пользователь, просматривающий веб-приложению, перенаправляются *приложения\_offline.htm* файла до завершения развертывания.


Этот раздел входит в состав серию учебников, исходя из требования к развертыванию enterprise вымышленная компания Fabrikam, Inc. Этот учебник ряд использует образец решения & #x 2014; [решения диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)& #x 2014; для представления веб-приложения с реалистичных уровень сложности, включая приложения ASP.NET MVC 3, Windows Службы Communication Foundation (WCF) и проект базы данных.

Метод развертывания, в основе этих учебников основан на разбиение проекта файл подход, описанный в [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), в которой процесс построения управляется двух проектов файлы & #x 2014; один с построение инструкции, которые применяются для каждой целевой среде и, содержащий параметры построения и развертывания конкретной среды. Во время построения файла проекта среды объединяется в файл проекта зависит от среды, образуют полный набор инструкций построения.

## <a name="task-overview"></a>Общие сведения о задаче

В множество сценариев может потребоваться перевести веб-приложение в автономный режим во время изменения связанных компонентов, таких как базы данных или веб-служб. Как правило, в IIS и ASP.NET, это можно сделать, поместив в файл с именем *приложения\_offline.htm* в корневой папке веб-сайта или веб-приложение IIS. *Приложения\_offline.htm* файл стандартный HTML-файл, который обычно содержит простое сообщение о том, сайт временно недоступен из-за обслуживания. Хотя *приложения\_offline.htm* файл существует в корневой папке веб-сайта, службы IIS автоматически перенаправлять все запросы к файлу. После завершения обновления, удалите *приложения\_offline.htm* файлов и веб-сайт возобновляет работу как обычно обслуживает запросы.

При использовании веб-развертывания для выполнения автоматической или один шаг развертывания к целевой среде, может потребоваться включить Добавление и удаление *приложения\_offline.htm* файла в процесс развертывания. Чтобы сделать это, необходимо выполнить следующие высокоуровневые задачи:

- В файле проекта Microsoft Build Engine (MSBuild), используемой для управления процессом развертывания, создать целевой объект MSBuild, который копирует *приложения\_offline.htm* файл на целевой сервер перед любой задачи развертывания Начните.
- Добавьте другой целевой объект MSBuild, который удаляет *приложения\_offline.htm* файла на конечном сервере после завершения всех задач развертывания.
- В проект веб-приложения создайте *. wpp.targets* файл, который гарантирует, что *приложения\_offline.htm* файл добавляется в пакет развертывания, при вызове веб-развертывания.

В этом разделе будет показано, как для выполнения этих процедур. Задачи и пошаговые руководства в этом разделе предполагается, уже создали решение, содержащее хотя бы один проект веб-приложения и использовать для управления процессом развертывания, как описано в пользовательском файле проекта [веб-развертывания в Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md). Кроме того, можно использовать [диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) образец решения для понимания примеров в разделе.

## <a name="adding-an-appoffline-file-to-a-web-application-project"></a>Добавление приложения\_автономных файлов в проект веб-приложения

Первой задачи, необходимые для выполнения является добавление *приложения\_автономного* файл в проект веб-приложения:

- Для предотвращения конфликта в процессе разработки файла (требуется приложение постоянно находятся в автономном режиме), необходимо вызвать его что-то отличное от *приложения\_offline.htm*. Например, можно назвать файл *приложения\_автономного template.htm*.
- Чтобы предотвратить себя развернутым в качестве файла-является, необходимо задать действие построения **нет**.

**Чтобы добавить приложение\_автономных файлов в проект веб-приложения**

1. Откройте решение в Visual Studio 2010.
2. В **обозревателе решений** , щелкните правой кнопкой мыши проект веб-приложения, подведите указатель к **добавить**, а затем нажмите кнопку **новый элемент**.
3. В **Добавление нового элемента** выберите **HTML-страницу**.
4. В **имя** введите **приложения\_автономного template.htm**, а затем нажмите кнопку **добавить**.

    ![](taking-web-applications-offline-with-web-deploy/_static/image1.png)
5. Добавьте простой HTML-ФАЙЛ для информирования пользователей о том, что приложение является недоступным и затем сохраните файл. Не включайте все серверные теги (например, все теги, которые начинаются с префикса «asp:»). 

    ![](taking-web-applications-offline-with-web-deploy/_static/image2.png)
6. В **обозревателе решений** окно, щелкните правой кнопкой мыши новый файл и нажмите кнопку **свойства**.
7. В **свойства** окна в **действие при построении** строк, выберите **нет**.

    ![](taking-web-applications-offline-with-web-deploy/_static/image3.png)

## <a name="deploying-and-deleting-an-appoffline-file"></a>Развертывание и удаление приложения\_автономных файлов

Следующим шагом будет изменение логику развертывания, чтобы скопировать файл на целевой сервер в начале процесса развертывания и удалить его в конце.

> [!NOTE]
> В следующей процедуре предполагается, что вы используете пользовательского файла проекта MSBuild для управления процесс развертывания, как описано в [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md). Если вы развертываете прямой из Visual Studio, необходимо использовать другой подход. Sayed Ibrahim Hashimi описывает один такой подход в [занять ваш веб-приложения вне сети во время публикации как](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).


Для развертывания *приложения\_автономного* файла для целевой веб-сайт IIS, необходимо вызывать с помощью MSDeploy.exe [веб-развертывания **contentPath** поставщика](https://technet.microsoft.com/library/dd569034(WS.10).aspx). **ContentPath** поставщик поддерживает физический каталог пути и пути к веб-сайта или приложения IIS, что делает его идеальным выбором для синхронизации файлов между папки проекта Visual Studio и веб-приложение IIS. Для развертывания файла, команде MSDeploy должен выглядеть примерно следующим образом:


[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample1.cmd)]


Чтобы удалить файл из конечного сайта в конце процесса развертывания, команде MSDeploy должна выглядеть следующим образом:


[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample2.cmd)]


Чтобы автоматизировать эти команды в рамках процесса построения и развертывания, необходимо интегрировать их в пользовательский файл проекта MSBuild. Далее описано, как это сделать.

**Для развертывания и удалить приложение\_автономных файлов**

1. В Visual Studio 2010 откройте файл проекта MSBuild, управляющий процесс развертывания. В [диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) это образец решения *Publish.proj* файла.
2. В корне **проекта** элемент, создайте новый **PropertyGroup** элемента для хранения переменных для *приложения\_автономного* развертывания:

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample3.xml)]
3. **SourceRoot** свойства определен в другом месте в *Publish.proj* файла. Он указывает на расположение исходного содержимого относительно текущего пути & #x 2014; другими словами, относительно расположения в корневую папку *Publish.proj* файла.
4. **ContentPath** поставщик не будет принимать относительных путей к файлам, поэтому вам нужно получить абсолютный путь для файла исходного кода, прежде чем вы сможете развернуть его. Можно использовать [ConvertToAbsolutePath](https://msdn.microsoft.com/library/bb882668.aspx) задач для этого.
5. Добавьте новый **целевой** элемента с именем **GetAppOfflineAbsolutePath**. В этом целевом объекте, используйте **ConvertToAbsolutePath** задачи, чтобы получить абсолютный путь к *приложения\_автономного шаблона* файл в папке проекта.

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample4.xml)]
6. Этот целевой объект принимает относительный путь к *приложения\_автономного шаблона* файл в папку проекта и сохраняет его в новое свойство как абсолютный путь на диске. **BeforeTargets** атрибут указывает, что этот целевой объект для выполнения перед **DeployAppOffline** цели, которая создается в следующем шаге.
7. Добавить новый целевой объект с именем **DeployAppOffline**. В этот целевой объект вызова MSDeploy.exe команду, которая развертывает вашей *приложения\_автономного* файл на веб-сервере назначения.

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample5.xml)]
8. В этом примере **ContactManagerIisPath** свойства определен в другом месте в файле проекта. Это просто путь к приложению IIS, в виде *[имя веб-сайта IIS] / [имя приложения]*. Включая условие в целевом дает пользователям возможность переключения *приложения\_автономного* развертывания или отключить, изменив значение свойства или указать параметр командной строки.
9. Добавить новый целевой объект с именем **DeleteAppOffline**. В этот целевой объект вызова MSDeploy.exe команда, которая удаляет вашей *приложения\_автономного* файл веб-сервере назначения.

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample6.xml)]
10. Последняя задача заключается в вызове этих новых целевых объектов в соответствующие моменты во время выполнения файла проекта. Это можно сделать различными способами. Например, в *Publish.proj* файл **FullPublishDependsOn** свойство указывает список целевых объектов, которые должны быть выполнены в заказ при **FullPublish** по умолчанию вызывается целевой.
11. Изменить файл проекта MSBuild для вызова **DeployAppOffline** и **DeleteAppOffline** целевые объекты в соответствующие моменты в процесс публикации.

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample7.xml)]

При запуске пользовательского файла проекта MSBuild, *приложения\_автономного* будет развернут файл на сервер немедленно после успешного построения. Она затем удаляется с сервера после завершения всех задач по развертыванию.

## <a name="adding-an-appoffline-file-to-deployment-packages"></a>Добавление приложения\_автономных файлов для развертывания пакетов

Как и в зависимости от способа настройки развертывания, все существующее содержимое на веб-приложения IIS назначения & #x 2014; *приложения\_offline.htm* файл & #x 2014; могут быть удалены автоматически, при развертывании веб-узла пакет в место назначения. Чтобы убедиться, что *приложения\_offline.htm* файл сохраняется на время развертывания, необходимо включить файл внутри пакета веб-развертывания, сам в дополнение к развертыванию файл непосредственно в начале процесс развертывания.

- Если вы выполнили предыдущие задачи этого раздела, будут добавлены *приложения\_offline.htm* файл в проект веб-приложения в другое имя файла (мы использовали *приложения\_ автономный template.htm*) и будет задано действие построения **нет**. Эти изменения не требуются для предотвращения файл из мешают разработки и отладки. Поэтому необходимо настроить процесс упаковки, чтобы убедиться, что *приложения\_offline.htm* файл включен в пакет веб-развертывания.

Конвейер публикации Web (WPP) использует список элементов с именем **FilesForPackagingFromProject** для построения списка файлов, которые должны быть включены в пакет веб-развертывания. Содержимое вашего веб-пакеты можно настроить путем добавления собственных элементов в этот список. Чтобы сделать это, необходимо выполнить следующие общие действия:

1. Создайте файл пользовательский проект с именем *.wpp.targets [имя проекта]* в одной папке с файлом проекта.

    > [!NOTE]
    > *. Wpp.targets* файл необходимо перейти в той же папке, как ваш файл проекта веб-приложения & #x 2014; например, *ContactManager.Mvc.csproj*& #x 2014; а не в одной папке, что любой файлы проектов, используйте для управления построением и процесса развертывания.
2. В *. wpp.targets* создайте новый целевой объект MSBuild, который выполняет *перед* **CopyAllFilesToSingleFolderForPackage** цели. Это цель WPP, который создает список требований для включения в пакет.
3. Создайте в новый целевой **ItemGroup** элемента.
4. В **ItemGroup** элемента, добавьте **FilesForPackagingFromProject** элемент и указать *приложения\_offline.htm* файла.

*. Wpp.targets* файл должен выглядеть примерно следующим образом:


[!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample8.xml)]


Это ключевые моменты, которые нужно обратить внимание в данном примере:

- **BeforeTargets** атрибут вставляет этот целевой объект в конвейере публикации в Интернете, указав, который должен быть выполнен непосредственно перед **CopyAllFilesToSingleFolderForPackage** цели.
- **FilesForPackagingFromProject** элемента использует **DestinationRelativePath** значение метаданных для переименования файла из *приложения\_автономного template.htm* Чтобы *приложения\_offline.htm* , добавляемой в список.

Следующей процедуре показано, как добавить *. wpp.targets* файл в проект веб-приложения.

**Чтобы добавить. файл wpp.targets пакет веб-развертывания**

1. Откройте решение в Visual Studio 2010.
2. В **обозревателе решений** окно, щелкните правой кнопкой мыши узел проекта приложения web (например, **ContactManager.Mvc**), пункты **добавить**и нажмите кнопку **Новый элемент**.
3. В **Добавление нового элемента** выберите **XML-файл** шаблона.
4. В **имя** введите *[имя проекта] ***.wpp.targets** (например, **ContactManager.Mvc.wpp.targets**), а затем нажмите кнопку **добавить**.

    ![](taking-web-applications-offline-with-web-deploy/_static/image4.png)

    > [!NOTE]
    > При добавлении нового элемента на корневой узел проекта, файл создается в той же папке, что и файл проекта. Это можно проверить, перейдите в папку в проводнике Windows.
5. В файле добавьте разметку MSBuild, описанных выше.

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample9.xml)]
6. Сохраните и закройте *.wpp.targets [имя проекта]* файл.

При повторном сборки и пакет проекта веб-приложения, WPP автоматически обнаруживает *. wpp.targets* файл. *Приложения\_автономного template.htm* файла будут включены в результирующий пакет веб-развертывания как *приложения\_offline.htm*.

> [!NOTE]
> В случае развертывания *приложения\_offline.htm* файл останется на месте, и приложение останется вне сети. Обычно это приемлемо. Чтобы перевести приложение обратно в оперативный режим, можно удалить *приложения\_offline.htm* файла из веб-сервера. Кроме того, если исправить все ошибки и выполнить успешное развертывание *приложения\_offline.htm* файл будет удален.


## <a name="conclusion"></a>Заключение

В этом разделе описано, как использовать веб-приложении автономный режим на время развертывания, путем публикации *приложения\_offline.htm* файл на целевой сервер в начале процесса развертывания и удаления его в параметре Окончание. Он также рассказывается, как включать *приложения\_offline.htm* файл в пакет веб-развертывания.

## <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения об упаковке и развертывании процесса см. в разделе [построения и упаковки проектов веб-приложений](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [Настройка параметров для пакета развертывания веб-](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md), и [ Развертывание веб-пакеты](../web-deployment-in-the-enterprise/deploying-web-packages.md).

При публикации веб-приложений непосредственно из Visual Studio, а не с помощью пользовательских MSBuild проекта файл подход, описанный в этих учебниках, необходимо использовать немного другой подход, чтобы приложение перевести в автономный режим во время публикации процесс. Дополнительные сведения см. в разделе [как можно использовать веб-приложение в автономный режим во время публикации](https://go.microsoft.com/?linkid=9805135) (запись блога).

>[!div class="step-by-step"]
[Назад](excluding-files-and-folders-from-deployment.md)
[Вперед](running-windows-powershell-scripts-from-msbuild-project-files.md)
