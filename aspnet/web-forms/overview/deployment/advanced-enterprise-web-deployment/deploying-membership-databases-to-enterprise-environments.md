---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments
title: Развертывание баз данных членства в корпоративных средах | Документы Microsoft
author: jrjlee
description: В этом разделе описываются основные рекомендации и проверок, которые необходимо преодолеть при подготовке базы данных служб приложения ASP.NET (чаще...
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/04/2012
ms.topic: article
ms.assetid: 3cf765df-d311-4f68-a295-c9685ceea830
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments
msc.type: authoredcontent
ms.openlocfilehash: b783fcf57759f2a431480eec6902105f6d683408
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="deploying-membership-databases-to-enterprise-environments"></a><span data-ttu-id="c6d07-103">Развертывание баз данных членства в корпоративных средах</span><span class="sxs-lookup"><span data-stu-id="c6d07-103">Deploying Membership Databases to Enterprise Environments</span></span>
====================
<span data-ttu-id="c6d07-104">по [Джейсон Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="c6d07-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="c6d07-105">Скачать PDF</span><span class="sxs-lookup"><span data-stu-id="c6d07-105">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="c6d07-106">В этом разделе описываются основные рекомендации и проблем, с которой необходимо преодолеть при базы данных (более часто называют членства баз данных) в тестовой, промежуточной или производственной среде служб подготовки приложения ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c6d07-106">This topic explains the key considerations and challenges you'll need to overcome when you provision ASP.NET application services databases (more commonly referred to as membership databases) in test, staging, or production environments.</span></span> <span data-ttu-id="c6d07-107">Он также описывает подходов, которые можно использовать для выполнения этих задач.</span><span class="sxs-lookup"><span data-stu-id="c6d07-107">It also describes approaches you can use to meet these challenges.</span></span>


<span data-ttu-id="c6d07-108">Этот раздел входит в состав серию учебников, исходя из требования к развертыванию enterprise вымышленная компания Fabrikam, Inc. Этот учебник ряд использует образец решения&#x2014; [решения диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;для представления веб-приложения с реалистичных уровень сложности, включая приложения ASP.NET MVC 3, Windows Communication Служба Foundation (WCF) и проект базы данных.</span><span class="sxs-lookup"><span data-stu-id="c6d07-108">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="c6d07-109">Метод развертывания, в основе этих учебников основан на разбиение проекта файл подход, описанный в [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), в которой процесс построения управляется двух файлов проекта&#x2014;один с построение инструкции, которые применяются для каждой целевой среде и, содержащий параметры построения и развертывания конкретной среды.</span><span class="sxs-lookup"><span data-stu-id="c6d07-109">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="c6d07-110">Во время построения файла проекта среды объединяется в файл проекта зависит от среды, образуют полный набор инструкций построения.</span><span class="sxs-lookup"><span data-stu-id="c6d07-110">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="what-are-the-issues-when-you-deploy-a-membership-database"></a><span data-ttu-id="c6d07-111">При развертывании базы данных членства с какими проблемами?</span><span class="sxs-lookup"><span data-stu-id="c6d07-111">What Are the Issues When You Deploy a Membership Database?</span></span>

<span data-ttu-id="c6d07-112">В большинстве случаев при разработке стратегии развертывания для базы данных, необходимо принимать во внимание в первую очередь является данных вы хотите развернуть.</span><span class="sxs-lookup"><span data-stu-id="c6d07-112">In most cases, when you devise a deployment strategy for a database, the first thing you need to consider is what data you want to deploy.</span></span> <span data-ttu-id="c6d07-113">В среде разработки или тестирования может потребоваться развернуть данных учетных записей пользователей для тестирования быстро и удобно.</span><span class="sxs-lookup"><span data-stu-id="c6d07-113">In a development or test environment, you might want to deploy user account data to facilitate quick and easy testing.</span></span> <span data-ttu-id="c6d07-114">В промежуточной или рабочей среде в крайне редких случаях может потребоваться развернуть данные учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="c6d07-114">In a staging or production environment, it's very unlikely that you'd want to deploy user account data.</span></span>

<span data-ttu-id="c6d07-115">К сожалению базы данных членства ASP.NET представляют некоторые определенные проблемы, которые при принятии гораздо сложнее.</span><span class="sxs-lookup"><span data-stu-id="c6d07-115">Unfortunately, ASP.NET membership databases introduce some specific challenges that make this decision a lot more complex:</span></span>

- <span data-ttu-id="c6d07-116">Только схема развертывания будет оставить базу данных членства в нерабочем состоянии.</span><span class="sxs-lookup"><span data-stu-id="c6d07-116">A schema-only deployment will leave the membership database in a non-operational state.</span></span> <span data-ttu-id="c6d07-117">Это, поскольку база данных членства включает в себя некоторые данные конфигурации (в **aspnet\_SchemaVersions** таблицы), необходимый для своей работы в базе данных.</span><span class="sxs-lookup"><span data-stu-id="c6d07-117">This is because the membership database includes some configuration data (in the **aspnet\_SchemaVersions** table) that the database requires in order to function.</span></span> <span data-ttu-id="c6d07-118">Таким образом Если выполнить развертывание только со схемой базы данных членства для исключения данных учетной записи пользователя, необходимо выполнить скрипт после развертывания для добавления данных обязательной настройки.</span><span class="sxs-lookup"><span data-stu-id="c6d07-118">As such, if you perform a schema-only deployment of your membership database in order to exclude user account data, you'll need to run a post-deployment script to add the essential configuration data.</span></span>
- <span data-ttu-id="c6d07-119">В зависимости от настроек базы данных членства поставщик может использовать ключ компьютера для шифрования паролей и сохранять их в базе данных.</span><span class="sxs-lookup"><span data-stu-id="c6d07-119">Depending on how your membership database is configured, the membership provider may use the machine key to encrypt passwords and store them in the database.</span></span> <span data-ttu-id="c6d07-120">В этом случае данные учетных записей пользователей, развертываемого с базой данных, станет недоступным для использования на конечном сервере.</span><span class="sxs-lookup"><span data-stu-id="c6d07-120">In this case, any user account data you deploy with the database will become unusable on the destination server.</span></span> <span data-ttu-id="c6d07-121">По этой причине развертывание данных учетных записей пользователей не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="c6d07-121">For this reason, deploying user account data is not a supported scenario.</span></span>

## <a name="choosing-a-membership-database-strategy"></a><span data-ttu-id="c6d07-122">Выбор стратегии базы данных членства</span><span class="sxs-lookup"><span data-stu-id="c6d07-122">Choosing a Membership Database Strategy</span></span>

<span data-ttu-id="c6d07-123">Используйте следующие рекомендации при подготовке базы данных членства в корпоративной среде сервера:</span><span class="sxs-lookup"><span data-stu-id="c6d07-123">Use these guidelines when you choose how to provision a membership database in an enterprise server environment:</span></span>

- <span data-ttu-id="c6d07-124">Везде, где это возможно, не развертывание базы данных членства.</span><span class="sxs-lookup"><span data-stu-id="c6d07-124">Wherever possible, do not deploy membership databases.</span></span> <span data-ttu-id="c6d07-125">Создайте базу данных членства вручную на целевом сервере базы данных.</span><span class="sxs-lookup"><span data-stu-id="c6d07-125">Instead, create the membership database manually on the target database server.</span></span> <span data-ttu-id="c6d07-126">Если вы не настроили схему базы данных членства, можно просто создать новую в situ по назначения с использованием [средство регистрации SQL Server ASP.NET (aspnet\_regsql.exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx).</span><span class="sxs-lookup"><span data-stu-id="c6d07-126">If you haven't customized your membership database schema, you can simply create a new one in situ at the destination using the [ASP.NET SQL Server Registration Tool (aspnet\_regsql.exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx).</span></span>
- <span data-ttu-id="c6d07-127">Если у вас нет, но чтобы развернуть базу данных членства&#x2014;к примеру, если вы внесли расширенные изменения в схему базы данных&#x2014;следует выполнить развертывание только со схемой базы данных членства, чтобы исключить данные учетной записи пользователя, а затем После развертывания скрипт для добавления данных любой требуемой конфигурации.</span><span class="sxs-lookup"><span data-stu-id="c6d07-127">If you have no option but to deploy a membership database&#x2014;for example, if you've made extensive modifications to the database schema&#x2014;you should perform a schema-only deployment of the membership database, to exclude user account data, and then run a post-deployment script to add any required configuration data.</span></span> <span data-ttu-id="c6d07-128">Широкие инструкции можно найти на этих способов [как: развертывание ASP.NET членства базы данных без включая учетные записи пользователей](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).</span><span class="sxs-lookup"><span data-stu-id="c6d07-128">You can find broad guidance on these approaches in [How to: Deploy the ASP.NET Membership Database Without Including User Accounts](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).</span></span>

<span data-ttu-id="c6d07-129">Важно помнить, что *схемы базы данных членства может оказаться довольно статические вероятнее*.</span><span class="sxs-lookup"><span data-stu-id="c6d07-129">It's important to remember that *the schema of your membership database is likely to be fairly static*.</span></span> <span data-ttu-id="c6d07-130">Даже если вы настроили базы данных членства, маловероятно, что вам потребуется обновить схему на регулярной основе&#x2014;он не будет изменяться с такой же частотой, как код в веб-приложение или проект базы данных.</span><span class="sxs-lookup"><span data-stu-id="c6d07-130">Even if you've customized the membership database, it's unlikely that you'll need to update the schema on a regular basis&#x2014;it's not going to change with the same frequency as the code in a web application or a database project.</span></span> <span data-ttu-id="c6d07-131">Не следует таким образом, необходимо включить в любой процессов автоматической или один шаг развертывания базы данных членства.</span><span class="sxs-lookup"><span data-stu-id="c6d07-131">As such, you shouldn't need to include the membership database in any automated or single-step deployment processes.</span></span>

## <a name="using-vsdbcmd-to-update-a-membership-database-schema"></a><span data-ttu-id="c6d07-132">С помощью VSDBCMD, чтобы обновить схему базы данных членства</span><span class="sxs-lookup"><span data-stu-id="c6d07-132">Using VSDBCMD to Update a Membership Database Schema</span></span>

<span data-ttu-id="c6d07-133">При изменении структуры базы данных членства после первого развертывания, можно не использовать средство Internet Information Services (IIS) веб-развертывания (Web Deploy) для повторного развертывания базы данных.</span><span class="sxs-lookup"><span data-stu-id="c6d07-133">If you modify the structure of your membership database after your first deployment, you may not want to use the Internet Information Services (IIS) Web Deployment Tool (Web Deploy) to redeploy the database.</span></span> <span data-ttu-id="c6d07-134">Функциональность развертывания базы данных в веб-развертывание не включает возможность сделать разностные обновления в целевую базу данных&#x2014;вместо этого веб-развертывания необходимо удалить и воссоздать базу данных.</span><span class="sxs-lookup"><span data-stu-id="c6d07-134">The database deployment functionality in Web Deploy doesn't include the capability to make differential updates to a destination database&#x2014;instead, Web Deploy must drop and re-create the database.</span></span> <span data-ttu-id="c6d07-135">Это означает, что вы потеряны все существующие данные учетной записи пользователя, обычно нежелательных в промежуточной или рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="c6d07-135">This means that you lose any existing user account data, which is typically undesirable in staging or production environments.</span></span>

<span data-ttu-id="c6d07-136">Альтернативой является использование служебную программу VSDBCMD для обновления схемы целевой базы данных.</span><span class="sxs-lookup"><span data-stu-id="c6d07-136">The alternative is to use the VSDBCMD utility to update the schema of your destination database.</span></span> <span data-ttu-id="c6d07-137">VSDBCMD включает две важные возможности.</span><span class="sxs-lookup"><span data-stu-id="c6d07-137">VSDBCMD includes two important capabilities.</span></span> <span data-ttu-id="c6d07-138">Во-первых его можно импортировать схему из существующей базы данных в файл DBSCHEMA.</span><span class="sxs-lookup"><span data-stu-id="c6d07-138">First, it can import the schema of an existing database into a .dbschema file.</span></span> <span data-ttu-id="c6d07-139">Во-вторых его можно развернуть файл DBSCHEMA существующую базу данных как разностные обновления, это означает, что упрощает изменений, необходимых для приведения целевой базы данных в актуальном состоянии, и все данные не потеряны.</span><span class="sxs-lookup"><span data-stu-id="c6d07-139">Second, it can deploy a .dbschema file to an existing database as a differential update, which means that it only makes the changes required to bring the target database up to date and you don't lose any data.</span></span>

<span data-ttu-id="c6d07-140">Чтобы обновить схему базы данных членства можно использовать следующие общие действия:</span><span class="sxs-lookup"><span data-stu-id="c6d07-140">You can use these high-level steps to update a membership database schema:</span></span>

1. <span data-ttu-id="c6d07-141">Использование инструмента VSDBCMD **импорта** действия для создания DBSCHEMA-файл для исходной базы данных членства.</span><span class="sxs-lookup"><span data-stu-id="c6d07-141">Use the VSDBCMD **Import** action to generate a .dbschema file for your source membership database.</span></span> <span data-ttu-id="c6d07-142">Эта процедура описана в [как: Импорт схемы из командной строки](https://msdn.microsoft.com/library/dd172135.aspx).</span><span class="sxs-lookup"><span data-stu-id="c6d07-142">This procedure is described in [How to: Import a Schema from a Command Prompt](https://msdn.microsoft.com/library/dd172135.aspx).</span></span>
2. <span data-ttu-id="c6d07-143">Использование инструмента VSDBCMD **развернуть** действия для развертывания DBSCHEMA-файл на целевой базы данных членства.</span><span class="sxs-lookup"><span data-stu-id="c6d07-143">Use the VSDBCMD **Deploy** action to deploy the .dbschema file to your destination membership database.</span></span> <span data-ttu-id="c6d07-144">Эта процедура описана в [Справочник по командной строке для VSDBCMD. EXE (развертывание и импорт схемы)](https://msdn.microsoft.com/library/dd193283.aspx).</span><span class="sxs-lookup"><span data-stu-id="c6d07-144">This procedure is described in [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx).</span></span>

## <a name="conclusion"></a><span data-ttu-id="c6d07-145">Заключение</span><span class="sxs-lookup"><span data-stu-id="c6d07-145">Conclusion</span></span>

<span data-ttu-id="c6d07-146">В этом разделе описываются некоторые проблемы, которые могут возникнуть, когда необходимо подготовить базы данных членства ASP.NET в различных целевых средах.</span><span class="sxs-lookup"><span data-stu-id="c6d07-146">This topic described some of the challenges you may face when you need to provision ASP.NET membership databases in various target environments.</span></span> <span data-ttu-id="c6d07-147">В частности объясняется, почему оставить только схема развертывания базы данных членства в нерабочем состоянии и почему развертывание данных учетных записей пользователей не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="c6d07-147">In particular, it explained why schema-only deployments will leave the membership database in a non-operational state and why deploying user account data is not supported.</span></span> <span data-ttu-id="c6d07-148">Раздел также предоставляются инструкции о том, как подготовить, развертывание и обновление баз данных членства в различных сценариях.</span><span class="sxs-lookup"><span data-stu-id="c6d07-148">The topic also presented guidance on how to provision, deploy, and update membership databases in different scenarios.</span></span>

## <a name="further-reading"></a><span data-ttu-id="c6d07-149">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="c6d07-149">Further Reading</span></span>

<span data-ttu-id="c6d07-150">Дополнительные рекомендации и примеры использования VSDBCMD см. в разделе [Справочник по командной строке для VSDBCMD. EXE (развертывание и импорт схемы)](https://msdn.microsoft.com/library/dd193283.aspx) и [как: Импорт схемы из командной строки](https://msdn.microsoft.com/library/dd172135.aspx).</span><span class="sxs-lookup"><span data-stu-id="c6d07-150">For more guidance and examples of how to use VSDBCMD, see [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx) and [How to: Import a Schema from a Command Prompt](https://msdn.microsoft.com/library/dd172135.aspx).</span></span> <span data-ttu-id="c6d07-151">Дополнительные сведения об использовании aspnet\_regsql.exe для создания баз данных членства, в разделе [средство регистрации SQL Server ASP.NET (aspnet\_regsql.exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx).</span><span class="sxs-lookup"><span data-stu-id="c6d07-151">For more information on using aspnet\_regsql.exe to create membership databases, see [ASP.NET SQL Server Registration Tool (aspnet\_regsql.exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx).</span></span> <span data-ttu-id="c6d07-152">Дополнительные общие рекомендации по развертыванию базы данных членства. в разделе [как: развертывание ASP.NET членства базы данных без включая учетные записи пользователей](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).</span><span class="sxs-lookup"><span data-stu-id="c6d07-152">For more general guidance on deploying membership databases, see [How to: Deploy the ASP.NET Membership Database Without Including User Accounts](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c6d07-153">[Назад](deploying-database-role-memberships-to-test-environments.md)
> [Вперед](excluding-files-and-folders-from-deployment.md)</span><span class="sxs-lookup"><span data-stu-id="c6d07-153">[Previous](deploying-database-role-memberships-to-test-environments.md)
[Next](excluding-files-and-folders-from-deployment.md)</span></span>
