---
uid: web-forms/overview/deployment/configuring-team-foundation-server-for-web-deployment/creating-a-build-definition-that-supports-deployment
title: Создание определения построения, поддерживающего развертывание | Документы Microsoft
author: jrjlee
description: Если вы хотите выполнять любой вид сборки в Team Foundation Server (TFS) 2010, необходимо создать определение построения в пределах командного проекта. Это статье des...
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/04/2012
ms.topic: article
ms.assetid: fe47a018-f6d0-4979-80e7-5b1fa75a5865
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/deployment/configuring-team-foundation-server-for-web-deployment/creating-a-build-definition-that-supports-deployment
msc.type: authoredcontent
ms.openlocfilehash: c5ea0bd9f01bb57b96abd349741f304c0093d887
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/10/2018
ms.locfileid: "30880366"
---
<a name="creating-a-build-definition-that-supports-deployment"></a>Создание определения построения, поддерживающего развертывание
====================
по [Джейсон Lee](https://github.com/jrjlee)

[Скачать PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> Если вы хотите выполнять любой вид сборки в Team Foundation Server (TFS) 2010, необходимо создать определение построения в пределах командного проекта. В этом разделе описывается, как создать новое определение сборки в TFS и как управлять веб-развертывания в рамках процесса сборки в Team Build.


Этот раздел входит в состав серию учебников, исходя из требования к развертыванию enterprise вымышленная компания Fabrikam, Inc. Этот учебник ряд использует образец решения&#x2014; [решения диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;для представления веб-приложения с реалистичных уровень сложности, включая приложения ASP.NET MVC 3, Windows Communication Служба Foundation (WCF) и проект базы данных.

Метод развертывания, в основе этих учебников основан на разбиение проекта файл подход, описанный в [основные сведения о файле проекта](../web-deployment-in-the-enterprise/understanding-the-project-file.md), в которой процесс построения и развертывания управляется двух файлов проекта&#x2014;один содержащий инструкции сборки, которые применяются для каждой целевой среде и, содержащий параметры построения и развертывания конкретной среды. Во время построения файла проекта среды объединяется в файл проекта зависит от среды, образуют полный набор инструкций построения.

## <a name="task-overview"></a>Общие сведения о задаче

Определение сборки — это механизм, которое определяет, как и когда построения выполняются для командных проектов в TFS. Указывает определения сборки:

- Задачи, которые требуется выполнить сборку, такие как файлы решения Visual Studio или пользовательские файлы проекта Microsoft Build Engine (MSBuild).
- Условия, которые определяют, когда необходимо выполнить сборку или кавычки, как вручную триггеры, непрерывной интеграции (CI) или проверкой.
- Расположение, в котором Team Build должны отправлять выходные данные сборки, включая развертывание артефактов, например веб-пакетов и скриптов базы данных.
- Количество времени, должны сохраняться каждой сборки.
- Различные другие параметры процесса построения.

> [!NOTE]
> Дополнительные сведения о определений сборки см. в разделе [определить процедуру сборки](https://msdn.microsoft.com/library/ms181715.aspx).


В этом разделе показано, как создать определение сборки, которое использует CI, чтобы сборки запускается в том случае, когда разработчик возвращает в новое содержимое. В случае успешного построения, запущена служба построения пользовательском файле проекта для развертывания решения в тестовой среде.

Если запустить сборку, эти действия должно произойти:

- Во-первых Team Build необходимо построить решение. В рамках этого процесса Team Build будет вызывать конвейера публикации Web (WPP) для создания пакетов веб-развертывания для каждого из проектов веб-приложений в решении. Team Build будет также выполняться все модульные тесты, связанные с решением.
- При сбое построения решений, Team Build займет никаких дополнительных действий. Сбоев модульных тестов должны рассматриваться как сбой сборки.
- В случае успешного построения решения, Team Build выполняйте файле пользовательского проекта, управляющий развертывания решения. В рамках этого процесса Team Build будет вызывать средство Internet Information Services (IIS) веб-развертывания (Web Deploy) для установки упакованных веб-приложений на веб-серверах назначения, и она вызывает служебную программу VSDBCMD.exe, чтобы запустить процесс создания базы данных сценарии на целевых серверах базы данных.

Это показывает процесс:

![](creating-a-build-definition-that-supports-deployment/_static/image1.png)

[Диспетчера контактов](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) образец решения включает в себя пользовательского файла проекта MSBuild *Publish.proj*, который можно запустить из MSBuild или Team Build. Как описано в [основные сведения о процессе сборки](../web-deployment-in-the-enterprise/understanding-the-build-process.md), этот файл проекта определяет логику, которая развертывает веб-пакетов и баз данных в целевой среде. Файл содержит логику, которая пропускает построения и обработки пакетов, если он выполняется в Team Build, оставляя только задачи развертывания для запуска. Это потому, что при автоматизации развертывания таким образом, обычно имеет смысл убедиться, что сборка решения выполняется успешно и передает все модульные тесты, прежде чем начнется процесс развертывания.

В следующем разделе показано, как реализовать этот процесс, создав новое определение сборки.

> [!NOTE]
> Эта процедура&#x2014;в которой один автоматических процесса построения, проверяет и развертывание решения&#x2014;будет наиболее подходит для развертывания в тестовую среду. Для промежуточной и производственной средах вы более обычно требуется развернуть содержимое из предыдущего построения, которое уже проверены и проверить в тестовой среде. Этот подход описан в следующем разделе [развертывание определенной сборки](deploying-a-specific-build.md).


### <a name="who-performs-this-procedure"></a>Кто выполняет эту процедуру?

Как правило администратор TFS выполняет эту процедуру. В некоторых случаях руководитель группы разработчиков может отвечать за коллекции командных проектов в TFS. Чтобы создать новое определение сборки, необходимо быть членом группы **Администраторы построения коллекций проектов** для коллекции командных проектов, содержащая решение.

## <a name="create-a-build-definition-for-ci-and-deployment"></a>Создание определения построения для непрерывной Интеграции и развертывания

Далее описано, как для создания определения построения, которое запускает CI. В случае успешного построения, развертывания решения с помощью логики в пользовательский файл проекта MSBuild.

**Чтобы создать определение построения для непрерывной Интеграции и развертывания**

1. В Visual Studio 2010 в **Team Explorer** окна, разверните узел командного проекта, щелкните правой кнопкой мыши **строит**, а затем нажмите кнопку **создать определение построения**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image2.png)
2. На **Общие** вкладки, присвойте имя определения сборки (например, **DeployToTest**) и необязательное описание.
3. На **триггер** выберите условия, в которых требуется запускают новую сборку. Например, если необходимо построить и развернуть в среде тестирования каждый раз, разработчик возвращает в новом коде, выберите **непрерывной интеграции**.
4. На **сборки по умолчанию** вкладке **Копировать выходные данные построения в следующую папку сброса** введите путь к папке сброса соглашения об универсальных именах (UNC) (например,  **\\TFSBUILD\Drops**).

    ![](creating-a-build-definition-that-supports-deployment/_static/image3.png)

    > [!NOTE]
    > Это расположение сброса хранит несколько сборок, в зависимости от настроенной политики хранения. Если вы хотите опубликовать артефакты развертывания из конкретной сборки в промежуточной или рабочей среде, это где их можно найти.
5. На **процесс** вкладке **файл процесса построения** раскрывающегося списка, оставьте **DefaultTemplate.xaml** выбранных. Это один из шаблонов процесса сборки по умолчанию, которые добавляются в новые командные проекты.
6. В **параметры процесса построения** таблицы, нажмите кнопку в **элементы для построения** , а затем нажмите **многоточие** кнопки.

    ![](creating-a-build-definition-that-supports-deployment/_static/image4.png)
7. В **элементы для построения** диалоговое окно, нажмите кнопку **добавить**.
8. Перейдите к нужному файл решения и нажмите кнопку **ОК**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image5.png)
9. В **элементы для построения** диалоговое окно, нажмите кнопку **добавить**.
10. В **элементы типа** раскрывающегося списка выберите **файлы проекта MSBuild**.
11. Перейдите к нужному файлу пользовательского проекта с помощью которого контролировать процесс развертывания, выберите файл и нажмите кнопку **ОК**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image6.png)
12. **Элементы для построения** диалоговое окно появляются два элемента. Нажмите кнопку **ОК**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image7.png)
13. На **процесс** вкладке **параметры процесса построения** таблица, разверните **Дополнительно** раздела.
14. В **Аргументы MSBuild** строк, добавьте все аргументы командной строки MSBuild, *либо* элементов для построения требуется. В сценарии решения диспетчера контактов эти аргументы не требуются:

    [!code-console[Main](creating-a-build-definition-that-supports-deployment/samples/sample1.cmd)]

    ![](creating-a-build-definition-that-supports-deployment/_static/image8.png)
15. В этом примере:

    1. **DeployOnBuild = true** и **DeployTarget = пакет** аргументы являются обязательными при построении решения диспетчера контактов. Это указывает, что MSBuild для создания веб-развертывания пакетов после построения проекта каждого веб-приложения, как описано в [построения и упаковки проектов веб-приложений](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md).
    2. **TargetEnvPropsFile** аргумент является обязательным при построении *Publish.proj* файла. Это свойство указывает расположение файла конфигурации, относящиеся к среде, как описано в [основные сведения о процессе построения](../web-deployment-in-the-enterprise/understanding-the-build-process.md).
16. На **политики хранения** настройте количество построений с результатами каждого типа, необходимо сохранить в соответствии с требованиями.
17. Нажмите кнопку **Сохранить**.

## <a name="queue-a-build"></a>Помещение построения в очередь

На этом этапе вы создали по крайней мере одного нового определения построения. Процесс построения, заданные теперь будет выполняться в соответствии с триггеры, указанный в определении сборки.

Если вы настроили определение сборки для использования элемента конфигурации, можно проверить определение сборки двумя способами:

- Проверка некоторое содержимое в командный проект, чтобы запустить автоматическую сборку.
- Помещение построения в очередь вручную.

**Построение в очередь вручную**

1. В **Team Explorer** окно, щелкните правой кнопкой мыши определение построения и нажмите кнопку **новую сборку в очередь**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image9.png)
2. В **поставить в очередь построение** диалоговое окно, просмотрите свойства построения и нажмите кнопку **очереди**.

    ![](creating-a-build-definition-that-supports-deployment/_static/image10.png)

Чтобы просмотреть ход выполнения и результат сборки&#x2014;независимо от того, является ли оно было запущено вручную или автоматически&#x2014;дважды щелкните определение построения в **Team Explorer** окна. После этого откроется **Обозреватель построений** вкладки.

![](creating-a-build-definition-that-supports-deployment/_static/image11.png)

Здесь вы можете устранить сбоям сборок. Если дважды щелкнуть отдельные сборки, можно просмотреть сводные данные и просмотрите подробные журналы.

![](creating-a-build-definition-that-supports-deployment/_static/image12.png)

Эти сведения можно использовать для устранения неполадок сбоям сборок и решить проблемы, прежде чем другой сборки.

> [!NOTE]
> Сборки, выполнения логики развертывания, могут завершаться сбоем, пока сервер сборки был предоставлен все разрешения, необходимые в целевой среде. Дополнительные сведения см. в разделе [Настройка разрешений для развертывания сборки Team](configuring-permissions-for-team-build-deployment.md).


## <a name="monitor-the-build-process"></a>Монитор процесса построения

TFS предоставляет широкий набор функций для мониторинга процесса построения. Например TFS можно отправить вам сообщение электронной почты или отображения предупреждения в области уведомлений на панели задач после завершения построения. Дополнительные сведения см. в разделе [выполнения и отслеживания построений](https://msdn.microsoft.com/library/ms181721.aspx).

## <a name="conclusion"></a>Заключение

В этом разделе описано, как создать определение сборки в TFS. Определение сборки настроен для элементов конфигурации, поэтому каждый раз, когда разработчик возвращает в содержимом для командного проекта запускается процесс построения. Определение построения выполняет пользовательского файла проекта MSBuild для развертывания веб-пакетов и скриптов базы данных сервера к целевой среде.

В порядке для автоматизированного развертывания для успешного выполнения в рамках процесса построения необходимо будет предоставить соответствующие разрешения для учетной записи службы построения на целевой веб-серверов и целевым сервером базы данных. В последнем разделе этого учебника [Настройка разрешений для развертывания сборки Team](configuring-permissions-for-team-build-deployment.md), описывает, как определить и настроить разрешения, необходимые для автоматического развертывания с сервера Team Build.

## <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения о создании определений сборки см. в разделе [создание базового определения сборки](https://msdn.microsoft.com/library/ms181716.aspx) и [определить процедуру сборки](https://msdn.microsoft.com/library/ms181715.aspx). Дополнительные рекомендации по очереди сборок см. в разделе [очередь сборку](https://msdn.microsoft.com/library/ms181722.aspx).

> [!div class="step-by-step"]
> [Назад](configuring-a-tfs-build-server-for-web-deployment.md)
> [Вперед](deploying-a-specific-build.md)
