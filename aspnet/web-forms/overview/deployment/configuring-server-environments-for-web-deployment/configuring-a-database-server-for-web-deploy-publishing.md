---
uid: web-forms/overview/deployment/configuring-server-environments-for-web-deployment/configuring-a-database-server-for-web-deploy-publishing
title: Настройка сервера базы данных для веб-развертывания публикации | Документы Microsoft
author: jrjlee
description: В этом разделе описывается настройка сервера базы данных SQL Server 2008 R2 для поддержки веб-развертывания и публикации. Задачи, описанные в этом разделе, co...
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/04/2012
ms.topic: article
ms.assetid: e7c447f9-eddf-4bbe-9f18-3326d965d093
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/deployment/configuring-server-environments-for-web-deployment/configuring-a-database-server-for-web-deploy-publishing
msc.type: authoredcontent
ms.openlocfilehash: a2340c0d561ed274e281b5f6d942af0a2027315a
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="configuring-a-database-server-for-web-deploy-publishing"></a>Настройка сервера базы данных для публикации веб-развертывания
====================
по [Джейсон Lee](https://github.com/jrjlee)

[Скачать PDF](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> В этом разделе описывается настройка сервера базы данных SQL Server 2008 R2 для поддержки веб-развертывания и публикации.
> 
> Задачи, описанные в этом разделе относятся к каждому варианту развертывания&#x2014;не имеет значения, является ли ваш веб-серверы настроены для использования удаленной службы агента средство веб-развертывания (Web Deploy) IIS, веб-развертывания обработчик или автономное развертывание или приложение выполняется на одном веб-сервере или ферме серверов. Способ развертывания базы данных могут меняться для разных требований к безопасности и другие вопросы. Например может развернуть базу данных с или без образец данных и может развернуть сопоставлений ролей пользователей или настроить вручную после развертывания. Однако способ настройки сервера базы данных не изменится.


Не нужно устанавливать дополнительные продукты или средства настройки сервера базы данных для поддержки веб-развертывания. Предположим, что сервер базы данных и веб-сервере работают на разных компьютерах, необходимо просто:

- Разрешения SQL Server обмениваться данными с использованием протокола TCP/IP.
- Разрешите трафик SQL Server через все имеющиеся брандмауэры.
- Предоставьте учетную запись компьютера сервера web имени входа SQL Server.
- Сопоставьте имя входа учетной записи машины любые роли базы данных.
- Предоставьте учетной записи, которая будет выполняться развертывание SQL Server имя входа и разрешения базы данных создатель.
- Для поддержки повторных развертываний, сопоставить имя входа учетной записи развертывания для **db\_владельца** роли базы данных.

В этом разделе будет показано, как для выполнения каждой из этих процедур. Задачи и пошаговые руководства в этом разделе предполагается, вы начинаете с экземпляром по умолчанию SQL Server 2008 R2 на Windows Server 2008 R2. Прежде чем продолжить, убедитесь, что:

- Windows Server 2008 R2 с пакетом обновления 1 и все доступные обновления установлены.
- Сервер присоединен к домену.
- Сервер имеет статический IP-адрес.
- SQL Server 2008 R2 с пакетом обновления 1 и все доступные обновления установлены.

Экземпляр SQL Server требуется только включить **службы компонента Database Engine** роль, которая автоматически включается в любой установки SQL Server. Однако для упрощения настройки и обслуживания, мы рекомендуем включать **основные средства управления** и **средства управления — полный** ролей сервера.

> [!NOTE]
> Дополнительные сведения о присоединении к домену компьютеров см. в разделе [присоединение компьютеров к домену и вход](https://technet.microsoft.com/library/cc725618(v=WS.10).aspx). Дополнительные сведения о настройке статических IP-адресов см. в разделе [настроить статический IP-адрес](https://technet.microsoft.com/library/cc754203(v=ws.10).aspx). Дополнительные сведения об установке SQL Server см. в разделе [Установка SQL Server 2008 R2](https://technet.microsoft.com/library/bb500395.aspx).


## <a name="enable-remote-access-to-sql-server"></a>Включить удаленный доступ к SQL Server

SQL Server использует TCP/IP для взаимодействия с удаленными компьютерами. Если сервер базы данных и веб-сервер находятся на разных компьютерах, необходимо:

- Настройка сетевых параметров SQL Server, используемый для взаимодействия по протоколу TCP/IP.
- Настройте все брандмауэры оборудования или программного обеспечения, чтобы разрешить TCP-трафика (и в некоторых случаях протокол UDP (User Datagram) трафик) на портах, которые использует экземпляр SQL Server.

Чтобы включить SQL Server обмениваться данными по протоколу TCP/IP, используйте диспетчер конфигурации SQL Server для изменения параметров сети для экземпляра SQL Server.

**Чтобы включить SQL Server обмениваться данными с использованием протокола TCP/IP**

1. На **запустить** последовательно выберите пункты **все программы**, нажмите кнопку **Microsoft SQL Server 2008 R2**, нажмите кнопку **средства настройки**, а затем нажмите кнопку **Диспетчер конфигурации SQL Server**.
2. В области представления дерева разверните **сетевая конфигурация SQL Server**, а затем нажмите кнопку **протоколы для MSSQLSERVER**.

   > [!NOTE]
   > Если установлено несколько экземпляров SQL Server, вы увидите <strong>протоколы для</strong><em>[имя экземпляра]</em> элемента для каждого экземпляра. Необходимо настроить параметры сети на основе по экземпляру.
3. В области сведений щелкните правой кнопкой мыши **TCP/IP** , а затем нажмите **включить**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image1.png)
4. В **предупреждение** диалоговое окно, нажмите кнопку **ОК**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image2.png)
5. Необходимо перезапустить службы MSSQLSERVER до вступления в силу конфигурацию сети. Это можно сделать в командной строке из консоли служб или SQL Server Management Studio. В этой процедуре будет использоваться SQL Server Management Studio.
6. Закройте диспетчер конфигурации SQL Server.
7. На **запустить** последовательно выберите пункты **все программы**, нажмите кнопку **Microsoft SQL Server 2008 R2**, а затем нажмите кнопку **SQL Server Management Studio**.
8. В **соединение с сервером** диалогового **имя сервера** введите имя сервера базы данных и нажмите кнопку **Connect**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image3.png)
9. В **обозревателя объектов** панели, щелкните правой кнопкой мыши родительский узел сервера (например, **TESTDB1**) и нажмите кнопку **перезапустите**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image4.png)
10. В **Microsoft SQL Server Management Studio** диалоговое окно, нажмите кнопку **Да**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image5.png)
11. После перезапуска службы закройте SQL Server Management Studio.

Чтобы разрешить трафик SQL Server через брандмауэр, сначала необходимо знать, какие порты использует экземпляр SQL Server. Это будет зависеть от способа экземпляр SQL Server был создан и настройки:

- Объект *экземпляр по умолчанию* из SQL Server прослушивает (и реагирует на) запросов на TCP-порт 1433.
- Объект *именованный экземпляр* из SQL Server прослушивает (и реагирует на) запросы динамически назначаемый порт TCP.
- Если служба обозревателя SQL Server включена, клиенты могут запрашивать службы через порт UDP 1434, чтобы узнать, какие TCP-порт, используемый для конкретного экземпляра SQL Server. Однако эта служба часто отключены по соображениям безопасности.

Предположим, что вы используете экземпляр по умолчанию SQL Server, необходимо настроить брандмауэр для разрешения трафика.

| Направление | Из порта | Для порта | Тип порта |
| --- | --- | --- | --- |
| Входящих подключений | Любой | 1433 | TCP |
| Исходящие | 1433 | Любой | TCP |
  

> [!NOTE]
> С технической точки зрения клиентский компьютер будет использовать случайным TCP-порт от 1024 до 5000 для взаимодействия с SQL Server и правила брандмауэра можно ограничить соответствующим образом. Дополнительные сведения о порты SQL Server и брандмауэров см. в разделе [номерами портов TCP/IP, необходимые для взаимодействия с SQL через брандмауэр](https://go.microsoft.com/?linkid=9805125) и [как: Настройка сервера для прослушивания определенного TCP-порта (конфигурация SQL Server Диспетчер)](https://msdn.microsoft.com/library/ms177440.aspx).


В большинстве сред Windows Server необходимо настроить брандмауэр Windows на сервере базы данных. По умолчанию брандмауэр Windows разрешает весь исходящий трафик, если правило специально не запретил его. Чтобы подключиться к базе данных на веб-сервере, необходимо настроить правило входящего трафика, разрешающее трафик TCP на порт, используемый экземпляром SQL Server. Если используется экземпляр по умолчанию SQL Server, можно использовать следующую процедуру для настройки этого правила.

**Для настройки брандмауэра Windows, используемый для взаимодействия с экземпляром SQL Server по умолчанию**

1. На сервере базы данных на **запустить** последовательно выберите пункты **Администрирование**, а затем нажмите кнопку **брандмауэр Windows в режиме повышенной безопасности**.
2. В области представления дерева щелкните **правила для входящих подключений**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image6.png)
3. В **действия** панели в разделе **правила для входящих подключений**, нажмите кнопку **новое правило**.
4. В правило мастера на **тип правила** выберите **порт**, а затем нажмите кнопку **Далее**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image7.png)
5. На **протокол и порты** убедитесь, что **TCP** выбран и в **определенные локальные порты** введите **1433**, а затем нажмите кнопку **Далее**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image8.png)
6. На **действия** оставьте **Разрешить соединение** флажок и нажмите кнопку **Далее**.
7. На **профиль** оставьте **домена** установлен, снимите **закрытый** и **открытый** флажки и нажмите кнопку  **Далее**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image9.png)
8. На **имя** страницы, введите правила подходящим образом описательное имя (например, **экземпляр SQL Server по умолчанию — доступ к сети**) и нажмите кнопку **Готово**.

Дополнительные сведения о настройке брандмауэра Windows для SQL Server, особенно в том случае, если требуется обмениваться данными с SQL Server по стандартным или динамических портов см. в разделе [как: Настройка брандмауэра Windows для доступа к компоненту Database Engine](https://technet.microsoft.com/library/ms175043.aspx).

## <a name="configure-logins-and-database-permissions"></a>Настройка имен входа и разрешения базы данных

При развертывании веб-приложения в Internet Information Services (IIS), то приложение запущено с использованием удостоверения пула приложений. В среде домена удостоверений пула приложений используйте учетную запись компьютера сервера, на котором они выполняются для доступа к сетевым ресурсам. Учетные записи компьютера имеют вид <em>[домен]</em><strong>\</ strong ><em>[имя компьютера]</em><strong>$</strong>&#x2014;например, <strong>FABRIKAM\TESTWEB1$</strong>. Чтобы разрешить веб-приложения для доступа к базе данных по сети, необходимо:

- Добавьте имя входа для учетной записи компьютера сервера веб к экземпляру SQL Server.
- Сопоставить имя входа учетной записи машины любые роли базы данных (обычно **db\_datareader** и **db\_datawriter**).

Если веб-приложение выполняется на ферме серверов, а не один сервер, необходимо повторить эти действия для каждого веб-сервера в ферме серверов.

> [!NOTE]
> Дополнительные сведения о удостоверения пула приложений, доступ к ресурсам в разделе [удостоверений пула приложений](https://go.microsoft.com/?linkid=9805123).


Достижение этих задач различными способами. Чтобы создать имя входа, также можно:

- Вручную создайте имя входа на сервере базы данных, с помощью Transact-SQL или SQL Server Management Studio.
- Проект сервера SQL Server 2008 в Visual Studio можно используйте для создания и развертывания имени входа.

Имя входа SQL Server является объектом уровня сервера, а не объект уровня базы данных, поэтому не зависят от базы данных, которые вы хотите развернуть. Таким образом в любой момент можно создать имя входа и простой подход чаще всего создать имя входа вручную на сервере базы данных, прежде чем приступать к развертыванию базы данных. Можно использовать следующую процедуру для создания имени входа в SQL Server Management Studio.

**Чтобы создать имя входа SQL Server для учетной записи компьютера сервера web**

1. На сервере базы данных на **запустить** последовательно выберите пункты **все программы**, нажмите кнопку **Microsoft SQL Server 2008 R2**, а затем нажмите кнопку **SQL Server Management Studio** .
2. В **соединение с сервером** диалогового **имя сервера** введите имя сервера базы данных и нажмите кнопку **Connect**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image10.png)
3. В **обозревателя объектов** панели, щелкните правой кнопкой мыши **безопасности**, пункты **New**и нажмите кнопку **входа**.
4. В **Создание имени входа** в диалоговом **имя входа** введите имя вашей учетной записи машины web server (например, **FABRIKAM\TESTWEB1$**).

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image11.png)
5. Нажмите кнопку **ОК**.

На этом этапе сервер базы данных готов для публикации веб-развертывания. Тем не менее все решения, развертываемого не будет работать, пока сопоставить имя входа учетной записи компьютера в роли базы данных требуется. Сопоставление имени входа к роли базы данных требует много более рассматривать, как вы не карты роли до окончании после развертывания базы данных. Чтобы сопоставить имя входа учетной записи компьютера в роли базы данных требуется, вы можете:

- Назначения ролей базы данных с именем входа вручную, после развертывания базы данных в первый раз.
- Используйте сценарий после развертывания для назначения ролей базы данных с именем входа.

Дополнительные сведения об автоматизации создания учетных записей и сопоставления ролей базы данных см. в разделе [развертывание членство роли базы данных для тестовых сред](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md). Кроме того можно использовать следующую процедуру, чтобы сопоставить имя входа учетной записи компьютера в роли базы данных требуется вручную. Помните, что невозможно выполнить данную процедуру, пока не *после* после развертывания базы данных.

**Для сопоставления базы данных роли машины веб-сервера учетной записи входа**

1. Откройте SQL Server Management Studio, как и раньше.
2. В **обозревателя объектов** области, разверните **безопасности** узел, разверните **имена входа** узел и дважды щелкните имя входа учетной записи компьютера (например,  **FABRIKAM\TESTWEB1$**).

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image12.png)
3. В **свойства имени входа** диалоговое окно, нажмите кнопку **сопоставления пользователей**.
4. В **пользователи, сопоставленные с этим именем входа** таблицы, выберите имя базы данных (например, **ContactManager**).
5. В **членство в роли для базы данных:** *[Имя_базы_данных]* выберите необходимые разрешения. В случае примера решения диспетчера контактов, необходимо выбрать **db\_datareader** и **db\_datawriter** ролей.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image13.png)
6. Нажмите кнопку **ОК**.

Хотя вручную сопоставление ролей базы данных часто является более чем достаточно для тестовых сред, менее желательно для автоматической или одним щелчком развертываний в промежуточной или производственной среды. Можно найти дополнительные сведения об автоматизации работы такого рода задач с помощью сценариев после развертывания в [развертывание членство роли базы данных для тестовых сред](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md).

> [!NOTE]
> Дополнительные сведения о серверных проектов и проектов баз данных см. в разделе [проекты базы данных Visual Studio 2010 SQL Server](https://msdn.microsoft.com/library/ff678491.aspx).


## <a name="configure-permissions-for-the-deployment-account"></a>Настройка разрешений для учетной записи развертывания

Если учетной записи, используемой для запуска развертывания не является администратором SQL Server, вам также потребуется создать имя входа для этой учетной записи. Чтобы создать базу данных, учетная запись должна быть членом **dbcreator** роли сервера или иметь равнозначные права.

> [!NOTE]
> При использовании веб-развертывания или VSDBCMD для развертывания базы данных можно использовать учетные данные Windows или SQL Server (если экземпляр SQL Server настроен для поддержки проверки подлинности в смешанном режиме). Следующая процедура подразумевает, что вы хотите использовать учетные данные Windows, но ничто не мешает вас от необходимости указывать имя пользователя SQL Server и пароль в строке подключения при настройке развертывания.


**Чтобы настроить разрешения для учетной записи развертывания**

1. Откройте SQL Server Management Studio, как и раньше.
2. В **обозревателя объектов** панели, щелкните правой кнопкой мыши **безопасности**, пункты **New**и нажмите кнопку **входа**.
3. В **имя входа — создание** диалогового **имя входа** введите имя учетной записи развертывания (например, **FABRIKAM\matt**).
4. В **Выбор страницы** области, нажмите кнопку **ролей сервера**.
5. Выберите **dbcreator**, а затем нажмите кнопку **ОК**.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image14.png)

Для поддержки последующих развертываниях, необходимо добавить учетную запись в развертывание в **db\_владельца** роли в базе данных после первого развертывания. Это так, как в последующих развертываниях вы изменение схемы существующей базы данных вместо создания новой базы данных. Как описано в предыдущем разделе, не может добавить пользователя к роли базы данных, пока не будут созданы базы данных, по очевидным причинам.

**Чтобы сопоставить имя входа учетной записи развертывания для db\_владельца роли базы данных**

1. Откройте SQL Server Management Studio, как и раньше.
2. В **обозревателя объектов** окна, разверните **безопасности** узел, разверните **имена входа** узел и дважды щелкните имя входа учетной записи компьютера (например,  **FABRIKAM\matt**).
3. В **свойства имени входа** диалоговое окно, нажмите кнопку **сопоставления пользователей**.
4. В **пользователи, сопоставленные с этим именем входа** таблицы, выберите имя базы данных (например, **ContactManager**).
5. В **членство в роли для базы данных:** *[Имя_базы_данных]* выберите **db\_владельца** роли.

    ![](configuring-a-database-server-for-web-deploy-publishing/_static/image15.png)
6. Нажмите кнопку **ОК**.

## <a name="conclusion"></a>Заключение

Теперь будет готов принимать удаленной базы данных развертывания и разрешить удаленный веб-серверы IIS для доступа к базам данных сервера базы данных. Прежде чем развертывание и использование баз данных, можно проверить следующие факты:

- Настроен ли SQL Server прием удаленных соединений TCP/IP?
- Вы настроили все брандмауэры на разрешение трафика SQL Server?
- Вы создали имя входа учетной записи компьютера для каждого веб-сервера, который получит доступ к SQL Server?
- Развертывание базы данных включает скрипт для создания сопоставлений ролей пользователей, или необходимо создать их вручную после развертывания базы данных в первый раз?
- Быть создано имя входа для учетной записи развертывания и добавить его к **dbcreator** роли сервера?

## <a name="further-reading"></a>Дополнительные сведения

Рекомендации по развертывание проектов базы данных см. в разделе [развертывание проектов базы данных](../web-deployment-in-the-enterprise/deploying-database-projects.md). Рекомендации по созданию членства в роли базы данных с помощью скрипта после развертывания см. в разделе [развертывание членство роли базы данных для тестовых сред](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md). Руководство для решения проблем развертывания, представляющие членства баз данных см. в разделе [развертывание базы данных членства для корпоративных средах](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).

> [!div class="step-by-step"]
> [Назад](configuring-a-web-server-for-web-deploy-publishing-offline-deployment.md)
> [Вперед](creating-a-server-farm-with-the-web-farm-framework.md)
