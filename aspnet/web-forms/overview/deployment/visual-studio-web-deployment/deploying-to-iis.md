---
uid: web-forms/overview/deployment/visual-studio-web-deployment/deploying-to-iis
title: "ASP.NET веб-развертывания с помощью Visual Studio: развертывание тест | Документы Microsoft"
author: tdykstra
description: "Этот учебник ряд показано развертывание ASP.NET (публикации) веб-приложения для веб-приложениях службы приложений Azure или стороннего поставщика услуг размещения, Пол..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/23/2015
ms.topic: article
ms.assetid: 8bf2c4fb-4ee5-4841-bfc2-03462c1f7a7a
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/deployment/visual-studio-web-deployment/deploying-to-iis
msc.type: authoredcontent
ms.openlocfilehash: 97910940f9de26ca71b111b945581d2de6650b02
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="aspnet-web-deployment-using-visual-studio-deploying-to-test"></a>ASP.NET веб-развертывания с помощью Visual Studio: развертывание в тест
====================
По [Tom Dykstra](https://github.com/tdykstra)

[Загрузите начальный проект](http://go.microsoft.com/fwlink/p/?LinkId=282627)

> Этот учебник ряд показано развертывание ASP.NET (публикации) веб-приложения для веб-приложениях службы приложений Azure или стороннего поставщика услуг размещения, с помощью Visual Studio 2012 или Visual Studio 2010. Сведения о последовательности см. в разделе [в первом учебнике ряда](introduction.md).


## <a name="overview"></a>Обзор

Этот учебник содержит описание развертывания веб-приложение ASP.NET в IIS на локальном компьютере.

При разработке приложения обычно протестировать, запустив его в Visual Studio. По умолчанию проекты веб-приложений в Visual Studio 2012 использования IIS Express в веб-сервера разработки. IIS Express во многом напоминает полные службы IIS, чем Visual Studio Development Server (также известном как Cassini), который по умолчанию использует Visual Studio 2010. Однако ни один из веб-сервера разработки работает так же, как службы IIS. В результате возможно, что приложение будет работать при тестировании в Visual Studio, но вызывает сбой при развертывании служб IIS.

Приложение можно протестировать надежнее следующими способами:

1. Развертывание приложения в IIS на компьютере разработчика с помощью того же процесса, будет использоваться позже развернуть его в рабочей среде. Можно настроить Visual Studio для использования IIS при запуске веб-проекта, но это не хватить процесс развертывания. Этот метод проверяет процесс развертывания в дополнение к проверке, приложение будет работать в службах IIS.
2. Развертывание приложения в тестовую среду, которая очень похож на рабочую среду. Поскольку в рабочую среду для этих учебников веб-приложений в службе приложений Azure, идеальным тестовой среды является дополнительных веб-приложения, созданные в службе приложений Azure. Это второй веб-приложение будет использовать только для тестирования, но он будет настраиваться так же, как рабочего веб-приложения.

Вариант 2 — наиболее надежный способ проверки, а если этого не нужно обязательно вариант 1. Тем не менее если выполняется развертывание стороннего поставщика вариант размещения 2 может оказаться невозможным или может быть много ресурсов, поэтому этот учебник, показывающие, оба метода. Для параметра 2 описаны в [развертывание в рабочей среде](deploying-to-production.md) учебника.

Дополнительные сведения об использовании веб-серверов в Visual Studio см. в разделе [веб-серверов в Visual Studio для веб-проектов ASP.NET](https://msdn.microsoft.com/en-us/library/58wxa9w5.aspx).

Напоминание: Если вы получаете сообщение об ошибке или что-то не работает, как пройти учебник, не забудьте проверить [страницу устранения неполадок](troubleshooting.md).

## <a name="install-iis"></a>Установка служб IIS

Чтобы развернуть службы IIS на компьютере разработчика, необходимо иметь IIS и веб-развертывания установлен. Веб-развертывание устанавливается по умолчанию вместе с Visual Studio, но IIS не включено в конфигурации по умолчанию Windows 8 или Windows 7. Если службы IIS уже установлены, и пул приложений по умолчанию уже задано значение .NET 4, перейдите к [разделу](#sqlexpress).

1. С помощью [Web Platform Installer](https://www.microsoft.com/web/downloads/platform.aspx) является предпочтительным способом для установки служб IIS и веб-развертывания, поскольку установщик веб-платформы устанавливает рекомендуемые конфигурации для служб IIS и автоматически устанавливает необходимые компоненты для IIS и веб- Развертывание, при необходимости.

    Чтобы запустить установщик веб-платформы для установки IIS и веб-развертывания, используйте следующую ссылку. Если вы уже установили IIS, веб-развертывания или любые их необходимые компоненты, установщик веб-платформы устанавливает только то, что отсутствует.

    - [Установка служб IIS и веб-развертывания с помощью установщика веб-платформы](https://www.microsoft.com/web/gallery/install.aspx?appsxml=&amp;appid=IIS7;ASPNET;NETFramework4;WDeploy)

    Вы увидите сообщения о том, что будут установлены службы IIS 7. Работу ссылку для IIS 8 в Windows 8, но для Windows 8 убедитесь, что ASP.NET 4.5 установлен, выполнив следующие действия:

    1. Откройте **панели управления**, **программы и компоненты**, **Включение или отключение компонентов**.
    2. Разверните **Internet Information Services**, **World Wide Web Services**, и **компоненты разработки приложений**.
    3. Убедитесь, что **ASP.NET 4.5** выбран.

        ![Выберите ASP.NET 4.5](deploying-to-iis/_static/image1.png)

После установки служб IIS, запустите **диспетчера служб IIS** чтобы убедиться в том, что .NET Framework версии 4 назначен пул приложений по умолчанию.

1. Нажмите клавишу WINDOWS + R, чтобы открыть **запуска** диалоговое окно.

    (Или в Windows 8 введите «выполнить» **запустить** страницы или в Windows 7 выберите **запуска** из **запустить** меню. Если **запуска** не находится в **запустить** меню, щелкните правой кнопкой мыши на панели задач, щелкните **свойства**выберите **меню "Пуск"** щелкните **Настройка**и выберите **выполните команду**.)
2. Введите «inetmgr» и нажмите кнопку **ОК**.
3. В **подключений** разверните узел сервера и выберите **пулы приложений**. В **пулы приложений** области, если **DefaultAppPool** — назначено платформа .NET framework версии 4, как показано на следующем рисунке, перейдите к следующему разделу.

    [![Inetmgr_showing_4.0_app_pools](deploying-to-iis/_static/image3.png)](deploying-to-iis/_static/image2.png)
4. Если вы видите только два пула приложений, а они устанавливаются в .NET Framework 2.0, необходимо установить ASP.NET 4 в службах IIS.

    Для Windows 8 см. инструкции в предыдущем статьи для убедившись, что ASP.NET 4.5 должен быть установлен или в разделе [данной статьи БАЗЫ знаний](https://support.microsoft.com/kb/2736284). Для Windows 7, откройте окно командной строки, щелкнув правой кнопкой мыши **командной строки** в Windows **запустить** , выберите в меню **Запуск от имени администратора**. Затем запустите [aspnet\_regiis.exe](https://msdn.microsoft.com/en-us/library/k6h9cz8h.aspx) для установки ASP.NET 4 в IIS с помощью следующих команд. (В 32-разрядных системах, замените «Framework64» с «Платформы».)

    [!code-console[Main](deploying-to-iis/samples/sample1.cmd)]

    Эта команда создает новые пулы приложений для .NET Framework 4, но пул приложений будет по-прежнему присвоено 2.0. Вы будете развертывать приложения, ориентированном на .NET 4 с этим пулом приложений, необходимо изменить пул приложений .NET 4.
5. Если вы закрыли **диспетчера служб IIS**, запустите его еще раз, разверните узел сервера и нажмите кнопку **пулы приложений** для отображения **пулы приложений** области еще раз.
6. В **пулы приложений** области, нажмите кнопку **DefaultAppPool**, а затем в **действия** щелкните **основные параметры**.

    [![Inetmgr_selecting_Basic_Settings_for_app_pool](deploying-to-iis/_static/image5.png)](deploying-to-iis/_static/image4.png)
7. В **изменение пула приложений** диалоговом изменение **версии платформы .NET Framework** для **v4.0.30319 .NET Framework** и нажмите кнопку **ОК**.

    [![Selecting_.NET_4_for_DefaultAppPool](deploying-to-iis/_static/image7.png)](deploying-to-iis/_static/image6.png)

IIS теперь все готово для публикации веб-приложение, его, но прежде, чем это можно сделать, то необходимо создать баз данных, которые будут использоваться в тестовой среде.

<a id="sqlexpress"></a>

## <a name="install-sql-server-express"></a>Установка SQL Server Express

LocalDB не предназначен для работы в службах IIS, поэтому для тестовой среды необходимо иметь установки SQL Server Express. Если вы используете Visual Studio 2010 SQL Server Express уже установлены по умолчанию. Если вы используете Visual Studio 2012, необходимо установить его.

Чтобы установить SQL Server Express, установите его из [центра загрузки Майкрософт: Microsoft SQL Server 2012 Express](https://www.microsoft.com/en-us/download/details.aspx?id=29062) , щелкнув [ENU\x64\SQLEXPR\_x64\_ENU.exe](https://download.microsoft.com/download/8/D/D/8DD7BDBA-CEF7-4D8E-8C16-D9F69527F909/ENU/x64/SQLEXPR_x64_ENU.exe) или [ ENU\x86\SQLEXPR\_x86\_ENU.exe](https://download.microsoft.com/download/8/D/D/8DD7BDBA-CEF7-4D8E-8C16-D9F69527F909/ENU/x86/SQLEXPR_x86_ENU.exe). При выборе тот для вашей системы его не удастся установить, и вы можете попробовать использовать другой.

На первой странице Центр установки SQL Server, нажмите кнопку **автономная установка нового SQL Server или добавление компонентов к существующей установке**и следуйте инструкциям, принимающий параметры по умолчанию. В мастере установки примите параметры по умолчанию. Дополнительные сведения о параметрах установки см. в разделе [Установка SQL Server 2012 с помощью мастера установки (программа установки)](https://msdn.microsoft.com/en-us/library/ms143219.aspx).

## <a name="create-sql-server-express-databases-for-the-test-environment"></a>Создание баз данных на SQL Server Express для среды тестирования

Приложение Contoso университета имеет две базы данных: база данных членства и базы данных приложения. Эти базы данных можно развернуть для двух разных баз данных или для одной базы данных. Можно объединять их для упрощения базы данных соединения между базы данных приложения и базы данных членства. При развертывании стороннего поставщика услуг размещения план размещения также может указать причину их объединение. Например поставщик услуг размещения начислить более для нескольких баз данных или не даже позволить более одной базы данных.

В этом учебнике вы развернете для двух баз данных в тестовой среде с одной базы данных в промежуточной и производственной средах.

Из **представление** меню в Visual Studio выберите **обозревателя серверов** (**обозреватель баз данных** в Visual Web Developer), щелкните правой кнопкой мыши **подключения к данным**  и выберите **Создание новой базы данных SQL Server**.

![Selecting_Create_New_SQL_Server_Database](deploying-to-iis/_static/image8.png)

В **Создание новой базы данных SQL Server** диалогового окна введите «. \SQLExpress» в **имя сервера** поле и «aspnet-ContosoUniversity» в **новое имя базы данных** поле, затем Нажмите кнопку **ОК**.

![Создание aspnet ContosoUniversity](deploying-to-iis/_static/image9.png)

Создать новую базу данных School, экспресс-выпуск SQL Server с именем «ContosoUniversity» с помощью той же процедуры.

**Обозреватель серверов** теперь отображаются два новых баз данных.

![Новые базы данных в обозревателе серверов](deploying-to-iis/_static/image10.png)

## <a name="create-a-grant-script-for-the-new-databases"></a>Создание скрипта предоставления для новых баз данных

При выполнении приложения в IIS на компьютере разработчика, приложение обращается к базе данных, используя учетные данные пула приложений по умолчанию. Тем не менее по умолчанию удостоверение пула приложений имеет разрешение на открытие баз данных. Поэтому необходимо выполнить скрипт для предоставления этого разрешения. В этом разделе создайте скрипт, что вы будете запускать приложение более поздней версии, чтобы убедиться в том, что приложение может быть открыта баз данных при запуске в IIS.

Щелкните правой кнопкой мыши решение (не один из проектов) и нажмите кнопку **Добавление нового элемента**и затем создать новую **файл SQL** с именем *Grant.sql*. Скопируйте следующие команды SQL в файл и затем сохраните и закройте файл:

[!code-sql[Main](deploying-to-iis/samples/sample2.sql)]

> [!NOTE]
> Этот скрипт предназначен для работы с SQL Server Express 2012 и параметры IIS в Windows 8 и Windows 7, как они указаны в этом учебнике. При использовании другой версии SQL Server или Windows, или можно настроить IIS на компьютере по-разному, может потребоваться внести изменения в этот сценарий. Дополнительные сведения о скриптах SQL Server см. в разделе [электронной документации по SQL Server](https://go.microsoft.com/fwlink/?LinkId=132511).


> [!NOTE] 
> 
> **Примечание по безопасности** этот сценарий предоставляет db\_права владельца для пользователя, который обращается к базе данных во время выполнения, что является будете иметь производственной среды. В некоторых сценариях может потребоваться задать пользователь, имеющий всей базы данных схемы обновить разрешения только для развертывания и указать для времени выполнения другого пользователя с разрешениями только на чтение и запись данных. Дополнительные сведения см. в разделе [просмотрев автоматические изменения Web.config Code First Migrations](#reviewingmigrations) далее в этом учебнике.


<a id="publish"></a>

## <a name="run-the-grant-script-in-the-application-database"></a>Выполните сценарий grant в базе данных приложения

Можно настроить для выполнения сценария grant в базе данных членства во время развертывания, поскольку это развертывание базы данных использует поставщик dbDacFx профиль публикации. Не может выполнять скрипты во время развертывания Code First Migrations, являющийся, каким образом выполняется развертывание базы данных приложения. Таким образом необходимо вручную запустить скрипт, прежде чем развертывание в базу данных приложения.

1. В Visual Studio откройте *Grant.sql* файла, созданного ранее.
2. Нажмите кнопку **Подключиться**. 

    ![Кнопка "Подключить"](deploying-to-iis/_static/image11.png)
3. В **соединение с сервером** диалогового окна введите *. \SQLExpress* как **имя сервера**, а затем нажмите кнопку **Connect**.
4. Выберите в раскрывающемся списке базу данных **ContosoUniversity**, а затем нажмите кнопку **Execute**. 

    ![](deploying-to-iis/_static/image12.png)

Удостоверение пула приложений по умолчанию теперь имеет достаточные разрешения в базе данных приложения для миграции Code First для создания таблиц базы данных при запуске приложения.

## <a name="publish-to-iis"></a>Публикация в IIS

Существует несколько способов, развертываемых в службах IIS с помощью Visual Studio и веб-развертывания:

- Используйте Visual Studio, публикация одним щелчком.
- Публикация из командной строки.
- Создание *пакета развертывания* и установите его с помощью пользовательского интерфейса диспетчера IIS. Пакет развертывания состоит из *.zip* файл, содержащий файлы и метаданные, необходимые для установки сайта в IIS.
- Создание пакета развертывания и установите его с помощью командной строки.

Процесс, который вы выполнили на предыдущих уроках, чтобы настроить Visual Studio для автоматизации задач развертывания применяется ко всем из этих методов. В этих учебниках используется первые два из этих методов. Сведения об использовании пакетов развертывания см. в разделе [развертывание веб-приложения необходимо создать и установить пакет веб-развертывания](https://go.microsoft.com/fwlink/p/?LinkId=282413#package) в Web Карта содержимого развертывания для Visual Studio и ASP.NET.

Перед публикацией убедитесь, что Visual Studio выполняется с правами администратора. Если вы не видите **(администратор)** закройте Visual Studio в строке заголовка. В Windows 8 **запустить** страницы или Windows 7 **запустить** меню, щелкните правой кнопкой мыши значок для используемой версии Visual Studio, вы используете и выберите **Запуск от имени администратора**. Режим администратора является обязательным для публикации только при публикации в IIS на локальном компьютере.

### <a name="create-the-publish-profile"></a>Создание профиля публикации

1. В **обозревателе решений**, щелкните правой кнопкой мыши проект ContosoUniversity (не проект ContosoUniversity.DAL) и выберите **публикации**.

    **Веб-публикация** откроется окно мастера.

    ![Публикация веб-мастера профиля tab](deploying-to-iis/_static/image13.png)
2. В раскрывающемся списке выберите  **&lt;создать... &gt;**. (С установить последнее обновление Visual Studio, отсутствует список раскрывающегося списка и кнопка для щелкните, чтобы создать новый профиль с нуля находится **настраиваемый**.)
3. В **новый профиль** диалоговое окно, введите «Test» и нажмите кнопку **ОК**.

    Мастер автоматически перейдет к **подключения** вкладки.
4. В **URL-адрес службы** введите *localhost*.
5. В **сайт и приложение** введите *веб-сайт по умолчанию/ContosoUniversity*
6. В **URL-адрес назначения** введите`http://localhost/ContosoUniversity`

    **URL-адрес назначения** параметр не является обязательным. По завершении развертывание приложения Visual Studio автоматически откроется браузер по умолчанию для этого URL-адреса. Если вы не хотите браузер, чтобы автоматически открыть после развертывания, оставьте это поле пустым.
7. Нажмите кнопку **проверить подключение** Чтобы проверить правильность параметров и можно подключиться к службам IIS на локальном компьютере.

    Зеленая галочка проверяет, что соединение установлено успешно.

    ![Публикация веб-мастер подключения tab](deploying-to-iis/_static/image14.png)
8. Нажмите кнопку **Далее** для продвижения **параметры** вкладки.
9. **Конфигурации** раскрывающийся список указывает конфигурацию сборки для развертывания. Оставьте значение по умолчанию выпуска. Вы не развертывание отладочных построений в этом учебнике.
10. Разверните **параметры публикации файлов**, а затем выберите **исключить файлы из приложения\_папки данных**.

    В тестовой среде, приложение будет доступ к базам данных, созданные в локальном экземпляре SQL Server Express, файлы не MDF-файл в *приложения\_данные* папки.
11. Оставить **Precompile во время публикации** и **удалить дополнительные файлы в месте назначения** флажки.

    ![Параметры публикации файлов во вкладке "Параметры"](deploying-to-iis/_static/image15.png)

    Предварительная компиляция имеет параметр, который применяется в основном для очень больших сайтах; оно может также ограничить время запуска страницы при первом запросе страницы после публикации сайта.

    Удалить дополнительные файлы, поскольку это первый развертывания, а не будет все файлы в папке назначения еще не нужно.

    > [!NOTE] 
    > 
    > [!CAUTION]
    > При выборе **удалить дополнительные файлы** для последующего развертывания на том же сайте, убедитесь в том, используйте функцию предварительного просмотра, чтобы увидеть заранее какие файлы будут удалены перед развертыванием. Ожидаемым поведением является то, что веб-развертывания приведет к удалению файлов на целевом сервере, удаленные в своем проекте. Тем не менее сравниваются структуре всю папку в исходной и целевой папки, и в некоторых сценариях веб-развертывания может удалить файлы, которые вы не хотите удалить.
    > 
    > Например при наличии веб-приложении во вложенной папке на сервере при развертывании проекта в корневую папку подпапке будут удалены. Возможно, один проект для основного сайта по адресу contoso.com и другой проект для блога по адресу contoso.com/blog. Приложение блога находится во вложенной папке. При выборе удалить дополнительные файлы в назначении, при развертывании главного сайта, приложение блога будут удалены.
    > 
    > Другой пример — приложение\_папки данных может неожиданно удалены. Определенные базы данных, таких как SQL Server Compact хранить файлы базы данных в приложении\_папки данных. После первоначального развертывания не требуется сохранять копирование файлов базы данных в последующих развертываниях, чтобы исключить приложение необходимо выбрать\_данные на вкладке упаковка и публикация веб-сайта. После этого, если требуется удалить дополнительные файлы в месте назначения выбран, файлы базы данных и приложения\_саму папку данных будут удалены при очередном публикации.

### <a name="configure-deployment-for-the-membership-database"></a>Настройка развертывания для базы данных членства

Следующие шаги применимы к **DefaultConnection** базы данных в **баз данных** раздел диалогового окна.

1. В **строку подключения к удаленному** введите следующую строку соединения, указывающий на базе членства SQL Server Express.

    [!code-console[Main](deploying-to-iis/samples/sample3.cmd)]

    Процесс развертывания будет поместить эту строку подключения в развернутом файле Web.config, так как **использовать эту строку подключения во время выполнения** выбран.

    Можно также получить строку подключения из **обозревателя серверов**. В **обозревателя серверов**, разверните **подключения к данным** и выберите  **&lt;machinename&gt;\sqlexpress.aspnet-ContosoUniversity** базы данных, затем на **свойства** окно копирования **строка подключения** значение. Что строка подключения будет иметь один дополнительный параметр, который можно удалить: `Pooling=False`.
2. Выберите **обновление базы данных**.

    В результате будет создан в целевой базе данных во время развертывания схемы базы данных. В следующих шагах укажите дополнительные сценарии, которые требуются для запуска: один для предоставления доступа к базе данных, чтобы пул приложений по умолчанию и один для развертывания данных.
3. Нажмите кнопку **настроить обновление базы данных**.
4. В **Настройка обновления базы данных** диалоговое окно, нажмите кнопку **добавить скрипт SQL** и перейдите к *Grant.sql* скрипт, который был ранее сохранен в папке решения.
5. Повторите процедуру, чтобы добавить *aspnet данных dev.sql* сценария.

    ![Настройка обновления базы данных для базы данных членства](deploying-to-iis/_static/image16.png)
6. Нажмите кнопку **Закрыть**.

### <a name="configure-deployment-for-the-application-database"></a>Настройка развертывания для базы данных приложения

Когда Visual Studio обнаруживает Entity Framework `DbContext` класса, он создает запись в **баз данных** раздел с **выполнять миграции Code First** флажок вместо  **Обновление базы данных** флажок. В этом учебнике будет использоваться этот флажок для указания Code First Migrations развертывания.

В некоторых случаях, возможно, вы используете `DbContext` базы данных, но вы хотите использовать поставщик dbDacFx вместо миграции для развертывания базы данных. См. в этом случае [как развернуть базу данных Code First без миграции?](https://msdn.microsoft.com/en-us/library/ee942158.aspx#deploy_code_first_without_migrations) в ASP.NET Web развертывания вопросов и Ответов на сайте MSDN.

Следующие шаги применимы к **SchoolContext** базы данных в **баз данных** раздел диалогового окна.

1. В **строку подключения к удаленному** введите следующую строку соединения, указывающий на базе приложения SQL Server Express.

    [!code-console[Main](deploying-to-iis/samples/sample4.cmd)]

    Процесс развертывания будет поместить эту строку подключения в развернутом файле Web.config, так как **использовать эту строку подключения во время выполнения** выбран.

    Можно также получить строку подключения базы данных приложения из **обозревателя серверов** строка подключения к базе данных так же, как вы получили членство.
2. Выберите **выполнять миграции Code First (запускается при запуске приложения)**.

    Этот параметр вызывает процесс развертывания для настройки в развернутый файл Web.config для указания `MigrateDatabaseToLatestVersion` инициализатора. Это инициализатора автоматически обновляет базу данных до последней версии, когда приложение обращается к базе данных в первый раз после развертывания.

### <a name="configure-publish-profile-transforms"></a>Настройка преобразования профиля публикации

1. Нажмите кнопку **закрыть**, а затем нажмите кнопку **Да** ответ на вопрос Если вы хотите сохранить изменения.
2. В **обозревателе решений**, разверните **свойства**, разверните **PublishProfiles**.
3. Нажмите кнопку Rright *Test.pubxml,* и нажмите кнопку **добавить преобразования конфигурации**.

    ![Преобразование конфигурации меню добавления](deploying-to-iis/_static/image17.png)

    Visual Studio создает *Web.Test.config* файла преобразования и открывает его.
4. В *Web.Test.config* файл преобразования, вставьте следующий код сразу после открывающего тега конфигурации.

    [!code-xml[Main](deploying-to-iis/samples/sample5.xml)]

    При использовании тестового профиль публикации, это преобразование задает среды индикатора для «Test». В развернутом узле («Test») появится после заголовка H1 «Университета Contoso».
5. Сохраните и закройте файл.
6. Щелкните правой кнопкой мыши *Web.Test.config* файла и нажмите кнопку **преобразования предварительного просмотра** важно убедиться, что преобразование коде дает ожидаемые изменения.

    **Web.config Preview** окне отображается результат применения обоих *Web.Release.config* преобразует и *Web.Test.config* преобразования.

### <a name="preview-the-deployment-updates"></a>Предварительный просмотр обновлений развертывания

1. Откройте **веб-публикация** мастер еще раз (щелкните правой кнопкой мыши проект ContosoUniversity и нажмите кнопку **публикации**).
2. В **предварительного просмотра** , убедитесь, что **теста** профиль является, по-прежнему выбран, а затем щелкните **начать просмотр** для просмотра списка файлов, которые будут скопированы.

    ![Предварительный просмотр](deploying-to-iis/_static/image18.png)

    ![Предварительный просмотр публикации](deploying-to-iis/_static/image19.png)

    Можно также щелкнуть **предварительной версии базы данных** ссылку, чтобы просмотреть сценариев, которые будут выполнены в базе данных членства. (Нет сценарии выполняются для развертывания Code First Migrations, нет элементов для предварительного просмотра для базы данных приложения.)
3. Нажмите кнопку **Опубликовать**.

    Если Visual Studio не находится в режиме администратора, может появиться сообщение об ошибке, указывающее, ошибки разрешений. В этом случае закройте Visual Studio, откройте его в режиме администратора и повторите попытку публикации.

    Если Visual Studio с правами администратора **вывода** отчеты окно успешного построения и публикации.

    ![Output_window_publish_Test](deploying-to-iis/_static/image20.png)

    Если вы ввели URL-адрес в **URL-адрес назначения** поле в профиль публикации **подключения** , браузер автоматически откроется вкладка на Contoso университета домашнюю страницу, работающего в IIS на локальном компьютере.

## <a name="test-in-the-test-environment"></a>Тестирование в тестовой среде

Обратите внимание, что индикатор среды показывает «(Test)» вместо «(Dev)», который показывает, что *Web.config* успешно преобразование для индикатора среды.

Запустите **инструкторов** страницу, чтобы убедиться, что Code First заполнена данными инструктора базы данных. При выборе этой страницы, он может занять несколько минут, чтобы загрузить, так как Code First создает базу данных и затем запускает `Seed` метод. (Он не сделать, если были на домашней странице, так как приложение не пытается получить доступ к базе данных еще).

Нажмите кнопку **учащихся** вкладку, чтобы убедитесь, что развернутая база данных не учащихся.

Выберите **добавьте учащихся** из **учащихся** меню, добавить студент, а затем просмотрите нового студента в **учащихся** страницу, чтобы убедиться, что вы успешно может записывать в базу данных .

Из **курсы** последовательно выберите пункты **обновление кредиты**. **Обновления кредиты** страницы требуются разрешения администратора, поэтому **входа в** отображается страница. Введите учетные данные учетной записи администратора, созданную ранее («admin» и «devpwd»). **Обновление кредиты** отображается страница, проверяет, что учетная запись администратора, созданную в предыдущем учебнике правильно была развернута в тестовую среду.

Убедитесь, что *Elmah* папка существует в *c:\inetpub\wwwroot\ContosoUniversity* папку с файлом заполнитель только в ней.

<a id="reviewingmigrations"></a>

## <a name="review-the-automatic-webconfig-changes-for-code-first-migrations"></a>Просмотрите автоматические изменения Web.config для миграции Code First

Откройте *Web.config* файла в развернутом приложении по *C:\inetpub\wwwroot\ContosoUniversity* , чтобы увидеть, где процесс развертывания автоматически настроить Code First Migrations в Обновите базу данных до последней версии.

![](deploying-to-iis/_static/image21.png)

Процесс развертывания также создается строка подключения для миграции Code First, предназначенного исключительно для обновления схемы базы данных:

![Строка подключения Database_Publish](deploying-to-iis/_static/image22.png)

Эта строка дополнительные подключения можно указать одну учетную запись пользователя для обновления схемы базы данных, а другой учетной записью для доступа к данным приложения. Например, можно назначить **db\_владельца** роли для миграции Code First и **db\_datareader** и **db\_datawriter**ролей для приложения. Это распространенный подход глубокой обороны, предотвращающее потенциально вредоносный код приложения, изменения схемы базы данных. (Например, это может произойти в успешных атак путем внедрения кода SQL.) Этот шаблон не используется в этих учебниках. Если требуется реализовать этот шаблон в сценарий, его можно сделать, выполнив следующие действия:

1. В **параметры** вкладке **веб-публикация** мастера введите строку подключения, который указывает пользователя с полной базы данных разрешения на обновление схемы и снимите **использовать эту строку подключения во время выполнения** флажок. В развернутом файле Web.config, это свойство становится `DatabasePublish` строку подключения.
2. Создайте преобразование файла Web.config для строки подключения, требуется приложение для использования во время выполнения.

## <a name="summary"></a>Сводка

Теперь развертывания приложения в IIS на компьютере разработчика и она протестирована.

![Домашняя страница в тесте](deploying-to-iis/_static/image23.png)

Проверяет, что процесс развертывания копируются содержимое приложения правильное местоположение (за исключением файлов, которые вы не хотите развернуть), а также что веб-развертывания IIS правильность настройки во время развертывания. В следующем уроке вы будете запускать один дополнительные тест, который находит задачу развертывания, которая еще не было сделано: Установка разрешений для папки на *Elmah* папки.

## <a name="more-information"></a>Дополнительные сведения

Сведения о запуске IIS или IIS Express в Visual Studio см. следующие ресурсы:

- [IIS Express Обзор](https://www.iis.net/learn/extensions/introduction-to-iis-express/iis-express-overview) на сайте IIS.net.
- [Знакомство с IIS Express](https://weblogs.asp.net/scottgu/archive/2010/06/28/introducing-iis-express.aspx) в блоге Скотта Гатри.
- [Веб-серверы в Visual Studio для проектов ASP.NET Web](https://msdn.microsoft.com/en-us/library/58wxa9w5.aspx).
- [Основные различия между IIS и ASP.NET Development Server](../../older-versions-getting-started/deploying-web-site-projects/core-differences-between-iis-and-the-asp-net-development-server-cs.md) на веб-сайте ASP.NET.

Сведения о какие проблемы могут возникнуть при запуске приложения на среднем уровне доверия, см. в разделе [размещение приложений ASP.NET в средний уровень доверия](http://www.4guysfromrolla.com/articles/100307-1.aspx) на 4 Guys Rolla сайта.

>[!div class="step-by-step"]
[Назад](project-properties.md)
[Вперед](setting-folder-permissions.md)
