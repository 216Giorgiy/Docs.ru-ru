---
uid: web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update
title: "ASP.NET веб-развертывания с помощью Visual Studio: развертывание обновления кода | Документы Microsoft"
author: tdykstra
description: "Этот учебник ряд показано развертывание ASP.NET (публикации) веб-приложения для веб-приложениях службы приложений Azure или стороннего поставщика услуг размещения, Пол..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/15/2013
ms.topic: article
ms.assetid: c76dbc35-a914-4ee3-919c-4f4d1fa05104
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update
msc.type: authoredcontent
ms.openlocfilehash: f6861c702c1ccb19e5a4eee484a622079e205f86
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2018
---
<a name="aspnet-web-deployment-using-visual-studio-deploying-a-code-update"></a>ASP.NET веб-развертывания с помощью Visual Studio: развертывание обновления кода
====================
По [Tom Dykstra](https://github.com/tdykstra)

[Загрузите начальный проект](http://go.microsoft.com/fwlink/p/?LinkId=282627)

> Этот учебник ряд показано развертывание ASP.NET (публикации) веб-приложения для веб-приложениях службы приложений Azure или стороннего поставщика услуг размещения, с помощью Visual Studio 2012 или Visual Studio 2010. Сведения о последовательности см. в разделе [в первом учебнике ряда](introduction.md).


## <a name="overview"></a>Обзор

После первоначального развертывания продолжает работу обслуживание и разработка веб-узла и вскоре требуется развернуть обновления. Этот учебник поможет выполнить процесс развертывания обновления в код приложения. Обновление, реализации и развертывания в этом учебнике не включает изменения базы данных; Вы увидите отличия в развертывании изменение базы данных в следующем уроке.

Напоминание: Если вы получаете сообщение об ошибке или что-то не работает, как пройти учебник, не забудьте проверить [страницу устранения неполадок](troubleshooting.md).

## <a name="make-a-code-change"></a>Изменения кода

В качестве простого примера обновления в приложение, мы добавим **инструкторов** страница списка выбранных инструктора при изучении курсов.

При запуске **инструкторов** страницы, вы заметите, что существуют **выберите** ссылки в сетке, но они не совершают ничего, кроме убедитесь серый включить фон строки.

![Страница инструкторов с выделением](deploying-a-code-update/_static/image1.png)

Теперь добавьте код, выполняемый при **выберите** ссылка нажатии и отображает список выбранных инструктора при изучении курсов.

1. В *Instructors.aspx*, добавьте следующую разметку сразу после **ErrorMessageLabel** `Label` управления:

    [!code-aspx[Main](deploying-a-code-update/samples/sample1.aspx)]
2. Запустите страницу и выберите инструктор. Можно просмотреть список при изучении этого инструктора курсов.

    ![Страница инструкторов с курсов обучения](deploying-a-code-update/_static/image2.png)
3. Закройте браузер.

## <a name="deploy-the-code-update-to-the-test-environment"></a>Развернуть обновление кода в среде тестирования

Перед использованием профилей публикации для развертывания тестов, промежуточной и производственной, необходимо изменить параметры базы данных публикации. Больше не требуется запуск скриптов развертывания grant и данных для базы данных членства.

1. Откройте **веб-публикация** мастера, щелкнув правой кнопкой мыши проект ContosoUniversity команду **публикации**.
2. Нажмите кнопку **тест** профиле в **профиль** раскрывающегося списка.
3. Нажмите кнопку **параметры** вкладки.
4. В разделе **DefaultConnection** в **баз данных** снимите **обновление базы данных** флажок.
5. Нажмите кнопку **профиль** , а затем щелкните **промежуточной** профиле в **профиль** раскрывающегося списка.
6. Когда будет предложено, если вы хотите сохранить изменения, внесенные в **тест** , установите флажок **Да**.
7. Внести такое же изменение в профиле промежуточного хранения.
8. Повторите процедуру, чтобы внести такое же изменение в профиле рабочей среде.
9. Закрыть **веб-публикация** мастера.

Развертывание в среде тестирования — теперь это простой механизм выполнения одним щелчком повторной публикации. Чтобы сделать этот процесс быстрее, можно использовать **веб-публикация одним щелкните** инструментов.

1. В **представление** меню, выберите **панели инструментов** , а затем выберите **веб-публикация одним щелкните**.

    ![Selecting_One_Click_Publish_toolbar](deploying-a-code-update/_static/image3.png)
2. В **обозревателе решений**, выберите проект ContosoUniversity.
3. **веб-публикация одним щелкните** инструментов, выберите **тест** профиль публикации, а затем нажмите кнопку **веб-публикация** (значок со стрелками влево и вправо).

    ![Web_One_Click_Publish_toolbar](deploying-a-code-update/_static/image4.png)
4. Visual Studio развертывает обновленное приложение, и автоматически откроется браузер на домашнюю страницу.
5. Запустите страницу инструкторов и выберите инструктор, чтобы убедиться, что обновление было успешно развернуто.

Обычным также выполнить тест регрессии (то есть тестирование остальной части сайта, чтобы убедиться в том, что новое изменение не разбить существующие функциональные возможности). Однако в этом учебнике будет пропустить этот шаг и перейдите к развертывания обновления в промежуточной и производственной сред.

При повторном развертывании, веб-развертывания автоматически определяет, какие файлы были изменены, и копирует только измененные файлы на сервер. По умолчанию веб-развертывание использует даты последнего изменения файлов, чтобы определить, какие из них были изменены. Некоторые системы управления версиями файлов даты изменить даже при изменении содержимого файла не. В этом случае можно настроить веб-развертывания для использования контрольных сумм для определения, какие файлы были изменены. Дополнительные сведения см. в разделе [почему все мои файлы получить повторного развертывания несмотря на то, что их не удалось изменить?](https://msdn.microsoft.com/library/ee942158.aspx#use_checksum) в часто задаваемые вопросы по ASP.NET развертывания.

## <a name="take-the-application-offline-during-deployment"></a>Использовать приложение в автономный режим во время развертывания

Изменение, которое выполняется развертывание теперь является простое изменение на одной странице. Но иногда развертывание большего изменения или развертывании изменений кода и баз данных и сайте может работать неправильно, если пользователь запрашивает страницу до завершения развертывания. Чтобы запретить пользователям доступа к узлу, во время развертывания, можно использовать *приложения\_offline.htm* файла. При переводе в файл с именем *приложения\_offline.htm* в корневой папке приложения, службы IIS автоматически отображает этот файл вместо запуска приложения. Поэтому для предотвращения доступа во время развертывания, поместить *приложения\_offline.htm* в корневой папке запуска процесса развертывания, а затем удалите *приложения\_offline.htm* после успешно развертывание.

Можно настроить веб-развертывания для автоматического размещения по умолчанию *приложения\_offline.htm* файла на сервере при запуске развертывание и удалите его при завершении. Делать все, что нужно сделать — это добавить следующий XML-элемент в публикации (.pubxml) профиля:

[!code-xml[Main](deploying-a-code-update/samples/sample2.xml)]

В этом учебнике будет показано, как создавать и использовать пользовательский *приложения\_offline.htm* файла.

С помощью *приложения\_offline.htm* в промежуточный сайт не требуется, так как нет пользователей, обращающихся к промежуточный сайт. Однако рекомендуется использовать промежуточного хранения для все проверки того, который необходимо выполнить развертывание в рабочей среде.

### <a name="create-appofflinehtm"></a>Создание приложения\_offline.htm

1. В **обозревателе решений**, щелкните правой кнопкой мыши решение и выберите **добавить**, а затем нажмите кнопку **новый элемент**.
2. Создание **HTML-страницу** с именем *приложения\_offline.htm* (удаление конечного символа «l» в *.html* расширения, Visual Studio по умолчанию).
3. Замените существующую разметку шаблона следующую разметку:

    [!code-html[Main](deploying-a-code-update/samples/sample3.html)]
4. Сохраните и закройте файл.

### <a name="copy-appofflinehtm-to-the-root-folder-of-the-web-site"></a>Копия приложения\_offline.htm в корневую папку веб-сайта

Можно использовать любое средство FTP для копирования файлов на веб-сайт. [FileZilla](http://filezilla-project.org/) популярным средством FTP и отображается в снимках экрана.

Чтобы использовать средство FTP, необходимы три вещи: URL-адрес FTP, имя пользователя и пароль.

URL-адрес отображается на странице панели мониторинга веб-сайта на портале управления Azure, и имя пользователя и пароль для FTP-сервера можно найти в *.publishsettings* ранее загруженный файл. Ниже показано, как получить эти значения.

1. На портале управления Azure щелкните **веб-сайтов** и нажмите кнопку промежуточного веб-сайта.
2. На **мониторинга** страницы, прокрутите вниз, чтобы найти имя узла FTP в **быстрый обзор** раздела.

    ![Имя узла FTP](deploying-a-code-update/_static/image5.png)
3. Откройте промежуточной *.publishsettings* файл в блокноте или другом текстовом редакторе.
4. Найти `publishProfile` элемент для профиль FTP.
5. Копировать `userName` и `userPWD` значения.

    ![Учетные данные FTP](deploying-a-code-update/_static/image6.png)
6. Открытие средства FTP и выполните вход на URL-адрес FTP.
7. Копировать *приложения\_offline.htm* из папки решения для */сайт/wwwroot* папку промежуточного сайта.

    ![Скопируйте app_offline](deploying-a-code-update/_static/image7.png)
8. Перейдите по URL-АДРЕСУ промежуточный сайт. Вы увидите, что *приложения\_offline.htm* страницы будет отображаться вместо домашней страницы.

    ![App_offline.htm в окне браузера](deploying-a-code-update/_static/image8.png)

Теперь вы готовы к развертыванию для промежуточного хранения.

## <a name="deploy-the-code-update-to-staging-and-production"></a>Развернуть обновление кода для промежуточной и производственной сред

1. В **веб-публикация одним щелкните** инструментов, выберите **промежуточной** профиль публикации, а затем нажмите кнопку **веб-публикация**.

    Visual Studio развертывает обновленное приложение и открывает в браузере домашнюю страницу. *Приложения\_offline.htm* отображается файл. Перед началом тестирования для проверки успешного развертывания, необходимо удалить *приложения\_offline.htm* файла.
2. Вернитесь в средстве FTP и удалите **приложения\_offline.htm** из промежуточный сайт.
3. В браузере откройте страницу инструкторов в промежуточный сайт и выберите инструктор, чтобы убедиться, что обновление было успешно развернуто.
4. Выполните ту же процедуру для рабочей среды, как и для промежуточного хранения.

<a id="specificfiles"></a>

## <a name="reviewing-changes-and-deploying-specific-files"></a>Просмотр изменений и развертывании определенные файлы

Visual Studio 2012 также предоставляет возможность развертывания отдельных файлов. Для выбранного файла можно просмотреть различия между локальной версией и развернутой версии, развертывание файла в целевой среде или скопировать файл с целевой среде для локального проекта. В этом разделе учебника вы научитесь использовать эти функции.

### <a name="make-a-change-to-deploy"></a>Изменения для развертывания

1. Откройте *Content/Site.css*и найти блок для `body` тег.
2. Измените значение `background-color` из `#fff` для `darkblue`.

    [!code-css[Main](deploying-a-code-update/samples/sample4.css?highlight=2)]

### <a name="view-the-change-in-the-publish-preview-window"></a>Просмотр изменений в окне Просмотр публикации

При использовании **веб-публикация** мастера для публикации проекта, вы увидите, что изменения будут опубликованы, дважды щелкнув файл в **предварительного просмотра** окна.

1. Щелкните правой кнопкой мыши проект ContosoUniversity и нажмите кнопку **публикации**.
2. Из **профиль** раскрывающемся списке выберите **тест** профиль публикации.
3. Нажмите кнопку **предварительного просмотра**, а затем нажмите кнопку **начать просмотр**.
4. В **предварительного просмотра** панели, дважды щелкните **Site.css**.

    ![Дважды щелкните файл Site.css](deploying-a-code-update/_static/image9.png)

    **Предварительного просмотра изменений** диалогового окна отображается предварительный просмотр изменений, которые будут развернуты.

    ![Просмотр изменений в Site.css](deploying-a-code-update/_static/image10.png)

    Если дважды щелкнуть *Web.config* файла, **предварительного просмотра изменений** диалогового окна показан результат сборки конфигурации преобразования и преобразования профиля публикации. На этом этапе вы еще не все, что приведет к *Web.config* файла на сервере, чтобы изменить, таким образом, чтобы ожидать без изменений. Тем не менее **предварительного просмотра изменений** окне неправильно отображаются два изменения. Похоже, два XML-элементы будут удалены. Эти элементы добавляются в процессе публикации, при выборе **выполнять миграции Code First при запуске приложения** Code First класса контекста. Сравнение выполняется перед добавляет в процессе публикации этих элементов, так выглядит так, будто они удаляются несмотря на то, что они не будут удалены. Эта ошибка будет исправлена в будущих выпусках.
5. Нажмите кнопку **Закрыть**.
6. Нажмите кнопку **Опубликовать**.
7. При открытии обозревателя на домашнюю страницу сайта теста, нажмите клавиши CTRL + F5, чтобы приведут к жестких обновлению, чтобы увидеть эффект от изменения CSS.

    ![Эффект изменения CSS](deploying-a-code-update/_static/image11.png)
8. Закройте браузер.

### <a name="publish-specific-files-from-solution-explorer"></a>Опубликовать определенные файлы из обозревателя решений

Предположим, что вы не синим фоном, например чтобы восстановить исходное значение цвета. В этом разделе необходимо восстановить исходные настройки путем публикации определенного файла непосредственно из **обозревателе решений**.

1. Откройте *Content/Site.css* и восстановление `background-color` параметру `#fff`.
2. В **обозревателе решений**, щелкните правой кнопкой мыши *Content/Site.css* файла.

    В контекстном меню показывает три параметров публикации.

    ![Публиковать параметры из обозревателя решений](deploying-a-code-update/_static/image12.png)
3. Нажмите кнопку **Просмотр изменений в Site.css**.

    Откроется окно, показывающих различия между локального файла и его версии в целевой среде.

    ![Diff-Content/Site.css](deploying-a-code-update/_static/image13.png)
4. В **обозревателе решений**, щелкните правой кнопкой мыши **Site.css** еще раз и нажмите кнопку **публикации Site.css**.

    **Действия публикации Web** в окне отображаются опубликованные файл.

    ![Действие публикации окне](deploying-a-code-update/_static/image14.png)
5. Откройте в браузере `http://localhost/contosouniversity` URL-адрес и нажмите клавишу CTRL + F5, чтобы вызвать жесткой обновления, чтобы выявить эффект от CSS изменения.

    ![Домашняя страница с обычной CSS](deploying-a-code-update/_static/image15.png)
6. Закройте браузер.

## <a name="summary"></a>Сводка

Теперь вы увидели несколько способов развертывания обновления приложения, не связанных с изменениями в базе данных, и вы знаете, как для предварительного просмотра изменения, убедитесь, что будут обновлены ожидаемых. Страница инструкторов теперь имеет **курсов обучения** раздела.

![Страница инструкторов с курсов обучения](deploying-a-code-update/_static/image16.png)

Далее учебника показано, как развернуть изменение базы данных: для базы данных и странице инструкторов добавите поля Дата рождения.

>[!div class="step-by-step"]
[Назад](deploying-to-production.md)
[Вперед](deploying-a-database-update.md)
