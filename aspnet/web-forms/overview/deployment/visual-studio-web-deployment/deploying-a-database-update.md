---
uid: web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-database-update
title: "ASP.NET веб-развертывания с помощью Visual Studio: развертывание обновления базы данных | Документы Microsoft"
author: tdykstra
description: "Этот учебник ряд показано развертывание ASP.NET (публикации) веб-приложения для веб-приложениях службы приложений Azure или стороннего поставщика услуг размещения, Пол..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/15/2013
ms.topic: article
ms.assetid: 9cad0833-486a-4474-a7f3-7715542ec4ce
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-database-update
msc.type: authoredcontent
ms.openlocfilehash: 8e875a4282df78ec647579e74c3fbeabd2495fc2
ms.sourcegitcommit: 016f4d58663bcd442930227022de23fb3abee0b3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/12/2018
---
<a name="aspnet-web-deployment-using-visual-studio-deploying-a-database-update"></a>ASP.NET веб-развертывания с помощью Visual Studio: развертывание обновления базы данных
====================
По [Tom Dykstra](https://github.com/tdykstra)

[Загрузите начальный проект](http://go.microsoft.com/fwlink/p/?LinkId=282627)

> Этот учебник ряд показано развертывание ASP.NET (публикации) веб-приложения для веб-приложениях службы приложений Azure или стороннего поставщика услуг размещения, с помощью Visual Studio 2012 или Visual Studio 2010. Сведения о последовательности см. в разделе [в первом учебнике ряда](introduction.md).


## <a name="overview"></a>Обзор

В этом учебнике внести изменение базы данных или изменение связанного кода, тестирования изменений в Visual Studio, а затем развернуть обновление для тестирования, промежуточного хранения и рабочей среды.

Учебник сначала показано, как для обновления базы данных, который управляется миграции Code First и нажмите Далее показано, как обновить базу данных, используя поставщик dbDacFx.

Напоминание: Если вы получаете сообщение об ошибке или что-то не работает, как пройти учебник, не забудьте проверить [страницу устранения неполадок](troubleshooting.md).

## <a name="deploy-a-database-update-by-using-code-first-migrations"></a>Развертывание обновления базы данных с помощью Code First Migrations

В этом разделе добавьте столбец даты рождения для `Person` базовый класс для `Student` и `Instructor` сущности. Обновите страницу, отображающую инструктора данных, чтобы он отображал нового столбца. Наконец необходимо выполнить развертывание изменений для тестирования, промежуточного хранения и рабочей среде.

### <a name="add-a-column-to-a-table-in-the-application-database"></a>Добавить столбец в таблицу в базе данных приложения

1. В *ContosoUniversity.DAL* откройте проект *Person.cs* и добавьте следующее свойство в конце `Person` класса (должно быть две фигурные скобки после его закрытия):

    [!code-csharp[Main](deploying-a-database-update/samples/sample1.cs)]

    Затем обновите `Seed` метода, так что он содержит значение для нового столбца. Откройте *Migrations\Configuration.cs* и заменить блок кода, который начинается `var instructors = new List<Instructor>` с следующий блок кода, который содержит информацию о дате рождения:

    [!code-csharp[Main](deploying-a-database-update/samples/sample2.cs)]
2. Постройте решение, а затем откройте **консоль диспетчера пакетов** окна. Убедитесь, что ContosoUniversity.DAL по-прежнему выбран в качестве **проекта по умолчанию**.
3. В **консоль диспетчера пакетов** выберите **ContosoUniversity.DAL** как **проекта по умолчанию**, а затем введите следующую команду:

    [!code-powershell[Main](deploying-a-database-update/samples/sample3.ps1)]

    По завершении этой команды Visual Studio открывает файл класса, который определяет новый `DbMIgration` класса и в `Up` метода можно просмотреть код, который создает новый столбец. `Up` Метод создает столбец при внесении изменений и `Down` метод удаляет столбец, если выполняется откат изменений.

    ![AddBirthDate_migration_code](deploying-a-database-update/_static/image1.png)
4. Постройте решение, а затем введите следующую команду в **консоль диспетчера пакетов** окна (Убедитесь, что по-прежнему выбран проект ContosoUniversity.DAL):

    [!code-powershell[Main](deploying-a-database-update/samples/sample4.ps1)]

    Платформа Entity Framework выполняется `Up` метода, а затем выполняется `Seed` метод.

### <a name="display-the-new-column-in-the-instructors-page"></a>Отображение нового столбца на странице инструкторов

1. В проекте ContosoUniversity откройте *Instructors.aspx* и добавить новое поле шаблон для отображения даты рождения. Добавьте его от тех, для назначения найма даты и office:

    [!code-aspx[Main](deploying-a-database-update/samples/sample5.aspx?highlight=9-17)]

    (Если отступа кода получает синхронизированы, можно нажать сочетание клавиш CTRL-K и CTRL + D автоматическое переформатирование файл.)
2. Запустите приложение и нажмите кнопку **инструкторов** ссылку.

    При загрузке страницы, вы видите, что она имеет новый поля «Дата рождения».

    ![Страница инструкторов с Дата рождения](deploying-a-database-update/_static/image2.png)
3. Закройте браузер.

### <a name="deploy-the-database-update"></a>Развертывание обновления базы данных

1. В **обозревателе решений** выберите ContosoUniversity проект.
2. В **веб-публикация одним щелкните** инструментов, нажмите кнопку **тест** профиль публикации, а затем нажмите кнопку **веб-публикация**. (Если отключена панели инструментов, выберите проект ContosoUniversity в **обозревателе решений**.)

    Visual Studio развертывает обновленное приложение, и в браузере будет открыта на домашнюю страницу.
3. Запустите **инструкторов** страницу, чтобы убедиться, что обновление было успешно развернуто.

    Когда приложение пытается получить доступ к базе данных для этой страницы, Code First обновляет схему базы данных и запускает `Seed` метод. При отображении страницы, вы видите ожидаемых **Дата рождения** столбец с датами в нем.
4. В **веб-публикация одним щелкните** инструментов, нажмите кнопку **промежуточной** профиль публикации, а затем нажмите кнопку **веб-публикация**.
5. Запустите **инструкторов** страницы размещения, чтобы убедиться, что обновление было успешно развернуто.
6. В **веб-публикация одним щелкните** инструментов, нажмите кнопку **рабочей** профиль публикации, а затем нажмите кнопку **веб-публикация**.
7. Запустите **инструкторов** страницы в эксплуатацию, чтобы убедиться, что обновление было успешно развернуто.

    Для обновления приложения рабочей, который включает в себя изменение базы данных будет обычно также перевести приложение в автономный режим во время развертывания с помощью *приложения\_offline.htm*, как показано в предыдущем учебнике.

## <a name="deploy-a-database-update-by-using-the-dbdacfx-provider"></a>Развертывание обновления базы данных с помощью поставщик dbDacFx

В этом разделе добавьте *комментарии* столбец *пользователя* таблицы в базе данных членства и создание страницы, которая позволяет отображать и изменять комментарии для каждого пользователя. Затем необходимо выполнить развертывание изменений для тестирования, промежуточного хранения и рабочей среде.

### <a name="add-a-column-to-a-table-in-the-membership-database"></a>Добавить столбец в таблицу в базе данных членства

1. В Visual Studio откройте **обозреватель объектов SQL Server**.
2. Разверните **(localdb) \v11.0**, разверните **баз данных**, разверните **aspnet ContosoUniversity** (не **aspnet ContosoUniversity одной рабочей**) а затем разверните **таблиц**.

    Если вы не видите **(localdb) \v11.0** под **SQL Server** узел, щелкните правой кнопкой мыши **SQL Server** и выберите команду **добавить SQL Server**. В **соединение с сервером** введите диалоговое окно *(localdb) \v11.0* как **имя сервера**, а затем нажмите кнопку **Connect**.

    Если вы не видите **aspnet ContosoUniversity**, запустите проект и выполнить вход с помощью *администратора* учетные данные (пароль *devpwd*) и обновите  **Обозреватель объектов SQL Server** окна.
3. Щелкните правой кнопкой мыши **пользователей** , а затем выберите пункт **конструктор представлений**.

    ![Конструктор представлений SSOX](deploying-a-database-update/_static/image3.png)
4. В конструкторе добавьте *комментарии* столбца и сделать его *nvarchar(128)* и допускает значения NULL и нажмите кнопку **обновление**.

    ![Добавление столбца комментарии](deploying-a-database-update/_static/image4.png)
5. В **Просмотр обновлений базы данных** щелкните **обновление базы данных**.

    ![Просмотр обновлений базы данных](deploying-a-database-update/_static/image5.png)

### <a name="create-a-page-to-display-and-edit-the-new-column"></a>Создание страницы для отображения и редактирования нового столбца

1. В **обозревателе решений**, щелкните правой кнопкой мыши **учетной записи** щелкните папку в проекте ContosoUniversity **добавить**и нажмите кнопку **новый элемент** .
2. Создайте новый **страницу веб-формы с помощью главного** и назовите его *UserInfo.aspx*. Примите имя по умолчанию *Site.Master* файл в качестве главной страницы.
3. Скопируйте следующую разметку в `MainContent` `Content` элемент (последний 3 `Content` элементы):

    [!code-aspx[Main](deploying-a-database-update/samples/sample6.aspx)]
4. Щелкните правой кнопкой мыши *UserInfo.aspx* и нажмите кнопку **Просмотр в браузере**.
5. Входа в систему на *администратора* учетные данные (пароль *devpwd*) и добавить примечания к пользователю, чтобы убедиться, что страница работает правильно.

    ![Страница сведений о пользователях](deploying-a-database-update/_static/image6.png)
6. Закройте браузер.

## <a name="deploy-the-database-update"></a>Развертывание обновления базы данных

Развертывание с помощью поставщик dbDacFx, необходимо просто выбрать **обновление базы данных** параметра в профиле публикации. Однако для первоначального развертывания при использовании этого параметра можно также настроить некоторые дополнительные скрипты SQL для выполнения: они по-прежнему в профиле, и необходимо предотвратить еще раз.

1. Откройте **веб-публикация** мастера, щелкнув правой кнопкой мыши проект ContosoUniversity команду **публикации**.
2. Выберите **тест** профиля.
3. Нажмите кнопку **параметры** вкладки.
4. В разделе **DefaultConnection**выберите **обновление базы данных**.
5. Отключите эти дополнительные сценарии, настроенные на выполнение для первоначального развертывания:

    1. Нажмите кнопку **настроить обновление базы данных**.
    2. В **Настройка обновления базы данных** диалоговое окно, снимите флажки рядом с *Grant.sql* и *aspnet данных dev.sql*.
    3. Нажмите кнопку **Закрыть**.
6. Нажмите кнопку **предварительного просмотра** вкладки.
7. В разделе **баз данных** и справа от **DefaultConnection**, нажмите кнопку **предварительной версии базы данных** ссылку.

    ![Предварительная версия базы данных](deploying-a-database-update/_static/image7.png)

    В окне просмотра отображается скрипт, который будет выполняться в целевой базы данных, чтобы сделать схемы базы данных совпадает со схемой базы данных-источника. Скрипт включает команду ALTER TABLE, который добавляет новый столбец.
8. Закрыть **предварительной версии базы данных** диалоговое окно, а затем щелкните **публикации**.

    Visual Studio развертывает обновленное приложение, и в браузере будет открыта на домашнюю страницу.
9. Откройте страницу сведений о пользователях (Добавить *Account/UserInfo.aspx* URL-адрес домашней страницы) чтобы проверить, что обновление было успешно развернуто. Вам потребуется войти, введя *администратора* и *devpwd*.

    Данные в таблицах не разворачивается по умолчанию и настроило сценарий развертывания данных для запуска, поэтому вы не найдете комментарий, который вы добавили в разработке. Можно добавить новый комментарий теперь в промежуточной, чтобы проверить, был развертывание изменений в базе данных, и страница работает правильно.
10. Выполните ту же процедуру для развертывания в промежуточной и производственной сред.

    Не забудьте отключить дополнительных сценариев. По сравнению с тестовый профиль отличается только что отключит только один сценарий в промежуточной и рабочей профили, так как они были настроены для запуска только *aspnet prod-data.sql*.

    Учетные данные для промежуточных и производственных: admin и prodpwd.

    Для обновления приложения рабочей, который включает в себя изменение базы данных обычно также может потребоваться приложение в автономный режим во время развертывания путем передачи *приложения\_offline.htm* перед публикацией и удалением После этого, как показано в [работу с предыдущим учебником](deploying-a-code-update.md).

## <a name="summary"></a>Сводка

Теперь, когда развертывание обновления приложения, включенные с помощью Code First Migrations и поставщик dbDacFx изменение базы данных.

![Страница инструкторов с Дата рождения](deploying-a-database-update/_static/image8.png)

![Страница сведений о пользователях](deploying-a-database-update/_static/image9.png)

Далее учебника показано, как выполнить развертывание с помощью командной строки.

>[!div class="step-by-step"]
[Назад](deploying-a-code-update.md)
[Вперед](command-line-deployment.md)
