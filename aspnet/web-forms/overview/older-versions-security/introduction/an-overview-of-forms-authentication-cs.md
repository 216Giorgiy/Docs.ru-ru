---
uid: web-forms/overview/older-versions-security/introduction/an-overview-of-forms-authentication-cs
title: Обзор проверки подлинности форм (C#) | Документы Microsoft
author: rick-anderson
description: Создание настраиваемых маршрутов
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/14/2008
ms.topic: article
ms.assetid: de2d65b9-aadc-42ba-abe1-4e87e66521a0
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/introduction/an-overview-of-forms-authentication-cs
msc.type: authoredcontent
ms.openlocfilehash: 1f64384d403f3cf81ffa3327a81b635bc71e2b44
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
ms.locfileid: "30892040"
---
<a name="an-overview-of-forms-authentication-c"></a><span data-ttu-id="376a7-103">Обзор проверки подлинности форм (C#)</span><span class="sxs-lookup"><span data-stu-id="376a7-103">An Overview of Forms Authentication (C#)</span></span>
====================
<span data-ttu-id="376a7-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="376a7-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="376a7-105">[Загрузить код](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_02_CS.zip) или [скачать PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial02_FormsAuth_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="376a7-105">[Download Code](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_02_CS.zip) or [Download PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial02_FormsAuth_cs.pdf)</span></span>

> <span data-ttu-id="376a7-106">В этом учебнике будет преобразован из простое описание реализации; в частности мы рассмотрим реализации проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="376a7-106">In this tutorial we will turn from mere discussion to implementation; in particular, we will look at implementing forms authentication.</span></span> <span data-ttu-id="376a7-107">Веб-приложение, мы начнем, создав в этом учебнике будет продолжать построено в последующих учебники по мере продвижения из простых форм проверки подлинности для членства и ролей.</span><span class="sxs-lookup"><span data-stu-id="376a7-107">The web application we start constructing in this tutorial will continue to be built upon in subsequent tutorials, as we move from simple forms authentication to membership and roles.</span></span>
> 
> <span data-ttu-id="376a7-108">См. Дополнительные сведения в этом видео по этой теме: [использование проверки подлинности форм в ASP.NET основные](# "using-basic-forms-authentication-in-aspnet").</span><span class="sxs-lookup"><span data-stu-id="376a7-108">Please see this video for more information on this topic: [Using Basic Forms Authentication in ASP.NET](# "using-basic-forms-authentication-in-aspnet").</span></span>


## <a name="introduction"></a><span data-ttu-id="376a7-109">Вступление</span><span class="sxs-lookup"><span data-stu-id="376a7-109">Introduction</span></span>

<span data-ttu-id="376a7-110">В [предыдущего учебника](security-basics-and-asp-net-support-cs.md) мы рассмотрели различные проверки подлинности, авторизации и пользователя учетной записи параметры, предоставляемые ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="376a7-110">In the [preceding tutorial](security-basics-and-asp-net-support-cs.md) we discussed the various authentication, authorization, and user account options provided by ASP.NET.</span></span> <span data-ttu-id="376a7-111">В этом учебнике будет преобразован из простое описание реализации; в частности мы рассмотрим реализации проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="376a7-111">In this tutorial we will turn from mere discussion to implementation; in particular, we will look at implementing forms authentication.</span></span> <span data-ttu-id="376a7-112">Веб-приложение, мы начнем, создав в этом учебнике будет продолжать построено в последующих учебники по мере продвижения из простых форм проверки подлинности для членства и ролей.</span><span class="sxs-lookup"><span data-stu-id="376a7-112">The web application we start constructing in this tutorial will continue to be built upon in subsequent tutorials, as we move from simple forms authentication to membership and roles.</span></span>

<span data-ttu-id="376a7-113">Этот учебник начинается с глубокое изучение рабочего процесса проверки подлинности форм, статьи, которые мы рассмотрели при предыдущем учебнике.</span><span class="sxs-lookup"><span data-stu-id="376a7-113">This tutorial begins with an in-depth look at the forms authentication workflow, a topic we touched upon in the previous tutorial.</span></span> <span data-ttu-id="376a7-114">После этого мы создадим веб-сайта ASP.NET через для демонстрации концепции проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="376a7-114">Following that, we will create an ASP.NET website through which to demo the concepts of forms authentication.</span></span> <span data-ttu-id="376a7-115">Далее мы настроить сайт для использования проверки подлинности форм, создания простой страницы входа и определение в коде, является ли проверка подлинности пользователя, и в этом случае имя пользователя, они вошли в систему.</span><span class="sxs-lookup"><span data-stu-id="376a7-115">Next, we will configure the site to use forms authentication, create a simple login page, and see how to determine, in code, whether a user is authenticated and, if so, the username they logged in with.</span></span>

<span data-ttu-id="376a7-116">Основные сведения о форм, рабочего процесса проверки подлинности в веб-приложения и создание страницы входа и выхода из нее будут все важные шаги в построении приложения ASP.NET, который поддерживает учетные записи пользователей и проверяет подлинность пользователей с помощью веб-страницы.</span><span class="sxs-lookup"><span data-stu-id="376a7-116">Understanding the forms authentication workflow, enabling it in a web application, and creating the login and logoff pages are all vital steps in building an ASP.NET application that supports user accounts and authenticates users through a web page.</span></span> <span data-ttu-id="376a7-117">Из-за этого — и так как эти учебники последовательно друг от друга - я рекомендую для работы этого учебника в полном объеме, прежде чем перейти к следующим даже если вы уже имели возможности настройки проверки подлинности форм в последние проекты.</span><span class="sxs-lookup"><span data-stu-id="376a7-117">Because of this – and because these tutorials build upon one another - I would encourage you to work through this tutorial in full before moving on to the next one even if you already have had experience configuring forms authentication in past projects.</span></span>

## <a name="understanding-the-forms-authentication-workflow"></a><span data-ttu-id="376a7-118">Основные сведения о рабочем процессе проверки подлинности форм</span><span class="sxs-lookup"><span data-stu-id="376a7-118">Understanding the Forms Authentication Workflow</span></span>

<span data-ttu-id="376a7-119">Когда среда выполнения ASP.NET обрабатывает запрос для ресурса ASP.NET, например страницы ASP.NET или веб-службы ASP.NET, запрос Возводит число событий во время его жизненного цикла.</span><span class="sxs-lookup"><span data-stu-id="376a7-119">When the ASP.NET runtime processes a request for an ASP.NET resource, such as an ASP.NET page or ASP.NET Web service, the request raises a number of events during its lifecycle.</span></span> <span data-ttu-id="376a7-120">Существуют события, возникающие в конце очень начальная и самого запроса, те, возникает, когда запрос прошел проверку подлинности и авторизацию, событие, вызываемое в случае необработанных исключений и т. д.</span><span class="sxs-lookup"><span data-stu-id="376a7-120">There are events raised at the very beginning and very end of the request, ones raised when the request is being authenticated and authorized, an event raised in the case of an unhandled exception, and so forth.</span></span> <span data-ttu-id="376a7-121">Чтобы просмотреть полный список событий, обратитесь к [событий HttpApplication объекта](https://msdn.microsoft.com/library/system.web.httpapplication_events.aspx).</span><span class="sxs-lookup"><span data-stu-id="376a7-121">To see a complete listing of the events, refer to the [HttpApplication object's events](https://msdn.microsoft.com/library/system.web.httpapplication_events.aspx).</span></span>

<span data-ttu-id="376a7-122">*Модули HTTP* — управляемые классы, в которых код выполняется в ответ на определенное событие в жизненном цикле запроса.</span><span class="sxs-lookup"><span data-stu-id="376a7-122">*HTTP Modules* are managed classes whose code is executed in response to a particular event in the request lifecycle.</span></span> <span data-ttu-id="376a7-123">ASP.NET поставляется с ряд модулей HTTP, выполнять основные задачи в фоновом.</span><span class="sxs-lookup"><span data-stu-id="376a7-123">ASP.NET ships with a number of HTTP Modules that perform essential tasks behind the scenes.</span></span> <span data-ttu-id="376a7-124">Ниже приведены два встроенных модулей HTTP, которые особенно важны для нашего обсуждения.</span><span class="sxs-lookup"><span data-stu-id="376a7-124">Two built-in HTTP Modules that are especially relevant to our discussion are:</span></span>

- <span data-ttu-id="376a7-125">**[`FormsAuthenticationModule`](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx)** — проверяет подлинность пользователя, проверяя билета проверки подлинности форм, который обычно входит в коллекцию файлов cookie.</span><span class="sxs-lookup"><span data-stu-id="376a7-125">**[`FormsAuthenticationModule`](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx)** – authenticates the user by inspecting the forms authentication ticket, which is typically included in the user's cookies collection.</span></span> <span data-ttu-id="376a7-126">Если присутствует не билета проверки подлинности форм, пользователь является анонимным.</span><span class="sxs-lookup"><span data-stu-id="376a7-126">If no forms authentication ticket is present, the user is anonymous.</span></span>
- <span data-ttu-id="376a7-127">**[`UrlAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx)** — Определяет, разрешено ли текущий пользователь доступ к запрошенному URL-АДРЕСУ.</span><span class="sxs-lookup"><span data-stu-id="376a7-127">**[`UrlAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx)** – determines whether or not the current user is authorized to access the requested URL.</span></span> <span data-ttu-id="376a7-128">Этот модуль определяет центр сертификации по журналу правил авторизации, указанные в файлах конфигурации приложения.</span><span class="sxs-lookup"><span data-stu-id="376a7-128">This module determines the authority by consulting the authorization rules specified in the application's configuration files.</span></span> <span data-ttu-id="376a7-129">ASP.NET также включает [ `FileAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx) , определяющая центр по журналу запрошенного файлы списки управления доступом.</span><span class="sxs-lookup"><span data-stu-id="376a7-129">ASP.NET also includes the [`FileAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx) that determines authority by consulting the requested file(s) ACLs.</span></span>

<span data-ttu-id="376a7-130">`FormsAuthenticationModule` Пытается проверить подлинность пользователя до `UrlAuthorizationModule` (и `FileAuthorizationModule`) выполнения.</span><span class="sxs-lookup"><span data-stu-id="376a7-130">The `FormsAuthenticationModule` attempts to authenticate the user prior to the `UrlAuthorizationModule` (and `FileAuthorizationModule`) executing.</span></span> <span data-ttu-id="376a7-131">Если пользователя, выполняющего запрос не авторизован для доступа к запрошенному ресурсу, модуль проверки завершается запрос и возвращает [HTTP 401 несанкционированный](http://www.checkupdown.com/status/E401.html) состояния.</span><span class="sxs-lookup"><span data-stu-id="376a7-131">If the user making the request is not authorized to access the requested resource, the authorization module terminates the request and returns an [HTTP 401 Unauthorized](http://www.checkupdown.com/status/E401.html) status.</span></span> <span data-ttu-id="376a7-132">В сценарии проверки подлинности Windows состояние HTTP 401 возвращается в браузере.</span><span class="sxs-lookup"><span data-stu-id="376a7-132">In Windows authentication scenarios, the HTTP 401 status is returned to the browser.</span></span> <span data-ttu-id="376a7-133">Этот код состояния заставляет браузер приглашение ввести свои учетные данные с помощью модального диалогового окна.</span><span class="sxs-lookup"><span data-stu-id="376a7-133">This status code causes the browser to prompt the user for their credentials via a modal dialog box.</span></span> <span data-ttu-id="376a7-134">С помощью форм, однако HTTP 401 несанкционированный никогда не отправляется в браузер, так как FormsAuthenticationModule обнаруживает это состояние и обновляет его и перенаправляет пользователя на страницу входа, а не (через [HTTP 302 перенаправления](http://www.checkupdown.com/status/E302.html) состояние).</span><span class="sxs-lookup"><span data-stu-id="376a7-134">With forms authentication, however, the HTTP 401 Unauthorized status is never sent to the browser because the FormsAuthenticationModule detects this status and modifies it to redirect the user to the login page instead (via an [HTTP 302 Redirect](http://www.checkupdown.com/status/E302.html) status).</span></span>

<span data-ttu-id="376a7-135">Для определения, если учетные данные пользователя являются допустимыми, и если да, для создания билета проверки подлинности форм и перенаправит пользователя назад на страницу они предпринималась попытка посетите — ответственность на страницу входа.</span><span class="sxs-lookup"><span data-stu-id="376a7-135">The login page's responsibility is to determine if the user's credentials are valid and, if so, to create a forms authentication ticket and redirect the user back to the page they were attempting to visit.</span></span> <span data-ttu-id="376a7-136">Билет проверки подлинности включена в последующие запросы к страницам на веб-сайт, который `FormsAuthenticationModule` используется для идентификации пользователя.</span><span class="sxs-lookup"><span data-stu-id="376a7-136">The authentication ticket is included in subsequent requests to the pages on the website, which the `FormsAuthenticationModule` uses to identify the user.</span></span>


![Рабочий процесс проверки подлинности форм](an-overview-of-forms-authentication-cs/_static/image1.png)

<span data-ttu-id="376a7-138">**Рис. 1**: рабочий процесс проверки подлинности форм</span><span class="sxs-lookup"><span data-stu-id="376a7-138">**Figure 1**: The Forms Authentication Workflow</span></span>


### <a name="remembering-the-authentication-ticket-across-page-visits"></a><span data-ttu-id="376a7-139">Запоминание билет проверки подлинности через посещений страницы</span><span class="sxs-lookup"><span data-stu-id="376a7-139">Remembering the Authentication Ticket Across Page Visits</span></span>

<span data-ttu-id="376a7-140">После входа в систему билета проверки подлинности форм должны отправляться обратно в веб-сервера для каждого запроса, чтобы пользователь останется вошедший в систему, при просмотре сайта.</span><span class="sxs-lookup"><span data-stu-id="376a7-140">After logging in, the forms authentication ticket must be sent back to the web server on each request so that the user remains logged in as they browse the site.</span></span> <span data-ttu-id="376a7-141">Обычно это выполняется путем размещения билет проверки подлинности в коллекцию файлов cookie.</span><span class="sxs-lookup"><span data-stu-id="376a7-141">This is typically accomplished by placing the authentication ticket in the user's cookies collection.</span></span> <span data-ttu-id="376a7-142">[Файлы cookie](http://en.wikipedia.org/wiki/HTTP_cookie) маленькие текстовые файлы, которые находятся на компьютере пользователя и передаются в заголовках HTTP для каждого запроса на веб-сайт, который создал файл cookie.</span><span class="sxs-lookup"><span data-stu-id="376a7-142">[Cookies](http://en.wikipedia.org/wiki/HTTP_cookie) are small text files that reside on the user's computer and are transmitted in the HTTP headers on each request to the website that created the cookie.</span></span> <span data-ttu-id="376a7-143">Таким образом после создания билета проверки подлинности форм и хранятся в файлах cookie в браузере, каждого последующих посещения этого узла отправляет билет проверки подлинности вместе с запросом, тем самым идентификатором пользователя.</span><span class="sxs-lookup"><span data-stu-id="376a7-143">Therefore, once the forms authentication ticket has been created and stored in the browser's cookies, each subsequent visit to that site sends the authentication ticket along with the request, thereby identifying the user.</span></span>

<span data-ttu-id="376a7-144">Одним из аспектов файлов cookie является срока, Дата и время, по которому браузер отменяет куки-файл.</span><span class="sxs-lookup"><span data-stu-id="376a7-144">One aspect of cookies is their expiration, which is the date and time at which the browser discards the cookie.</span></span> <span data-ttu-id="376a7-145">После истечения срока действия файла cookie проверки подлинности форм, пользователь может больше не проверку подлинности и поэтому становятся анонимный.</span><span class="sxs-lookup"><span data-stu-id="376a7-145">When the forms authentication cookie expires, the user can no longer be authenticated and therefore become anonymous.</span></span> <span data-ttu-id="376a7-146">Когда пользователь посещает из открытых терминала, скорее всего, они хотят их билет проверки подлинности для срока действия при закрытии обозревателя.</span><span class="sxs-lookup"><span data-stu-id="376a7-146">When a user is visiting from a public terminal, chances are they want their authentication ticket to expire when they close their browser.</span></span> <span data-ttu-id="376a7-147">При посещении из дома, однако этот же пользователь может потребоваться билет проверки подлинности для сохраненных между перезагрузками браузера, чтобы они не имеют повторно войти в каждый раз при посещении сайта.</span><span class="sxs-lookup"><span data-stu-id="376a7-147">When visiting from home, however, that same user might want the authentication ticket to be remembered across browser restarts so that they do not have to re-log in each time they visit the site.</span></span> <span data-ttu-id="376a7-148">Это решение обычно принимается пользователем в форме «Запомнить мои данные» флажок на странице входа.</span><span class="sxs-lookup"><span data-stu-id="376a7-148">This decision is often made by the user in the form of a "Remember me" checkbox on the login page.</span></span> <span data-ttu-id="376a7-149">На шаге 3 будут рассмотрены способы реализации флажок «Запомнить мои данные» на странице входа.</span><span class="sxs-lookup"><span data-stu-id="376a7-149">In Step 3 we will examine how to implement a "Remember me" checkbox in the login page.</span></span> <span data-ttu-id="376a7-150">В руководстве ниже адреса параметры времени ожидания билета проверки подлинности, подробно.</span><span class="sxs-lookup"><span data-stu-id="376a7-150">The following tutorial addresses the authentication ticket timeout settings in detail.</span></span>

> [!NOTE]
> <span data-ttu-id="376a7-151">Это возможно, агент пользователя, используемой для входа веб-сайта могут не поддерживать файлы cookie.</span><span class="sxs-lookup"><span data-stu-id="376a7-151">It is possible that the user agent used to log on to the website may not support cookies.</span></span> <span data-ttu-id="376a7-152">В этом случае ASP.NET можно использовать билетов проверки подлинности форм без поддержки файлов cookie.</span><span class="sxs-lookup"><span data-stu-id="376a7-152">In such a case, ASP.NET can use cookieless forms authentication tickets.</span></span> <span data-ttu-id="376a7-153">В этом режиме билет проверки подлинности кодируется в URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="376a7-153">In this mode, the authentication ticket is encoded into the URL.</span></span> <span data-ttu-id="376a7-154">Мы рассмотрим использование билетов без поддержки файлов cookie проверки подлинности и как они создаются и управляются в следующем уроке.</span><span class="sxs-lookup"><span data-stu-id="376a7-154">We will look at when cookieless authentication tickets are used and how they are created and managed in the next tutorial.</span></span>


### <a name="the-scope-of-forms-authentication"></a><span data-ttu-id="376a7-155">Область проверки подлинности форм</span><span class="sxs-lookup"><span data-stu-id="376a7-155">The Scope of Forms Authentication</span></span>

<span data-ttu-id="376a7-156">`FormsAuthenticationModule` — Управляемый код, который является частью среды выполнения ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="376a7-156">The `FormsAuthenticationModule` is managed code that is part of the ASP.NET runtime.</span></span> <span data-ttu-id="376a7-157">До версии 7 корпорации Майкрософт [Internet Information Services (IIS)](https://www.iis.net/) веб-сервере произошла distinct барьер между HTTP-конвейера служб IIS и среды выполнения ASP.NET конвейера.</span><span class="sxs-lookup"><span data-stu-id="376a7-157">Prior to version 7 of Microsoft's [Internet Information Services (IIS)](https://www.iis.net/) web server, there was a distinct barrier between IIS's HTTP pipeline and the ASP.NET runtime's pipeline.</span></span> <span data-ttu-id="376a7-158">Иными словами, в IIS 6 и более ранних версиях `FormsAuthenticationModule` выполняется только в случае, когда запрос делегируется среды выполнения ASP.NET из IIS.</span><span class="sxs-lookup"><span data-stu-id="376a7-158">In short, in IIS 6 and earlier, the `FormsAuthenticationModule` only executes when a request is delegated from IIS to the ASP.NET runtime.</span></span> <span data-ttu-id="376a7-159">По умолчанию службы IIS обрабатывает статического содержимого, сам — как страницы HTML и CSS и файлы изображений — и только передает запросы для среды выполнения ASP.NET при запросе страницы с расширением .aspx, .asmx и .ashx.</span><span class="sxs-lookup"><span data-stu-id="376a7-159">By default, IIS processes static content itself – like HTML pages and CSS and image files – and only hands off requests to the ASP.NET runtime when a page with an extension of .aspx, .asmx, or .ashx is requested.</span></span>

<span data-ttu-id="376a7-160">IIS 7, однако позволяет для интеграции служб IIS и ASP.NET конвейеров.</span><span class="sxs-lookup"><span data-stu-id="376a7-160">IIS 7, however, allows for integrated IIS and ASP.NET pipelines.</span></span> <span data-ttu-id="376a7-161">Некоторые параметры конфигурации можно настроить службы IIS 7 для вызова FormsAuthenticationModule для *все* запросов.</span><span class="sxs-lookup"><span data-stu-id="376a7-161">With a few configuration settings you can setup IIS 7 to invoke the FormsAuthenticationModule for *all* requests.</span></span> <span data-ttu-id="376a7-162">Кроме того в службах IIS 7 можно определить правила авторизации URL-адрес для файлов любого типа.</span><span class="sxs-lookup"><span data-stu-id="376a7-162">Furthermore, with IIS 7 you can define URL authorization rules for files of any type.</span></span> <span data-ttu-id="376a7-163">Дополнительные сведения см. в разделе [изменений между IIS6 и безопасность IIS7](https://www.iis.net/learn/get-started/whats-new-in-iis-7/changes-in-security-between-iis-60-and-iis-7-and-above), [ваш веб-платформы безопасности](https://www.iis.net/learn/get-started/whats-new-in-iis-7/iis7-and-above-security-improvements), и [авторизации URL-адресов для IIS7 основные сведения о](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span><span class="sxs-lookup"><span data-stu-id="376a7-163">For more information, see [Changes Between IIS6 and IIS7 Security](https://www.iis.net/learn/get-started/whats-new-in-iis-7/changes-in-security-between-iis-60-and-iis-7-and-above), [Your Web Platform Security](https://www.iis.net/learn/get-started/whats-new-in-iis-7/iis7-and-above-security-improvements), and [Understanding IIS7 URL Authorization](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span></span>

<span data-ttu-id="376a7-164">Короче говоря, в версиях, предшествующих IIS 7, можно использовать только проверку подлинности форм для защиты ресурсов, которые обрабатываются средой выполнения ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="376a7-164">Long story short, in versions prior to IIS 7, you can only use forms authentication to protect resources handled by the ASP.NET runtime.</span></span> <span data-ttu-id="376a7-165">Аналогичным образом правила авторизации URL-адреса применяются только к ресурсам, которые обрабатываются средой выполнения ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="376a7-165">Likewise, URL authorization rules are only applied to resources handled by the ASP.NET runtime.</span></span> <span data-ttu-id="376a7-166">Но в службах IIS 7 можно интегрировать FormsAuthenticationModule и UrlAuthorizationModule в конвейер HTTP служб IIS, тем самым расширяя этих функциональных возможностей для всех запросов.</span><span class="sxs-lookup"><span data-stu-id="376a7-166">But with IIS 7 it is possible to integrate the FormsAuthenticationModule and UrlAuthorizationModule into IIS's HTTP pipeline, thereby extending this functionality to all requests.</span></span>

## <a name="step-1-creating-an-aspnet-website-for-this-tutorial-series"></a><span data-ttu-id="376a7-167">Шаг 1: Создание веб-сайта ASP.NET для этого учебника ряда</span><span class="sxs-lookup"><span data-stu-id="376a7-167">Step 1: Creating an ASP.NET Website for this Tutorial Series</span></span>

<span data-ttu-id="376a7-168">Для достижения наиболее широкой аудитории, веб-узла ASP.NET, мы будем строить во всей этой серии будет создан с корпорации Майкрософт бесплатную версию Visual Studio 2008 [Visual Web Developer 2008](https://www.microsoft.com/express/vwd/).</span><span class="sxs-lookup"><span data-stu-id="376a7-168">In order to reach the widest possible audience, the ASP.NET website we will be building throughout this series will be created with Microsoft's free version of Visual Studio 2008, [Visual Web Developer 2008](https://www.microsoft.com/express/vwd/).</span></span> <span data-ttu-id="376a7-169">Мы будем реализовывать `SqlMembershipProvider` хранилища пользователя в [Microsoft SQL Server 2005 Express Edition](https://msdn.microsoft.com/sql/Aa336346.aspx) базы данных.</span><span class="sxs-lookup"><span data-stu-id="376a7-169">We will implement the `SqlMembershipProvider` user store in a [Microsoft SQL Server 2005 Express Edition](https://msdn.microsoft.com/sql/Aa336346.aspx) database.</span></span> <span data-ttu-id="376a7-170">При использовании Visual Studio 2005 или другого выпуска Visual Studio 2008 или SQL Server, не беспокойтесь — действия будут практически одинаковых и любой нетривиальный различия будет необходимо обратить внимание.</span><span class="sxs-lookup"><span data-stu-id="376a7-170">If you are using Visual Studio 2005 or a different edition of Visual Studio 2008 or SQL Server, don't worry - the steps will be nearly identical and any non-trivial differences will be pointed out.</span></span>

> [!NOTE]
> <span data-ttu-id="376a7-171">Демонстрация веб-приложения, используемые в каждом учебнике доступен для загрузки.</span><span class="sxs-lookup"><span data-stu-id="376a7-171">The demo web application used in each tutorial is available as a download.</span></span> <span data-ttu-id="376a7-172">Это загружаемый приложение создано с помощью Visual Web Developer 2008, предназначенных для .NET Framework версии 3.5.</span><span class="sxs-lookup"><span data-stu-id="376a7-172">This downloadable application was created with Visual Web Developer 2008 targeted for the .NET Framework version 3.5.</span></span> <span data-ttu-id="376a7-173">Поскольку приложение предназначено для .NET 3.5, его файл Web.config содержит элементы конфигурации дополнительные, зависящие от 3.5.</span><span class="sxs-lookup"><span data-stu-id="376a7-173">Since the application is targeted for .NET 3.5, its Web.config file includes additional, 3.5-specific configuration elements.</span></span> <span data-ttu-id="376a7-174">Короче говоря, если у вас еще установка .NET 3.5 на компьютере, затем загружаемая веб-приложение не будет работать без удаления разметку 3.5 из файла Web.config.</span><span class="sxs-lookup"><span data-stu-id="376a7-174">Long story short, if you have yet to install .NET 3.5 on your computer then the downloadable web application will not work without first removing the 3.5-specific markup from Web.config.</span></span>


<span data-ttu-id="376a7-175">Прежде чем мы можно настроить проверку подлинности форм, необходимо сначала на веб-сайте ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="376a7-175">Before we can configure forms authentication, we first need an ASP.NET website.</span></span> <span data-ttu-id="376a7-176">Начните с создания нового файла на основе системы веб-узла ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="376a7-176">Start by creating a new file system-based ASP.NET website.</span></span> <span data-ttu-id="376a7-177">Для этого запустите Visual Web Developer и перейдите в меню «файл» и выберите новый веб-сайт, отображает диалоговое окно нового веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="376a7-177">To accomplish this, launch Visual Web Developer and then go to the File menu and choose New Web Site, displaying the New Web Site dialog box.</span></span> <span data-ttu-id="376a7-178">Выберите шаблон веб-сайт ASP.NET, указывает расположение раскрывающегося списка в файловой системе, выберите папку для размещения веб-сайта и выбранный язык C#.</span><span class="sxs-lookup"><span data-stu-id="376a7-178">Choose the ASP.NET Web Site template, set the Location drop-down list to File System, choose a folder to place the web site, and set the language to C#.</span></span> <span data-ttu-id="376a7-179">Это создаст новый веб-сайт со страницей Default.aspx ASP.NET, приложение\_папки данных и файл Web.config.</span><span class="sxs-lookup"><span data-stu-id="376a7-179">This will create a new web site with a Default.aspx ASP.NET page, an App\_Data folder, and a Web.config file.</span></span>

> [!NOTE]
> <span data-ttu-id="376a7-180">Visual Studio поддерживает два режима управления проектом: проекты веб-сайтов и проектов веб-приложений.</span><span class="sxs-lookup"><span data-stu-id="376a7-180">Visual Studio supports two modes of project management: Web Site Projects and Web Application Projects.</span></span> <span data-ttu-id="376a7-181">Проектов веб-сайтов отсутствует в файле проекта, тогда как проекты веб-приложений имитировать архитектуру проекта в Visual Studio .NET 2002/2003 — они включают файл проекта и компиляции исходного кода проекта в единую сборку, которая размещается в папке/Bin.</span><span class="sxs-lookup"><span data-stu-id="376a7-181">Web Site Projects lack a project file, whereas Web Application Projects mimic the project architecture in Visual Studio .NET 2002/2003 – they include a project file and compile the project's source code into a single assembly, which is placed in the /bin folder.</span></span> <span data-ttu-id="376a7-182">Проекты Visual Studio 2005 изначально только поддерживаемые веб-сайта, несмотря на то, что модель проекта веб-приложения был снова с пакетом обновления 1; Visual Studio 2008 предлагает обе модели проекта.</span><span class="sxs-lookup"><span data-stu-id="376a7-182">Visual Studio 2005 initially only supported Web Site Projects, although the Web Application Project model was reintroduced with Service Pack 1; Visual Studio 2008 offers both project models.</span></span> <span data-ttu-id="376a7-183">Visual Web Developer 2005 и 2008 выпусков, однако поддерживают только проекты веб-сайтов.</span><span class="sxs-lookup"><span data-stu-id="376a7-183">The Visual Web Developer 2005 and 2008 editions, however, only support Web Site Projects.</span></span> <span data-ttu-id="376a7-184">Будет использоваться в модели проекта веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="376a7-184">I will be using the Web Site Project model.</span></span> <span data-ttu-id="376a7-185">Если вы используете отличных от Express edition и хотите использовать [модель проекта веб-приложения](https://msdn.microsoft.com/library/aa730880%28vs.80%29.aspx) вместо этого вы можете сделать это, но имейте в виду, что может быть некоторые несоответствия между отображаемые на экране и действия, которые необходимо выполнить сравнение показано снимки экрана и инструкции, приведенные в этих учебниках.</span><span class="sxs-lookup"><span data-stu-id="376a7-185">If you are using a non-Express edition and want to use the [Web Application Project model](https://msdn.microsoft.com/library/aa730880%28vs.80%29.aspx) instead, feel free to do so but be aware that there may be some discrepancies between what you see on your screen and the steps you must take versus the screen shots shown and instructions provided in these tutorials.</span></span>


<span data-ttu-id="376a7-186">[![Создать новый файл на основе системы веб-сайта](an-overview-of-forms-authentication-cs/_static/image3.png)](an-overview-of-forms-authentication-cs/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="376a7-186">[![Create a New File System-Based Web Site](an-overview-of-forms-authentication-cs/_static/image3.png)](an-overview-of-forms-authentication-cs/_static/image2.png)</span></span>

<span data-ttu-id="376a7-187">**На рисунке 2**: Создание веб-сайта New File System-Based ([Просмотр полноразмерное изображение](an-overview-of-forms-authentication-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="376a7-187">**Figure 2**: Create a New File System-Based Web Site ([Click to view full-size image](an-overview-of-forms-authentication-cs/_static/image4.png))</span></span>


### <a name="adding-a-master-page"></a><span data-ttu-id="376a7-188">Добавление главной страницы</span><span class="sxs-lookup"><span data-stu-id="376a7-188">Adding a Master Page</span></span>

<span data-ttu-id="376a7-189">Добавьте в новой главной страницы сайта в корневую папку с именем Site.master.</span><span class="sxs-lookup"><span data-stu-id="376a7-189">Next, add a new Master Page to the site in the root directory named Site.master.</span></span> <span data-ttu-id="376a7-190">[Главные страницы](https://msdn.microsoft.com/library/wtxbf3hh.aspx) страницы разработчик может определить шаблон сайта, могут применяться к страницам ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="376a7-190">[Master pages](https://msdn.microsoft.com/library/wtxbf3hh.aspx) enable a page developer to define a site-wide template that can be applied to ASP.NET pages.</span></span> <span data-ttu-id="376a7-191">Основным преимуществом главные страницы — что общий внешний вид веб-узла можно определить в одном месте, что делает его легко обновить или изменить макет веб-узла.</span><span class="sxs-lookup"><span data-stu-id="376a7-191">The main benefit of master pages is that the site's overall appearance can be defined in a single location, thereby making it easy to update or tweak the site's layout.</span></span>


<span data-ttu-id="376a7-192">[![Добавить главную страницу Site.master на веб-сайт с именем](an-overview-of-forms-authentication-cs/_static/image6.png)](an-overview-of-forms-authentication-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="376a7-192">[![Add a Master Page Named Site.master to the Website](an-overview-of-forms-authentication-cs/_static/image6.png)](an-overview-of-forms-authentication-cs/_static/image5.png)</span></span>

<span data-ttu-id="376a7-193">**Рис. 3**: Добавление Site.master Master с именем страницы на веб-сайт ([Просмотр полноразмерное изображение](an-overview-of-forms-authentication-cs/_static/image7.png))</span><span class="sxs-lookup"><span data-stu-id="376a7-193">**Figure 3**: Add a Master Page Named Site.master to the Website ([Click to view full-size image](an-overview-of-forms-authentication-cs/_static/image7.png))</span></span>


<span data-ttu-id="376a7-194">Определите макет для сайта всех страниц на главной странице.</span><span class="sxs-lookup"><span data-stu-id="376a7-194">Define the site-wide page layout here in the master page.</span></span> <span data-ttu-id="376a7-195">Можно использовать представление проектирования и добавьте любые макета или веб-элементы управления, или можно вручную добавить разметку вручную в представлении источника.</span><span class="sxs-lookup"><span data-stu-id="376a7-195">You can use the Design view and add whatever Layout or Web controls you need, or you can manually add the markup by hand in the Source view.</span></span> <span data-ttu-id="376a7-196">Я структурированный макет my главной страницы, чтобы имитировать макета, используемого в моей *[работа с данными в ASP.NET 2.0](../../data-access/index.md)* учебника ряда (см. рис. 4).</span><span class="sxs-lookup"><span data-stu-id="376a7-196">I structured my master page's layout to mimic the layout used in my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series (see Figure 4).</span></span> <span data-ttu-id="376a7-197">На главной странице используется [каскадных таблиц стилей](http://www.w3schools.com/css/default.asp) для положения и определения в файле Style.css (включенный в этот учебник загрузки).</span><span class="sxs-lookup"><span data-stu-id="376a7-197">The master page uses [cascading style sheets](http://www.w3schools.com/css/default.asp) for positioning and styles with the CSS settings defined in the file Style.css (which is included in this tutorial's associated download).</span></span> <span data-ttu-id="376a7-198">Пока не удастся найти из приведенной ниже разметки, определенные правила CSS таким образом, что Навигация &lt;div&gt;элемента содержимого с абсолютным позиционированием, чтобы он отображается слева и имеет фиксированную ширину 200 пикселей.</span><span class="sxs-lookup"><span data-stu-id="376a7-198">While you cannot tell from the markup shown below, the CSS rules are defined such that the navigation &lt;div&gt;'s content is absolutely positioned so that it appears on the left and has a fixed width of 200 pixels.</span></span>

[!code-aspx[Main](an-overview-of-forms-authentication-cs/samples/sample1.aspx)]

<span data-ttu-id="376a7-199">На главной странице определяются как статические, так и области, которые можно изменить с помощью страниц ASP.NET, в которых используется Главная страница.</span><span class="sxs-lookup"><span data-stu-id="376a7-199">A master page defines both the static page layout and the regions that can be edited by the ASP.NET pages that use the master page.</span></span> <span data-ttu-id="376a7-200">Изменяемые области обозначаются `ContentPlaceHolder` элемента управления, который можно увидеть в содержимом &lt;div&gt;.</span><span class="sxs-lookup"><span data-stu-id="376a7-200">These content editable regions are indicated by the `ContentPlaceHolder` control, which can be seen within the content &lt;div&gt;.</span></span> <span data-ttu-id="376a7-201">Наш Главная страница имеет один `ContentPlaceHolder` (тегу), но может быть и несколько главной страницы.</span><span class="sxs-lookup"><span data-stu-id="376a7-201">Our master page has a single `ContentPlaceHolder` (MainContent), but master page's may have multiple ContentPlaceHolders.</span></span>

<span data-ttu-id="376a7-202">С разметки, введенного выше переключением в представление конструирования отображается макет главной страницы.</span><span class="sxs-lookup"><span data-stu-id="376a7-202">With the markup entered above, switching to the Design view shows the master page's layout.</span></span> <span data-ttu-id="376a7-203">Все страницы ASP.NET, использующие этот главной страницы будет иметь этот универсальный макет с возможностью указать разметку для `MainContent` области.</span><span class="sxs-lookup"><span data-stu-id="376a7-203">Any ASP.NET pages that use this master page will have this uniform layout, with the ability to specify the markup for the `MainContent` region.</span></span>


<span data-ttu-id="376a7-204">[![Главная страница, при просмотре в режиме конструктора](an-overview-of-forms-authentication-cs/_static/image9.png)](an-overview-of-forms-authentication-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="376a7-204">[![The Master Page, When Viewed Through the Design View](an-overview-of-forms-authentication-cs/_static/image9.png)](an-overview-of-forms-authentication-cs/_static/image8.png)</span></span>

<span data-ttu-id="376a7-205">**Рис. 4**: главной страницы, при просмотре через конструктор ([Просмотр полноразмерное изображение](an-overview-of-forms-authentication-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="376a7-205">**Figure 4**: The Master Page, When Viewed Through the Design View ([Click to view full-size image](an-overview-of-forms-authentication-cs/_static/image10.png))</span></span>


### <a name="creating-content-pages"></a><span data-ttu-id="376a7-206">Создание страницы содержимого</span><span class="sxs-lookup"><span data-stu-id="376a7-206">Creating Content Pages</span></span>

<span data-ttu-id="376a7-207">На этом этапе у нас есть страница Default.aspx в сайте, но не использует главную страницу, которую мы только что создали.</span><span class="sxs-lookup"><span data-stu-id="376a7-207">At this point we have a Default.aspx page in our website, but it does not use the master page we just created.</span></span> <span data-ttu-id="376a7-208">Хотя и существует возможность управлять декларативная разметка веб-страницы, использующие эталонную страницу, если страница не содержит данных, все еще проще просто удалить страницу, а затем добавьте его в проект, указав главную страницу для использования.</span><span class="sxs-lookup"><span data-stu-id="376a7-208">While it is possible to manipulate the declarative markup of a web page to use a master page, if the page doesn't contain any content yet it is easier to just delete the page and re-add it to the project, specifying the master page to use.</span></span> <span data-ttu-id="376a7-209">Таким образом запуск, удалив файл Default.aspx из проекта.</span><span class="sxs-lookup"><span data-stu-id="376a7-209">Therefore, start by deleting Default.aspx from the project.</span></span>

<span data-ttu-id="376a7-210">Далее щелкните правой кнопкой мыши имя проекта в обозревателе решений и выберите команду Добавить новый веб-форму с именем Default.aspx.</span><span class="sxs-lookup"><span data-stu-id="376a7-210">Next, right-click on the project name in the Solution Explorer and choose to add a new Web Form named Default.aspx.</span></span> <span data-ttu-id="376a7-211">На этот раз, установите флажок «Выбрать главную страницу» и выберите главную страницу Site.master из списка.</span><span class="sxs-lookup"><span data-stu-id="376a7-211">This time, check the "Select master page" checkbox and choose the Site.master master page from the list.</span></span>


<span data-ttu-id="376a7-212">[![Добавьте новую страницу Default.aspx, выбрав для выбора главной страницы](an-overview-of-forms-authentication-cs/_static/image12.png)](an-overview-of-forms-authentication-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="376a7-212">[![Add a New Default.aspx Page Choosing to Select a Master Page](an-overview-of-forms-authentication-cs/_static/image12.png)](an-overview-of-forms-authentication-cs/_static/image11.png)</span></span>

<span data-ttu-id="376a7-213">**Рис. 5**: Добавление новых Default.aspx страницы решили Выбор главной страницы ([Просмотр полноразмерное изображение](an-overview-of-forms-authentication-cs/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="376a7-213">**Figure 5**: Add a New Default.aspx Page Choosing to Select a Master Page ([Click to view full-size image](an-overview-of-forms-authentication-cs/_static/image13.png))</span></span>


![Используйте Site.master главной страницы](an-overview-of-forms-authentication-cs/_static/image14.png)

<span data-ttu-id="376a7-215">**Рис. 6**: используйте Site.master главной страницы</span><span class="sxs-lookup"><span data-stu-id="376a7-215">**Figure 6**: Use the Site.master Master Page</span></span>


> [!NOTE]
> <span data-ttu-id="376a7-216">При использовании модели проекта веб-приложения в диалоговом окне Добавить новый элемент не включает флажок «Выбрать главную страницу».</span><span class="sxs-lookup"><span data-stu-id="376a7-216">If you are using the Web Application Project Model the Add New Item dialog box does not include a "Select master page" checkbox.</span></span> <span data-ttu-id="376a7-217">Вместо этого необходимо добавить элемент типа «Веб-форму содержимого».</span><span class="sxs-lookup"><span data-stu-id="376a7-217">Instead, you need to add an item of type "Web Content Form."</span></span> <span data-ttu-id="376a7-218">После выбора параметра «Форма веб-содержимого» и нажмите кнопку Добавить, Visual Studio отобразит же Select главного диалоговое окно показано на рис. 6.</span><span class="sxs-lookup"><span data-stu-id="376a7-218">After choosing the "Web Content Form" option and clicking Add, Visual Studio will display the same Select a Master dialog box shown in Figure 6.</span></span>


<span data-ttu-id="376a7-219">Новая страница Default.aspx декларативная разметка включает только @Page директивы, указав путь к главному страницы для главной страницы тегу ContentPlaceHolder файлов и управления содержимым.</span><span class="sxs-lookup"><span data-stu-id="376a7-219">The new Default.aspx page's declarative markup includes just a @Page directive specifying the path to the master page file and a Content control for the master page's MainContent ContentPlaceHolder.</span></span>

[!code-aspx[Main](an-overview-of-forms-authentication-cs/samples/sample2.aspx)]

<span data-ttu-id="376a7-220">Пока оставьте пустым Default.aspx.</span><span class="sxs-lookup"><span data-stu-id="376a7-220">For now, leave Default.aspx empty.</span></span> <span data-ttu-id="376a7-221">Мы будет возвращать его позже в этом учебнике для добавления содержимого.</span><span class="sxs-lookup"><span data-stu-id="376a7-221">We will return to it later in this tutorial to add content.</span></span>

> [!NOTE]
> <span data-ttu-id="376a7-222">Наш главной страницы содержит раздел для меню или другой интерфейс навигации.</span><span class="sxs-lookup"><span data-stu-id="376a7-222">Our master page includes a section for a menu or some other navigation interface.</span></span> <span data-ttu-id="376a7-223">В будущем учебнике мы создадим такой интерфейс.</span><span class="sxs-lookup"><span data-stu-id="376a7-223">We will create such an interface in a future tutorial.</span></span>

## <a name="step-2-enabling-forms-authentication"></a><span data-ttu-id="376a7-224">Шаг 2: Включение проверки подлинности форм</span><span class="sxs-lookup"><span data-stu-id="376a7-224">Step 2: Enabling Forms Authentication</span></span>

<span data-ttu-id="376a7-225">Когда ASP.NET веб-сайт создан теперь нам является возможность проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="376a7-225">With the ASP.NET website created, our next task is to enable forms authentication.</span></span> <span data-ttu-id="376a7-226">Указанные настройки проверки подлинности приложения с помощью [ `<authentication>` элемент](https://msdn.microsoft.com/library/532aee0e.aspx) в файле Web.config. `<authentication>` Элемент содержит один атрибут с именем mode, указывающее модель проверки подлинности, используемые приложением.</span><span class="sxs-lookup"><span data-stu-id="376a7-226">The application's authentication configuration is specified through the [`<authentication>` element](https://msdn.microsoft.com/library/532aee0e.aspx) in Web.config. The `<authentication>` element contains a single attribute named mode that specifies the authentication model used by the application.</span></span> <span data-ttu-id="376a7-227">Этот атрибут может принимать одно из следующих четырех значений:</span><span class="sxs-lookup"><span data-stu-id="376a7-227">This attribute can have one of the following four values:</span></span>

- <span data-ttu-id="376a7-228">**Windows** — как описано в предыдущем учебнике, когда приложение использует проверку подлинности Windows отвечает веб-сервера для проверки подлинности посетителя и обычно это осуществляется посредством Basic, Digest или встроенная проверка подлинности Windows Проверка подлинности.</span><span class="sxs-lookup"><span data-stu-id="376a7-228">**Windows** – as discussed in the preceding tutorial, when an application uses Windows authentication it is the web server's responsibility to authenticate the visitor, and this is usually done through Basic, Digest, or Integrated Windows authentication.</span></span>
- <span data-ttu-id="376a7-229">**Формы**— пользователи проходят проверку подлинности с помощью формы на веб-странице.</span><span class="sxs-lookup"><span data-stu-id="376a7-229">**Forms**– users are authenticated via a form on a web page.</span></span>
- <span data-ttu-id="376a7-230">**Passport**— пользователи проходят проверку подлинности с помощью Microsoft Passport Network.</span><span class="sxs-lookup"><span data-stu-id="376a7-230">**Passport**– users are authenticated using Microsoft's Passport Network.</span></span>
- <span data-ttu-id="376a7-231">**Нет**— модель проверки подлинности не используется; всех посетителей являются анонимными.</span><span class="sxs-lookup"><span data-stu-id="376a7-231">**None**– no authentication model is used; all visitors are anonymous.</span></span>

<span data-ttu-id="376a7-232">По умолчанию приложения ASP.NET используют проверку подлинности Windows.</span><span class="sxs-lookup"><span data-stu-id="376a7-232">By default, ASP.NET applications use Windows authentication.</span></span> <span data-ttu-id="376a7-233">Чтобы изменить тип проверки подлинности для форм проверки подлинности, затем, нам нужно изменить `<authentication>` атрибут mode элемента формы.</span><span class="sxs-lookup"><span data-stu-id="376a7-233">To change the authentication type to forms authentication, then, we need to modify the `<authentication>` element's mode attribute to Forms.</span></span>

<span data-ttu-id="376a7-234">Если проект еще не содержит файл Web.config, добавьте один теперь путем щелчка правой кнопкой мыши имя проекта в обозревателе решений и добавьте новый элемент и затем добавив файл веб-конфигурации.</span><span class="sxs-lookup"><span data-stu-id="376a7-234">If your project does not yet contain a Web.config file, add one now by right-clicking on the project name in the Solution Explorer, choosing Add New Item, and then adding a Web Configuration file.</span></span>


<span data-ttu-id="376a7-235">[![Если проект еще не содержит файл Web.config, добавьте его сейчас](an-overview-of-forms-authentication-cs/_static/image16.png)](an-overview-of-forms-authentication-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="376a7-235">[![If Your Project Does Not Yet Include Web.config, Add It Now](an-overview-of-forms-authentication-cs/_static/image16.png)](an-overview-of-forms-authentication-cs/_static/image15.png)</span></span>

<span data-ttu-id="376a7-236">**Рис. 7**: Если ваш проект Does не еще включают Web.config, добавьте его сейчас ([Просмотр полноразмерное изображение](an-overview-of-forms-authentication-cs/_static/image17.png))</span><span class="sxs-lookup"><span data-stu-id="376a7-236">**Figure 7**: If Your Project Does Not Yet Include Web.config, Add It Now ([Click to view full-size image](an-overview-of-forms-authentication-cs/_static/image17.png))</span></span>


<span data-ttu-id="376a7-237">Затем возьмите `<authentication>` элемент и обновление его для использования проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="376a7-237">Next, locate the `<authentication>` element and update it to use forms authentication.</span></span> <span data-ttu-id="376a7-238">После этого изменения файла Web.config должна выглядеть следующим:</span><span class="sxs-lookup"><span data-stu-id="376a7-238">After this change, your Web.config file's markup should look similar to the following:</span></span>

[!code-xml[Main](an-overview-of-forms-authentication-cs/samples/sample3.xml)]

> [!NOTE]
> <span data-ttu-id="376a7-239">Поскольку XML-файла Web.config, важно регистр.</span><span class="sxs-lookup"><span data-stu-id="376a7-239">Since Web.config is an XML file, casing is important.</span></span> <span data-ttu-id="376a7-240">Убедитесь, что значение атрибута mode в формы, с заглавной буквы «F».</span><span class="sxs-lookup"><span data-stu-id="376a7-240">Make sure that you set the mode attribute to Forms, with a capital "F".</span></span> <span data-ttu-id="376a7-241">Если вы используете другой регистр символов, таких как «forms», вы получите ошибку конфигурации при посещении сайта с помощью браузера.</span><span class="sxs-lookup"><span data-stu-id="376a7-241">If you use a different casing, such as "forms", you'll receive a configuration error when visiting the site through a browser.</span></span>


<span data-ttu-id="376a7-242">`<authentication>` Элемента может включать `<forms>` дочерний элемент, который содержит параметры, специфичные для проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="376a7-242">The `<authentication>` element may optionally include a `<forms>` child element that contains forms authentication-specific settings.</span></span> <span data-ttu-id="376a7-243">Теперь давайте просто используйте параметры по умолчанию для проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="376a7-243">For now, let's just use the default forms authentication settings.</span></span> <span data-ttu-id="376a7-244">Мы рассмотрим `<forms>` дочерний элемент более подробно в следующем уроке.</span><span class="sxs-lookup"><span data-stu-id="376a7-244">We will explore the `<forms>` child element in more detail in the next tutorial.</span></span>

## <a name="step-3-building-the-login-page"></a><span data-ttu-id="376a7-245">Шаг 3: Создание страницы входа</span><span class="sxs-lookup"><span data-stu-id="376a7-245">Step 3: Building the Login Page</span></span>

<span data-ttu-id="376a7-246">Для поддержки проверки подлинности форм наш веб-сайт должен страницу входа.</span><span class="sxs-lookup"><span data-stu-id="376a7-246">In order to support forms authentication our website needs a login page.</span></span> <span data-ttu-id="376a7-247">Как описано в разделе «Основные сведения о форм с процессом проверки подлинности» `FormsAuthenticationModule` будет автоматически перенаправления пользователя на страницу входа при попытке получить доступ к странице, что он не разрешено просматривать.</span><span class="sxs-lookup"><span data-stu-id="376a7-247">As discussed in the "Understanding the Forms Authentication Workflow" section, the `FormsAuthenticationModule` will automatically redirect the user to the login page if they attempt to access a page that they are not authorized to view.</span></span> <span data-ttu-id="376a7-248">Существуют также ASP.NET веб-элементов управления, которые будет отображаться ссылка на страницу входа для анонимных пользователей.</span><span class="sxs-lookup"><span data-stu-id="376a7-248">There are also ASP.NET Web controls that will display a link to the login page to anonymous users.</span></span> <span data-ttu-id="376a7-249">Это вызывает вопрос, «Какова URL-адрес страницы входа?»</span><span class="sxs-lookup"><span data-stu-id="376a7-249">This begs the question, "What is the URL of the login page?"</span></span>

<span data-ttu-id="376a7-250">По умолчанию системой проверки подлинности форм ожидает страницу входа могут называться Login.aspx и размещаются в корневой каталог веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="376a7-250">By default, the forms authentication system expects the login page to be named Login.aspx and placed in the root directory of the web application.</span></span> <span data-ttu-id="376a7-251">Если вы хотите использовать URL-адрес страницы другого имени входа, это можно сделать путем задания его в файле Web.config. Будет показано, как это сделать в последующих учебника.</span><span class="sxs-lookup"><span data-stu-id="376a7-251">If you want to use a different login page URL, you can do so by specifying it in Web.config. We will see how to do this in the subsequent tutorial.</span></span>

<span data-ttu-id="376a7-252">Страница входа имеет три функциональные обязанности.</span><span class="sxs-lookup"><span data-stu-id="376a7-252">The login page has three responsibilities:</span></span>

1. <span data-ttu-id="376a7-253">Предоставить интерфейс, позволяющий посетителей вводить свои учетные данные.</span><span class="sxs-lookup"><span data-stu-id="376a7-253">Provide an interface that allows the visitor to enter their credentials.</span></span>
2. <span data-ttu-id="376a7-254">Определите, если отправленное учетные данные действительны.</span><span class="sxs-lookup"><span data-stu-id="376a7-254">Determine if the submitted credentials are valid.</span></span>
3. <span data-ttu-id="376a7-255">«Вход» пользователя путем создания билета проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="376a7-255">"Log in" the user by creating the forms authentication ticket.</span></span>

### <a name="creating-the-login-pages-user-interface"></a><span data-ttu-id="376a7-256">Создание пользовательского интерфейса для страницы входа</span><span class="sxs-lookup"><span data-stu-id="376a7-256">Creating the Login Page's User Interface</span></span>

<span data-ttu-id="376a7-257">Давайте начнем с первой задачи.</span><span class="sxs-lookup"><span data-stu-id="376a7-257">Let's get started with the first task.</span></span> <span data-ttu-id="376a7-258">Добавить новую страницу ASP.NET в корневой каталог веб-узла с именем Login.aspx и связать его с главной страницы Site.master.</span><span class="sxs-lookup"><span data-stu-id="376a7-258">Add a new ASP.NET page to the site's root directory named Login.aspx and associate it with the Site.master master page.</span></span>


<span data-ttu-id="376a7-259">[![Добавьте новую страницу ASP.NET с именем Login.aspx](an-overview-of-forms-authentication-cs/_static/image19.png)](an-overview-of-forms-authentication-cs/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="376a7-259">[![Add a New ASP.NET Page Named Login.aspx](an-overview-of-forms-authentication-cs/_static/image19.png)](an-overview-of-forms-authentication-cs/_static/image18.png)</span></span>

<span data-ttu-id="376a7-260">**Рис. 8**: Добавление новых ASP.NET страница с именем Login.aspx ([Просмотр полноразмерное изображение](an-overview-of-forms-authentication-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="376a7-260">**Figure 8**: Add a New ASP.NET Page Named Login.aspx ([Click to view full-size image](an-overview-of-forms-authentication-cs/_static/image20.png))</span></span>


<span data-ttu-id="376a7-261">Интерфейс страницы входа обычно состоит из двух текстовых полей — один для имени пользователя, по одному для свой пароль — и кнопки для отправки формы.</span><span class="sxs-lookup"><span data-stu-id="376a7-261">The typical login page interface consists of two textboxes – one for the user's name, one for their password – and a button to submit the form.</span></span> <span data-ttu-id="376a7-262">Веб-сайтов часто включают флажок «Запомнить мои данные», если этот флажок установлен, не будет устранена полученный билет проверки подлинности между перезагрузками браузера.</span><span class="sxs-lookup"><span data-stu-id="376a7-262">Websites oftentimes include a "Remember me" checkbox that, if checked, persists the resulting authentication ticket across browser restarts.</span></span>

<span data-ttu-id="376a7-263">Добавьте два текстовых поля Login.aspx и установите их `ID` свойства для имени пользователя и пароля, соответственно.</span><span class="sxs-lookup"><span data-stu-id="376a7-263">Add two TextBoxes to Login.aspx and set their `ID` properties to UserName and Password, respectively.</span></span> <span data-ttu-id="376a7-264">Также задать пароля пользователя `TextMode` свойство пароля.</span><span class="sxs-lookup"><span data-stu-id="376a7-264">Also set Password's `TextMode` property to Password.</span></span> <span data-ttu-id="376a7-265">Добавьте элемент управления CheckBox, установка его `ID` свойства RememberMe и его `Text` свойства «Запомнить мои».</span><span class="sxs-lookup"><span data-stu-id="376a7-265">Next, add a CheckBox control, setting its `ID` property to RememberMe and its `Text` property to "Remember Me".</span></span> <span data-ttu-id="376a7-266">После этого добавьте кнопку с именем LoginButton которого `Text` задано значение «Вход».</span><span class="sxs-lookup"><span data-stu-id="376a7-266">Following that, add a Button named LoginButton whose `Text` property is set to "Login".</span></span> <span data-ttu-id="376a7-267">И наконец, добавьте метки веб-элемент управления и задайте его `ID` свойства InvalidCredentialsMessage, его `Text` свойства «имя пользователя или пароль является недопустимым.</span><span class="sxs-lookup"><span data-stu-id="376a7-267">And finally, add a Label Web control and set its `ID` property to InvalidCredentialsMessage, its `Text` property to "Your username or password is invalid.</span></span> <span data-ttu-id="376a7-268">Повторите попытку.», его `ForeColor` свойство на красный и его `Visible` свойству значение False.</span><span class="sxs-lookup"><span data-stu-id="376a7-268">Please try again.", its `ForeColor` property to Red, and its `Visible` property to False.</span></span>

<span data-ttu-id="376a7-269">На этом этапе экран должен выглядеть примерно на показанную на рис. 9 и на странице декларативный синтаксис должен выглядеть примерно следующее:</span><span class="sxs-lookup"><span data-stu-id="376a7-269">At this point your screen should look similar to the screen shot in Figure 9, and your page's declarative syntax should like the following:</span></span>

[!code-aspx[Main](an-overview-of-forms-authentication-cs/samples/sample4.aspx)]


<span data-ttu-id="376a7-270">[![Страница входа содержит два текстовых поля, флажок, кнопку и метку](an-overview-of-forms-authentication-cs/_static/image22.png)](an-overview-of-forms-authentication-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="376a7-270">[![The Login Page Contains Two TextBoxes, a CheckBox, a Button, and a Label](an-overview-of-forms-authentication-cs/_static/image22.png)](an-overview-of-forms-authentication-cs/_static/image21.png)</span></span>

<span data-ttu-id="376a7-271">**Рис. 9**: входа содержит два текстовые поля страницы, флажок, кнопку и метку ([Просмотр полноразмерное изображение](an-overview-of-forms-authentication-cs/_static/image23.png))</span><span class="sxs-lookup"><span data-stu-id="376a7-271">**Figure 9**: The Login Page Contains Two TextBoxes, a CheckBox, a Button, and a Label ([Click to view full-size image](an-overview-of-forms-authentication-cs/_static/image23.png))</span></span>


<span data-ttu-id="376a7-272">Наконец, создайте обработчик событий для нажатия LoginButton событий.</span><span class="sxs-lookup"><span data-stu-id="376a7-272">Finally, create an event handler for the LoginButton's Click event.</span></span> <span data-ttu-id="376a7-273">В конструкторе дважды щелкните элемент управления Button, чтобы создать этот обработчик событий.</span><span class="sxs-lookup"><span data-stu-id="376a7-273">From the Designer, simply double-click the Button control to create this event handler.</span></span>

### <a name="determining-if-the-supplied-credentials-are-valid"></a><span data-ttu-id="376a7-274">Определение, если учетные данные допустимы</span><span class="sxs-lookup"><span data-stu-id="376a7-274">Determining If the Supplied Credentials are Valid</span></span>

<span data-ttu-id="376a7-275">Теперь нам нужно реализовать задача 2 нажатия кнопки обработчик событий — определить, допустимы ли указанные учетные данные.</span><span class="sxs-lookup"><span data-stu-id="376a7-275">We now need to implement task 2 in the Button's Click event handler – determining whether the supplied credentials are valid.</span></span> <span data-ttu-id="376a7-276">Для этого необходимо поддерживать пользовательского хранилища, которая содержит все учетные данные пользователей, чтобы мы могли определить, если предоставленные учетные данные совпадают с любой известных учетных данных.</span><span class="sxs-lookup"><span data-stu-id="376a7-276">In order to do this there needs to be a user store that holds all of the users' credentials so that we can determine if the supplied credentials match up with any known credentials.</span></span>

<span data-ttu-id="376a7-277">До ASP.NET 2.0 разработчики несут ответственность за реализации оба собственные хранилища пользователя и написание кода для проверки предоставленных учетных данных в хранилище.</span><span class="sxs-lookup"><span data-stu-id="376a7-277">Prior to ASP.NET 2.0, developers were responsible for implementing both their own user stores and writing the code to validate the supplied credentials against the store.</span></span> <span data-ttu-id="376a7-278">Большинство разработчиков будет реализовывать в хранилище пользователя в базе данных, создание таблицы с именем пользователей и столбцы, такие как имя пользователя, пароль, электронной почты, LastLoginDate и т. д.</span><span class="sxs-lookup"><span data-stu-id="376a7-278">Most developers would implement the user store in a database, creating a table named Users with columns like UserName, Password, Email, LastLoginDate, and so forth.</span></span> <span data-ttu-id="376a7-279">Эта таблица, будут иметь одну запись для каждой учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="376a7-279">This table, then, would have one record per user account.</span></span> <span data-ttu-id="376a7-280">Проверка того, предоставленные учетные данные пользователя будет включать в себя запросы к базе данных для сопоставления имени пользователя и затем гарантирует, что пароль базы данных значение соответствовало введенного пароля.</span><span class="sxs-lookup"><span data-stu-id="376a7-280">Verifying a user's supplied credentials would involve querying the database for a matching username and then ensuring that the password in the database corresponded to the supplied password.</span></span>

<span data-ttu-id="376a7-281">В ASP.NET 2.0 разработчикам следует использовать один из поставщиков членства для управления в хранилище пользователя.</span><span class="sxs-lookup"><span data-stu-id="376a7-281">With ASP.NET 2.0, developers should use one of the Membership providers to manage the user store.</span></span> <span data-ttu-id="376a7-282">В этой серии учебника будет использоваться SqlMembershipProvider, который использует базу данных SQL Server для хранилища пользователя.</span><span class="sxs-lookup"><span data-stu-id="376a7-282">In this tutorial series we will be using the SqlMembershipProvider, which uses a SQL Server database for the user store.</span></span> <span data-ttu-id="376a7-283">При использовании SqlMembershipProvider, нам нужно реализовать схему конкретной базы данных, включает таблицы, представления и хранимые процедуры, ожидаемый поставщиком.</span><span class="sxs-lookup"><span data-stu-id="376a7-283">When using the SqlMembershipProvider we need to implement a specific database schema that includes the tables, views, and stored procedures expected by the provider.</span></span> <span data-ttu-id="376a7-284">Мы рассмотрим, как для реализации этой схемы в ***создания схемы членства в SQL Server*** учебника.</span><span class="sxs-lookup"><span data-stu-id="376a7-284">We will examine how to implement this schema in the ***Creating the Membership Schema in SQL Server*** tutorial.</span></span> <span data-ttu-id="376a7-285">С поставщиком членства в месте, проверка учетных данных пользователя достаточно вызвать метод [класс членства](https://msdn.microsoft.com/library/system.web.security.membership.aspx) [ValidateUser (*username*, *пароля*) метод](https://msdn.microsoft.com/library/system.web.security.membership.validateuser.aspx), которая возвращает логическое значение, указывающее, ли допустимость *username* и *пароль* комбинации.</span><span class="sxs-lookup"><span data-stu-id="376a7-285">With the Membership provider in place, validating the user's credentials is as simple as calling the [Membership class](https://msdn.microsoft.com/library/system.web.security.membership.aspx)'s [ValidateUser(*username*, *password*) method](https://msdn.microsoft.com/library/system.web.security.membership.validateuser.aspx), which returns a Boolean value indicating whether the validity of the *username* and *password* combination.</span></span> <span data-ttu-id="376a7-286">Увидев, как мы еще не реализован SqlMembershipProvider пользовательского хранилища, в настоящее время невозможно использовать метод ValidateUser класса членства.</span><span class="sxs-lookup"><span data-stu-id="376a7-286">Seeing as we have not yet implemented the SqlMembershipProvider's user store, we cannot use the Membership class's ValidateUser method at this time.</span></span>

<span data-ttu-id="376a7-287">А не тратить время для создания собственных пользовательских пользователей базы данных таблицы (что было бы устаревшим после мы реализовали SqlMembershipProvider), давайте вместо жестко действительные учетные данные в имени входа страницы самого.</span><span class="sxs-lookup"><span data-stu-id="376a7-287">Rather than take the time to build our own custom Users database table (which would be obsolete once we implemented the SqlMembershipProvider), let's instead hard-code the valid credentials within the login page itself.</span></span> <span data-ttu-id="376a7-288">В LoginButton выберите обработчик событий, добавьте следующий код:</span><span class="sxs-lookup"><span data-stu-id="376a7-288">In the LoginButton's Click event handler, add the following code:</span></span>

[!code-csharp[Main](an-overview-of-forms-authentication-cs/samples/sample5.cs)]

<span data-ttu-id="376a7-289">Как видите, существует три действительные учетные записи пользователей — Скотт, Цзисунь и Сэм — и все три класса имеют один и тот же пароль («password»).</span><span class="sxs-lookup"><span data-stu-id="376a7-289">As you can see, there are three valid user accounts – Scott, Jisun, and Sam – and all three have the same password ("password").</span></span> <span data-ttu-id="376a7-290">Код выполняет цикл по массивы пользователей и паролей, допустимым совпадение имени пользователя и пароля.</span><span class="sxs-lookup"><span data-stu-id="376a7-290">The code loops through the users and passwords arrays looking for a valid username and password match.</span></span> <span data-ttu-id="376a7-291">Если имя пользователя и пароль являются допустимыми, необходимо войти в систему пользователя и затем перенаправит их на соответствующую страницу.</span><span class="sxs-lookup"><span data-stu-id="376a7-291">If both the username and password are valid, we need to login the user and then redirect them to the appropriate page.</span></span> <span data-ttu-id="376a7-292">Если учетные данные являются недопустимыми, мы отображается метка InvalidCredentialsMessage.</span><span class="sxs-lookup"><span data-stu-id="376a7-292">If the credentials are invalid, then we display the InvalidCredentialsMessage Label.</span></span>

<span data-ttu-id="376a7-293">Когда пользователь вводит правильные учетные данные, упомянутые, они перенаправляются «соответствующую страницу».</span><span class="sxs-lookup"><span data-stu-id="376a7-293">When a user enters valid credentials, I mentioned that they are then redirected to the "appropriate page."</span></span> <span data-ttu-id="376a7-294">Что такое соответствующая страница, однако</span><span class="sxs-lookup"><span data-stu-id="376a7-294">What is the appropriate page, though?</span></span> <span data-ttu-id="376a7-295">Помните, что при посещении страницы, которые не авторизованы для просмотра FormsAuthenticationModule автоматически перенаправит их на страницу входа.</span><span class="sxs-lookup"><span data-stu-id="376a7-295">Recall that when a user visits a page they are not authorized to view, the FormsAuthenticationModule automatically redirects them to the login page.</span></span> <span data-ttu-id="376a7-296">При этом он включает запрошенного URL-адреса в строке запроса через параметр ReturnUrl.</span><span class="sxs-lookup"><span data-stu-id="376a7-296">In doing so, it includes the requested URL in the querystring via the ReturnUrl parameter.</span></span> <span data-ttu-id="376a7-297">То есть если они были не авторизован для этого пользователь пытался посетите ProtectedPage.aspx, FormsAuthenticationModule перенаправит их на:</span><span class="sxs-lookup"><span data-stu-id="376a7-297">That is, if a user attempted to visit ProtectedPage.aspx, and they were not authorized to do so, the FormsAuthenticationModule would redirect them to:</span></span>

<span data-ttu-id="376a7-298">Login.aspx?ReturnUrl=ProtectedPage.aspx</span><span class="sxs-lookup"><span data-stu-id="376a7-298">Login.aspx?ReturnUrl=ProtectedPage.aspx</span></span>

<span data-ttu-id="376a7-299">После успешного входа в систему пользователь должен попасть на ProtectedPage.aspx.</span><span class="sxs-lookup"><span data-stu-id="376a7-299">Upon successfully logging in, the user should be redirected back to ProtectedPage.aspx.</span></span> <span data-ttu-id="376a7-300">Кроме того пользователи могут посетите страницу входа в свои собственные volition.</span><span class="sxs-lookup"><span data-stu-id="376a7-300">Alternatively, users may visit the login page on their own volition.</span></span> <span data-ttu-id="376a7-301">В этом случае после входа пользователя они должны отправляться страницу Default.aspx в корневую папку.</span><span class="sxs-lookup"><span data-stu-id="376a7-301">In that case, after logging in the user they should be sent to the root folder's Default.aspx page.</span></span>

### <a name="logging-in-the-user"></a><span data-ttu-id="376a7-302">Вход пользователя</span><span class="sxs-lookup"><span data-stu-id="376a7-302">Logging In the User</span></span>

<span data-ttu-id="376a7-303">Предположим, что предоставленные учетные данные являются допустимыми, потребуется создать билета проверки подлинности форм, тем самым вход пользователя на сайт.</span><span class="sxs-lookup"><span data-stu-id="376a7-303">Assuming that the supplied credentials are valid, we need to create a forms authentication ticket, thereby logging in the user to the site.</span></span> <span data-ttu-id="376a7-304">[Класс FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthentication.aspx) в [имен System.Web.Security](https://msdn.microsoft.com/library/system.web.security.aspx) предоставляет различные методы для ведения журнала в и выходе из системы пользователей с помощью форм системой проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="376a7-304">The [FormsAuthentication class](https://msdn.microsoft.com/library/system.web.security.formsauthentication.aspx) in the [System.Web.Security namespace](https://msdn.microsoft.com/library/system.web.security.aspx) provides assorted methods for logging in and logging out users via the forms authentication system.</span></span> <span data-ttu-id="376a7-305">Хотя существует несколько методов в классе FormsAuthentication, которые нас интересуют на этом juncture встречаются:</span><span class="sxs-lookup"><span data-stu-id="376a7-305">While there are several methods in the FormsAuthentication class, the three we are interested in at this juncture are:</span></span>

- <span data-ttu-id="376a7-306">[GetAuthCookie (*username*, *persistCookie*)](https://msdn.microsoft.com/library/system.web.security.formsauthentication.getauthcookie.aspx) — создает билета проверки подлинности форм для передаваемого *username*.</span><span class="sxs-lookup"><span data-stu-id="376a7-306">[GetAuthCookie(*username*, *persistCookie*)](https://msdn.microsoft.com/library/system.web.security.formsauthentication.getauthcookie.aspx) – creates a forms authentication ticket for the supplied name *username*.</span></span> <span data-ttu-id="376a7-307">Затем этот метод создает и возвращает HttpCookie объекта, который хранит содержимое билет проверки подлинности.</span><span class="sxs-lookup"><span data-stu-id="376a7-307">Next, this method creates and returns an HttpCookie object that holds the contents of the authentication ticket.</span></span> <span data-ttu-id="376a7-308">Если *persistCookie* имеет значение true, создается постоянный файл cookie.</span><span class="sxs-lookup"><span data-stu-id="376a7-308">If *persistCookie* is true, a persistent cookie is created.</span></span>
- <span data-ttu-id="376a7-309">[SetAuthCookie (*username*, *persistCookie*)](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) — вызывает GetAuthCookie (*username*, *persistCookie*) метод для создания файла cookie проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="376a7-309">[SetAuthCookie(*username*, *persistCookie*)](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) – calls the GetAuthCookie(*username*, *persistCookie*) method to generate the forms authentication cookie.</span></span> <span data-ttu-id="376a7-310">Затем этот метод добавляет файл cookie, возвращенные GetAuthCookie к коллекции (при условии, что используется; в противном случае время форм на основе файлов cookie проверки подлинности, этот метод вызывает внутренний класс, обрабатывает логику, без поддержки файлов cookie билета).</span><span class="sxs-lookup"><span data-stu-id="376a7-310">This method then adds the cookie returned by GetAuthCookie to the Cookies collection (assuming cookies-based forms authentication is being used; otherwise, this method calls an internal class that handles the cookieless ticket logic).</span></span>
- <span data-ttu-id="376a7-311">[RedirectFromLoginPage (*username*, *persistCookie*)](https://msdn.microsoft.com/library/system.web.security.formsauthentication.redirectfromloginpage.aspx) — этот метод вызывает метод SetAuthCookie (*username*, *persistCookie*) и затем перенаправляет пользователя на соответствующую страницу.</span><span class="sxs-lookup"><span data-stu-id="376a7-311">[RedirectFromLoginPage(*username*, *persistCookie*)](https://msdn.microsoft.com/library/system.web.security.formsauthentication.redirectfromloginpage.aspx) – this method calls SetAuthCookie(*username*, *persistCookie*), and then redirects the user to the appropriate page.</span></span>

<span data-ttu-id="376a7-312">GetAuthCookie удобно в тех случаях, когда требуется изменить билет проверки подлинности выписке куки-файл в коллекцию файлов cookie.</span><span class="sxs-lookup"><span data-stu-id="376a7-312">GetAuthCookie is handy when you need to modify the authentication ticket before writing the cookie out to the Cookies collection.</span></span> <span data-ttu-id="376a7-313">SetAuthCookie полезен, если необходимо создание билета проверки подлинности форм и добавление в коллекцию файлов cookie, но не требуется перенаправлять пользователя на соответствующую страницу.</span><span class="sxs-lookup"><span data-stu-id="376a7-313">SetAuthCookie is useful if you want to create the forms authentication ticket and add it to the Cookies collection, but do not want to redirect the user to the appropriate page.</span></span> <span data-ttu-id="376a7-314">Возможно требуется сохранять их на странице входа, или их отправки на альтернативный страницу.</span><span class="sxs-lookup"><span data-stu-id="376a7-314">Perhaps you want to keep them on the login page or send them to some alternate page.</span></span>

<span data-ttu-id="376a7-315">Поскольку нам требуется вход пользователя и перенаправит их на соответствующей странице, воспользуемся RedirectFromLoginPage.</span><span class="sxs-lookup"><span data-stu-id="376a7-315">Since we want to log in the user and redirect them to the appropriate page, let's use RedirectFromLoginPage.</span></span> <span data-ttu-id="376a7-316">Обновить LoginButton нажмите кнопку обработчика событий, заменив две строки комментарии TODO следующую строку кода:</span><span class="sxs-lookup"><span data-stu-id="376a7-316">Update the LoginButton's Click event handler, replacing the two commented TODO lines with the following line of code:</span></span>

<span data-ttu-id="376a7-317">FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked);</span><span class="sxs-lookup"><span data-stu-id="376a7-317">FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked);</span></span>

<span data-ttu-id="376a7-318">При создании билета проверки подлинности форм, мы используем свойство Text текстового поля имя пользователя для билета проверки подлинности форм *username* параметров и состояния флажка флажок RememberMe  *persistCookie* параметра.</span><span class="sxs-lookup"><span data-stu-id="376a7-318">When creating the forms authentication ticket we use the UserName TextBox's Text property for the forms authentication ticket *username* parameter, and the checked state of the RememberMe CheckBox for the *persistCookie* parameter.</span></span>

<span data-ttu-id="376a7-319">Чтобы протестировать страницу входа, посетите его в браузере.</span><span class="sxs-lookup"><span data-stu-id="376a7-319">To test the login page, visit it in a browser.</span></span> <span data-ttu-id="376a7-320">Начните с ввода недействительные учетные данные, такие как имя пользователя «Nope» и паролем «ошибка».</span><span class="sxs-lookup"><span data-stu-id="376a7-320">Start by entering invalid credentials, such as a username of "Nope" and a password of "wrong".</span></span> <span data-ttu-id="376a7-321">При нажатии кнопки входа обратная передача будет выполняться и InvalidCredentialsMessage метка будет отображена.</span><span class="sxs-lookup"><span data-stu-id="376a7-321">Upon clicking the Login button a postback will occur and the InvalidCredentialsMessage Label will be displayed.</span></span>


<span data-ttu-id="376a7-322">[![InvalidCredentialsMessage метка будет отображаться при вводе недопустимые учетные данные](an-overview-of-forms-authentication-cs/_static/image25.png)](an-overview-of-forms-authentication-cs/_static/image24.png)</span><span class="sxs-lookup"><span data-stu-id="376a7-322">[![The InvalidCredentialsMessage Label is Displayed When Entering Invalid Credentials](an-overview-of-forms-authentication-cs/_static/image25.png)](an-overview-of-forms-authentication-cs/_static/image24.png)</span></span>

<span data-ttu-id="376a7-323">**Рис. 10**: InvalidCredentialsMessage метка будет отображаться при вводе недействительные учетные данные ([Просмотр полноразмерное изображение](an-overview-of-forms-authentication-cs/_static/image26.png))</span><span class="sxs-lookup"><span data-stu-id="376a7-323">**Figure 10**: The InvalidCredentialsMessage Label is Displayed When Entering Invalid Credentials ([Click to view full-size image](an-overview-of-forms-authentication-cs/_static/image26.png))</span></span>


<span data-ttu-id="376a7-324">Затем введите действительные учетные данные и нажмите кнопку входа.</span><span class="sxs-lookup"><span data-stu-id="376a7-324">Next, enter valid credentials and click the Login button.</span></span> <span data-ttu-id="376a7-325">Этот момент обратной передачи билета проверки подлинности форм создается и вы будете автоматически перенаправлены на Default.aspx.</span><span class="sxs-lookup"><span data-stu-id="376a7-325">This time when the postback occurs a forms authentication ticket is created and you are automatically redirected back to Default.aspx.</span></span> <span data-ttu-id="376a7-326">На этом этапе необходимо войти веб-сайт, несмотря на то, что существуют не визуальные подсказки, чтобы указать, что вы выполнили вход.</span><span class="sxs-lookup"><span data-stu-id="376a7-326">At this point you have logged in to the website, although there are no visual cues to indicate that you are currently logged in.</span></span> <span data-ttu-id="376a7-327">На шаге 4, будет показано, как программным способом определить, является ли пользователь регистрируется в или не, а также способ идентификации пользователя, посетив страницу.</span><span class="sxs-lookup"><span data-stu-id="376a7-327">In Step 4 we will see how to programmatically determine whether a user is logged in or not as well as how to identify the user visiting the page.</span></span>

<span data-ttu-id="376a7-328">Шаг 5 рассматриваются приемы для входа пользователя из веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="376a7-328">Step 5 examines techniques for logging a user out of the website.</span></span>

### <a name="securing-the-login-page"></a><span data-ttu-id="376a7-329">Защита страницы входа</span><span class="sxs-lookup"><span data-stu-id="376a7-329">Securing the Login Page</span></span>

<span data-ttu-id="376a7-330">Когда пользователь вводит свои учетные данные и отправляет форму страницы входа, учетные данные, в том числе пароль — передаются через Интернет на веб-сервер в *обычный текст*.</span><span class="sxs-lookup"><span data-stu-id="376a7-330">When the user enters her credentials and submits the login page form, the credentials – including her password – are transmitted over the Internet to the web server in *plain text*.</span></span> <span data-ttu-id="376a7-331">Это означает, что любой злоумышленник, проанализировать сетевой трафик можно увидеть имя пользователя и пароль.</span><span class="sxs-lookup"><span data-stu-id="376a7-331">That means any hacker sniffing the network traffic can see the username and password.</span></span> <span data-ttu-id="376a7-332">Чтобы избежать этого, очень важно для шифрования сетевого трафика с помощью [Secure слои сокетов (SSL)](http://en.wikipedia.org/wiki/Secure_Sockets_Layer).</span><span class="sxs-lookup"><span data-stu-id="376a7-332">To prevent this, it is essential to encrypt the network traffic by using [Secure Socket Layers (SSL)](http://en.wikipedia.org/wiki/Secure_Sockets_Layer).</span></span> <span data-ttu-id="376a7-333">Это позволит гарантировать шифровать учетные данные (а также всю страницу HTML-разметка) от момента, когда они покидают браузер, пока они не будут получены веб-сервером.</span><span class="sxs-lookup"><span data-stu-id="376a7-333">This will ensure that the credentials (as well as the entire page's HTML markup) are encrypted from the moment they leave the browser until they are received by the web server.</span></span>

<span data-ttu-id="376a7-334">Если веб-сайт не содержит конфиденциальные сведения, будет достаточно для использования протокола SSL на странице входа и на других страницах где пароль пользователя в противном случае отправляются по сети в виде обычного текста.</span><span class="sxs-lookup"><span data-stu-id="376a7-334">Unless your website contains sensitive information, you will only need to use SSL on the login page and on other pages where the user's password would otherwise be sent over the wire in plain text.</span></span> <span data-ttu-id="376a7-335">Можно не беспокоиться о защите билета проверки подлинности форм, поскольку по умолчанию, он и зашифрован и цифровую подпись (чтобы предотвратить несанкционированный доступ).</span><span class="sxs-lookup"><span data-stu-id="376a7-335">You do not need to worry about securing the forms authentication ticket since, by default, it is both encrypted and digitally signed (to prevent tampering).</span></span> <span data-ttu-id="376a7-336">В этом руководстве представлены более подробные сведения о безопасности билета проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="376a7-336">A more thorough discussion on forms authentication ticket security is presented in the following tutorial.</span></span>

> [!NOTE]
> <span data-ttu-id="376a7-337">Многие финансовых и медицинские веб-узлы настроены на использование SSL на *все* страниц, доступных для прошедших проверку пользователей.</span><span class="sxs-lookup"><span data-stu-id="376a7-337">Many financial and medical websites are configured to use SSL on *all* pages accessible to authenticated users.</span></span> <span data-ttu-id="376a7-338">При создании такого веб-сайта, можно настроить систему проверки подлинности форм, чтобы билета проверки подлинности с помощью форм передаются только через безопасное подключение.</span><span class="sxs-lookup"><span data-stu-id="376a7-338">If you are building such a website you can configure the forms authentication system so that the forms authentication ticket is only transmitted over a secure connection.</span></span> <span data-ttu-id="376a7-339">Мы рассмотрим различные параметры конфигурации для проверки подлинности форм в следующем уроке  *[настройки проверки подлинности форм и дополнительные разделы](forms-authentication-configuration-and-advanced-topics-cs.md)*.</span><span class="sxs-lookup"><span data-stu-id="376a7-339">We will look at the various forms authentication configuration options in the next tutorial, *[Forms Authentication Configuration and Advanced Topics](forms-authentication-configuration-and-advanced-topics-cs.md)*.</span></span>


## <a name="step-4-detecting-authenticated-visitors-and-determining-their-identity"></a><span data-ttu-id="376a7-340">Шаг 4: Обнаружение прошедшего проверку подлинности посетителей и определение их идентификации</span><span class="sxs-lookup"><span data-stu-id="376a7-340">Step 4: Detecting Authenticated Visitors and Determining Their Identity</span></span>

<span data-ttu-id="376a7-341">На этом этапе мы включения проверки подлинности форм и создать страницу входа, ограниченные механизмы, но у нас есть еще для проверки того, как мы можно определить, является ли пользователь проверку подлинности или анонимный.</span><span class="sxs-lookup"><span data-stu-id="376a7-341">At this point we have enabled forms authentication and created a rudimentary login page, but we have yet to examine how we can determine whether a user is authenticated or anonymous.</span></span> <span data-ttu-id="376a7-342">В некоторых сценариях мы можете отображать различные данные или сведения в зависимости от того, было ли проверку подлинности или анонимного пользователя посетив страницу.</span><span class="sxs-lookup"><span data-stu-id="376a7-342">In certain scenarios we may wish to display different data or information depending on whether an authenticated or anonymous user is visiting the page.</span></span> <span data-ttu-id="376a7-343">Кроме того мы часто нужно знать удостоверение пользователя, прошедшего проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="376a7-343">Moreover, we oftentimes need to know the identity of the authenticated user.</span></span>

<span data-ttu-id="376a7-344">Давайте дополнить существующие страницу Default.aspx, чтобы демонстрируются эти методы.</span><span class="sxs-lookup"><span data-stu-id="376a7-344">Let's augment the existing Default.aspx page to illustrate these techniques.</span></span> <span data-ttu-id="376a7-345">На странице Default.aspx добавьте два панель элемента управления, один именованный AuthenticatedMessagePanel и другой именованный AnonymousMessagePanel.</span><span class="sxs-lookup"><span data-stu-id="376a7-345">In Default.aspx add two Panel controls, one named AuthenticatedMessagePanel and another named AnonymousMessagePanel.</span></span> <span data-ttu-id="376a7-346">Добавьте элемент управления Label, с именем WelcomeBackMessage первой панели.</span><span class="sxs-lookup"><span data-stu-id="376a7-346">Add a Label control named WelcomeBackMessage in the first Panel.</span></span> <span data-ttu-id="376a7-347">Второй панели добавления элемента управления HyperLink, установите его свойство Text на «Вход», а для свойства NavigateUrl в «~ / Login.aspx».</span><span class="sxs-lookup"><span data-stu-id="376a7-347">In the second Panel add a HyperLink control, set its Text property to "Log In" and its NavigateUrl property to "~/Login.aspx".</span></span> <span data-ttu-id="376a7-348">На этом этапе декларативная разметка для Default.aspx должен выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="376a7-348">At this point the declarative markup for Default.aspx should look similar to the following:</span></span>

[!code-aspx[Main](an-overview-of-forms-authentication-cs/samples/sample6.aspx)]

<span data-ttu-id="376a7-349">Как вы, вероятно, догадаться к этому моменту, смысл в том для отображения только AuthenticatedMessagePanel для прошедших проверку подлинности посетителей и просто AnonymousMessagePanel для анонимных пользователей.</span><span class="sxs-lookup"><span data-stu-id="376a7-349">As you have probably guessed by now, the idea here is to display just the AuthenticatedMessagePanel to authenticated visitors and just the AnonymousMessagePanel to anonymous visitors.</span></span> <span data-ttu-id="376a7-350">Для этого необходимо установить эти панели отображаемых свойств в зависимости от того, является ли пользователь вошел или не.</span><span class="sxs-lookup"><span data-stu-id="376a7-350">To accomplish this we need to set these Panels' Visible properties depending on whether the user is logged in or not.</span></span>

<span data-ttu-id="376a7-351">[Request.IsAuthenticated свойство](https://msdn.microsoft.com/library/system.web.httprequest.isauthenticated.aspx) возвращает логическое значение, указывающее, прошел ли запрос аутентификацию.</span><span class="sxs-lookup"><span data-stu-id="376a7-351">The [Request.IsAuthenticated property](https://msdn.microsoft.com/library/system.web.httprequest.isauthenticated.aspx) returns a Boolean value indicating whether the request has been authenticated.</span></span> <span data-ttu-id="376a7-352">Введите следующий код в страницу\_загрузить код обработчика событий:</span><span class="sxs-lookup"><span data-stu-id="376a7-352">Enter the following code into the Page\_Load event handler code:</span></span>

[!code-csharp[Main](an-overview-of-forms-authentication-cs/samples/sample7.cs)]

<span data-ttu-id="376a7-353">Этот код в месте посетите Default.aspx через браузер.</span><span class="sxs-lookup"><span data-stu-id="376a7-353">With this code in place, visit Default.aspx through a browser.</span></span> <span data-ttu-id="376a7-354">Предположим, что у вас еще выполнить вход, вы увидите ссылку на страницу входа (см. рис. 11).</span><span class="sxs-lookup"><span data-stu-id="376a7-354">Assuming that you have yet to log in, you will see a link to the login page (see Figure 11).</span></span> <span data-ttu-id="376a7-355">Щелкните эту ссылку и войдите на сайт.</span><span class="sxs-lookup"><span data-stu-id="376a7-355">Click this link and log in to the site.</span></span> <span data-ttu-id="376a7-356">Как мы видели в шаге 3, после ввода учетных данных вы вернетесь на Default.aspx, но это время на странице отображается «Приветствия обратно!»</span><span class="sxs-lookup"><span data-stu-id="376a7-356">As we saw in Step 3, after entering your credentials you will be returned to Default.aspx, but this time the page shows the "Welcome back!"</span></span> <span data-ttu-id="376a7-357">сообщения (см. рис. 12).</span><span class="sxs-lookup"><span data-stu-id="376a7-357">message (see Figure 12).</span></span>


![При посещении анонимно, ссылка в журнале отображается](an-overview-of-forms-authentication-cs/_static/image27.png)

<span data-ttu-id="376a7-359">**Рис. 11**: отображаются при посещении анонимно, ссылка в журнал</span><span class="sxs-lookup"><span data-stu-id="376a7-359">**Figure 11**: When Visiting Anonymously, a Log In Link is Displayed</span></span>


![Отображаются пользователи, прошедшие проверку подлинности](an-overview-of-forms-authentication-cs/_static/image28.png)

<span data-ttu-id="376a7-361">**Рис. 12**: показаны прошедшие проверку «Добро пожаловать»!</span><span class="sxs-lookup"><span data-stu-id="376a7-361">**Figure 12**: Authenticated Users are Shown the "Welcome back!"</span></span> <span data-ttu-id="376a7-362">Сообщение</span><span class="sxs-lookup"><span data-stu-id="376a7-362">Message</span></span>


<span data-ttu-id="376a7-363">Можно определить удостоверение пользователя, выполнившего вход через [объект HttpContext](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) [свойство пользователя](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx).</span><span class="sxs-lookup"><span data-stu-id="376a7-363">We can determine the currently logged on user's identity via the [HttpContext object](https://msdn.microsoft.com/library/system.web.httpcontext.aspx)'s [User property](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx).</span></span> <span data-ttu-id="376a7-364">Объект HttpContext представляет сведения о текущем запросе и — это место для таких общих объектов ASP.NET, как ответ, запроса и сеанса, в частности.</span><span class="sxs-lookup"><span data-stu-id="376a7-364">The HttpContext object represents information about the current request, and is the home for such common ASP.NET objects as Response, Request, and Session, among others.</span></span> <span data-ttu-id="376a7-365">Свойства пользователя представляет контекст безопасности текущего HTTP-запроса и реализует [интерфейса IPrincipal](https://msdn.microsoft.com/library/system.security.principal.iprincipal.aspx).</span><span class="sxs-lookup"><span data-stu-id="376a7-365">The User property represents the security context of the current HTTP request and implements the [IPrincipal interface](https://msdn.microsoft.com/library/system.security.principal.iprincipal.aspx).</span></span>

<span data-ttu-id="376a7-366">Свойство пользователя задается FormsAuthenticationModule.</span><span class="sxs-lookup"><span data-stu-id="376a7-366">The User property is set by the FormsAuthenticationModule.</span></span> <span data-ttu-id="376a7-367">В частности когда FormsAuthenticationModule находит билета проверки подлинности форм во входящем запросе, создает новый объект GenericPrincipal и присваивает его свойству пользователя.</span><span class="sxs-lookup"><span data-stu-id="376a7-367">Specifically, when the FormsAuthenticationModule finds a forms authentication ticket in the incoming request, it creates a new GenericPrincipal object and assigns it to the User property.</span></span>

<span data-ttu-id="376a7-368">Principal-объекты (например, GenericPrincipal) предоставляют сведения о удостоверение пользователя и роли, к которым они принадлежат.</span><span class="sxs-lookup"><span data-stu-id="376a7-368">Principal objects (like GenericPrincipal) provide information on the user's identity and the roles to which they belong.</span></span> <span data-ttu-id="376a7-369">Интерфейс IPrincipal определяет два члена:</span><span class="sxs-lookup"><span data-stu-id="376a7-369">The IPrincipal interface defines two members:</span></span>

- <span data-ttu-id="376a7-370">[IsInRole (*roleName*)](https://msdn.microsoft.com/library/system.security.principal.iprincipal.isinrole.aspx) — метод, который возвращает логическое значение, указывающее, принадлежит ли участник к указанной роли.</span><span class="sxs-lookup"><span data-stu-id="376a7-370">[IsInRole(*roleName*)](https://msdn.microsoft.com/library/system.security.principal.iprincipal.isinrole.aspx) – a method that returns a Boolean value indicating if the principal belongs to the specified role.</span></span>
- <span data-ttu-id="376a7-371">[Удостоверение](https://msdn.microsoft.com/library/system.security.principal.iprincipal.identity.aspx) — свойство, которое возвращает объект, реализующий интерфейс [интерфейс IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx).</span><span class="sxs-lookup"><span data-stu-id="376a7-371">[Identity](https://msdn.microsoft.com/library/system.security.principal.iprincipal.identity.aspx) – a property that returns an object that implements the [IIdentity interface](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx).</span></span> <span data-ttu-id="376a7-372">Интерфейс IIdentity определяет три свойства: [AuthenticationType](https://msdn.microsoft.com/library/system.security.principal.iidentity.authenticationtype.aspx), [свойство IsAuthenticated](https://msdn.microsoft.com/library/system.security.principal.iidentity.isauthenticated.aspx), и [имя](https://msdn.microsoft.com/library/system.security.principal.iidentity.name.aspx).</span><span class="sxs-lookup"><span data-stu-id="376a7-372">The IIdentity interface defines three properties: [AuthenticationType](https://msdn.microsoft.com/library/system.security.principal.iidentity.authenticationtype.aspx), [IsAuthenticated](https://msdn.microsoft.com/library/system.security.principal.iidentity.isauthenticated.aspx), and [Name](https://msdn.microsoft.com/library/system.security.principal.iidentity.name.aspx).</span></span>

<span data-ttu-id="376a7-373">Мы можно определить имя текущей посетителя, используя следующий код:</span><span class="sxs-lookup"><span data-stu-id="376a7-373">We can determine the name of the current visitor using the following code:</span></span>

<span data-ttu-id="376a7-374">Строка, currentUsersName = User.Identity.Name;</span><span class="sxs-lookup"><span data-stu-id="376a7-374">string currentUsersName = User.Identity.Name;</span></span>

<span data-ttu-id="376a7-375">Если с помощью форм проверки подлинности, [FormsIdentity объект](https://msdn.microsoft.com/library/system.web.security.formsidentity.aspx) создается для GenericPrincipal свойство Identity.</span><span class="sxs-lookup"><span data-stu-id="376a7-375">When using forms authentication, a [FormsIdentity object](https://msdn.microsoft.com/library/system.web.security.formsidentity.aspx) is created for the GenericPrincipal's Identity property.</span></span> <span data-ttu-id="376a7-376">Класс FormsIdentity всегда возвращает строку «Forms» для свойства AuthenticationType и true для свойства его свойство IsAuthenticated.</span><span class="sxs-lookup"><span data-stu-id="376a7-376">The FormsIdentity class always returns the string "Forms" for its AuthenticationType property and true for its IsAuthenticated property.</span></span> <span data-ttu-id="376a7-377">Свойство Name возвращает имя пользователя, указанное при создании билета проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="376a7-377">The Name property returns the username specified when creating the forms authentication ticket.</span></span> <span data-ttu-id="376a7-378">Помимо этих трех свойств FormsIdentity включает доступ к базовой билет проверки подлинности через его [билета свойство](https://msdn.microsoft.com/library/system.web.security.formsidentity.ticket.aspx).</span><span class="sxs-lookup"><span data-stu-id="376a7-378">In addition to these three properties, FormsIdentity includes access to the underlying authentication ticket via its [Ticket property](https://msdn.microsoft.com/library/system.web.security.formsidentity.ticket.aspx).</span></span> <span data-ttu-id="376a7-379">Билет свойство возвращает объект типа [FormsAuthenticationTicket](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx), который имеет свойства, как срок действия, IsPersistent, IssueDate, имя и т. д.</span><span class="sxs-lookup"><span data-stu-id="376a7-379">The Ticket property returns an object of type [FormsAuthenticationTicket](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx), which has properties like Expiration, IsPersistent, IssueDate, Name, and so on.</span></span>

<span data-ttu-id="376a7-380">Важный аспект следует уяснить, вот что *username* параметр, указанный в FormsAuthentication.GetAuthCookie (*username*, *persistCookie*), FormsAuthentication.SetAuthCookie (*username*, *persistCookie*) и FormsAuthentication.RedirectFromLoginPage (*username*, *persistCookie*) методы имеет то же значение, возвращенных User.Identity.Name.</span><span class="sxs-lookup"><span data-stu-id="376a7-380">The important point to take away here is that the *username* parameter specified in the FormsAuthentication.GetAuthCookie(*username*, *persistCookie*), FormsAuthentication.SetAuthCookie(*username*, *persistCookie*), and FormsAuthentication.RedirectFromLoginPage(*username*, *persistCookie*) methods is the same value returned by User.Identity.Name.</span></span> <span data-ttu-id="376a7-381">Кроме того билет проверки подлинности, созданные при использовании этих методов доступен для приведения объекта FormsIdentity User.Identity и последующий доступ к свойству Ticket:</span><span class="sxs-lookup"><span data-stu-id="376a7-381">Moreover, the authentication ticket created by these methods is available by casting User.Identity to a FormsIdentity object and then accessing the Ticket property:</span></span>

[!code-csharp[Main](an-overview-of-forms-authentication-cs/samples/sample8.cs)]

<span data-ttu-id="376a7-382">Позволяет задать персональный сообщение в файле Default.aspx.</span><span class="sxs-lookup"><span data-stu-id="376a7-382">Let's provide a more personalized message in Default.aspx.</span></span> <span data-ttu-id="376a7-383">Обновление страницы\_загрузки обработчика событий таким образом, чтобы метки WelcomeBackMessage свойство Text присваивается строка «Добро пожаловать, *username*!»</span><span class="sxs-lookup"><span data-stu-id="376a7-383">Update the Page\_Load event handler so that the WelcomeBackMessage Label's Text property is assigned the string "Welcome back, *username*!"</span></span>

<span data-ttu-id="376a7-384">WelcomeBackMessage.Text = "Welcome back, " + User.Identity.Name + "!";</span><span class="sxs-lookup"><span data-stu-id="376a7-384">WelcomeBackMessage.Text = "Welcome back, " + User.Identity.Name + "!";</span></span>

<span data-ttu-id="376a7-385">Рис. 13 показано влияние этого изменения (при входе в систему как пользователь Скотт).</span><span class="sxs-lookup"><span data-stu-id="376a7-385">Figure 13 shows the effect of this modification (when logging in as user Scott).</span></span>


![Приветственное сообщение включает в себя пользователя в поле имя пользователя](an-overview-of-forms-authentication-cs/_static/image29.png)

<span data-ttu-id="376a7-387">**Рис. 13**: приветственное сообщение включает в себя пользователя в поле имя пользователя</span><span class="sxs-lookup"><span data-stu-id="376a7-387">**Figure 13**: The Welcome Message Includes the Currently Logged In User's Name</span></span>


### <a name="using-the-loginview-and-loginname-controls"></a><span data-ttu-id="376a7-388">С помощью LoginView и элементы управления LoginName</span><span class="sxs-lookup"><span data-stu-id="376a7-388">Using the LoginView and LoginName Controls</span></span>

<span data-ttu-id="376a7-389">Отображение различное содержимое для пользователей, прошедших проверку подлинности и анонимный является общим требованием; Таким образом, отображает имя пользователя, выполнившего вход.</span><span class="sxs-lookup"><span data-stu-id="376a7-389">Displaying different content to authenticated and anonymous users is a common requirement; so is displaying the name of the currently logged on user.</span></span> <span data-ttu-id="376a7-390">По этой причине ASP.NET включает в себя два веб-элементов управления, которые обеспечивают те же функциональные возможности, показанные на рис. 13, но без необходимости написания единой строки кода.</span><span class="sxs-lookup"><span data-stu-id="376a7-390">For that reason, ASP.NET includes two Web controls that provide the same functionality shown in Figure 13, but without the need to write a single line of code.</span></span>

<span data-ttu-id="376a7-391">[Управления LoginView](https://msdn.microsoft.com/library/system.web.ui.webcontrols.loginview.aspx) является на основе шаблона веб-элемент управления, упрощающий отображают различные данные для пользователей, прошедших проверку подлинности и анонимный.</span><span class="sxs-lookup"><span data-stu-id="376a7-391">The [LoginView control](https://msdn.microsoft.com/library/system.web.ui.webcontrols.loginview.aspx) is a template-based Web control that makes it easy to display different data to authenticated and anonymous users.</span></span> <span data-ttu-id="376a7-392">LoginView включает два стандартных шаблона:</span><span class="sxs-lookup"><span data-stu-id="376a7-392">The LoginView includes two predefined templates:</span></span>

- <span data-ttu-id="376a7-393">AnonymousTemplate — разметки добавлен в этот шаблон отображается только для анонимных пользователей.</span><span class="sxs-lookup"><span data-stu-id="376a7-393">AnonymousTemplate – any markup added to this template is only displayed to anonymous visitors.</span></span>
- <span data-ttu-id="376a7-394">LoggedInTemplate — разметки этот шаблон отображается только пользователям, прошедшим проверку.</span><span class="sxs-lookup"><span data-stu-id="376a7-394">LoggedInTemplate – this template's markup is shown only to authenticated users.</span></span>

<span data-ttu-id="376a7-395">Давайте добавим наш сайт главной страницы, Site.master элемента управления LoginView.</span><span class="sxs-lookup"><span data-stu-id="376a7-395">Let's add the LoginView control to our site's master page, Site.master.</span></span> <span data-ttu-id="376a7-396">Вместо добавления только элемента управления LoginView, добавим обе нового ContentPlaceHolder элемента управления и поместите в этот новый ContentPlaceHolder элемента управления LoginView.</span><span class="sxs-lookup"><span data-stu-id="376a7-396">Rather than adding just the LoginView control, though, let's add both a new ContentPlaceHolder control and then put the LoginView control within that new ContentPlaceHolder.</span></span> <span data-ttu-id="376a7-397">Вскоре станут очевидными обоснование для этого решения.</span><span class="sxs-lookup"><span data-stu-id="376a7-397">The rationale for this decision will become apparent shortly.</span></span>

> [!NOTE]
> <span data-ttu-id="376a7-398">Помимо AnonymousTemplate и LoggedInTemplate элемента управления LoginView могут включать шаблоны конкретных ролей.</span><span class="sxs-lookup"><span data-stu-id="376a7-398">In addition to the AnonymousTemplate and LoggedInTemplate, the LoginView control can include role-specific templates.</span></span> <span data-ttu-id="376a7-399">Шаблоны конкретных ролей отображение разметки только для тех пользователей, которые принадлежат определенной роли.</span><span class="sxs-lookup"><span data-stu-id="376a7-399">Role-specific templates show markup only to those users that belong to a specified role.</span></span> <span data-ttu-id="376a7-400">Возможности ролей управления LoginView изучим в будущем учебника.</span><span class="sxs-lookup"><span data-stu-id="376a7-400">We will examine the role-based features of the LoginView control in a future tutorial.</span></span>


<span data-ttu-id="376a7-401">Начните с добавления ContentPlaceHolder, с именем LoginContent в главной страницы в области навигации &lt;div&gt; элемента.</span><span class="sxs-lookup"><span data-stu-id="376a7-401">Start by adding a ContentPlaceHolder named LoginContent into the master page within the navigation &lt;div&gt; element.</span></span> <span data-ttu-id="376a7-402">Можно просто перетащить элемент управления ContentPlaceHolder из области элементов в представлении источника, поместив разметка прямо над «TODO: меню будет здесь...»</span><span class="sxs-lookup"><span data-stu-id="376a7-402">You can simply drag a ContentPlaceHolder control from the Toolbox onto the Source view, placing the resulting markup right above the "TODO: Menu will go here…"</span></span> <span data-ttu-id="376a7-403">текста.</span><span class="sxs-lookup"><span data-stu-id="376a7-403">text.</span></span>

[!code-aspx[Main](an-overview-of-forms-authentication-cs/samples/sample9.aspx)]

<span data-ttu-id="376a7-404">Добавьте элемент управления LoginView внутри LoginContent ContentPlaceHolder.</span><span class="sxs-lookup"><span data-stu-id="376a7-404">Next, add a LoginView control within the LoginContent ContentPlaceHolder.</span></span> <span data-ttu-id="376a7-405">Содержимое, помещаются в элементы управления главной страницы ContentPlaceHolder считаются *по умолчанию содержимое* для ContentPlaceHolder.</span><span class="sxs-lookup"><span data-stu-id="376a7-405">Content placed into the master page's ContentPlaceHolder controls are considered *default content* for the ContentPlaceHolder.</span></span> <span data-ttu-id="376a7-406">То есть страниц ASP.NET с использованием этой главной страницы можно указать свой собственный контент для каждого ContentPlaceHolder или использовать содержимое главной страницы по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="376a7-406">That is, ASP.NET pages that use this master page can specify their own content for each ContentPlaceHolder or use the master page's default content.</span></span>

<span data-ttu-id="376a7-407">LoginView и другие элементы управления входа расположены в входа вкладку области элементов.</span><span class="sxs-lookup"><span data-stu-id="376a7-407">The LoginView and other login-related controls are located in the Toolbox's Login tab.</span></span>


![На панели инструментов элемента управления LoginView](an-overview-of-forms-authentication-cs/_static/image30.png)

<span data-ttu-id="376a7-409">**Рис. 14**: на панели инструментов элемента управления LoginView</span><span class="sxs-lookup"><span data-stu-id="376a7-409">**Figure 14**: The LoginView Control in the Toolbox</span></span>


<span data-ttu-id="376a7-410">Добавьте два &lt;br /&gt; элементов сразу после элемента управления LoginView, но по-прежнему внутри ContentPlaceHolder.</span><span class="sxs-lookup"><span data-stu-id="376a7-410">Next, add two &lt;br /&gt; elements immediately after the LoginView control, but still within the ContentPlaceHolder.</span></span> <span data-ttu-id="376a7-411">На этом этапе навигации &lt;div&gt; элемента должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="376a7-411">At this point, the navigation &lt;div&gt; element's markup should look like the following:</span></span>

[!code-aspx[Main](an-overview-of-forms-authentication-cs/samples/sample10.aspx)]

<span data-ttu-id="376a7-412">Можно определить шаблоны LoginView из конструктора или декларативная разметка.</span><span class="sxs-lookup"><span data-stu-id="376a7-412">The LoginView's templates can be defined from the Designer or the declarative markup.</span></span> <span data-ttu-id="376a7-413">В конструкторе Visual Studio разверните LoginView смарт-тег, который содержит список настроенных шаблонов в раскрывающемся списке.</span><span class="sxs-lookup"><span data-stu-id="376a7-413">From Visual Studio's Designer, expand the LoginView's smart tag, which lists the configured templates in a drop-down list.</span></span> <span data-ttu-id="376a7-414">Введите текст «Hello, stranger» в AnonymousTemplate; затем добавьте элемента управления HyperLink и задать его свойства Text и NavigateUrl на «Вход» и «~ / Login.aspx» соответственно.</span><span class="sxs-lookup"><span data-stu-id="376a7-414">Type in the text "Hello, stranger" into the AnonymousTemplate; next, add a HyperLink control and set its Text and NavigateUrl properties to "Log In" and "~/Login.aspx", respectively.</span></span>

<span data-ttu-id="376a7-415">После настройки AnonymousTemplate, переключитесь в LoggedInTemplate и ввода текста, «Добро пожаловать».</span><span class="sxs-lookup"><span data-stu-id="376a7-415">After configuring the AnonymousTemplate, switch to the LoggedInTemplate and enter the text, "Welcome back, ".</span></span> <span data-ttu-id="376a7-416">Затем перетащите элемент управления LoginName из области элементов в LoggedInTemplate, поместив его сразу же после «Добро пожаловать назад,» текст.</span><span class="sxs-lookup"><span data-stu-id="376a7-416">Then drag a LoginName control from the Toolbox into the LoggedInTemplate, placing it immediately after the "Welcome back, " text.</span></span> <span data-ttu-id="376a7-417">[Управления LoginName](https://msdn.microsoft.com/library/system.web.ui.webcontrols.loginname.aspx), как предполагает название, отображает имя текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="376a7-417">The [LoginName control](https://msdn.microsoft.com/library/system.web.ui.webcontrols.loginname.aspx), as its name implies, displays the name of the currently logged in user.</span></span> <span data-ttu-id="376a7-418">Внутри элемента управления LoginName просто выводит свойства User.Identity.Name</span><span class="sxs-lookup"><span data-stu-id="376a7-418">Internally, the LoginName control simply outputs the User.Identity.Name property</span></span>

<span data-ttu-id="376a7-419">После внесения этих изменений в шаблоны LoginView, разметка должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="376a7-419">After making these additions to the LoginView's templates, the markup should look similar to the following:</span></span>

[!code-aspx[Main](an-overview-of-forms-authentication-cs/samples/sample11.aspx)]

<span data-ttu-id="376a7-420">В результате этого добавления на главную страницу Site.master каждой страницы в веб-узел будет отображаться различные сообщения в зависимости от того, является ли пользователь проверку подлинности.</span><span class="sxs-lookup"><span data-stu-id="376a7-420">With this addition to the Site.master master page, each page in our website will display a different message depending on whether the user is authenticated.</span></span> <span data-ttu-id="376a7-421">Рис. 15 показана страница Default.aspx при посещены пользователем Цзисунь через браузер.</span><span class="sxs-lookup"><span data-stu-id="376a7-421">Figure 15 shows the Default.aspx page when visited through a browser by user Jisun.</span></span> <span data-ttu-id="376a7-422">Сообщение «Добро пожаловать назад, Цзисунь» повторяется дважды: один раз в главной страницы переходов слева (с помощью элемента управления LoginView, мы только что добавили) и один раз в файле Default.aspx содержимого области (с помощью панели элементов управления и программная логика).</span><span class="sxs-lookup"><span data-stu-id="376a7-422">The "Welcome back, Jisun" message is repeated twice: once in the master page's navigation section on the left (via the LoginView control we just added) and once in the Default.aspx's content area (via Panel controls and programmatic logic).</span></span>


![Отображение элемента управления LoginView](an-overview-of-forms-authentication-cs/_static/image31.png)

<span data-ttu-id="376a7-424">**Рис. 15**: отображает элемент управления LoginView «Добро пожаловать, Цзисунь.»</span><span class="sxs-lookup"><span data-stu-id="376a7-424">**Figure 15**: The LoginView Control Displays "Welcome back, Jisun."</span></span>


<span data-ttu-id="376a7-425">Так как мы добавили LoginView на главную страницу, она может отображаться на каждой странице на нашем сайте.</span><span class="sxs-lookup"><span data-stu-id="376a7-425">Because we added the LoginView to the master page, it can appear in every page on our site.</span></span> <span data-ttu-id="376a7-426">Тем не менее могут существовать веб-страниц где мы не хотим Показать это сообщение.</span><span class="sxs-lookup"><span data-stu-id="376a7-426">However, there may be web pages where we don't want to show this message.</span></span> <span data-ttu-id="376a7-427">Такой страницы является страницу входа, поскольку ссылка на страницу входа кажется не на своем месте существует.</span><span class="sxs-lookup"><span data-stu-id="376a7-427">One such page is the login page, since a link to the login page seems out of place there.</span></span> <span data-ttu-id="376a7-428">Поскольку мы разместили элемент управления LoginView в ContentPlaceHolder на главной странице, эта разметка по умолчанию можно переопределить в нашу страницу содержимого.</span><span class="sxs-lookup"><span data-stu-id="376a7-428">Since we placed the LoginView control in a ContentPlaceHolder in the master page, we can override this default markup in our content page.</span></span> <span data-ttu-id="376a7-429">Откройте страницу Login.aspx и перейдите в конструктор.</span><span class="sxs-lookup"><span data-stu-id="376a7-429">Open Login.aspx and go to the Designer.</span></span> <span data-ttu-id="376a7-430">Поскольку мы не определен явно элемент управления содержимым в Login.aspx LoginContent ContentPlaceHolder на главной странице, на страницу входа покажет разметки главной страницы по умолчанию для этого ContentPlaceHolder.</span><span class="sxs-lookup"><span data-stu-id="376a7-430">Since we have not explicitly defined a Content control in Login.aspx for the LoginContent ContentPlaceHolder in the master page, the login page will show the master page's default markup for this ContentPlaceHolder.</span></span> <span data-ttu-id="376a7-431">Вы увидите это с помощью конструктора — LoginContent ContentPlaceHolder показана разметка по умолчанию (элемента управления LoginView).</span><span class="sxs-lookup"><span data-stu-id="376a7-431">You can see this through the Designer – the LoginContent ContentPlaceHolder shows the default markup (the LoginView control).</span></span>


<span data-ttu-id="376a7-432">[![Страница входа отображается по умолчанию содержимое для главной страницы LoginContent ContentPlaceHolder](an-overview-of-forms-authentication-cs/_static/image33.png)](an-overview-of-forms-authentication-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="376a7-432">[![The Login Page Shows the Default Content for the Master Page's LoginContent ContentPlaceHolder](an-overview-of-forms-authentication-cs/_static/image33.png)](an-overview-of-forms-authentication-cs/_static/image32.png)</span></span>

<span data-ttu-id="376a7-433">**На рисунке 16**: страницы входа показывает содержимого по умолчанию для главной страницы LoginContent ContentPlaceHolder ([Просмотр полноразмерное изображение](an-overview-of-forms-authentication-cs/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="376a7-433">**Figure 16**: The Login Page Shows the Default Content for the Master Page's LoginContent ContentPlaceHolder ([Click to view full-size image](an-overview-of-forms-authentication-cs/_static/image34.png))</span></span>


<span data-ttu-id="376a7-434">Чтобы переопределить стандартную разметку для LoginContent ContentPlaceHolder, щелкните правой кнопкой мыши в области конструктора и выберите создать настраиваемый содержимое в контекстном меню.</span><span class="sxs-lookup"><span data-stu-id="376a7-434">To override the default markup for the LoginContent ContentPlaceHolder, simply right-click on the region in the Designer and choose the Create Custom Content option from the context menu.</span></span> <span data-ttu-id="376a7-435">(При использовании Visual Studio 2008 ContentPlaceHolder включает смарт-тег, при выборе обеспечивает тот же параметр.) При этом добавляется новый элемента управления содержимым в разметке страницы и тем самым позволяет определить настраиваемое содержимое для этой страницы.</span><span class="sxs-lookup"><span data-stu-id="376a7-435">(When using Visual Studio 2008 the ContentPlaceHolder includes a smart tag that, when selected, offers the same option.) This adds a new Content control to the page's markup and thereby allows us to define custom content for this page.</span></span> <span data-ttu-id="376a7-436">Невозможно добавить пользовательское сообщение, например «Выполните вход in...», но давайте просто оставьте это поле пустым.</span><span class="sxs-lookup"><span data-stu-id="376a7-436">You could add a custom message here, such as "Please log in…", but let's just leave this blank.</span></span>

> [!NOTE]
> <span data-ttu-id="376a7-437">В Visual Studio 2005, при создании пользовательского содержимого создается пустой содержимого элемента управления на странице ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="376a7-437">In Visual Studio 2005, creating custom content creates an empty Content control in the ASP.NET page.</span></span> <span data-ttu-id="376a7-438">В Visual Studio 2008 Однако создание пользовательского содержимого копирует содержимое главной страницы по умолчанию в только что созданный элемент управления содержимым.</span><span class="sxs-lookup"><span data-stu-id="376a7-438">In Visual Studio 2008, however, creating custom content copies the master page's default content into the newly created Content control.</span></span> <span data-ttu-id="376a7-439">При использовании Visual Studio 2008, после создания нового элемента управления содержимым убедитесь очистить содержимое, скопированных из главной страницы.</span><span class="sxs-lookup"><span data-stu-id="376a7-439">If you are using Visual Studio 2008, then, after creating the new Content control make sure to clear out the content copied over from the master page.</span></span>


<span data-ttu-id="376a7-440">Рисунок 17 показана страница Login.aspx при посещении из браузера после внесения этого изменения.</span><span class="sxs-lookup"><span data-stu-id="376a7-440">Figure 17 shows the Login.aspx page when visited from a browser after making this change.</span></span> <span data-ttu-id="376a7-441">Обратите внимание, что не «Hello, stranger» или «Добро пожаловать, *username*» сообщение на панели навигации слева &lt;div&gt; как при посещении Default.aspx.</span><span class="sxs-lookup"><span data-stu-id="376a7-441">Note that there is no "Hello, stranger" or "Welcome back, *username*" message in the left navigation &lt;div&gt; as there is when visiting Default.aspx.</span></span>


<span data-ttu-id="376a7-442">[![Страница входа скрывает разметки LoginContent ContentPlaceHolder по умолчанию](an-overview-of-forms-authentication-cs/_static/image36.png)](an-overview-of-forms-authentication-cs/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="376a7-442">[![The Login Page Hides the Default LoginContent ContentPlaceHolder's Markup](an-overview-of-forms-authentication-cs/_static/image36.png)](an-overview-of-forms-authentication-cs/_static/image35.png)</span></span>

<span data-ttu-id="376a7-443">**Рисунок 17**: страницы входа скрывает разметки LoginContent ContentPlaceHolder по умолчанию ([Просмотр полноразмерное изображение](an-overview-of-forms-authentication-cs/_static/image37.png))</span><span class="sxs-lookup"><span data-stu-id="376a7-443">**Figure 17**: The Login Page Hides the Default LoginContent ContentPlaceHolder's Markup ([Click to view full-size image](an-overview-of-forms-authentication-cs/_static/image37.png))</span></span>


## <a name="step-5-logging-out"></a><span data-ttu-id="376a7-444">Шаг 5: Выход</span><span class="sxs-lookup"><span data-stu-id="376a7-444">Step 5: Logging Out</span></span>

<span data-ttu-id="376a7-445">На шаге 3 мы рассматривали создания страницы входа для входа пользователя в систему на сайте, но у нас есть еще сведения для пользователя выход. В дополнение к методам для входа пользователя в FormsAuthentication класс также предоставляет [метод SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx).</span><span class="sxs-lookup"><span data-stu-id="376a7-445">In Step 3 we looked at building a login page to log a user in to the site, but we have yet to see how to log a user out. In addition to methods for logging a user in, the FormsAuthentication class also provides a [SignOut method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx).</span></span> <span data-ttu-id="376a7-446">Метод SignOut просто уничтожает билета проверки подлинности форм, тем самым входа пользователя за пределы сайта.</span><span class="sxs-lookup"><span data-stu-id="376a7-446">The SignOut method simply destroys the forms authentication ticket, thereby logging the user out of the site.</span></span>

<span data-ttu-id="376a7-447">Журнал ожидания ссылка — это стандартная функция предложения, ASP.NET содержит элемент управления, специально для пользователя выход. [Управления LoginStatus](https://msdn.microsoft.com/library/system.web.ui.webcontrols.loginstatus.aspx) отображает LinkButton «Вход» или «Выход» LinkButton, в зависимости от состояния проверки подлинности пользователя.</span><span class="sxs-lookup"><span data-stu-id="376a7-447">Offering a log out link is such a common feature that ASP.NET includes a control specifically designed to log a user out. The [LoginStatus control](https://msdn.microsoft.com/library/system.web.ui.webcontrols.loginstatus.aspx) displays either a "Login" LinkButton or a "Logout" LinkButton, depending on the user's authentication status.</span></span> <span data-ttu-id="376a7-448">В то время как LinkButton «Выход» отображается пользователям, прошедшим проверку для анонимных пользователей отображается LinkButton «Вход».</span><span class="sxs-lookup"><span data-stu-id="376a7-448">A "Login" LinkButton is rendered for anonymous users, whereas a "Logout" LinkButton is displayed to authenticated users.</span></span> <span data-ttu-id="376a7-449">Текст для элементов управления LinkButton «Выход» и «Вход» можно настроить с помощью LoginStatus LoginText и LogoutText свойства.</span><span class="sxs-lookup"><span data-stu-id="376a7-449">The text for the "Login" and "Logout" LinkButtons can be configured via the LoginStatus's LoginText and LogoutText properties.</span></span>

<span data-ttu-id="376a7-450">Нажав кнопку «Вход» LinkButton вызывает обратную передачу, из которого выпускается перенаправление на страницу входа.</span><span class="sxs-lookup"><span data-stu-id="376a7-450">Clicking the "Login" LinkButton causes a postback, from which a redirect is issued to the login page.</span></span> <span data-ttu-id="376a7-451">Нажав кнопку «Выход» LinkButton заставляет элемент управления LoginStatus для вызова метода FormsAuthentication.SignOff и затем перенаправляет пользователя на страницу.</span><span class="sxs-lookup"><span data-stu-id="376a7-451">Clicking the "Logout" LinkButton causes the LoginStatus control to invoke the FormsAuthentication.SignOff method and then redirects the user to a page.</span></span> <span data-ttu-id="376a7-452">Страница, вошедшего в систему сеанс пользователя перенаправляется зависит от свойства LogoutAction, который можно назначить одно из трех следующих значений:</span><span class="sxs-lookup"><span data-stu-id="376a7-452">The page the logged off user is redirected to depends on the LogoutAction property, which can be assigned to one of the three following values:</span></span>

- <span data-ttu-id="376a7-453">Обновление — значение по умолчанию. перенаправляет пользователя на страницу, которую они только что посещения.</span><span class="sxs-lookup"><span data-stu-id="376a7-453">Refresh – the default; redirects the user to the page they were just visiting.</span></span> <span data-ttu-id="376a7-454">Если страница, которую они только что посещения анонимным пользователям не разрешено, затем FormsAuthenticationModule будет автоматически перенаправлять пользователя на страницу входа.</span><span class="sxs-lookup"><span data-stu-id="376a7-454">If the page they were just visiting does not allow anonymous users, then the FormsAuthenticationModule will automatically redirect the user to the login page.</span></span>

<span data-ttu-id="376a7-455">Может быть интересно, перешли почему здесь выполняется перенаправление.</span><span class="sxs-lookup"><span data-stu-id="376a7-455">You may be curious as to why a redirect is performed here.</span></span> <span data-ttu-id="376a7-456">Если пользователь хочет остаются на той же странице, почему необходимость явного перенаправления?</span><span class="sxs-lookup"><span data-stu-id="376a7-456">If the user wants to remain on the same page, why the need for the explicit redirect?</span></span> <span data-ttu-id="376a7-457">Так как при щелчке LinkButton «Выход», пользователь по-прежнему имеет билета проверки подлинности форм в свою коллекцию файлов cookie.</span><span class="sxs-lookup"><span data-stu-id="376a7-457">The reason is because when the "Logoff" LinkButton is clicked, the user still has the forms authentication ticket in their cookies collection.</span></span> <span data-ttu-id="376a7-458">Поэтому обратного запроса является запрос с проверкой подлинности.</span><span class="sxs-lookup"><span data-stu-id="376a7-458">Consequently, the postback request is an authenticated request.</span></span> <span data-ttu-id="376a7-459">Элемент управления LoginStatus вызывает метод SignOut, но это происходит после FormsAuthenticationModule прошел проверку подлинности пользователя.</span><span class="sxs-lookup"><span data-stu-id="376a7-459">The LoginStatus control calls the SignOut method, but that happens after the FormsAuthenticationModule has authenticated the user.</span></span> <span data-ttu-id="376a7-460">Таким образом для явного перенаправления заставляет браузер повторного запроса страницы.</span><span class="sxs-lookup"><span data-stu-id="376a7-460">Therefore, an explicit redirect causes the browser to re-request the page.</span></span> <span data-ttu-id="376a7-461">К моменту браузер повторно запрашивает страницу билета проверки подлинности форм была удалена, и поэтому входящего запроса является анонимным.</span><span class="sxs-lookup"><span data-stu-id="376a7-461">By the time the browser re-requests the page, the forms authentication ticket has been removed and therefore the incoming request is anonymous.</span></span>

- <span data-ttu-id="376a7-462">Перенаправления — пользователь перенаправляется на URL-адрес, заданный свойством LogoutPageUrl LoginStatus.</span><span class="sxs-lookup"><span data-stu-id="376a7-462">Redirect – the user is redirected to the URL specified by the LoginStatus's LogoutPageUrl property.</span></span>
- <span data-ttu-id="376a7-463">RedirectToLoginPage — пользователь перенаправляется на страницу входа.</span><span class="sxs-lookup"><span data-stu-id="376a7-463">RedirectToLoginPage – the user is redirected to the login page.</span></span>

<span data-ttu-id="376a7-464">Давайте управления LoginStatus главной страницы и настройте его для использования перенаправления параметр для отправки пользователю страницу, которая выводит сообщение, подтверждающее, что они вышли из системы. Начните с создания страницы в корневом каталоге с именем Logout.aspx.</span><span class="sxs-lookup"><span data-stu-id="376a7-464">Let's add a LoginStatus control to the master page and configure it to use the Redirect option to send the user to a page that displays a message confirming that they have been signed out. Start by creating a page in the root directory named Logout.aspx.</span></span> <span data-ttu-id="376a7-465">Не забудьте связать эту страницу с главной страницы Site.master.</span><span class="sxs-lookup"><span data-stu-id="376a7-465">Don't forget to associate this page with the Site.master master page.</span></span> <span data-ttu-id="376a7-466">Затем введите сообщение в разметке страницы, объясняющий пользователю, который они отключены.</span><span class="sxs-lookup"><span data-stu-id="376a7-466">Next, enter a message in the page's markup explaining to the user that they have been logged out.</span></span>

<span data-ttu-id="376a7-467">Затем вернуться на главную страницу Site.master и добавьте элемент управления LoginStatus под LoginView в LoginContent ContentPlaceHolder.</span><span class="sxs-lookup"><span data-stu-id="376a7-467">Next, return to the Site.master master page and add a LoginStatus control beneath the LoginView in the LoginContent ContentPlaceHolder.</span></span> <span data-ttu-id="376a7-468">Задать свойства элемента управления LoginStatus LogoutAction перенаправления, а для свойства LogoutPageUrl в «~ / Logout.aspx».</span><span class="sxs-lookup"><span data-stu-id="376a7-468">Set the LoginStatus control's LogoutAction property to Redirect and its LogoutPageUrl property to "~/Logout.aspx".</span></span>

[!code-aspx[Main](an-overview-of-forms-authentication-cs/samples/sample12.aspx)]

<span data-ttu-id="376a7-469">Поскольку LoginStatus выходит за пределы элемента управления LoginView, он будет отображаться для анонимных и зарегистрированных пользователей, но это нормально, так как «Вход» или «Выход» LinkButton LoginStatus будет правильно отображать.</span><span class="sxs-lookup"><span data-stu-id="376a7-469">Since the LoginStatus is outside of the LoginView control, it will appear for both anonymous and authenticated users, but that's OK because the LoginStatus will correctly display a "Login" or "Logout" LinkButton.</span></span> <span data-ttu-id="376a7-470">При добавлении элемента управления LoginStatus гиперссылка «Вход» AnonymousTemplate является избыточным, таким образом удалить.</span><span class="sxs-lookup"><span data-stu-id="376a7-470">With the addition of the LoginStatus control, the "Log In" HyperLink in the AnonymousTemplate is superfluous, so remove it.</span></span>

<span data-ttu-id="376a7-471">На рисунке 18 показано Default.aspx при посещении Цзисунь.</span><span class="sxs-lookup"><span data-stu-id="376a7-471">Figure 18 shows Default.aspx when Jisun visits.</span></span> <span data-ttu-id="376a7-472">Обратите внимание, что в левом столбце отображается сообщение «Добро пожаловать, Цзисунь» со ссылкой на выход. Щелкнув выход LinkButton вызывает обратную передачу, Цзисунь выходит из системы и перенаправляет ее Logout.aspx.</span><span class="sxs-lookup"><span data-stu-id="376a7-472">Note that the left column displays the message, "Welcome back, Jisun" along with a link to log out. Clicking the log out LinkButton causes a postback, signs Jisun out of the system, and then redirects her to Logout.aspx.</span></span> <span data-ttu-id="376a7-473">Как показано на рисунке 19, когда Цзисунь достигает Logout.aspx ей уже произведен выход и поэтому является анонимным.</span><span class="sxs-lookup"><span data-stu-id="376a7-473">As Figure 19 shows, by the time Jisun reaches Logout.aspx she has already been signed out and is therefore anonymous.</span></span> <span data-ttu-id="376a7-474">Следовательно, в левом столбце отображается текст «Добро пожаловать, stranger» и ссылка на страницу входа.</span><span class="sxs-lookup"><span data-stu-id="376a7-474">Consequently, the left column shows the text "Welcome, stranger" and a link to the login page.</span></span>


<span data-ttu-id="376a7-475">[![Показывает Default.aspx](an-overview-of-forms-authentication-cs/_static/image39.png)](an-overview-of-forms-authentication-cs/_static/image38.png)</span><span class="sxs-lookup"><span data-stu-id="376a7-475">[![Default.aspx Shows](an-overview-of-forms-authentication-cs/_static/image39.png)](an-overview-of-forms-authentication-cs/_static/image38.png)</span></span>

<span data-ttu-id="376a7-476">**На рисунке 18**: показывает Default.aspx «Добро пожаловать, Цзисунь» вместе с LinkButton «Выход» ([Просмотр полноразмерное изображение](an-overview-of-forms-authentication-cs/_static/image40.png))</span><span class="sxs-lookup"><span data-stu-id="376a7-476">**Figure 18**: Default.aspx Shows "Welcome Back, Jisun" Along with a "Logout" LinkButton ([Click to view full-size image](an-overview-of-forms-authentication-cs/_static/image40.png))</span></span>


<span data-ttu-id="376a7-477">[![Показывает Logout.aspx](an-overview-of-forms-authentication-cs/_static/image42.png)](an-overview-of-forms-authentication-cs/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="376a7-477">[![Logout.aspx Shows](an-overview-of-forms-authentication-cs/_static/image42.png)](an-overview-of-forms-authentication-cs/_static/image41.png)</span></span>

<span data-ttu-id="376a7-478">**На рисунке 19**: показывает Logout.aspx «Добро пожаловать, stranger» вместе с LinkButton «Вход» ([Просмотр полноразмерное изображение](an-overview-of-forms-authentication-cs/_static/image43.png))</span><span class="sxs-lookup"><span data-stu-id="376a7-478">**Figure 19**: Logout.aspx Shows "Welcome, stranger" Along with a "Login" LinkButton ([Click to view full-size image](an-overview-of-forms-authentication-cs/_static/image43.png))</span></span>


> [!NOTE]
> <span data-ttu-id="376a7-479">Я рекомендую настроить Logout.aspx страницу, чтобы скрыть LoginContent ContentPlaceHolder главной страницы (как это делалось для Login.aspx на шаге 4).</span><span class="sxs-lookup"><span data-stu-id="376a7-479">I encourage you to customize the Logout.aspx page to hide the master page's LoginContent ContentPlaceHolder (like we did for Login.aspx in Step 4).</span></span> <span data-ttu-id="376a7-480">Потому, что отображаемый элементом управления LoginStatus LinkButton «Вход» (один под «Hello, stranger») отправляет на страницу входа, передавая ReturnUrl параметра строки запроса URL-адрес текущего пользователя.</span><span class="sxs-lookup"><span data-stu-id="376a7-480">The reason is because the "Login" LinkButton rendered by the LoginStatus control (the one beneath "Hello, stranger") sends the user to the login page passing the current URL in the ReturnUrl querystring parameter.</span></span> <span data-ttu-id="376a7-481">Иными словами Если пользователь, выполнивший вход out щелкнет этот LoginStatus LinkButton «Вход» и затем регистрирует в, они будут перенаправляться обратно в Logout.aspx, который легко может запутать пользователя.</span><span class="sxs-lookup"><span data-stu-id="376a7-481">In short, if a user who has logged out clicks this LoginStatus's "Login" LinkButton, and then logs in, they will be redirected back to Logout.aspx, which could easily confuse the user.</span></span>


## <a name="summary"></a><span data-ttu-id="376a7-482">Сводка</span><span class="sxs-lookup"><span data-stu-id="376a7-482">Summary</span></span>

<span data-ttu-id="376a7-483">В этом учебнике работы с проверкой рабочего процесса проверки подлинности форм, а затем в ней реализация проверки подлинности форм в приложении ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="376a7-483">In this tutorial we started with an examination of the forms authentication workflow and then turned to implementing forms authentication in an ASP.NET application.</span></span> <span data-ttu-id="376a7-484">На платформе проверки подлинности форм FormsAuthenticationModule, есть две задачи: определение пользователям на основании их билета проверки подлинности форм и Перенаправление неавторизованных пользователей на страницу входа.</span><span class="sxs-lookup"><span data-stu-id="376a7-484">Forms authentication is powered by the FormsAuthenticationModule, which has two responsibilities: identifying users based on their forms authentication ticket, and redirecting unauthorized users to the login page.</span></span>

<span data-ttu-id="376a7-485">Класс FormsAuthentication .NET Framework включает методы для создания, просмотр и удаление билетов проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="376a7-485">The .NET Framework's FormsAuthentication class includes methods for creating, inspecting, and removing forms authentication tickets.</span></span> <span data-ttu-id="376a7-486">Свойство Request.IsAuthenticated и объект пользователя предоставлять дополнительную поддержку программный для определения, является ли запрос проходит проверку подлинности и информации об удостоверении пользователя.</span><span class="sxs-lookup"><span data-stu-id="376a7-486">The Request.IsAuthenticated property and User object provide additional programmatic support for determining whether a request is authenticated and information about the user's identity.</span></span> <span data-ttu-id="376a7-487">Также существуют элементы управления LoginView, LoginStatus и LoginName Web, которых предоставления разработчикам возможности быстрого, написания кода для выполнения многих распространенных задач, связанных с имени входа.</span><span class="sxs-lookup"><span data-stu-id="376a7-487">There are also the LoginView, LoginStatus, and LoginName Web controls, which give developers a quick, code-free way for performing many common login-related tasks.</span></span> <span data-ttu-id="376a7-488">Рассмотрим эти и другие связанные с именем входа веб-элементов управления более подробно в будущих учебниках.</span><span class="sxs-lookup"><span data-stu-id="376a7-488">We will examine these and other login-related Web controls in greater detail in future tutorials.</span></span>

<span data-ttu-id="376a7-489">Этот учебник предоставляется поверхностной обзор проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="376a7-489">This tutorial provided a cursory overview of forms authentication.</span></span> <span data-ttu-id="376a7-490">Мы не проверить различные параметры, рассмотрим как cookieless рабочих билетов проверки подлинности форм или исследовать, как ASP.NET защищает содержимое билета проверки подлинности форм.</span><span class="sxs-lookup"><span data-stu-id="376a7-490">We did not examine the assorted configuration options, look at how cookieless forms authentication tickets work, or explore how ASP.NET protects the contents of the forms authentication ticket.</span></span> <span data-ttu-id="376a7-491">Мы рассмотрим эти разделы и см. в разделе [следующее руководство](forms-authentication-configuration-and-advanced-topics-cs.md).</span><span class="sxs-lookup"><span data-stu-id="376a7-491">We will discuss these topics and more in the [next tutorial](forms-authentication-configuration-and-advanced-topics-cs.md).</span></span>

<span data-ttu-id="376a7-492">Программирование довольны!</span><span class="sxs-lookup"><span data-stu-id="376a7-492">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="376a7-493">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="376a7-493">Further Reading</span></span>

<span data-ttu-id="376a7-494">Дополнительные сведения по темам, рассматриваемые в этом учебнике см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="376a7-494">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="376a7-495">Изменения между безопасности служб IIS 7 и IIS 6</span><span class="sxs-lookup"><span data-stu-id="376a7-495">Changes Between IIS6 and IIS7 Security</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/Changes-between-IIS6-and-IIS7-Security)
- [<span data-ttu-id="376a7-496">Элементы управления входом ASP.NET</span><span class="sxs-lookup"><span data-stu-id="376a7-496">Login ASP.NET Controls</span></span>](https://msdn.microsoft.com/library/d51ttbhx.aspx)
- <span data-ttu-id="376a7-497">[Профессиональные ASP.NET 2.0 безопасности, членства и управления ролями](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span><span class="sxs-lookup"><span data-stu-id="376a7-497">[Professional ASP.NET 2.0 Security, Membership, and Role Management](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span></span>
- [<span data-ttu-id="376a7-498">`<authentication>` Элемент</span><span class="sxs-lookup"><span data-stu-id="376a7-498">The `<authentication>` Element</span></span>](https://msdn.microsoft.com/library/532aee0e.aspx)
- [<span data-ttu-id="376a7-499">`<forms>` Элемент для `<authentication>`</span><span class="sxs-lookup"><span data-stu-id="376a7-499">The `<forms>` Element for `<authentication>`</span></span>](https://msdn.microsoft.com/library/1d3t3c61.aspx)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="376a7-500">Видео на разделы, содержащиеся в этом учебнике</span><span class="sxs-lookup"><span data-stu-id="376a7-500">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="376a7-501">Использование базовой проверки подлинности на основе форм в ASP.NET</span><span class="sxs-lookup"><span data-stu-id="376a7-501">Using Basic Forms Authentication in ASP.NET</span></span>](../../../videos/authentication/using-basic-forms-authentication-in-aspnet.md)

## <a name="about-the-author"></a><span data-ttu-id="376a7-502">Об авторе</span><span class="sxs-lookup"><span data-stu-id="376a7-502">About the Author</span></span>

<span data-ttu-id="376a7-503">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="376a7-503">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="376a7-504">Скотт — независимый консультант, trainer и записи.</span><span class="sxs-lookup"><span data-stu-id="376a7-504">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="376a7-505">Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="376a7-505">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="376a7-506">Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="376a7-506">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="376a7-507">Особая благодарность</span><span class="sxs-lookup"><span data-stu-id="376a7-507">Special Thanks To…</span></span>

<span data-ttu-id="376a7-508">Этот учебник ряд прошел проверку многие полезные рецензентов.</span><span class="sxs-lookup"><span data-stu-id="376a7-508">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="376a7-509">Основной рецензент этого учебника было ряда прошел проверку многие полезные рецензентов этого учебника.</span><span class="sxs-lookup"><span data-stu-id="376a7-509">Lead reviewer for this tutorial was This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="376a7-510">Основными редакторами этого учебника включают Alicja Maziarz, Джон Suru и Мерфи Тереза д.</span><span class="sxs-lookup"><span data-stu-id="376a7-510">Lead reviewers for this tutorial include Alicja Maziarz, John Suru, and Teresa Murphy.</span></span> <span data-ttu-id="376a7-511">Объясняются моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="376a7-511">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="376a7-512">Если Да, напишите мне по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="376a7-512">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="376a7-513">[Назад](security-basics-and-asp-net-support-cs.md)
> [Вперед](forms-authentication-configuration-and-advanced-topics-cs.md)</span><span class="sxs-lookup"><span data-stu-id="376a7-513">[Previous](security-basics-and-asp-net-support-cs.md)
[Next](forms-authentication-configuration-and-advanced-topics-cs.md)</span></span>
