---
uid: web-forms/overview/older-versions-security/membership/user-based-authorization-vb
title: Авторизация на основе пользователя (Visual Basic) | Документы Microsoft
author: rick-anderson
description: В этом учебнике мы рассмотрим ограничивая доступ к страницам и ограничить функциональные возможности уровня страницы с помощью разных методов.
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/18/2008
ms.topic: article
ms.assetid: bc937e9d-5c14-4fc4-aec7-440da924dd18
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/membership/user-based-authorization-vb
msc.type: authoredcontent
ms.openlocfilehash: 4073f349c7965a89b39a4b1b672f0e84fc96f287
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/10/2018
ms.locfileid: "30891949"
---
<a name="user-based-authorization-vb"></a>Авторизация на основе пользователя (Visual Basic)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить код](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_VB.zip) или [скачать PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_vb.pdf)

> В этом учебнике мы рассмотрим ограничивая доступ к страницам и ограничить функциональные возможности уровня страницы с помощью разных методов.


## <a name="introduction"></a>Вступление

Большинство веб-приложений, которые содержат учетные записи пользователей этого в части для ограничения определенных посетители доступ определенные страницы в пределах сайта. Например, в наиболее online messageboard сайтов, всех пользователей - анонимных и зарегистрированных - доступны для просмотра записей messageboard, но только авторизованные пользователи могут посещать веб-странице, чтобы создать новую запись. И может быть административных страниц, которые доступны только для конкретного пользователя (или конкретной группы пользователей). Кроме того функциональные возможности уровня страницы могут различаться на основе пользователя по. При просмотре список записей, прошедших проверку подлинности пользователей отображаются интерфейс для оценки каждой отправки, в то время как этот интерфейс доступен не для анонимных пользователей.

ASP.NET позволяет легко определить правила авторизации пользователя. Посвятив совсем немного разметки в `Web.config`, определенные веб-страницы или весь каталог может быть зафиксирован, чтобы они доступны только определенному подмножеству пользователей. Функциональные возможности уровня страницы можно включить или отключить зависимости от текущего вошедшего пользователя, программный и декларативный способом.

В этом учебнике мы рассмотрим ограничивая доступ к страницам и ограничить функциональные возможности уровня страницы с помощью разных методов. Давайте начнем!

## <a name="a-look-at-the-url-authorization-workflow"></a>Рассмотрим рабочий процесс авторизации URL-адрес

Как было сказано в [ *Общие сведения для проверки подлинности форм* ](../introduction/an-overview-of-forms-authentication-vb.md) учебник, когда среда выполнения ASP.NET обрабатывает запрос для ресурса запроса ASP.NET Возводит число событий в течение его жизненного цикла. *Модули HTTP* — управляемые классы, в которых код выполняется в ответ на определенное событие в жизненном цикле запроса. ASP.NET поставляется с ряд модулей HTTP, выполнять основные задачи в фоновом.

Один такой модуль HTTP является [ `FormsAuthenticationModule` ](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx). Как описано в предыдущих занятий, основная функция `FormsAuthenticationModule` определяет удостоверение текущего запроса. Это достигается путем проверки билета проверки подлинности форм, которая находится в файле cookie или внедрен в URL-адрес. Этот код выполняется во время [ `AuthenticateRequest` событие](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).

Является другим важным HTTP-модуля [ `UrlAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), который вызывается в ответ на [ `AuthorizeRequest` событий](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (которого будет происходить после `AuthenticateRequest` событий). `UrlAuthorizationModule` Проверяет разметку настройки в `Web.config` для определения, имеет ли текущее удостоверение полномочия на указанной странице. Этот процесс называется *Авторизация URL-адреса*.

Мы рассмотрим синтаксис для правила авторизации URL-адреса на шаге 1, но сначала давайте рассмотрим, что `UrlAuthorizationModule` в зависимости от того, авторизован ли запрос или нет. Если `UrlAuthorizationModule` определяет, что запрос имеет такое разрешение, то он не выполняет никаких действий и запроса продолжается по жизненному циклу. Тем не менее если запрос является *не* прав, то `UrlAuthorizationModule` прерывает жизненный цикл и указывает, что `Response` возвращаемого объекта [HTTP 401 несанкционированный](http://www.checkupdown.com/status/E401.html) состояния. При использовании проверки подлинности форм это состояние HTTP 401 никогда не возвращается клиенту, поскольку если `FormsAuthenticationModule` обнаруживает ошибку HTTP 401, находится в состоянии изменяет его [перенаправления HTTP 302](http://www.checkupdown.com/status/E302.html) на страницу входа.

На рисунке 1 показан рабочий процесс конвейера ASP.NET `FormsAuthenticationModule`и `UrlAuthorizationModule` при приеме неавторизованный запрос. В частности, на рис. 1 показан запрос для анонимных посетителем `ProtectedPage.aspx`, который является страницы, которая запрещает доступ анонимным пользователям. Поскольку пользователь является анонимным, `UrlAuthorizationModule` прерывает запрос и возвращает статус несанкционированного HTTP 401. `FormsAuthenticationModule` Затем преобразует состояния 401 на 302 — перенаправление на страницу входа. После проверки подлинности пользователя через страницу входа, он перенаправляется `ProtectedPage.aspx`. Это время `FormsAuthenticationModule` определяет, основываясь на его билета проверки подлинности пользователя. Теперь, когда пользователь прошел проверку подлинности, `UrlAuthorizationModule` разрешает доступ к странице.


[![Проверка подлинности форм и рабочий процесс авторизации URL-адрес](user-based-authorization-vb/_static/image2.png)](user-based-authorization-vb/_static/image1.png)

**Рис. 1**: форм проверки подлинности и рабочего процесса авторизации URL-адрес ([Просмотр полноразмерное изображение](user-based-authorization-vb/_static/image3.png))


Рис. 1 показаны взаимодействие, возникающее при попытке доступа к ресурсу, который недоступен для анонимных пользователей анонимный посетителя. В этом случае анонимный пользователь перенаправляется на страницу входа с этой страницей, она была предпринята попытка посетите указанный в строке запроса. Когда пользователь успешно вошел в систему, она будет автоматически перенаправляется обратно на ресурс, который она изначально попытке просмотра.

Неавторизованный запрос, сделанные анонимного пользователя, этот рабочий процесс структурирован и легко для посетителя понять, что произошло и почему. Но имейте в виду, что `FormsAuthenticationModule` будет перенаправлять *любой* несанкционированный пользователя на страницу входа, даже если запрос выполняется пользователем, прошедшим проверку. Это может привести к путанице при использовании попытка посетите страницу, для которой она не имеет полномочия прошедшего проверку подлинности пользователя.

Предположим, что наш веб-сайт имел его правила авторизации URL-адрес, настроенные таким образом, что на странице ASP.NET `OnlyTito.aspx` было accessibly только Tito. Теперь предположим, что Sam посещает сайт, входит в систему, а затем пытается посетить `OnlyTito.aspx`. `UrlAuthorizationModule` Будет остановки цикла запроса и возвращает статус HTTP 401 несанкционированный которой `FormsAuthenticationModule` обнаружит и затем перенаправлять Sam на страницу входа. Поскольку Sam уже выполнил вход, хотя она может возникнуть вопрос, почему она отправлен обратно на страницу входа. Она может причин, что его имя входа учетные данные были потеряны каким-либо образом, или что она введены неправильные учетные данные. Если Sam повторно вводит свои учетные данные на странице входа она будет войти в систему (снова) и перенаправляется `OnlyTito.aspx`. `UrlAuthorizationModule` Обнаружит, что Sam не посетите эту страницу, и она будет возвращаться на страницу входа.

На рисунке 2 показан этот рабочий процесс в путаницу.


[![Рабочий процесс по умолчанию может привести к путанице цикла](user-based-authorization-vb/_static/image5.png)](user-based-authorization-vb/_static/image4.png)

**На рисунке 2**: по умолчанию рабочий процесс может привести к цикл путать ([Просмотр полноразмерное изображение](user-based-authorization-vb/_static/image6.png))


Рабочий процесс, показанная на рисунке 2 можно быстро befuddle даже большинство компьютера грамотный посетителя. Мы рассмотрим способы во избежание этого путать цикла на шаге 2.

> [!NOTE]
> ASP.NET использует два механизма, чтобы определить, может ли текущий пользователь доступ к определенной веб-страницы: авторизация URL-адреса и авторизация файла. Авторизация файла реализуется [ `FileAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), определяющий центр по журналу запрошенного файлы списки управления доступом. Авторизация файла чаще всего используется с проверкой подлинности Windows, так как ACL представляют собой разрешения, которые применяются к учетным записям Windows. При использовании проверки подлинности форм, все запросы системного уровня операционной системы и файл выполняемых учетную запись Windows, независимо от пользователя на узле. После этого учебника посвящены форм проверки подлинности, мы не будем рассматривать авторизация файла.


### <a name="the-scope-of-url-authorization"></a>Область авторизации URL-адрес

`UrlAuthorizationModule` — Управляемый код, который является частью среды выполнения ASP.NET. До версии 7 корпорации Майкрософт [Internet Information Services (IIS)](https://www.iis.net/) веб-сервере произошла distinct барьер между HTTP-конвейера служб IIS и среды выполнения ASP.NET конвейера. Иными словами, в IIS 6 и более ранних версиях ASP. В NET `UrlAuthorizationModule` выполняется только в случае, когда запрос делегируется среды выполнения ASP.NET из IIS. По умолчанию службы IIS обрабатывает статического содержимого, сам - как страницы HTML и CSS, JavaScript и файлы изображений — и только передает запросы к среде выполнения ASP.NET, когда страница с расширением `.aspx`, `.asmx`, или `.ashx` запрашивается.

IIS 7, однако позволяет для интеграции служб IIS и ASP.NET конвейеров. Некоторые параметры конфигурации можно настроить службы IIS 7 для вызова `UrlAuthorizationModule` для *все* запросы, это означает, что правила авторизации URL-адреса могут быть определены для файлов любого типа. Кроме того службы IIS 7 содержит собственный механизм авторизации URL-адрес. Дополнительные сведения об интеграции ASP.NET и IIS 7 собственные функции авторизации URL-адрес, в разделе [авторизации URL-адресов для IIS7 основные сведения о](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization). Более подробное рассмотрение интеграции ASP.NET и IIS 7, получают копию книги Shahram Khosravi *Professional IIS 7 и ASP.NET интеграции программирования* (ISBN: 978 0470152539).

По сути в версиях, предшествующих IIS 7, правила авторизации URL-адреса применяются только к ресурсам, которые обрабатываются средой выполнения ASP.NET. Но в службах IIS 7 можно использовать IIS собственный компонент авторизации URL-адреса или интегрировать ASP. NET `UrlAuthorizationModule` в конвейер HTTP служб IIS, тем самым расширяя этих функциональных возможностей для всех запросов.

> [!NOTE]
> Существуют некоторые небольшие, но важные различия в том, как ASP. NET `UrlAuthorizationModule` и обработка правил авторизации функция авторизации URL-адрес службы IIS 7. Этот учебник не проверяет функциональные возможности авторизации URL-адрес службы IIS 7 или различия в том, как он анализирует правил авторизации, по сравнению с `UrlAuthorizationModule`. Дополнительные сведения об этих темах см. в документации IIS 7 в библиотеке MSDN или в [www.iis.net](https://www.iis.net/).


## <a name="step-1-defining-url-authorization-rules-inwebconfig"></a>Шаг 1: Определение правила авторизации URL-адреса в`Web.config`

`UrlAuthorizationModule` Определяет, следует ли предоставить или запретить доступ к ресурсу для конкретное удостоверение на основе правил авторизации URL-адреса, определенные в конфигурации приложения. Правила авторизации выраженная в [ `<authorization>` элемент](https://msdn.microsoft.com/library/8d82143t.aspx) в виде `<allow>` и `<deny>` дочерних элементов. Каждый `<allow>` и `<deny>` можно задать дочерний элемент:

- Конкретного пользователя
- Разделенный запятыми список пользователей
- Все анонимные пользователи обозначаются знаком вопроса (?)
- Все пользователи, отмечены звездочкой (\*)

Приведенная ниже разметка описывается использование правил авторизации URL-адреса позволяют пользователям Tito и Скотт и запретить все остальные:

[!code-xml[Main](user-based-authorization-vb/samples/sample1.xml)]

`<allow>` Элемент определяет, какие пользователи могут - Tito и Scott - пока `<deny>` элемент указывает, что, *все* пользователям будет запрещен.

> [!NOTE]
> `<allow>` И `<deny>` элементы также можно указать правила авторизации для ролей. Изучим авторизации на основе ролей в будущем учебника.


Следующий параметр предоставляет доступ для всех, кроме диспетчера учетных записей безопасности (включая анонимных пользователей):

[!code-xml[Main](user-based-authorization-vb/samples/sample2.xml)]

Чтобы разрешить только пользователи, прошедшие проверку подлинности, используйте следующую конфигурацию, который запрещает доступ всем анонимным пользователям:

[!code-xml[Main](user-based-authorization-vb/samples/sample3.xml)]

Правила авторизации определяются в `<system.web>` элемент в `Web.config` и применяются ко всем ресурсам в веб-приложении ASP.NET. Очень часто в приложении имеются правила авторизации разные в разных разделах. Например сайте электронной коммерции всех посетителей может их продукты, просматривать обзоры продуктов, поиск в каталоге и так далее. Однако только пользователи, прошедшие проверку подлинности может достигать извлечение или страницы для управления единицы доставки журнала. Кроме того может быть частей узла, которые доступны только выбор: пользователи, таких как администратор сайта.

ASP.NET позволяет легко определить правила авторизации различных различные файлы и папки на сайте. Правила авторизации, указанный в корневой папке `Web.config` файла применяются ко всем ресурсам ASP.NET на сайте. Тем не менее, эти параметры авторизации по умолчанию могут переопределяться для конкретной папки, добавив `Web.config` с `<authorization>` раздела.

Давайте обновление наш веб-сайта, чтобы только прошедшие проверку подлинности пользователи могут посещать страниц ASP.NET в `Membership` папки. Для этого необходимо добавить `Web.config` файл `Membership` папки и задать его параметры авторизации, чтобы запретить анонимные пользователи. Щелкните правой кнопкой мыши `Membership` контекстном меню выберите команду Добавить новый элемент меню папки в обозревателе решений и добавьте новый файл веб-конфигурации с именем `Web.config`.


[![Добавить файл Web.config в папку членства](user-based-authorization-vb/_static/image8.png)](user-based-authorization-vb/_static/image7.png)

**Рис. 3**: добавление `Web.config` файл `Membership` папку ([Просмотр полноразмерное изображение](user-based-authorization-vb/_static/image9.png))


На этом этапе проект должен содержать два `Web.config` файлы: один в корневом каталоге, а другой в `Membership` папки.


[![Приложение теперь должен содержать два файла Web.config](user-based-authorization-vb/_static/image11.png)](user-based-authorization-vb/_static/image10.png)

**Рис. 4**: вашего приложения следует теперь содержит два `Web.config` файлов ([Просмотр полноразмерное изображение](user-based-authorization-vb/_static/image12.png))


Обновить файл конфигурации в `Membership` папку, так что он запрещает доступ для анонимных пользователей.

[!code-xml[Main](user-based-authorization-vb/samples/sample4.xml)]

Это все, чтобы он!

Чтобы проверить это изменение, посетите домашнюю страницу в браузере и убедитесь, что вы вошли. Так как поведение по умолчанию приложения ASP.NET — разрешить всех посетителей и так как мы не вносить изменения авторизации в корневом каталоге `Web.config` файла, мы получаем доступ к посетите файлов в корневом каталоге как анонимный посетителя.

Щелкните ссылку создания учетных записей пользователей в левом столбце. Это требуется для `~/Membership/CreatingUserAccounts.aspx`. Поскольку `Web.config` файла в `Membership` папка определяет правила авторизации, чтобы запретить анонимный доступ, `UrlAuthorizationModule` прерывает запрос и возвращает статус несанкционированного HTTP 401. `FormsAuthenticationModule` Изменяет это 302 состояния перенаправления, отправив нам на страницу входа. Обратите внимание, что страница мы предпринималась попытка получить доступ к (`CreatingUserAccounts.aspx`) передается на страницу входа через `ReturnUrl` параметр строки запроса.


[![Поскольку URL-адрес авторизации правила запретить анонимный доступ мы перенаправляются на страницу входа](user-based-authorization-vb/_static/image14.png)](user-based-authorization-vb/_static/image13.png)

**Рис. 5**: с момента авторизации URL-адрес правила запретить анонимный доступ, мы перенаправляются на страницу входа ([Просмотр полноразмерное изображение](user-based-authorization-vb/_static/image15.png))


После завершения входа в систему, то будут перенаправлены в `CreatingUserAccounts.aspx` страницы. Это время `UrlAuthorizationModule` обеспечивает доступ к странице, так как мы больше не являются анонимными.

### <a name="applying-url-authorization-rules-to-a-specific-location"></a>Применение правил авторизации URL-адрес в определенном местоположении

Параметры авторизации, определенных в `<system.web>` раздел `Web.config` применяются ко всем ресурсам в этом каталоге и его подкаталогах ASP.NET (пока в противном случае переопределено другим `Web.config` файла). В некоторых случаях, можно все ресурсы ASP.NET в данном каталоге иметь конкретной конфигурации авторизации за исключением одного или двух отдельных страниц. Это можно сделать, добавив `<location>` элемент в `Web.config`, выбрав его к файлу отличаются, правила авторизации и определение правилах авторизации уникальный именно здесь.

Для демонстрации использования `<location>` элемент, чтобы переопределить параметры конфигурации для определенного ресурса, настроим параметры авторизации, чтобы получить только Tito `CreatingUserAccounts.aspx`. Для этого добавьте `<location>` элемент `Membership` папки `Web.config` файла и обновить свою разметку, чтобы он выглядел следующим образом:

[!code-xml[Main](user-based-authorization-vb/samples/sample5.xml)]

`<authorization>` Элемент в `<system.web>` определяет правила авторизации URL-адрес по умолчанию для ресурсов ASP.NET в `Membership` папку и ее вложенных папках. `<location>` Элемент позволяет переопределить эти правила к определенному ресурсу. В приведенном выше разметки `<location>` ссылок на элементы `CreatingUserAccounts.aspx` страницы и указывает его авторизации правила, такую как разрешить Tito, но запретить его всем остальным.

Чтобы проверить это изменение авторизации, запустите, посетив веб-сайт как анонимный пользователь. При попытке посетить любой страницы `Membership` папки, такие как `UserBasedAuthorization.aspx`, `UrlAuthorizationModule` будет блокировать запросы и вы будете перенаправлены на страницу входа. После входа в систему как, скажем, Scott, можно посетить любой страницы `Membership` папки *за исключением* для `CreatingUserAccounts.aspx`. Попытка посетите `CreatingUserAccounts.aspx` войти в систему как любой пользователь, но Tito приведет к попытку несанкционированного доступа, перенаправление обратно на страницу входа.

> [!NOTE]
> `<location>` Элемент должен находиться за пределами конфигурации `<system.web>` элемента. Необходимо использовать отдельный `<location>` элемент для каждого ресурса, которого вы хотите переопределить параметры авторизации.


### <a name="a-look-at-how-theurlauthorizationmoduleuses-the-authorization-rules-to-grant-or-deny-access"></a>Рассмотрим как`UrlAuthorizationModule`использует правила авторизации для предоставления или запрета доступа

`UrlAuthorizationModule` Определяет ли авторизовать конкретное удостоверение для конкретного URL-адреса путем анализа авторизации URL-адрес правила по одному, начиная с первого и работа способом его работы. Как только соответствие найдено, пользователю разрешен или запрещен доступ, в зависимости от Если искомый элемент был найден в `<allow>` или `<deny>` элемент. <strong>Если совпадение не найдено, пользователю предоставляется доступ.</strong> Следовательно, если вы хотите ограничить доступ, важно использовать `<deny>` элемент как последний элемент в конфигурации авторизации URL-адрес. <strong>Если не указан</strong><strong>`<deny>`</strong><strong>элемента, все пользователи будут иметь доступ.</strong>

Чтобы лучше понять процесс, используемый `UrlAuthorizationModule` для определения центра, рассмотрим пример правила авторизации URL-адрес, мы рассматривали ранее на этом шаге. Первое правило `<allow>` элемент, который обеспечивает доступ к Tito и Скотт. — Второй правила `<deny>` элемент, который запрещает доступ всем пользователям. Если анонимный пользователь посещает, `UrlAuthorizationModule` начинается с запросом, является анонимным Скотт или Tito? Ответ, очевидно, что равно нет, поэтому он переходит к второе правило. Является анонимным, в набор всех пользователей? Так как ответ вот Да, `<deny>` правило помещается в силе и пользователь перенаправляется на страницу входа. Аналогично, если обход Цзисунь, `UrlAuthorizationModule` начинается с запросом, является Цзисунь Скотт или Tito? Так как она не, `UrlAuthorizationModule` переход на второй вопрос — Цзисунь в набор всех пользователей? Она является, поэтому она, а также, отказано в доступе. Наконец, если посещает Tito, первый вопрос вызванных `UrlAuthorizationModule` будет получен утвердительный ответ, поэтому Tito предоставляется доступ.

Поскольку `UrlAuthorizationModule` процессы правила авторизации в направлении сверху вниз остановки на любые совпадения важно идти перед менее конкретными более конкретные правила. То есть для определения правил авторизации, которые не запрещать Цзисунь и анонимных пользователей, но все остальные пользователи прошедшего проверку подлинности, будет начинаться с наиболее определенное правило - один повлиявшим на Цзисунь - и перейдите к менее определенные правила — те, что все остальные Пользователи, прошедшие проверку подлинности, но Запрет всех анонимных пользователей. Следующие правила авторизации URL-адрес реализует эту политику, сначала запрет Цзисунь, а затем удаляют все анонимного пользователя. Любой прошедший проверку пользователь, кроме Цзисунь будет предоставлен доступ так как ни один из этих `<deny>` сопоставит инструкции.

[!code-xml[Main](user-based-authorization-vb/samples/sample6.xml)]

## <a name="step-2-fixing-the-workflow-for-unauthorized-authenticated-users"></a>Шаг 2: Исправления рабочего процесса для несанкционированного, прошедшего проверку подлинности пользователей

Как уже говорилось ранее в этом учебнике в поле Поиск в раздел рабочего процесса авторизации URL-адрес в любое время процесс неавторизованный запрос, `UrlAuthorizationModule` прерывает запрос и возвращает статус несанкционированного HTTP 401. Изменение этого состояния 401 `FormsAuthenticationModule` в 302 перенаправления состояние, которое отправляет пользователя на страницу входа. Этот рабочий процесс происходит на любой запрос не авторизован, даже если пользователь прошел проверку.

Возвращение прошедшего проверку подлинности пользователя на страницу входа, скорее всего путайте их, так как они уже выполнил вход в систему. С небольшой работы мы можем улучшить этот рабочий процесс, перенаправляя проверку подлинности пользователей, устанавливающих неавторизованных запросов на страницу, объясняющее, что они пытаются получить доступ к страницу с ограниченным доступом.

Начните с создания новую страницу ASP.NET в корневой папке веб-приложения с именем `UnauthorizedAccess.aspx`; не забудьте связать эту страницу с `Site.master` главной страницы. После создания этой страницы, удалить элемент управления содержимым, который ссылается на `LoginContent` ContentPlaceHolder, чтобы по умолчанию содержимое главной страницы будет отображаться. Добавьте сообщение о ситуации, а именно пользователь попытался получить доступ к защищенному ресурсу. После добавления такого сообщения `UnauthorizedAccess.aspx` страницы должна выглядеть следующим образом:

[!code-aspx[Main](user-based-authorization-vb/samples/sample7.aspx)]

Теперь нам нужно изменить рабочий процесс, если неавторизованный запрос выполняется пользователем, прошедшим проверку они отправляются `UnauthorizedAccess.aspx` страницы, а не на страницу входа. Логику, которая перенаправляет неавторизованных запросов на страницу входа находится в закрытый метод `FormsAuthenticationModule` класса, поэтому это поведение нельзя настроить. Здесь мы можем, однако является добавление собственную логику на страницу входа, который перенаправляет пользователя `UnauthorizedAccess.aspx`, при необходимости.

Когда `FormsAuthenticationModule` перенаправляет несанкционированного посетитель страницы входа он добавляет запрошенного несанкционированного URL в строку запроса с именем `ReturnUrl`. Например, если неавторизованный пользователь попытался посетите `OnlyTito.aspx`, `FormsAuthenticationModule` перенаправит их на `Login.aspx?ReturnUrl=OnlyTito.aspx`. Таким образом при достижении страницы входа, прошедшего проверку подлинности пользователя с помощью строки запроса, который включает `ReturnUrl` параметра, а затем мы знать этот не прошедший проверку пользователь просто попыток посетить страницу, она не авторизована для просмотра. В этом случае мы хотим перенаправления ей `UnauthorizedAccess.aspx`.

Чтобы сделать это, добавьте следующий код на страницу входа `Page_Load` обработчик событий:

[!code-vb[Main](user-based-authorization-vb/samples/sample8.vb)]

Приведенный выше код перенаправляет несанкционированного, прошедшие проверку подлинности пользователей для `UnauthorizedAccess.aspx` страницы. Чтобы увидеть эту логику в действии, перейдите на сайт как анонимный посетителя и щелкните ссылку "Создание учетных записей пользователей" в левом столбце. Это требуется для `~/Membership/CreatingUserAccounts.aspx` страницы, которая позволяет получить доступ к Tito на шаге 1 был настроен только. Поскольку анонимные пользователи будут запрещены, `FormsAuthenticationModule` перенаправляет нам на страницу входа.

На этом этапе мы являются анонимными, поэтому `Request.IsAuthenticated` возвращает `False` и мы не перенаправляются `UnauthorizedAccess.aspx`. Вместо этого откроется страница входа в систему. Войдите в качестве пользователя, отличного от Tito, например Bruce. После ввода правильных учетных данных, имя входа страница передает обратно нам `~/Membership/CreatingUserAccounts.aspx`. Тем не менее поскольку эта страница доступна только для Tito, мы несанкционированный для ее просмотра и немедленно возвращается на страницу входа. Однако на этот раз `Request.IsAuthenticated` возвращает `True` (и `ReturnUrl` существует параметр строки запроса), поэтому мы перенаправляются `UnauthorizedAccess.aspx` страницы.


[![Проверка подлинности, неавторизованные пользователи будут перенаправлены UnauthorizedAccess.aspx](user-based-authorization-vb/_static/image17.png)](user-based-authorization-vb/_static/image16.png)

**Рис. 6**: проверка подлинности, неавторизованные пользователи будут перенаправлены `UnauthorizedAccess.aspx` ([Просмотр полноразмерное изображение](user-based-authorization-vb/_static/image18.png))


Этот настраиваемый рабочий процесс Возвращает сокращенное вычисление в цикле, на рисунке 2 показана более удобные и простую взаимодействие с пользователем.

## <a name="step-3-limiting-functionality-based-on-the-currently-logged-in-user"></a>Шаг 3: Ограничение функциональности, основанной на текущего пользователя

Авторизация URL-адреса позволяет легко указать правила авторизации детализацией. Как было показано в шаге 1, с URL-адрес авторизации мы можно четко состояния какие удостоверения разрешены и какие из них запрещен просмотр определенной страницы или всех страниц в папке. В некоторых сценариях тем не менее, мы может потребоваться разрешить всем пользователям на странице, но ограничивает возможности страницы на основе пользователя, посетив его.

Рассмотрим случай на веб-сайт электронной коммерции, который допускает прошедшего проверку подлинности для просмотра своих продуктов. Когда анонимный пользователь посещает страницу продукта, они отображаются только сведения о продукте и не будет дано возможность оставить отзыв. Тем не менее прошедшего проверку подлинности пользователя при посещении этой же странице бы увидеть рецензирования интерфейса. Если еще прошедшего проверку пользователя не было проверено данного продукта, интерфейс позволила бы им для отправки проверки; в противном случае он будет отображать их их просмотр ранее отправленных. Кроме того, чтобы сделать этот сценарий шаг странице продукта может показать дополнительные сведения, предоставляют расширенные функциональные возможности для тех пользователей, которые работают для электронной коммерции компании. Например страница продукта может запасов на складе а включают параметры, чтобы изменить описание при посещении сотрудником и цена продукта.

Можно реализовать такие правила авторизации высокогранулированных декларативно и программно (либо через сочетание двух). В следующем разделе вы узнаете, как реализовать авторизацию высокогранулированных посредством элемента управления LoginView. После этого мы рассмотрим программные методы. Прежде чем можно взглянуть на применение правил авторизации высокогранулированных, тем не менее, мы сначала необходимо создать, функциональные возможности которых зависит от его посещении страницы.

Давайте создадим страницу, которая перечисляет файлы в определенном каталоге, в элементе управления GridView. А также список имя каждого файла, размер и другие сведения, GridView будет включать два столбца элементов управления LinkButton: один под названием представления и удалите раздел. Если щелкнуть представление LinkButton отображается содержимое выбранного файла; Если щелкнуть LinkButton удалить файл будут удалены. Давайте изначально создать эту страницу, таким образом, что его просмотр и удаление функциональность доступна всем пользователям. В с помощью элемента управления LoginView и программным образом ограничивая функциональные возможности разделов, будет показано, как включить или отключить эти функции на основе пользователя, посетив страницу.

> [!NOTE]
> Страницы ASP.NET, которое мы сборки используется элемент управления GridView для отображения списка файлов. С момента этого учебника посвящены форм проверки подлинности, авторизации, учетные записи пользователей и ролей я не хочу тратить много времени, посвященные внутренней работы элемента управления GridView. Этот учебник обеспечивает определенные пошаговые инструкции по настройке этой страницы, он не подробно рассмотрены почему были внесены некоторые варианты или иметь определенных свойств влияет на выводимых данных. Полное тестирование элемента управления GridView, проконсультируйтесь my *[работа с данными в ASP.NET 2.0](../../data-access/index.md)* учебные курсы.


Сначала откройте `UserBasedAuthorization.aspx` файла в `Membership` папки и добавление элемента управления GridView к странице с именем `FilesGrid`. В смарт-теге элемента GridView нажмите кнопку Правка столбцов ссылку, чтобы открыть диалоговое окно поля. Здесь, снимите флажок автоматически создавать поля в левом нижнем углу. Добавьте кнопку выбора, кнопку «Удалить» и стояли две из верхнего левого угла (кнопки Select и Delete можно найти в CommandField типа). Задать кнопка выбора `SelectText` свойства для просмотра и первый BoundField `HeaderText` и `DataField` свойства имени. Установите второй BoundField `HeaderText` свойство размер в байтах, его `DataField` свойство до длины, его `DataFormatString` свойства {0: N0} и его `HtmlEncode` свойству значение False.

После настройки столбцов GridView, нажмите кнопку ОК, чтобы закрыть диалоговое окно «поля». В окне «Свойства» задайте GridView `DataKeyNames` свойства `FullName`. На этом этапе GridView должен выглядеть следующим образом:

[!code-aspx[Main](user-based-authorization-vb/samples/sample9.aspx)]

Разметка GridView, созданная мы готовы написать код, который будет получать файлы в определенном каталоге и привязывать их к GridView. Добавьте следующий код к странице `Page_Load` обработчик событий:

[!code-vb[Main](user-based-authorization-vb/samples/sample10.vb)]

Приведенный выше код использует [ `DirectoryInfo` класса](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) для получения списка файлов в корневой папке приложения. [ `GetFiles()` Метод](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) возвращает все файлы в каталоге как массив [ `FileInfo` объектов](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), который затем привязывается к GridView. `FileInfo` Объект имеет целый ряд свойств, таких как `Name`, `Length`, и `IsReadOnly`, среди прочего. Как видно из его декларативная разметка GridView выведет на экран только `Name` и `Length` свойства.

> [!NOTE]
> `DirectoryInfo` И `FileInfo` классы находятся в [ `System.IO` пространства имен](https://msdn.microsoft.com/library/system.io.aspx). Таким образом, потребуются либо в начале эти имена классов с именами пространства имен или пространства имен, импортированные в файл класса (через `Imports System.IO`).


Занять некоторое время на эту страницу через браузер. Появится список файлов, находящихся в корневом каталоге приложения. Щелкнув любой из представления или удаления элементов управления LinkButton вызовет обратную передачу, но никаких действий не будет возникать, если еще не знаем создать необходимые обработчики событий.


[![GridView список файлов в корневом каталоге веб-приложения](user-based-authorization-vb/_static/image20.png)](user-based-authorization-vb/_static/image19.png)

**Рис. 7**: GridView список файлов в корневом каталоге веб-приложения ([Просмотр полноразмерное изображение](user-based-authorization-vb/_static/image21.png))


Нам нужна возможность отобразить содержимое выбранного файла. Вернитесь в Visual Studio и текстовое поле с именем `FileContents` над элементом управления GridView. Задайте его `TextMode` свойства `MultiLine` и его `Columns` и `Rows` свойства 95% и 10, соответственно.

[!code-aspx[Main](user-based-authorization-vb/samples/sample11.aspx)]

Создайте обработчик событий для элемента GridView [ `SelectedIndexChanged` событие](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) и добавьте следующий код:

[!code-vb[Main](user-based-authorization-vb/samples/sample12.vb)]

Этот код использует GridView `SelectedValue` свойства, чтобы определить полное имя выбранного файла. На внутреннем уровне `DataKeys` Коллекция указывается для получения `SelectedValue`, поэтому крайне важно установить GridView `DataKeyNames` на имя, как описано ранее в этом шаге. [ `File` Класса](https://msdn.microsoft.com/library/system.io.file.aspx) используется для считывания содержимое выбранного файла в строку, которая затем присваивается `FileContents` текстового поля `Text` свойства, поэтому отображается содержимое файла, выбранного на странице.


[![Содержимое выбранного файла отображаются в текстовом поле](user-based-authorization-vb/_static/image23.png)](user-based-authorization-vb/_static/image22.png)

**Рис. 8**: содержимое выбранного файла отображаются в текстовом поле ([Просмотр полноразмерное изображение](user-based-authorization-vb/_static/image24.png))


> [!NOTE]
> Если просмотреть содержимое файла, содержащего разметку HTML, а затем попытаться просмотреть или удалить файл, вы получите `HttpRequestValidationException` ошибки. Это происходит потому, что при обратной передаче содержимого текстового поля отправляются обратно в веб-сервере. По умолчанию ASP.NET вызывает `HttpRequestValidationException` ошибка при обнаружении потенциально опасные обратной передачи содержимого, например HTML-разметка. Чтобы отключить Эта ошибка возникнет, отключить проверку запросов страницы, добавив `ValidateRequest="false"` для `@Page` директивы. Дополнительные сведения о преимуществах проверки запроса в виде, а также какие меры предосторожности необходимо предпринять при отключении, чтение [проверки запроса - предотвращение атак скрипт](https://asp.net/learn/whitepapers/request-validation/).


Наконец, добавьте обработчик событий следующим кодом для GridView [ `RowDeleting` событие](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):

[!code-vb[Main](user-based-authorization-vb/samples/sample13.vb)]

Код просто отображает полное имя файла для удаления в `FileContents` TextBox *без* фактического удаления файла.


[![Нажав кнопку удаления не удаляет файл](user-based-authorization-vb/_static/image26.png)](user-based-authorization-vb/_static/image25.png)

**Рис. 9**: выберите Delete кнопки не фактически удаляет этот файл ([Просмотр полноразмерное изображение](user-based-authorization-vb/_static/image27.png))


На шаге 1 был настроен правила авторизации URL-адрес, чтобы запретить анонимным пользователям просмотр страниц в `Membership` папки. Чтобы лучше демонстрируют высокогранулированных проверки подлинности, давайте разрешить анонимным пользователям посещать `UserBasedAuthorization.aspx` страницы, но с ограниченной функциональностью. Чтобы открыть эту страницу, всем пользователям доступ к которым, добавьте следующий `<location>` элемент `Web.config` файла в `Membership` папке:

[!code-xml[Main](user-based-authorization-vb/samples/sample14.xml)]

После добавления этого `<location>` элемент, протестируйте новые правила авторизации URL-адрес, ведения журнала из узла. Как анонимный пользователь должен быть разрешен посетить `UserBasedAuthorization.aspx` страницы.

В настоящее время можно посетить любого пользователя, прошедшего проверку подлинности или анонимные `UserBasedAuthorization.aspx` страницы и просмотра или удаления файлов. Давайте сделать так, чтобы только прошедшие проверку подлинности пользователи могут просматривать содержимое файла и только Tito можно удалить файл. Такие правила авторизации высокогранулированных могут применяться декларативно, программным путем или путем сочетания этих методов. Позволяет использовать декларативный подход для ограничения, кто может просматривать содержимое файла; Мы будем использовать программный подход для ограничения доступа позволяет удалить файл.

### <a name="using-the-loginview-control"></a>С помощью элемента управления LoginView

Как видно в предыдущих учебных элемента управления LoginView может использоваться для отображения различных интерфейсов для пользователей, прошедших проверку подлинности и анонимный и предлагает простой способ скрывать функциональные возможности, не доступен для анонимных пользователей. Поскольку анонимным пользователям не удается просмотреть или удалить файлы, нам нужно только отобразить `FileContents` текстового поля при просмотре пользователем, прошедшим проверку. Чтобы сделать это, добавьте на страницу элемент управления LoginView, назовите его `LoginViewForFileContentsTextBox`и переместите `FileContents` декларативная разметка текстового поля в элемент управления LoginView `LoggedInTemplate`.

[!code-aspx[Main](user-based-authorization-vb/samples/sample15.aspx)]

Веб-элементы управления в шаблонах LoginView больше не доступны непосредственно из кода класса. Например `FilesGrid` элемента GridView `SelectedIndexChanged` и `RowDeleting` обработчики событий в данный момент ссылаются `FileContents` управления TextBox с кодом, например:

[!code-aspx[Main](user-based-authorization-vb/samples/sample16.aspx)]

Тем не менее этот код является допустимым. Переместив `FileContents` TextBox в `LoggedInTemplate` текстовое поле невозможно открыть напрямую. Вместо этого мы используем `FindControl("controlId")` метод программным путем ссылки на элемент управления. Обновление `FilesGrid` обработчики событий для ссылки на текстовом поле следующим образом:

[!code-vb[Main](user-based-authorization-vb/samples/sample17.vb)]

После перемещения текстового поля для LoginView `LoggedInTemplate` и обновление кода страницы на ссылку, используя текстовое поле `FindControl("controlId")` шаблона, посетите веб-сайт как анонимный пользователь. Как показано на рис. 10, `FileContents` текстовое поле не отображается. Однако по-прежнему отображается представление LinkButton.


[![Элемента управления LoginView только отрисовывает текстовое поле FileContents для проверенных пользователей](user-based-authorization-vb/_static/image29.png)](user-based-authorization-vb/_static/image28.png)

**Рис. 10**: LoginView элемент управления отображает только `FileContents` текстовое поле для прошедших проверку пользователей ([Просмотр полноразмерное изображение](user-based-authorization-vb/_static/image30.png))


Для преобразования GridView поле в TemplateField является одним из способов скрыть кнопку представления для анонимных пользователей. Будет создан шаблон, который содержит декларативная разметка для представления LinkButton. Мы затем добавьте элемент управления LoginView TemplateField и поместите LinkButton в LoginView `LoggedInTemplate`, тем самым скрытие кнопки просмотреть от анонимных пользователей. Для этого щелкните ссылку Правка столбцов GridView смарт-теге, чтобы открыть диалоговое окно «поля». После этого выберите Кнопка выбора из списка в правом нижнем углу и нажмите кнопку Преобразовать это поле в TemplateField ссылку. Это изменит декларативная разметка поля из:

[!code-aspx[Main](user-based-authorization-vb/samples/sample18.aspx)]

 В: 

[!code-aspx[Main](user-based-authorization-vb/samples/sample19.aspx)]

 На этом этапе мы можем добавить LoginView TemplateField. Приведенная ниже разметка отображает LinkButton представления только для прошедших проверку пользователей. 

[!code-aspx[Main](user-based-authorization-vb/samples/sample20.aspx)]

Как показано на рис. 11, конечный результат не содержит, довольно как представление столбцов по-прежнему отображается несмотря на то, что представление элементов управления LinkButton в столбце будут скрыты. Как скрыть столбец целиком GridView (и не только LinkButton) будут рассмотрены в следующем разделе.


[![Элемент управления LoginView скрывает представление элементов управления LinkButton для анонимных пользователей](user-based-authorization-vb/_static/image32.png)](user-based-authorization-vb/_static/image31.png)

**Рис. 11**: элемента управления LoginView скрывает представление элементов управления LinkButton для анонимных пользователей ([Просмотр полноразмерное изображение](user-based-authorization-vb/_static/image33.png))


### <a name="programmatically-limiting-functionality"></a>Ограничивает функции программным способом

В некоторых случаях декларативный методы недостаточно для ограничивает функции на страницу. Например доступность определенных функциональных возможностей страницы может быть зависящее от условий помимо ли пользователь, посетив страницу является анонимным, так и для прошедшего проверку подлинности. В таких случаях различных элементов пользовательского интерфейса можно отобразить или скрыть программным способом.

Чтобы ограничить функциональные возможности программно, необходимо выполнить две задачи:

1. Определить возможность доступа пользователя, посетив страницу к функции, функции и
2. Программно измените пользовательский интерфейс, в зависимости от того, имеет ли пользователь доступ к функциональности, рассматриваемой.

Чтобы продемонстрировать приложения эти две задачи, давайте разрешается только Tito удаление файлов из GridView. Наш первая задача будет, чтобы определить, является ли Tito, посетив страницу. После, определения, нам нужно скрыть (или отобразить) GridView удалить столбец. Столбцов GridView, доступны через его `Columns` свойства; столбец отображается только в том случае, если его `Visible` свойству `True` (по умолчанию).

Добавьте следующий код в `Page_Load` обработчик событий еще до привязки данных к GridView:

[!code-vb[Main](user-based-authorization-vb/samples/sample21.vb)]

Как уже говорилось в [ *Общие сведения для проверки подлинности форм* ](../introduction/an-overview-of-forms-authentication-vb.md) учебнике `User.Identity.Name` возвращает имя удостоверения. Это соответствует имя пользователя, введенное в элементе управления входа в систему. При посещении страницы, второй столбец GridView Tito `Visible` свойству `True`; в противном случае оно равно `False`. Конечным результатом является, когда кто-то отличное от Tito посещает странице другого пользователя, прошедшего проверку подлинности или анонимного пользователя, удалить столбец не отображается (см. рис. 12); Тем не менее, когда Tito посещает страницы, удалить столбец присутствует (см. рис. 13).


[![Удалить столбец является не к просмотру при посещении по кто-то отличное от Tito (например Bruce)](user-based-authorization-vb/_static/image35.png)](user-based-authorization-vb/_static/image34.png)

**Рис. 12**: не к просмотру при посещении по кто-то отличное от Tito (например Bruce) является удаление столбца ([Просмотр полноразмерное изображение](user-based-authorization-vb/_static/image36.png))


[![Удалить столбец, отображаемый для Tito](user-based-authorization-vb/_static/image38.png)](user-based-authorization-vb/_static/image37.png)

**Рис. 13**: удаление столбца, отображаемого для Tito ([Просмотр полноразмерное изображение](user-based-authorization-vb/_static/image39.png))


## <a name="step-4-applying-authorization-rules-to-classes-and-methods"></a>Шаг 4: Применение правил авторизации для классов и методов

На шаге 3 мы анонимным пользователям просматривать содержимое файла не разрешено и запрещено все пользователи, но Tito удаление файлов. Это выполнялось, скрывая элементы интерфейса пользователя для несанкционированного посетителей через декларативные и программные методы. В нашем примере простой правильно скрытие элементов пользовательского интерфейса был простые, но как обстоят дела сложнее, узлы которых может быть много различных способов выполнения той же функциональности? В ограничивает использование этой функции неправомочным пользователям, что произойдет, если забыть скрыть или отключить все элементы интерфейса пользователя?

Использовать, чтобы гарантировать, что определенную часть функциональные возможности не доступны для неавторизованный пользователь имеет для оформления класса или метода с [ `PrincipalPermission` атрибут](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx). Когда среда выполнения .NET используется класс или выполняет одну из его методов, он проверяет убедитесь в наличии разрешений на использование класса или выполнить метод текущего контекста безопасности. `PrincipalPermission` Атрибут предоставляет механизм, по которому можно определить эти правила.

Давайте демонстрируют использование `PrincipalPermission` атрибута в GridView `SelectedIndexChanged` и `RowDeleting` обработчики событий, чтобы запретить выполнение анонимные пользователи и пользователи, не являющиеся Tito, соответственно. Нам нужно всего лишь добавить соответствующий атрибут поверх каждого определения функции:

[!code-vb[Main](user-based-authorization-vb/samples/sample22.vb)]

Атрибут для `SelectedIndexChanged` определяет обработчик событий, которые только прошедшие проверку пользователи могут выполнять процедуру обработчика событий, где и как атрибут в `RowDeleting` выполнение Tito ограничивает обработчика событий.

> [!NOTE]
> Атрибут может применяться для класса, метода, свойства или события. При добавлении атрибута, она должна входить класса, метода, свойства или оператора объявления события. Так как Visual Basic использует разрывы строк в качестве разделителей инструкции, атрибуты либо должны располагаться на одной строке с объявлением или непосредственно над ним символом продолжения строки (символ подчеркивания). В приведенном выше фрагменте кода размещение на одной строке и объявление метода на основе другого атрибута используется символ продолжения строки.


Если каким-либо образом, пользователя, отличного от Tito пытается выполнить `RowDeleting` обработчика событий или без проверки подлинности пользователь пытается выполнить `SelectedIndexChanged` обработчик событий вызывает среды выполнения .NET `SecurityException`.


[![Если контекст безопасности не авторизован для выполнения метода, вызывается исключение SecurityException](user-based-authorization-vb/_static/image41.png)](user-based-authorization-vb/_static/image40.png)

**Рис. 14**: Если контекст безопасности не авторизован для выполнения метода, `SecurityException` выдается ([Просмотр полноразмерное изображение](user-based-authorization-vb/_static/image42.png))


> [!NOTE]
> Чтобы разрешить несколько контекстов безопасности для доступа к классу или методу, оформления класса или метода с `PrincipalPermission` атрибут для каждого контекста безопасности. То есть Tito и Bruce выполнение `RowDeleting` обработчик событий добавить *два* `PrincipalPermission` атрибуты:


[!code-vb[Main](user-based-authorization-vb/samples/sample23.vb)]

Помимо страниц ASP.NET многие приложения также имеют архитектуру, которая включает в себя различных уровнях, например бизнес-логики и уровней доступа к данным. Эти слои обычно реализуется в виде библиотеки классов и предоставляют классы и методы для выполнения бизнес-логики и связанные данные функции. `PrincipalPermission` Атрибут полезен для применения правила авторизации на эти слои.

Дополнительные сведения об использовании `PrincipalPermission` атрибут, чтобы определить правила авторизации для классов и методов, ознакомьтесь с [Скотт Гатри](https://weblogs.asp.net/scottgu/)в записи блога [добавления правила авторизации для бизнеса и слои с помощью `PrincipalPermissionAttributes` ](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).

## <a name="summary"></a>Сводка

В этом учебнике мы рассмотрели способ применения правила авторизации пользователя. Мы начали с рассмотрения ASP. URL-адрес авторизации в .NET framework. На каждый запрос, обработчик ASP.NET `UrlAuthorizationModule` проверяет правила авторизации URL-адреса, определенные в конфигурации приложения, чтобы определить, авторизован ли удостоверение для доступа к запрошенному ресурсу. Иными словами Авторизация URL-адреса позволяет легко указать правила авторизации для конкретной страницы или для всех страниц в конкретном каталоге.

Платформа авторизации URL-адрес применяет правила авторизации на основе страницу по. Авторизации URL-адрес запрашивающего удостоверение авторизован для доступа к конкретному ресурсу или нет. Во многих сценариях, однако, вызывать для нескольких правил авторизации высокогранулированных. Вместо того чтобы определять, кто может обращаться к странице, нам нужно разрешить всем пользователям доступ к странице, но для отображения разных данных или предлагать различные функциональные возможности в зависимости от пользователя, посетив страницу. Авторизацию на уровне страницы обычно включает в себя скрытие элементов пользовательского интерфейса, чтобы предотвратить несанкционированный доступ к запрещенных функциональные возможности. Кроме того можно использовать атрибуты для ограничения доступа к классам и выполнения его методов для определенных пользователей.

Программирование довольны!

### <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, рассматриваемые в этом учебнике см. в следующих ресурсах:

- [Добавление правила авторизации для бизнеса и уровни данных с помощью `PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)
- [Проверки подлинности ASP.NET](https://msdn.microsoft.com/library/wce3kxhd.aspx)
- [Изменения между безопасности служб IIS 7 и IIS 6](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/Changes-between-IIS6-and-IIS7-Security)
- [Настройка отдельных файлов и подкаталогов](https://msdn.microsoft.com/library/6hbkh9s7.aspx)
- [Ограничение функций изменения данных на основе пользователя](../../data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-vb.md)
- [Примеры использования элемента управления LoginView](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/loginview.aspx)
- [Основные сведения об авторизации URL-адресов для IIS7](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization)
- [`UrlAuthorizationModule` Техническая документация](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx)
- [Работа с данными в ASP.NET 2.0](../../data-access/index.md)

### <a name="about-the-author"></a>Об авторе

Скотт Митчелл, автор нескольких ASP/ASP.NET и основатель 4GuysFromRolla.com, работает с веб-технологиями Майкрософт с 1998 года. Скотт — независимый консультант, trainer и записи. Его последняя книга —  *[диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*. Скотт может быть достигнута по [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) или через его блог по [ http://ScottOnWriting.NET ](http://scottonwriting.net/).

### <a name="special-thanks-to"></a>Благодарности

Этот учебник ряд прошел проверку многие полезные рецензентов. Объясняются моих последующих статей для MSDN? Если Да, напишите мне по [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com).

> [!div class="step-by-step"]
> [Назад](validating-user-credentials-against-the-membership-user-store-vb.md)
> [Вперед](storing-additional-user-information-vb.md)
