---
uid: web-forms/overview/older-versions-security/membership/creating-user-accounts-cs
title: Создание учетных записей пользователей (C#) | Документы Microsoft
author: rick-anderson
description: В этом учебнике мы рассмотрим, используя платформу членства (через SqlMembershipProvider) для создания новых учетных записей пользователей. Будет показано, как создать новый нам...
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/18/2008
ms.topic: article
ms.assetid: f175278c-6079-4d91-b9b4-2493ed43d9ec
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/membership/creating-user-accounts-cs
msc.type: authoredcontent
ms.openlocfilehash: e00417639fba71083cbf392db5d5078561ab26e3
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
ms.locfileid: "30892183"
---
<a name="creating-user-accounts-c"></a>Создание учетных записей пользователей (C#)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить код](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_05_CS.zip) или [скачать PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial05_CreatingUsers_cs.pdf)

> В этом учебнике мы рассмотрим, используя платформу членства (через SqlMembershipProvider) для создания новых учетных записей пользователей. Будет показано, как для создания новых пользователей программно и с помощью ASP. В NET встроенного элемента управления CreateUserWizard.


## <a name="introduction"></a>Вступление

В <a id="_msoanchor_1"> </a> [предыдущего учебника](creating-the-membership-schema-in-sql-server-cs.md) мы установлена схема служб приложения в базе данных, в которой добавляются таблицы, представления и хранимые процедуры, необходимые для `SqlMembershipProvider` и `SqlRoleProvider`. Она создана для оставшейся части руководства в этой серии мы потребуется инфраструктуру. В этом учебнике мы рассмотрим, используя платформу членства (через `SqlMembershipProvider`) для создания новых учетных записей пользователей. Будет показано, как для создания новых пользователей программно и с помощью ASP. В NET встроенного элемента управления CreateUserWizard.

Помимо описан процесс создания новых учетных записей пользователей, мы также потребуется обновить Демонстрация веб-сайта, сначала мы создали в *<a id="_msoanchor_2"> </a> [Общие сведения для проверки подлинности форм](../introduction/an-overview-of-forms-authentication-cs.md)* Учебник и затем расширять  *<a id="https://www.asp.net/learn/security/tutorial-03-cs.aspx"> </a> настройки проверки подлинности форм и дополнительные разделы* учебника. Наш Демонстрация веб-приложение имеет страницу входа, который проверяет учетные данные пользователей с жестко имя пользователя и пароль. Кроме того `Global.asax` содержит код, который создает пользовательский `IPrincipal` и `IIdentity` объекты для прошедших проверку пользователей. Корпорация Майкрософт будет обновлять страницу входа для проверки учетных данных пользователей на framework членства и удалить пользовательскую логику principal и identity.

Давайте начнем!

## <a name="the-forms-authentication-and-membership-checklist"></a>Проверка подлинности форм и контрольный список членства

Перед началом работы с платформой членства, давайте ознакомиться важные шаги, которые мы сделали для достижения этой точки. При использовании framework членства с `SqlMembershipProvider` в сценарии проверки подлинности на основе форм, выполните следующие действия для выполнения до реализации функции членства в веб-приложения:

1. **Включите проверку подлинности на основе форм.** Как уже говорилось в  *<a id="_msoanchor_4"> </a> [Общие сведения для проверки подлинности форм](../introduction/an-overview-of-forms-authentication-cs.md)*, изменив включена проверка подлинности форм `Web.config` и параметр `<authentication>` элемента `mode` атрибут `Forms`. С помощью форм включена, каждого входящего запроса проверяется на наличие *подлинности форм*, если он имеется, определяющий запрашивающей стороне.
2. **Добавьте схему служб приложений к соответствующей базе данных.** При использовании `SqlMembershipProvider` необходимо установить схему службы приложения в базе данных. Обычно эта схема добавляется к той же базе данных, которая содержит модель данных приложения. *<a id="_msoanchor_5"> </a> [Создания схемы членства в SQL Server](creating-the-membership-schema-in-sql-server-cs.md)* учебника рассмотрели применение `aspnet_regsql.exe` средство для выполнения этой задачи.
3. **Настройка параметров веб-приложения для ссылки на базу данных из шага 2.** *Создания схемы членства в SQL Server* учебника было показано два способа настройки веб-приложения, чтобы `SqlMembershipProvider` использовать базы данных, выбранной на шаге 2: путем изменения `LocalSqlServer` имя строки подключения; Добавление нового зарегистрированного поставщика в список поставщиков членства и настроив, нового поставщика, чтобы использовать базу данных из шага 2 или.

При построении веб-приложение, которое использует `SqlMembershipProvider` и проверки подлинности на основе форм, необходимо выполнить следующие три шага, прежде чем использовать `Membership` класса или элементы управления ASP.NET Web имени входа. Так как мы уже выполнили следующие действия в предыдущих учебниках, мы готовы приступить к использованию framework членства!

## <a name="step-1-adding-new-aspnet-pages"></a>Шаг 1: Добавление новых страниц ASP.NET

В этом учебнике и далее три мы остановимся подробнее различных функций, связанных с членством и возможности. Нам потребуется несколько страниц ASP.NET для реализации в разделах, проверяются на протяжении этих учебников. Давайте создадим те страницы, а затем файла карты узла `(Web.sitemap)`.

Начните с создания новой папки в проект с именем `Membership`. Добавьте пять новых страниц ASP.NET для `Membership` папки, связывание с каждой страницы `Site.master` главной страницы. Имя страницы:

- `CreatingUserAccounts.aspx`
- `UserBasedAuthorization.aspx`
- `EnhancedCreateUserWizard.aspx`
- `AdditionalUserInfo.aspx`
- `Guestbook.aspx`

На этом этапе проекта в обозревателе решений должен выглядеть примерно на рисунке показано на рис. 1.


[![Пять новых страниц были добавлены в папку членства](creating-user-accounts-cs/_static/image2.png)](creating-user-accounts-cs/_static/image1.png)

**Рис. 1**: пять новых страниц были добавлены к `Membership` папку ([Просмотр полноразмерное изображение](creating-user-accounts-cs/_static/image3.png))


Каждой странице на этом этапе необходимо двух элементов управления содержимым, один для каждого из главной страницы ContentPlaceHolders: `MainContent` и `LoginContent`.

[!code-aspx[Main](creating-user-accounts-cs/samples/sample1.aspx)]

Помните, что `LoginContent` разметки ContentPlaceHolder элемента по умолчанию отображает ссылку на входе и выходе из системы сайта, в зависимости от того, является ли пользователь проверку подлинности. Наличие `Content2` элемента управления содержимым, однако переопределяет разметки главной страницы по умолчанию. Как уже говорилось в *<a id="_msoanchor_6"> </a> [Общие сведения для проверки подлинности форм](../introduction/an-overview-of-forms-authentication-cs.md)* учебнике это полезно на страницах, где мы не хотим отобразить параметры, связанные с именем входа в левом столбце.

Для этих пяти страниц, тем не менее, мы хотим Показать разметки главной страницы по умолчанию для `LoginContent` ContentPlaceHolder. Таким образом, удалить декларативная разметка для `Content2` элемент управления содержимым. После этого, каждый из пяти страницы разметки должен содержать только один элемент управления содержимым.

## <a name="step-2-creating-the-site-map"></a>Шаг 2: Создание карты сайта

Все, кроме самых стандартных веб-сайтов необходимо реализовать некоторые формы навигации пользовательского интерфейса. Пользовательский интерфейс навигации может быть простой список ссылок на различные разделы веб-узла. Кроме того эти ссылки могут быть организованы в меню или представления в виде дерева. Как разработчики страниц навигации пользовательского интерфейса создается только половина истории. Мы также должны некоторые средства для определения логической структуры сайта сопровождения и обновляться. Добавление новых страниц или удалении существующих страниц, нам нужно возможность обновления — карта сайта — единый источник и отражать эти изменения через веб-узла навигации пользовательского интерфейса.

Эти две задачи — Определение карты сайта и реализация навигации пользовательского интерфейса, исходя из карты узла —, легко осуществить благодаря framework карты сайта и навигации веб-элементы управления, добавляются в ASP.NET версии 2.0. Платформа карты сайта позволяет разработчику для карты узла и затем для доступа к нему через программный интерфейс API ( [ `SiteMap` класса](https://msdn.microsoft.com/library/system.web.sitemap.aspx)). Включить встроенные навигации веб-элементы управления [управления меню](https://msdn.microsoft.com/library/bz09dy46.aspx), [TreeView-элемент управления](https://msdn.microsoft.com/library/3eafky27.aspx)и [управления SiteMapPath](https://msdn.microsoft.com/library/3eafky27.aspx).

Как платформы членства и ролей, карта сайта framework строится поверх [модель поставщика](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx). Задание класса поставщика карты веб-узла — для создания структуры в памяти, используемой `SiteMap` класса из хранилища постоянных данных, например в XML-файл или таблицу базы данных. Платформа .NET Framework поставляется с поставщиком карты сайта по умолчанию, который считывает данные карты узла из XML-файла ([`XmlSiteMapProvider`](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx)), и это поставщик, который будет использоваться в этом учебнике. Некоторые альтернативные реализации поставщика карты веб-узла см. в разделе Дополнительные материалы в конце этого учебника.

Поставщик карты сайта по умолчанию ожидает правильный формат XML-файл с именем `Web.sitemap` должно храниться в корневом каталоге. Поскольку мы используем этот поставщик по умолчанию, необходимо добавить такой файл и определить структуре карты сайта в соответствующем формате XML. Чтобы добавить файл, щелкните правой кнопкой мыши имя проекта в обозревателе решений и выберите команду Добавить новый элемент. В диалоговом окне, необязательно для добавления типа карты узла с именем файла `Web.sitemap`.


[![Добавьте в файл с именем Web.sitemap корневой каталог проекта](creating-user-accounts-cs/_static/image5.png)](creating-user-accounts-cs/_static/image4.png)

**На рисунке 2**: добавить файл с именем `Web.sitemap` корневой каталог проекта ([Просмотр полноразмерное изображение](creating-user-accounts-cs/_static/image6.png))


XML-файл карты узла определяет структуру веб-сайта в иерархии. Это иерархическое отношение моделируется в XML-файле через происхождение из `<siteMapNode>` элементов. `Web.sitemap` Должно начинаться с `<siteMap>` родительский узел, имеющий точно один `<siteMapNode>` дочерних. Этом верхнего уровня `<siteMapNode>` элемент представляет корень иерархии и может иметь произвольное число узлов-потомков. Каждый `<siteMapNode>` элемент должен включать `title` атрибутов и может включать `url` и `description` атрибуты среди других; каждой непустой `url` должно быть уникальным.

Введите следующий код XML в `Web.sitemap` файла:

[!code-xml[Main](creating-user-accounts-cs/samples/sample2.xml)]

Выше разметки карты узла определяет иерархию, показанную на рис. 3.


[![Карта сайта представляет иерархическую структуру навигации](creating-user-accounts-cs/_static/image8.png)](creating-user-accounts-cs/_static/image7.png)

**Рис. 3**: карта сайта представляет иерархическую структуру навигации ([Просмотр полноразмерное изображение](creating-user-accounts-cs/_static/image9.png))


## <a name="step-3-updating-the-master-page-to-include-a-navigational-user-interface"></a>Шаг 3: Обновление главной страницы для включения навигации пользовательского интерфейса

ASP.NET включает несколько связанных с навигацией веб-элементов управления по проектированию пользовательского интерфейса. К ним относятся, в меню, TreeView и управления SiteMapPath. Элементы управления TreeView и в меню отображаются структуре карты сайта в меню или дерева, соответственно, SiteMapPath будет отображено навигатором, показывающий просмотренное, а также его предки текущего узла. Данные карты узла могут быть привязаны к другим данным, веб-элементов управления с помощью SiteMapDataSource и может осуществляться программно через `SiteMap` класса.

Поскольку подробное описание того, платформа карты сайта и элементов управления навигацией выходит за рамки этого учебника ряда, а не тратить время создания собственных Навигационный пользовательский интерфейс, давайте вместо воспользоваться, используемая в моей *[ Работа с данными в ASP.NET 2.0](../../data-access/index.md)* учебника ряд, который используется для отображения двух глубиной маркированного списка ссылок навигации управления повторителем, как показано на рис. 4.

### <a name="adding-a-two-level-list-of-links-in-the-left-column"></a>Добавление двух уровней список ссылок в левом столбце

Создание этого интерфейса, добавьте следующую разметку декларативный для `Site.master` главной страницы левого столбца где текст «TODO: меню будет здесь...» в настоящее время находится.

[!code-aspx[Main](creating-user-accounts-cs/samples/sample3.aspx)]

Выше разметка привязывает элемент управления повторителем `menu` к SiteMapDataSource возвращающий иерархии карты узла, определенного в `Web.sitemap`. Так как элемент управления SiteMapDataSource [ `ShowStartingNode` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemapdatasource.showstartingnode.aspx) имеет значение False, он начинается возврат карты сайта иерархии, начиная с потомков узла «Home». Повторителя отображается каждая из этих узлов (в настоящее время только «членство») в `<li>` элемент. Другой, внутреннее повторителя выводится дочерних элементов текущего узла в вложенных неупорядоченный список.

На рисунке 4 показаны выше разметки выводимые данные в структуре карты сайта, созданной на шаге 2. Повторителя выводит разметку соответствующего ванили неупорядоченный список; каскадные правила стилей определенные в `Styles.css` отвечают за красоту-при помощи макета. Более подробное описание того, как работает выше разметки, см. в разделе [главные страницы и переходов](https://asp.net/learn/data-access/tutorial-03-cs.aspx) учебника.


[![Навигационный пользовательский интерфейс является к просмотру с помощью вложенных неупорядоченного списка](creating-user-accounts-cs/_static/image11.png)](creating-user-accounts-cs/_static/image10.png)

**Рис. 4**: Навигационный пользовательский интерфейс — к просмотру с помощью вложенных неупорядоченный список ([Просмотр полноразмерное изображение](creating-user-accounts-cs/_static/image12.png))


### <a name="adding-breadcrumb-navigation"></a>Добавление строки навигации

Наряду со списком ссылок в левом столбце, давайте также имеют вид каждой страницы [навигатора](http://en.wikipedia.org/wiki/Breadcrumb_%28navigation%29). Навигатором является элемент навигации пользовательского интерфейса, который позволяет быстро увидеть пользователей их текущее положение в иерархии сайтов. Элемент управления SiteMapPath использует framework карты сайта, чтобы определить расположение текущей страницы в карте узла, а затем отображает навигации на основе этих сведений.

В частности, добавление `<span>` элемент главной страницы заголовок `<div>` элемент и укажите новый `<span>` элемента `class` атрибут «строки». ( `Styles.css` Класс содержит правила для класса «навигатора».) Добавьте SiteMapPath новый метод `<span>` элемента.

[!code-aspx[Main](creating-user-accounts-cs/samples/sample4.aspx)]

Рис. 5 показан результат выполнения SiteMapPath при посещении `~/Membership/CreatingUserAccounts.aspx`.


[![Навигации выводит текущую страницу и сопоставить его предков узла](creating-user-accounts-cs/_static/image14.png)](creating-user-accounts-cs/_static/image13.png)

**Рис. 5**: навигации отображается текущей страницы и его предков в карте узла ([Просмотр полноразмерное изображение](creating-user-accounts-cs/_static/image15.png))


## <a name="step-4-removing-the-custom-principal-and-identity-logic"></a>Шаг 4: Удаление пользовательского основного и логику удостоверений

В *<a id="_msoanchor_7"> </a> [настройки проверки подлинности форм и дополнительные разделы](../introduction/forms-authentication-configuration-and-advanced-topics-cs.md)* учебника мы узнали, как связать пользовательские объекты principal и identity, прошедшего проверку пользователя. Мы были выполнены путем создания обработчика событий в `Global.asax` для приложения `PostAuthenticateRequest` события, который срабатывает после `FormsAuthenticationModule` прошел проверку подлинности пользователя. В этом обработчике событий мы заменили `GenericPrincipal` и `FormsIdentity` объектов, добавленных с `FormsAuthenticationModule` с `CustomPrincipal` и `CustomIdentity` объектов, созданного в этом учебнике.

Хотя пользовательские объекты principal и identity полезны в некоторых сценариях, в большинстве случаев `GenericPrincipal` и `FormsIdentity` объекты являются достаточно. Следовательно я думаю, что стоит вернуться к поведению по умолчанию. Этого не сделать, удалив или преобразуйте `PostAuthenticateRequest` обработчика событий или удалив `Global.asax` файл полностью.

## <a name="step-5-programmatically-creating-a-new-user"></a>Шаг 5: Программное создание нового пользователя

Для создания новой учетной записи пользователя с помощью framework членства `Membership` класса [ `CreateUser` метод](https://msdn.microsoft.com/library/system.web.security.membership.createuser.aspx). Этот метод имеет входные параметры для имени пользователя, пароль и другие поля, связанные с пользователем. При вызове, он делегирует Создание новой учетной записи пользователя настроенный поставщик членства и затем возвращает [ `MembershipUser` объекта](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx) представляющий только что созданную учетную запись.

`CreateUser` Метод имеет четыре перегрузки, каждое из которых принимает разное число входных параметров:

- [`CreateUser(username, password)`](https://msdn.microsoft.com/library/d8t4h2es.aspx)
- [`CreateUser(username, password, email)`](https://msdn.microsoft.com/library/t8yy6w3h.aspx)
- [`CreateUser(username, password, email, passwordQuestion, passwordAnswer, isApproved, MembershipCreateStatus)`](https://msdn.microsoft.com/library/82xx2e62.aspx)
- [`CreateUser(username, password, email, passwordQuestion, passwordAnswer, isApproved, providerUserKey, MembershipCreateStatus)`](https://msdn.microsoft.com/library/ms152012.aspx)

Эти четыре перегрузки различаются в зависимости от объема собираемых сведений. Первый перегруженный метод, например, требуется только имя пользователя и пароль для новой учетной записи пользователя, в то время как второй также требуется адрес электронной почты пользователя.

Эти перегрузки существует, так как сведения, необходимые для создания новой учетной записи пользователя зависит от параметров конфигурации поставщика членства. В *<a id="_msoanchor_8"> </a> [создания схемы членства в SQL Server](creating-the-membership-schema-in-sql-server-cs.md)* учебника мы рассмотрели, указав параметры конфигурации поставщика членства в `Web.config`. В таблице 2 включен полный список параметров конфигурации.

Один такой членства поставщика параметр конфигурации, который влияет на то, что `CreateUser` перегруженные методы могут быть использованы является `requiresQuestionAndAnswer` параметр. Если `requiresQuestionAndAnswer` задано значение `true` (по умолчанию), а затем при создании новой учетной записи пользователя мы необходимо указать секретный вопрос и ответ на него. Эта информация используется позже, если пользователь должен сбросить или сменить пароль. В частности в это время они показаны на контрольный вопрос, и они должны ввести правильный ответ, чтобы сбросить или сменить пароль. Следовательно Если `requiresQuestionAndAnswer` задано значение `true` и вызов любого из первых двух `CreateUser` перегрузки приводит к исключению из-за отсутствия защитный вопрос и ответ. Так как приложение в настоящее время настроен требовать секретный вопрос и ответ, необходимо использовать последние две перегрузки, при создании пользователя программным способом.

Для демонстрации использования `CreateUser` метод, давайте создадим пользовательский интерфейс, где мы приглашение ввести его имя, пароль, электронной почты и ответ на вопрос предварительно определенных безопасности. Откройте `CreatingUserAccounts.aspx` страницы в `Membership` папку и добавьте следующие веб-элементов управления к элементу управления содержимым:

- Текстовое поле с именем `Username`
- Текстовое поле с именем `Password`, чей `TextMode` свойству `Password`
- Текстовое поле с именем `Email`
- Метка с именем `SecurityQuestion` с его `Text` очищаются свойство
- Текстовое поле с именем `SecurityAnswer`
- Кнопки с именем `CreateAccountButton` текста, свойство которого имеет значение «Создание учетной записи пользователя»
- Элемент управления Label с именем `CreateAccountResults` с его `Text` очищаются свойство

На этом этапе экран должен выглядеть примерно на рисунке показано на рис. 6.


[![Добавить на страницу CreatingUserAccounts.aspx различных веб-элементов управления](creating-user-accounts-cs/_static/image17.png)](creating-user-accounts-cs/_static/image16.png)

**Рис. 6**: Добавление различных веб-элементов управления для `CreatingUserAccounts.aspx` страницы ([Просмотр полноразмерное изображение](creating-user-accounts-cs/_static/image18.png))


`SecurityQuestion` Метки и `SecurityAnswer` TextBox предназначены для отображения предварительно определенных контрольный вопрос и ответ пользователя на сбор. Обратите внимание, что секретный вопрос и ответ хранятся на основе пользователя по, можно разрешить пользователям определять свои собственные контрольный вопрос. Однако в этом примере, решили использовать универсальные контрольный вопрос, а именно: «Какова выбранный цвет?»

Чтобы реализовать это предопределенные контрольный вопрос, добавить константу с именем класса с выделенным кодом страницы `passwordQuestion`, назначив его на секретный вопрос. Затем в `Page_Load` обработчик событий, назначьте этом константа, которая `SecurityQuestion` метки `Text` свойство:

[!code-csharp[Main](creating-user-accounts-cs/samples/sample5.cs)]

Создайте обработчик событий для `CreateAccountButton`в `Click` событий и добавьте следующий код:

[!code-csharp[Main](creating-user-accounts-cs/samples/sample6.cs)]

`Click` Запускает обработчик событий, определив переменную с именем `createStatus` типа [ `MembershipCreateStatus` ](https://msdn.microsoft.com/library/system.web.security.membershipcreatestatus.aspx). `MembershipCreateStatus` представляет собой перечисление, указывающее состояние `CreateUser` операции. Например, если учетная запись пользователя успешно создан, итоговый `MembershipCreateStatus` экземпляр будет присвоено значение `Success`; с другой стороны, если операция завершается неудачей, так как уже существует пользователь с одинаковым именем пользователя, он будет присвоено значение `DuplicateUserName`. В `CreateUser` перегрузку, мы используем, нам нужно передать `MembershipCreateStatus` экземпляра в метод как `out` параметр. Этот параметр имеет значение, соответствующее значение в пределах `CreateUser` метода и мы можно проверить ее значение после вызова метода, чтобы определить, является ли учетная запись пользователя создана успешно.

После вызова метода `CreateUser`, передавая `createStatus`, `switch` оператор используется для вывода соответствующего сообщения в зависимости от значения, назначенные `createStatus`. Цифры 7 показаны выходные данные, когда новый пользователь успешно создан. Цифры 8 и 9 показан вывод, когда учетная запись пользователя не создается. На рисунке 8 посетителя вводить буквы пяти пароля, который не отвечает требованиям стойкость пароля, выраженная в параметры конфигурации поставщика членства. На рис. 9 посетителя предпринимается попытка создать учетную запись пользователя с именем существующего пользователя (созданном на рис. 7).


[![Учетной записи пользователя — успешно создан](creating-user-accounts-cs/_static/image20.png)](creating-user-accounts-cs/_static/image19.png)

**Рис. 7**: новой учетной записи пользователя будет создан ([Просмотр полноразмерное изображение](creating-user-accounts-cs/_static/image21.png))


[![Учетная запись пользователя не создается, поскольку является слишком слабы пароля, предоставляемый](creating-user-accounts-cs/_static/image23.png)](creating-user-accounts-cs/_static/image22.png)

**Рис. 8**: учетная запись пользователя не создается, поскольку является слишком слабы пароля, предоставляемый ([Просмотр полноразмерное изображение](creating-user-accounts-cs/_static/image24.png))


[![Учетная запись пользователя — что не создана потому, что имя пользователя уже используется](creating-user-accounts-cs/_static/image26.png)](creating-user-accounts-cs/_static/image25.png)

**Рис. 9**: учетная запись пользователя является не создана потому, что имя пользователя уже используется ([Просмотр полноразмерное изображение](creating-user-accounts-cs/_static/image27.png))


> [!NOTE]
> Может возникнуть вопрос как определить успех или неудачу при использовании одной из первых двух `CreateUser` перегрузки метода, ни один из которых имеет тип параметра `MembershipCreateStatus`. Эти первые две перегрузки создают [ `MembershipCreateUserException` исключение](https://msdn.microsoft.com/library/system.web.security.membershipcreateuserexception.aspx) в случае сбоя, который включает [ `StatusCode` свойство](https://msdn.microsoft.com/library/system.web.security.membershipcreateuserexception.statuscode.aspx) типа `MembershipCreateStatus`.


После создания нескольких учетных записей пользователей, убедитесь, что учетные записи были созданы путем перечисления содержимого `aspnet_Users` и `aspnet_Membership` таблицы в `SecurityTutorials.mdf` базы данных. Как показано на рис. 10, добавления двух пользователей с помощью `CreatingUserAccounts.aspx` страница: Tito и Bruce.


[![Существует два пользователя в хранилище данных членства пользователя: Tito и Bruce](creating-user-accounts-cs/_static/image29.png)](creating-user-accounts-cs/_static/image28.png)

**Рис. 10**: существуют два пользователя в хранилище данных членства пользователя: Tito и Bruce ([Просмотр полноразмерное изображение](creating-user-accounts-cs/_static/image30.png))


Хотя хранилище членства пользователя теперь включает Bruce и Tito сведения об учетной записи, у нас есть еще для реализации функциональности, который разрешает Bruce или Tito для входа на сайт. В настоящее время `Login.aspx` проверяет учетные данные пользователя с жестко набор пар имя пользователя и пароль — это осуществляется *не* проверить предоставленные учетные данные для framework членства. Для просмотра новых учетных записей пользователей в теперь `aspnet_Users` и `aspnet_Membership` таблицы будет достаточно. В следующем уроке  *<a id="_msoanchor_9"> </a> [проверка пользователя хранилище учетных данных для членства пользователя](validating-user-credentials-against-the-membership-user-store-cs.md)*, корпорация Майкрософт будет обновлять страницу входа для проверки соответствия хранилище членства.

> [!NOTE]
> Если вы не видите все пользователи в вашей `SecurityTutorials.mdf` базы данных, возможно, так как веб-приложение использует поставщика членства по умолчанию `AspNetSqlMembershipProvider`, которая использует `ASPNETDB.mdf` базы данных в качестве хранилища пользователя. Чтобы определить, является ли проблема, нажмите кнопку "Обновить" в обозревателе решений. Если база данных с именем `ASPNETDB.mdf` будет добавлен `App_Data` папку, источник ошибки. Вернуться на шаге 4 *<a id="_msoanchor_10"> </a> [создания схемы членства в SQL Server](creating-the-membership-schema-in-sql-server-cs.md)* учебника инструкции о том, как правильно настроить поставщик членства.


В большинстве создать сценарии учетной записи пользователя, посетитель представлены некоторые интерфейс, введите свое имя пользователя, пароль, электронной почты и другие важные сведения, после чего создается новую учетную запись. На этом шаге мы рассматривали построение такой интерфейс вручную и затем узнали, как использовать `Membership.CreateUser` для программного добавления новой учетной записи пользователя на основании входных данных пользователя. Тем не менее, наш код только что создали учетную запись пользователя. Не удалось выполнить все дальнейшие действия, например входа пользователя на сайт под учетной записью пользователя, только что созданный или отправки подтверждения адреса электронной почты для пользователя. Следующие дополнительные действия, потребуется дополнительный код в кнопки `Click` обработчика событий.

В платформе ASP.NET с элементом управления CreateUserWizard, который предназначен для обработки процесса создания учетной записи пользователя, из подготовки к просмотру пользовательский интерфейс для создания новых учетных записей пользователей, для создания учетной записи на платформе членства и выполнения после учетной записи Создание задачи, например отправки подтверждения адреса электронной почты и вход только что созданного пользователя на сайт. С помощью элемента управления CreateUserWizard простыми, как перетаскивание элемента управления CreateUserWizard из области элементов на страницу, а затем установить несколько свойств. В большинстве случаев не требуется писать ни одной строки кода. Мы рассмотрим этот элемент управления, могло подробно в шаге 6.

Если новые учетные записи пользователей создаются только через стандартные веб-страницу создания учетной записи, маловероятно, что когда-либо придется написать код, использующий `CreateUser` метод, что и элемент управления CreateUserWizard скорее всего соответствует конкретным потребностям. Тем не менее `CreateUser` метод удобно в сценариях настраиваемую взаимодействие с пользователем Создание учетной записи, для которых требуется или при необходимости для программного создания новых учетных записей пользователей через альтернативный интерфейс. Например может потребоваться страницы, позволяющей пользователю загружать в XML-файл, содержащий сведения о пользователях из другим приложением. Страница может анализирует содержимое загруженного XML-файл и создать новую учетную запись для каждого пользователя, представленного в XML, вызвав `CreateUser` метод.

## <a name="step-6-creating-a-new-user-with-the-createuserwizard-control"></a>Шаг 6: Создание нового пользователя с элементом управления CreateUserWizard

ASP.NET поставляется с количеством входа веб-элементов управления. Эти элементы управления позволяют многих распространенных пользователя учетной записи и связанные входа сценариев. [Управления CreateUserWizard](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/createuserwizard.aspx) один такой элемент, предназначенный для создания пользовательского интерфейса для добавления новой учетной записи пользователя в framework членства.

Как и многие другие связанные с именем входа веб-элементы управления CreateUserWizard можно использовать без написания ни единой строки кода. Он интуитивно предоставляет пользовательский интерфейс на основе поставщика членства параметры конфигурации и внутренним образом вызывает `Membership` класса `CreateUser` метод после пользователь вводит необходимую информацию и нажимает кнопку «Создать пользователя». Элемент управления CreateUserWizard очень настраивается. Существует целый ряд событий, возникающих в ходе различные этапы процесса создания учетной записи. Обработчики событий можно создать при необходимости для добавления пользовательской логики в рабочий процесс создания учетной записи. Кроме того внешний вид CreateUserWizard стал более гибким. Существует ряд свойств, определяющих внешний вид интерфейса по умолчанию; При необходимости можно преобразовать в шаблон элемента управления, или могут быть добавлены дополнительные пользовательские регистрации «действия».

Давайте начнем с рассмотрения с использованием интерфейса по умолчанию и поведения элемента управления CreateUserWizard. Затем мы изучим, как настроить внешний вид через свойства и события для элемента управления.

### <a name="examining-the-createuserwizards-default-interface-and-behavior"></a>Изучение CreateUserWizard интерфейс по умолчанию и поведение

Вернитесь к `CreatingUserAccounts.aspx` страницы в `Membership` , переключиться в режим конструктора или разделение, а затем добавьте элемент управления CreateUserWizard в верхней части страницы. Элемент управления CreateUserWizard, под которым хранится раздел элементы управления панели элементов входа. После добавления элемента управления, задать его `ID` свойства `RegisterUser`. Как показано на рис. 11 снимка экрана, CreateUserWizard отображает интерфейс с текстовые поля для нового пользователя имя пользователя, пароль, адрес электронной почты и защитный вопрос и ответ.


[![Элемент управления CreateUserWizard создает универсальный Создание пользовательского интерфейса](creating-user-accounts-cs/_static/image32.png)](creating-user-accounts-cs/_static/image31.png)

**Рис. 11**: элемент управления CreateUserWizard предоставляет универсальный интерфейс создания пользователя ([Просмотр полноразмерное изображение](creating-user-accounts-cs/_static/image33.png))


Давайте немного для сравнения по умолчанию пользовательский интерфейс, созданный с помощью элемента управления CreateUserWizard с помощью интерфейса, созданный на шаге 5. Во-первых управления CreateUserWizard позволяет посетителя для указания секретный вопрос и ответ, тогда как интерфейс нашей созданные вручную используется предварительно определенных контрольный вопрос. Интерфейс управления CreateUserWizard также включает проверяющие элементы управления, а нам пришлось еще реализация проверки на наш интерфейс поля формы. И интерфейс управления CreateUserWizard включает текстовое поле «Подтверждение пароля» (вместе с CompareValidator, чтобы ввести текст «Пароль» и равны текстовые поля «Сравнить пароль»).

Интересные то, что управления CreateUserWizard обращается параметры конфигурации поставщика членства, при подготовке к просмотру его пользовательский интерфейс. Например, текстовые поля вопроса и ответа безопасности отображаются только если `requiresQuestionAndAnswer` имеет значение True. Аналогично, добавляет CreateUserWizard RegularExpressionValidator-элемент управления, чтобы обеспечить соответствие требованиям надежности паролей и задает его `ErrorMessage` и `ValidationExpression` на основе свойств `minRequiredPasswordLength`, `minRequiredNonalphanumericCharacters`и `passwordStrengthRegularExpression` параметры конфигурации.

Управления CreateUserWizard, как и предполагает его имя, является производным от [управления мастера](https://msdn.microsoft.com/library/s2etd1ek.aspx). Мастер элементов управления призваны обеспечить интерфейс для выполнения нескольких шагов задач. Элемент управления мастера может иметь произвольное число `WizardSteps`, каждый из которых является шаблоном, который определяет HTML и веб-элементов управления для этого шага. Мастер управления изначально отображает первый `WizardStep`, вместе с навигации элементы управления, позволяющие пользователю перейти от одного шага к другому или вернуться на предыдущие шаги.

Как показано на рис. 11 декларативная разметка, интерфейс по умолчанию элемента управления CreateUserWizard содержит две `WizardSteps:`

- [`CreateUserWizardStep`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizardstep.aspx) — Отрисовывает интерфейс для сбора сведений для создания новой учетной записи пользователя. Это показано на рис. 11.
- [`CompleteWizardStep`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.completewizardstep.aspx) — Отображает сообщение о том, что учетная запись успешно создана.

Можно изменить внешний вид и поведение CreateUserWizard, путем преобразования одно из этих действий к шаблонам, либо добавив собственные `WizardSteps`. Мы рассмотрим добавление `WizardStep` в интерфейсе регистрации на *хранения Дополнительные сведения о пользователе* учебника.

Давайте посмотрим, управления CreateUserWizard в действии. Посетите `CreatingUserAccounts.aspx` страницу в обозревателе. Начните с ввода в интерфейс CreateUserWizard некоторые недопустимые значения. Попробуйте ввести пароль, который не соответствует требованиям надежности паролей или создание «имя пользователя» текстовое поле пустым. CreateUserWizard отобразит соответствующее сообщение об ошибке. Рис. 12 показан результат, при попытке создать пользователя с недостаточной степени надежный пароль.


[![CreateUserWizard автоматически вставляет проверяющие элементы управления](creating-user-accounts-cs/_static/image35.png)](creating-user-accounts-cs/_static/image34.png)

**Рис. 12**: CreateUserWizard автоматически вставляет проверяющие элементы управления ([Просмотр полноразмерное изображение](creating-user-accounts-cs/_static/image36.png))


Затем введите соответствующие значения в CreateUserWizard и нажмите кнопку «Создать пользователя». При условии, что были введены обязательные поля достаточно стойкость пароля, CreateUserWizard будет создание новой учетной записи пользователя через членство и последующее отображение `CompleteWizardStep`этого интерфейса (см. рис. 13). В фоновом вызывает CreateUserWizard `Membership.CreateUser` метод так же, как мы делали на шаге 5.


[![Учетной записи пользователя был успешно создан](creating-user-accounts-cs/_static/image38.png)](creating-user-accounts-cs/_static/image37.png)

**Рис. 13**: новая учетная запись пользователя имеет успешно созданы ([Просмотр полноразмерное изображение](creating-user-accounts-cs/_static/image39.png))


> [!NOTE]
> Как показано на рис. 13, `CompleteWizardStep`интерфейс включает кнопки продолжения. Однако на этом этапе, щелкнув его просто выполняет обратную передачу, оставляя посетителя на одной странице. В разделе «Настройка внешнего вида и поведения с помощью его свойства CreateUserWizard» будут рассмотрены способом можно иметь нажмите эту кнопку, чтобы отправить посетителя `Default.aspx` (или другую страницу).


После создания учетной записи пользователя, вернитесь в Visual Studio и изучить `aspnet_Users` и `aspnet_Membership` таблицы, как мы делали на рис. 10 для убедитесь, что учетная запись успешно создана.

### <a name="customizing-the-createuserwizards-behavior-and-appearance-through-its-properties"></a>Настройка поведения CreateUserWizard и внешнего вида с помощью его свойства

Можно настраивать различными способами, с помощью свойств CreateUserWizard `WizardSteps`и обработчики событий. В этом разделе мы рассмотрим способы настройки внешнего вида элемента управления с помощью его свойства; Ниже рассматривается расширение поведения элемента управления с помощью обработчиков событий.

Практически все текста, отображаемого в пользовательском интерфейсе управления CreateUserWizard по умолчанию можно настроить с помощью его множество свойств. Например, «Имя пользователя», «Password», «Подтверждение пароля», «Электронная почта», «Секретный вопрос» и «Ответ на контрольный вопрос» метки отображаются слева от текстовых полей можно настраивать путем [ `UserNameLabelText` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.usernamelabeltext.aspx), [ `PasswordLabelText` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.passwordlabeltext.aspx), [ `ConfirmPasswordLabelText` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.confirmpasswordlabeltext.aspx), [ `EmailLabelText` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.emaillabeltext.aspx), [ `QuestionLabelText` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.questionlabeltext.aspx), и [ `AnswerLabelText` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.answerlabeltext.aspx)свойства, соответственно. Аналогичным образом, являются свойства для задания текста для кнопки «Создать пользователя» и «Продолжить» в `CreateUserWizardStep` и `CompleteWizardStep`, а также, как если эти кнопки отображаются как кнопок, элементов управления LinkButton и ImageButtons.

Цвета, границы, шрифты и другие визуальные элементы можно настроить через узел свойств стиля. В самом элементе управления CreateUserWizard имеет свойства стиля общих Web управления — `BackColor`, `BorderStyle`, `CssClass`, `Font`, и т. д. — и существует ряд свойств стиля для определения внешнего вида для определенных частей Интерфейс CreateUserWizard. [ `TextBoxStyle` Свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.textboxstyle.aspx), например, определяет стили для текстовых полей в `CreateUserWizardStep`, во время [ `TitleTextStyle` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.titletextstyle.aspx) определяет стиль заголовка («зарегистрироваться для вновь Учетная запись»).

В дополнение к свойствам внешнего существует ряд свойств, которые влияют на поведение элемента управления CreateUserWizard. [ `DisplayCancelButton` Свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.displaycancelbutton.aspx), если при установке в значение True, отображаются кнопки «Отмена» рядом с кнопкой «Создать пользователя» (значение по умолчанию: False). Если отобразить кнопку "Отмена", необходимо также задать [ `CancelDestinationPageUrl` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx), который указывает страницу пользователя отправляется после нажатия кнопки "Отмена". Как отмечалось в предыдущем разделе «продолжить» в `CompleteWizardStep`элемента интерфейса вызывает обратную передачу, но оставляет посетителя на одной странице. Чтобы отправить посетителя на другую страницу после нажатия кнопки "Продолжить", просто укажите URL-адрес в [ `ContinueDestinationPageUrl` свойства](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx).

Давайте обновление `RegisterUser` управления CreateUserWizard Показать кнопку отмены и передавать посетитель `Default.aspx` при нажатии кнопки "Отмена", или продолжить. Для этого задайте `DisplayCancelButton` в значение True и оба `CancelDestinationPageUrl` и `ContinueDestinationPageUrl` свойств для «~ / Default.aspx». На рисунке 14 показана обновленные CreateUserWizard при просмотре через браузер.


[![CreateUserWizardStep включает кнопку "Отмена"](creating-user-accounts-cs/_static/image41.png)](creating-user-accounts-cs/_static/image40.png)

**Рис. 14**: `CreateUserWizardStep` включает кнопку Отмена ([Просмотр полноразмерное изображение](creating-user-accounts-cs/_static/image42.png))


Когда посетитель входит имя пользователя, пароль, адрес электронной почты и секретный вопрос и ответ и нажимает кнопку «Создать пользователя», учетной записи пользователя создается и посетителя регистрируется под только что созданного пользователя. Предположим, что лицо, посетив страницу создает новую учетную запись для себя, скорее всего это приемлемо. Тем не менее можно позволить администратору добавлять новые учетные записи пользователей. При этом будет создана учетная запись пользователя, но администратор останется вошедший в систему с правами администратора (а не как вновь созданная учетная запись). Это поведение можно изменить через логическое [ `LoginCreatedUser` свойства](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx).

Учетные записи пользователей в членство framework содержат утвержденных флаг; Пользователи, которые не утверждены не удается войти на веб-узел. По умолчанию вновь созданная учетная запись помечается как утверждения, чтобы пользователи могли сразу же Войдите на сайт. Это возможно, однако новые учетные записи пользователей, помеченные как неутвержденных. Предположим, администратор может вручную утвердить новых пользователей для входа в систему. или может возникнуть необходимость в Проверьте правильность адреса электронной почты при регистрации, прежде чем разрешить пользователю вход. Все, что так, возможно, может иметь учетную запись только что созданного пользователя, помечен как неутвержденных, задав управления CreateUserWizard [ `DisableCreatedUser` свойства](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx) значение True (по умолчанию: False).

Другие свойства, связанные с поведением заметки включают `AutoGeneratePassword` и `MailDefinition`. Если [ `AutoGeneratePassword` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.autogeneratepassword.aspx) имеет значение True, `CreateUserWizardStep` не отображает текстовые поля «Пароль» и «Подтверждение пароля»; вместо этого только что созданный пароль создается автоматически с помощью `Membership` класса [ `GeneratePassword` метод](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx). `GeneratePassword` Метод создает пароль указанной длины, используя достаточное количество неалфавитных символов, чтобы удовлетворить требования к надежности паролем.

[ `MailDefinition` Свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx) полезно, если вы хотите отправить сообщение электронной почты на адрес электронной почты, указанный во время создания учетной записи. `MailDefinition` Свойство содержит ряд вложенные свойства для определения сведений о сообщении сконструированный электронной почты. Параметры, как включать эти подсвойства `Subject`, `Priority`, `IsBodyHtml`, `From`, `CC`, и `BodyFileName`. [ `BodyFileName` Свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) указывает на текст или HTML-файл, который содержит текст сообщения электронной почты. Тело поддерживает два предварительно определенных заполнители: `<%UserName%>` и `<%Password%>`. Эти заполнители, если они присутствуют в `BodyFileName` файл, будут заменены на имя только что созданного пользователя и пароль.

> [!NOTE]
> `CreateUserWizard` Элемента управления `MailDefinition` свойство только указывает сведения о сообщении электронной почты, отправляемого при создании новой учетной записи. Не включает все сведения о том, как фактически отправляется сообщение электронной почты (то есть возможность использования каталога сервера или транзита почты SMTP, информацию для проверки подлинности и т. д). Эти низкоуровневые компоненты должны быть определены в `<system.net>` раздела `Web.config`. Дополнительные сведения об этих параметрах конфигурации и отправке сообщения электронной почты в ASP.NET 2.0 в целом см. [часто задаваемые вопросы по SystemNetMail.com](http://www.systemnetmail.com/) и моей статье [отправки электронной почты в ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx).


### <a name="extending-the-createuserwizards-behavior-using-event-handlers"></a>Расширения CreateUserWizard поведения с помощью обработчиков событий

Элемент управления CreateUserWizard вызывает ряд событий во время его рабочего процесса. Например, после посетитель вводит свое имя пользователя, пароль и прочих сведений и нажимает кнопку «Создать пользователя», управления CreateUserWizard вызывает его [ `CreatingUser` событие](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx). Если проблема во время процесса создания [ `CreateUserError` событий](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx) срабатывает; тем не менее, если пользователь успешно создан, то [ `CreatedUser` событие](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx) возникает. Существуют дополнительные события управления CreateUserWizard, возникать, но они три наиболее germane из них.

В некоторых сценариях необходимо задействовать CreateUserWizard рабочего процесса, который можно сделать, создав обработчик событий для соответствующего события. Чтобы проиллюстрировать это, давайте повышения `RegisterUser` управления CreateUserWizard для включения некоторых пользовательской проверки, имя пользователя и пароль. В частности давайте улучшить наш CreateUserWizard, чтобы имена пользователей не может содержать начальные или конечные пробелы и имя пользователя не может находиться в любом месте пароль. Иными словами мы хотим для предотвращения создания имя пользователя, как «Scott» или having комбинация пользователь/пароль «Scott» и «Scott.1234».

Для этого мы создадим обработчик событий для `CreatingUser` событий для выполнения проверок нашей дополнительную проверку. Если введенные данные не является допустимым, нам нужно отменить процесс создания. Также необходимо добавить веб-управления Label на страницу, чтобы отобразить сообщение о том, что имя пользователя или пароль недопустим. Начните с добавления элемента управления Label под параметры управления CreateUserWizard его `ID` свойства `InvalidUserNameOrPasswordMessage` и его `ForeColor` свойства `Red`. Очистить его `Text` и установите его `EnableViewState` и `Visible` свойств значение False.

[!code-aspx[Main](creating-user-accounts-cs/samples/sample7.aspx)]

Создайте обработчик событий для элемента управления CreateUserWizard `CreatingUser` событий. Чтобы создать обработчик событий, выберите элемент управления в конструкторе, а затем перейдите в окно «Свойства». После этого щелкните значок молнии, а затем дважды щелкните соответствующее событие, чтобы создать обработчик события.

Добавьте следующий код в обработчик событий `CreatingUser`.

[!code-csharp[Main](creating-user-accounts-cs/samples/sample8.cs)]

Обратите внимание, что имя пользователя и пароль, введенный в элемент управления CreateUserWizard доступны через его [ `UserName` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx) и [ `Password` свойства](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.password.aspx)соответственно. Мы используем эти свойства в обработчике событий выше для определения ли указанное имя пользователя содержит начальные или конечные пробелы и ли имя пользователя найдена в пароль. Если одно из этих условий выполняется, сообщение об ошибке отображается в `InvalidUserNameOrPasswordMessage` метку и обработчик событий `e.Cancel` свойству `true`. Если `e.Cancel` равно `true`, CreateUserWizard игнорирует его рабочего процесса, эффективно Отмена процесса создания учетной записи пользователя.

Снимок экрана показано на рис. 15 `CreatingUserAccounts.aspx` при вводе имени пользователя с пробелов.


[![Имена пользователей с начальные или конечные пробелы не допускаются.](creating-user-accounts-cs/_static/image44.png)](creating-user-accounts-cs/_static/image43.png)

**Рис. 15**: имена пользователей с начальные или конечные пробелы не допускаются ([Просмотр полноразмерное изображение](creating-user-accounts-cs/_static/image45.png))


> [!NOTE]
> Пример использования элемента управления CreateUserWizard будет рассмотрено `CreatedUser` события в *<a id="_msoanchor_11"> </a> [хранения Дополнительные сведения о пользователе](storing-additional-user-information-cs.md)* учебника.


## <a name="summary"></a>Сводка

`Membership` Класса `CreateUser` метод создает новую учетную запись в структуре членства. Это достигается путем делегирования вызов настроенный поставщик членства. В случае использования `SqlMembershipProvider`, `CreateUser` метод добавляет запись `aspnet_Users` и `aspnet_Membership` таблицы базы данных.

Хотя программно (как мы видели в шаге 5) можно создавать новые учетные записи пользователей, быстрый и удобный подход — использование элемента управления CreateUserWizard. Этот элемент управления предоставляет многоэтапной пользовательский интерфейс для сбора сведений о пользователе и создания нового пользователя в платформе членства. В системе, этот элемент управления использует тот же самый `Membership.CreateUser` как проверяются в шаге 5, но элемент управления создает пользовательский интерфейс, проверяющие элементы управления и отвечает на ошибок при создании учетной записи пользователя, без необходимости написания единой строки кода.

На этом этапе у нас есть функциональные возможности на месте для создания новых учетных записей пользователей. Однако страницы входа по-прежнему проверка этих учетных данных жестко, указанному в учебнике второй нами. В <a id="_msoanchor_12"> </a> [следующее руководство](validating-user-credentials-against-the-membership-user-store-cs.md) Корпорация Майкрософт будет обновлять `Login.aspx` для проверки пользователя предоставленные учетные данные с framework членства.

Программирование довольны!

### <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, рассматриваемые в этом учебнике см. в следующих ресурсах:

- [`CreateUser` Техническая документация](https://msdn.microsoft.com/library/system.web.security.membershipprovider.createuser.aspx)
- [Обзор управления CreateUserWizard](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/createuserwizard.aspx)
- [Создание файла поставщика карты на основе системы сайта](http://aspnet.4guysfromrolla.com/articles/020106-1.aspx)
- [Создание пошаговые пользовательского интерфейса с помощью элемента управления ASP.NET 2.0 мастера](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx)
- [Изучение ASP.NET 2.0, навигации веб-узла](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)
- [Главные страницы и навигации веб-узла](https://asp.net/learn/data-access/tutorial-03-vb.aspx)
- [Поставщик карты узла SQL приходится ждать для](https://msdn.microsoft.com/msdnmag/issues/06/02/WickedCode/default.aspx)

### <a name="about-the-author"></a>Об авторе

Скотт Митчелл, автор нескольких ASP/ASP.NET и основатель 4GuysFromRolla.com, работает с веб-технологиями Майкрософт с 1998 года. Скотт — независимый консультант, trainer и записи. Его последняя книга —  *[диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*. Скотт может быть достигнута по [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) или через его блог по [ http://ScottOnWriting.NET ](http://scottonwriting.net/).

### <a name="special-thanks-to"></a>Особая благодарность

Этот учебник ряд прошел проверку многие полезные рецензентов. Основной рецензент этого учебника было Мерфи Тереза д. Объясняются моих последующих статей для MSDN? Если Да, напишите мне по [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com).

> [!div class="step-by-step"]
> [Назад](creating-the-membership-schema-in-sql-server-cs.md)
> [Вперед](validating-user-credentials-against-the-membership-user-store-cs.md)
