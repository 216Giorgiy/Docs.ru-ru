---
uid: web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-cs
title: Восстановление и изменение паролей (C#) | Документы Microsoft
author: rick-anderson
description: ASP.NET включает в себя два веб-элементы управления для соблюдения восстановление и изменение паролей. Элемент управления PasswordRecovery позволяет восстановить его потеряны pa посетитель...
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/01/2008
ms.topic: article
ms.assetid: 19c4d042-4e34-4b44-9f1d-6bf2253ba366
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-cs
msc.type: authoredcontent
ms.openlocfilehash: 7f8b019631eff4840bf1759f8e2752946abcaf80
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="recovering-and-changing-passwords-c"></a><span data-ttu-id="75d7a-104">Восстановление и изменение паролей (C#)</span><span class="sxs-lookup"><span data-stu-id="75d7a-104">Recovering and Changing Passwords (C#)</span></span>
====================
<span data-ttu-id="75d7a-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="75d7a-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="75d7a-106">[Загрузить код](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.13.zip) или [скачать PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="75d7a-106">[Download Code](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.13.zip) or [Download PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_cs.pdf)</span></span>

> <span data-ttu-id="75d7a-107">ASP.NET включает в себя два веб-элементы управления для соблюдения восстановление и изменение паролей.</span><span class="sxs-lookup"><span data-stu-id="75d7a-107">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="75d7a-108">Элемент управления PasswordRecovery позволяет посетитель для восстановления пароля потеряны.</span><span class="sxs-lookup"><span data-stu-id="75d7a-108">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="75d7a-109">Элемент управления ChangePassword позволяет пользователю изменить свой пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-109">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="75d7a-110">Как и другие связанные с именем входа веб-элементов управления мы видели на протяжении этого учебника ряда PasswordRecovery и ChangePassword элементы управления работают с платформой членство в фоновом режиме для сброса или изменения паролей пользователей.</span><span class="sxs-lookup"><span data-stu-id="75d7a-110">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>


## <a name="introduction"></a><span data-ttu-id="75d7a-111">Вступление</span><span class="sxs-lookup"><span data-stu-id="75d7a-111">Introduction</span></span>

<span data-ttu-id="75d7a-112">Между веб-сайты для моей банка, программа компании, телефона компании, учетные записи электронной почты и настраиваемый веб-порталы I, как большинство пользователей имеют множество различных паролей.</span><span class="sxs-lookup"><span data-stu-id="75d7a-112">Between the websites for my bank, utility company, phone company, email accounts, and personalized web portals, I, like most people, have dozens of different passwords to remember.</span></span> <span data-ttu-id="75d7a-113">С учетными данными так много в запоминании эти дни не люди забудете свой пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-113">With so many credentials to memorize these days, it's not uncommon for people to forget their password.</span></span> <span data-ttu-id="75d7a-114">С учетом этого веб-сайтов, которые содержат учетные записи пользователей должны включать способом для пользователя восстановить свой пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-114">To account for this, websites that offer user accounts need to include a way for a user to recover his password.</span></span> <span data-ttu-id="75d7a-115">Этот процесс обычно включает создание случайного новый пароль и отправка по электронной почте на адрес электронной почты пользователя для файла.</span><span class="sxs-lookup"><span data-stu-id="75d7a-115">This process typically involves generating a new, random password and emailing it to the user's email address on file.</span></span> <span data-ttu-id="75d7a-116">После получения нового пароля большинству пользователей вернуться на сайт и изменить свой пароль от того, случайно запоминающийся ему.</span><span class="sxs-lookup"><span data-stu-id="75d7a-116">After receiving their new password most users return to the site and change their password from the randomly generated one to a more memorable one.</span></span>

<span data-ttu-id="75d7a-117">ASP.NET включает в себя два веб-элементы управления для соблюдения восстановление и изменение паролей.</span><span class="sxs-lookup"><span data-stu-id="75d7a-117">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="75d7a-118">Элемент управления PasswordRecovery позволяет посетитель для восстановления пароля потеряны.</span><span class="sxs-lookup"><span data-stu-id="75d7a-118">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="75d7a-119">Элемент управления ChangePassword позволяет пользователю изменить свой пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-119">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="75d7a-120">Как и другие связанные с именем входа веб-элементов управления мы видели на протяжении этого учебника ряда PasswordRecovery и ChangePassword элементы управления работают с платформой членство в фоновом режиме для сброса или изменения паролей пользователей.</span><span class="sxs-lookup"><span data-stu-id="75d7a-120">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>

<span data-ttu-id="75d7a-121">В этом учебнике мы рассмотрим использование этих двух элементов управления.</span><span class="sxs-lookup"><span data-stu-id="75d7a-121">In this tutorial we will examine using these two controls.</span></span> <span data-ttu-id="75d7a-122">Также будет показано, как программным образом измените и сбросьте пароль пользователя через `MembershipUser` класса `ChangePassword` и `ResetPassword` методы.</span><span class="sxs-lookup"><span data-stu-id="75d7a-122">We will also see how to programmatically change and reset a user's password via the `MembershipUser` class's `ChangePassword` and `ResetPassword` methods.</span></span>

## <a name="step-1-helping-users-recover-lost-passwords"></a><span data-ttu-id="75d7a-123">Шаг 1: Помочь пользователям восстановить потери пароли</span><span class="sxs-lookup"><span data-stu-id="75d7a-123">Step 1: Helping Users Recover Lost Passwords</span></span>

<span data-ttu-id="75d7a-124">Все веб-сайтов, поддерживающих учетные записи пользователей должны предоставлять пользователям возможность какого-либо механизма, при восстановлении забытых паролей.</span><span class="sxs-lookup"><span data-stu-id="75d7a-124">All websites that support user accounts need to provide users with some mechanism for recovering their forgotten passwords.</span></span> <span data-ttu-id="75d7a-125">Хорошо то, что реализация такие функциональные возможности в ASP.NET выполняется очень просто благодаря PasswordRecovery веб-управления.</span><span class="sxs-lookup"><span data-stu-id="75d7a-125">The good news is that implementing such functionality in ASP.NET is a breeze thanks to the PasswordRecovery Web control.</span></span> <span data-ttu-id="75d7a-126">Элемент управления PasswordRecovery предоставляет интерфейс, который запрашивает имя пользователя и при необходимости, ответ на вопрос их безопасности.</span><span class="sxs-lookup"><span data-stu-id="75d7a-126">The PasswordRecovery control renders an interface that prompts the user for their username and, if needed, the answer to their security question.</span></span> <span data-ttu-id="75d7a-127">Он затем отправляется сообщение электронной почты пользователя пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-127">It then emails the user their password.</span></span>

> [!NOTE]
> <span data-ttu-id="75d7a-128">Так как сообщения электронной почты передаются по сети в виде обычного текста участвуют угрозы безопасности при отправке пароля пользователя по электронной почте.</span><span class="sxs-lookup"><span data-stu-id="75d7a-128">Because email messages are transmitted over the wire in plain-text there are security risks involved with sending a user's password via email.</span></span>


<span data-ttu-id="75d7a-129">Элемент управления PasswordRecovery состоит из трех представлений.</span><span class="sxs-lookup"><span data-stu-id="75d7a-129">The PasswordRecovery control consists of three views:</span></span>

- <span data-ttu-id="75d7a-130">**Имя пользователя** -предлагает посетителя свое имя пользователя.</span><span class="sxs-lookup"><span data-stu-id="75d7a-130">**UserName** - prompts the visitor for their username.</span></span> <span data-ttu-id="75d7a-131">Это начальное представление.</span><span class="sxs-lookup"><span data-stu-id="75d7a-131">This is the initial view.</span></span>
- <span data-ttu-id="75d7a-132">**Вопрос**-отображает вопрос пользователя имя пользователя и безопасности в виде текста, и текстовое поле для пользователя, введите ответ на свой вопрос безопасности.</span><span class="sxs-lookup"><span data-stu-id="75d7a-132">**Question**- displays the user's username and security question as text, along with a TextBox for the user to enter the answer to his security question.</span></span>
- <span data-ttu-id="75d7a-133">**Успех**-отображает сообщение, сообщая пользователю, что отправлена свой пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-133">**Success**- displays a message informing the user that his password has been emailed.</span></span>

<span data-ttu-id="75d7a-134">Отображаются представления и действия, выполняемые с помощью элемента управления PasswordRecovery зависят следующие параметры конфигурации членства:</span><span class="sxs-lookup"><span data-stu-id="75d7a-134">The views displayed and actions performed by the PasswordRecovery control depend upon the following Membership configuration settings:</span></span>

- `RequiresQuestionAndAnswer`
- `EnablePasswordRetrieval`
- `EnablePasswordReset`

<span data-ttu-id="75d7a-135">Платформа членства `RequiresQuestionAndAnswer` указывает, является ли пользователи должны указать секретный вопрос и ответ, при регистрации учетной записи.</span><span class="sxs-lookup"><span data-stu-id="75d7a-135">The Membership framework's `RequiresQuestionAndAnswer` setting indicates whether users must specify a security question and answer when registering for an account.</span></span> <span data-ttu-id="75d7a-136">Как уже говорилось в <a id="_msoanchor_1"> </a> [ *Создание учетных записей пользователей* ](../membership/creating-user-accounts-cs.md) учебника, если `RequiresQuestionAndAnswer` имеет значение True (по умолчанию), то интерфейс CreateUserWizard включает текстовое поле элементы управления для нового пользователя защитный вопрос и ответ; Если `RequiresQuestionAndAnswer` имеет значение False, собранные сведения отсутствуют.</span><span class="sxs-lookup"><span data-stu-id="75d7a-136">As we discussed in the <a id="_msoanchor_1"></a>[*Creating User Accounts*](../membership/creating-user-accounts-cs.md) tutorial, if `RequiresQuestionAndAnswer` is True (the default) then the CreateUserWizard's interface includes TextBox controls for the new user's security question and answer; if `RequiresQuestionAndAnswer` is False, no such information is collected.</span></span> <span data-ttu-id="75d7a-137">Аналогично Если `RequiresQuestionAndAnswer` имеет значение True, то элемент управления отображает PasswordRecovery, просмотреть вопрос после пользователь ввел свое имя пользователя, пароль будет восстановлена только в том случае, если пользователь введет правильный защитный ответ.</span><span class="sxs-lookup"><span data-stu-id="75d7a-137">Similarly, if `RequiresQuestionAndAnswer` is True, then the PasswordRecovery control displays the Question view after the user has entered their username; the password is recovered only if the user enters the correct security answer.</span></span> <span data-ttu-id="75d7a-138">Если `RequiresQuestionAndAnswer` имеет значение False, однако управления PasswordRecovery перемещает непосредственно из представления имени пользователя для представления успешного выполнения.</span><span class="sxs-lookup"><span data-stu-id="75d7a-138">If `RequiresQuestionAndAnswer` is False, however, the PasswordRecovery control moves straight from the UserName view to the Success view.</span></span>

<span data-ttu-id="75d7a-139">После пользователь предоставил свое имя - или его имя пользователя и безопасность ответов, если `RequiresQuestionAndAnswer` имеет значение True - PasswordRecovery отправляется сообщение электронной почты пользователя свой пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-139">After the user has provided his username - or his username and security answer, if `RequiresQuestionAndAnswer` is True - the PasswordRecovery emails the user his password.</span></span> <span data-ttu-id="75d7a-140">Если `EnablePasswordRetrieval` параметр имеет значение True, то пользователю по электронной почте их текущий пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-140">If the `EnablePasswordRetrieval` option is set to True, then the user is emailed their current password.</span></span> <span data-ttu-id="75d7a-141">Если задано значение False и `EnablePasswordReset` имеет значение True, то управления PasswordRecovery приводит к возникновению случайных новый пароль для пользователя и отправляется сообщение электронной почты в этот новый пароль для их.</span><span class="sxs-lookup"><span data-stu-id="75d7a-141">If it is set to False and `EnablePasswordReset` is set to True, then the PasswordRecovery control generates a new, random password for the user, and emails this new password to them.</span></span> <span data-ttu-id="75d7a-142">Если оба `EnablePasswordRetrieval` и `EnablePasswordReset` имеют значение False, элемент управления PasswordRecovery выбрасывает исключение.</span><span class="sxs-lookup"><span data-stu-id="75d7a-142">If both `EnablePasswordRetrieval` and `EnablePasswordReset` are False, the PasswordRecovery control throws an exception.</span></span>

> [!NOTE]
> <span data-ttu-id="75d7a-143">Помните, что `SqlMembershipProvider` хранит пароли пользователей в одном из трех форматов: Clear, Hashed (по умолчанию) или шифрование.</span><span class="sxs-lookup"><span data-stu-id="75d7a-143">Recall that the `SqlMembershipProvider` stores users' passwords in one of three formats: Clear, Hashed (the default), or Encrypted.</span></span> <span data-ttu-id="75d7a-144">Использовать механизм хранения зависит от параметров конфигурации членства; демонстрационное приложение в формате хэшированный пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-144">The storage mechanism used depends on the Membership configuration settings; the demo application uses the Hashed password format.</span></span> <span data-ttu-id="75d7a-145">При использовании формата хэшированный пароль `EnablePasswordRetrieval` параметр необходимо задать значение False, так как система не может определить фактический пароль из хэшированное версии, хранящейся в базе данных.</span><span class="sxs-lookup"><span data-stu-id="75d7a-145">When using the Hashed password format the `EnablePasswordRetrieval` option must be set to False because the system cannot determine the user's actual password from the hashed version stored in the database.</span></span>


<span data-ttu-id="75d7a-146">Рис. 1 показано, как интерфейс и поведение PasswordRecovery зависит от конфигурации членства.</span><span class="sxs-lookup"><span data-stu-id="75d7a-146">Figure 1 illustrates how the PasswordRecovery's interface and behavior is influenced by the Membership configuration.</span></span>


<span data-ttu-id="75d7a-147">[![RequiresQuestionAndAnswer, EnablePasswordRetrieval и EnablePasswordReset влияют на внешний вид и поведение элемента управления PasswordRecovery](recovering-and-changing-passwords-cs/_static/image2.png)](recovering-and-changing-passwords-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="75d7a-147">[![The RequiresQuestionAndAnswer, EnablePasswordRetrieval, and EnablePasswordReset Influence the PasswordRecovery control's Appearance and Behavior](recovering-and-changing-passwords-cs/_static/image2.png)](recovering-and-changing-passwords-cs/_static/image1.png)</span></span>

<span data-ttu-id="75d7a-148">**Рис. 1**: `RequiresQuestionAndAnswer`, `EnablePasswordRetrieval`, и `EnablePasswordReset` влияют на внешний вид и поведение элемента управления PasswordRecovery ([Просмотр полноразмерное изображение](recovering-and-changing-passwords-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="75d7a-148">**Figure 1**: The `RequiresQuestionAndAnswer`, `EnablePasswordRetrieval`, and `EnablePasswordReset` Influence the PasswordRecovery control's Appearance and Behavior  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image3.png))</span></span>


> [!NOTE]
> <span data-ttu-id="75d7a-149">В <a id="_msoanchor_2"> </a> [ *создания схемы членства в SQL Server* ](../membership/creating-the-membership-schema-in-sql-server-cs.md) учебник был настроен поставщик членства, задав `RequiresQuestionAndAnswer` значение True, `EnablePasswordRetrieval` для Значение равно false, и `EnablePasswordReset` значение True.</span><span class="sxs-lookup"><span data-stu-id="75d7a-149">In the <a id="_msoanchor_2"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-cs.md) tutorial we configured the Membership provider by setting `RequiresQuestionAndAnswer` to True, `EnablePasswordRetrieval` to False, and `EnablePasswordReset` to True.</span></span>


### <a name="using-the-passwordrecovery-control"></a><span data-ttu-id="75d7a-150">С помощью элемента управления PasswordRecovery</span><span class="sxs-lookup"><span data-stu-id="75d7a-150">Using the PasswordRecovery Control</span></span>

<span data-ttu-id="75d7a-151">Давайте взглянем на использование PasswordRecovery элемента управления на странице ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="75d7a-151">Let's look at using the PasswordRecovery control in an ASP.NET page.</span></span> <span data-ttu-id="75d7a-152">Откройте `RecoverPassword.aspx` и перетащите и удалить из области элементов в конструктор элемента управления PasswordRecovery; установить его `ID` для `RecoverPwd`.</span><span class="sxs-lookup"><span data-stu-id="75d7a-152">Open `RecoverPassword.aspx` and drag and drop a PasswordRecovery control from the Toolbox onto the Designer; set its `ID` to `RecoverPwd`.</span></span> <span data-ttu-id="75d7a-153">Как и элементы управления входа и веб-CreateUserWizard PasswordRecovery элемента управления представления отображают многофункциональных составных интерфейс, который содержит метки, текстовые поля, кнопки и проверяющие элементы управления.</span><span class="sxs-lookup"><span data-stu-id="75d7a-153">Like the Login and CreateUserWizard Web controls, the PasswordRecovery control's views render a rich composite interface that includes Labels, TextBoxes, Buttons, and validation controls.</span></span> <span data-ttu-id="75d7a-154">Можно настроить внешний вид представления через свойства стиля элемента управления или путем преобразования в шаблонов представлений.</span><span class="sxs-lookup"><span data-stu-id="75d7a-154">You can customize the appearance of the views through the control's style properties or by converting the views into templates.</span></span> <span data-ttu-id="75d7a-155">Я это поле оставить в качестве упражнения для интересующихся.</span><span class="sxs-lookup"><span data-stu-id="75d7a-155">I leave this as an exercise for the interested reader.</span></span>

<span data-ttu-id="75d7a-156">При посещении этой страницы она введите ее имя пользователя и нажмите кнопку "Отправить".</span><span class="sxs-lookup"><span data-stu-id="75d7a-156">When a user visits this page she will enter her username and click the Submit button.</span></span> <span data-ttu-id="75d7a-157">Так как мы задали `RequiresQuestionAndAnswer` в значение True, если в параметрах конфигурации нашей членства PasswordRecovery будет управлять, а затем отображать представления вопроса.</span><span class="sxs-lookup"><span data-stu-id="75d7a-157">Because we have set the `RequiresQuestionAndAnswer` property to True in our Membership configuration settings, the PasswordRecovery control will then display the Question view.</span></span> <span data-ttu-id="75d7a-158">После пользователь вводит свой правильный ответ на контрольный вопрос и нажимает кнопку Submit, управления PasswordRecovery обновить пароль пользователя с предложением формируется случайным образом и адрес электронной почты на адрес электронной почты в файле этот пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-158">After the user enters her correct security answer and clicks Submit, the PasswordRecovery control will update the user's password to a randomly-generated one, and email this password to the email address on file.</span></span> <span data-ttu-id="75d7a-159">Все это можно было без нам писать одна строка кода!</span><span class="sxs-lookup"><span data-stu-id="75d7a-159">All of this was possible without us having to write a single line of code!</span></span>

<span data-ttu-id="75d7a-160">Перед запуском этой странице имеется Заключительная часть конфигурации, как правило: необходимо указать параметры доставки почты в `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="75d7a-160">Before you test this page, there's one final piece of configuration to tend to: we need to specify the mail delivery settings in `Web.config`.</span></span> <span data-ttu-id="75d7a-161">Управления PasswordRecovery использует эти параметры для отправки сообщения электронной почты.</span><span class="sxs-lookup"><span data-stu-id="75d7a-161">The PasswordRecovery control relies on these settings for sending the email.</span></span>

<span data-ttu-id="75d7a-162">Конфигурация доставки почты определяется через [ `<system.net>` элемент](https://msdn.microsoft.com/library/6484zdc1.aspx) [ `<mailSettings>` элемент](https://msdn.microsoft.com/library/w355a94k.aspx).</span><span class="sxs-lookup"><span data-stu-id="75d7a-162">The mail delivery configuration is specified through the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx)'s [`<mailSettings>` element](https://msdn.microsoft.com/library/w355a94k.aspx).</span></span> <span data-ttu-id="75d7a-163">Используйте [ `<smtp>` элемент](https://msdn.microsoft.com/library/ms164240.aspx) для указания метода доставки и адрес отправителя по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="75d7a-163">Use the [`<smtp>` element](https://msdn.microsoft.com/library/ms164240.aspx) to indicate the delivery method and the default From address.</span></span> <span data-ttu-id="75d7a-164">Приведенный ниже код настраивает параметры почты для использования сетевой SMTP сервера с именем `smtp.example.com` через порт 25 и имя пользователя и пароль учетных данных имени пользователя и пароля.</span><span class="sxs-lookup"><span data-stu-id="75d7a-164">The following markup configures mail settings to use a network SMTP server named `smtp.example.com` on port 25 and with username/password credentials of username and password.</span></span>

> [!NOTE]
> <span data-ttu-id="75d7a-165">`<system.net>` является дочерним элементом корневого `<configuration>` элемент и одноуровневым `<system.web>`.</span><span class="sxs-lookup"><span data-stu-id="75d7a-165">`<system.net>` is a child element of the root `<configuration>` element and a sibling of `<system.web>`.</span></span> <span data-ttu-id="75d7a-166">Таким образом, не следует помещать `<system.net>` элемент в пределах `<system.web>` элемента; вместо этого поместите его на том же уровне.</span><span class="sxs-lookup"><span data-stu-id="75d7a-166">Therefore, do not put the `<system.net>` element within the `<system.web>` element; instead, put it at the same level.</span></span>


[!code-xml[Main](recovering-and-changing-passwords-cs/samples/sample1.xml)]

<span data-ttu-id="75d7a-167">Помимо использования SMTP-сервер в сети, можно также указать каталог подбора сообщений, где следует внесен отправку сообщений электронной почты.</span><span class="sxs-lookup"><span data-stu-id="75d7a-167">In addition to using an SMTP server on the network, you can alternatively specify a pickup directory where email messages to be sent should be deposited.</span></span>

<span data-ttu-id="75d7a-168">После настройки параметров SMTP посетите `RecoverPassword.aspx` страницу в обозревателе.</span><span class="sxs-lookup"><span data-stu-id="75d7a-168">Once you have configured the SMTP settings, visit the `RecoverPassword.aspx` page through a browser.</span></span> <span data-ttu-id="75d7a-169">Сначала попробуйте ввести имя пользователя, который не существует в хранилище пользователя.</span><span class="sxs-lookup"><span data-stu-id="75d7a-169">First try entering a username that doesn't exist in the user store.</span></span> <span data-ttu-id="75d7a-170">Как показано на рисунке 2, элемент управления PasswordRecovery отображает сообщение о том, что сведения о пользователе будет недоступен.</span><span class="sxs-lookup"><span data-stu-id="75d7a-170">As Figure 2 shows, the PasswordRecovery control displays a message indicating that the user information could not be accessed.</span></span> <span data-ttu-id="75d7a-171">Текст сообщения можно настроить с помощью элемента управления [ `UserNameFailureText` свойства](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx).</span><span class="sxs-lookup"><span data-stu-id="75d7a-171">The text of the message can be customized through the control's [`UserNameFailureText` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx).</span></span>


<span data-ttu-id="75d7a-172">[![Сообщение об ошибке отображается, если введено неправильное имя пользователя](recovering-and-changing-passwords-cs/_static/image5.png)](recovering-and-changing-passwords-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="75d7a-172">[![An Error Message is Displayed if an Invalid Username is Entered](recovering-and-changing-passwords-cs/_static/image5.png)](recovering-and-changing-passwords-cs/_static/image4.png)</span></span>

<span data-ttu-id="75d7a-173">**На рисунке 2**: сообщение об ошибке отображается, если введено неправильное имя пользователя ([Просмотр полноразмерное изображение](recovering-and-changing-passwords-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="75d7a-173">**Figure 2**: An Error Message is Displayed if an Invalid Username is Entered  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image6.png))</span></span>


<span data-ttu-id="75d7a-174">Теперь можно ввести имя пользователя.</span><span class="sxs-lookup"><span data-stu-id="75d7a-174">Now enter a username.</span></span> <span data-ttu-id="75d7a-175">Используйте имя пользователя учетной записи в системе с адресом электронной почты, можно открыть и которого безопасности ответить вам известно.</span><span class="sxs-lookup"><span data-stu-id="75d7a-175">Use the username of an account in the system with an email address that you can access and whose security answer you know.</span></span> <span data-ttu-id="75d7a-176">После ввода имени пользователя и нажмите кнопку Отправить, элемент управления PasswordRecovery отображает его представления вопроса.</span><span class="sxs-lookup"><span data-stu-id="75d7a-176">After entering the username and clicking Submit, the PasswordRecovery control displays its Question view.</span></span> <span data-ttu-id="75d7a-177">Как с представления имени пользователя при вводе неправильного ответа на PasswordRecovery отображает элемент управления, сообщения об ошибке (см. рис. 3).</span><span class="sxs-lookup"><span data-stu-id="75d7a-177">As with the UserName view, if you enter an incorrect answer the PasswordRecovery control displays an error message (see Figure 3).</span></span> <span data-ttu-id="75d7a-178">Используйте [ `QuestionFailureText` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx) для настройки это сообщение об ошибке.</span><span class="sxs-lookup"><span data-stu-id="75d7a-178">Use the [`QuestionFailureText` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx) to customize this error message.</span></span>


<span data-ttu-id="75d7a-179">[![Сообщение об ошибке отображается, если пользователь ввел недопустимый ответ на контрольный вопрос](recovering-and-changing-passwords-cs/_static/image8.png)](recovering-and-changing-passwords-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="75d7a-179">[![An Error Message is Displayed if the User Enters an Invalid Security Answer](recovering-and-changing-passwords-cs/_static/image8.png)](recovering-and-changing-passwords-cs/_static/image7.png)</span></span>

<span data-ttu-id="75d7a-180">**Рис. 3**: сообщение об ошибке отображается, если пользователь ввел недопустимый ответ на контрольный вопрос ([Просмотр полноразмерное изображение](recovering-and-changing-passwords-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="75d7a-180">**Figure 3**: An Error Message is Displayed if the User Enters an Invalid Security Answer  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image9.png))</span></span>


<span data-ttu-id="75d7a-181">Наконец введите правильный защитный ответ и нажмите кнопку Отправить.</span><span class="sxs-lookup"><span data-stu-id="75d7a-181">Finally, enter the correct security answer and click Submit.</span></span> <span data-ttu-id="75d7a-182">В фоновом управления PasswordRecovery создает случайный пароль, присваивает его учетной записи пользователя, отправляет сообщение электронной почты, информирующее пользователя нового пароля (см. рис. 4), а затем отображает представления успешного выполнения.</span><span class="sxs-lookup"><span data-stu-id="75d7a-182">Behind the scenes, the PasswordRecovery control generates a random password, assigns it to the user account, sends an email informing the user of their new password (see Figure 4), and then displays the Success view.</span></span>


<span data-ttu-id="75d7a-183">[![Пользователю отправляется сообщение электронной почты с His новый пароль](recovering-and-changing-passwords-cs/_static/image11.png)](recovering-and-changing-passwords-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="75d7a-183">[![The User is Sent an Email with His New Password](recovering-and-changing-passwords-cs/_static/image11.png)](recovering-and-changing-passwords-cs/_static/image10.png)</span></span>

<span data-ttu-id="75d7a-184">**Рис. 4**: пользователю отправляется сообщение электронной почты с His нового пароля ([Просмотр полноразмерное изображение](recovering-and-changing-passwords-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="75d7a-184">**Figure 4**: The User is Sent an Email with His New Password  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image12.png))</span></span>


### <a name="customizing-the-email"></a><span data-ttu-id="75d7a-185">Настройка электронной почты</span><span class="sxs-lookup"><span data-stu-id="75d7a-185">Customizing the Email</span></span>

<span data-ttu-id="75d7a-186">По умолчанию сообщений электронной почты, отправляемых с помощью элемента управления PasswordRecovery является довольно скромным (см. рис. 4).</span><span class="sxs-lookup"><span data-stu-id="75d7a-186">The default email sent by the PasswordRecovery control is rather dull (see Figure 4).</span></span> <span data-ttu-id="75d7a-187">Сообщение отправляется из учетной записи, указанной в `<smtp>` элемента `from` атрибута с темой пароль и тело обычного текста:</span><span class="sxs-lookup"><span data-stu-id="75d7a-187">The message is sent from the account specified in the `<smtp>` element's `from` attribute with the subject Password and the plain-text body:</span></span>

<span data-ttu-id="75d7a-188">Вернитесь на сайт и войдите, используя следующие сведения.</span><span class="sxs-lookup"><span data-stu-id="75d7a-188">Please return to the site and log in using the following information.</span></span>

<span data-ttu-id="75d7a-189">Имя пользователя: *имя пользователя*</span><span class="sxs-lookup"><span data-stu-id="75d7a-189">User Name: *username*</span></span>

<span data-ttu-id="75d7a-190">Пароль: *пароль*</span><span class="sxs-lookup"><span data-stu-id="75d7a-190">Password: *password*</span></span>

<span data-ttu-id="75d7a-191">Это сообщение можно настроить программно через обработчик событий для элемента управления PasswordRecovery [ `SendingMail` событий](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx), или декларативно с помощью [ `MailDefinition` свойства](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx).</span><span class="sxs-lookup"><span data-stu-id="75d7a-191">This message can be customized programmatically through an event handler for the PasswordRecovery control's [`SendingMail` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx), or declaratively through the [`MailDefinition` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx).</span></span> <span data-ttu-id="75d7a-192">Давайте рассмотрим оба варианта.</span><span class="sxs-lookup"><span data-stu-id="75d7a-192">Let's explore both of these options.</span></span>

<span data-ttu-id="75d7a-193">`SendingMail` Событие непосредственно перед сообщение электронной почты отправляется и наши последняя возможность программное изменение сообщения электронной почты.</span><span class="sxs-lookup"><span data-stu-id="75d7a-193">The `SendingMail` event is fired right before the email message is sent and is our last chance to programmatically adjust the email message.</span></span> <span data-ttu-id="75d7a-194">Когда происходит событие, обработчик событий передается объект типа [ `MailMessageEventArgs` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.mailmessageeventargs.aspx), чей `Message` свойство содержит ссылку на адреса электронной почты, который будет отправлен.</span><span class="sxs-lookup"><span data-stu-id="75d7a-194">When this event is raised, the event handler is passed an object of type [`MailMessageEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.mailmessageeventargs.aspx), whose `Message` property contains a reference to the email about to be sent.</span></span>

<span data-ttu-id="75d7a-195">Создайте обработчик событий для `SendingMail` событий и добавьте следующий код, который программными средствами добавляет `webmaster@example.com` в список "Копия".</span><span class="sxs-lookup"><span data-stu-id="75d7a-195">Create an event handler for the `SendingMail` event and add the following code, which programmatically adds `webmaster@example.com` to the CC list.</span></span>

[!code-csharp[Main](recovering-and-changing-passwords-cs/samples/sample2.cs)]

<span data-ttu-id="75d7a-196">Сообщения электронной почты также можно настроить через декларативным образом.</span><span class="sxs-lookup"><span data-stu-id="75d7a-196">The email message can also be configured through declarative means.</span></span> <span data-ttu-id="75d7a-197">PasswordRecovery `MailDefinition` является объектом типа [ `MailDefinition` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.aspx).</span><span class="sxs-lookup"><span data-stu-id="75d7a-197">The PasswordRecovery's `MailDefinition` property is an object of type [`MailDefinition`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.aspx).</span></span> <span data-ttu-id="75d7a-198">`MailDefinition` Класс предлагает целый ряд свойств, связанных с электронной почтой, включая `From`, `CC`, `Priority`, `Subject`, `IsBodyHtml`, `BodyFileName`и др.</span><span class="sxs-lookup"><span data-stu-id="75d7a-198">The `MailDefinition` class offers a host of email-related properties, including `From`, `CC`, `Priority`, `Subject`, `IsBodyHtml`, `BodyFileName`, and others.</span></span> <span data-ttu-id="75d7a-199">Во-первых, задайте [ `Subject` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.subject.aspx) на более описательное имя, отличной от используемых по умолчанию (пароль), такие как сброса пароля...</span><span class="sxs-lookup"><span data-stu-id="75d7a-199">For starters, set the [`Subject` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.subject.aspx) to something more descriptive than the one used by default ( Password ), such as Your password has been reset...</span></span>

<span data-ttu-id="75d7a-200">Чтобы настроить текст сообщения электронной почты, необходимо создать файл шаблона одно сообщение электронной почты, содержащее содержимое тела.</span><span class="sxs-lookup"><span data-stu-id="75d7a-200">To customize the body of the email message we need to create a separate email template file that contains the body's contents.</span></span> <span data-ttu-id="75d7a-201">Начните с создания новой папки в веб-сайт с именем `EmailTemplates`.</span><span class="sxs-lookup"><span data-stu-id="75d7a-201">Start by creating a new folder in the website named `EmailTemplates`.</span></span> <span data-ttu-id="75d7a-202">Добавьте новый текстовый файл в эту папку с именем `PasswordRecovery.txt` и добавьте следующее содержимое:</span><span class="sxs-lookup"><span data-stu-id="75d7a-202">Next, add a new text file to this folder named `PasswordRecovery.txt` and add the following content:</span></span>

[!code-aspx[Main](recovering-and-changing-passwords-cs/samples/sample3.aspx)]

<span data-ttu-id="75d7a-203">Обратите внимание на использование заполнители `<%UserName%>` и `<%Password%>`.</span><span class="sxs-lookup"><span data-stu-id="75d7a-203">Note the use of the placeholders `<%UserName%>` and `<%Password%>`.</span></span> <span data-ttu-id="75d7a-204">Управления PasswordRecovery автоматически заменяет эти заполнители два пользователя и пароль восстановленные перед отправкой сообщения электронной почты.</span><span class="sxs-lookup"><span data-stu-id="75d7a-204">The PasswordRecovery control automatically replaces these two placeholders with the user's username and recovered password prior to sending the email.</span></span>

<span data-ttu-id="75d7a-205">Наконец, точки `MailDefinition` [ `BodyFileName` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) в только что созданный шаблон электронной почты (`~/EmailTemplates/PasswordRecovery.txt`).</span><span class="sxs-lookup"><span data-stu-id="75d7a-205">Lastly, point the `MailDefinition`'s [`BodyFileName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) to the email template we just created (`~/EmailTemplates/PasswordRecovery.txt`).</span></span>

<span data-ttu-id="75d7a-206">После внесения этих изменений повторное использование `RecoverPassword.aspx` страницы и введите имя пользователя и безопасности ответ.</span><span class="sxs-lookup"><span data-stu-id="75d7a-206">After making these changes revisit the `RecoverPassword.aspx` page and enter your username and security answer.</span></span> <span data-ttu-id="75d7a-207">Вы получаете следует сообщение электронной почты, который выглядит как показано на рис. 5.</span><span class="sxs-lookup"><span data-stu-id="75d7a-207">You receive should an email that looks like the one in Figure 5.</span></span> <span data-ttu-id="75d7a-208">Обратите внимание, что `webmaster@example.com` была бы копия и что поле темы и текст были обновлены.</span><span class="sxs-lookup"><span data-stu-id="75d7a-208">Note that `webmaster@example.com` has been CC'd and that the subject and body have been updated.</span></span>


<span data-ttu-id="75d7a-209">[![Тема, текст и список копий были обновлены](recovering-and-changing-passwords-cs/_static/image14.png)](recovering-and-changing-passwords-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="75d7a-209">[![The Subject, Body, and CC List Have Been Updated](recovering-and-changing-passwords-cs/_static/image14.png)](recovering-and-changing-passwords-cs/_static/image13.png)</span></span>

<span data-ttu-id="75d7a-210">**Рис. 5**: Тема, текст и копия список был обновлен ([Просмотр полноразмерное изображение](recovering-and-changing-passwords-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="75d7a-210">**Figure 5**: The Subject, Body, and CC List Have Been Updated  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image15.png))</span></span>


<span data-ttu-id="75d7a-211">Чтобы отправить сообщение электронной почты в формате HTML задайте [ `IsBodyHtml` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx) в значение True (по умолчанию: False) и обновление шаблона электронной почты для включения HTML.</span><span class="sxs-lookup"><span data-stu-id="75d7a-211">To send an HTML-formatted email set [`IsBodyHtml`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx) to True (the default is False) and update the email template to include HTML.</span></span>

<span data-ttu-id="75d7a-212">`MailDefinition` Свойство не является уникальным для PasswordRecovery класса.</span><span class="sxs-lookup"><span data-stu-id="75d7a-212">The `MailDefinition` property is not unique to the PasswordRecovery class.</span></span> <span data-ttu-id="75d7a-213">Как будет показано в шаге 2, управления ChangePassword также предлагает `MailDefinition` свойство.</span><span class="sxs-lookup"><span data-stu-id="75d7a-213">As we will see in Step 2, the ChangePassword control also offers a `MailDefinition` property.</span></span> <span data-ttu-id="75d7a-214">Кроме того, элемент управления CreateUserWizard включает такие свойства, которые можно настроить для автоматической отправки сообщений приветственное сообщение электронной почты новым пользователям.</span><span class="sxs-lookup"><span data-stu-id="75d7a-214">Moreover, the CreateUserWizard control includes such a property that you can configure to automatically send a welcome email message to new users.</span></span>

> [!NOTE]
> <span data-ttu-id="75d7a-215">В настоящее время нет ссылок на левой панели навигации для достижения `RecoverPassword.aspx` страницы.</span><span class="sxs-lookup"><span data-stu-id="75d7a-215">Currently there are no links in the left-hand navigation for reaching the `RecoverPassword.aspx` page.</span></span> <span data-ttu-id="75d7a-216">Только пользователь будут заинтересованы в посещении этой страницы, если она не смогла успешно Войдите на сайт.</span><span class="sxs-lookup"><span data-stu-id="75d7a-216">A user would only be interested in visiting this page if she was unable to successfully log on to the site.</span></span> <span data-ttu-id="75d7a-217">Поэтому обновлять `Login.aspx` страницу, чтобы включить ссылку на `RecoverPassword.aspx` страницы.</span><span class="sxs-lookup"><span data-stu-id="75d7a-217">Therefore, update the `Login.aspx` page to include a link to the `RecoverPassword.aspx` page.</span></span>


### <a name="programmatically-resetting-a-users-password"></a><span data-ttu-id="75d7a-218">Программным образом сбросе пароля пользователя</span><span class="sxs-lookup"><span data-stu-id="75d7a-218">Programmatically Resetting a User's Password</span></span>

<span data-ttu-id="75d7a-219">Если сброс пароля пользователя PasswordRecovery управление вызовы `MembershipUser` объекта [ `ResetPassword` метод](https://msdn.microsoft.com/library/system.web.security.membershipuser.resetpassword.aspx).</span><span class="sxs-lookup"><span data-stu-id="75d7a-219">When resetting a user's password the PasswordRecovery control calls the `MembershipUser` object's [`ResetPassword` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.resetpassword.aspx).</span></span> <span data-ttu-id="75d7a-220">Этот метод имеет две перегрузки:</span><span class="sxs-lookup"><span data-stu-id="75d7a-220">This method has two overloads:</span></span>

- <span data-ttu-id="75d7a-221">**[`ResetPassword`](https://msdn.microsoft.com/library/d94bdzz2.aspx)** -Сбрасывает пароль пользователя.</span><span class="sxs-lookup"><span data-stu-id="75d7a-221">**[`ResetPassword`](https://msdn.microsoft.com/library/d94bdzz2.aspx)** - resets a user's password.</span></span> <span data-ttu-id="75d7a-222">Используйте этот перегруженный метод, если `RequiresQuestionAndAnswer` имеет значение False.</span><span class="sxs-lookup"><span data-stu-id="75d7a-222">Use this overload if `RequiresQuestionAndAnswer` is False.</span></span>
- <span data-ttu-id="75d7a-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/library/d90zte4w.aspx)** -Сбрасывает только если пароль пользователя, предоставленного *securityAnswer* указано правильно.</span><span class="sxs-lookup"><span data-stu-id="75d7a-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/library/d90zte4w.aspx)** - resets a user's password only if the supplied *securityAnswer* is correct.</span></span> <span data-ttu-id="75d7a-224">Используйте этот перегруженный метод, если `RequiresQuestionAndAnswer` имеет значение True.</span><span class="sxs-lookup"><span data-stu-id="75d7a-224">Use this overload if `RequiresQuestionAndAnswer` is True.</span></span>

<span data-ttu-id="75d7a-225">Обе перегрузки возвращают новый созданный случайным образом пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-225">Both overloads return the new, randomly-generated password.</span></span>

<span data-ttu-id="75d7a-226">Как и с другими методами в платформе членства `ResetPassword` метод делегирует настроенного поставщика.</span><span class="sxs-lookup"><span data-stu-id="75d7a-226">Like with the other methods in the Membership framework, the `ResetPassword` method delegates to the configured provider.</span></span> <span data-ttu-id="75d7a-227">`SqlMembershipProvider` Вызывает `aspnet_Membership_ResetPassword` передача хранимой процедуры в имя пользователя, пароль и ответов введенного пароля, в других полях.</span><span class="sxs-lookup"><span data-stu-id="75d7a-227">The `SqlMembershipProvider` invokes the `aspnet_Membership_ResetPassword` stored procedure, passing in the user's username, the new password, and the supplied password answer, among other fields.</span></span> <span data-ttu-id="75d7a-228">Хранимая процедура гарантирует, что соответствует ответ пароля, а затем обновляет пароль пользователя.</span><span class="sxs-lookup"><span data-stu-id="75d7a-228">The stored procedure ensures that the password answer matches and then updates the user's password.</span></span>

<span data-ttu-id="75d7a-229">Пара замечаний Низкоуровневую реализацию:</span><span class="sxs-lookup"><span data-stu-id="75d7a-229">A couple of low-level implementation notes:</span></span>

- <span data-ttu-id="75d7a-230">Заблокированной пользователя не удается сбросить свой пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-230">A locked out user cannot reset her password.</span></span> <span data-ttu-id="75d7a-231">Тем не менее могут неутвержденных пользователя.</span><span class="sxs-lookup"><span data-stu-id="75d7a-231">However, an unapproved user may.</span></span> <span data-ttu-id="75d7a-232">Мы обсудим заблокированные и утверждена состояний более подробно в <a id="_msoanchor_3"> </a> [ *Unlocking и утверждение пользователя* ](unlocking-and-approving-user-accounts-cs.md) учебника учетных записей.</span><span class="sxs-lookup"><span data-stu-id="75d7a-232">We will discuss the locked out and approved states in more detail in the <a id="_msoanchor_3"></a>[*Unlocking and Approving User*](unlocking-and-approving-user-accounts-cs.md) Accounts tutorial.</span></span>
- <span data-ttu-id="75d7a-233">Если ответ пароль неверен, увеличивается число попыток ответов неудачных пароль пользователя.</span><span class="sxs-lookup"><span data-stu-id="75d7a-233">If the password answer is incorrect, the user's failed password answer attempt count is incremented.</span></span> <span data-ttu-id="75d7a-234">Если указанное число попыток недействительный безопасности в течение указанного интервала времени, когда пользователь заблокирован.</span><span class="sxs-lookup"><span data-stu-id="75d7a-234">If a specified number of invalid security answer attempts occur within a specified time window, the user is locked out.</span></span>

### <a name="a-word-on-how-the-random-passwords-are-generated"></a><span data-ttu-id="75d7a-235">Создаются слово на как случайными паролями</span><span class="sxs-lookup"><span data-stu-id="75d7a-235">A Word on How the Random Passwords are Generated</span></span>

<span data-ttu-id="75d7a-236">Пароли формируется случайным образом, показанный в сообщениях электронной почты в иллюстрациях 4 и 5 создаются с помощью класса членства [ `GeneratePassword` метод](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx).</span><span class="sxs-lookup"><span data-stu-id="75d7a-236">The randomly-generated passwords shown in the email messages in Figures 4 and 5 are created by the Membership class's [`GeneratePassword` method](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx).</span></span> <span data-ttu-id="75d7a-237">Этот метод принимает два входных параметров целое - *длина* и *numberOfNonAlphanumericCharacters* — и возвращает строку, по крайней мере *длина* символов цифр по бы *numberOfNonAlphanumericCharacters* число не буквенно-цифровых символов.</span><span class="sxs-lookup"><span data-stu-id="75d7a-237">This method accepts two integer input paramters - *length* and *numberOfNonAlphanumericCharacters* - and returns a string at least *length* characters long with at least *numberOfNonAlphanumericCharacters* number of non-alphanumeric characters.</span></span> <span data-ttu-id="75d7a-238">При вызове этого метода в классы членства или связанные с именем входа веб-элементов управления из значения для этих двух параметров определяются конфигурации членства `MinRequiredPasswordLength` и `MinRequiredNonalphanumericCharacters` свойства, которые рекомендуется задать значение 7 и 1, соответственно.</span><span class="sxs-lookup"><span data-stu-id="75d7a-238">When this method is called from within the Membership classes or Login-related Web controls, the values for these two parameters are determined by the Membership configuration's `MinRequiredPasswordLength` and `MinRequiredNonalphanumericCharacters` properties, which we set to 7 and 1, respectively.</span></span>

<span data-ttu-id="75d7a-239">`GeneratePassword` Метод использует криптостойкой генератора случайных чисел для убедитесь, что в выбраны какие случайных символов не учитывается.</span><span class="sxs-lookup"><span data-stu-id="75d7a-239">The `GeneratePassword` method uses a cryptographically strong random number generator to ensure that there is no bias in what random characters are selected.</span></span> <span data-ttu-id="75d7a-240">Кроме того `GeneratePassword` — `public`, это означает, что можно использовать его непосредственно из приложения ASP.NET для формирования случайных строк или пароли.</span><span class="sxs-lookup"><span data-stu-id="75d7a-240">Furthermore, `GeneratePassword` is `public`, meaning that you can use it directly from your ASP.NET application if you need to generate random strings or passwords.</span></span>

> [!NOTE]
> <span data-ttu-id="75d7a-241">`SqlMembershipProvider` Класс всегда создает случайный пароль менее 14 символов, поэтому, если `MinRequiredPasswordLength` имеет меньше 14, то его значение игнорируется.</span><span class="sxs-lookup"><span data-stu-id="75d7a-241">The `SqlMembershipProvider` class always generates a random password at least 14 characters long, so if `MinRequiredPasswordLength` is less than 14 then its value is ignored.</span></span>


## <a name="step-2-changing-passwords"></a><span data-ttu-id="75d7a-242">Шаг 2: Изменение паролей</span><span class="sxs-lookup"><span data-stu-id="75d7a-242">Step 2: Changing Passwords</span></span>

<span data-ttu-id="75d7a-243">Пароль формируется случайным образом трудны для запоминания.</span><span class="sxs-lookup"><span data-stu-id="75d7a-243">The randomly-generated passwords are difficult to remember.</span></span> <span data-ttu-id="75d7a-244">Рассмотрим пароль, показанный на рисунке 4: `WWGUZv(f2yM:Bd`.</span><span class="sxs-lookup"><span data-stu-id="75d7a-244">Consider the password shown in Figure 4: `WWGUZv(f2yM:Bd`.</span></span> <span data-ttu-id="75d7a-245">Попробуйте фиксации, в памяти!</span><span class="sxs-lookup"><span data-stu-id="75d7a-245">Try committing that to memory!</span></span> <span data-ttu-id="75d7a-246">Следует отметить после отправки пароль формируется случайным образом такого рода она потребуется изменить пароль на более запоминающееся.</span><span class="sxs-lookup"><span data-stu-id="75d7a-246">Needless to say, after a user is sent a randomly-generated password of this sort, she'll want to change the password to something more memorable.</span></span>

<span data-ttu-id="75d7a-247">Используйте элемент управления ChangePassword для создания интерфейса пользователя изменить свой пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-247">Use the ChangePassword control to create an interface for a user to change her password.</span></span> <span data-ttu-id="75d7a-248">Гораздо как управления PasswordRecovery ChangePassword управления состоит из двух представлений: изменение пароля и успех.</span><span class="sxs-lookup"><span data-stu-id="75d7a-248">Much like the PasswordRecovery control, the ChangePassword control consists of two views: Change Password and Success.</span></span> <span data-ttu-id="75d7a-249">Смена пароля представление пользователю старый и новый пароли.</span><span class="sxs-lookup"><span data-stu-id="75d7a-249">The Change Password view prompts the user for their old and new passwords.</span></span> <span data-ttu-id="75d7a-250">После указания старый пароль и новый пароль, который соответствует требованиям к минимальной длине и не буквенно-цифровых символов, управления ChangePassword обновляет пароль пользователя и отображает представления успешного выполнения.</span><span class="sxs-lookup"><span data-stu-id="75d7a-250">Upon supplying the correct old password and a new password that meets the minimum length and non-alphanumeric character requirements, the ChangePassword control updates the user's password and displays the Success view.</span></span>

> [!NOTE]
> <span data-ttu-id="75d7a-251">Элемент управления ChangePassword изменяет пароль пользователя путем вызова `MembershipUser` объекта [ `ChangePassword` метод](https://msdn.microsoft.com/library/system.web.security.membershipuser.changepassword.aspx).</span><span class="sxs-lookup"><span data-stu-id="75d7a-251">The ChangePassword control modifies the user's password by invoking the `MembershipUser` object's [`ChangePassword` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.changepassword.aspx).</span></span> <span data-ttu-id="75d7a-252">Метод ChangePassword принимает два `string` входных параметров - *Старый_пароль* и *newPassword*- и обновляет учетную запись пользователя с *newPassword*, при условии, что предоставленный *Старый_пароль* указано правильно.</span><span class="sxs-lookup"><span data-stu-id="75d7a-252">The ChangePassword method accepts two `string` input parameters - *oldPassword* and *newPassword*- and updates the user's account with the *newPassword*, assuming the supplied *oldPassword* is correct.</span></span>


<span data-ttu-id="75d7a-253">Откройте `ChangePassword.aspx` и добавьте элемент управления ChangePassword страницу, присвоив ему имя `ChangePwd`.</span><span class="sxs-lookup"><span data-stu-id="75d7a-253">Open the `ChangePassword.aspx` page and add a ChangePassword control to the page, naming it `ChangePwd`.</span></span> <span data-ttu-id="75d7a-254">На этом этапе конструктора должны показывать Смена пароля представления (см. рис. 6).</span><span class="sxs-lookup"><span data-stu-id="75d7a-254">At this point, the Design view should show the Change Password view (see Figure 6).</span></span> <span data-ttu-id="75d7a-255">Как с помощью элемента управления PasswordRecovery можно переключаться между представлениями через смарт-тег элемента управления.</span><span class="sxs-lookup"><span data-stu-id="75d7a-255">Like with the PasswordRecovery control, you can toggle between the views via the control's Smart Tag.</span></span> <span data-ttu-id="75d7a-256">Кроме того эти представления внешний вид настраиваются через свойства различные стиля или путем их преобразования в шаблон.</span><span class="sxs-lookup"><span data-stu-id="75d7a-256">Furthermore, these views' appearances are customizable through the assorted style properties or by converting them to a template.</span></span>


<span data-ttu-id="75d7a-257">[![Добавить на страницу элемент управления ChangePassword](recovering-and-changing-passwords-cs/_static/image17.png)](recovering-and-changing-passwords-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="75d7a-257">[![Add a ChangePassword Control to the Page](recovering-and-changing-passwords-cs/_static/image17.png)](recovering-and-changing-passwords-cs/_static/image16.png)</span></span>

<span data-ttu-id="75d7a-258">**Рис. 6**: добавить на страницу элемент управления ChangePassword ([Просмотр полноразмерное изображение](recovering-and-changing-passwords-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="75d7a-258">**Figure 6**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image18.png))</span></span>


<span data-ttu-id="75d7a-259">Элемент управления ChangePassword можно обновить пароль текущего выполнившего вход пользователя *или* пароль другой, указанного пользователя.</span><span class="sxs-lookup"><span data-stu-id="75d7a-259">The ChangePassword control can update the currently logged in user's password *or* the password of another, specified user.</span></span> <span data-ttu-id="75d7a-260">Как показано на рис. 6, представление сменить пароль по умолчанию отображает только три элемента управления TextBox: один для старого пароля и два для нового пароля.</span><span class="sxs-lookup"><span data-stu-id="75d7a-260">As Figure 6 shows, the default Change Password view renders just three TextBox controls: one for the old password and two for the new password.</span></span> <span data-ttu-id="75d7a-261">Этот интерфейс по умолчанию используется для обновления пароля пользователя, выполнившего вход.</span><span class="sxs-lookup"><span data-stu-id="75d7a-261">This default interface is used to update the currently logged on user's password.</span></span>

<span data-ttu-id="75d7a-262">Чтобы обновить пароль другого пользователя с помощью элемента управления ChangePassword, задать для элемента управления [ `DisplayUserName` свойства](https://msdn.microsoft.com/library/system.web.ui.webcontrols.changepassword.displayusername.aspx) значение True.</span><span class="sxs-lookup"><span data-stu-id="75d7a-262">To use the ChangePassword control to update another user's password, set the control's [`DisplayUserName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.changepassword.displayusername.aspx) to True.</span></span> <span data-ttu-id="75d7a-263">Это добавляет четвертый текстовое поле на страницу, запрашивает имя пользователя, пароль которого для изменения.</span><span class="sxs-lookup"><span data-stu-id="75d7a-263">Doing so adds a fourth TextBox to the page, prompting for the username of the user whose password to change.</span></span>

<span data-ttu-id="75d7a-264">Параметр `DisplayUserName` для является полезным, если вы хотите разрешить out вошедшего пользователя сменить пароль без необходимости входить значение True.</span><span class="sxs-lookup"><span data-stu-id="75d7a-264">Setting `DisplayUserName` to True is useful if you want to let a logged out user change her password without having to log in.</span></span> <span data-ttu-id="75d7a-265">Лично я считаю, что нет ничего плохого требуют пользователя для входа, прежде чем позволяя ему сменить пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-265">Personally, I think there's nothing wrong with requiring a user to login before allowing her to change her password.</span></span> <span data-ttu-id="75d7a-266">Таким образом, оставьте `DisplayUserName` значение False (по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="75d7a-266">Therefore, leave `DisplayUserName` set to False (its default).</span></span> <span data-ttu-id="75d7a-267">При принятии, тем не менее, мы по существу за исключением выполнения анонимным пользователям получать доступ этой страницы.</span><span class="sxs-lookup"><span data-stu-id="75d7a-267">In making this decision, however, we essentially are barring anonymous users from reaching this page.</span></span> <span data-ttu-id="75d7a-268">Обновить правила авторизации URL-адрес сайта таким образом, чтобы запретить анонимные пользователи из посетив `ChangePassword.aspx`.</span><span class="sxs-lookup"><span data-stu-id="75d7a-268">Update the site's URL authorization rules so as to deny anonymous users from visiting `ChangePassword.aspx`.</span></span> <span data-ttu-id="75d7a-269">Если вам необходимо обновить память на синтаксис правила авторизации URL-адрес, обращаться к <a id="_msoanchor_4"> </a> [ *авторизации на основе пользователя* ](../membership/user-based-authorization-cs.md) учебника.</span><span class="sxs-lookup"><span data-stu-id="75d7a-269">If you need to refresh your memory on the URL authorization rule syntax, refer back to the <a id="_msoanchor_4"></a>[*User-Based Authorization*](../membership/user-based-authorization-cs.md) tutorial.</span></span>

> [!NOTE]
> <span data-ttu-id="75d7a-270">Может показаться, что `DisplayUserName` свойство полезно для дает администраторам возможность изменять пароли других пользователей.</span><span class="sxs-lookup"><span data-stu-id="75d7a-270">It may seem that the `DisplayUserName` property is useful for allowing administrators to change other users' passwords.</span></span> <span data-ttu-id="75d7a-271">Тем не менее, даже если `DisplayUserName` имеет значение True, старый пароль необходимо известные и ввести.</span><span class="sxs-lookup"><span data-stu-id="75d7a-271">However, even when `DisplayUserName` is set to True the correct old password must be known and entered.</span></span> <span data-ttu-id="75d7a-272">Мы рассмотрим способы дает администраторам возможность изменения паролей пользователей на шаге 3.</span><span class="sxs-lookup"><span data-stu-id="75d7a-272">We will talk about techniques for allowing administrators to change users' passwords in Step 3.</span></span>


<span data-ttu-id="75d7a-273">Посетите `ChangePassword.aspx` через браузер и изменить свой пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-273">Visit the `ChangePassword.aspx` page through a browser and change your password.</span></span> <span data-ttu-id="75d7a-274">Обратите внимание, что сообщение об ошибке отображается, если ввести новый пароль, который не удается обеспечить соблюдение требований не буквенно-цифровых символов, указанный в конфигурации членства и длина пароля (см. рис. 7).</span><span class="sxs-lookup"><span data-stu-id="75d7a-274">Note that an error message is displayed if you enter a new password that fails to meet the password length and non-alphanumeric character requirements specified in the Membership configuration (see Figure 7).</span></span>


<span data-ttu-id="75d7a-275">[![Добавить на страницу элемент управления ChangePassword](recovering-and-changing-passwords-cs/_static/image20.png)](recovering-and-changing-passwords-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="75d7a-275">[![Add a ChangePassword Control to the Page](recovering-and-changing-passwords-cs/_static/image20.png)](recovering-and-changing-passwords-cs/_static/image19.png)</span></span>

<span data-ttu-id="75d7a-276">**Рис. 7**: добавить на страницу элемент управления ChangePassword ([Просмотр полноразмерное изображение](recovering-and-changing-passwords-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="75d7a-276">**Figure 7**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image21.png))</span></span>


<span data-ttu-id="75d7a-277">После ввода правильный пароль старого и нового пароля, вошедшего в систему на пользователя изменить пароль и отображаются представления успешного выполнения.</span><span class="sxs-lookup"><span data-stu-id="75d7a-277">Upon entering the correct old password and a valid new password, the logged on user's password is changed and the Success view displayed.</span></span>

### <a name="sending-a-confirmation-email"></a><span data-ttu-id="75d7a-278">Отправка подтверждения адреса электронной почты</span><span class="sxs-lookup"><span data-stu-id="75d7a-278">Sending a Confirmation Email</span></span>

<span data-ttu-id="75d7a-279">По умолчанию ChangePassword управления не отправляет сообщение электронной почты для пользователя, пароль которого только что обновлено.</span><span class="sxs-lookup"><span data-stu-id="75d7a-279">By default, the ChangePassword control does not send an email message to the user whose password was just updated.</span></span> <span data-ttu-id="75d7a-280">Если вы хотите отправить сообщение электронной почты, просто настроить элемент управления `MailDefinition` свойство.</span><span class="sxs-lookup"><span data-stu-id="75d7a-280">If you'd like to send an email, simply configure the control's `MailDefinition` property.</span></span> <span data-ttu-id="75d7a-281">Позволяет настроить элемент управления ChangePassword таким образом, чтобы пользователю отправляется сообщение электронной почты формате HTML, содержащий новый пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-281">Let's configure the ChangePassword control so that the user is sent an HTML-formatted email that contains their new password.</span></span>

<span data-ttu-id="75d7a-282">Начните с создания в новом файле в `EmailTemplates` папку с именем `ChangePassword.htm`.</span><span class="sxs-lookup"><span data-stu-id="75d7a-282">Start by creating a new file in the `EmailTemplates` folder named `ChangePassword.htm`.</span></span> <span data-ttu-id="75d7a-283">Добавьте следующую разметку:</span><span class="sxs-lookup"><span data-stu-id="75d7a-283">Add the following markup:</span></span>

[!code-html[Main](recovering-and-changing-passwords-cs/samples/sample4.html)]

<span data-ttu-id="75d7a-284">Переключите элемент управления ChangePassword `MailDefinition` свойства `BodyFileName`, `IsBodyHtml`, и `Subject` свойства ~ / EmailTemplates/ChangePassword.htm "," True "и" пароль был изменен! соответственно.</span><span class="sxs-lookup"><span data-stu-id="75d7a-284">Next, set the ChangePassword control's `MailDefinition` property's `BodyFileName`, `IsBodyHtml`, and `Subject` properties to ~/EmailTemplates/ChangePassword.htm, True, and Your password has changed!, respectively.</span></span>

<span data-ttu-id="75d7a-285">После внесения этих изменений, повторном посещении страницы и изменить пароль еще раз.</span><span class="sxs-lookup"><span data-stu-id="75d7a-285">After making these changes, revisit the page and change your password again.</span></span> <span data-ttu-id="75d7a-286">На этот раз управления ChangePassword Отправка сообщения настроенный, в формате HTML адреса электронной почты пользователя на файл (см. рис. 8).</span><span class="sxs-lookup"><span data-stu-id="75d7a-286">This time, the ChangePassword control sends a customized, HTML-formatted email to the user's email address on file (see Figure 8).</span></span>


<span data-ttu-id="75d7a-287">[![По электронной почте сообщение о том, что их пароль пользователя изменилось](recovering-and-changing-passwords-cs/_static/image23.png)](recovering-and-changing-passwords-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="75d7a-287">[![An Email Message Informs the User That Their Password has Changed](recovering-and-changing-passwords-cs/_static/image23.png)](recovering-and-changing-passwords-cs/_static/image22.png)</span></span>

<span data-ttu-id="75d7a-288">**Рис. 8**: по электронной почте сообщение о том, что их пароль пользователя изменилась ([Просмотр полноразмерное изображение](recovering-and-changing-passwords-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="75d7a-288">**Figure 8**: An Email Message Informs the User That Their Password has Changed  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image24.png))</span></span>


## <a name="step-3-allowing-administrators-to-change-users-passwords"></a><span data-ttu-id="75d7a-289">Шаг 3: Дает администраторам возможность изменения паролей пользователей</span><span class="sxs-lookup"><span data-stu-id="75d7a-289">Step 3: Allowing Administrators to Change Users' Passwords</span></span>

<span data-ttu-id="75d7a-290">Общие функции в приложениях, поддерживающих учетные записи пользователей — это возможность пользователь с правами администратора изменить пароли других пользователей.</span><span class="sxs-lookup"><span data-stu-id="75d7a-290">A common feature in applications that support user accounts is the ability for an administrative user to change other users' passwords.</span></span> <span data-ttu-id="75d7a-291">Иногда эта функциональность необходима, поскольку в системе нет возможности, чтобы пользователи могли изменять свои пароли.</span><span class="sxs-lookup"><span data-stu-id="75d7a-291">Sometimes this functionality is required because the system lacks the ability for users to change their own passwords.</span></span> <span data-ttu-id="75d7a-292">В этом случае администратор может назначить их новый пароль будет единственным способом для пользователя восстановить забытый пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-292">In such a case, the only way for a user to recover their forgotten password would be for the administrator to assign them a new password.</span></span> <span data-ttu-id="75d7a-293">С элементами управления PasswordRecovery и изменение пароля тем не менее, пользователи с правами администратора требуется не заняты сами с изменение паролей пользователей, как пользователи способны делать это самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="75d7a-293">With the PasswordRecovery and ChangePassword controls, however, administrative users need not busy themselves with changing users' passwords, as users are capable of doing this themselves.</span></span>

<span data-ttu-id="75d7a-294">Но что делать, если ваш клиент настаивает, административные пользователи должны иметь возможность изменять пароли других пользователей?</span><span class="sxs-lookup"><span data-stu-id="75d7a-294">But what if your client insists that administrative users should be able to change other users' passwords?</span></span> <span data-ttu-id="75d7a-295">К сожалению Добавление этой функции может быть немного усилий.</span><span class="sxs-lookup"><span data-stu-id="75d7a-295">Unfortunately, adding this functionality can be a bit of work.</span></span> <span data-ttu-id="75d7a-296">Чтобы изменить пароль пользователя, старый и новый пароль должен быть введен для `MembershipUser` объекта `ChangePassword` метода, но администратор не должны знать пароль, чтобы изменить его.</span><span class="sxs-lookup"><span data-stu-id="75d7a-296">To change a user's password, both the old and new password must be supplied to the `MembershipUser` object's `ChangePassword` method, but an administrator shouldn't have to know a user's password in order to modify it.</span></span>

<span data-ttu-id="75d7a-297">Одно решение — сбросить пароль пользователя, а затем измените его на новый пароль, с помощью следующего кода:</span><span class="sxs-lookup"><span data-stu-id="75d7a-297">One workaround is to first reset the user's password and then change it to the new password using code like the following:</span></span>

[!code-aspx[Main](recovering-and-changing-passwords-cs/samples/sample5.aspx)]

<span data-ttu-id="75d7a-298">Этот код сначала получает сведения о *username*, который является имя пользователя, пароль которого администратор хочет изменить.</span><span class="sxs-lookup"><span data-stu-id="75d7a-298">This code starts by retrieving information about *username*, which is the user whose password the administrator wishes to change.</span></span> <span data-ttu-id="75d7a-299">Далее, `ResetPassword` вызова метода какие назначает и случайных новый пароль пользователя.</span><span class="sxs-lookup"><span data-stu-id="75d7a-299">Next, the `ResetPassword` method is invoked, which assigns and the user a new, random password.</span></span> <span data-ttu-id="75d7a-300">Данный пароль формируется случайным образом возвращается с помощью метода, которая хранится в переменной `resetPwd`.</span><span class="sxs-lookup"><span data-stu-id="75d7a-300">This randomly-generated password is returned by the method and stored in the variable `resetPwd`.</span></span> <span data-ttu-id="75d7a-301">Теперь, когда мы знаем, пароль пользователя, мы можем изменить через вызов `ChangePassword`.</span><span class="sxs-lookup"><span data-stu-id="75d7a-301">Now that we know the user's password, we can change it via a call to `ChangePassword`.</span></span>

<span data-ttu-id="75d7a-302">Проблема заключается в том, что этот код работает, только если конфигурация системы членства настроена таким образом, что `RequiresQuestionAndAnswer` имеет значение False.</span><span class="sxs-lookup"><span data-stu-id="75d7a-302">The problem is that this code only works if the Membership system configuration is set such that `RequiresQuestionAndAnswer` is False.</span></span> <span data-ttu-id="75d7a-303">Если `RequiresQuestionAndAnswer` имеет значение True, как в приложении, а затем `ResetPassword` метода должно быть передано защитный ответ, в противном случае будет вызвано исключение.</span><span class="sxs-lookup"><span data-stu-id="75d7a-303">If `RequiresQuestionAndAnswer` is True, as it is with our application, then the `ResetPassword` method needs to be passed the security answer, otherwise it will throw an exception.</span></span>

<span data-ttu-id="75d7a-304">Если framework членства настроен требовать секретный вопрос и ответ на него еще ваш клиент настаивает администраторы смогут изменять пароли пользователей, у вас есть три варианта:</span><span class="sxs-lookup"><span data-stu-id="75d7a-304">If the Membership framework is configured to require a security question and answer, and yet your client insists that administrators be able to change users' passwords, you have three options:</span></span>

- <span data-ttu-id="75d7a-305">Вызывать рук в воздухе и сообщить ваш клиент, что это лишь один интересный момент, не может быть выполнена.</span><span class="sxs-lookup"><span data-stu-id="75d7a-305">Throw your hands in the air and tell your client that this is just one thing that cannot be done.</span></span>
- <span data-ttu-id="75d7a-306">Задать `RequiresQuestionAndAnswer` значение False.</span><span class="sxs-lookup"><span data-stu-id="75d7a-306">Set `RequiresQuestionAndAnswer` to False.</span></span> <span data-ttu-id="75d7a-307">Это приводит к менее безопасного приложения.</span><span class="sxs-lookup"><span data-stu-id="75d7a-307">This results in a less secure application.</span></span> <span data-ttu-id="75d7a-308">Предположим, что пользователь гнусных получившим доступ в ящик входящих сообщений электронной почты другого пользователя.</span><span class="sxs-lookup"><span data-stu-id="75d7a-308">Imagine that a nefarious user has gained access to another user's email inbox.</span></span> <span data-ttu-id="75d7a-309">Возможно скомпрометированный пользователь покинул их поддержки, чтобы перейти на обед не заблокировать своей рабочей станции и может быть они доступ к электронной почте из открытых терминала не выйдите из системы. В любом случае можно посетить гнусных пользователя `RecoverPassword.aspx` страницы и введите имя пользователя.</span><span class="sxs-lookup"><span data-stu-id="75d7a-309">Perhaps the compromised user has left their desk to go to lunch and didn't lock their workstation, or maybe they accessed their email from a public terminal and didn't sign out. In either case, the nefarious user can visit the `RecoverPassword.aspx` page and enter the user's username.</span></span> <span data-ttu-id="75d7a-310">Система будет отправить по электронной почте восстановленный пароль не запрашиваются защитный ответ.</span><span class="sxs-lookup"><span data-stu-id="75d7a-310">The system will then email the recovered password without prompting for the security answer.</span></span>
- <span data-ttu-id="75d7a-311">Обход уровень абстракции, созданные в framework членства и работать непосредственно с базой данных SQL Server.</span><span class="sxs-lookup"><span data-stu-id="75d7a-311">Bypass the abstraction layer created by the Membership framework and work directly with the SQL Server database.</span></span> <span data-ttu-id="75d7a-312">Схема членства включает хранимую процедуру с именем `aspnet_Membership_SetPassword` , задает пароль пользователя и не требуется для выполнения своей задачи ответ на контрольный вопрос или старый пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-312">The Membership schema includes a stored procedure named `aspnet_Membership_SetPassword` that sets a user's password and does not require the security answer or old password in order to accomplish its task.</span></span>

<span data-ttu-id="75d7a-313">Ни один из этих параметров не особенно удобно, но как жизненного цикла разработчик иногда переход.</span><span class="sxs-lookup"><span data-stu-id="75d7a-313">None of these options are particularly appealing, but that's how the life of a developer goes sometimes.</span></span>

<span data-ttu-id="75d7a-314">Я пошли дальше и реализации третий способ написания кода, который обходит `Membership` и `MembershipUser` классы и работает непосредственно с `SecurityTutorials` базы данных.</span><span class="sxs-lookup"><span data-stu-id="75d7a-314">I went ahead and implemented the third approach, writing code that bypasses the `Membership` and `MembershipUser` classes and operates directly against the `SecurityTutorials` database.</span></span>

> [!NOTE]
> <span data-ttu-id="75d7a-315">Работая непосредственно с базой данных, является shattered инкапсуляцией, предоставляет платформа членства.</span><span class="sxs-lookup"><span data-stu-id="75d7a-315">By working directly with the database, the encapsulation provided by the Membership framework is shattered.</span></span> <span data-ttu-id="75d7a-316">Это решение связывает нам `SqlMembershipProvider`, делая менее portable наш код.</span><span class="sxs-lookup"><span data-stu-id="75d7a-316">This decision ties us to the `SqlMembershipProvider`, making our code less portable.</span></span> <span data-ttu-id="75d7a-317">Более того этот код может не работать должным образом в будущих версиях ASP.NET при изменении схемы членства.</span><span class="sxs-lookup"><span data-stu-id="75d7a-317">Furthermore, this code may not work as expected in future versions of ASP.NET if the Membership schema changes.</span></span> <span data-ttu-id="75d7a-318">Этот подход является временное решение и, как и большинство обойти это ограничение, не примером советы и рекомендации.</span><span class="sxs-lookup"><span data-stu-id="75d7a-318">This approach is a workaround and, like most workarounds, is not an example of best practices.</span></span>


<span data-ttu-id="75d7a-319">Этот код содержит некоторые все биты и довольно длинный.</span><span class="sxs-lookup"><span data-stu-id="75d7a-319">The code has some unattractive bits and is quite lengthy.</span></span> <span data-ttu-id="75d7a-320">Таким образом не следует, чтобы не перегружать этого учебника с глубокого анализа.</span><span class="sxs-lookup"><span data-stu-id="75d7a-320">Therefore, I don't want to clutter this tutorial with an in-depth examination of it.</span></span> <span data-ttu-id="75d7a-321">Если вы заинтересованы в дополнительной информацией, загрузить код для этого учебника и посещение `~/Administration/ManageUsers.aspx` страницы.</span><span class="sxs-lookup"><span data-stu-id="75d7a-321">If you are interested in learning more, download the code for this tutorial and visit the `~/Administration/ManageUsers.aspx` page.</span></span> <span data-ttu-id="75d7a-322">Мы создали на этой странице <a id="_msoanchor_5"> </a> [предыдущего учебника](building-an-interface-to-select-one-user-account-from-many-cs.md), список всех пользователей.</span><span class="sxs-lookup"><span data-stu-id="75d7a-322">This page, which we created in the <a id="_msoanchor_5"></a>[preceding tutorial](building-an-interface-to-select-one-user-account-from-many-cs.md), lists each user.</span></span> <span data-ttu-id="75d7a-323">Было выполнено обновление GridView, чтобы включить ссылку на `UserInformation.aspx` страницы, передав имя выбранного пользователя через строку запроса.</span><span class="sxs-lookup"><span data-stu-id="75d7a-323">I've updated the GridView to include a link to the `UserInformation.aspx` page, passing the selected user's username through the querystring.</span></span> <span data-ttu-id="75d7a-324">`UserInformation.aspx` Странице отображаются сведения о выбранный пользователь и текстовые поля для изменения пароля (см. рис. 9).</span><span class="sxs-lookup"><span data-stu-id="75d7a-324">The `UserInformation.aspx` page displays information about the selected user and TextBoxes for changing their password (see Figure 9).</span></span>

<span data-ttu-id="75d7a-325">После ввода нового пароля, подтверждение его второго текстового поля и кнопку обновления пользователя, выполняется обратная и `aspnet_Membership_SetPassword` вызова хранимой процедуры, обновление пароля пользователя.</span><span class="sxs-lookup"><span data-stu-id="75d7a-325">After entering the new password, confirming it in the second TextBox, and clicking the Update User Button, a postback ensues and the `aspnet_Membership_SetPassword` stored procedure is invoked, updating the user's password.</span></span> <span data-ttu-id="75d7a-326">Читателю эти средства чтения интересует эта функциональность для подробного знакомства с кодом и повторите расширение функциональных возможностей для включения отправки сообщения электронной почты для пользователя, пароль которого было изменено.</span><span class="sxs-lookup"><span data-stu-id="75d7a-326">I encourage those readers interested in this functionality to become more familiar with the code and try extending the functionality to include sending an email to the user whose password was changed.</span></span>


<span data-ttu-id="75d7a-327">[![Администратор может изменить пароль пользователя](recovering-and-changing-passwords-cs/_static/image26.png)](recovering-and-changing-passwords-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="75d7a-327">[![An Administrator May Change a User's Password](recovering-and-changing-passwords-cs/_static/image26.png)](recovering-and-changing-passwords-cs/_static/image25.png)</span></span>

<span data-ttu-id="75d7a-328">**Рис. 9**: администратор может изменить пароль ([Просмотр полноразмерное изображение](recovering-and-changing-passwords-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="75d7a-328">**Figure 9**: An Administrator May Change a User's Password  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image27.png))</span></span>


> [!NOTE]
> <span data-ttu-id="75d7a-329">`UserInformation.aspx` Страница в данный момент работает только если framework членства настроен для хранения паролей в формате Clear или Hashed.</span><span class="sxs-lookup"><span data-stu-id="75d7a-329">The `UserInformation.aspx` page currently only works if the Membership framework is configured to store passwords in Clear or Hashed format.</span></span> <span data-ttu-id="75d7a-330">Несмотря на то, что вам будет предложено добавить эта функция не имеет кода для шифрования новый пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-330">It lacks the code to encrypt the new password, although you are invited to add this functionality.</span></span> <span data-ttu-id="75d7a-331">Ситуации, рекомендуется добавить необходимый код рекомендуется использовать декомпилятор как [Reflector](http://www.aisto.com/roeder/dotnet/) для изучите исходный код для методов в платформе .NET Framework; первоначальный анализ `SqlMembershipProvider` класса `ChangePassword` метод.</span><span class="sxs-lookup"><span data-stu-id="75d7a-331">The way I recommend adding the necessary code is to use a decompiler like [Reflector](http://www.aisto.com/roeder/dotnet/) to examine the source code for methods in the .NET Framework; start by examining the `SqlMembershipProvider` class's `ChangePassword` method.</span></span> <span data-ttu-id="75d7a-332">Это методика, использованной для написания кода для создания хэш пароля.</span><span class="sxs-lookup"><span data-stu-id="75d7a-332">This is the technique I used to write the code for creating a hash of the password.</span></span>


## <a name="summary"></a><span data-ttu-id="75d7a-333">Сводка</span><span class="sxs-lookup"><span data-stu-id="75d7a-333">Summary</span></span>

<span data-ttu-id="75d7a-334">ASP.NET предоставляет два элемента управления, чтобы помочь пользователям управлять свой пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-334">ASP.NET offers two controls to help users manage their password.</span></span> <span data-ttu-id="75d7a-335">Управления PasswordRecovery полезно для тех, кто забывшим свои пароли.</span><span class="sxs-lookup"><span data-stu-id="75d7a-335">The PasswordRecovery control is useful for those who have forgotten their passwords.</span></span> <span data-ttu-id="75d7a-336">В зависимости от конфигурации framework членства пользователя либо по электронной почте свой текущий пароль или новый пароль формируется случайным образом.</span><span class="sxs-lookup"><span data-stu-id="75d7a-336">Depending on the Membership framework's configuration, the user is either emailed their existing password or a new, randomly-generated password.</span></span> <span data-ttu-id="75d7a-337">Элемент управления ChangePassword позволяет пользователю изменить свой пароль.</span><span class="sxs-lookup"><span data-stu-id="75d7a-337">The ChangePassword control enables a user to update their password.</span></span>

<span data-ttu-id="75d7a-338">Как и элементы управления входа и CreateUserWizard PasswordRecovery и ChangePassword элементы управления отображаются многофункциональный пользовательский интерфейс без написания ни строчки декларативная разметка или строку кода.</span><span class="sxs-lookup"><span data-stu-id="75d7a-338">Like the Login and CreateUserWizard controls, the PasswordRecovery and ChangePassword controls render a rich user interface without having to write a lick of declarative markup or line of code.</span></span> <span data-ttu-id="75d7a-339">Если пользовательский интерфейс по умолчанию не удовлетворяют вашим потребностям, можно настроить его через различные свойства стиля.</span><span class="sxs-lookup"><span data-stu-id="75d7a-339">If the default user interface doesn't meet your needs, you can customize it through a variety of style properties.</span></span> <span data-ttu-id="75d7a-340">Кроме того интерфейсы элементов управления может быть преобразован в шаблоны для еще более точно степень контроля.</span><span class="sxs-lookup"><span data-stu-id="75d7a-340">Alternatively, the controls' interfaces may be converted into templates, for an even finer degree of control.</span></span> <span data-ttu-id="75d7a-341">В фоновом эти элементы управления используют API членства, вызов `MembershipUser` объекта `ResetPassword` и `ChangePassword` методы.</span><span class="sxs-lookup"><span data-stu-id="75d7a-341">Behind the scenes these controls use the Membership API, invoking the `MembershipUser` object's `ResetPassword` and `ChangePassword` methods.</span></span>

<span data-ttu-id="75d7a-342">Программирование довольны!</span><span class="sxs-lookup"><span data-stu-id="75d7a-342">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="75d7a-343">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="75d7a-343">Further Reading</span></span>

<span data-ttu-id="75d7a-344">Дополнительные сведения по темам, рассматриваемые в этом учебнике см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="75d7a-344">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="75d7a-345">Примеры использования элемента управления ChangePassword</span><span class="sxs-lookup"><span data-stu-id="75d7a-345">ChangePassword Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/changepassword.aspx)
- [<span data-ttu-id="75d7a-346">Примеры использования элемента управления PasswordRecovery</span><span class="sxs-lookup"><span data-stu-id="75d7a-346">PasswordRecovery Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/passwordrecovery.aspx)
- [<span data-ttu-id="75d7a-347">При отправке сообщения в ASP.NET</span><span class="sxs-lookup"><span data-stu-id="75d7a-347">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="75d7a-348">`System.Net.Mail` FAQs</span><span class="sxs-lookup"><span data-stu-id="75d7a-348">`System.Net.Mail` FAQs</span></span>](http://www.systemnetmail.com/)

### <a name="about-the-author"></a><span data-ttu-id="75d7a-349">Об авторе</span><span class="sxs-lookup"><span data-stu-id="75d7a-349">About the Author</span></span>

<span data-ttu-id="75d7a-350">Скотт Митчелл, автор нескольких ASP/ASP.NET и основатель 4GuysFromRolla.com, работает с веб-технологиями Майкрософт с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="75d7a-350">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="75d7a-351">Скотт — независимый консультант, trainer и записи.</span><span class="sxs-lookup"><span data-stu-id="75d7a-351">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="75d7a-352">Его последняя книга —  *[диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="75d7a-352">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="75d7a-353">Скотт может быть достигнута по [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) или через его блог по [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="75d7a-353">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="75d7a-354">Благодарности</span><span class="sxs-lookup"><span data-stu-id="75d7a-354">Special Thanks To</span></span>

<span data-ttu-id="75d7a-355">Этот учебник ряд прошел проверку многие полезные рецензентов.</span><span class="sxs-lookup"><span data-stu-id="75d7a-355">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="75d7a-356">Основными редакторами этого учебника включают Майкл Emmings и Suchi Банерджи.</span><span class="sxs-lookup"><span data-stu-id="75d7a-356">Lead reviewers for this tutorial include Michael Emmings and Suchi Banerjee.</span></span> <span data-ttu-id="75d7a-357">Объясняются моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="75d7a-357">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="75d7a-358">Если Да, напишите мне по [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="75d7a-358">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="75d7a-359">[Назад](building-an-interface-to-select-one-user-account-from-many-cs.md)
> [Вперед](unlocking-and-approving-user-accounts-cs.md)</span><span class="sxs-lookup"><span data-stu-id="75d7a-359">[Previous](building-an-interface-to-select-one-user-account-from-many-cs.md)
[Next](unlocking-and-approving-user-accounts-cs.md)</span></span>
