---
uid: web-forms/overview/older-versions-security/admin/unlocking-and-approving-user-accounts-cs
title: Снятие блокировки и утверждения учетных записей пользователей (C#) | Документы Microsoft
author: rick-anderson
description: Этот учебник показывает, как для создания веб-страницы управления для администраторов заблокирован и утверждены состояния пользователей. Также будет показано, как утвердить новый o пользователей...
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/01/2008
ms.topic: article
ms.assetid: 5346aab1-9974-489f-a065-ae3883b8a350
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/admin/unlocking-and-approving-user-accounts-cs
msc.type: authoredcontent
ms.openlocfilehash: 8b3d69e96513192bc73a2a6a7cbb4c6e33eb610b
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="unlocking-and-approving-user-accounts-c"></a>Снятие блокировки и утверждение учетных записей пользователей (C#)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить код](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.14.zip) или [скачать PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial14_UnlockAndApprove_cs.pdf)

> Этот учебник показывает, как для создания веб-страницы управления для администраторов заблокирован и утверждены состояния пользователей. Вы также узнаете утверждение новых пользователей только после проверки адреса электронной почты.


## <a name="introduction"></a>Вступление

Наряду с пользователя, пароль и электронной почты, каждая учетная запись пользователя имеет два поля состояния, которые определяют, может ли пользователь войти на сайт: заблокирована и утверждены. Пользователь заблокирован автоматически, если они предоставляют недопустимых учетных данных указанное число раз в течение указанного количества минут (по умолчанию блокировать пользователя после 5 попыток недопустимое имя для входа в течение 10 минут). Состояние утверждения полезно в случаях, когда какое-либо действие должен пройти перед новый пользователь сможет войти сайт. Например пользователь может потребоваться сначала проверить свой адрес электронной почты или утвержденные администратором, прежде чем получить возможность входа в систему.

Так как заблокированный out или не утвержденные пользователь не может войти в систему, он только естественного беспокоиться переустановка этих состояний. ASP.NET не включает все встроенные функциональные возможности или веб-элементы управления для управления пользователей заблокирована и частично утвержденные состояния, так как эти решения требуют обработки на основе между сайтами. Некоторые узлы могут автоматически утверждать все новые учетные записи пользователей (по умолчанию). Другим пользователям, чтобы администратор утверждение новых учетных записей или не утверждение пользователей, пока они посетите ссылки, отправленной на адрес электронной почты, предоставленный при их регистрации. Аналогичным образом некоторые узлы могут блокировать выход для пользователей, пока администратор сбрасывает их состояние, а другие сайты отправить сообщение электронной почты заблокированной пользователя на URL-адрес посещении можно разблокировать учетную запись.

Этот учебник показывает, как для создания веб-страницы управления для администраторов заблокирован и утверждены состояния пользователей. Вы также узнаете утверждение новых пользователей только после проверки адреса электронной почты.

## <a name="step-1-managing-users-locked-out-and-approved-statuses"></a>Шаг 1: Управление пользователями заблокирован и утверждения состояния

В <a id="Tutorial12"> </a> [ *построение интерфейс для выбора одной учетной записи пользователя из многих* ](building-an-interface-to-select-one-user-account-from-many-cs.md) учебника мы создается страница, на которой перечислены каждой учетной записи пользователя в разбитого на страницы, отфильтрованные GridView. В сетке имя каждого пользователя и электронной почты, их состояния, разрешенных и заблокированных out, ли они в интерактивном режиме и комментарии о пользователе. Для управления пользователей утверждены и заблокирована состояния, можно сделать эту сетку для редактирования. Чтобы изменить состояние утверждения для пользователя, администратору следует сначала найдите учетную запись пользователя и затем измените соответствующую строку GridView, устанавливая или снимая флажок утвержденных. Кроме того мы может управлять статусов утвержденных и заблокированной через отдельную страницу ASP.NET.

В этом учебнике используем две страницы ASP.NET: `ManageUsers.aspx` и `UserInformation.aspx`. В данном случае, `ManageUsers.aspx` перечислены учетные записи пользователей в систему, пока `UserInformation.aspx` позволяет администраторам управлять разрешенных и заблокированных ожидания состояния для определенного пользователя. — Расширить GridView в нашем первым делом `ManageUsers.aspx` для включения HyperLinkField, который отображается в виде столбца ссылок. Мы хотим, чтобы каждый канал, чтобы она указывала на `UserInformation.aspx?user=UserName`, где *UserName* имя пользователя для редактирования.

> [!NOTE]
> Если вы загрузили код <a id="Tutorial13"> </a> [ *Recovering и изменение паролей* ](recovering-and-changing-passwords-cs.md) учебник, вы заметите, что `ManageUsers.aspx` страница уже содержит набор» Управление» ссылки и `UserInformation.aspx` страница предоставляет интерфейс для изменения пароля выбранного пользователя. Я решил не реплицировать эти функциональные возможности в код, связанный с учебником, так как он обрабатывается обход API членства и работает непосредственно с базой данных SQL Server для изменения пароля пользователя. Этот учебник начинает с нуля с `UserInformation.aspx` страницы.


### <a name="adding-manage-links-to-theuseraccountsgridview"></a>Добавление «управление» ссылки на`UserAccounts`GridView

Откройте `ManageUsers.aspx` и добавьте HyperLinkField для `UserAccounts` GridView. Задать HyperLinkField `Text` свойства «Manage» и его `DataNavigateUrlFields` и `DataNavigateUrlFormatString` свойства `UserName` и «UserInformation.aspx?user={0}», соответственно. Эти параметры используются для настройки HyperLinkField таким образом, что все ссылки отображения текста «Manage», но каждый канал передает в соответствующую *UserName* значение в строке запроса.

После добавления HyperLinkField GridView, занять некоторое время для просмотра `ManageUsers.aspx` страницу в обозревателе. Как показано на рис. 1, каждая строка GridView теперь включает ссылку «Управление». Указывает ссылку «Manage» Bruce `UserInformation.aspx?user=Bruce`, тогда как ссылка «Управление» для Dave указывает `UserInformation.aspx?user=Dave`.


[![Добавляет HyperLinkField](unlocking-and-approving-user-accounts-cs/_static/image2.png)](unlocking-and-approving-user-accounts-cs/_static/image1.png)

**Рис. 1**: HyperLinkField добавляет ссылку «Управление» для каждой учетной записи пользователя ([Просмотр полноразмерное изображение](unlocking-and-approving-user-accounts-cs/_static/image3.png))


Она будет создана пользовательского интерфейса и кода для `UserInformation.aspx` страницы в момент, но сначала давайте поговорим о том, как программно изменить пользователя заблокирована и утвержденные состояния. [ `MembershipUser` Класса](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx) имеет [ `IsLockedOut` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx) и [ `IsApproved` свойства](https://msdn.microsoft.com/library/system.web.security.membershipuser.isapproved.aspx). `IsLockedOut` Свойство доступно только для чтения. Отсутствует механизм для программно блокировки пользователя. Чтобы разблокировать пользователя, используйте `MembershipUser` класса [ `UnlockUser` метод](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx). `IsApproved` Свойство доступно для чтения и записи. Чтобы сохранить любые изменения этого свойства, нам потребуется вызвать `Membership` класса [ `UpdateUser` метод](https://msdn.microsoft.com/library/system.web.security.membership.updateuser.aspx), передав в измененной `MembershipUser` объекта.

Поскольку `IsApproved` свойство доступно для чтения и записи, элемент управления CheckBox, скорее всего, является лучшим элемента пользовательского интерфейса по настройке этого свойства. Тем не менее, флажок не будет работать для `IsLockedOut` свойства так, как администратор не может заблокировать пользователя, она может разблокировать только пользователь. Подходящий пользовательский интерфейс для `IsLockedOut` свойство — это кнопка, при нажатии разблокировки учетной записи пользователя. Нажмите эту кнопку следует включить только в том случае, если пользователь заблокирован.

### <a name="creating-theuserinformationaspxpage"></a>Создание`UserInformation.aspx`страницы

Теперь все готово для реализации пользовательского интерфейса в `UserInformation.aspx`. Открыть эту страницу и добавьте следующие веб-элементов управления:

- Элемент управления гиперссылки, при щелчке возвращает администратору `ManageUsers.aspx` страницы.
- Веб-управления Label для отображения имени выбранного пользователя. Задать эту метку `ID` для `UserNameLabel` и очистить его `Text` свойство.
- Элемент управления CheckBox с именем `IsApproved`. Задайте его `AutoPostBack` свойства `true`.
- Элемент управления "Метка" для отображения пользователя последнего пользователя заблокирована даты. Имя этой метки `LastLockedOutDateLabel` и очистить его `Text` свойство.
- Кнопка для разблокировки пользователя. Имя этой кнопки `UnlockUserButton` и задайте его `Text` свойство пользователю «разблокировать».
- Элемент управления Label, для отображения сообщений о состоянии, такие как «состояние утверждения пользователя обновлена.» Имя этого элемента управления `StatusMessage`снимите out его `Text` и установите его `CssClass` свойства `Important`. ( `Important` Определяется класс CSS в `Styles.css` файла таблицы стилей, соответствующий текст отображается шрифтом больших, красный.)

После добавления этих элементов управления, режиме конструктора в Visual Studio должен выглядеть примерно на показанную на рисунке 2.


[![Создание пользовательского интерфейса для UserInformation.aspx](unlocking-and-approving-user-accounts-cs/_static/image5.png)](unlocking-and-approving-user-accounts-cs/_static/image4.png)

**На рисунке 2**: Создание пользовательского интерфейса для `UserInformation.aspx` ([Просмотр полноразмерное изображение](unlocking-and-approving-user-accounts-cs/_static/image6.png))


С помощью полного пользовательского интерфейса теперь нам является установка `IsApproved` флажки и другие элементы управления на основе выбранного пользователя сведений. Создайте обработчик событий для этой страницы `Load` событий и добавьте следующий код:

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample1.cs)]

Приведенный выше код запускает за счет того, что это первом посещении страницы и не последующую обратную передачу. Затем считывает имя пользователя, передаваемые через `user` поля строки запроса и извлекает сведения об этой учетной записи пользователя через `Membership.GetUser(username)` метод. Если нет имени пользователя был предоставлен через строку запроса, или если не удается найти указанного пользователя, администратор отправляется `ManageUsers.aspx` страницы.

`MembershipUser` Объекта `UserName` значение отображается в `UserNameLabel` и `IsApproved` флажок на основе `IsApproved` значение свойства.

`MembershipUser` Объекта [ `LastLockoutDate` свойство](https://msdn.microsoft.com/library/system.web.security.membershipuser.lastlockoutdate.aspx) возвращает `DateTime` значение, указывающее, когда пользователь последний раз заблокирована. Если пользователь никогда не был заблокирован, возвращаемое значение зависит от поставщика членства. При создании новой учетной записи `SqlMembershipProvider` задает `aspnet_Membership` таблицы `LastLockoutDate` на `1754-01-01 12:00:00 AM`. Этот код отображает пустую строку в `LastLockoutDateLabel` Если `LastLockoutDate` свойство предшествует год 2000, в противном случае — часть даты `LastLockoutDate` свойство отображается в метке. `UnlockUserButton'` s `Enabled` свойству пользователя заблокирована состояния, это означает, что эта кнопка будет включить, только если пользователь заблокирован.

Теперь пора проверить `UserInformation.aspx` страницу в обозревателе. Конечно, необходимо начать с `ManageUsers.aspx` и выберите учетную запись пользователя для управления. После поступающих в `UserInformation.aspx`, обратите внимание, что `IsApproved` флажок проверяется только в том случае, если пользователь утвердил. Если пользователь никогда не был заблокирован, отображается заблокирована Дата последней. Кнопки разблокировки пользователя становится доступен только в том случае, если пользователь в данный момент заблокирована. Устанавливая или снимая `IsApproved` CheckBox или нажав кнопку Разблокировать пользователя вызывает обратную передачу, но не было изменений учетной записи пользователя, так как еще не знаем Создание обработчиков событий для этих событий.

Вернитесь в Visual Studio и создания обработчиков событий для `IsApproved` элемента CheckBox `CheckedChanged` событий и `UnlockUser` кнопки `Click` событий. В `CheckedChanged` пользователя задать обработчик событий `IsApproved` свойства `Checked` свойство элемента управления CheckBox, а затем сохраните изменения через вызов `Membership.UpdateUser`. В `Click` обработчик событий, просто вызов `MembershipUser` объекта `UnlockUser` метод. В обоих обработчиков событий, отображают подходящее сообщение в `StatusMessage` метки.

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample2.cs)]

### <a name="testing-theuserinformationaspxpage"></a>Тестирование`UserInformation.aspx`страницы

С помощью этих обработчиков событий в месте посещении страницы и неутвержденных пользователя. Как показано на рис. 3, вы увидите его краткое сообщение на странице, указывающий, что пользователь `IsApproved` успешно изменено свойство.


[![Крис был неутвержденного](unlocking-and-approving-user-accounts-cs/_static/image8.png)](unlocking-and-approving-user-accounts-cs/_static/image7.png)

**Рис. 3**: Крис был неутвержденного ([Просмотр полноразмерное изображение](unlocking-and-approving-user-accounts-cs/_static/image9.png))


Далее выхода из системы и попробуйте войти в систему как пользователь, учетная запись которого был только что неутвержденных. Поскольку пользователь не утвержден, они не смогут войти. По умолчанию элемент управления входа отображает то же сообщение, если пользователь не может войти в систему, независимо от причины. Однако в <a id="Tutorial6"> </a> [ *проверка пользователя учетные данные от членства пользователя магазином* ](../membership/validating-user-credentials-against-the-membership-user-store-cs.md) учебника мы рассматривали усовершенствование управления Login для отображения сообщения более подходящим. Как показано на рис. 4, Крис отображается сообщение о том, что он не может выполнить вход, так как его учетная запись еще не утвержденные.


[![Крис невозможно из-за His является учетная запись входа неутвержденного](unlocking-and-approving-user-accounts-cs/_static/image11.png)](unlocking-and-approving-user-accounts-cs/_static/image10.png)

**Рис. 4**: Крис невозможно из-за His является учетная запись входа неутвержденного ([Просмотр полноразмерное изображение](unlocking-and-approving-user-accounts-cs/_static/image12.png))


Чтобы проверить функцию заблокированной, попытайтесь войти в систему как пользователь с утвержденных, но использовать неправильный пароль. Повторите эти действия нужное количество раз, пока учетная запись пользователя была заблокирована. Элемент управления входа также был изменен для отображения пользовательского сообщения, если выполнить вход с помощью заблокированной учетной записи. Вы знаете, что учетную запись была заблокирована после начала отображается следующее сообщение на страницу входа: «Ваша учетная запись заблокирована из-за слишком большого числа попыток недопустимое имя для входа. Обратитесь к администратору, чтобы настроить учетную запись разблокирована.»

Вернитесь к `ManageUsers.aspx` и щелкните ссылку "Управление" для заблокированной пользователя. Как показано на рисунке 5, вы увидите значение в `LastLockedOutDateLabel` кнопки разблокировки пользователя должен быть включен. Чтобы разблокировать учетную запись пользователя, нажмите кнопку Разблокировать пользователя. После разблокирования пользователя, он сможет войти в систему.


[![Dave блокирована система](unlocking-and-approving-user-accounts-cs/_static/image14.png)](unlocking-and-approving-user-accounts-cs/_static/image13.png)

**Рис. 5**: Dave имеет были заблокированы из системы ([Просмотр полноразмерное изображение](unlocking-and-approving-user-accounts-cs/_static/image15.png))


## <a name="step-2-specifying-new-users-approved-status"></a>Шаг 2: Указание новых пользователей утвержденные состояния

Состояние утверждения полезен в ситуациях, где нужно какие-либо действия, выполняемые до нового пользователя может войти в систему и доступ к функциям пользовательские веб-узла. Например может выполняться частного веб-сайта, где все страницы, за исключением страницы входа и регистрации, доступны только пользователям, прошедшим проверку. Но что произойдет, если незнакомого достигает веб-сайте обнаруживает на страницу регистрации и создает учетную запись? Чтобы предотвратить возникновение этой ситуации можно переместить на страницу регистрации для `Administration` папки и вручную создать каждой учетной записи администратора. Кроме того можно разрешить всем пользователям организации доступа к Интернету, но запретить доступ к узлу, пока администратор не утвердит учетной записи пользователя.

По умолчанию элемента управления CreateUserWizard утверждает новые учетные записи. Можно настроить это поведение, с помощью элемента управления [ `DisableCreatedUser` свойства](https://msdn.microsoft.com/en-gb/library/system.web.ui.webcontrols.createuserwizard.disablecreateduser.aspx). Присвойте этому свойству значение `true` не утверждение новых учетных записей пользователей.

> [!NOTE]
> По умолчанию элемента управления CreateUserWizard автоматический вход в систему новой учетной записи пользователя. Это поведение определяется элемент управления [ `LoginCreatedUser` свойства](https://msdn.microsoft.com/en-gb/library/system.web.ui.webcontrols.createuserwizard.logincreateduser.aspx). Поскольку неутвержденных пользователи не смогут войти на сайт при `DisableCreatedUser` — `true` учетной записи пользователя не выполнил вход в сайте, независимо от значения `LoginCreatedUser` свойство.


Если программно создается новых учетных записей пользователей через `Membership.CreateUser` способа, чтобы создать учетную запись пользователя неутвержденных используйте одну из перегрузок, принимающих новый пользователь `IsApproved` значение свойства в качестве входного параметра.

## <a name="step-3-approving-users-by-verifying-their-email-address"></a>Шаг 3: Утверждение пользователей путем проверки адреса электронной почты

Многие веб-сайты, которые поддерживают учетные записи пользователей не утверждение новых пользователей, пока они проверить адрес электронной почты, которые они предоставленное при регистрации. Чтобы исключить возможность программы-роботы нежелательных сообщений и других несознательные требуется адрес электронной почты уникальным, проверенных и добавляет дополнительный этап в процессе подписки обычно используется процесс проверки. В этой модели когда новый пользователь регистрируется они отправляются сообщения электронной почты, содержащее ссылку на страницу проверки. Ссылка на сайте пользователя оказалось, они получают сообщение электронной почты и, таким образом, что адрес электронной почты, предоставленный является допустимым. Страница «Проверка» отвечает за утверждение пользователя. Это возможно автоматически, тем самым утверждение любой пользователь, который достигает эту страницу, или только в том случае, если пользователь приведены дополнительные сведения, такие как [CAPTCHA](http://en.wikipedia.org/wiki/Captcha).

Чтобы выполнить этот рабочий процесс, необходимо сначала обновить страница создания учетной записи таким образом, неутвержденных новых пользователей. Откройте `EnhancedCreateUserWizard.aspx` страницы в `Membership` папки и набора управления CreateUserWizard `DisableCreatedUser` свойства `true`.

Далее нам нужно настроить элемент управления CreateUserWizard для отправки сообщения электронной почты с инструкциями о том, как проверить его учетную запись нового пользователя. В частности, будет включать ссылку в сообщении электронной почты для `Verification.aspx` страницы (который еще не знаем создать), передавая новый пользователь `UserId` через строку запроса. `Verification.aspx` Страница будет найти указанного пользователя и пометить их утверждения.

### <a name="sending-a-verification-email-to-new-users"></a>Отправка письмо с подтверждением новым пользователям

Чтобы отправить сообщение электронной почты из элемента управления CreateUserWizard, настройте его `MailDefinition` свойство соответствующим образом. Как было сказано в <a id="Tutorial13"> </a> [с предыдущим учебником](recovering-and-changing-passwords-cs.md), элементы управления ChangePassword и PasswordRecovery включают [ `MailDefinition` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.maildefinition.aspx) , работает так же, как CreateUserWizard элемента управления.

> [!NOTE]
> Для использования `MailDefinition` свойства, необходимо указать доставки почты параметры в `Web.config`. Дополнительные сведения см. в [отправки электронной почты в ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx).


Для начала необходимо создать новый шаблон электронной почты с именем `CreateUserWizard.txt` в `EmailTemplates` папки. Для шаблона, используйте следующий текст:

[!code-aspx[Main](unlocking-and-approving-user-accounts-cs/samples/sample3.aspx)]

Задать `MailDefinition'` s `BodyFileName` свойства «~ / EmailTemplates/CreateUserWizard.txt» и его `Subject` свойства «вас приветствует веб-узел! Активируйте вашей учетной записи.»

Обратите внимание, что `CreateUserWizard.txt` шаблона сообщения электронной почты содержит `<%VerificationUrl%>` заполнителя. Это место, куда URL-адрес `Verification.aspx` страницы будут размещены. Автоматически заменяет CreateUserWizard `<%UserName%>` и `<%Password%>` местозаполнителей новой учетной записи имя пользователя и пароль, но нет встроенного `<%VerificationUrl%>` заполнитель. Необходимо вручную заменить его на соответствующие URL-адрес.

Чтобы сделать это, создайте обработчик событий для CreateUserWizard [ `SendingMail` событие](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.sendingmail.aspx) и добавьте следующий код:

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample4.cs)]

`SendingMail` Событие запускается после `CreatedUser` события, это означает, что к моменту выше обработчик событий выполняет нового пользователя учетной записи уже был создан. Можно обратиться к имени нового пользователя `UserId` , вызвав `Membership.GetUser` метод, передавая `UserName` введенные в элемент управления CreateUserWizard. Затем формируется проверочный URL-адрес. Инструкция `Request.Url.GetLeftPart(UriPartial.Authority)` возвращает `http://yourserver.com` часть URL-адреса; `Request.ApplicationPath` возвращает путь к корневым для приложения. Проверка URL-адрес затем определяется как `Verification.aspx?ID=userId`. Затем эти две строки объединяются для формирования полного URL-адреса. Наконец, текст сообщения электронной почты (`e.Message.Body`) содержит все вхождения `<%VerificationUrl%>` заменен на полный URL-адрес.

В итоге получается, что новые пользователи неутвержденных, это означает, что они не могут войти на сайт. Кроме того, они автоматически отправляются сообщение электронной почты со ссылкой на URL-адрес для проверки (см. рис. 6).


[![Новый пользователь получает сообщение электронной почты со ссылкой на URL-адрес проверки](unlocking-and-approving-user-accounts-cs/_static/image17.png)](unlocking-and-approving-user-accounts-cs/_static/image16.png)

**Рис. 6**: новый пользователь получает сообщение электронной почты со ссылкой на URL-адрес проверки ([Просмотр полноразмерное изображение](unlocking-and-approving-user-accounts-cs/_static/image18.png))


> [!NOTE]
> Этап CreateUserWizard управления CreateUserWizard по умолчанию отображается сообщение, информирующее пользователя свою учетную запись будет создана и отображает кнопки продолжения. При нажатии этой кнопки перехода пользователя на URL-адрес, указанный с помощью элемента управления `ContinueDestinationPageUrl` свойство. CreateUserWizard в `EnhancedCreateUserWizard.aspx` настроен на отправку новых пользователей `~/Membership/AdditionalUserInfo.aspx`, который запросит у пользователя их место рождения, URL-адрес домашней страницы и подписи. Поскольку эти сведения можно добавить только по системе работают пользователи, смысл обновлять это свойство для отправки пользователям домашнюю страницу веб-узла (`~/Default.aspx`). Кроме того `EnhancedCreateUserWizard.aspx` страницы или шаг CreateUserWizard должны дополнять пользователя о том, что они отправлено письмо с подтверждением, и не активировалось свою учетную запись, пока они следуйте инструкциям в этом сообщении электронной почты. Я оставить эти изменения в качестве упражнения для модуля чтения.


### <a name="creating-the-verification-page"></a>Создание страницы проверки

Наш окончательной задачи является создание `Verification.aspx` страницы. Добавьте эту страницу в корневую папку, сопоставляя его с `Site.master` главной страницы. Как мы сделали с большинством предыдущей страницы содержимого, добавляются к сайту, удалите элемент управления содержимым, который ссылается на `LoginContent` ContentPlaceHolder таким образом, страницы содержимого использовал главной страницы по умолчанию содержимого.

Добавить элемент управления Label Web `Verification.aspx` задайте его `ID` для `StatusMessage` и очистить его свойства text. Создайте `Page_Load` обработчик событий и добавьте следующий код:

[!code-csharp[Main](unlocking-and-approving-user-accounts-cs/samples/sample5.cs)]

Большая часть приведенный выше код проверяет, что `UserId` предоставленных через строку запроса существует, что он является допустимым `Guid` значение, и оно ссылается на существующую учетную запись пользователя. Если все эти проверки передачи, утверждения учетной записи пользователя; в противном случае отображается сообщение о состоянии подходящий.

На рисунке 7 показано `Verification.aspx` страницы при посещении через браузер.


[![Учетная запись нового пользователя — теперь утверждения](unlocking-and-approving-user-accounts-cs/_static/image20.png)](unlocking-and-approving-user-accounts-cs/_static/image19.png)

**Рис. 7**: учетная запись нового пользователя — теперь утверждения ([Просмотр полноразмерное изображение](unlocking-and-approving-user-accounts-cs/_static/image21.png))


## <a name="summary"></a>Сводка

Все учетные записи пользователей имеют два состояния, которые определяют, может ли пользователь войти на сайт: `IsLockedOut` и `IsApproved`. Оба эти свойства должны быть `true` для пользователя с именем входа.

Пользователь заблокирован состояние используется в качестве меры безопасности для снижения вероятности остановом сайта через методы подбора злоумышленником. В частности, пользователь будет заблокирован, если существует несколько попыток недопустимое имя для входа в пределах определенного периода времени. Эти границы настраиваются с помощью параметров поставщика членства в `Web.config`.

Состояние утверждения часто используется как средство запретить новым пользователям войти в систему, пока не будет задан какое-либо действие. Возможно узлу требуется сначала SYSVOL новые учетные записи с разрешениями или, как было показано в шаге 3, проверяя свой адрес электронной почты.

Программирование довольны!

### <a name="about-the-author"></a>Об авторе

Скотт Митчелл, автор нескольких ASP/ASP.NET и основатель 4GuysFromRolla.com, работает с веб-технологиями Майкрософт с 1998 года. Скотт — независимый консультант, trainer и записи. Его последняя книга —  *[диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*. Скотт может быть достигнута по [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) или через его блог по [ http://ScottOnWriting.NET ](http://scottonwriting.net/).

### <a name="special-thanks-to"></a>Особая благодарность

Этот учебник ряд прошел проверку многие полезные рецензентов. Объясняются моих последующих статей для MSDN? Если Да, напишите мне по [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](recovering-and-changing-passwords-cs.md)
> [Вперед](building-an-interface-to-select-one-user-account-from-many-vb.md)
