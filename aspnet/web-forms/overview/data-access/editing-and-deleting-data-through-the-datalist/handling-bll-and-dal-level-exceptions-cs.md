---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-cs
title: Обработка исключений уровня DAL и уровень бизнес-ЛОГИКИ (C#) | Документы Microsoft
author: rick-anderson
description: В этом учебнике будет рассмотрена tactfully обработки исключений, возникающих во время обновления рабочего процесса для редактирования DataList.
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/30/2006
ms.topic: article
ms.assetid: f8fd58e2-f932-4f08-ab3d-fbf8ff3295d2
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-cs
msc.type: authoredcontent
ms.openlocfilehash: fd88260e1ac941b053aae8b4e500a7ab5f3091a1
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="handling-bll--and-dal-level-exceptions-c"></a>Обработка исключений уровня DAL и уровень бизнес-ЛОГИКИ (C#)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить пример приложения](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_CS.exe) или [скачать PDF](handling-bll-and-dal-level-exceptions-cs/_static/datatutorial38cs1.pdf)

> В этом учебнике будет рассмотрена tactfully обработки исключений, возникающих во время обновления рабочего процесса для редактирования DataList.


## <a name="introduction"></a>Вступление

В [Общие сведения об изменении и удалении данных в DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) учебнике мы создали DataList, предлагаемых простое изменение и удаление возможностей. Хотя полностью функциональны он вряд ли удобной для пользователей, как любой ошибки, возникшей во время изменения или процесс удаления привело к возникновению необработанного исключения. Например, имя продукта s или, при изменении продукта, введите значение цены за очень недорогим!, приводит к возникновению исключения. Так как это исключение не обработано в коде, он поднимает до среды выполнения ASP.NET, которая затем отображает сведения об исключении s в веб-странице.

Как мы видели в [обработки уровень бизнес-ЛОГИКИ и исключения уровня DAL на странице ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) учебник, если исключение создается из глубин бизнес-логику или уровней доступа к данным, сведения об исключении возвращаются в элемент управления ObjectDataSource и затем к GridView. Мы узнали, как для правильной обработки этих исключений путем создания `Updated` или `RowUpdated` обработчики событий для ObjectDataSource или GridView, проверка для исключения, а затем, указывающее, что исключение было обработано.

DataList учебные видеоматериалы, однако нельзя t с использованием ObjectDataSource для обновления и удаления данных. Мы работаем непосредственно для МЕТОДА. Чтобы обнаружить исключения, исходящие от уровень бизнес-ЛОГИКИ или DAL, необходимо реализовать код внутри кода нашу страницу ASP.NET обработки исключений. В этом учебнике будет рассмотрена более tactfully обработки исключений, возникающих во время редактирования s DataList обновление рабочего процесса.

> [!NOTE]
> В *Обзор редактирование и удаление данных в DataList* учебнике мы рассмотрели разных методов изменения и удаления данных из DataList некоторые методы, связана с использованием ObjectDataSource для обновления и удаление. Если вы применяете эти методы, можно обрабатывать исключения из МЕТОДА или DAL через ObjectDataSource s `Updated` или `Deleted` обработчики событий.


## <a name="step-1-creating-an-editable-datalist"></a>Шаг 1: Создание редактируемых DataList

Прежде чем мы беспокоиться об обработке исключений, возникающих во время обновления рабочего процесса, позволяют s сначала создать редактируемый DataList. Откройте `ErrorHandling.aspx` страницы в `EditDeleteDataList` набор папок, добавьте в конструктор DataList его `ID` свойства `Products`, и добавьте новый элемент управления ObjectDataSource с именем `ProductsDataSource`. Настройка ObjectDataSource для использования `ProductsBLL` класса s `GetProducts()` записывает метод выбора, задайте в инструкции INSERT, UPDATE, раскрывающиеся списки и удалять вкладки (нет).


[![Возвращает сведения о продукте, с помощью метода GetProducts()](handling-bll-and-dal-level-exceptions-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-cs/_static/image1.png)

**Рис. 1**: возвращать сведения о продукта с помощью `GetProducts()` метод ([Просмотр полноразмерное изображение](handling-bll-and-dal-level-exceptions-cs/_static/image3.png))


После завершения работы мастера ObjectDataSource Visual Studio автоматически создает `ItemTemplate` для DataList. Введите здесь с `ItemTemplate` , отображает каждый s имя и цену продукта, а также кнопку "Изменить". Создайте `EditItemTemplate` с веб-управления TextBox для имени и цена и кнопок "обновления" и "Отмена". Задайте в DataList s `RepeatColumns` равным 2.

После внесения этих изменений на страницу s должна выглядеть следующим образом. Следует внимательно убедитесь, что изменения в "Отмена", и обновление кнопок их `CommandName` набор свойств для редактирования, Отмена и обновление, соответственно.


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample1.aspx)]

> [!NOTE]
> В этом учебнике DataList s состояния просмотра должна быть включена.


Теперь пора просмотрите ход работы через браузер (см. рис. 2).


[![Каждый продукт включает кнопку «Изменить»](handling-bll-and-dal-level-exceptions-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-cs/_static/image4.png)

**На рисунке 2**: каждый продукт включает кнопку Изменить ([Просмотр полноразмерное изображение](handling-bll-and-dal-level-exceptions-cs/_static/image6.png))


В настоящее время кнопка правки только вызывает обратную передачу его t еще делают этот продукт для редактирования. Чтобы включить редактирование, нам нужно создавать обработчики событий для DataList s `EditCommand`, `CancelCommand`, и `UpdateCommand` события. `EditCommand` И `CancelCommand` события достаточно обновить DataList s `EditItemIndex` свойство и повторную привязку данных к элементу управления DataList:


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample2.cs)]

`UpdateCommand` Немного сложнее обработчика событий. Его требуется считать продукта s `ProductID` из `DataKeys` коллекции вместе с s имя и цену продукта из текстовых полей в `EditItemTemplate`, а затем вызвать `ProductsBLL` класса s `UpdateProduct` метод перед возвратом DataList в состояние до редактирования.

Теперь позволяют s просто использовать именно тот же код из `UpdateCommand` обработчик событий в *Общие сведения об изменении и удалении данных в DataList* учебника. Мы добавим код для правильной обработки исключений в шаге 2.


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample3.cs)]

В случае недопустимых входных данных которого может быть в форме неправильно отформатированный цена, недопустимая единица цены, например - 5,00 или заменяют s название продукта, будет вызвано исключение. Поскольку `UpdateCommand` обработчик событий не включает все на этом этапе код обработки исключения, исключение будет передано ASP.NET во время выполнения, где будет отображаться для конечного пользователя (см. рис. 3).


![При возникновении необработанного исключения, конечный пользователь видит страницу ошибки](handling-bll-and-dal-level-exceptions-cs/_static/image7.png)

**Рис. 3**: при возникновении необработанного исключения, конечный пользователь видит страницу ошибки


## <a name="step-2-gracefully-handling-exceptions-in-the-updatecommand-event-handler"></a>Шаг 2: Корректно обработка исключений в обработчике событий UpdateCommand

Во время обновления рабочего процесса, исключения могут возникать в `UpdateCommand` обработчик событий, уровень бизнес-ЛОГИКИ или DAL. Например, если пользователь вводит ценой слишком много ресурсов, `Decimal.Parse` инструкции в `UpdateCommand` обработчик событий вызывает исключение `FormatException` исключение. Если пользователь опустил s имя продукта или цену имеет отрицательное значение, МЕТОД вызовет исключение.

При возникновении исключения необходимо отобразить информационное сообщение внутри самой страницы. Добавление метки веб-элемент управления на страницу `ID` равно `ExceptionDetails`. Настройка метки s текст, отображаемый красным, очень большой, полужирный и курсивный шрифт, назначив его `CssClass` свойства `Warning` класс CSS, который определен в `Styles.css` файла.

При возникновении ошибки нам нужен только метку, которая должна отображаться один раз. То есть при последующих обратных передачах предупреждающее сообщение подписи s должна исчезнуть. Это можно сделать, сняв out метки s `Text` свойства или параметры его `Visible` свойства `False` в `Page_Load` обработчик событий (как это делалось в [обработки уровень бизнес-ЛОГИКИ и уровня DAL исключений в среде ASP Страница .NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) учебника) или путем отключения поддержки состояния представления метки s. Разрешить s второй вариант следует использовать.


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample4.aspx)]

При возникновении исключения, мы будем назначить сведения исключения, чтобы `ExceptionDetails` метки элемента управления s `Text` свойство. Так как состояние просмотра отключено, при последующих обратных передачах `Text` свойство s программного изменения будут потеряны, вернитесь к текст по умолчанию (пустая строка), таким образом скрывая предупреждающее сообщение.

Чтобы определить, когда возникает ошибка для отображения на странице отображается информационное сообщение, необходимо добавить `Try ... Catch` блока `UpdateCommand` обработчика событий. `Try` Часть содержит код, который может привести к возникновению исключения при `Catch` блок содержит код, выполняемый при возникновении исключения. Извлечение [основы обработки исключений](https://msdn.microsoft.com/library/2w8f0bss.aspx) раздела документации по .NET Framework для получения дополнительной информации о `Try ... Catch` блока.


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample5.cs)]

При любого типа, создается исключение, код внутри `Try` блока `Catch` начинается выполнение блоков кода. Тип исключения, создаваемое `DbException`, `NoNullAllowedException`, `ArgumentException`и т. д., зависит, какие именно, ставшее причиной ошибки в первую очередь. Если существует проблема s на уровне базы данных, `DbException` будет создано. Если указано недопустимое значение для `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, или `ReorderLevel` поля, `ArgumentException` будет создаваться, как был добавлен код для проверки значений этих полей в `ProductsDataTable` класса (см. [ Создание бизнес-логики](../introduction/creating-a-business-logic-layer-cs.md) учебника).

Мы можем предоставить дополнительные пояснения конечному пользователю на основе типа обнаружено исключение текст сообщения. Следующий код, который использовался в почти те же форму обратно в [обработки уровень бизнес-ЛОГИКИ и исключения уровня DAL на странице ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) учебник такой уровень детализации:


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample6.cs)]

Для выполнения заданий данного учебника, просто вызовите `DisplayExceptionDetails` метод `Catch` блока, передавая на Перехваченный `Exception` экземпляра (`ex`).

С `Try ... Catch` блока в месте, пользователи получают сообщение более подробное сообщение об ошибке, как данные 4 и 5 Показать. Обратите внимание, что при возникновении исключения DataList остается в режиме редактирования. Это так, как при возникновении исключения, поток управления немедленно перенаправлены в `Catch` блока, минуя код, который возвращается в состояние до редактирования DataList.


[![Сообщение об ошибке отображается, если пользователь опускает необходимые поля](handling-bll-and-dal-level-exceptions-cs/_static/image9.png)](handling-bll-and-dal-level-exceptions-cs/_static/image8.png)

**Рис. 4**: сообщение об ошибке отображается, если пользователь опускает необходимые поля ([Просмотр полноразмерное изображение](handling-bll-and-dal-level-exceptions-cs/_static/image10.png))


[![— Сообщение об ошибке отображается при вводе отрицательного цены](handling-bll-and-dal-level-exceptions-cs/_static/image12.png)](handling-bll-and-dal-level-exceptions-cs/_static/image11.png)

**Рис. 5**: является сообщение об ошибке отображается при вводе отрицательного цены ([Просмотр полноразмерное изображение](handling-bll-and-dal-level-exceptions-cs/_static/image13.png))


## <a name="summary"></a>Сводка

GridView и ObjectDataSource предоставить обработчики, содержащие сведения о любые исключения, возникшие при выполнении рабочего процесса обновления и удаления, а также свойства, которые могут содержать значение, указывающее, было ли исключение обработано. Эти функции, однако недоступны при работе с DataList и непосредственно с помощью МЕТОДА. Вместо этого мы отвечают за реализации обработки исключений.

В этом учебнике мы узнали, как добавить обработку исключений для редактирования s DataList обновлении рабочего процесса путем добавления `Try ... Catch` блока `UpdateCommand` обработчика событий. Если исключение возникает во время обновления рабочего процесса, `Catch` блоков кода выполняется отображение полезную информацию в `ExceptionDetails` метки.

На этом этапе DataList делает не пытается предотвратить исключения в первую очередь. Несмотря на то, что мы знаем, что приведет к отрицательным цена исключение, нам не удалось t еще добавлены функциональные возможности для эффективного устранения пользователя вводить такие недопустимые входные данные. В нашем следующем уроке будет рассмотрена с целью сокращения исключения, вызванные пользователем недопустимые данные путем добавления элементов управления проверки в `EditItemTemplate`.

Программирование довольны!

## <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, рассматриваемые в этом учебнике см. в следующих ресурсах:

- [Правила разработки исключений](https://msdn.microsoft.com/library/ms298399.aspx)
- [Модули ведения журнала ошибок и обработчики (ELMAH)](http://workspaces.gotdotnet.com/elmah) (библиотека открытым исходным кодом для ведения журнала ошибок)
- [Enterprise Library для .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (включает блок управления исключений)

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года. Скотт — независимый консультант, trainer и записи. Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).

## <a name="special-thanks-to"></a>Благодарности

Этот учебник ряд прошел проверку многие полезные рецензентов. Основной рецензент этого учебника было Алексей Pespisa. Объясняются моих последующих статей для MSDN? Если Да, напишите мне по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](performing-batch-updates-cs.md)
> [Вперед](adding-validation-controls-to-the-datalist-s-editing-interface-cs.md)
