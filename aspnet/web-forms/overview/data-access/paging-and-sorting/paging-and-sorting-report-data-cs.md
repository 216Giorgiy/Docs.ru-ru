---
uid: web-forms/overview/data-access/paging-and-sorting/paging-and-sorting-report-data-cs
title: "Разбиение по страницам и сортировка данных (C#) | Документы Microsoft"
author: rick-anderson
description: "Разбиение по страницам и сортировка – две часто встречающиеся функции отображения данных в приложение электронной. В этом учебнике перейти на первый взгляд на добавление сортировки и..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/15/2006
ms.topic: article
ms.assetid: 811a6ef2-ec66-4c8e-a089-6f795056e288
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting/paging-and-sorting-report-data-cs
msc.type: authoredcontent
ms.openlocfilehash: fd365ca3ae8e832e368fa4c29c33af8a42cf41d2
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="paging-and-sorting-report-data-c"></a>Разбиение по страницам и сортировка данных отчета (C#)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить пример приложения](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_24_CS.exe) или [скачать PDF](paging-and-sorting-report-data-cs/_static/datatutorial24cs1.pdf)

> Разбиение по страницам и сортировка – две часто встречающиеся функции отображения данных в приложение электронной. В этом учебнике мы ознакомитесь первый Добавление сортировки и упорядочения к отчетам, которые будут созданы позднее в будущих учебниках.


## <a name="introduction"></a>Вступление

Разбиение по страницам и сортировка – две часто встречающиеся функции отображения данных в приложение электронной. Например при поиске книг по ASP.NET в Интернет-магазине, могут существовать сотни книг, но отчет с результатами поиска только десять совпадениями на каждой странице. Кроме того можно сортировать результаты по title, цена, количество страниц, имя автора и т. д. Хотя в предыдущих 23 учебных рассмотрели способ построения разнообразные отчеты, включая интерфейсы, позволяющие Добавление, изменение и удаление данных, мы хранять не рассматривались как сортировать данные и только разбиение по страницам примеры мы видели хранять проработали DetailsView и FormView элементы управления.

В этом учебнике будет показано, как добавить, сортировку и разбиение по страницам к отчетам, которые можно выполнить, установив флажки несколько просто. К сожалению это упрощенная реализация имеет свои недостатки, когда интерфейс сортировки покидает почти все необходимое, а процедуры разбиения на страницы не предназначены для эффективного просмотра больших результирующих наборов. Том, как преодолеть ограничения out-of--box разбиение по страницам и сортировка решения будут посвящены следующие учебники.

## <a name="step-1-adding-the-paging-and-sorting-tutorial-web-pages"></a>Шаг 1: Добавление разбиением по страницам и сортировка учебника веб-страницы

Прежде чем начать этого учебника, позволяют курсом для добавления страниц ASP.NET, которые потребуются для этого учебника и трех последующих s. Начните с создания новой папки в проект с именем `PagingAndSorting`. Добавьте пять страниц ASP.NET в этой папке, в которых настроен на использование главной страницы `Site.master`:

- `Default.aspx`
- `SimplePagingSorting.aspx`
- `EfficientPaging.aspx`
- `SortParameter.aspx`
- `CustomSortingUI.aspx`


![Создание папки PagingAndSorting и добавление страницы учебника по ASP.NET](paging-and-sorting-report-data-cs/_static/image1.png)

**Рис. 1**: Создание папки PagingAndSorting и добавление страницы учебника по ASP.NET


Затем откройте `Default.aspx` страницы и перетащите `SectionLevelTutorialListing.ascx` пользовательского элемента управления с `UserControls` папку в область конструктора. Этот пользовательский элемент управления, который мы создали [главные страницы и переходов](../introduction/master-pages-and-site-navigation-cs.md) учебник, перечисляет карты узла и отображает руководства, имеющиеся в текущем разделе в виде маркированного списка.


![Добавление Default.aspx SectionLevelTutorialListing.ascx пользовательского элемента управления](paging-and-sorting-report-data-cs/_static/image2.png)

**На рисунке 2**: Добавление Default.aspx SectionLevelTutorialListing.ascx пользовательского элемента управления


Для выполнения в маркированном списке отображались разбиением по страницам и сортировка учебники, которые будут созданы, необходимо добавить их в карту узла. Откройте `Web.sitemap` файл и добавьте следующую разметку после редактирования, вставки и удаления узел карты узла разметки:


[!code-xml[Main](paging-and-sorting-report-data-cs/samples/sample1.xml)]


![Обновление карты сайта для включения новых страниц ASP.NET](paging-and-sorting-report-data-cs/_static/image3.png)

**Рис. 3**: обновление карты сайта для включения новых страниц ASP.NET


## <a name="step-2-displaying-product-information-in-a-gridview"></a>Шаг 2: Отображение сведений о продукте в элементе управления GridView

Прежде чем мы фактически реализовать разбиение по страницам и сортировка возможности, позволяют s сначала создать стандартный не srotable, элемент управления GridView, содержащий сведения о продукте. Это задача мы хранять делал много раз на протяжении этого учебника ряда таким образом, эти действия должны быть знакомы. Сначала откройте `SimplePagingSorting.aspx` страницы и перетащите элемент управления GridView с панели элементов в конструктор, установив его `ID` свойства `Products`. Создайте новый элемент управления ObjectDataSource, использующий класс ProductsBLL s `GetProducts()` для возврата всей информации о продукте.


![Получить сведения обо всех продуктах, с помощью метода GetProducts()](paging-and-sorting-report-data-cs/_static/image4.png)

**Рис. 4**: получение сведений обо всех продуктов, с помощью метода GetProducts()


Поскольку этот отчет является не только для чтения отчет, отсутствует s необходимо сопоставить ObjectDataSource s `Insert()`, `Update()`, или `Delete()` соответствующим методам `ProductsBLL` методов; таким образом, параметр (нет) из раскрывающегося списка для UPDATE, INSERT и удаление вкладок.


![Выберите (нет) в раскрывающемся списке в UPDATE, INSERT и удаление вкладок](paging-and-sorting-report-data-cs/_static/image5.png)

**Рис. 5**: выберите (нет) в раскрывающемся списке в UPDATE, INSERT и удаление вкладок


Далее позволяют настраивать поля s GridView, чтобы отображались только названия продуктов, поставщики, категории, цены и неподдерживаемые статусы s. Кроме того, изменения можно вносить форматирования уровня полей, такие как настройка `HeaderText` или форматирование цены как валюты. После внесения этих изменений к GridView s должна выглядеть следующим образом:


[!code-aspx[Main](paging-and-sorting-report-data-cs/samples/sample2.aspx)]

Рис. 6 показан ход работы сих при просмотре через браузер. Обратите внимание, что странице перечислены все продукты в одном экране с отображением каждого s название продукта, категория, поставщик, цена, неподдерживаемые состояния.


[![Перечислены все продукты](paging-and-sorting-report-data-cs/_static/image7.png)](paging-and-sorting-report-data-cs/_static/image6.png)

**Рис. 6**: каждого продукта перечислены ([Просмотр полноразмерное изображение](paging-and-sorting-report-data-cs/_static/image8.png))


## <a name="step-3-adding-paging-support"></a>Шаг 3: Добавление поддержки разбиения на страницы

Перечисление *все* продуктов на одном экране может привести к перегрузке сведения для пользователя, изучение данных. Чтобы сделать результаты удобнее, мы разбить данные на более мелкие страницы данных и разрешить пользователю пошаговый данных на одной странице за раз. Для выполнения этого просто установите флажок Включить разбиение на страницы в смарт-теге GridView s (это задает GridView s [ `AllowPaging` свойство](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.allowpaging.aspx) для `true`).


[![Установите флажок Включить разбиение на страницы для добавления поддержки разбиения на страницы](paging-and-sorting-report-data-cs/_static/image10.png)](paging-and-sorting-report-data-cs/_static/image9.png)

**Рис. 7**: флажок Включить разбиение на страницы для добавления поддержки разбиения на страницы ([Просмотр полноразмерное изображение](paging-and-sorting-report-data-cs/_static/image11.png))


Включение разбиения ограничивает количество записей, отображаемых на одной странице и добавляет *интерфейса постраничного просмотра* к GridView. Интерфейс разбиения на страницы по умолчанию показано на рисунке 7 — это последовательность номеров страниц, чтобы пользователи могли быстро переходить от одной страницы данных к другой. Этот интерфейс постраничного просмотра должна быть знакома, как мы хранять рассматривался при добавлении поддержки разбиения по страницам для элементов управления DetailsView и FormView в предыдущих учебниках.

DetailsView и FormView отображают только одной записи на каждой странице. GridView, обращается его [ `PageSize` свойство](https://msdn.microsoft.com/en-US/library/system.web.ui.webcontrols.gridview.pagesize.aspx) для определения количества записей, отображаемых на странице (это свойство по умолчанию значение 10).

Этот интерфейс постраничного просмотра s GridView, DetailsView и FormView можно настроить с помощью следующих свойств:

- `PagerStyle`Указывает сведения о стиле для интерфейса разбиения на страницы; можно указать параметры, например `BackColor`, `ForeColor`, `CssClass`, `HorizontalAlign`, и т. д.
- `PagerSettings`содержит множество свойств, которые могут настраивать функциональные возможности интерфейса постраничного просмотра; `PageButtonCount` указывает максимальное число цифровых номеров страниц отображается в интерфейсе постраничного просмотра (значение по умолчанию — 10); [ `Mode` свойство](https://msdn.microsoft.com/en-US/library/system.web.ui.webcontrols.pagersettings.mode.aspx) показывает, как работает и может быть присвоено интерфейса разбиения на страницы: 

    - `NextPrevious`Показывает кнопок Далее и назад, что позволяет пользователям перемещаться вперед и назад одновременно на одной странице
    - `NextPreviousFirstLast`Помимо кнопок Далее и назад первая и последняя кнопки включены также, чтобы пользователи могли быстро перейти к первой или последней странице данных
    - `Numeric`Отображение ряда номеров страниц, чтобы пользователи могли сразу же перейти к любой странице
    - `NumericFirstLast`Помимо номеров страниц включает первая и последняя кнопки, чтобы пользователи могли быстро перейти к первой или последней странице данных. Первый и последний кнопки отображаются, только если все номера страниц не может поместиться

Кроме того GridView, DetailsView и FormView предлагают `PageIndex` и `PageCount` , обозначающие текущую просматриваемую страницу и общее число страниц данных, соответственно. `PageIndex` Свойства начинается с 0, означающее, что при просмотре первой страницы данных `PageIndex` будет равно 0. `PageCount`, с другой стороны, начинает счет с 1, это значит, что `PageIndex` ограничено до значения в интервале между 0 и `PageCount - 1`.

Разрешить s занять некоторое время, чтобы улучшить внешний вид интерфейса постраничного просмотра s нашей GridView по умолчанию. В частности позволяют s интерфейс разбиения на страницы, по правому краю с светло-серым фоном. Вместо установки этих свойств напрямую через GridView s `PagerStyle` свойства, позволяющие s создать класс CSS в `Styles.css` с именем `PagerRowStyle` , а затем назначьте `PagerStyle` s `CssClass` помощью нашей темы. Сначала откройте `Styles.css` и добавив следующий код CSS определения класса:


[!code-css[Main](paging-and-sorting-report-data-cs/samples/sample3.css)]

Затем откройте `GridView.skin` файла в `DataWebControls` папку внутри `App_Themes` папки. Как уже говорилось в *главные страницы и навигации веб-узла* , файлы обложки можно использовать для указания значения свойств по умолчанию для веб-элемента управления. Поэтому необходимо расширить существующие параметры, чтобы включить параметр `PagerStyle` s `CssClass` свойства `PagerRowStyle`. Кроме того, s позволяют настроить интерфейс разбиения на страницы для отображения не более пяти номерами страниц кнопок с помощью `NumericFirstLast` интерфейс разбиения по страницам.


[!code-aspx[Main](paging-and-sorting-report-data-cs/samples/sample4.aspx)]

## <a name="the-paging-user-experience"></a>Взаимодействие с пользователем разбиения на страницы

На рисунке 8 показана веб-страницы при посещении через браузер после проверки флажок Включить разбиение на страницы GridView s и `PagerStyle` и `PagerSettings` конфигурации были внесены через `GridView.skin` файла. Обратите внимание, как только десять записей отображаются, а интерфейс разбиения по страницам указывает, что просматривается первая страница данных.


[![С включено разбиение по страницам отображаются только подмножество записей за раз](paging-and-sorting-report-data-cs/_static/image13.png)](paging-and-sorting-report-data-cs/_static/image12.png)

**Рис. 8**: С включено разбиение на страницы, отображаются только подмножество записей за раз ([Просмотр полноразмерное изображение](paging-and-sorting-report-data-cs/_static/image14.png))


Когда пользователь выбирает один из номеров страниц в интерфейсе разбиения по страницам, обратная передача и странице перезагружает сообщать, что запрошенный страницы s записей. Рис. 9 показана результаты после включения защиты для просмотра последней странице данных. Обратите внимание, что последней странице имеет только одну запись; Это обусловлено отсутствием 81 записей в итоге приведет к восьми страниц 10 записей на страницы, а также на одной странице с помощью одиночному записи.


[![Щелкните номер страницы вызывает обратную передачу и приводятся соответствующие подмножество записей](paging-and-sorting-report-data-cs/_static/image16.png)](paging-and-sorting-report-data-cs/_static/image15.png)

**Рис. 9**: щелкнув номер страницы вызывает обратную передачу и приводятся соответствующие записи из подмножества ([Просмотр полноразмерное изображение](paging-and-sorting-report-data-cs/_static/image17.png))


## <a name="paging-s-server-side-workflow"></a>Серверный рабочий процесс разбиения на страницы s

Когда пользователь щелкает на кнопке в интерфейсе постраничного просмотра, обратная передача и начинается следующий серверный рабочий процесс:

1. GridView s (или DetailsView или FormView) `PageIndexChanging` события
2. Повторно запрашивает ObjectDataSource *все* данные из МЕТОДА; GridView s `PageIndex` и `PageSize` значения свойств используются для определения записи, возвращаемый из МЕТОДА, должны отображаться в GridView
3. GridView s `PageIndexChanged` события

На шаге 2 ObjectDataSource повторно запрашивает все данные из источника данных. Этот стиль разбиения на страницы, часто называют *разбиения на страницы по умолчанию*, как оно s разбиение по страницам, используемое по умолчанию, при установке `AllowPaging` свойства `true`. По умолчанию просто разбиение по страницам данных веб-элемент управления получает все записи для каждой страницы данных, несмотря на то, что только подмножество записей преобразуется HTML, s, отправляемого в браузер. Если уровень бизнес-ЛОГИКИ или ObjectDataSource кэшируются данные базы данных, разбиение на страницы по умолчанию неработоспособно для очень больших наборов результатов или для веб-приложений с большим количеством одновременных пользователей.

В следующем уроке мы изучим, как реализовать *пользовательское разбиение по страницам*. С пользовательское разбиение по страницам можно специально настроить ObjectDataSource для извлечения только точного набора записей, необходимых для запрошенной страницы данных. Как можно себе представить, пользовательское разбиение по страницам значительно повышает эффективность постраничный просмотр больших результирующих наборов.

> [!NOTE]
> При разбиении по умолчанию не подходит при разбиении на страницы до очень больших наборов результатов или для сайтов с большим количеством одновременных пользователей, необходимо учесть, что пользовательское разбиение по страницам, требуются дополнительные изменения и трудозатраты по реализации и не простая установка флажка (как по умолчанию Разбивка на страницы). Таким образом, разбиение на страницы по умолчанию может быть идеальным выбором для небольших низким уровнем трафика веб-сайтов или когда устанавливает постраничный просмотр относительно небольшой результирующий, как оно s гораздо проще и быстрее реализовать.


Например если известно, что никогда не будет более 100 продуктов в базе данных, минимальное увеличение производительности на пользовательское разбиение по страницам скорее всего смещением усилия, необходимые для его реализации. Если, однако может один день тысяч или десятков тысяч продуктов, *не* реализации пользовательское разбиение по страницам будет значительно препятствовать масштабируемости приложения.

## <a name="step-4-customizing-the-paging-experience"></a>Шаг 4: Настройка интерфейса постраничного просмотра

Веб-элементы управления данных содержат несколько свойств, которые можно использовать для улучшения взаимодействия с пользователем s разбиения на страницы. `PageCount` Свойство, например, определяет, сколько всего страниц, пока `PageIndex` свойство указывает текущую просматриваемую страницу и может быть задано для быстрого перехода пользователя к определенной странице. Чтобы показать, как использовать эти свойства для повышают эффективность взаимодействия с пользователем s разбиения на страницы, позволяя добавлять метку s веб-элемента управления на страницу пользователя о том, какие страницы их повторно в настоящее время посещения, а также элемент управления DropDownList, их можно быстро перейти к определенной странице .

Во-первых, добавить веб-управления Label на страницу, задайте его `ID` свойства `PagingInformation`и очистить его `Text` свойство. Создайте обработчик событий для GridView s `DataBound` событий и добавьте следующий код:


[!code-csharp[Main](paging-and-sorting-report-data-cs/samples/sample5.cs)]

Назначает этот обработчик событий `PagingInformation` метки s `Text` свойство сообщение, информирующее пользователя страницы, просматриваемой в данный момент `Products.PageIndex + 1` из общего числа страниц `Products.PageCount` (мы добавить 1 к `Products.PageIndex` свойство из-за `PageIndex` , начинаются с 0). Я выбрал присваивание эта метка s `Text` свойство в `DataBound` обработчик событий, в отличие от `PageIndexChanged` обработчик событий из-за `DataBound` событие вызывается каждый раз, в то время как данные будут привязаны к GridView `PageIndexChanged` только обработчик событий Активируется после изменения индекса страницы. Перейти к GridView при первоначальном данными, привязанными на первой странице, `PageIndexChanging` пожара t события (в то время как `DataBound` при событии).

В результате этого добавления пользователя отображается сообщение, указывающее, какие просматриваемой страницы и общее количество страниц данных являются.


[![Отображается номер текущей страницы и общее число страниц](paging-and-sorting-report-data-cs/_static/image19.png)](paging-and-sorting-report-data-cs/_static/image18.png)

**Рис. 10**: отображается номер текущей страницы и общее число страниц ([Просмотр полноразмерное изображение](paging-and-sorting-report-data-cs/_static/image20.png))


Помимо элемента управления Label позволяют также добавить элемент управления DropDownList, перечислены в GridView номера страниц с выбранным текущей просматриваемой странице s. Том, что пользователь можно быстро переходить с текущей страницы на другую, просто выбрав новый индекс страницы в выпадающем. Начать с добавления DropDownList в конструктор, установив его `ID` свойства `PageList` и выбор параметра AutoPostBack включить его в смарт-теге.

Затем вернуться к `DataBound` обработчик событий и добавьте следующий код:


[!code-csharp[Main](paging-and-sorting-report-data-cs/samples/sample6.cs)]

Этот код начинается с очистки элементов в `PageList` DropDownList. Это может показаться излишними, поскольку один t было ожидается число страниц, чтобы изменить, но другие пользователи могут использовать систему, добавление или удаление записей из `Products` таблицы. Такие вставки или удаления может привести к изменению количества страниц данных.

Далее, нам нужно снова создать номера страниц и один из них сопоставляется текущего GridView `PageIndex` выбран по умолчанию. Это осуществляется с помощью цикла от 0 до `PageCount - 1`, добавления нового `ListItem` в каждой итерации и установив его `Selected` свойство значение true, если индекс текущей итерации равно GridView s `PageIndex` свойство.

Наконец, необходимо создать обработчик событий для DropDownList s `SelectedIndexChanged` событие, которое возникает при каждом пользователю выбрать другой элемент в списке. Чтобы создать этот обработчик событий, просто дважды щелкните DropDownList в конструкторе, а затем добавьте следующий код:


[!code-csharp[Main](paging-and-sorting-report-data-cs/samples/sample7.cs)]

Как показано на рис. 11, простого изменения GridView s `PageIndex` свойство приводит данных привязывается к GridView. В GridView s `DataBound` обработчик событий, соответствующих DropDownList `ListItem` выбран.


[![Он автоматически откроется шестой страницы при выборе элемента страницы 6 раскрывающегося списка](paging-and-sorting-report-data-cs/_static/image22.png)](paging-and-sorting-report-data-cs/_static/image21.png)

**Рис. 11**: он автоматически откроется шестой страницы при выборе элемента страницы 6 раскрывающегося списка ([Просмотр полноразмерное изображение](paging-and-sorting-report-data-cs/_static/image23.png))


## <a name="step-5-adding-bi-directional-sorting-support"></a>Шаг 5: Добавление поддержки сортировки с двунаправленным письмом

Добавление поддержки сортировки двунаправленные является простым добавлением поддержка разбиения на страницы просто установите флажок Включить сортировку в смарт-теге GridView s (присваивающего GridView s [ `AllowSorting` свойство](https://msdn.microsoft.com/en-US/library/system.web.ui.webcontrols.gridview.allowsorting.aspx) для `true`). Это делает каждому заголовку поля s GridView как элементов управления LinkButton, при щелчке, вызывает обратную передачу и возвращать данные, отсортированные по выбранному столбцу в порядке возрастания. Повторное нажатие один и тот же заголовок LinkButton повторно сортировка данных в порядке убывания.

> [!NOTE]
> При использовании пользовательского уровня доступа к данным, а не типизированного набора данных, не имеется параметр Включить сортировку в GridView s смарт-тег. Только GridViews привязать к источникам данных со встроенной поддержкой упорядочения иметь этот флажок доступен. Типизированный набор данных предоставляет поддержку сортировки out of box, поскольку ADO.NET DataTable предоставляет `Sort` метод, при вызове сортирует s DataTable с помощью критериев, заданных объектов DataRow.


Если DAL не возвращает объекты, которые изначально поддержка сортировки, необходимо будет настроить ObjectDataSource для передачи сведений о сортировке уровня бизнес-логики, который можно сортировать данные или данные отсортированы по DAL. Мы изучим способ сортировки данных в бизнес-логики и уровней доступа к данным в будущем учебника.

Сортировки элементов управления LinkButton подготавливаются к просмотру как гиперссылки HTML, текущие цвета которых (синий цвет непросмотренных ссылок и Темно-красный для посещенных ссылок) пересекаться с цветом фона строки заголовка. Вместо этого позволяют s у всех ссылок строки заголовка установим белый цвет независимо от того, следует ли они хранять были посетил или нет. Это можно сделать, добавив следующую команду, чтобы `Styles.css` класса:


[!code-css[Main](paging-and-sorting-report-data-cs/samples/sample8.css)]

Этот синтаксис указывает на использование белого цвета при отображении этих гиперссылок в элементе, используется класс HeaderStyle.

После этого добавления к CSS при посещении страницы через браузер экран должен выглядеть аналогично рис. 12. В частности на рис. 12 показаны результаты, после нажатия ссылку заголовка s цены.


[![Результаты отсортированы по UnitPrice в возрастающем порядке](paging-and-sorting-report-data-cs/_static/image25.png)](paging-and-sorting-report-data-cs/_static/image24.png)

**Рис. 12**: результаты упорядочены по UnitPrice в возрастающем порядке ([Просмотр полноразмерное изображение](paging-and-sorting-report-data-cs/_static/image26.png))


## <a name="examining-the-sorting-workflow"></a>Изучение сортировки рабочего процесса

Все GridView полей BoundField, CheckBoxField, TemplateField и т. д имеют `SortExpression` свойство, которое указывает выражение, которое следует использовать для сортировки данных при щелчке поля s сортировки ссылки заголовка. GridView также имеет `SortExpression` свойства. При нажатии элемента управления, щелчок LinkButton, GridView назначает s поле `SortExpression` значение его `SortExpression` свойство. Затем данные повторно извлекается из ObjectDataSource и отсортированы в соответствии с GridView s `SortExpression` свойство. В следующем списке показана последовательность шагов, процесс, если пользователь сортирует данные в элементе управления GridView:

1. GridView s [событие сортировки](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.sorting(VS.80).aspx) активируется
2. GridView s [ `SortExpression` свойство](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.sortexpression.aspx) равно `SortExpression` поля сортировки заголовок которой выполнен щелчок LinkButton
3. ObjectDataSource повторно получает данные из МЕТОДА и затем выполняет сортировку данных с помощью GridView s`SortExpression`
4. GridView s `PageIndex` свойство становится равным 0, это значит, что при сортировке пользователь возвращается к первой странице данных (при условии, что реализована поддержка разбиения на страницы)
5. GridView s [ `Sorted` событие](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.sorted(VS.80).aspx) активируется

Как и с разбиением на страницы по умолчанию, упорядочение по умолчанию снова получает *все* записи из МЕТОДА. При использовании упорядочения без разбиения по страницам или сортировку с по умолчанию разбиение на страницы, здесь s не способ обхода этой перегрузке (во всех остальных случаях, кэширование данных базы данных). Однако, как будет показано в будущем руководство, он s возможность эффективно сортировки данных при использовании пользовательского разбиения на страницы.

При привязке ObjectDataSource к GridView с помощью раскрывающегося списка в смарт-теге s GridView, каждое поле GridView автоматически имеет его `SortExpression` присваивается имя поля данных в `ProductsRow` класса. Например `ProductName` BoundField s `SortExpression` равно `ProductName`, как показано в следующем декларативная разметка:


[!code-aspx[Main](paging-and-sorting-report-data-cs/samples/sample9.aspx)]

Поля можно настроить, чтобы он не сортируемого при очистке s его `SortExpression` свойство (присваивается пустая строка). В качестве примера, предположим, мы не существовал t следует позволить клиентам упорядочения по цене. `UnitPrice` BoundField s `SortExpression` может быть удалено из декларативной разметки или через диалоговое окно поля (которое можно открыть, щелкнув ссылку Правка столбцов GridView смарт-тега s).


![Результаты отсортированы по UnitPrice в возрастающем порядке](paging-and-sorting-report-data-cs/_static/image27.png)

**Рис. 13**: результаты упорядочены по UnitPrice в возрастающем порядке


Один раз `SortExpression` было удалено для `UnitPrice` BoundField, заголовок отображается как текст, а не как ссылки, тем самым предотвращая сортировка данных по цене.


[![При удалении свойства SortExpression, пользователи больше не сортировать продукты, цена](paging-and-sorting-report-data-cs/_static/image29.png)](paging-and-sorting-report-data-cs/_static/image28.png)

**Рис. 14**: при удалении свойства SortExpression, пользователи могут сортировать больше не цены продуктов по ([Просмотр полноразмерное изображение](paging-and-sorting-report-data-cs/_static/image30.png))


## <a name="programmatically-sorting-the-gridview"></a>Программное упорядочение элемента управления GridView

Можно также сортировать содержимое элемента управления GridView программным путем с помощью GridView s [ `Sort` метод](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.sort.aspx). Просто передайте `SortExpression` значение сортировки вместе с [ `SortDirection` ](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.sortdirection.aspx) (`Ascending` или `Descending`), и данные s GridView будут переупорядочены.

Предположим, что по причине, мы отключили Сортировка по `UnitPrice` был, так как мы озабоченность по нашим клиентам просто приобретет только дешевые продукты. Тем не менее мы хотим предложением купить самых дорогих товаров, поэтому мы d как их, чтобы иметь возможность отсортировать продукты по цене, но только из наиболее ресурсоемких цены к наименее.

Для выполнения добавить кнопку веб-элемент управления на страницу, задать его `ID` свойства `SortPriceDescending`и его `Text` свойства для сортировки по цене. Создайте обработчик событий для кнопки s `Click` событие, дважды щелкнув элемент управления Button в конструкторе. Добавьте следующий код в этот обработчик событий:


[!code-csharp[Main](paging-and-sorting-report-data-cs/samples/sample10.cs)]

При нажатии этой кнопки пользователь возвращается к первой странице с продуктами, упорядоченными по цене от самых дорогих для недорогой (см. рис. 15).


[![Нажав кнопку заказы на продукты из самых дорогих к наименее](paging-and-sorting-report-data-cs/_static/image32.png)](paging-and-sorting-report-data-cs/_static/image31.png)

**Рис. 15**: кнопку заказы на продукты из самых дорогих к наименее ([Просмотр полноразмерное изображение](paging-and-sorting-report-data-cs/_static/image33.png))


## <a name="summary"></a>Сводка

В этом учебнике мы узнали, как реализовать разбиение по страницам и предоставляют возможность сортировки по умолчанию, которые включаются простой установкой флажка! Если пользователь сортирует или данных по страницам, как рабочий процесс развертывания:

1. Выполняется обратная
2. Данные веб-элемент управления s предварительно уровень события (`PageIndexChanging` или `Sorting`)
3. Все данные, повторно извлекается с ObjectDataSource
4. Данные веб-элемент управления s уровня после события (`PageIndexChanged` или `Sorted`)

При реализации основных разбиение по страницам и сортировка выполняется очень просто, больше усилий должен выдерживать использовать более эффективно пользовательское разбиение по страницам и улучшения интерфейса разбиения или упорядочения. В этих разделах будут посвящены следующие учебники.

Программирование довольны!

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года. Скотт — независимый консультант, trainer и записи. Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [http://ScottOnWriting.NET](http://ScottOnWriting.NET).

>[!div class="step-by-step"]
[Вперед](efficiently-paging-through-large-amounts-of-data-cs.md)
