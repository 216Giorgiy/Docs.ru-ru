---
uid: web-forms/overview/data-access/paging-and-sorting/creating-a-customized-sorting-user-interface-vb
title: Создание настраиваемой сортировки пользовательского интерфейса (Visual Basic) | Документы Microsoft
author: rick-anderson
description: При отображении длинный список отсортированные данные, может быть очень полезно, чтобы сгруппировать связанные данные, знакомство с разделителем строк. В этом учебнике мы рассмотрим способы Исп...
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/15/2006
ms.topic: article
ms.assetid: f3897a74-cc6a-4032-8f68-465f155e296a
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting/creating-a-customized-sorting-user-interface-vb
msc.type: authoredcontent
ms.openlocfilehash: 35144907aceda6ece56d91b24aba15ef951ed99a
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
ms.locfileid: "30892677"
---
<a name="creating-a-customized-sorting-user-interface-vb"></a>Создание настраиваемой сортировки пользовательского интерфейса (Visual Basic)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить пример приложения](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_27_VB.exe) или [скачать PDF](creating-a-customized-sorting-user-interface-vb/_static/datatutorial27vb1.pdf)

> При отображении длинный список отсортированные данные, может быть очень полезно, чтобы сгруппировать связанные данные, знакомство с разделителем строк. В этом учебнике будет показано, как создавать такие сортировки пользовательский интерфейс.


## <a name="introduction"></a>Вступление

При отображении длинный список отсортированные данные где существует лишь небольшое число различных значений в столбце отсортированный, конечный пользователь может оказаться трудно, точно, границы различие возникновения. Например, существуют 81 продуктов в базе данных, но только девять вариантов разные категории (восьми категорий уникальный плюс `NULL` параметр). Рассмотрим случай, пользователя, который нужно просмотреть продукты, которые попадают в категорию «Морепродукты». Со страницы, в которой перечислены *все* продуктов в одной GridView, пользователь может принять решение ее лучше всего сортировать результаты по категории, которая будет сгруппировать все Морепродукты вместе. После сортировки по категориям, пользователь должна просмотреть весь список, поиск которой продукты нужной группе начала и окончания. Поскольку результаты сортируются в алфавитном порядке по несложно найти нужную имя категории, но по-прежнему требуется внимательно просматривать список элементов в сетке.

Для выделения границ между группами, многие веб-сайты используют пользовательский интерфейс, который добавляет разделитель между группами. Разделители, как показано на рисунке 1 позволяет пользователям быстро найти нужную группу и определения его границ, а также выяснить, какие группы вообще существуют в данных.


[![Каждая группа категорий является четко определены](creating-a-customized-sorting-user-interface-vb/_static/image2.png)](creating-a-customized-sorting-user-interface-vb/_static/image1.png)

**Рис. 1**: каждой группы категорий — четко определены ([Просмотр полноразмерное изображение](creating-a-customized-sorting-user-interface-vb/_static/image3.png))


В этом учебнике будет показано, как создавать такие сортировки пользовательский интерфейс.

## <a name="step-1-creating-a-standard-sortable-gridview"></a>Шаг 1: Создание стандартных, сортируемого GridView

Прежде чем мы узнаем, как расширить GridView, чтобы указать режим сортировки, позволяют s сначала создать стандартный, сортируемого GridView, список продуктов. Сначала откройте `CustomSortingUI.aspx` страницы в `PagingAndSorting` папки. Добавить на страницу элемент управления GridView, задайте его `ID` свойства `ProductList`и привязать его к новой ObjectDataSource. Настройка ObjectDataSource для использования `ProductsBLL` класса s `GetProducts()` для выбора нужных записей.

Настройте GridView таким образом, что он содержит только `ProductName`, `CategoryName`, `SupplierName`, и `UnitPrice` стояли и CheckBoxField более не поддерживается. И наконец, настройте GridView начинает поддерживать сортировку, установив флажок Включить сортировку в смарт-теге s GridView (или путем установки его `AllowSorting` свойства `true`). После внесения этих изменений `CustomSortingUI.aspx` страницы, должна выглядеть следующим образом:


[!code-aspx[Main](creating-a-customized-sorting-user-interface-vb/samples/sample1.aspx)]

Теперь пора просмотрите ход работы в данный момент в браузере. На рисунке 2 показано сортируемого GridView при отсортированы по категории в алфавитном порядке.


[![S сортируемого GridView данные упорядочиваются по категориям](creating-a-customized-sorting-user-interface-vb/_static/image5.png)](creating-a-customized-sorting-user-interface-vb/_static/image4.png)

**На рисунке 2**: s сортируемого GridView данные упорядочиваются по категориям ([Просмотр полноразмерное изображение](creating-a-customized-sorting-user-interface-vb/_static/image6.png))


## <a name="step-2-exploring-techniques-for-adding-the-separator-rows"></a>Шаг 2: Изучение методы для добавления разделителя строк

С универсальным, сортируемого GridView завершения остается возможность добавить разделитель строк в GridView перед каждой уникальной отсортированный группы. Но, как такие строки быть внедрены в GridView? По существу нам нужна для прохода по строкам s GridView, определить отличия между значениями в столбце отсортированный и затем добавить соответствующие разделяющие строки. При рассмотрении эту проблему, показаться, что решение лежит где-то в GridView s `RowDataBound` обработчика событий. Как уже говорилось в [форматирование на основе по данным](../custom-formatting/custom-formatting-based-upon-data-vb.md) учебника, этот обработчик обычно используется при применении форматирования на уровне строк на основе строк данных. Тем не менее `RowDataBound` обработчик событий не решение, как строки нельзя добавить к GridView программным образом из этого обработчика событий. GridView s `Rows` коллекции, на самом деле доступно только для чтения.

Для добавления дополнительных строк в GridView у нас есть три варианта:

- Добавить разделяющие метаданные фактических данных, к которому привязан к GridView
- После привязки к данным GridView, добавления дополнительных `TableRow` экземпляров GridView s управления коллекции
- Создание пользовательского элемента управления, переопределяющий методы, которые отвечают за создание структуры s GridView и расширяет их возможности элемента управления GridView

Создание серверного элемента управления будет лучшим подходом, если эта функциональность была нужна на многих веб-страниц или несколько веб-сайтов. Тем не менее он повлечет за собой довольно много кода и подробного разъяснения глубин о механизмах s GridView. Поэтому мы выберем параметра для этого учебника.

Две другие параметры Добавление разделителя строк для фактических данных привязаны к GridView и управления коллекцией элемента управления GridView s после его был привязан - атак проблемы по-разному и заслуживают более подробного обсуждения.

## <a name="adding-rows-to-the-data-bound-to-the-gridview"></a>Добавление строк данных привязаны к GridView

Если GridView привязан к источнику данных, он создает `GridViewRow` для каждой записи, возвращаемых источником данных. Таким образом может вводить разделяющие строки путем добавления разделитель записей в источнике данных до их привязки к GridView. Этот принцип показан на рис. 3.


![Один способ предполагает добавление разделителя строк в источнике данных](creating-a-customized-sorting-user-interface-vb/_static/image7.png)

**Рис. 3**: один способ предполагает добавление разделителя строк в источнике данных


Использовать разделитель записей термин в кавычки, так как нет специальных разделитель записей; Вместо этого мы должны как-либо пометить определенной записи в источнике данных служит в качестве разделителя, а не обычной строки данных. В нашем примере мы повторную привязку `ProductsDataTable` экземпляр GridView, состоящее из `ProductRows`. Мы может пометить отдельные записи как строка разделителя, установив его `CategoryID` свойства `-1` (так как такой тип t значение обычно существует).

Чтобы реализовать этот подход d необходимо выполнить следующие действия:

1. Программным способом извлечения данных для привязки к GridView ( `ProductsDataTable` экземпляра)
2. Сортировать данные, основанные на GridView s `SortExpression` и `SortDirection` свойства
3. Итерации `ProductsRows` в `ProductsDataTable`, которым нужен где возникнуть различия в сортируемый столбец
4. Границы каждой группы, вставка разделителя записи `ProductsRow` экземпляра в объект DataTable, имеющую его s `CategoryID` значение `-1` (или любым другим способом было решено после пометить запись как запись разделитель)
5. После вставки разделитель строк, программными средствами привязать данные к GridView

Помимо этих пяти шагов d необходимо также предоставить обработчик событий для GridView s `RowDataBound` событий. Здесь мы d проверка каждой `DataRow` и определить, была ли разделитель строк одной которого `CategoryID` был `-1`. В этом случае d, возможно, необходимо изменить форматирование или текст, отображаемый в ячейках.

При использовании этого метода для добавления границ групп сортировки требует больше усилий, чем описанные выше, необходимо также предоставить обработчик событий для GridView s `Sorting` событий и следить за `SortExpression` и `SortDirection` значения.

## <a name="manipulating-the-gridview-s-control-collection-after-it-s-been-databound"></a>Обработка GridView s управления сбором после него s привязку данных

Вместо обращения к данным до их привязки к GridView, можно добавить разделитель строк *после* привязки данных к GridView. Процесс привязки данных строит иерархии элементов управления GridView s, которая фактически является просто `Table` экземпляр, состоящие из коллекции строк, каждая из которых состоит из коллекции ячеек. В частности, содержит коллекцию элементов управления GridView s `Table` в качестве корня `GridViewRow` (который является производным от `TableRow` класса) для каждой записи в `DataSource` привязаны к GridView и `TableCell` объекта в каждом `GridViewRow` экземпляра для каждого поля данных в `DataSource`.

Добавление разделителя строк между группами сортировки, мы может напрямую манипулировать эту иерархию после его создания. Мы можно быть уверенным, что по иерархии элементов управления GridView s был создан в последний раз, когда страница отображается. Таким образом, этот подход переопределяет `Page` класса s `Render` метода, после чего иерархии конечный элемент управления GridView s обновляется с учетом разделяющие строки. Этот процесс показан на рис. 4.


[![Второй подход предполагает изменение иерархии элемента управления GridView s](creating-a-customized-sorting-user-interface-vb/_static/image9.png)](creating-a-customized-sorting-user-interface-vb/_static/image8.png)

**Рис. 4**: второй подход предполагает изменение иерархии элементов управления GridView s ([Просмотр полноразмерное изображение](creating-a-customized-sorting-user-interface-vb/_static/image10.png))


В этом учебнике мы будем использовать этот метод для настройки сортировки взаимодействие с пользователем.

> [!NOTE]
> Код я m представления в этом учебнике основан на примере в [Teemu Keiski](http://aspadvice.com/blogs/joteke/default.aspx) запись в блоге s [воспроизведение бит с группированием сортировки GridView](http://aspadvice.com/blogs/joteke/archive/2006/02/11/15130.aspx).


## <a name="step-3-adding-the-separator-rows-to-the-gridview-s-control-hierarchy"></a>Шаг 3: Добавление разделителя строк по иерархии элементов управления GridView s

Поскольку нам требуется только добавить разделитель строк по иерархии элементов управления GridView s, после создания собственной иерархии элементов управления и создания в последний раз посещении страницы, мы хотим выполнить это действие в конце жизненного цикла страницы, но до фактического c GridView иерархии непечатаемые подготовлен к просмотру в HTML. — Последний момент скорость этого можно достичь `Page` класса s `Render` событие, которое можно переопределить в нашей следующую сигнатуру метода с помощью класса с выделенным кодом:


[!code-vb[Main](creating-a-customized-sorting-user-interface-vb/samples/sample2.vb)]

Когда `Page` класс исходное `Render` вызывается метод `base.Render(writer)` каждого элемента управления на странице будут отображаться, создание разметки, в зависимости от иерархии элемента. Поэтому крайне важно, как мы называем `base.Render(writer)`, после чего страница отображается, и что мы управления GridView s управления до вызова метода `base.Render(writer)`, после чего были добавлены по иерархии элементов управления GridView s перед ним разделитель строк s был к просмотру.

Для вставки заголовки групп необходимо сначала убедиться, что пользователь запросил быть, что данные отсортированы. По умолчанию содержимое s GridView не сортируются и поэтому мы не хотите t необходимости вводить любой сортировки заголовков групп.

> [!NOTE]
> Для сортировки по одному из столбцов при первой загрузке страницы GridView, вызвать GridView s `Sort` метод при первом посещении страницы (но не при последующих обратных передачах). Чтобы сделать это, добавьте этот вызов в `Page_Load` обработчик событий в пределах `if (!Page.IsPostBack)` условного. Обращаться к [разбиение по страницам и сортировка данных отчета](paging-and-sorting-report-data-vb.md) сведений для получения дополнительных сведений о `Sort` метода.


При условии, что данные были отсортированы, теперь нам необходимо определить столбец данные были отсортированы по и сканирование строк, поиск различий в этом столбце s значений. Следующий код проверяет, что данные были отсортированы и находит столбец, по которому были отсортированы данные:


[!code-vb[Main](creating-a-customized-sorting-user-interface-vb/samples/sample3.vb)]

Если GridView еще быть отсортированы, GridView s `SortExpression` будет не присвоено значение свойству. Таким образом нам нужен только для добавления разделителя строк, если это свойство имеет некоторые значения. В этом случае Далее нужно определить индекс столбца, по которому данные отсортированы. Это достигается путем циклический перебор GridView s `Columns` коллекции, поиск столбца которого `SortExpression` равно GridView s `SortExpression` свойство. Помимо индекса столбца s, также запрашивается `HeaderText` свойства, которое используется при отображении разделитель строк.

С индексом столбца, по которому сортируется данные и наконец является для перечисления строк элемента управления GridView. Для каждой строки, нам нужно определить, отличается ли значение s сортируемый столбец из значения s s сортировки столбца предыдущей строки. Если Да, нам необходимо вставить новый `GridViewRow` экземпляра в иерархии элементов управления. Это достигается с помощью следующего кода:


[!code-vb[Main](creating-a-customized-sorting-user-interface-vb/samples/sample4.vb)]

Этот код начинается с программного обращения к `Table` объект найден в корне иерархии элементов управления GridView s и создание строковую переменную с именем `lastValue`. `lastValue` используется для сравнения текущее значение столбца s отсортированных строк с предыдущим значением строки s. Далее, GridView s `Rows` коллекции перечисляется, и для каждой строки значение сортируемый столбец хранится в `currentValue` переменной.

> [!NOTE]
> Для определения значения столбца сортируются s конкретной строки, мы используем свойство ячейки s `Text` свойство. Это хорошо подходит для стояли, но будет не работает надлежащим образом для TemplateFields CheckBoxFields и так далее. Мы рассмотрим как вскоре учетной записи для альтернативного GridView полей.


`currentValue` И `lastValue` сравниваются. Если они различаются, нам нужно добавить новую строку разделителя в иерархии элементов управления. Это достигается путем определения индекс `GridViewRow` в `Table` объект s `Rows` коллекции, создание новых `GridViewRow` и `TableCell` экземпляров, а затем добавление `TableCell` и `GridViewRow` для Иерархия элементов управления.

Обратите внимание, что разделителя в строке s одиночному `TableCell` форматируется таким образом, что он распространяется на всю ширину элемента управления GridView, форматируется с использованием `SortHeaderRowStyle` класс CSS и имеет его `Text` свойство, которое содержит группы имя (например, категория) и Значение s группы (например, Напитки). Наконец `lastValue` обновляется значение `currentValue`.

Класс CSS, используемый для форматирования заголовка группы `SortHeaderRowStyle` должен быть указан в `Styles.css` файла. Вы можете использовать любые параметры стиля оспорить Я использовал следующее:


[!code-css[Main](creating-a-customized-sorting-user-interface-vb/samples/sample5.css)]

С текущего кода интерфейса сортировки добавляет заголовки групп при сортировке по любой BoundField (см. рис. 5 показан снимок экрана при сортировке поставщиком). Однако при сортировке по тип поля (например CheckBoxField или TemplateField), заголовки групп, никуда не найден (см. рис. 6).


[![Интерфейс сортировки включает заголовки групп, сортировки, при сортировке по стояли](creating-a-customized-sorting-user-interface-vb/_static/image12.png)](creating-a-customized-sorting-user-interface-vb/_static/image11.png)

**Рис. 5**: сортировка интерфейс включает сортировки группы заголовков при сортировке по стояли ([Просмотр полноразмерное изображение](creating-a-customized-sorting-user-interface-vb/_static/image13.png))


[![Заголовки групп, отсутствует при сортировке по полю CheckBoxField](creating-a-customized-sorting-user-interface-vb/_static/image15.png)](creating-a-customized-sorting-user-interface-vb/_static/image14.png)

**Рис. 6**: заголовки групп, отсутствует при сортировке по полю CheckBoxField ([Просмотр полноразмерное изображение](creating-a-customized-sorting-user-interface-vb/_static/image16.png))


При сортировке по полю CheckBoxField отсутствуют заголовки групп, так как код в настоящее время использует только `TableCell` s `Text` свойства, чтобы определить значение отсортированного столбца для каждой строки. Для CheckBoxFields `TableCell` s `Text` свойства является пустая строка; вместо этого значение можно получить через флажок веб-элемент управления, который находится в пределах `TableCell` s `Controls` коллекции.

Для обработки типов полей, за исключением стояли, нам необходимо дополнить код где `currentValue` переменной присваивается для проверки наличия флажок в `TableCell` s `Controls` коллекции. Вместо использования `currentValue = gvr.Cells(sortColumnIndex).Text`, замените этот код следующим:


[!code-vb[Main](creating-a-customized-sorting-user-interface-vb/samples/sample6.vb)]

Этот код выполняет проверку ячейку `TableCell` для текущей строки определить, если все элементы управления в `Controls` коллекции. Если есть, и первый элемент управления CheckBox, `currentValue` переменной задано значение Да или нет, в зависимости от s флажок `Checked` свойство. В противном случае — значение берется из `TableCell` s `Text` свойство. Эта логика может реплицироваться сортировке любой TemplateFields, которые могут существовать в GridView.

С добавлением выше код, заголовки групп отображаются при сортировке по CheckBoxField прекращена (см. рис. 7).


[![Заголовки групп, теперь присутствует при сортировке по полю CheckBoxField](creating-a-customized-sorting-user-interface-vb/_static/image18.png)](creating-a-customized-sorting-user-interface-vb/_static/image17.png)

**Рис. 7**: заголовки групп, теперь присутствует при сортировке по полю CheckBoxField ([Просмотр полноразмерное изображение](creating-a-customized-sorting-user-interface-vb/_static/image19.png))


> [!NOTE]
> Если продуктов с `NULL` значения для базы данных `CategoryID`, `SupplierID`, или `UnitPrice` поля, эти значения будут отображаться как пустые строки в GridView по умолчанию, то есть текст разделителя строк для этих продуктов с `NULL`будет выглядеть как категория: (то есть отсутствует s нет имя после категории: как с категорией: Напитки). Если требуется, чтобы значения, показанные здесь можно задать либо стояли [ `NullDisplayText` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.boundfield.nulldisplaytext.aspx) текст должен отображаться или условного оператора можно добавить в метод Render, при назначении `currentValue` для разделителя Строка s `Text` свойство.


## <a name="summary"></a>Сводка

GridView не включает множество встроенных возможностей для настройки интерфейса сортировки. Тем не менее, с помощью небольшой код нижнего уровня его можно настроить по иерархии элементов управления GridView s для создания более функциональный интерфейс s. В этом учебнике мы узнали, как добавить строку разделителя группы сортировки для сортируемого GridView, который позволяет быстрее находить отдельные группы и этих групп границ. Дополнительные примеры доработки интерфейсов извлечь [Скотт Гатри](https://weblogs.asp.net/scottgu/) s [несколько ASP.NET 2.0 GridView сортировки советы и рекомендации](https://weblogs.asp.net/scottgu/archive/2006/02/11/437995.aspx) запись в блоге.

Программирование довольны!

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года. Скотт — независимый консультант, trainer и записи. Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).

> [!div class="step-by-step"]
> [Назад](sorting-custom-paged-data-vb.md)
