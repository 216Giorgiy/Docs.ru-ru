---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs
title: Обзор событий, связанных с вставки, обновления и удаления (C#) | Документы Microsoft
author: rick-anderson
description: В данном руководстве, мы изучим, с помощью событий, возникающих до, во время и после выполнения вставки обновления или удаления веб-элемента управления данными ASP.NET. W...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/17/2006
ms.topic: article
ms.assetid: dab291a0-a8b5-46fa-9dd8-3d35b249201f
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs
msc.type: authoredcontent
ms.openlocfilehash: 61542f37c9fa3e6c5893aabb0a3116571bd6be5a
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
ms.locfileid: "30889401"
---
<a name="examining-the-events-associated-with-inserting-updating-and-deleting-c"></a><span data-ttu-id="9a1c6-104">Обзор событий, связанных с вставки, обновления и удаления (C#)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-104">Examining the Events Associated with Inserting, Updating, and Deleting (C#)</span></span>
====================
<span data-ttu-id="9a1c6-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="9a1c6-106">[Загрузить пример приложения](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_17_CS.exe) или [скачать PDF](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/datatutorial17cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-106">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_17_CS.exe) or [Download PDF](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/datatutorial17cs1.pdf)</span></span>

> <span data-ttu-id="9a1c6-107">В данном руководстве, мы изучим, с помощью событий, возникающих до, во время и после выполнения вставки обновления или удаления веб-элемента управления данными ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-107">In this tutorial we'll examine using the events that occur before, during, and after an insert, update, or delete operation of an ASP.NET data Web control.</span></span> <span data-ttu-id="9a1c6-108">Также будет показано, как настройка интерфейса правки для обновления только подмножества полей продукта.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-108">We'll also see how to customize the editing interface to only update a subset of the product fields.</span></span>


## <a name="introduction"></a><span data-ttu-id="9a1c6-109">Вступление</span><span class="sxs-lookup"><span data-stu-id="9a1c6-109">Introduction</span></span>

<span data-ttu-id="9a1c6-110">При использовании встроенных вставки, редактирования или удаления возможности элементов управления GridView, DetailsView и FormView, пройти ряд действий, когда конечный пользователь завершает процесс добавления новой записи или удаления существующей записи.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-110">When using the built-in inserting, editing, or deleting features of the GridView, DetailsView, or FormView controls, a variety of steps transpire when the end user completes the process of adding a new record or updating or deleting an existing record.</span></span> <span data-ttu-id="9a1c6-111">Как уже говорилось в [с предыдущим учебником](an-overview-of-inserting-updating-and-deleting-data-cs.md), при редактировании строки в GridView, кнопка "Изменить" заменяется кнопок "обновления" и "Отмена" и включите стояли в текстовых полях.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-111">As we discussed in the [previous tutorial](an-overview-of-inserting-updating-and-deleting-data-cs.md), when a row is edited in the GridView the Edit button is replaced by Update and Cancel buttons and the BoundFields turn into TextBoxes.</span></span> <span data-ttu-id="9a1c6-112">Последнее обновление конечный пользователь обновляет данные, при обратной передаче выполняются следующие действия:</span><span class="sxs-lookup"><span data-stu-id="9a1c6-112">After the end user updates the data and clicks Update, the following steps are performed on postback:</span></span>

1. <span data-ttu-id="9a1c6-113">GridView заполняет его ObjectDataSource `UpdateParameters` с измененной записи уникальный идентифицирующий полей (через `DataKeyNames` свойства) и значения, введенные пользователем</span><span class="sxs-lookup"><span data-stu-id="9a1c6-113">The GridView populates its ObjectDataSource's `UpdateParameters` with the edited record's unique identifying field(s) (via the `DataKeyNames` property) along with the values entered by the user</span></span>
2. <span data-ttu-id="9a1c6-114">GridView вызывает его ObjectDataSource `Update()` метод, который в свою очередь вызывает соответствующий метод из базового объекта (`ProductsDAL.UpdateProduct`, в нашем с предыдущим учебником)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-114">The GridView invokes its ObjectDataSource's `Update()` method, which in turn invokes the appropriate method in the underlying object (`ProductsDAL.UpdateProduct`, in our previous tutorial)</span></span>
3. <span data-ttu-id="9a1c6-115">Базовых данных, которая теперь включает обновленные изменения, повторно привязываются к GridView</span><span class="sxs-lookup"><span data-stu-id="9a1c6-115">The underlying data, which now includes the updated changes, is rebound to the GridView</span></span>

<span data-ttu-id="9a1c6-116">Во время этой последовательности этапов ряд событий, позволяющих создать обработчики событий для добавления пользовательской логики при необходимости.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-116">During this sequence of steps, a number of events fire, enabling us to create event handlers to add custom logic where needed.</span></span> <span data-ttu-id="9a1c6-117">Например, до шага 1, GridView `RowUpdating` вызывается событие.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-117">For example, prior to Step 1, the GridView's `RowUpdating` event fires.</span></span> <span data-ttu-id="9a1c6-118">Мы на этом этапе можно отменить запрос на обновление, если имеется ошибка проверки.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-118">We can, at this point, cancel the update request if there is some validation error.</span></span> <span data-ttu-id="9a1c6-119">Когда `Update()` вызывается метод, элемент управления ObjectDataSource `Updating` события, предоставляя возможность добавить или настроить значения любого из `UpdateParameters`.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-119">When the `Update()` method is invoked, the ObjectDataSource's `Updating` event fires, providing an opportunity to add or customize the values of any of the `UpdateParameters`.</span></span> <span data-ttu-id="9a1c6-120">После основного ObjectDataSource метода объекта, порождается ObjectDataSource `Updated` события.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-120">After the ObjectDataSource's underlying object's method has completed executing, the ObjectDataSource's `Updated` event is raised.</span></span> <span data-ttu-id="9a1c6-121">Обработчик событий для `Updated` может проверить сведений об операции обновления, такие как количество строк, затронутых и ли возникло исключение.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-121">An event handler for the `Updated` event can inspect the details about the update operation, such as how many rows were affected and whether or not an exception occurred.</span></span> <span data-ttu-id="9a1c6-122">Наконец, после шага 2, GridView `RowUpdated` событие, обработчик событий для события, это может рассмотреть дополнительную информацию о точно так же, операция обновления выполняется.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-122">Finally, after Step 2, the GridView's `RowUpdated` event fires; an event handler for this event can examine additional information about the update operation just performed.</span></span>

<span data-ttu-id="9a1c6-123">Рис. 1 представлен ряд события и действия при обновлении элемента управления GridView.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-123">Figure 1 depicts this series of events and steps when updating a GridView.</span></span> <span data-ttu-id="9a1c6-124">Модель событий на рисунке 1 не является уникальным для обновления с помощью GridView.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-124">The event pattern in Figure 1 is not unique to updating with a GridView.</span></span> <span data-ttu-id="9a1c6-125">Вставка, обновление или удаление данных из GridView, DetailsView и FormView запускает ту же последовательность событий предварительного и последующего уровней для веб-управления данными и ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-125">Inserting, updating, or deleting data from the GridView, DetailsView, or FormView precipitates the same sequence of pre- and post-level events for both the data Web control and the ObjectDataSource.</span></span>


<span data-ttu-id="9a1c6-126">[![Серии до и после события срабатывают при обновлении данных в элементе управления GridView](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image2.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-126">[![A Series of Pre- and Post-Events Fire When Updating Data in a GridView](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image2.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image1.png)</span></span>

<span data-ttu-id="9a1c6-127">**Рис. 1**: серии из до и после события срабатывают при обновлении данных в элементе управления GridView ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-127">**Figure 1**: A Series of Pre- and Post-Events Fire When Updating Data in a GridView ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image3.png))</span></span>


<span data-ttu-id="9a1c6-128">В данном руководстве, мы изучим, с помощью этих событий расширить встроенные возможности вставки, обновления и удаления данных ASP.NET возможностей веб-элементов управления.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-128">In this tutorial we'll examine using these events to extend the built-in inserting, updating, and deleting capabilities of the ASP.NET data Web controls.</span></span> <span data-ttu-id="9a1c6-129">Также будет показано, как настройка интерфейса правки для обновления только подмножества полей продукта.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-129">We'll also see how to customize the editing interface to only update a subset of the product fields.</span></span>

## <a name="step-1-updating-a-productsproductnameandunitpricefields"></a><span data-ttu-id="9a1c6-130">Шаг 1: Обновление продукта`ProductName`и`UnitPrice`поля</span><span class="sxs-lookup"><span data-stu-id="9a1c6-130">Step 1: Updating a Product's`ProductName`and`UnitPrice`Fields</span></span>

<span data-ttu-id="9a1c6-131">В интерфейсы правки из предыдущего учебника *все* поля продукта, которые не были доступны только для чтения должны быть включены.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-131">In the editing interfaces from the previous tutorial *all* product fields that were not read-only had to be included.</span></span> <span data-ttu-id="9a1c6-132">Если удалить поле из GridView - сказать `QuantityPerUnit` - при обновлении данных веб-управления данными не устанавливал бы ObjectDataSource `QuantityPerUnit` `UpdateParameters` значение.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-132">If we were to remove a field from the GridView - say `QuantityPerUnit` - when updating the data the data Web control would not set the ObjectDataSource's `QuantityPerUnit` `UpdateParameters` value.</span></span> <span data-ttu-id="9a1c6-133">ObjectDataSource передавал бы `null` значение в `UpdateProduct` слой бизнес-логики (BLL) метода, который будет изменять записи измененной базы данных `QuantityPerUnit` столбец `NULL` значение.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-133">The ObjectDataSource would then pass in a `null` value into the `UpdateProduct` Business Logic Layer (BLL) method, which would change the edited database record's `QuantityPerUnit` column to a `NULL` value.</span></span> <span data-ttu-id="9a1c6-134">Аналогично, если обязательное поле, такие как `ProductName`, удаляется из интерфейса правки, обновление завершится ошибкой с «*столбец «ProductName» не допускает значения NULL*"исключение.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-134">Similarly, if a required field, such as `ProductName`, is removed from the editing interface, the update will fail with a "*Column 'ProductName' does not allow nulls*" exception.</span></span> <span data-ttu-id="9a1c6-135">Причина этого поведения: так как элемент управления ObjectDataSource был настроен для вызова `ProductsBLL` класса `UpdateProduct` метод, который требуется входной параметр для каждого из полей продукта.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-135">The reason for this behavior was because the ObjectDataSource was configured to call the `ProductsBLL` class's `UpdateProduct` method, which expected an input parameter for each of the product fields.</span></span> <span data-ttu-id="9a1c6-136">Таким образом, ObjectDataSource `UpdateParameters` коллекция содержала значение параметра для каждого метода входных параметров.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-136">Therefore, the ObjectDataSource's `UpdateParameters` collection contained a parameter for each of the method's input parameters.</span></span>

<span data-ttu-id="9a1c6-137">Если требуется предоставить веб-элемент управления, который позволяет конечным пользователям обновлять только подмножество полей данных, то необходимо либо программно задать отсутствующие `UpdateParameters` значения в ObjectDataSource `Updating` обработчика событий или создать и вызвать метод уровень бизнес-ЛОГИКИ, который ожидает только подмножество полей.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-137">If we want to provide a data Web control that allows the end user to only update a subset of fields, then we need to either programmatically set the missing `UpdateParameters` values in the ObjectDataSource's `Updating` event handler or create and call a BLL method that expects only a subset of the fields.</span></span> <span data-ttu-id="9a1c6-138">Рассмотрим этот метод.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-138">Let's explore this latter approach.</span></span>

<span data-ttu-id="9a1c6-139">В частности, давайте создадим страница, отображающая только `ProductName` и `UnitPrice` полей в изменяемого элемента управления GridView.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-139">Specifically, let's create a page that displays just the `ProductName` and `UnitPrice` fields in an editable GridView.</span></span> <span data-ttu-id="9a1c6-140">Интерфейс редактирования элемента GridView допускает только пользователю о необходимости обновить два отображаемых поля `ProductName` и `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-140">This GridView's editing interface will only allow the user to update the two displayed fields, `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="9a1c6-141">Поскольку этот интерфейс правки предоставляет только подмножество полей продукта, необходимо либо создать ObjectDataSource, который использует существующего МЕТОДА `UpdateProduct` метод и содержит недостающие значения полей продукта установить в обработчике его `Updating` событий обработчик, или нам нужно создать новый метод уровень бизнес-ЛОГИКИ, который ожидает только подмножество полей, определенных в GridView.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-141">Since this editing interface only provides a subset of a product's fields, we either need to create an ObjectDataSource that uses the existing BLL's `UpdateProduct` method and has the missing product field values set programmatically in its `Updating` event handler, or we need to create a new BLL method that expects only the subset of fields defined in the GridView.</span></span> <span data-ttu-id="9a1c6-142">В этом учебнике, давайте второй вариант следует использовать и создать перегрузку `UpdateProduct` метод, принимающий только три входных параметра: `productName`, `unitPrice`, и `productID`:</span><span class="sxs-lookup"><span data-stu-id="9a1c6-142">For this tutorial, let's use the latter option and create an overload of the `UpdateProduct` method, one that takes in just three input parameters: `productName`, `unitPrice`, and `productID`:</span></span>


[!code-csharp[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample1.cs)]

<span data-ttu-id="9a1c6-143">Как и исходный `UpdateProduct` метод, эта перегрузка начинает с проверки, существует ли продукт в базе данных с указанным `ProductID`.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-143">Like the original `UpdateProduct` method, this overload starts by checking to see if there is a product in the database with the specified `ProductID`.</span></span> <span data-ttu-id="9a1c6-144">Если нет, она возвращает `false`, указывающее, что не удалось выполнить запрос, чтобы обновить сведения о продукте.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-144">If not, it returns `false`, indicating that the request to update the product information failed.</span></span> <span data-ttu-id="9a1c6-145">В противном случае он обновляет существующую запись продукта `ProductName` и `UnitPrice` полей соответствующим образом и обновление фиксируется путем вызова TableAdpater `Update()` метод, передавая `ProductsRow` экземпляра.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-145">Otherwise it updates the existing product record's `ProductName` and `UnitPrice` fields accordingly and commits the update by calling the TableAdpater's `Update()` method, passing in the `ProductsRow` instance.</span></span>

<span data-ttu-id="9a1c6-146">Сделав это добавление к нашей `ProductsBLL` класса, мы готовы создавать упрощенный интерфейс GridView.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-146">With this addition to our `ProductsBLL` class, we're ready to create the simplified GridView interface.</span></span> <span data-ttu-id="9a1c6-147">Откройте `DataModificationEvents.aspx` в `EditInsertDelete` папку и добавить на страницу элемент управления GridView.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-147">Open the `DataModificationEvents.aspx` in the `EditInsertDelete` folder and add a GridView to the page.</span></span> <span data-ttu-id="9a1c6-148">Создать новый элемент управления ObjectDataSource и настройте его для использования `ProductsBLL` класса с его `Select()` сопоставление метод `GetProducts` и его `Update()` сопоставление метод `UpdateProduct` перегрузку, которая принимает только `productName`, `unitPrice`, и `productID` входные параметры.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-148">Create a new ObjectDataSource and configure it to use the `ProductsBLL` class with its `Select()` method mapping to `GetProducts` and its `Update()` method mapping to the `UpdateProduct` overload that takes in only the `productName`, `unitPrice`, and `productID` input parameters.</span></span> <span data-ttu-id="9a1c6-149">На рисунке 2 представлен мастер создания источника данных, при сопоставлении элемента управления ObjectDataSource `Update()` метод `ProductsBLL` для нового класса `UpdateProduct` перегрузки метода.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-149">Figure 2 shows the Create Data Source wizard when mapping the ObjectDataSource's `Update()` method to the `ProductsBLL` class's new `UpdateProduct` method overload.</span></span>


<span data-ttu-id="9a1c6-150">[![Новая перегрузка метода UpdateProduct сопоставить метод Update() ObjectDataSource](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image5.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-150">[![Map the ObjectDataSource's Update() Method to the New UpdateProduct Overload](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image5.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image4.png)</span></span>

<span data-ttu-id="9a1c6-151">**Рис. 2**: сопоставление ObjectDataSource `Update()` метод создать `UpdateProduct` перегрузки ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-151">**Figure 2**: Map the ObjectDataSource's `Update()` Method to the New `UpdateProduct` Overload ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image6.png))</span></span>


<span data-ttu-id="9a1c6-152">Так как в нашем примере исходно требуется только возможность изменять данные, но не вставлять или удалять записи, пора явно указывать, что элемент управления ObjectDataSource `Insert()` и `Delete()` методы не должны сопоставляться с любой из `ProductsBLL` методы класса, перейдя на вкладках INSERT и DELETE и выбора (нет) из раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-152">Since our example will initially just need the ability to edit data, but not to insert or delete records, take a moment to explicitly indicate that the ObjectDataSource's `Insert()` and `Delete()` methods shouldn't be mapped to any of the `ProductsBLL` class's methods by going to the INSERT and DELETE tabs and choosing (None) from the drop-down list.</span></span>


<span data-ttu-id="9a1c6-153">[![(Нет) выберите из раскрывающегося списка для вставки и удаления вкладок](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image8.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-153">[![Choose (None) From the Drop-Down List for the INSERT and DELETE Tabs](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image8.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image7.png)</span></span>

<span data-ttu-id="9a1c6-154">**Рис. 3**: параметр (нет) из раскрывающегося списка для вставки и удаления вкладок ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-154">**Figure 3**: Choose (None) From the Drop-Down List for the INSERT and DELETE Tabs ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image9.png))</span></span>


<span data-ttu-id="9a1c6-155">После завершения работы мастера установите флажок Разрешить изменение смарт-теге элемента GridView.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-155">After completing this wizard check the Enable Editing checkbox from the GridView's smart tag.</span></span>

<span data-ttu-id="9a1c6-156">С помощью мастера создания источника данных и привязки, к GridView завершение создаваемые в Visual Studio декларативный синтаксис для обоих элементов управления.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-156">With the completion of the Create Data Source wizard and binding that to the GridView, Visual Studio has created the declarative syntax for both controls.</span></span> <span data-ttu-id="9a1c6-157">Перейдите к представлению источника для проверки элемента управления ObjectDataSource декларативная разметка, как показано ниже:</span><span class="sxs-lookup"><span data-stu-id="9a1c6-157">Go to the Source view to inspect the ObjectDataSource's declarative markup, which is shown below:</span></span>


[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample2.aspx)]

<span data-ttu-id="9a1c6-158">Поскольку нет сопоставлений для элемента управления ObjectDataSource `Insert()` и `Delete()` методов, существуют не `InsertParameters` или `DeleteParameters` разделы.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-158">Since there are no mappings for the ObjectDataSource's `Insert()` and `Delete()` methods, there are no `InsertParameters` or `DeleteParameters` sections.</span></span> <span data-ttu-id="9a1c6-159">Кроме того, с момента `Update()` метода сопоставлен `UpdateProduct` перегрузки метода, который принимает три входных параметра только `UpdateParameters` присутствуют только три экземпляра `Parameter` экземпляров.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-159">Furthermore, since the `Update()` method is mapped to the `UpdateProduct` method overload that only accepts three input parameters, the `UpdateParameters` section has just three `Parameter` instances.</span></span>

<span data-ttu-id="9a1c6-160">Обратите внимание, что элемент управления ObjectDataSource `OldValuesParameterFormatString` свойству `original_{0}`.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-160">Note that the ObjectDataSource's `OldValuesParameterFormatString` property is set to `original_{0}`.</span></span> <span data-ttu-id="9a1c6-161">Это свойство задается с помощью Visual Studio автоматически, при использовании мастера настройки источника данных.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-161">This property is set automatically by Visual Studio when using the Configure Data Source wizard.</span></span> <span data-ttu-id="9a1c6-162">Тем не менее поскольку наши методы уровень бизнес-ЛОГИКИ не ожидается, что исходный `ProductID` значение для передачи, полностью удалить назначение этого свойства элемента управления ObjectDataSource декларативного синтаксиса.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-162">However, since our BLL methods don't expect the original `ProductID` value to be passed in, remove this property assignment altogether from the ObjectDataSource's declarative syntax.</span></span>

> [!NOTE]
> <span data-ttu-id="9a1c6-163">Если просто очистить `OldValuesParameterFormatString` значение свойства в окне свойств в режиме конструктора, свойство по-прежнему будет существовать в декларативного синтаксиса, но устанавливается равным пустой строке.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-163">If you simply clear out the `OldValuesParameterFormatString` property value from the Properties window in the Design view, the property will still exist in the declarative syntax, but will be set to an empty string.</span></span> <span data-ttu-id="9a1c6-164">Либо удалите полностью из декларативного синтаксиса, или в окне свойств свойство значение по умолчанию `{0}`.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-164">Either remove the property altogether from the declarative syntax or, from the Properties window, set the value to the default, `{0}`.</span></span>


<span data-ttu-id="9a1c6-165">Хотя элемент управления ObjectDataSource имеет только `UpdateParameters` для имени продукта, цену и идентификатор, среда Visual Studio добавила BoundField или CheckBoxField в GridView для каждого из полей продукта.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-165">While the ObjectDataSource only has `UpdateParameters` for the product's name, price, and ID, Visual Studio has added a BoundField or CheckBoxField in the GridView for each of the product's fields.</span></span>


<span data-ttu-id="9a1c6-166">[![Содержит GridView BoundField или CheckBoxField для каждого из полей продукта](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image11.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-166">[![The GridView Contains a BoundField or CheckBoxField for Each of the Product's Fields](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image11.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image10.png)</span></span>

<span data-ttu-id="9a1c6-167">**Рис. 4**: содержит GridView BoundField или CheckBoxField для каждого из полей продукта ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-167">**Figure 4**: The GridView Contains a BoundField or CheckBoxField for Each of the Product's Fields ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image12.png))</span></span>


<span data-ttu-id="9a1c6-168">Если конечный пользователь редактирует продукта и нажатия кнопки его обновление GridView перечисляются эти поля, которые не были доступны только для чтения.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-168">When the end user edits a product and clicks its Update button, the GridView enumerates those fields that were not read-only.</span></span> <span data-ttu-id="9a1c6-169">Затем устанавливает значение соответствующего параметра в коллекции `UpdateParameters` коллекции до значения, введенные пользователем.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-169">It then sets the value of the corresponding parameter in the ObjectDataSource's `UpdateParameters` collection to the value entered by the user.</span></span> <span data-ttu-id="9a1c6-170">Если не создается соответствующий параметр, GridView добавляет ее в коллекцию.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-170">If there is not a corresponding parameter, the GridView adds one to the collection.</span></span> <span data-ttu-id="9a1c6-171">Таким образом, если наш GridView содержит стояли и CheckBoxFields для всех полей продукта, ObjectDataSource вызовет перегрузку `UpdateProduct` , принимающую все эти параметры, несмотря на то, что элемент управления ObjectDataSource декларативная разметка указывает только три входных параметра (см. рис. 5).</span><span class="sxs-lookup"><span data-stu-id="9a1c6-171">Therefore, if our GridView contains BoundFields and CheckBoxFields for all of the product's fields, the ObjectDataSource will end up invoking the `UpdateProduct` overload that takes in all of these parameters, despite the fact that the ObjectDataSource's declarative markup specifies only three input parameters (see Figure 5).</span></span> <span data-ttu-id="9a1c6-172">Аналогично, если сочетание не — только для чтения продукта полей в GridView, не соответствует входные параметры для `UpdateProduct` перегрузки, будет вызвано исключение при попытке обновления.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-172">Similarly, if there is some combination of non-read-only product fields in the GridView that doesn't correspond to the input parameters for a `UpdateProduct` overload, an exception will be raised when attempting to update.</span></span>


<span data-ttu-id="9a1c6-173">[![GridView будет добавлять параметры для элемента управления ObjectDataSource UpdateParameters коллекции](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image14.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-173">[![The GridView Will Add Parameters to the ObjectDataSource's UpdateParameters Collection](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image14.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image13.png)</span></span>

<span data-ttu-id="9a1c6-174">**Рис. 5**: GridView будет добавить параметры в элемент управления ObjectDataSource `UpdateParameters` коллекции ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-174">**Figure 5**: The GridView Will Add Parameters to the ObjectDataSource's `UpdateParameters` Collection ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image15.png))</span></span>


<span data-ttu-id="9a1c6-175">Чтобы убедиться, что вызывает элемент управления ObjectDataSource `UpdateProduct` , принимающую только продукта имя, цену и идентификатор, нам нужно ограничить GridView полями для только что `ProductName` и `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-175">To ensure that the ObjectDataSource invokes the `UpdateProduct` overload that takes in just the product's name, price, and ID, we need to restrict the GridView to having editable fields for just the `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="9a1c6-176">Это можно сделать, удалив стояли и CheckBoxFields, задав те других полей `ReadOnly` свойства `true`, или с помощью некоторого сочетания двух.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-176">This can be accomplished by removing the other BoundFields and CheckBoxFields, by setting those other fields' `ReadOnly` property to `true`, or by some combination of the two.</span></span> <span data-ttu-id="9a1c6-177">В этом учебнике Давайте просто удалите все поля GridView, кроме `ProductName` и `UnitPrice` стояли, после чего GridView будет выглядеть как:</span><span class="sxs-lookup"><span data-stu-id="9a1c6-177">For this tutorial let's simply remove all GridView fields except the `ProductName` and `UnitPrice` BoundFields, after which the GridView's declarative markup will look like:</span></span>


[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample3.aspx)]

<span data-ttu-id="9a1c6-178">Несмотря на то что `UpdateProduct` рассчитывает на три входных параметра, у нас имеется только два стояли в нашем GridView.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-178">Even though the `UpdateProduct` overload expects three input parameters, we only have two BoundFields in our GridView.</span></span> <span data-ttu-id="9a1c6-179">Это вызвано `productID` входной параметр имеет значение первичного ключа и передать значение `DataKeyNames` свойства для измененной строки.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-179">This is because the `productID` input parameter is a primary key value and passed in through the value of the `DataKeyNames` property for the edited row.</span></span>

<span data-ttu-id="9a1c6-180">Наш GridView, вместе с `UpdateProduct` перегрузки дает пользователю возможность изменять только имя и цену продукта без потери каких-либо другие поля продукта.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-180">Our GridView, along with the `UpdateProduct` overload, allows a user to edit just the name and price of a product without losing any of the other product fields.</span></span>


<span data-ttu-id="9a1c6-181">[![Интерфейс позволяет редактировать только имя и цену продукта](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image17.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-181">[![The Interface Allows Editing Just the Product's Name and Price](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image17.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image16.png)</span></span>

<span data-ttu-id="9a1c6-182">**Рис. 6**: позволяет интерфейса, изменение только имя и цену продукта ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-182">**Figure 6**: The Interface Allows Editing Just the Product's Name and Price ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image18.png))</span></span>


> [!NOTE]
> <span data-ttu-id="9a1c6-183">Как описано в предыдущем учебнике жизненно важна, GridView, быть s состояния просмотра включена (по умолчанию).</span><span class="sxs-lookup"><span data-stu-id="9a1c6-183">As discussed in the previous tutorial, it is vitally important that the GridView s view state be enabled (the default behavior).</span></span> <span data-ttu-id="9a1c6-184">Если задать GridView s `EnableViewState` свойства `false`, увеличивается риск того что параллельно работающие пользователи непреднамеренно удаление или изменение записей.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-184">If you set the GridView s `EnableViewState` property to `false`, you run the risk of having concurrent users unintentionally deleting or editing records.</span></span> <span data-ttu-id="9a1c6-185">В разделе [предупреждение: проблемы параллелизма с ASP.NET 2.0 GridViews/DetailsView/FormViews, поддерживают редактирование или удаление и с состояние просмотра отключено](http://scottonwriting.net/sowblog/archive/2006/10/03/163215.aspx) для получения дополнительной информации.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-185">See [WARNING: Concurrency Issue with ASP.NET 2.0 GridViews/DetailsView/FormViews that Support Editing and/or Deleting and Whose View State is Disabled](http://scottonwriting.net/sowblog/archive/2006/10/03/163215.aspx) for more information.</span></span>


## <a name="improving-theunitpriceformatting"></a><span data-ttu-id="9a1c6-186">Повышение`UnitPrice`форматирование</span><span class="sxs-lookup"><span data-stu-id="9a1c6-186">Improving the`UnitPrice`Formatting</span></span>

<span data-ttu-id="9a1c6-187">Пример GridView, показано на рис. 6 работает, а `UnitPrice` поле вообще не отформатирован, что приводит к отображению цены не обеспечивает валют, символов и имеет четыре десятичных разряда.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-187">While the GridView example shown in Figure 6 works, the `UnitPrice` field is not formatted at all, resulting in a price display that lacks any currency symbols and has four decimal places.</span></span> <span data-ttu-id="9a1c6-188">Чтобы применить форматирование для неизменяемых строк денежных единиц, просто установите `UnitPrice` BoundField `DataFormatString` свойства `{0:c}` и его `HtmlEncode` свойства `false`.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-188">To apply a currency formatting for the non-editable rows, simply set the `UnitPrice` BoundField's `DataFormatString` property to `{0:c}` and its `HtmlEncode` property to `false`.</span></span>


<span data-ttu-id="9a1c6-189">[![Задание свойств HtmlEncode и DataFormatString UnitPrice соответствующим образом](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image20.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-189">[![Set the UnitPrice's DataFormatString and HtmlEncode Properties Accordingly](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image20.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image19.png)</span></span>

<span data-ttu-id="9a1c6-190">**Рис. 7**: задать `UnitPrice` `DataFormatString` и `HtmlEncode` свойства соответствующим образом ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-190">**Figure 7**: Set the `UnitPrice`'s `DataFormatString` and `HtmlEncode` Properties Accordingly ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image21.png))</span></span>


<span data-ttu-id="9a1c6-191">Благодаря этому изменению нередактируемые строк цена форматируется как денежное значение; Тем не менее, редактируемой строки по-прежнему отображается значение без знака денежной единицы и четыре десятичных разряда.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-191">With this change, the non-editable rows format the price as a currency; the edited row, however, still displays the value without the currency symbol and with four decimal places.</span></span>


<span data-ttu-id="9a1c6-192">[![Нередактируемые строки являются отформатирован в виде значения валюты](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image23.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-192">[![Non-Editable Rows are Now Formatted as Currency Values](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image23.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image22.png)</span></span>

<span data-ttu-id="9a1c6-193">**Рис. 8**: неизменяемые строки, отформатирован в виде значения валюты ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-193">**Figure 8**: Non-Editable Rows are Now Formatted as Currency Values ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image24.png))</span></span>


<span data-ttu-id="9a1c6-194">Указанный в инструкции форматирования `DataFormatString` свойства могут применяться к интерфейсу редактирования установим для `ApplyFormatInEditMode` свойства `true` (значение по умолчанию — `false`).</span><span class="sxs-lookup"><span data-stu-id="9a1c6-194">The formatting instructions specified in the `DataFormatString` property can be applied to the editing interface by setting the BoundField's `ApplyFormatInEditMode` property to `true` (the default is `false`).</span></span> <span data-ttu-id="9a1c6-195">Теперь пора присвоить этому свойству значение `true`.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-195">Take a moment to set this property to `true`.</span></span>


<span data-ttu-id="9a1c6-196">[![UnitPrice BoundField ApplyFormatInEditMode свойство имеет значение true](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image26.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-196">[![Set the UnitPrice BoundField's ApplyFormatInEditMode property to true](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image26.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image25.png)</span></span>

<span data-ttu-id="9a1c6-197">**Рис. 9**: задать `UnitPrice` BoundField `ApplyFormatInEditMode` свойства `true` ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-197">**Figure 9**: Set the `UnitPrice` BoundField's `ApplyFormatInEditMode` property to `true` ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image27.png))</span></span>


<span data-ttu-id="9a1c6-198">Благодаря этому изменению значение `UnitPrice` отображаются в измененной строки также форматируются как денежное значение.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-198">With this change, the value of the `UnitPrice` displayed in the edited row is also formatted as a currency.</span></span>


<span data-ttu-id="9a1c6-199">[![Значение UnitPrice строки редактирования — отформатирован в виде валюты](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image29.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-199">[![The Edited Row's UnitPrice Value is Now Formatted as a Currency](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image29.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image28.png)</span></span>

<span data-ttu-id="9a1c6-200">**Рис. 10**: изменить строки `UnitPrice` значение — отформатирован в виде валюты ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-200">**Figure 10**: The Edited Row's `UnitPrice` Value is Now Formatted as a Currency ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image30.png))</span></span>


<span data-ttu-id="9a1c6-201">Однако обновление продукта с символом денежной единицы в текстовом поле, такие как $19,00 вызывает `FormatException`.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-201">However, updating a product with the currency symbol in the textbox such as $19.00 throws a `FormatException`.</span></span> <span data-ttu-id="9a1c6-202">При попытке назначить введенных пользователем значений элемента управления ObjectDataSource GridView `UpdateParameters` коллекции, его не удается преобразовать `UnitPrice` строку «$19,00» в `decimal` требует параметр (см. рис. 11).</span><span class="sxs-lookup"><span data-stu-id="9a1c6-202">When the GridView attempts to assign the user-supplied values to the ObjectDataSource's `UpdateParameters` collection it is unable to convert the `UnitPrice` string "$19.00" into the `decimal` required by the parameter (see Figure 11).</span></span> <span data-ttu-id="9a1c6-203">Чтобы устранить эту можно создать обработчик событий для элемента GridView `RowUpdating` событие и его синтаксический анализ, предоставленное пользователем `UnitPrice` в формате валюты `decimal`.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-203">To remedy this we can create an event handler for the GridView's `RowUpdating` event and have it parse the user-supplied `UnitPrice` as a currency-formatted `decimal`.</span></span>

<span data-ttu-id="9a1c6-204">GridView `RowUpdating` событий принимает в качестве второго параметра объект типа [GridViewUpdateEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdateeventargs(VS.80).aspx), которая содержит `NewValues` в качестве одного из его свойств введенных пользователем значений готовые для назначенные ObjectDataSource `UpdateParameters` коллекции.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-204">The GridView's `RowUpdating` event accepts as its second parameter an object of type [GridViewUpdateEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdateeventargs(VS.80).aspx), which includes a `NewValues` dictionary as one of its properties that holds the user-supplied values ready to be assigned to the ObjectDataSource's `UpdateParameters` collection.</span></span> <span data-ttu-id="9a1c6-205">Мы существующее значение `UnitPrice` значение в `NewValues` синтаксический анализ коллекции с десятичным значением в формате валюты с помощью следующего фрагмента кода в `RowUpdating` обработчик событий:</span><span class="sxs-lookup"><span data-stu-id="9a1c6-205">We can overwrite the existing `UnitPrice` value in the `NewValues` collection with a decimal value parsed using the currency format with the following lines of code in the `RowUpdating` event handler:</span></span>


[!code-csharp[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample4.cs)]

<span data-ttu-id="9a1c6-206">Если пользователь предоставил `UnitPrice` значение (например, «$19,00»), это значение перезаписывается десятичное значение, вычисленное по [Decimal.Parse](https://msdn.microsoft.com/library/system.decimal.parse(VS.80).aspx), синтаксический анализ как денежное значение.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-206">If the user has supplied a `UnitPrice` value (such as "$19.00"), this value is overwritten with the decimal value computed by [Decimal.Parse](https://msdn.microsoft.com/library/system.decimal.parse(VS.80).aspx), parsing the value as a currency.</span></span> <span data-ttu-id="9a1c6-207">Это будет разбирать десятичного разделителя в случае символы валют, запятые, десятичного разделителя и т. д и использует [перечисления NumberStyles](https://msdn.microsoft.com/library/system.globalization.numberstyles(VS.80).aspx) в [System.Globalization](https://msdn.microsoft.com/library/abeh092z(VS.80).aspx) пространства имен.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-207">This will correctly parse the decimal in the event of any currency symbols, commas, decimal points, and so on, and uses the [NumberStyles enumeration](https://msdn.microsoft.com/library/system.globalization.numberstyles(VS.80).aspx) in the [System.Globalization](https://msdn.microsoft.com/library/abeh092z(VS.80).aspx) namespace.</span></span>

<span data-ttu-id="9a1c6-208">Рис. 11 показана проблемы, вызванные символы валют в предоставленный пользователем `UnitPrice`, а также как GridView `RowUpdating` обработчик событий можно использовать для анализа таких входных данных правильно.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-208">Figure 11 shows both the problem caused by currency symbols in the user-supplied `UnitPrice`, along with how the GridView's `RowUpdating` event handler can be utilized to correctly parse such input.</span></span>


<span data-ttu-id="9a1c6-209">[![Значение UnitPrice строки редактирования — отформатирован в виде валюты](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image32.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-209">[![The Edited Row's UnitPrice Value is Now Formatted as a Currency](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image32.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image31.png)</span></span>

<span data-ttu-id="9a1c6-210">**Рис. 11**: изменить строки `UnitPrice` значение — отформатирован в виде валюты ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-210">**Figure 11**: The Edited Row's `UnitPrice` Value is Now Formatted as a Currency ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image33.png))</span></span>


## <a name="step-2-prohibitingnull-unitprices"></a><span data-ttu-id="9a1c6-211">Шаг 2: Запрет`NULL UnitPrices`</span><span class="sxs-lookup"><span data-stu-id="9a1c6-211">Step 2: Prohibiting`NULL UnitPrices`</span></span>

<span data-ttu-id="9a1c6-212">Пока база данных настроена так, чтобы разрешить `NULL` значения в `Products` таблицы `UnitPrice` столбец, нужно запретить пользователям, посетив страницу из указание `NULL` `UnitPrice` значение.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-212">While the database is configured to allow `NULL` values in the `Products` table's `UnitPrice` column, we may want to prevent users visiting this particular page from specifying a `NULL` `UnitPrice` value.</span></span> <span data-ttu-id="9a1c6-213">То есть если пользователь не ввел `UnitPrice` значение при редактировании строку продукта, а не сохранить результаты в базу данных, необходимо отобразить сообщение о том, что на данной странице всех изменяемых продуктов необходимо указывать цену.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-213">That is, if a user fails to enter a `UnitPrice` value when editing a product row, rather than save the results to the database we want to display a message informing the user that, through this page, any edited products must have a price specified.</span></span>

<span data-ttu-id="9a1c6-214">`GridViewUpdateEventArgs` , Переданное в GridView `RowUpdating` обработчик события содержит `Cancel` свойства, если значение `true`, завершает процесс обновления.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-214">The `GridViewUpdateEventArgs` object passed into the GridView's `RowUpdating` event handler contains a `Cancel` property that, if set to `true`, terminates the updating process.</span></span> <span data-ttu-id="9a1c6-215">Расширим `RowUpdating` обработчик событий, чтобы задать `e.Cancel` для `true` и отображать сообщение о том, почему при `UnitPrice` значение в `NewValues` коллекция `null`.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-215">Let's extend the `RowUpdating` event handler to set `e.Cancel` to `true` and display a message explaining why if the `UnitPrice` value in the `NewValues` collection is `null`.</span></span>

<span data-ttu-id="9a1c6-216">Начните с добавления веб-управления Label на страницу с именем `MustProvideUnitPriceMessage`.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-216">Start by adding a Label Web control to the page named `MustProvideUnitPriceMessage`.</span></span> <span data-ttu-id="9a1c6-217">Этот элемент управления Label будет отображаться, если пользователь не указал `UnitPrice` значение при обновлении продукта.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-217">This Label control will be displayed if the user fails to specify a `UnitPrice` value when updating a product.</span></span> <span data-ttu-id="9a1c6-218">Задайте для свойства Label `Text` свойства «Необходимо указать цену продукта.»</span><span class="sxs-lookup"><span data-stu-id="9a1c6-218">Set the Label's `Text` property to "You must provide a price for the product."</span></span> <span data-ttu-id="9a1c6-219">Также создали класс CSS в `Styles.css` с именем `Warning` со следующим определением:</span><span class="sxs-lookup"><span data-stu-id="9a1c6-219">I've also created a new CSS class in `Styles.css` named `Warning` with the following definition:</span></span>


[!code-css[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample5.css)]

<span data-ttu-id="9a1c6-220">Наконец, задайте для свойства Label `CssClass` свойства `Warning`.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-220">Finally, set the Label's `CssClass` property to `Warning`.</span></span> <span data-ttu-id="9a1c6-221">В этот момент конструктор должен вывести сообщение с предупреждением в красный, полужирный, курсив, очень большой размер выше GridView, как показано на рис. 12.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-221">At this point the Designer should show the warning message in a red, bold, italic, extra large font size above the GridView, as shown in Figure 12.</span></span>


<span data-ttu-id="9a1c6-222">[![Метка будет добавлен над элементом управления GridView](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image35.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-222">[![A Label Has Been Added Above the GridView](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image35.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image34.png)</span></span>

<span data-ttu-id="9a1c6-223">**Рис. 12**: метка имеет были добавлены выше GridView ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-223">**Figure 12**: A Label Has Been Added Above the GridView ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image36.png))</span></span>


<span data-ttu-id="9a1c6-224">По умолчанию эта метка должен быть скрыт, поэтому установите его `Visible` свойства `false` в `Page_Load` обработчик событий:</span><span class="sxs-lookup"><span data-stu-id="9a1c6-224">By default, this Label should be hidden, so set its `Visible` property to `false` in the `Page_Load` event handler:</span></span>


[!code-csharp[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample6.cs)]

<span data-ttu-id="9a1c6-225">Если пользователь пытается обновить продукт без указания `UnitPrice`, нам нужно отменить обновление и отобразить предупреждение.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-225">If the user attempts to update a product without specifying the `UnitPrice`, we want to cancel the update and display the warning label.</span></span> <span data-ttu-id="9a1c6-226">Дополнять GridView `RowUpdating` обработчик событий следующим образом:</span><span class="sxs-lookup"><span data-stu-id="9a1c6-226">Augment the GridView's `RowUpdating` event handler as follows:</span></span>


[!code-csharp[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample7.cs)]

<span data-ttu-id="9a1c6-227">Если пользователь пытается сохранить продукт без указания цены, обновление отменяется, и отображается информационное сообщение.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-227">If a user attempts to save a product without specifying a price, the update is cancelled and a helpful message is displayed.</span></span> <span data-ttu-id="9a1c6-228">Хотя базы данных (и бизнес-логики) позволяет `NULL` `UnitPrice` s, эта конкретная страница ASP.NET — нет.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-228">While the database (and business logic) allows for `NULL` `UnitPrice` s, this particular ASP.NET page does not.</span></span>


<span data-ttu-id="9a1c6-229">[![Пользователь нельзя оставлять пустым UnitPrice](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image38.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-229">[![A User Cannot Leave UnitPrice Blank](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image38.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image37.png)</span></span>

<span data-ttu-id="9a1c6-230">**Рис. 13**: пользователь не может быть передано `UnitPrice` пустой ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-230">**Figure 13**: A User Cannot Leave `UnitPrice` Blank ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image39.png))</span></span>


<span data-ttu-id="9a1c6-231">Пока мы рассмотрели использование GridView `RowUpdating` событий для программного изменения значений параметров, назначенные ObjectDataSource `UpdateParameters` коллекции также как для отмены процедуры обновления полностью.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-231">So far we have seen how to use the GridView's `RowUpdating` event to programmatically alter the parameter values assigned to the ObjectDataSource's `UpdateParameters` collection as well as how to cancel the updating process altogether.</span></span> <span data-ttu-id="9a1c6-232">Эти концепции переносятся на элементы управления DetailsView и FormView и справедливы и для вставки и удаления.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-232">These concepts carry over to the DetailsView and FormView controls and also apply to inserting and deleting.</span></span>

<span data-ttu-id="9a1c6-233">Эти задачи можно также на уровне ObjectDataSource с помощью обработчиков событий для его `Inserting`, `Updating`, и `Deleting` события.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-233">These tasks can also be done at the ObjectDataSource level through event handlers for its `Inserting`, `Updating`, and `Deleting` events.</span></span> <span data-ttu-id="9a1c6-234">Эти события срабатывают до вызова соответствующего метода базового объекта и укажите последнюю возможность изменить коллекцию входных параметров или отменить операцию.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-234">These events fire before the associated method of the underlying object is invoked and provide a last-chance opportunity to modify the input parameters collection or cancel the operation outright.</span></span> <span data-ttu-id="9a1c6-235">Обработчики событий для этих трех событий передаются в объект типа [ObjectDataSourceMethodEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs(VS.80).aspx) , имеет два свойства, представляющие интерес:</span><span class="sxs-lookup"><span data-stu-id="9a1c6-235">The event handlers for these three events are passed an object of type [ObjectDataSourceMethodEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs(VS.80).aspx) that has two properties of interest:</span></span>

- <span data-ttu-id="9a1c6-236">[Отмена](https://msdn.microsoft.com/library/system.componentmodel.canceleventargs.cancel(VS.80).aspx), который, если значение `true`, отмена выполняемой операции.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-236">[Cancel](https://msdn.microsoft.com/library/system.componentmodel.canceleventargs.cancel(VS.80).aspx), which, if set to `true`, cancels the operation being performed</span></span>
- <span data-ttu-id="9a1c6-237">[InputParameters](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs.inputparameters(VS.80).aspx), которое представляет собой коллекцию из `InsertParameters`, `UpdateParameters`, или `DeleteParameters`в зависимости от того, является ли обработчик событий для `Inserting`, `Updating`, или `Deleting` событий</span><span class="sxs-lookup"><span data-stu-id="9a1c6-237">[InputParameters](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs.inputparameters(VS.80).aspx), which is the collection of `InsertParameters`, `UpdateParameters`, or `DeleteParameters`, depending on whether the event handler is for the `Inserting`, `Updating`, or `Deleting` event</span></span>

<span data-ttu-id="9a1c6-238">Чтобы продемонстрировать работу со значениями параметров на уровне ObjectDataSource, включим DetailsView в нашу страницу, которая позволяет пользователям добавлять новый продукт.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-238">To illustrate working with the parameter values at the ObjectDataSource level, let's include a DetailsView in our page that allows the users to add a new product.</span></span> <span data-ttu-id="9a1c6-239">Это DetailsView будет использоваться для обеспечения интерфейса для быстрого добавления нового продукта в базу данных.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-239">This DetailsView will be used to provide an interface for quickly adding a new product to the database.</span></span> <span data-ttu-id="9a1c6-240">При добавлении нового продукта позволяет разрешить пользователю только введите значения для следует согласованного пользовательского интерфейса `ProductName` и `UnitPrice` поля.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-240">To keep a consistent user interface when adding a new product let's allow the user to only enter values for the `ProductName` and `UnitPrice` fields.</span></span> <span data-ttu-id="9a1c6-241">По умолчанию эти значения, которые не предоставляются в интерфейсе вставки DetailsView будет присвоено `NULL` значение базы данных.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-241">By default, those values that aren't supplied in the DetailsView's inserting interface will be set to a `NULL` database value.</span></span> <span data-ttu-id="9a1c6-242">Тем не менее, можно использовать элемент управления ObjectDataSource `Inserting` событие, чтобы ввести другие значения по умолчанию, как мы рассмотрим чуть ниже.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-242">However, we can use the ObjectDataSource's `Inserting` event to inject different default values, as we'll see shortly.</span></span>

## <a name="step-3-providing-an-interface-to-add-new-products"></a><span data-ttu-id="9a1c6-243">Шаг 3: Создание интерфейса для добавления новых продуктов</span><span class="sxs-lookup"><span data-stu-id="9a1c6-243">Step 3: Providing an Interface to Add New Products</span></span>

<span data-ttu-id="9a1c6-244">Перетащите DetailsView из области элементов в конструктор выше GridView, очистить его `Height` и `Width` свойств и связывание его в элемент управления ObjectDataSource, имеющиеся на странице.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-244">Drag a DetailsView from the Toolbox onto the Designer above the GridView, clear out its `Height` and `Width` properties, and bind it to the ObjectDataSource already present on the page.</span></span> <span data-ttu-id="9a1c6-245">Это добавит BoundField или CheckBoxField для каждого из полей продукта.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-245">This will add a BoundField or CheckBoxField for each of the product's fields.</span></span> <span data-ttu-id="9a1c6-246">Поскольку мы хотим использовать этот DetailsView для добавления новых продуктов, нам нужно из смарт-тега; установите флажок Разрешить вставку Однако нет такого параметра нет, так как элемент управления ObjectDataSource `Insert()` метода не сопоставлен метод в `ProductsBLL` класса (Напомним, что это сопоставление (нет) задается при настройке источника данных см. рис. 3).</span><span class="sxs-lookup"><span data-stu-id="9a1c6-246">Since we want to use this DetailsView to add new products, we need to check the Enable Inserting option from the smart tag; however, there's no such option because the ObjectDataSource's `Insert()` method is not mapped to a method in the `ProductsBLL` class (recall that we set this mapping to (None) when configuring the data source see Figure 3).</span></span>

<span data-ttu-id="9a1c6-247">Чтобы настроить элемент управления ObjectDataSource, выберите эту ссылку настройки источника данных в его смарт-теге, запуск мастера.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-247">To configure the ObjectDataSource, select the Configure Data Source link from its smart tag, launching the wizard.</span></span> <span data-ttu-id="9a1c6-248">Первый экран позволяет изменять базовый объект, с которым связан элемент управления ObjectDataSource; Оставьте для `ProductsBLL`.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-248">The first screen allows you to change the underlying object the ObjectDataSource is bound to; leave it set to `ProductsBLL`.</span></span> <span data-ttu-id="9a1c6-249">На следующем экране перечисляются сопоставления с помощью методов элемента управления ObjectDataSource к базовому объекту.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-249">The next screen lists the mappings from the ObjectDataSource's methods to the underlying object's.</span></span> <span data-ttu-id="9a1c6-250">Несмотря на то, что мы явно указано, что `Insert()` и `Delete()` методы не должны сопоставляться ко всем методам, если перейти на вкладках INSERT и DELETE вы увидите, что там находится сопоставление.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-250">Even though we explicitly indicated that the `Insert()` and `Delete()` methods should not be mapped to any methods, if you go to the INSERT and DELETE tabs you'll see that a mapping is there.</span></span> <span data-ttu-id="9a1c6-251">Это вызвано `ProductsBLL` `AddProduct` и `DeleteProduct` методы используют `DataObjectMethodAttribute` атрибут, чтобы указать, что они являются методами по умолчанию для `Insert()` и `Delete()`соответственно.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-251">This is because the `ProductsBLL`'s `AddProduct` and `DeleteProduct` methods use the `DataObjectMethodAttribute` attribute to indicate that they are the default methods for `Insert()` and `Delete()`, respectively.</span></span> <span data-ttu-id="9a1c6-252">Таким образом мастер ObjectDataSource выбирает эти каждый раз при запуске мастера при отсутствии явно указано другое значение.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-252">Hence, the ObjectDataSource wizard selects these each time you run the wizard unless there's some other value explicitly specified.</span></span>

<span data-ttu-id="9a1c6-253">Оставить `Insert()` метод, указывающий `AddProduct` метода, но снова установить раскрывающемся списке вкладки DELETE (нет).</span><span class="sxs-lookup"><span data-stu-id="9a1c6-253">Leave the `Insert()` method pointing to the `AddProduct` method, but again set the DELETE tab's drop-down list to (None).</span></span>


<span data-ttu-id="9a1c6-254">[![Метод AddProduct значение вкладки «Вставка» раскрывающегося списка](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image41.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-254">[![Set the INSERT Tab's Drop-Down List to the AddProduct Method](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image41.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image40.png)</span></span>

<span data-ttu-id="9a1c6-255">**Рис. 14**: значение раскрывающегося списка вкладку Вставка `AddProduct` метод ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-255">**Figure 14**: Set the INSERT Tab's Drop-Down List to the `AddProduct` Method ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image42.png))</span></span>


<span data-ttu-id="9a1c6-256">[![Значение в раскрывающемся списке вкладки DELETE (нет)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image44.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-256">[![Set the DELETE Tab's Drop-Down List to (None)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image44.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image43.png)</span></span>

<span data-ttu-id="9a1c6-257">**Рис. 15**: задать удаление вкладки в раскрывающемся списке (нет) ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-257">**Figure 15**: Set the DELETE Tab's Drop-Down List to (None) ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image45.png))</span></span>


<span data-ttu-id="9a1c6-258">После внесения этих изменений, ObjectDataSource декларативный синтаксис будет расширен для включения `InsertParameters` коллекции, как показано ниже:</span><span class="sxs-lookup"><span data-stu-id="9a1c6-258">After making these changes, the ObjectDataSource's declarative syntax will be expanded to include an `InsertParameters` collection, as shown below:</span></span>


[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample8.aspx)]

<span data-ttu-id="9a1c6-259">Повторный запуск мастера вернулось `OldValuesParameterFormatString` свойство.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-259">Rerunning the wizard added back the `OldValuesParameterFormatString` property.</span></span> <span data-ttu-id="9a1c6-260">Теперь пора удалите это свойство, присвоив ему значение по умолчанию (`{0}`) либо совсем удалив его из декларативного синтаксиса.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-260">Take a moment to clear this property by setting it to the default value (`{0}`) or removing it altogether from the declarative syntax.</span></span>

<span data-ttu-id="9a1c6-261">Использование ObjectDataSource, предоставляя возможности вставки смарт-тег DetailsView теперь включают флажок Разрешить вставку; Вернитесь в конструктор и установите этот флажок.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-261">With the ObjectDataSource providing inserting capabilities, the DetailsView's smart tag will now include the Enable Inserting checkbox; return to the Designer and check this option.</span></span> <span data-ttu-id="9a1c6-262">Затем сократите DetailsView, придав ему стояли две - `ProductName` и `UnitPrice` - и CommandField.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-262">Next, pare down the DetailsView so that it only has two BoundFields - `ProductName` and `UnitPrice` - and the CommandField.</span></span> <span data-ttu-id="9a1c6-263">На этом этапе DetailsView должен выглядеть как:</span><span class="sxs-lookup"><span data-stu-id="9a1c6-263">At this point the DetailsView's declarative syntax should look like:</span></span>


[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample9.aspx)]

<span data-ttu-id="9a1c6-264">На рисунке 16 показано эту страницу при просмотре через браузер на этом этапе.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-264">Figure 16 shows this page when viewed through a browser at this point.</span></span> <span data-ttu-id="9a1c6-265">Как видите, DetailsView указаны имя и цену первого продукта (Chai).</span><span class="sxs-lookup"><span data-stu-id="9a1c6-265">As you can see, the DetailsView lists the name and price of the first product (Chai).</span></span> <span data-ttu-id="9a1c6-266">Тем не менее, мы хотим является вставка интерфейс, который предоставляет средства для пользователя для быстрого добавления нового продукта в базу данных.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-266">What we want, however, is an inserting interface that provides a means for the user to quickly add a new product to the database.</span></span>


<span data-ttu-id="9a1c6-267">[![DetailsView является в настоящее время к просмотру в режиме только для чтения](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image47.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image46.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-267">[![The DetailsView is Currently Rendered in Read-Only Mode](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image47.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image46.png)</span></span>

<span data-ttu-id="9a1c6-268">**На рисунке 16**: DetailsView является в настоящее время к просмотру в режиме только для чтения ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image48.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-268">**Figure 16**: The DetailsView is Currently Rendered in Read-Only Mode ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image48.png))</span></span>


<span data-ttu-id="9a1c6-269">Чтобы можно было отобразить DetailsView в режиме вставки нам нужно указать `DefaultMode` свойства `Inserting`.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-269">In order to show the DetailsView in its inserting mode we need to set the `DefaultMode` property to `Inserting`.</span></span> <span data-ttu-id="9a1c6-270">Подготавливает к просмотру в режиме вставки при первом посещении DetailsView. при этом остается после вставки новой записи.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-270">This renders the DetailsView in insert mode when first visited and keeps it there after inserting a new record.</span></span> <span data-ttu-id="9a1c6-271">Как показано на рисунке 17, такие DetailsView предоставляет быстрый интерфейс для добавления новой записи.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-271">As Figure 17 shows, such a DetailsView provides a quick interface for adding a new record.</span></span>


<span data-ttu-id="9a1c6-272">[![DetailsView предоставляет интерфейс для быстрого добавления нового продукта](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image50.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-272">[![The DetailsView Provides an Interface for Quickly Adding a New Product](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image50.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image49.png)</span></span>

<span data-ttu-id="9a1c6-273">**Рисунок 17**: DetailsView предоставляет интерфейс для быстрого добавления нового продукта ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image51.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-273">**Figure 17**: The DetailsView Provides an Interface for Quickly Adding a New Product ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image51.png))</span></span>


<span data-ttu-id="9a1c6-274">Когда пользователь вводит имя и цену продукта (например, «Acme Water» и 1,99, как показано на рис. 17) и выбирает Insert, обратная передача и запускает поток операций по вставке одновременной в новую запись о продукте добавлены в базу данных.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-274">When the user enters a product name and price (such as "Acme Water" and 1.99, as in Figure 17) and clicks Insert, a postback ensues and the inserting workflow commences, culminating in a new product record being added to the database.</span></span> <span data-ttu-id="9a1c6-275">DetailsView сохраняет свой интерфейс для вставки и GridView автоматически повторно привязывается к источнику данных для включения нового продукта, как показано на рисунке 18.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-275">The DetailsView maintains its inserting interface and the GridView is automatically rebound to its data source in order to include the new product, as shown in Figure 18.</span></span>


![Продукт](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image52.png)

<span data-ttu-id="9a1c6-277">**На рисунке 18**: продукта «Acme Water» был добавлен в базу данных</span><span class="sxs-lookup"><span data-stu-id="9a1c6-277">**Figure 18**: The Product "Acme Water" Has Been Added to the Database</span></span>


<span data-ttu-id="9a1c6-278">Хотя на рисунке 18 GridView не показывает, полей продукта отсутствует в интерфейсе DetailsView `CategoryID`, `SupplierID`, `QuantityPerUnit`и так далее назначаются `NULL` значения базы данных.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-278">While the GridView in Figure 18 doesn't show it, the product fields lacking from the DetailsView interface `CategoryID`, `SupplierID`, `QuantityPerUnit`, and so on are assigned `NULL` database values.</span></span> <span data-ttu-id="9a1c6-279">Это можно увидеть, выполнив следующие действия:</span><span class="sxs-lookup"><span data-stu-id="9a1c6-279">You can see this by performing the following steps:</span></span>

1. <span data-ttu-id="9a1c6-280">Перейдите в обозреватель серверов в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="9a1c6-280">Go to the Server Explorer in Visual Studio</span></span>
2. <span data-ttu-id="9a1c6-281">Расширение `NORTHWND.MDF` узел базы данных</span><span class="sxs-lookup"><span data-stu-id="9a1c6-281">Expanding the `NORTHWND.MDF` database node</span></span>
3. <span data-ttu-id="9a1c6-282">Щелкните правой кнопкой мыши `Products` базы данных</span><span class="sxs-lookup"><span data-stu-id="9a1c6-282">Right-click on the `Products` database table node</span></span>
4. <span data-ttu-id="9a1c6-283">Выберите Показать таблицу данных</span><span class="sxs-lookup"><span data-stu-id="9a1c6-283">Select Show Table Data</span></span>

<span data-ttu-id="9a1c6-284">Будет выведен список всех записей в `Products` таблицы.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-284">This will list all of the records in the `Products` table.</span></span> <span data-ttu-id="9a1c6-285">Как показано на рис все столбцы наш новый продукт отличный от `ProductID`, `ProductName`, и `UnitPrice` имеют `NULL` значения.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-285">As Figure 19 shows, all of our new product's columns other than `ProductID`, `ProductName`, and `UnitPrice` have `NULL` values.</span></span>


<span data-ttu-id="9a1c6-286">[![Поля продукта не указано в DetailsView будут назначены значения NULL](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image54.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image53.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-286">[![The Product Fields Not Provided in the DetailsView are Assigned NULL Values](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image54.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image53.png)</span></span>

<span data-ttu-id="9a1c6-287">**На рисунке 19**: продукта поля не представленным в DetailsView назначаются `NULL` значения ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image55.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-287">**Figure 19**: The Product Fields Not Provided in the DetailsView are Assigned `NULL` Values ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image55.png))</span></span>


<span data-ttu-id="9a1c6-288">Необходимо указать значение по умолчанию, отличный от `NULL` для одного или нескольких из этих значений в столбце, либо потому что `NULL` не лучшим вариантом по умолчанию или потому, что сам столбец базы данных не допускает `NULL` s.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-288">We may want to provide a default value other than `NULL` for one or more of these column values, either because `NULL` isn't the best default option or because the database column itself doesn't allow `NULL` s.</span></span> <span data-ttu-id="9a1c6-289">Для этого мы программно задать значения параметров DetailsView `InputParameters` коллекции.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-289">To accomplish this we can programmatically set the values of the parameters of the DetailsView's `InputParameters` collection.</span></span> <span data-ttu-id="9a1c6-290">Это назначение можно сделать либо в случае обработчик для элемента DetailsView `ItemInserting` событий или ObjectDataSource `Inserting` событий.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-290">This assignment can be done either in the event handler for the DetailsView's `ItemInserting` event or the ObjectDataSource's `Inserting` event.</span></span> <span data-ttu-id="9a1c6-291">Так как мы уже узнали во с помощью событий предварительного и последующего уровней данных Web контролировать уровень, давайте рассмотрим с помощью элемента управления ObjectDataSource событий это время.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-291">Since we've already looked at using the pre- and post-level events at the data Web control level, let's explore using the ObjectDataSource's events this time.</span></span>

## <a name="step-4-assigning-values-to-thecategoryidandsupplieridparameters"></a><span data-ttu-id="9a1c6-292">Шаг 4: Присвоения значений для`CategoryID`и`SupplierID`параметров</span><span class="sxs-lookup"><span data-stu-id="9a1c6-292">Step 4: Assigning Values to the`CategoryID`and`SupplierID`Parameters</span></span>

<span data-ttu-id="9a1c6-293">Для этого примера предположим, что для нашего приложения при добавлении нового продукта через этот интерфейс ей должно быть присвоено `CategoryID` и `SupplierID` значение 1.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-293">For this tutorial let's imagine that for our application when adding a new product through this interface it should be assigned a `CategoryID` and `SupplierID` value of 1.</span></span> <span data-ttu-id="9a1c6-294">Как упоминалось ранее, ObjectDataSource имеется пара событий предварительного и последующего уровней которые запускаются во время модификации данных.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-294">As mentioned earlier, the ObjectDataSource has a pair of pre- and post-level events that fire during the data modification process.</span></span> <span data-ttu-id="9a1c6-295">При его `Insert()` вызова метода, элемент управления ObjectDataSource сначала вызывает его `Inserting` , затем вызывает метод, его `Insert()` метод был сопоставлен и наконец создает `Inserted` событий.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-295">When its `Insert()` method is invoked, the ObjectDataSource first raises its `Inserting` event, then calls the method that its `Insert()` method has been mapped to, and finally raises the `Inserted` event.</span></span> <span data-ttu-id="9a1c6-296">`Inserting` Дает нам последнюю возможность настроить входные параметры или отменить операцию.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-296">The `Inserting` event handler affords us one last opportunity to tweak the input parameters or cancel the operation outright.</span></span>

> [!NOTE]
> <span data-ttu-id="9a1c6-297">В реальном приложении, скорее всего вы захотите разрешить пользователю указать категорию и поставщика или это значение будет следует выбирать для них зависимости от некоторых условий или бизнес логики (а не вслепую выбирать идентификатор 1).</span><span class="sxs-lookup"><span data-stu-id="9a1c6-297">In a real-world application you would likely want to either let the user specify the category and supplier or would pick this value for them based on some criteria or business logic (rather than blindly selecting an ID of 1).</span></span> <span data-ttu-id="9a1c6-298">Независимо от того пример показывает, как программно задать значение входного параметра из предыдущего уровня события элемента управления ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-298">Regardless, the example illustrates how to programmatically set the value of an input parameter from the ObjectDataSource's pre-level event.</span></span>


<span data-ttu-id="9a1c6-299">Теперь пора создайте обработчик событий для элемента управления ObjectDataSource `Inserting` событий.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-299">Take a moment to create an event handler for the ObjectDataSource's `Inserting` event.</span></span> <span data-ttu-id="9a1c6-300">Обратите внимание, что обработчик событий второй входной параметр объекта типа `ObjectDataSourceMethodEventArgs`, который имеет свойство для доступа к коллекции параметров (`InputParameters`) и свойство, чтобы отменить операцию (`Cancel`).</span><span class="sxs-lookup"><span data-stu-id="9a1c6-300">Notice that the event handler's second input parameter is an object of type `ObjectDataSourceMethodEventArgs`, which has a property to access the parameters collection (`InputParameters`) and a property to cancel the operation (`Cancel`).</span></span>


[!code-csharp[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample10.cs)]

<span data-ttu-id="9a1c6-301">На этом этапе `InputParameters` свойство содержит элемент управления ObjectDataSource `InsertParameters` коллекции со значениями, присвоенными из DetailsView.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-301">At this point, the `InputParameters` property contains the ObjectDataSource's `InsertParameters` collection with the values assigned from the DetailsView.</span></span> <span data-ttu-id="9a1c6-302">Чтобы изменить значение одного из этих параметров, используйте: `e.InputParameters["paramName"] = value`.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-302">To change the value of one of these parameters, simply use: `e.InputParameters["paramName"] = value`.</span></span> <span data-ttu-id="9a1c6-303">Таким образом Чтобы задать `CategoryID` и `SupplierID` для значения 1, настройте `Inserting` обработчик событий, чтобы выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="9a1c6-303">Therefore, to set the `CategoryID` and `SupplierID` to values of 1, adjust the `Inserting` event handler to look like the following:</span></span>


[!code-csharp[Main](examining-the-events-associated-with-inserting-updating-and-deleting-cs/samples/sample11.cs)]

<span data-ttu-id="9a1c6-304">Это время при добавлении нового продукта (например, Acme Soda) `CategoryID` и `SupplierID` столбцов нового продукта устанавливаются в 1 (см. рис. 20).</span><span class="sxs-lookup"><span data-stu-id="9a1c6-304">This time when adding a new product (such as Acme Soda), the `CategoryID` and `SupplierID` columns of the new product are set to 1 (see Figure 20).</span></span>


<span data-ttu-id="9a1c6-305">[![Новые продукты теперь имеют свои CategoryID и SupplierID данные, установленные на 1](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image57.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image56.png)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-305">[![New Products Now Have Their CategoryID and SupplierID Values Set to 1](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image57.png)](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image56.png)</span></span>

<span data-ttu-id="9a1c6-306">**Рис. 20**: новые продукты теперь имеют их `CategoryID` и `SupplierID` значения равным 1 ([Просмотр полноразмерное изображение](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image58.png))</span><span class="sxs-lookup"><span data-stu-id="9a1c6-306">**Figure 20**: New Products Now Have Their `CategoryID` and `SupplierID` Values Set to 1 ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-cs/_static/image58.png))</span></span>


## <a name="summary"></a><span data-ttu-id="9a1c6-307">Сводка</span><span class="sxs-lookup"><span data-stu-id="9a1c6-307">Summary</span></span>

<span data-ttu-id="9a1c6-308">Во время редактирования, вставки и удаления процесса веб-управления данными и ObjectDataSource Пройдите ряд событий предварительного и последующего уровней.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-308">During the editing, inserting, and deleting process, both the data Web control and the ObjectDataSource proceed through a number of pre- and post-level events.</span></span> <span data-ttu-id="9a1c6-309">В этом учебнике мы рассмотрели предварительного события и узнали, как их использовать для настройки параметров ввода или отменить операцию изменения данных полностью, оба из веб-управления и события для элемента управления ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-309">In this tutorial we examined the pre-level events and saw how to use these to customize the input parameters or cancel the data modification operation altogether both from the data Web control and ObjectDataSource's events.</span></span> <span data-ttu-id="9a1c6-310">В следующем уроке мы рассмотрим создание и использование обработчиков событий для событий последующего уровня.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-310">In the next tutorial we'll look at creating and using event handlers for the post-level events.</span></span>

<span data-ttu-id="9a1c6-311">Программирование довольны!</span><span class="sxs-lookup"><span data-stu-id="9a1c6-311">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="9a1c6-312">Об авторе</span><span class="sxs-lookup"><span data-stu-id="9a1c6-312">About the Author</span></span>

<span data-ttu-id="9a1c6-313">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-313">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="9a1c6-314">Скотт — независимый консультант, trainer и записи.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-314">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="9a1c6-315">Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="9a1c6-315">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="9a1c6-316">Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="9a1c6-316">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="9a1c6-317">Благодарности</span><span class="sxs-lookup"><span data-stu-id="9a1c6-317">Special Thanks To</span></span>

<span data-ttu-id="9a1c6-318">Этот учебник ряд прошел проверку многие полезные рецензентов.</span><span class="sxs-lookup"><span data-stu-id="9a1c6-318">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="9a1c6-319">Основными редакторами этого учебника были Jackie Goor и (Liz Shulok).</span><span class="sxs-lookup"><span data-stu-id="9a1c6-319">Lead reviewers for this tutorial were Jackie Goor and Liz Shulok.</span></span> <span data-ttu-id="9a1c6-320">Объясняются моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="9a1c6-320">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="9a1c6-321">Если Да, напишите мне по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-321">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9a1c6-322">[Назад](an-overview-of-inserting-updating-and-deleting-data-cs.md)
> [Вперед](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md)</span><span class="sxs-lookup"><span data-stu-id="9a1c6-322">[Previous](an-overview-of-inserting-updating-and-deleting-data-cs.md)
[Next](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md)</span></span>
