---
uid: web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-vb
title: "Кэширование данных в архитектуре (VB) | Документы Microsoft"
author: rick-anderson
description: "В предыдущем учебнике мы узнали, как применение кэширования на уровне представления. В этом учебнике рассказано, как пользоваться преимуществами наших многоуровневой архитектуре систем обеспечения..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/30/2007
ms.topic: article
ms.assetid: 5e189dd7-f4f9-4f28-9b3a-6cb7d392e9c7
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-vb
msc.type: authoredcontent
ms.openlocfilehash: 1aca89b022bb3bb7e4154ab575b5bb5513144cd5
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2018
---
<a name="caching-data-in-the-architecture-vb"></a><span data-ttu-id="46c65-104">Кэширование данных в архитектуре (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="46c65-104">Caching Data in the Architecture (VB)</span></span>
====================
<span data-ttu-id="46c65-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="46c65-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="46c65-106">[Загрузить пример приложения](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_VB.exe) или [скачать PDF](caching-data-in-the-architecture-vb/_static/datatutorial59vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="46c65-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_VB.exe) or [Download PDF](caching-data-in-the-architecture-vb/_static/datatutorial59vb1.pdf)</span></span>

> <span data-ttu-id="46c65-107">В предыдущем учебнике мы узнали, как применение кэширования на уровне представления.</span><span class="sxs-lookup"><span data-stu-id="46c65-107">In the previous tutorial we learned how to apply caching at the Presentation Layer.</span></span> <span data-ttu-id="46c65-108">В этом учебнике рассказано, как использовать преимущества наших многоуровневой архитектуры для кэширования данных на уровне бизнес-логики.</span><span class="sxs-lookup"><span data-stu-id="46c65-108">In this tutorial we learn how to take advantage of our layered architecture to cache data at the Business Logic Layer.</span></span> <span data-ttu-id="46c65-109">Для этого, расширяя архитектуру, чтобы включить кэширование слой.</span><span class="sxs-lookup"><span data-stu-id="46c65-109">We do this by extending the architecture to include a Caching Layer.</span></span>


## <a name="introduction"></a><span data-ttu-id="46c65-110">Вступление</span><span class="sxs-lookup"><span data-stu-id="46c65-110">Introduction</span></span>

<span data-ttu-id="46c65-111">Как было показано в предыдущем учебнике, кэширование данных s ObjectDataSource сложнее, чем установка нескольких свойств.</span><span class="sxs-lookup"><span data-stu-id="46c65-111">As we saw in the preceding tutorial, caching the ObjectDataSource s data is as simple as setting a couple of properties.</span></span> <span data-ttu-id="46c65-112">К сожалению ObjectDataSource применяется кэширование на уровне представления, который тесно связывает политики кэширования со страницы ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="46c65-112">Unfortunately, the ObjectDataSource applies caching at the Presentation Layer, which tightly couples the caching policies with the ASP.NET page.</span></span> <span data-ttu-id="46c65-113">Одной из причин для создания многоуровневой архитектуры является предоставление таких связей к повреждению.</span><span class="sxs-lookup"><span data-stu-id="46c65-113">One of the reasons for creating a layered architecture is to allow such couplings to be broken.</span></span> <span data-ttu-id="46c65-114">Уровня бизнес-логики для экземпляра отделяет бизнес-логики на страницах ASP.NET, во время доступа к данным отделяет сведения о данных для доступа.</span><span class="sxs-lookup"><span data-stu-id="46c65-114">The Business Logic Layer, for instance, decouples the business logic from the ASP.NET pages, while the Data Access Layer decouples the data access details.</span></span> <span data-ttu-id="46c65-115">Это разделение бизнес логику и данные, данные доступа предпочтительнее, частично, так как его и система становится более читаемым, более простого в сопровождении и более гибкие, чтобы изменить.</span><span class="sxs-lookup"><span data-stu-id="46c65-115">This decoupling of business logic and data access details is preferred, in part, because it makes the system more readable, more maintainable, and more flexible to change.</span></span> <span data-ttu-id="46c65-116">Он также позволяет набора знаний домена и подразделения разработчик, работающий на t уровень представления данных необходимо ознакомиться со сведениями о s базы данных для выполнения своей работы.</span><span class="sxs-lookup"><span data-stu-id="46c65-116">It also allows for domain knowledge and division of labor a developer working on the Presentation Layer doesn t need to be familiar with the database s details in order to do her job.</span></span> <span data-ttu-id="46c65-117">Отделение от уровня представления политику кэширования предоставляет аналогичные преимуществ.</span><span class="sxs-lookup"><span data-stu-id="46c65-117">Decoupling the caching policy from the Presentation Layer offers similar benefits.</span></span>

<span data-ttu-id="46c65-118">В этом учебнике будет дополнить нашей архитектуры для включения *кэширования слоев* (или CL сокращенно), использует политике кэширования.</span><span class="sxs-lookup"><span data-stu-id="46c65-118">In this tutorial we will augment our architecture to include a *Caching Layer* (or CL for short) that employs our caching policy.</span></span> <span data-ttu-id="46c65-119">Кэширование слоя будет включать `ProductsCL` класс, который предоставляет доступ к информации о продукте с помощью таких методов, как `GetProducts()`, `GetProductsByCategoryID(categoryID)`и так далее, что при вызове будет первой попытке получения данных из кэша.</span><span class="sxs-lookup"><span data-stu-id="46c65-119">The Caching Layer will include a `ProductsCL` class that provides access to product information with methods like `GetProducts()`, `GetProductsByCategoryID(categoryID)`, and so forth, that, when invoked, will first attempt to retrieve the data from the cache.</span></span> <span data-ttu-id="46c65-120">Если кэш пуст, эти методы вызывают соответствующие `ProductsBLL` метод в МЕТОДА, который в свою очередь будет получать данные из DAL.</span><span class="sxs-lookup"><span data-stu-id="46c65-120">If the cache is empty, these methods will invoke the appropriate `ProductsBLL` method in the BLL, which would in turn get the data from the DAL.</span></span> <span data-ttu-id="46c65-121">`ProductsCL` Методы кэшировать данные, полученные из МЕТОДА перед возвращением.</span><span class="sxs-lookup"><span data-stu-id="46c65-121">The `ProductsCL` methods cache the data retrieved from the BLL before returning it.</span></span>

<span data-ttu-id="46c65-122">Как показано на рис. 1, CL находится между презентации и уровни бизнес-логики.</span><span class="sxs-lookup"><span data-stu-id="46c65-122">As Figure 1 shows, the CL resides between the Presentation and Business Logic Layers.</span></span>


![Кэширование слоя (CL) — еще один уровень в наш архитектуры](caching-data-in-the-architecture-vb/_static/image1.png)

<span data-ttu-id="46c65-124">**Рис. 1**: кэширование слоя (CL) — еще один уровень в наш архитектуры</span><span class="sxs-lookup"><span data-stu-id="46c65-124">**Figure 1**: The Caching Layer (CL) is Another Layer in Our Architecture</span></span>


## <a name="step-1-creating-the-caching-layer-classes"></a><span data-ttu-id="46c65-125">Шаг 1: Создание классов кэширования слоев</span><span class="sxs-lookup"><span data-stu-id="46c65-125">Step 1: Creating the Caching Layer Classes</span></span>

<span data-ttu-id="46c65-126">В этом учебнике мы создадим простой CL с отдельным классом `ProductsCL` , имеющий ограниченное число методов.</span><span class="sxs-lookup"><span data-stu-id="46c65-126">In this tutorial we will create a very simple CL with a single class `ProductsCL` that has only a handful of methods.</span></span> <span data-ttu-id="46c65-127">Создание слоя полное кэширование для всего приложения требуется создание `CategoriesCL`, `EmployeesCL`, и `SuppliersCL` классы, а также предоставлять метод в этих классах, кэширование слой для каждого метода доступа или изменения данных в МЕТОДА.</span><span class="sxs-lookup"><span data-stu-id="46c65-127">Building a complete Caching Layer for the entire application would require creating `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes, and providing a method in these Caching Layer classes for each data access or modification method in the BLL.</span></span> <span data-ttu-id="46c65-128">Как и уровень бизнес-ЛОГИКИ и DAL, уровень кэширования в идеальном случае должен быть реализован как отдельный проект библиотеки классов; Тем не менее, мы будем реализовывать как класс в `App_Code` папки.</span><span class="sxs-lookup"><span data-stu-id="46c65-128">As with the BLL and DAL, the Caching Layer should ideally be implemented as a separate Class Library project; however, we will implement it as a class in the `App_Code` folder.</span></span>

<span data-ttu-id="46c65-129">Несколько классов четко отдельных CL от классов DAL и уровень бизнес-ЛОГИКИ, s позволяют создать новую вложенную папку в `App_Code` папки.</span><span class="sxs-lookup"><span data-stu-id="46c65-129">To more cleanly separate the CL classes from the DAL and BLL classes, let s create a new subfolder in the `App_Code` folder.</span></span> <span data-ttu-id="46c65-130">Щелкните правой кнопкой мыши `App_Code` в обозревателе решений, выберите новую папку и имя новой папки `CL`.</span><span class="sxs-lookup"><span data-stu-id="46c65-130">Right-click on the `App_Code` folder in the Solution Explorer, choose New Folder, and name the new folder `CL`.</span></span> <span data-ttu-id="46c65-131">После создания этой папки, добавьте в него новый класс с именем `ProductsCL.vb`.</span><span class="sxs-lookup"><span data-stu-id="46c65-131">After creating this folder, add to it a new class named `ProductsCL.vb`.</span></span>


![Добавить новую папку с именем CL и класс с именем ProductsCL.vb](caching-data-in-the-architecture-vb/_static/image2.png)

<span data-ttu-id="46c65-133">**На рисунке 2**: добавить новую папку с именем `CL` и класс с именем`ProductsCL.vb`</span><span class="sxs-lookup"><span data-stu-id="46c65-133">**Figure 2**: Add a New Folder Named `CL` and a Class Named `ProductsCL.vb`</span></span>


<span data-ttu-id="46c65-134">`ProductsCL` Класс должен включать один и тот же набор методов доступа и изменения данных, обнаруженных в его соответствующий класс уровня бизнес-логики (`ProductsBLL`).</span><span class="sxs-lookup"><span data-stu-id="46c65-134">The `ProductsCL` class should include the same set of data access and modification methods as found in its corresponding Business Logic Layer class (`ProductsBLL`).</span></span> <span data-ttu-id="46c65-135">Вместо создания все эти методы позволяют s просто построения несколько здесь, чтобы понять закономерности используемые CL.</span><span class="sxs-lookup"><span data-stu-id="46c65-135">Rather than creating all of these methods, let s just build a couple here to get a feel for the patterns used by the CL.</span></span> <span data-ttu-id="46c65-136">В частности, мы добавим `GetProducts()` и `GetProductsByCategoryID(categoryID)` методы в шаге 3 и `UpdateProduct` перегрузки на шаге 4.</span><span class="sxs-lookup"><span data-stu-id="46c65-136">In particular, we'll add the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods in Step 3 and an `UpdateProduct` overload in Step 4.</span></span> <span data-ttu-id="46c65-137">Можно добавить оставшихся `ProductsCL` методы и `CategoriesCL`, `EmployeesCL`, и `SuppliersCL` классы в свободное время.</span><span class="sxs-lookup"><span data-stu-id="46c65-137">You can add the remaining `ProductsCL` methods and `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes at your leisure.</span></span>

## <a name="step-2-reading-and-writing-to-the-data-cache"></a><span data-ttu-id="46c65-138">Шаг 2: Чтение и запись в кэше данных</span><span class="sxs-lookup"><span data-stu-id="46c65-138">Step 2: Reading and Writing to the Data Cache</span></span>

<span data-ttu-id="46c65-139">ObjectDataSource, рассмотренных в предыдущем учебнике внутри функции кэширования использует кэш данных ASP.NET для хранения данных, из МЕТОДА.</span><span class="sxs-lookup"><span data-stu-id="46c65-139">The ObjectDataSource caching feature explored in the preceding tutorial internally uses the ASP.NET data cache to store the data retrieved from the BLL.</span></span> <span data-ttu-id="46c65-140">Кэш данных можно получить программным путем из классов кода страницы ASP.NET или из классов в s архитектура веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="46c65-140">The data cache can also be accessed programmatically from ASP.NET pages code-behind classes or from the classes in the web application s architecture.</span></span> <span data-ttu-id="46c65-141">Для чтения и записи в кэш данных из кода класс s страницы ASP.NET, используйте следующий шаблон:</span><span class="sxs-lookup"><span data-stu-id="46c65-141">To read and write to the data cache from an ASP.NET page s code-behind class, use the following pattern:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample1.vb)]

<span data-ttu-id="46c65-142">[ `Cache` Класса](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [ `Insert` метод](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) имеет несколько перегрузок.</span><span class="sxs-lookup"><span data-stu-id="46c65-142">The [`Cache` class](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [`Insert` method](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) has a number of overloads.</span></span> <span data-ttu-id="46c65-143">`Cache("key") = value`и `Cache.Insert(key, value)` являются синонимами и как добавить элемент в кэш, используя указанный ключ без определенного истечения срока действия.</span><span class="sxs-lookup"><span data-stu-id="46c65-143">`Cache("key") = value` and `Cache.Insert(key, value)` are synonymous and both add an item to the cache using the specified key without a defined expiry.</span></span> <span data-ttu-id="46c65-144">Как правило требуется указать срока действия при добавлении элемента в кэш, либо в качестве зависимости и зависимости времени истечения срока действия.</span><span class="sxs-lookup"><span data-stu-id="46c65-144">Typically, we want to specify an expiry when adding an item to the cache, either as a dependency, a time-based expiry, or both.</span></span> <span data-ttu-id="46c65-145">Используйте один из других `Insert` перегрузок метода s, чтобы предоставляют сведения с учетом зависимостей или время истечения срока действия.</span><span class="sxs-lookup"><span data-stu-id="46c65-145">Use one of the other `Insert` method s overloads to provide dependency- or time-based expiry information.</span></span>

<span data-ttu-id="46c65-146">Уровень кэширования s методы, необходимо сначала проверить, если запрошенные данные в кэше и если да, верните ее оттуда.</span><span class="sxs-lookup"><span data-stu-id="46c65-146">The Caching Layer s methods need to first check if the requested data is in the cache and, if so, return it from there.</span></span> <span data-ttu-id="46c65-147">Если запрошенные данные не в кэше, необходимо вызвать соответствующий метод уровень бизнес-ЛОГИКИ.</span><span class="sxs-lookup"><span data-stu-id="46c65-147">If the requested data is not in the cache, the appropriate BLL method needs to be invoked.</span></span> <span data-ttu-id="46c65-148">Его возвращаемое значение следует кэшировать и возвращается, как показано на следующей схеме.</span><span class="sxs-lookup"><span data-stu-id="46c65-148">Its return value should be cached and then returned, as the following sequence diagram illustrates.</span></span>


![Методы s кэширование уровень возвращает данные из кэша, если оно доступно s](caching-data-in-the-architecture-vb/_static/image3.png)

<span data-ttu-id="46c65-150">**Рис. 3**: методы s слоя кэширования возвращает данные из кэша, если он s доступно</span><span class="sxs-lookup"><span data-stu-id="46c65-150">**Figure 3**: The Caching Layer s Methods Return Data from the Cache if it s Available</span></span>


<span data-ttu-id="46c65-151">Последовательность, показаны на рис. 3 выполняется в классах CL, используя следующий шаблон:</span><span class="sxs-lookup"><span data-stu-id="46c65-151">The sequence depicted in Figure 3 is accomplished in the CL classes using the following pattern:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample2.vb)]

<span data-ttu-id="46c65-152">Здесь *тип* — это тип данных, хранимых в кэше `Northwind.ProductsDataTable`, например сетям *ключ* ключ, который уникально идентифицирует элемент кэша.</span><span class="sxs-lookup"><span data-stu-id="46c65-152">Here, *Type* is the type of data being stored in the cache `Northwind.ProductsDataTable`, for example while *key* is the key that uniquely identifies the cache item.</span></span> <span data-ttu-id="46c65-153">Если элемент с указанным *ключ* не находится в кэше, затем *экземпляр* будет `Nothing` и данные будут получены из соответствующего метода уровень бизнес-ЛОГИКИ и добавлены в кэш.</span><span class="sxs-lookup"><span data-stu-id="46c65-153">If the item with the specified *key* is not in the cache, then *instance* will be `Nothing` and the data will be retrieved from the appropriate BLL method and added to the cache.</span></span> <span data-ttu-id="46c65-154">К моменту `Return instance` достигается, *экземпляр* содержит ссылку на данные, либо из кэша или из МЕТОДА.</span><span class="sxs-lookup"><span data-stu-id="46c65-154">By the time `Return instance` is reached, *instance* contains a reference to the data, either from the cache or pulled from the BLL.</span></span>

<span data-ttu-id="46c65-155">Обязательно используйте шаблон выше, при доступе к данным из кэша.</span><span class="sxs-lookup"><span data-stu-id="46c65-155">Be sure to use the above pattern when accessing data from the cache.</span></span> <span data-ttu-id="46c65-156">Следующий шаблон, который на первый взгляд выглядит эквивалентной содержит небольшое различие, который представляет состояние гонки.</span><span class="sxs-lookup"><span data-stu-id="46c65-156">The following pattern, which, at first glance, looks equivalent, contains a subtle difference that introduces a race condition.</span></span> <span data-ttu-id="46c65-157">Состояние гонки трудно отлаживать из-за обнаруживать себя время от времени их трудно воспроизвести.</span><span class="sxs-lookup"><span data-stu-id="46c65-157">Race conditions are difficult to debug because they reveal themselves sporadically and are difficult to reproduce.</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample3.vb)]

<span data-ttu-id="46c65-158">Разность в этом втором фрагмент неправильный код, а не хранить ссылку на кэшированный элемент в локальной переменной, кэш данных осуществляется непосредственно в условном операторе *и* в `Return`.</span><span class="sxs-lookup"><span data-stu-id="46c65-158">The difference in this second, incorrect code snippet is that rather than storing a reference to the cached item in a local variable, the data cache is accessed directly in the conditional statement *and* in the `Return`.</span></span> <span data-ttu-id="46c65-159">Предположим, при достижении этого кода `Cache("key")` не `Nothing`, но перед `Return` инструкция исчерпана, система исключает *ключ* из кэша.</span><span class="sxs-lookup"><span data-stu-id="46c65-159">Imagine that when this code is reached, `Cache("key")` is not `Nothing`, but before the `Return` statement is reached, the system evicts *key* from the cache.</span></span> <span data-ttu-id="46c65-160">В этом редком случае вернет код `Nothing` вместо ожидаемого типа объекта.</span><span class="sxs-lookup"><span data-stu-id="46c65-160">In this rare case, the code will return `Nothing` rather than an object of the expected type.</span></span>

> [!NOTE]
> <span data-ttu-id="46c65-161">Кэш данных является потокобезопасным, поэтому не нужно синхронизировать доступ к потокам для простых операций чтения или записи.</span><span class="sxs-lookup"><span data-stu-id="46c65-161">The data cache is thread-safe, so you don't need to synchronize thread access for simple reads or writes.</span></span> <span data-ttu-id="46c65-162">Тем не менее если необходимо выполнить несколько операций с данными в кэше, должен быть атомарной, вы несете ответственность для реализации блокировки или другие механизмы для обеспечения потокобезопасности.</span><span class="sxs-lookup"><span data-stu-id="46c65-162">However, if you need to perform multiple operations on data in the cache that need to be atomic, you are responsible for implementing a lock or some other mechanism to ensure thread safety.</span></span> <span data-ttu-id="46c65-163">В разделе [синхронизации доступа к кэшу ASP.NET](http://www.ddj.com/184406369) для получения дополнительной информации.</span><span class="sxs-lookup"><span data-stu-id="46c65-163">See [Synchronizing Access to the ASP.NET Cache](http://www.ddj.com/184406369) for more information.</span></span>


<span data-ttu-id="46c65-164">Элемент может быть программно исключена из кэша данных с помощью [ `Remove` метод](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) следующим образом:</span><span class="sxs-lookup"><span data-stu-id="46c65-164">An item can be programmatically evicted from the data cache using the [`Remove` method](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) like so:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample4.vb)]

## <a name="step-3-returning-product-information-from-theproductsclclass"></a><span data-ttu-id="46c65-165">Шаг 3: Возвращение сведения о продукте из`ProductsCL`класса</span><span class="sxs-lookup"><span data-stu-id="46c65-165">Step 3: Returning Product Information from the`ProductsCL`Class</span></span>

<span data-ttu-id="46c65-166">Для этого учебника позволяют реализовать два метода для возвращения сведения о продукте из s `ProductsCL` класса: `GetProducts()` и `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="46c65-166">For this tutorial let s implement two methods for returning product information from the `ProductsCL` class: `GetProducts()` and `GetProductsByCategoryID(categoryID)`.</span></span> <span data-ttu-id="46c65-167">LIKE с `ProductsBL` класс уровня бизнес-логики `GetProducts()` метод в CL возвращает сведения обо всех продуктах, как `Northwind.ProductsDataTable` объекта, пока `GetProductsByCategoryID(categoryID)` возвращает все продукты из указанной категории.</span><span class="sxs-lookup"><span data-stu-id="46c65-167">Like with the `ProductsBL` class in the Business Logic Layer, the `GetProducts()` method in the CL returns information about all of the products as a `Northwind.ProductsDataTable` object, while `GetProductsByCategoryID(categoryID)` returns all of the products from a specified category.</span></span>

<span data-ttu-id="46c65-168">В следующем коде показано часть методов в `ProductsCL` класса:</span><span class="sxs-lookup"><span data-stu-id="46c65-168">The following code shows a portion of the methods in the `ProductsCL` class:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample5.vb)]

<span data-ttu-id="46c65-169">Во-первых, обратите внимание, `DataObject` и `DataObjectMethodAttribute` атрибуты, применяемые к классу и методы.</span><span class="sxs-lookup"><span data-stu-id="46c65-169">First, note the `DataObject` and `DataObjectMethodAttribute` attributes applied to the class and methods.</span></span> <span data-ttu-id="46c65-170">Эти атрибуты предоставляют сведения о мастере s ObjectDataSource, позволяющее определить, какие классы и методы должны отображаться на шагах s.</span><span class="sxs-lookup"><span data-stu-id="46c65-170">These attributes provide information to the ObjectDataSource s wizard, indicating what classes and methods should appear in the wizard s steps.</span></span> <span data-ttu-id="46c65-171">Поскольку CL классов и методов, будет осуществляться с ObjectDataSource на уровне представления данных, добавлены эти атрибуты, чтобы улучшить взаимодействие во время разработки.</span><span class="sxs-lookup"><span data-stu-id="46c65-171">Since the CL classes and methods will be accessed from an ObjectDataSource in the Presentation Layer, I added these attributes to enhance the design-time experience.</span></span> <span data-ttu-id="46c65-172">Обращаться к [Создание слой бизнес-логики](../introduction/creating-a-business-logic-layer-vb.md) учебника более тщательной описание этих атрибутов и их последствия.</span><span class="sxs-lookup"><span data-stu-id="46c65-172">Refer back to the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) tutorial for a more thorough description on these attributes and their effects.</span></span>

<span data-ttu-id="46c65-173">В `GetProducts()` и `GetProductsByCategoryID(categoryID)` методы, данные, возвращенные из `GetCacheItem(key)` метод назначается локальной переменной.</span><span class="sxs-lookup"><span data-stu-id="46c65-173">In the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods, the data returned from the `GetCacheItem(key)` method is assigned to a local variable.</span></span> <span data-ttu-id="46c65-174">`GetCacheItem(key)` Метод, который мы изучим вскоре возвращает какой-либо элемент из кэша на основе указанных *ключ*.</span><span class="sxs-lookup"><span data-stu-id="46c65-174">The `GetCacheItem(key)` method, which we'll examine shortly, returns a particular item from the cache based on the specified *key*.</span></span> <span data-ttu-id="46c65-175">Если данные не найдена в кэше, он извлекается из соответствующего `ProductsBLL` методу класса, а затем добавлено в кэш с помощью `AddCacheItem(key, value)` метод.</span><span class="sxs-lookup"><span data-stu-id="46c65-175">If no such data is found in cache, it is retrieved from the corresponding `ProductsBLL` class method and then added to the cache using the `AddCacheItem(key, value)` method.</span></span>

<span data-ttu-id="46c65-176">`GetCacheItem(key)` И `AddCacheItem(key, value)` методы взаимодействия с кэшем данных, чтение и запись значений соответственно.</span><span class="sxs-lookup"><span data-stu-id="46c65-176">The `GetCacheItem(key)` and `AddCacheItem(key, value)` methods interface with the data cache, reading and writing values, respectively.</span></span> <span data-ttu-id="46c65-177">`GetCacheItem(key)` Метода является более простой из них.</span><span class="sxs-lookup"><span data-stu-id="46c65-177">The `GetCacheItem(key)` method is the simpler of the two.</span></span> <span data-ttu-id="46c65-178">Он просто возвращает значение из класса кэша с использованием переданного *ключ*:</span><span class="sxs-lookup"><span data-stu-id="46c65-178">It simply returns the value from the Cache class using the passed-in *key*:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample6.vb)]

<span data-ttu-id="46c65-179">`GetCacheItem(key)`не используйте *ключ* значение, как указано, но вместо этого вызывает `GetCacheKey(key)` метод, возвращающий *ключ* с ProductsCache - префиксом.</span><span class="sxs-lookup"><span data-stu-id="46c65-179">`GetCacheItem(key)` does not use *key* value as supplied, but instead calls the `GetCacheKey(key)` method, which returns the *key* prepended with ProductsCache-.</span></span> <span data-ttu-id="46c65-180">`MasterCacheKeyArray`, Содержащий строку ProductsCache, также используется `AddCacheItem(key, value)` метод, как будет показано моментально.</span><span class="sxs-lookup"><span data-stu-id="46c65-180">The `MasterCacheKeyArray`, which holds the string ProductsCache, is also used by the `AddCacheItem(key, value)` method, as we'll see momentarily.</span></span>

<span data-ttu-id="46c65-181">От класса фонового кода ASP.NET страницы s, кэш данных может осуществляться с использованием `Page` класса s [ `Cache` свойство](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx)и позволяет использовать синтаксис, подобный `Cache("key") = value`, как описано в шаге 2.</span><span class="sxs-lookup"><span data-stu-id="46c65-181">From an ASP.NET page s code-behind class, the data cache can be accessed using the `Page` class s [`Cache` property](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx), and allows for syntax like `Cache("key") = value`, as discussed in Step 2.</span></span> <span data-ttu-id="46c65-182">Из класса в архитектуре, кэш данных может осуществляться с помощью `HttpRuntime.Cache` или `HttpContext.Current.Cache`.</span><span class="sxs-lookup"><span data-stu-id="46c65-182">From a class within the architecture, the data cache can be accessed using either `HttpRuntime.Cache` or `HttpContext.Current.Cache`.</span></span> <span data-ttu-id="46c65-183">[Питер Джонсон](https://weblogs.asp.net/pjohnson/default.aspx)в записи блога [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) заметки небольшое повышение производительности с помощью `HttpRuntime` вместо `HttpContext.Current`; следовательно, `ProductsCL` использует `HttpRuntime`.</span><span class="sxs-lookup"><span data-stu-id="46c65-183">[Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)'s blog entry [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) notes the slight performance advantage in using `HttpRuntime` instead of `HttpContext.Current`; consequently, `ProductsCL` uses `HttpRuntime`.</span></span>

> [!NOTE]
> <span data-ttu-id="46c65-184">Если вашей архитектуры реализуется с помощью проектов библиотек классов, то необходимо добавить ссылку на `System.Web` сборки для использования [ `HttpRuntime` ](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) и [ `HttpContext` ](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) классы.</span><span class="sxs-lookup"><span data-stu-id="46c65-184">If your architecture is implemented using Class Library projects then you will need to add a reference to the `System.Web` assembly in order to use the [`HttpRuntime`](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) and [`HttpContext`](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) classes.</span></span>


<span data-ttu-id="46c65-185">Если элемент не найден в кэше, `ProductsCL` класса s методы получения данных из МЕТОДА и добавьте его в кэш с помощью `AddCacheItem(key, value)` метод.</span><span class="sxs-lookup"><span data-stu-id="46c65-185">If the item is not found in the cache, the `ProductsCL` class s methods get the data from the BLL and add it to the cache using the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="46c65-186">Чтобы добавить *значение* в кэш можно использовать следующий код, который использует 60 секунд времени истечения срока действия:</span><span class="sxs-lookup"><span data-stu-id="46c65-186">To add *value* to the cache we could use the following code, which uses a 60 second time expiry:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample7.vb)]

<span data-ttu-id="46c65-187">`DateTime.Now.AddSeconds(CacheDuration)`Указывает на основе времени окончания срока действия 60 секунд в будущем while [ `System.Web.Caching.Cache.NoSlidingExpiration` ](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) указывает, выполняется ли s не скользящий срок действия.</span><span class="sxs-lookup"><span data-stu-id="46c65-187">`DateTime.Now.AddSeconds(CacheDuration)` specifies the time-based expiry 60 seconds in the future while [`System.Web.Caching.Cache.NoSlidingExpiration`](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) indicates that there s no sliding expiration.</span></span> <span data-ttu-id="46c65-188">При этом `Insert` перегруженный метод имеет входные параметры для обоих является абсолютным и скользящего срока действия, можно предоставить только один из них.</span><span class="sxs-lookup"><span data-stu-id="46c65-188">While this `Insert` method overload has input parameters for both an absolute and sliding expiry, you can only provide one of the two.</span></span> <span data-ttu-id="46c65-189">При попытке задать промежуток времени и абсолютное время `Insert` метод вызывает исключение `ArgumentException` исключение.</span><span class="sxs-lookup"><span data-stu-id="46c65-189">If you attempt to specify both an absolute time and a time span, the `Insert` method will throw an `ArgumentException` exception.</span></span>

> [!NOTE]
> <span data-ttu-id="46c65-190">Эта реализация `AddCacheItem(key, value)` метод в настоящее время имеет недостатки.</span><span class="sxs-lookup"><span data-stu-id="46c65-190">This implementation of the `AddCacheItem(key, value)` method currently has some shortcomings.</span></span> <span data-ttu-id="46c65-191">Мы решения и решения этих проблем на шаге 4.</span><span class="sxs-lookup"><span data-stu-id="46c65-191">We'll address and overcome these issues in Step 4.</span></span>


## <a name="step-4-invalidating-the-cache-when-the-data-is-modified-through-the-architecture"></a><span data-ttu-id="46c65-192">Шаг 4: Делает недействительными кэш при Data — изменены через архитектура</span><span class="sxs-lookup"><span data-stu-id="46c65-192">Step 4: Invalidating the Cache When the Data is Modified Through the Architecture</span></span>

<span data-ttu-id="46c65-193">А также методы получения данных уровень кэширования должен содержать те же методы, как уровень бизнес-ЛОГИКИ для вставки, обновления и удаления данных.</span><span class="sxs-lookup"><span data-stu-id="46c65-193">Along with data retrieval methods, the Caching Layer needs to provide the same methods as the BLL for inserting, updating, and deleting data.</span></span> <span data-ttu-id="46c65-194">Способы изменения данных CL s не изменяйте кэшированные данные, но вместо этого вызовите метод изменения соответствующих данных для уровень бизнес-ЛОГИКИ s и затем делают кэш недействительным.</span><span class="sxs-lookup"><span data-stu-id="46c65-194">The CL s data modification methods do not modify the cached data, but rather call the BLL s corresponding data modification method and then invalidate the cache.</span></span> <span data-ttu-id="46c65-195">Как упоминалось в предыдущем учебнике это аналогично поведению ObjectDataSource применяется при включении его функции кэширования и его `Insert`, `Update`, или `Delete` методы вызываются.</span><span class="sxs-lookup"><span data-stu-id="46c65-195">As we saw in the preceding tutorial, this is the same behavior that the ObjectDataSource applies when its caching features are enabled and its `Insert`, `Update`, or `Delete` methods are invoked.</span></span>

<span data-ttu-id="46c65-196">Следующие `UpdateProduct` перегрузка показано, как реализовать методы изменения данных в CL:</span><span class="sxs-lookup"><span data-stu-id="46c65-196">The following `UpdateProduct` overload illustrates how to implement the data modification methods in the CL:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample8.vb)]

<span data-ttu-id="46c65-197">Вызывается изменения соответствующих данных метод уровня бизнес-логики, но перед его ответ возвращается необходимо сделать недействительным кэш.</span><span class="sxs-lookup"><span data-stu-id="46c65-197">The appropriate data modification Business Logic Layer method is invoked, but before its response is returned we need to invalidate the cache.</span></span> <span data-ttu-id="46c65-198">К сожалению, кэш не очевидные поскольку `ProductsCL` класса s `GetProducts()` и `GetProductsByCategoryID(categoryID)` методы добавляют элементы в кэш с разными ключами и `GetProductsByCategoryID(categoryID)` метод добавляется элемент разного кэша для каждого уникальный *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="46c65-198">Unfortunately, invalidating the cache is not straightforward because the `ProductsCL` class s `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods each add items to the cache with different keys, and the `GetProductsByCategoryID(categoryID)` method adds a different cache item for each unique *categoryID*.</span></span>

<span data-ttu-id="46c65-199">Что делает недействительными кэш, нам нужно удалить *все* элементов, которые могут быть добавлены с `ProductsCL` класса.</span><span class="sxs-lookup"><span data-stu-id="46c65-199">When invalidating the cache, we need to remove *all* of the items that may have been added by the `ProductsCL` class.</span></span> <span data-ttu-id="46c65-200">Это можно сделать, связав *зависимости кэша* с каждым элементом, добавленных в кэш в `AddCacheItem(key, value)` метод.</span><span class="sxs-lookup"><span data-stu-id="46c65-200">This can be accomplished by associating a *cache dependency* with the each item added to the cache in the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="46c65-201">В общем случае зависимость кэша может быть другого элемента в кэше, файл в файловой системе или данные из базы данных Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="46c65-201">In general, a cache dependency can be another item in the cache, a file on the file system, or data from a Microsoft SQL Server database.</span></span> <span data-ttu-id="46c65-202">При изменении зависимостей или удаляется из кэша, элементы кэша, связанного с ним автоматически извлекается из кэша.</span><span class="sxs-lookup"><span data-stu-id="46c65-202">When the dependency changes or is removed from the cache, the cache items it is associated with are automatically evicted from the cache.</span></span> <span data-ttu-id="46c65-203">В этом учебнике требуется создать еще один элемент в кэше, который выступает в качестве зависимости в кэше для всех элементов, добавленных с помощью `ProductsCL` класса.</span><span class="sxs-lookup"><span data-stu-id="46c65-203">For this tutorial, we want to create an additional item in the cache that serves as a cache dependency for all items added through the `ProductsCL` class.</span></span> <span data-ttu-id="46c65-204">Таким образом, все эти элементы можно удалить из кэша, просто удалив зависимостей кэша.</span><span class="sxs-lookup"><span data-stu-id="46c65-204">That way, all of these items can be removed from the cache by simply removing the cache dependency.</span></span>

<span data-ttu-id="46c65-205">Обновления позволяют s `AddCacheItem(key, value)` метод, чтобы каждый элемент добавлен в кэш через этот метод связан с зависимостей кэша:</span><span class="sxs-lookup"><span data-stu-id="46c65-205">Let s update the `AddCacheItem(key, value)` method so that each item added to the cache through this method is associated with a single cache dependency:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample9.vb)]

<span data-ttu-id="46c65-206">`MasterCacheKeyArray`является массивом строк, содержащий одно значение ProductsCache.</span><span class="sxs-lookup"><span data-stu-id="46c65-206">`MasterCacheKeyArray` is a string array that holds a single value, ProductsCache.</span></span> <span data-ttu-id="46c65-207">Во-первых элемент кэша добавляется в кэш и назначить текущую дату и время.</span><span class="sxs-lookup"><span data-stu-id="46c65-207">First, a cache item is added to the cache and assigned the current date and time.</span></span> <span data-ttu-id="46c65-208">Если этот элемент кэша уже существует, она обновляется.</span><span class="sxs-lookup"><span data-stu-id="46c65-208">If the cache item already exists, it is updated.</span></span> <span data-ttu-id="46c65-209">Затем создается зависимость кэша.</span><span class="sxs-lookup"><span data-stu-id="46c65-209">Next, a cache dependency is created.</span></span> <span data-ttu-id="46c65-210">[ `CacheDependency` Класса](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) s конструктор имеет несколько перегрузок, но использованному здесь требуется два `String` массива входных данных.</span><span class="sxs-lookup"><span data-stu-id="46c65-210">The [`CacheDependency` class](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) s constructor has a number of overloads, but the one being used in here expects two `String` array inputs.</span></span> <span data-ttu-id="46c65-211">Первый указывает набор файлов, которые будут использоваться в качестве зависимости.</span><span class="sxs-lookup"><span data-stu-id="46c65-211">The first one specifies the set of files to be used as dependencies.</span></span> <span data-ttu-id="46c65-212">Поскольку мы не хотите нежелательно использовать все файловые зависимости, значение `Nothing` используется для первого входного параметра.</span><span class="sxs-lookup"><span data-stu-id="46c65-212">Since we don t want to use any file-based dependencies, a value of `Nothing` is used for the first input parameter.</span></span> <span data-ttu-id="46c65-213">Второй входной параметр указывает набор ключей кэша для использования в качестве зависимости.</span><span class="sxs-lookup"><span data-stu-id="46c65-213">The second input parameter specifies the set of cache keys to use as dependencies.</span></span> <span data-ttu-id="46c65-214">Здесь мы указываем нашей одна зависимость `MasterCacheKeyArray`.</span><span class="sxs-lookup"><span data-stu-id="46c65-214">Here we specify our single dependency, `MasterCacheKeyArray`.</span></span> <span data-ttu-id="46c65-215">`CacheDependency` Затем передается в `Insert` метод.</span><span class="sxs-lookup"><span data-stu-id="46c65-215">The `CacheDependency` is then passed into the `Insert` method.</span></span>

<span data-ttu-id="46c65-216">Для этого изменения `AddCacheItem(key, value)`, invaliding кэша заключается в удалении зависимости.</span><span class="sxs-lookup"><span data-stu-id="46c65-216">With this modification to `AddCacheItem(key, value)`, invaliding the cache is as simple as removing the dependency.</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample10.vb)]

## <a name="step-5-calling-the-caching-layer-from-the-presentation-layer"></a><span data-ttu-id="46c65-217">Шаг 5: Вызов слоя кэширования из уровня представления</span><span class="sxs-lookup"><span data-stu-id="46c65-217">Step 5: Calling the Caching Layer from the Presentation Layer</span></span>

<span data-ttu-id="46c65-218">Кэширование слоя s классы и методы можно использовать для работы с данными с помощью методик, мы хранять проверяются на протяжении этих учебников.</span><span class="sxs-lookup"><span data-stu-id="46c65-218">The Caching Layer s classes and methods can be used to work with data using the techniques we ve examined throughout these tutorials.</span></span> <span data-ttu-id="46c65-219">Чтобы продемонстрировать работу с кэшированными данными, сохранить изменения в `ProductsCL` класса, а затем откройте `FromTheArchitecture.aspx` страницы в `Caching` папку и добавьте элемент управления GridView.</span><span class="sxs-lookup"><span data-stu-id="46c65-219">To illustrate working with cached data, save your changes to the `ProductsCL` class and then open the `FromTheArchitecture.aspx` page in the `Caching` folder and add a GridView.</span></span> <span data-ttu-id="46c65-220">В смарт-теге s GridView создайте новый элемент управления ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="46c65-220">From the GridView s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="46c65-221">На первом шаге мастера s вы увидите `ProductsCL` классов как один из вариантов в раскрывающемся списке.</span><span class="sxs-lookup"><span data-stu-id="46c65-221">In the wizard s first step you should see the `ProductsCL` class as one of the options from the drop-down list.</span></span>


<span data-ttu-id="46c65-222">[![Класс ProductsCL включен в раскрывающемся списке объекта бизнеса](caching-data-in-the-architecture-vb/_static/image5.png)](caching-data-in-the-architecture-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="46c65-222">[![The ProductsCL Class is Included in the Business Object Drop-Down List](caching-data-in-the-architecture-vb/_static/image5.png)](caching-data-in-the-architecture-vb/_static/image4.png)</span></span>

<span data-ttu-id="46c65-223">**Рис. 4**: `ProductsCL` класс включен в раскрывающемся списке объекта бизнеса ([Просмотр полноразмерное изображение](caching-data-in-the-architecture-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="46c65-223">**Figure 4**: The `ProductsCL` Class is Included in the Business Object Drop-Down List ([Click to view full-size image](caching-data-in-the-architecture-vb/_static/image6.png))</span></span>


<span data-ttu-id="46c65-224">После выбора `ProductsCL`, нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="46c65-224">After selecting `ProductsCL`, click Next.</span></span> <span data-ttu-id="46c65-225">Раскрывающегося списка на вкладке «SELECT» имеет два элемента - `GetProducts()` и `GetProductsByCategoryID(categoryID)` и вкладку обновление имеет отдельное `UpdateProduct` перегрузки.</span><span class="sxs-lookup"><span data-stu-id="46c65-225">The drop-down list in the SELECT tab has two items - `GetProducts()` and `GetProductsByCategoryID(categoryID)` and the UPDATE tab has the sole `UpdateProduct` overload.</span></span> <span data-ttu-id="46c65-226">Выберите `GetProducts()` метод на вкладке SELECT и `UpdateProducts` метод на вкладку обновления и нажмите кнопку Готово.</span><span class="sxs-lookup"><span data-stu-id="46c65-226">Choose the `GetProducts()` method from the SELECT tab and the `UpdateProducts` method from the UPDATE tab and click Finish.</span></span>


<span data-ttu-id="46c65-227">[![В раскрывающемся списке указаны перечислены методы класса ProductsCL s](caching-data-in-the-architecture-vb/_static/image8.png)](caching-data-in-the-architecture-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="46c65-227">[![The ProductsCL Class s Methods are Listed in the Drop-Down Lists](caching-data-in-the-architecture-vb/_static/image8.png)](caching-data-in-the-architecture-vb/_static/image7.png)</span></span>

<span data-ttu-id="46c65-228">**Рис. 5**: `ProductsCL` методы класса s, перечислены в раскрывающемся списке указаны ([Просмотр полноразмерное изображение](caching-data-in-the-architecture-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="46c65-228">**Figure 5**: The `ProductsCL` Class s Methods are Listed in the Drop-Down Lists ([Click to view full-size image](caching-data-in-the-architecture-vb/_static/image9.png))</span></span>


<span data-ttu-id="46c65-229">По завершении работы мастера Visual Studio установит ObjectDataSource s `OldValuesParameterFormatString` свойства `original_{0}` и добавьте соответствующие поля в GridView.</span><span class="sxs-lookup"><span data-stu-id="46c65-229">After completing the wizard, Visual Studio will set the ObjectDataSource s `OldValuesParameterFormatString` property to `original_{0}` and add the appropriate fields to the GridView.</span></span> <span data-ttu-id="46c65-230">Изменение `OldValuesParameterFormatString` свойства его значение по умолчанию `{0}`и настроить для поддержки разбиения на страницы, сортировку и редактирование GridView.</span><span class="sxs-lookup"><span data-stu-id="46c65-230">Change the `OldValuesParameterFormatString` property back to its default value, `{0}`, and configure the GridView to support paging, sorting, and editing.</span></span> <span data-ttu-id="46c65-231">Поскольку `UploadProducts` перегруженный метод, используемый с CL принимает только имя продукта s и цену, ограничить GridView, чтобы только эти поля являются изменяемыми.</span><span class="sxs-lookup"><span data-stu-id="46c65-231">Since the `UploadProducts` overload used by the CL accepts only the edited product s name and price, limit the GridView so that only these fields are editable.</span></span>

<span data-ttu-id="46c65-232">В предыдущем учебнике мы определили GridView, чтобы включить поля для `ProductName`, `CategoryName`, и `UnitPrice` поля.</span><span class="sxs-lookup"><span data-stu-id="46c65-232">In the preceding tutorial we defined a GridView to include fields for the `ProductName`, `CategoryName`, and `UnitPrice` fields.</span></span> <span data-ttu-id="46c65-233">Вы можете реплицировать этот формат и структуру, в этом случае к GridView и ObjectDataSource s декларативный должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="46c65-233">Feel free to replicate this formatting and structure, in which case your GridView and ObjectDataSource s declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](caching-data-in-the-architecture-vb/samples/sample11.aspx)]

<span data-ttu-id="46c65-234">На этом этапе у нас есть страницы, использующей уровень кэширования.</span><span class="sxs-lookup"><span data-stu-id="46c65-234">At this point we have a page that uses the Caching Layer.</span></span> <span data-ttu-id="46c65-235">Чтобы просмотреть кэш в действии, установите точки останова в `ProductsCL` класса s `GetProducts()` и `UpdateProduct` методы.</span><span class="sxs-lookup"><span data-stu-id="46c65-235">To see the cache in action, set breakpoints in the `ProductsCL` class s `GetProducts()` and `UpdateProduct` methods.</span></span> <span data-ttu-id="46c65-236">Перейдите на страницу в браузере и пошагового выполнения кода, пока сортировки и разбиения на страницы для просмотра данных из кэша.</span><span class="sxs-lookup"><span data-stu-id="46c65-236">Visit the page in a browser and step through the code when sorting and paging in order to see the data pulled from the cache.</span></span> <span data-ttu-id="46c65-237">Затем обновите запись и обратите внимание, что кэш становится недействительным, и, следовательно, он извлекается из МЕТОДА когда привязываются к GridView.</span><span class="sxs-lookup"><span data-stu-id="46c65-237">Then update a record and note that the cache is invalidated and, consequently, it is retrieved from the BLL when the data is rebound to the GridView.</span></span>

> [!NOTE]
> <span data-ttu-id="46c65-238">Уровень кэширования, предоставленные в этой статье для загрузки не завершена.</span><span class="sxs-lookup"><span data-stu-id="46c65-238">The Caching Layer provided in the download accompanying this article is not complete.</span></span> <span data-ttu-id="46c65-239">Он содержит только один класс `ProductsCL`, который только спортивные небольшое число методов.</span><span class="sxs-lookup"><span data-stu-id="46c65-239">It contains only one class, `ProductsCL`, which only sports a handful of methods.</span></span> <span data-ttu-id="46c65-240">Кроме того, на одной странице ASP.NET использует CL (`~/Caching/FromTheArchitecture.aspx`) все остальные по-прежнему ссылаться МЕТОДА напрямую.</span><span class="sxs-lookup"><span data-stu-id="46c65-240">Moreover, only a single ASP.NET page uses the CL (`~/Caching/FromTheArchitecture.aspx`) all others still reference the BLL directly.</span></span> <span data-ttu-id="46c65-241">Если планируется использование CL в приложении, все вызовы от уровня представления следует перейдите CL, которое потребует, CL s классы и методы рассматриваются эти классы и методы в момент используется уровень представления данных МЕТОДА.</span><span class="sxs-lookup"><span data-stu-id="46c65-241">If you plan on using a CL in your application, all calls from the Presentation Layer should go to the CL, which would require that the CL s classes and methods covered those classes and methods in the BLL currently used by the Presentation Layer.</span></span>


## <a name="summary"></a><span data-ttu-id="46c65-242">Сводка</span><span class="sxs-lookup"><span data-stu-id="46c65-242">Summary</span></span>

<span data-ttu-id="46c65-243">Во время кэширования могут применяться на уровне представления данных с помощью ASP.NET 2.0 s SqlDataSource и элементы управления ObjectDataSource, в идеале кэширование обязанности бы делегировать отдельный уровень в архитектуре.</span><span class="sxs-lookup"><span data-stu-id="46c65-243">While caching can be applied at the Presentation Layer with ASP.NET 2.0 s SqlDataSource and ObjectDataSource controls, ideally caching responsibilities would be delegated to a separate layer in the architecture.</span></span> <span data-ttu-id="46c65-244">В этом учебнике мы создали слой кэширование, в котором находится между уровнем представления данных и уровня бизнес-логики.</span><span class="sxs-lookup"><span data-stu-id="46c65-244">In this tutorial we created a Caching Layer that resides between the Presentation Layer and the Business Logic Layer.</span></span> <span data-ttu-id="46c65-245">Уровень кэширования необходимо было предоставить тот же набор классов и методов, которые существуют в МЕТОДА и вызываются из уровня представления.</span><span class="sxs-lookup"><span data-stu-id="46c65-245">The Caching Layer needs to provide the same set of classes and methods that exist in the BLL and are called from the Presentation Layer.</span></span>

<span data-ttu-id="46c65-246">Примеры кэширования слоев, мы изучена в этом и предыдущем учебники короткая *реактивный загрузки*.</span><span class="sxs-lookup"><span data-stu-id="46c65-246">The Caching Layer examples we explored in this and the preceding tutorials exhibited *reactive loading*.</span></span> <span data-ttu-id="46c65-247">При загрузке реактивный, данные загружаются в кэш только в том случае, если запрос на получение данных и данных отсутствует в кэше.</span><span class="sxs-lookup"><span data-stu-id="46c65-247">With reactive loading, the data is loaded into the cache only when a request for the data is made and that data is missing from the cache.</span></span> <span data-ttu-id="46c65-248">Данные также могут быть *заранее загрузить* в кэш, метод, загружает данные в кэше, прежде чем это действительно необходимо.</span><span class="sxs-lookup"><span data-stu-id="46c65-248">Data can also be *proactively loaded* into the cache, a technique that loads the data into the cache before it is actually needed.</span></span> <span data-ttu-id="46c65-249">В следующем уроке мы рассмотрим пример упреждающего загрузки, когда мы рассмотрим, как для хранения статических значений в кэш при запуске приложения.</span><span class="sxs-lookup"><span data-stu-id="46c65-249">In the next tutorial we'll see an example of proactive loading when we look at how to store static values into the cache at application startup.</span></span>

<span data-ttu-id="46c65-250">Программирование довольны!</span><span class="sxs-lookup"><span data-stu-id="46c65-250">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="46c65-251">Об авторе</span><span class="sxs-lookup"><span data-stu-id="46c65-251">About the Author</span></span>

<span data-ttu-id="46c65-252">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="46c65-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="46c65-253">Скотт — независимый консультант, trainer и записи.</span><span class="sxs-lookup"><span data-stu-id="46c65-253">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="46c65-254">Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="46c65-254">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="46c65-255">Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="46c65-255">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="46c65-256">Благодарности</span><span class="sxs-lookup"><span data-stu-id="46c65-256">Special Thanks To</span></span>

<span data-ttu-id="46c65-257">Этот учебник ряд прошел проверку многие полезные рецензентов.</span><span class="sxs-lookup"><span data-stu-id="46c65-257">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="46c65-258">Основной рецензент этого учебника было Мерфи Тереза д.</span><span class="sxs-lookup"><span data-stu-id="46c65-258">Lead reviewer for this tutorial was Teresa Murphy.</span></span> <span data-ttu-id="46c65-259">Объясняются моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="46c65-259">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="46c65-260">Если Да, напишите мне по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="46c65-260">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="46c65-261">[Назад](caching-data-with-the-objectdatasource-vb.md)
[Вперед](caching-data-at-application-startup-vb.md)</span><span class="sxs-lookup"><span data-stu-id="46c65-261">[Previous](caching-data-with-the-objectdatasource-vb.md)
[Next](caching-data-at-application-startup-vb.md)</span></span>
