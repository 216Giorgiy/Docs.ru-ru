---
uid: web-forms/overview/data-access/working-with-binary-files/uploading-files-vb
title: Передача файлов (VB) | Документы Microsoft
author: rick-anderson
description: Узнайте, как разрешить пользователям отправлять двоичных файлов (таких как документы Word или PDF) на веб-сайт, где они могут храниться в файловой системе либо сервера...
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/27/2007
ms.topic: article
ms.assetid: f7c00fbd-652c-433d-8ed3-0e5168a4d4df
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/uploading-files-vb
msc.type: authoredcontent
ms.openlocfilehash: fbc4aaf80ac7e0f960e140b492055fe35cd2b6ce
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/10/2018
ms.locfileid: "30888101"
---
<a name="uploading-files-vb"></a>Передача файлов (Visual Basic)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить пример приложения](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_VB.exe) или [скачать PDF](uploading-files-vb/_static/datatutorial54vb1.pdf)

> Узнайте, как разрешить пользователям отправлять двоичных файлов (таких как документы Word или PDF) на веб-сайт, где они могут храниться в файловой системе сервера или базы данных.


## <a name="introduction"></a>Вступление

Все части руководства мы хранить, пока проверяется работали только с текстовыми данными. Однако многие приложения имеют моделей данных, отображающие текст и двоичные данные. Предоставить пользователям возможность отправить изображения, чтобы связать их профиль с dating сайт электронной документации. Источники набора веб-сайта могут пользователи могут отправить свои резюме как документ Microsoft Word или PDF.

Работа с двоичными данными добавляет новый набор задач. Необходимо решить, как двоичные данные хранятся в приложении. Интерфейс, используемый для вставки новых записей должен обновляться, чтобы разрешить пользователю загружать файлы со своих компьютеров, и необходимо выполнить дополнительные действия для отображения или предоставляют средства для загрузки запись s связанными двоичными данными. В этом учебнике и далее три мы изучим, как hurdle этих проблем. По окончании этих учебников мы будем построен полнофункциональные приложения, которое связывает изображения и PDF брошюр с каждой категории. В этом учебнике определенного мы рассмотрим различные методы для хранения двоичных данных и показано, как разрешить пользователям загружать файлы со своих компьютеров, и сохранили его в файловой системе web server s.

> [!NOTE]
> Двоичные данные, является частью модели данных приложения s, иногда называют [большого двоичного ОБЪЕКТА](http://en.wikipedia.org/wiki/Binary_large_object), сокращение для большого двоичного объекта. В этих учебниках я решил терминология двоичные данные, несмотря на то, что термин большой двоичный объект является синонимом.


## <a name="step-1-creating-the-working-with-binary-data-web-pages"></a>Шаг 1: Создание рабочего с двоичными данными веб-страницы

Перед началом изучения проблемы, связанные с добавлением поддержки двоичных данных, позволяют сначала занять некоторое время для создания страниц ASP.NET в данном проекте веб-сайта, он понадобится для этого учебника и трех последующих s. Начните с добавления в новую папку с именем `BinaryData`. Добавьте следующие страницы ASP.NET в этой папке, убедитесь, что связать каждую страницу с `Site.master` главной страницы:

- `Default.aspx`
- `FileUpload.aspx`
- `DisplayOrDownloadData.aspx`
- `UploadInDetailsView.aspx`
- `UpdatingAndDeleting.aspx`


![Добавление страниц ASP.NET для использования учебников двоичные данные, связанные](uploading-files-vb/_static/image1.gif)

**Рис. 1**: Добавление страниц ASP.NET для использования учебников двоичные данные, связанные


Как и в других папках, `Default.aspx` в `BinaryData` папки будут перечислены учебники в своем разделе. Помните, что `SectionLevelTutorialListing.ascx` пользовательский элемент управления предоставляет следующие функциональные возможности. Таким образом, добавьте этот пользовательский элемент управления для `Default.aspx` , перетащив его из обозревателя решений на странице s представление конструктора.


[![Добавление Default.aspx SectionLevelTutorialListing.ascx пользовательского элемента управления](uploading-files-vb/_static/image2.gif)](uploading-files-vb/_static/image1.png)

**На рисунке 2**: добавление `SectionLevelTutorialListing.ascx` пользовательского элемента управления на `Default.aspx` ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image2.png))


И, наконец, добавьте эти страницы как операции для `Web.sitemap` файла. В частности, добавьте следующую разметку после увеличение GridView `<siteMapNode>`:


[!code-xml[Main](uploading-files-vb/samples/sample1.xml)]

После обновления `Web.sitemap`, занять некоторое время для просмотра учебников веб-сайт с помощью браузера. В левом меню теперь включает элементы для работы с учебниками двоичных данных.


![Карта сайта теперь включает операции для работы с учебниками двоичных данных](uploading-files-vb/_static/image3.gif)

**Рис. 3**: карта сайта теперь включает операции для работы с учебниками двоичных данных


## <a name="step-2-deciding-where-to-store-the-binary-data"></a>Шаг 2: Выбор места для хранения двоичных данных

Двоичные данные, связанные с моделью данных s приложения могут храниться в одном из двух мест: в файловой системе сервера s web со ссылкой на файл, хранящийся в базе данных. или непосредственно в самой базе данных (см. рис. 4). Каждый подход имеет свой собственный набор преимуществ и недостатков и допускает более подробное рассмотрение.


[![Двоичные данные могут храниться в файловой системе или непосредственно в базе данных](uploading-files-vb/_static/image4.gif)](uploading-files-vb/_static/image3.png)

**Рис. 4**: двоичные данные могут храниться в файловой системе или непосредственно в базе данных ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image4.png))


Предположим, мы хотим расширить базу данных Northwind для присоединения к ним изображения каждого продукта. Один из вариантов, можно хранить эти файлы изображений в файловой системе сервера s web и запишите путь в `Products` таблицы. При таком подходе d добавим `ImagePath` столбец `Products` таблицы типа `varchar(200)`, возможно. При отправке пользователем рисунка для товара этот рисунок может храниться в файловой системе сервера s web в `~/Images/Tea.jpg`, где `~` представляет s физический путь к приложению. То есть если веб-сайт находится в физический путь к папке `C:\Websites\Northwind\`, `~/Images/Tea.jpg` равнозначно `C:\Websites\Northwind\Images\Tea.jpg`. После отправки файла изображения, мы d обновить запись Chai в `Products` таблицы, чтобы его `ImagePath` путь нового образа, ссылки на столбец. Мы могли бы использовать `~/Images/Tea.jpg` или просто `Tea.jpg` Если мы решили, что все изображения продукта будет помещен в приложение s `Images` папки.

Ниже перечислены основные преимущества хранения двоичных данных в файловой системе

- **Простота реализации** как мы скоро будет убедиться, хранения и извлечения двоичных данных непосредственно в базе данных включает в себя немного больше кода, чем при работе с данными с помощью файловой системы. Кроме того в порядке, пользователь может просмотреть или загрузить двоичных данных они должен быть предоставлен URL-адрес, к этим данным. Если данные находятся в файловой системе web server s, нетрудно URL-адрес. Если данные хранятся в базе данных, с веб-страницами необходимо создать, будет извлекать и возвращать данные из базы данных.
- **Широкий доступ к двоичным данным** двоичные данные могут должны быть доступны для других служб или приложений, которые не может извлекать данные из базы данных. Например, изображения, связанные с каждого продукта может также должны быть доступны пользователям через [FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol), в этом случае d необходимо для хранения двоичных данных в файловой системе.
- **Производительность** если двоичные данные хранятся в файловой системе, перегрузки спроса и сети между сервером базы данных и веб-сервер будет меньше, чем если двоичные данные хранятся непосредственно в базе данных.

Главным недостатком хранения двоичных данных в файловой системе, является он разрывает связь из базы данных. Если запись удалена из `Products` таблицы, связанный файл в файловой системе web server s не удаляется автоматически. Нам необходимо написать дополнительный код для удаления файла или файловой системы будет стать загроможденными при наличии множества неиспользуемые, потерянных файлов. Кроме того при резервном копировании базы данных, мы должны убедитесь, что делать резервные копии связанных двоичных данных в файловой системе, а также. Перемещение базы данных на другой сайт или сервер создает угрозу с подобными проблемами.

Кроме того, двоичные данные могут храниться непосредственно в базе данных Microsoft SQL Server 2005, создав столбец типа `varbinary`. Как и с другими типами данных переменной длины, можно указать Максимальная длина двоичных данных, находящихся в этом столбце. Например, резервирование не более 5 000 байт использовать `varbinary(5000)`; `varbinary(MAX)` обеспечивает максимальный размер хранилища, около 2 ГБ.

Главным преимуществом хранения двоичных данных непосредственно в базе данных является тесную связь между двоичных данных и запись базы данных. Это значительно упрощает задачи администрирования базы данных, таких как резервное копирование или перемещение базы данных на другой узел или сервер. Кроме того запись автоматически при удалении соответствующих двоичных данных. Существуют также дополнительные небольшие преимущества хранения двоичных данных в базе данных. В разделе [хранения двоичные файлы непосредственно в базе данных с помощью ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx) для более подробного рассмотрения.

> [!NOTE]
> В Microsoft SQL Server 2000 и более ранних версиях `varbinary` тип данных имели максимальное ограничение в 8 000 байт. Для хранения двоичных данных до 2 ГБ [ `image` тип данных](https://msdn.microsoft.com/library/ms187993.aspx) необходимо использовать вместо него. С добавлением `MAX` в SQL Server 2005, однако `image` тип данных рекомендуется к использованию. Он s по-прежнему поддерживается для обеспечения обратной совместимости, но корпорация Майкрософт объявила, `image` тип данных будет исключена в будущей версии SQL Server.


Если вы работаете с более старая модель данных может появиться `image` тип данных. База данных "Борей" s `Categories` таблица имеет `Picture` столбец, который может использоваться для хранения двоичных данных файла изображения для категории. Поскольку в базе данных Northwind корнями в Microsoft Access и более ранних версиях SQL Server, этот столбец имеет тип `image`.

Для этого учебника и трех последующих мы будем использовать оба подхода. `Categories` Таблице уже есть `Picture` столбца для хранения двоичного содержимого изображения для категории. Мы добавим дополнительный столбец, `BrochurePath`для сохранения пути в PDF-файл в файловой системе сервера s web, можно использовать для предоставления качество печати, профессиональный Обзор категории.

## <a name="step-3-adding-thebrochurepathcolumn-to-thecategoriestable"></a>Шаг 3: Добавление`BrochurePath`столбец`Categories`таблицы

В данный момент Таблица типов имеет только четыре столбца: `CategoryID`, `CategoryName`, `Description`, и `Picture`. Помимо этих полей необходимо добавить новый, который будет указывать брошюр категории s (если он существует). Чтобы добавить этот столбец, перейдите в обозреватель сервера детализации таблицы, щелкните правой кнопкой мыши `Categories` таблицы и нажмите кнопку Открыть определение таблицы (см. рис. 5). Если вы не видите обозревателя серверов, открыть, выбрав параметр обозревателя серверов из меню «Вид» или нажмите сочетание клавиш Ctrl + Alt + S.

Добавьте новый `varchar(200)` столбец `Categories` таблицу с именем `BrochurePath` и позволяет `NULL` s и щелкните значок сохранения (или нажмите сочетание клавиш Ctrl + S).


[![Добавить столбец BrochurePath в таблицу Categories](uploading-files-vb/_static/image5.gif)](uploading-files-vb/_static/image5.png)

**Рис. 5**: добавление `BrochurePath` столбец `Categories` таблицы ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image6.png))


## <a name="step-4-updating-the-architecture-to-use-thepictureandbrochurepathcolumns"></a>Шаг 4: Обновление архитектура для использования`Picture`и`BrochurePath`столбцов

`CategoriesDataTable` Слой доступа к данным (DAL) в настоящее время имеет четыре `DataColumn` определенных: `CategoryID`, `CategoryName`, `Description`, и `NumberOfProducts`. Когда мы первоначально разработано этому DataTable в [Создание слой доступа к данным](../introduction/creating-a-data-access-layer-vb.md) учебнике `CategoriesDataTable` ставилась первых трех столбцах; `NumberOfProducts` столбец был добавлен в [главного и подчиненного представлений с помощью маркированный Список записей Master с помощью DataList сведения](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md) учебника.

Как было сказано в *Создание слой доступа к данным*, DataTables типизированного набора данных составляют бизнес-объектов. Адаптеры таблиц отвечают за взаимодействие с базой данных и заполнения бизнес-объектов с результатами запроса. `CategoriesDataTable` Заполняется `CategoriesTableAdapter`, который имеет три метода извлечения данных:

- `GetCategories()` выполняет s основного запроса адаптера таблицы и возвращает `CategoryID`, `CategoryName`, и `Description` поля всех записей в `Categories` таблицы. Основной запрос используется, автоматически сгенерированный `Insert` и `Update` методы.
- `GetCategoryByCategoryID(categoryID)` Возвращает `CategoryID`, `CategoryName`, и `Description` поля категории которого `CategoryID` равняется *categoryID*.
- `GetCategoriesAndNumberOfProducts()` — Возвращает `CategoryID`, `CategoryName`, и `Description` поля для всех записей в `Categories` таблицы. Также использует вложенный запрос для возврата количества продуктов, связанных с каждой категории.

Обратите внимание, что ни один из них возвращаемых запросами `Categories` таблицу s `Picture` или `BrochurePath` столбцы; также не `CategoriesDataTable` предоставляют `DataColumn` s для этих полей. Для работы с изображением и `BrochurePath` свойства, необходимо предварительно добавить их в `CategoriesDataTable` и обновите `CategoriesTableAdapter` класса, чтобы вернуть эти столбцы.

## <a name="adding-thepictureandbrochurepathdatacolumn-s"></a>Добавление`Picture`и`BrochurePath``DataColumn` s

Начните с добавления этих двух столбцов, чтобы `CategoriesDataTable`. Щелкните правой кнопкой мыши `CategoriesDataTable` заголовок s, выберите пункт "Добавить" в контекстном меню, а затем выберите вариант столбца. Это создаст новый `DataColumn` в DataTable с именем `Column1`. Переименовать этот столбец в `Picture`. В окне «Свойства» задайте `DataColumn` s `DataType` свойства `System.Byte[]` (это не параметр в раскрывающемся списке, вам нужно ввести его в).


[![Создание изображений DataColumn с именем, типом данных является System.Byte]](uploading-files-vb/_static/image6.gif)](uploading-files-vb/_static/image7.png)

**Рис. 6**: создание `DataColumn` именованных `Picture` которого `DataType` — `System.Byte[]` ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image8.png))


Добавьте еще один `DataColumn` в таблицу DataTable, присвоив ему имя `BrochurePath` с помощью стандартных `DataType` значение (`System.String`).

## <a name="returning-thepictureandbrochurepathvalues-from-the-tableadapter"></a>Возвращение`Picture`и`BrochurePath`значения из адаптера таблицы

С помощью этих двух `DataColumn` , добавленные `CategoriesDataTable`, мы готов для обновления `CategoriesTableAdapter`. Это может быть оба этих значения столбцов возвращаются в основной запрос адаптера таблицы, но в результате выполнения обратно двоичные данные при каждом `GetCategories()` был вызван метод. Вместо этого s позволяют обновить основной запрос адаптера таблицы для возврата `BrochurePath` и создайте метод получения дополнительных данных, который возвращает определенной категории s `Picture` столбца.

Чтобы обновить основной запрос адаптера таблицы, щелкните правой кнопкой мыши `CategoriesTableAdapter` s заголовка и выберите в контекстном меню Настройка. Откроется окно мастера настройки адаптера таблицы, которые мы хранить в число последних учебники. Обновить запрос для возврата `BrochurePath` и нажмите кнопку Готово.


[![Обновление списка столбцов в инструкции SELECT, также возвратит BrochurePath](uploading-files-vb/_static/image7.gif)](uploading-files-vb/_static/image9.png)

**Рис. 7**: обновление списка столбцов в `SELECT` инструкция также вернет `BrochurePath` ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image10.png))


При использовании нерегламентированных инструкций SQL для адаптера таблицы, список столбцов в основном запросе обновление обновляет список столбцов для всех `SELECT` методы в TableAdapter запроса. Это означает `GetCategoryByCategoryID(categoryID)` метода теперь возвращают `BrochurePath` столбец, который может быть было предусмотрено. Однако он также обновляется список столбцов в `GetCategoriesAndNumberOfProducts()` метода, удалить вложенный запрос, возвращающий число продуктов в каждой категории. Таким образом, необходимо обновить этот метод s `SELECT` запроса. Щелкните правой кнопкой мыши `GetCategoriesAndNumberOfProducts()` выберите Настройка метода и верните `SELECT` запрос обратно в исходное значение:


[!code-sql[Main](uploading-files-vb/samples/sample2.sql)]

Создайте новый метод адаптера таблицы, который возвращает определенной категории s `Picture` значение столбца. Щелкните правой кнопкой мыши `CategoriesTableAdapter` s заголовка и выберите пункт Добавить запрос, чтобы запустить мастер настройки запроса адаптера таблицы. На первом шаге работы этот мастер запрашивает Если мы хотим для запроса данных с помощью инструкции SQL ad-hoc, новая хранимая процедура, уже существующий. Выберите использовать инструкции SQL и нажмите кнопку Далее. Поскольку мы будет возвращать строку, выберите SELECT, возвращающая параметр строки из второй шаг.


[![Выберите параметр использовать SQL-инструкции](uploading-files-vb/_static/image8.gif)](uploading-files-vb/_static/image11.png)

**Рис. 8**: выберите инструкции SQL используйте параметр ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image12.png))


[![Так как запрос будет возвращать записи из таблицы Categories, выбор SELECT, возвращающая строки](uploading-files-vb/_static/image9.gif)](uploading-files-vb/_static/image13.png)

**Рис. 9**: так как запрос будет возвращать записи из таблицы Categories, нажмите кнопку Выбрать, какие возвращает строки ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image14.png))


На третьем шаге введите следующий SQL-запрос и нажмите кнопку Далее.


[!code-sql[Main](uploading-files-vb/samples/sample3.sql)]

Последним шагом является выбор имя для нового метода. Используйте `FillCategoryWithBinaryDataByCategoryID` и `GetCategoryWithBinaryDataByCategoryID` для заполнения таблицы данных и Возврат DataTable, шаблоны, соответственно. Нажмите кнопку Готово, чтобы завершить работу мастера.


[![Выберите имена для s методы адаптера таблицы](uploading-files-vb/_static/image10.gif)](uploading-files-vb/_static/image15.png)

**Рис. 10**: выберите имена для s адаптера таблицы методы ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image16.png))


> [!NOTE]
> После завершения работы мастера настройки запроса адаптера таблицы может появиться диалоговое окно, информирующее о том, что новый текст команды возвращает данные со схемой отличается от схемы основного запроса. Иными словами, мастер отметить, что основной запрос адаптера таблицы s `GetCategories()` возвращает другую схему от того, мы только что создали. Но мы хотим, чтобы это сообщение можно пропустить.


Кроме того, имейте в виду, что если вы используете специализированные инструкции SQL и использовать мастер для изменения основного запроса адаптера таблицы s в более поздний момент времени, он изменит `GetCategoryWithBinaryDataByCategoryID` метод s `SELECT` инструкцию s список столбцов, чтобы включить только те столбцы из основной запрос (то есть он удалит `Picture` столбца из запроса). Необходимо будет вручную обновить список столбцов, чтобы вернуть `Picture` столбцов, как и на то, что мы сделали с `GetCategoriesAndNumberOfProducts()` метод ранее на этом шаге.

После добавления двух `DataColumn` s, чтобы `CategoriesDataTable` и `GetCategoryWithBinaryDataByCategoryID` метод `CategoriesTableAdapter`, эти классы в конструкторе типизированного набора данных должна выглядеть на снимке экрана на рис. 11.


![Конструктор наборов данных включает в себя новые столбцы и метод](uploading-files-vb/_static/image11.gif)

**Рис. 11**: конструктор набора данных включает в себя новые столбцы и метод


## <a name="updating-the-business-logic-layer-bll"></a>Обновление уровня бизнес-логики (уровень бизнес-ЛОГИКИ)

Обновить DAL, все, что остается только для дополнения для него метод для нового слоя бизнес-логики (BLL) `CategoriesTableAdapter` метод. Добавьте следующий метод `CategoriesBLL` класса:


[!code-vb[Main](uploading-files-vb/samples/sample4.vb)]

## <a name="step-5-uploading-a-file-from-the-client-to-the-web-server"></a>Шаг 5: Загрузка файла от клиента к веб-серверу

При сборе двоичных данных, зачастую это данные предоставляются конечным пользователем. Для сбора этой информации, пользователь должен иметь возможность загрузить файл со своего компьютера на веб-сервер. Загруженные данные необходимо интегрировать с моделью данных, которая может означать сохранения файла в web server s файловой системы и добавление путь к файлу базы данных или записи содержимого двоичных непосредственно в базу данных. На этом шаге мы рассмотрим как разрешить пользователю загружать файлы со своего компьютера на сервер. В следующем уроке мы будем можем обратиться к интеграции загруженный файл с моделью данных.

ASP.NET 2.0 новые [FileUpload веб-элемент управления](https://msdn.microsoft.com/library/ms227677(VS.80).aspx) предоставляет механизм для пользователей отправить файл со своего компьютера на веб-сервер. Элемент управления FileUpload готовится к просмотру как `<input>` элемент которого `type` атрибута задано значение файл, который будет отображаться в браузерах как текстовое поле с кнопкой "Обзор". Нажав кнопку обзора появится диалоговое окно, из которого пользователь может выбрать файл. Когда форма передается назад, s содержимое выбранного файла отправляется вместе с обратной передачи. На стороне сервера сведения о загруженный файл доступен с помощью свойства s FileUpload элемента управления.

Чтобы продемонстрировать Отправка файлов, откройте `FileUpload.aspx` страницы в `BinaryData` , перетащите элемент управления FileUpload из области элементов в конструктор, а задать элемент управления s `ID` свойства `UploadTest`. Добавьте кнопку веб-элемент управления параметр его `ID` и `Text` свойства `UploadButton` и отправить файл выбранные, соответственно. Наконец, разместить веб-управления Label под кнопкой, очистить его `Text` и установите его `ID` свойства `UploadDetails`.


[![Добавление элемента управления FileUpload страницы ASP.NET](uploading-files-vb/_static/image12.gif)](uploading-files-vb/_static/image17.png)

**Рис. 12**: Добавление элемента управления FileUpload страницы ASP.NET ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image18.png))


На рисунке 13 показано эту страницу при просмотре через браузер. Обратите внимание, что нажатие кнопки обзора появится диалоговое окно выбора файла, позволяя пользователю выбрать файл со своих компьютеров. После выбора файла, нажмите кнопку Отправить выбранный файл вызывает обратную передачу, отправляет двоичное содержимое выбранного файла s веб-сервер.


[![Пользователь может выбрать файл для передачи со своего компьютера на сервер](uploading-files-vb/_static/image13.gif)](uploading-files-vb/_static/image19.png)

**Рис. 13**: пользователь может выбрать файл для передачи со своего компьютера на сервер ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image20.png))


При обратной передаче можно сохранить загруженный файл в файловой системе или двоичные данные можно работать напрямую с помощью потока. В этом примере позволяют создать s `~/Brochures` папку и сохранить отправленный файл существует. Начните с добавления `Brochures` папки на сайт как вложенную папку корневого каталога. Создайте обработчик событий для `UploadButton` s `Click` событий и добавьте следующий код:


[!code-vb[Main](uploading-files-vb/samples/sample5.vb)]

Элемент управления FileUpload предоставляет широкий набор свойств для работы с загруженные данные. Для экземпляра [ `HasFile` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx) указывает, передаются ли файл пользователем, пока [ `FileBytes` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx) предоставляет доступ к загруженные двоичные данные в виде массива байтов. `Click` Запускает обработчик событий, гарантируя, что файл был загружен. Если файл был загружен, метка показывает имя отправленного файла, его размер в байтах и типа содержимого.

> [!NOTE]
> Чтобы убедиться, что пользователь отправляет файл, вы можете проверить `HasFile` свойства и отображает предупреждение, если он s `False`, или вы можете использовать [управления RequiredFieldValidator](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx) вместо.


FileUpload s `SaveAs(filePath)` сохраняет загруженный файл в указанном *filePath*. *filePath* должно быть *физический путь* (`C:\Websites\Brochures\SomeFile.pdf`), а не *виртуальных* *путь* (`/Brochures/SomeFile.pdf`). [ `Server.MapPath(virtPath)` Метод](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx) Получает виртуальный путь и возвращает соответствующий физический путь. Здесь — виртуальный путь `~/Brochures/fileName`, где *fileName* имя отправленного файла. В разделе [с помощью Server.MapPath](http://www.4guysfromrolla.com/webtech/121799-1.shtml) Дополнительные сведения о виртуальных и физических путей и с помощью `Server.MapPath`.

После завершения `Click` обработчика событий, теперь пора проверить страницы в браузере. Нажмите кнопку обзора и выберите файл с жесткого диска и затем нажмите кнопку Отправить выбранный файл. Обратная передача будет отправлять содержимое выбранного файла на веб-сервер, который затем выводит сведения о файле до сохранения его в `~/Brochures` папки. После отправки файла, вернитесь в Visual Studio и нажмите кнопку "Обновить" в обозревателе решений. Будет показан файл, загруженный в папке ~/Brochures!


[![EvolutionValley.jpg файл был загружен для веб-сервера](uploading-files-vb/_static/image14.gif)](uploading-files-vb/_static/image21.png)

**Рис. 14**: файл `EvolutionValley.jpg` загрузки на веб-сервер ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image22.png))


![EvolutionValley.jpg Was Saved to the ~/Brochures Folder](uploading-files-vb/_static/image15.gif)

**Рис. 15**: `EvolutionValley.jpg` был сохранен на `~/Brochures` папки


## <a name="subtleties-with-saving-uploaded-files-to-the-file-system"></a>Тонкостей с сохранение переданные файлы в файловой системе

Существует несколько тонкостей, которые должны учитываться при сохранении передача файлов в файловой системе web server s. Во-первых, существует проблема безопасности. Чтобы сохранить файл в файловой системе, контекст безопасности, в котором выполняется страница ASP.NET требуются разрешения записи. Веб-сервера разработки ASP.NET выполняется в контексте текущей учетной записи пользователя. Если вы используете s Microsoft Internet Information Services (IIS) и веб-сервер, контекст безопасности зависит от версии IIS и его конфигурации.

Еще одна проблема сохранения файлов в файловой системе строится на имена файлов. В настоящее время нашу страницу сохраняет все загруженные файлы для `~/Brochures` каталог с тем же именем, как этот файл на компьютере клиента s. Если пользователь А отправляет брошюр с именем `Brochure.pdf`, файл будет сохранен как `~/Brochure/Brochure.pdf`. Но что делать, если когда-нибудь более поздней версии пользователь Б отправляет брошюр другой файл с тем же именем файла (`Brochure.pdf`)? Кодом у нас есть теперь файл s будет заменен пользователь Б s передачи пользователя.

Существует несколько способов разрешения конфликтов имен файлов. Один из вариантов — запретить загрузки файла, если уже существует с тем же именем. При таком подходе, когда пользователь Б пытается передать файл с именем `Brochure.pdf`, система не будет сохранить их в файл и вместо них будет отображаться сообщение о том, пользователь Б, переименуйте файл и повторите попытку. Другой подход заключается в сохранить файл, используя уникальное имя файла, который может быть [глобальный уникальный идентификатор (GUID)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier) или значение из соответствующего базы данных столбцы первичного ключа записи s (предполагая, что сопоставленный передачи конкретной строки в модели данных). В следующем уроке мы изучим более подробно эти параметры.

## <a name="challenges-involved-with-very-large-amounts-of-binary-data"></a>Задачам, связанным с очень больших объемов двоичных данных

В этих учебниках предполагается, что двоичные данные используется небольшого размера. Работа с очень больших объемов двоичных данных файлов, несколько мегабайт или больше возникают новые проблемы, которые выходят за рамки этих учебников. Например, по умолчанию ASP.NET отклонит передачи более 4 МБ, несмотря на то, что это можно настроить с помощью [ `<httpRuntime>` элемент](https://msdn.microsoft.com/library/e1f13641.aspx) в `Web.config`. IIS слишком налагает собственные передачи ограничений на размер файла. В разделе [объем отправляемых файлов IIS](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html) для получения дополнительной информации. Кроме того время, необходимое для отправки больших файлов может превышать значение по умолчанию 110 секунд ожидания ASP.NET для запроса. Существуют также памятью и производительностью проблем, возникающих при работе с большими файлами.

Элемент управления FileUpload оказывается нецелесообразным для передачи больших файлов. Как содержимое файла s передаются на сервер, конечный пользователь будет продолжен терпеливо без подтверждения, выполняет их отправки. Это не так много проблемы при работе с файлами могут быть загружены через несколько секунд, которые необходимо учитывать при работе с большими файлами, может потребоваться минут для загрузки. Существует много независимых файла загрузки элементов управления, которые лучше подходят для обработки больших объемов и многие из этих поставщиков предоставляют ActiveX и индикаторов хода выполнения передачи диспетчеры, предоставляющие гораздо более профессиональный взаимодействие с пользователем.

Если приложению для обработки больших файлов, необходимо тщательно определить причину проблемы и найти подходящего решения для конкретных потребностей.

## <a name="summary"></a>Сводка

Построение приложения, которое требуется для записи двоичных данных представлен ряд проблем. В этом учебнике мы изучена первых двух: Выбор места для хранения двоичных данных и дает пользователям возможность передать двоичного содержимого через веб-страницу. На трех следующих руководствах мы рассмотрим, как связать загруженные данные с помощью записи в базе данных, а также как Вывод двоичных данных вместе с его текст поля данных.

Программирование довольны!

## <a name="further-reading"></a>Дополнительные сведения

Дополнительные сведения по темам, рассматриваемые в этом учебнике см. в следующих ресурсах:

- [Использование типов данных больших значений](https://msdn.microsoft.com/library/ms178158.aspx)
- [Примеры использования элемента управления fileUpload](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/fileupload.aspx)
- [Элемент управления сервера ASP.NET 2.0 FileUpload](http://www.wrox.com/WileyCDA/Section/id-292158.html)
- [Темный части передачи файлов](http://www.aspnetresources.com/articles/dark_side_of_file_uploads.aspx)

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года. Скотт — независимый консультант, trainer и записи. Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).

## <a name="special-thanks-to"></a>Благодарности

Этот учебник ряд прошел проверку многие полезные рецензентов. Основными редакторами этого учебника были Мерфи Тереза д и Екатерина Leigh. Объясняются моих последующих статей для MSDN? Если Да, напишите мне по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](updating-and-deleting-existing-binary-data-cs.md)
> [Вперед](displaying-binary-data-in-the-data-web-controls-vb.md)
