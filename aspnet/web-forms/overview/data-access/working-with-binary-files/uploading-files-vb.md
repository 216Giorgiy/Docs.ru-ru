---
uid: web-forms/overview/data-access/working-with-binary-files/uploading-files-vb
title: Передача файлов (VB) | Документы Microsoft
author: rick-anderson
description: Узнайте, как разрешить пользователям отправлять двоичных файлов (таких как документы Word или PDF) на веб-сайт, где они могут храниться в файловой системе либо сервера...
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/27/2007
ms.topic: article
ms.assetid: f7c00fbd-652c-433d-8ed3-0e5168a4d4df
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/uploading-files-vb
msc.type: authoredcontent
ms.openlocfilehash: fbc4aaf80ac7e0f960e140b492055fe35cd2b6ce
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/10/2018
---
<a name="uploading-files-vb"></a><span data-ttu-id="402e8-103">Передача файлов (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="402e8-103">Uploading Files (VB)</span></span>
====================
<span data-ttu-id="402e8-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="402e8-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="402e8-105">[Загрузить пример приложения](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_VB.exe) или [скачать PDF](uploading-files-vb/_static/datatutorial54vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="402e8-105">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_VB.exe) or [Download PDF](uploading-files-vb/_static/datatutorial54vb1.pdf)</span></span>

> <span data-ttu-id="402e8-106">Узнайте, как разрешить пользователям отправлять двоичных файлов (таких как документы Word или PDF) на веб-сайт, где они могут храниться в файловой системе сервера или базы данных.</span><span class="sxs-lookup"><span data-stu-id="402e8-106">Learn how to allow users to upload binary files (such as Word or PDF documents) to your Web site where they may be stored in either the server's file system or the database.</span></span>


## <a name="introduction"></a><span data-ttu-id="402e8-107">Вступление</span><span class="sxs-lookup"><span data-stu-id="402e8-107">Introduction</span></span>

<span data-ttu-id="402e8-108">Все части руководства мы хранить, пока проверяется работали только с текстовыми данными.</span><span class="sxs-lookup"><span data-stu-id="402e8-108">All of the tutorials we ve examined so far have worked exclusively with text data.</span></span> <span data-ttu-id="402e8-109">Однако многие приложения имеют моделей данных, отображающие текст и двоичные данные.</span><span class="sxs-lookup"><span data-stu-id="402e8-109">However, many applications have data models that capture both text and binary data.</span></span> <span data-ttu-id="402e8-110">Предоставить пользователям возможность отправить изображения, чтобы связать их профиль с dating сайт электронной документации.</span><span class="sxs-lookup"><span data-stu-id="402e8-110">An online dating site might allow users to upload a picture to associate with their profile.</span></span> <span data-ttu-id="402e8-111">Источники набора веб-сайта могут пользователи могут отправить свои резюме как документ Microsoft Word или PDF.</span><span class="sxs-lookup"><span data-stu-id="402e8-111">A recruiting website might let users upload their resume as a Microsoft Word or PDF document.</span></span>

<span data-ttu-id="402e8-112">Работа с двоичными данными добавляет новый набор задач.</span><span class="sxs-lookup"><span data-stu-id="402e8-112">Working with binary data adds a new set of challenges.</span></span> <span data-ttu-id="402e8-113">Необходимо решить, как двоичные данные хранятся в приложении.</span><span class="sxs-lookup"><span data-stu-id="402e8-113">We must decide how the binary data is stored in the application.</span></span> <span data-ttu-id="402e8-114">Интерфейс, используемый для вставки новых записей должен обновляться, чтобы разрешить пользователю загружать файлы со своих компьютеров, и необходимо выполнить дополнительные действия для отображения или предоставляют средства для загрузки запись s связанными двоичными данными.</span><span class="sxs-lookup"><span data-stu-id="402e8-114">The interface used for inserting new records has to be updated to allow the user to upload a file from their computer and extra steps must be taken to display or provide a means for downloading a record s associated binary data.</span></span> <span data-ttu-id="402e8-115">В этом учебнике и далее три мы изучим, как hurdle этих проблем.</span><span class="sxs-lookup"><span data-stu-id="402e8-115">In this tutorial and the next three we'll explore how to hurdle these challenges.</span></span> <span data-ttu-id="402e8-116">По окончании этих учебников мы будем построен полнофункциональные приложения, которое связывает изображения и PDF брошюр с каждой категории.</span><span class="sxs-lookup"><span data-stu-id="402e8-116">At the end of these tutorials we'll have built a fully functional application that associates a picture and PDF brochure with each category.</span></span> <span data-ttu-id="402e8-117">В этом учебнике определенного мы рассмотрим различные методы для хранения двоичных данных и показано, как разрешить пользователям загружать файлы со своих компьютеров, и сохранили его в файловой системе web server s.</span><span class="sxs-lookup"><span data-stu-id="402e8-117">In this particular tutorial we'll look at different techniques for storing binary data and explore how to enable users to upload a file from their computer and have it saved on the web server s file system.</span></span>

> [!NOTE]
> <span data-ttu-id="402e8-118">Двоичные данные, является частью модели данных приложения s, иногда называют [большого двоичного ОБЪЕКТА](http://en.wikipedia.org/wiki/Binary_large_object), сокращение для большого двоичного объекта.</span><span class="sxs-lookup"><span data-stu-id="402e8-118">Binary data that is part of an application s data model is sometimes referred to as a [BLOB](http://en.wikipedia.org/wiki/Binary_large_object), an acronym for Binary Large OBject.</span></span> <span data-ttu-id="402e8-119">В этих учебниках я решил терминология двоичные данные, несмотря на то, что термин большой двоичный объект является синонимом.</span><span class="sxs-lookup"><span data-stu-id="402e8-119">In these tutorials I have chosen to use the terminology binary data, although the term BLOB is synonymous.</span></span>


## <a name="step-1-creating-the-working-with-binary-data-web-pages"></a><span data-ttu-id="402e8-120">Шаг 1: Создание рабочего с двоичными данными веб-страницы</span><span class="sxs-lookup"><span data-stu-id="402e8-120">Step 1: Creating the Working with Binary Data Web Pages</span></span>

<span data-ttu-id="402e8-121">Перед началом изучения проблемы, связанные с добавлением поддержки двоичных данных, позволяют сначала занять некоторое время для создания страниц ASP.NET в данном проекте веб-сайта, он понадобится для этого учебника и трех последующих s.</span><span class="sxs-lookup"><span data-stu-id="402e8-121">Before we begin to explore the challenges associated with adding support for binary data, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next three.</span></span> <span data-ttu-id="402e8-122">Начните с добавления в новую папку с именем `BinaryData`.</span><span class="sxs-lookup"><span data-stu-id="402e8-122">Start by adding a new folder named `BinaryData`.</span></span> <span data-ttu-id="402e8-123">Добавьте следующие страницы ASP.NET в этой папке, убедитесь, что связать каждую страницу с `Site.master` главной страницы:</span><span class="sxs-lookup"><span data-stu-id="402e8-123">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `FileUpload.aspx`
- `DisplayOrDownloadData.aspx`
- `UploadInDetailsView.aspx`
- `UpdatingAndDeleting.aspx`


![Добавление страниц ASP.NET для использования учебников двоичные данные, связанные](uploading-files-vb/_static/image1.gif)

<span data-ttu-id="402e8-125">**Рис. 1**: Добавление страниц ASP.NET для использования учебников двоичные данные, связанные</span><span class="sxs-lookup"><span data-stu-id="402e8-125">**Figure 1**: Add the ASP.NET Pages for the Binary Data-Related Tutorials</span></span>


<span data-ttu-id="402e8-126">Как и в других папках, `Default.aspx` в `BinaryData` папки будут перечислены учебники в своем разделе.</span><span class="sxs-lookup"><span data-stu-id="402e8-126">Like in the other folders, `Default.aspx` in the `BinaryData` folder will list the tutorials in its section.</span></span> <span data-ttu-id="402e8-127">Помните, что `SectionLevelTutorialListing.ascx` пользовательский элемент управления предоставляет следующие функциональные возможности.</span><span class="sxs-lookup"><span data-stu-id="402e8-127">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="402e8-128">Таким образом, добавьте этот пользовательский элемент управления для `Default.aspx` , перетащив его из обозревателя решений на странице s представление конструктора.</span><span class="sxs-lookup"><span data-stu-id="402e8-128">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>


<span data-ttu-id="402e8-129">[![Добавление Default.aspx SectionLevelTutorialListing.ascx пользовательского элемента управления](uploading-files-vb/_static/image2.gif)](uploading-files-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="402e8-129">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](uploading-files-vb/_static/image2.gif)](uploading-files-vb/_static/image1.png)</span></span>

<span data-ttu-id="402e8-130">**На рисунке 2**: добавление `SectionLevelTutorialListing.ascx` пользовательского элемента управления на `Default.aspx` ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="402e8-130">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](uploading-files-vb/_static/image2.png))</span></span>


<span data-ttu-id="402e8-131">И, наконец, добавьте эти страницы как операции для `Web.sitemap` файла.</span><span class="sxs-lookup"><span data-stu-id="402e8-131">Lastly, add these pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="402e8-132">В частности, добавьте следующую разметку после увеличение GridView `<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="402e8-132">Specifically, add the following markup after the Enhancing the GridView `<siteMapNode>`:</span></span>


[!code-xml[Main](uploading-files-vb/samples/sample1.xml)]

<span data-ttu-id="402e8-133">После обновления `Web.sitemap`, занять некоторое время для просмотра учебников веб-сайт с помощью браузера.</span><span class="sxs-lookup"><span data-stu-id="402e8-133">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="402e8-134">В левом меню теперь включает элементы для работы с учебниками двоичных данных.</span><span class="sxs-lookup"><span data-stu-id="402e8-134">The menu on the left now includes items for the Working with Binary Data tutorials.</span></span>


![Карта сайта теперь включает операции для работы с учебниками двоичных данных](uploading-files-vb/_static/image3.gif)

<span data-ttu-id="402e8-136">**Рис. 3**: карта сайта теперь включает операции для работы с учебниками двоичных данных</span><span class="sxs-lookup"><span data-stu-id="402e8-136">**Figure 3**: The Site Map Now Includes Entries for the Working with Binary Data Tutorials</span></span>


## <a name="step-2-deciding-where-to-store-the-binary-data"></a><span data-ttu-id="402e8-137">Шаг 2: Выбор места для хранения двоичных данных</span><span class="sxs-lookup"><span data-stu-id="402e8-137">Step 2: Deciding Where to Store the Binary Data</span></span>

<span data-ttu-id="402e8-138">Двоичные данные, связанные с моделью данных s приложения могут храниться в одном из двух мест: в файловой системе сервера s web со ссылкой на файл, хранящийся в базе данных. или непосредственно в самой базе данных (см. рис. 4).</span><span class="sxs-lookup"><span data-stu-id="402e8-138">Binary data that is associated with the application s data model can be stored in one of two places: on the web server s file system with a reference to the file stored in the database; or directly within the database itself (see Figure 4).</span></span> <span data-ttu-id="402e8-139">Каждый подход имеет свой собственный набор преимуществ и недостатков и допускает более подробное рассмотрение.</span><span class="sxs-lookup"><span data-stu-id="402e8-139">Each approach has its own set of pros and cons and merits a more detailed discussion.</span></span>


<span data-ttu-id="402e8-140">[![Двоичные данные могут храниться в файловой системе или непосредственно в базе данных](uploading-files-vb/_static/image4.gif)](uploading-files-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="402e8-140">[![Binary Data Can Be Stored On the File System or Directly in the Database](uploading-files-vb/_static/image4.gif)](uploading-files-vb/_static/image3.png)</span></span>

<span data-ttu-id="402e8-141">**Рис. 4**: двоичные данные могут храниться в файловой системе или непосредственно в базе данных ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="402e8-141">**Figure 4**: Binary Data Can Be Stored On the File System or Directly in the Database ([Click to view full-size image](uploading-files-vb/_static/image4.png))</span></span>


<span data-ttu-id="402e8-142">Предположим, мы хотим расширить базу данных Northwind для присоединения к ним изображения каждого продукта.</span><span class="sxs-lookup"><span data-stu-id="402e8-142">Imagine that we wanted to extend the Northwind database to associate a picture with each product.</span></span> <span data-ttu-id="402e8-143">Один из вариантов, можно хранить эти файлы изображений в файловой системе сервера s web и запишите путь в `Products` таблицы.</span><span class="sxs-lookup"><span data-stu-id="402e8-143">One option would be to store these image files on the web server s file system and record the path in the `Products` table.</span></span> <span data-ttu-id="402e8-144">При таком подходе d добавим `ImagePath` столбец `Products` таблицы типа `varchar(200)`, возможно.</span><span class="sxs-lookup"><span data-stu-id="402e8-144">With this approach, we d add an `ImagePath` column to the `Products` table of type `varchar(200)`, perhaps.</span></span> <span data-ttu-id="402e8-145">При отправке пользователем рисунка для товара этот рисунок может храниться в файловой системе сервера s web в `~/Images/Tea.jpg`, где `~` представляет s физический путь к приложению.</span><span class="sxs-lookup"><span data-stu-id="402e8-145">When a user uploaded a picture for Chai, that picture might be stored on the web server s file system at `~/Images/Tea.jpg`, where `~` represents the application s physical path.</span></span> <span data-ttu-id="402e8-146">То есть если веб-сайт находится в физический путь к папке `C:\Websites\Northwind\`, `~/Images/Tea.jpg` равнозначно `C:\Websites\Northwind\Images\Tea.jpg`.</span><span class="sxs-lookup"><span data-stu-id="402e8-146">That is, if the web site is rooted at the physical path `C:\Websites\Northwind\`, `~/Images/Tea.jpg` would be equivalent to `C:\Websites\Northwind\Images\Tea.jpg`.</span></span> <span data-ttu-id="402e8-147">После отправки файла изображения, мы d обновить запись Chai в `Products` таблицы, чтобы его `ImagePath` путь нового образа, ссылки на столбец.</span><span class="sxs-lookup"><span data-stu-id="402e8-147">After uploading the image file, we d update the Chai record in the `Products` table so that its `ImagePath` column referenced the path of the new image.</span></span> <span data-ttu-id="402e8-148">Мы могли бы использовать `~/Images/Tea.jpg` или просто `Tea.jpg` Если мы решили, что все изображения продукта будет помещен в приложение s `Images` папки.</span><span class="sxs-lookup"><span data-stu-id="402e8-148">We could use `~/Images/Tea.jpg` or just `Tea.jpg` if we decided that all product images would be placed in the application s `Images` folder.</span></span>

<span data-ttu-id="402e8-149">Ниже перечислены основные преимущества хранения двоичных данных в файловой системе</span><span class="sxs-lookup"><span data-stu-id="402e8-149">The main advantages of storing the binary data on the file system are:</span></span>

- <span data-ttu-id="402e8-150">**Простота реализации** как мы скоро будет убедиться, хранения и извлечения двоичных данных непосредственно в базе данных включает в себя немного больше кода, чем при работе с данными с помощью файловой системы.</span><span class="sxs-lookup"><span data-stu-id="402e8-150">**Ease of implementation** as we'll see shortly, storing and retrieving binary data stored directly within the database involves a bit more code than when working with data through the file system.</span></span> <span data-ttu-id="402e8-151">Кроме того в порядке, пользователь может просмотреть или загрузить двоичных данных они должен быть предоставлен URL-адрес, к этим данным.</span><span class="sxs-lookup"><span data-stu-id="402e8-151">Additionally, in order for a user to view or download binary data they must be presented with a URL to that data.</span></span> <span data-ttu-id="402e8-152">Если данные находятся в файловой системе web server s, нетрудно URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="402e8-152">If the data resides on the web server s file system, the URL is straightforward.</span></span> <span data-ttu-id="402e8-153">Если данные хранятся в базе данных, с веб-страницами необходимо создать, будет извлекать и возвращать данные из базы данных.</span><span class="sxs-lookup"><span data-stu-id="402e8-153">If the data is stored in the database, however, a web page needs to be created that will retrieve and return the data from the database.</span></span>
- <span data-ttu-id="402e8-154">**Широкий доступ к двоичным данным** двоичные данные могут должны быть доступны для других служб или приложений, которые не может извлекать данные из базы данных.</span><span class="sxs-lookup"><span data-stu-id="402e8-154">**Wider access to the binary data** the binary data may need to be accessible to other services or applications, ones that cannot pull the data from the database.</span></span> <span data-ttu-id="402e8-155">Например, изображения, связанные с каждого продукта может также должны быть доступны пользователям через [FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol), в этом случае d необходимо для хранения двоичных данных в файловой системе.</span><span class="sxs-lookup"><span data-stu-id="402e8-155">For example, the images associated with each product might also need to be available to users through [FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol), in which case we d want to store the binary data on the file system.</span></span>
- <span data-ttu-id="402e8-156">**Производительность** если двоичные данные хранятся в файловой системе, перегрузки спроса и сети между сервером базы данных и веб-сервер будет меньше, чем если двоичные данные хранятся непосредственно в базе данных.</span><span class="sxs-lookup"><span data-stu-id="402e8-156">**Performance** if the binary data is stored on the file system, the demand and network congestion between the database server and web server will be less than if the binary data is stored directly within the database.</span></span>

<span data-ttu-id="402e8-157">Главным недостатком хранения двоичных данных в файловой системе, является он разрывает связь из базы данных.</span><span class="sxs-lookup"><span data-stu-id="402e8-157">The main disadvantage of storing binary data on the file system is that it decouples the data from the database.</span></span> <span data-ttu-id="402e8-158">Если запись удалена из `Products` таблицы, связанный файл в файловой системе web server s не удаляется автоматически.</span><span class="sxs-lookup"><span data-stu-id="402e8-158">If a record is deleted from the `Products` table, the associated file on the web server s file system is not automatically deleted.</span></span> <span data-ttu-id="402e8-159">Нам необходимо написать дополнительный код для удаления файла или файловой системы будет стать загроможденными при наличии множества неиспользуемые, потерянных файлов.</span><span class="sxs-lookup"><span data-stu-id="402e8-159">We must write extra code to delete the file or the file system will become cluttered with unused, orphaned files.</span></span> <span data-ttu-id="402e8-160">Кроме того при резервном копировании базы данных, мы должны убедитесь, что делать резервные копии связанных двоичных данных в файловой системе, а также.</span><span class="sxs-lookup"><span data-stu-id="402e8-160">Furthermore, when backing up the database, we must make sure to make backups of the associated binary data on the file system, as well.</span></span> <span data-ttu-id="402e8-161">Перемещение базы данных на другой сайт или сервер создает угрозу с подобными проблемами.</span><span class="sxs-lookup"><span data-stu-id="402e8-161">Moving the database to another site or server poses similar challenges.</span></span>

<span data-ttu-id="402e8-162">Кроме того, двоичные данные могут храниться непосредственно в базе данных Microsoft SQL Server 2005, создав столбец типа `varbinary`.</span><span class="sxs-lookup"><span data-stu-id="402e8-162">Alternatively, binary data can be stored directly in a Microsoft SQL Server 2005 database by creating a column of type `varbinary`.</span></span> <span data-ttu-id="402e8-163">Как и с другими типами данных переменной длины, можно указать Максимальная длина двоичных данных, находящихся в этом столбце.</span><span class="sxs-lookup"><span data-stu-id="402e8-163">Like with other variable length data types, you can specify a maximum length of the binary data that can be held in this column.</span></span> <span data-ttu-id="402e8-164">Например, резервирование не более 5 000 байт использовать `varbinary(5000)`; `varbinary(MAX)` обеспечивает максимальный размер хранилища, около 2 ГБ.</span><span class="sxs-lookup"><span data-stu-id="402e8-164">For example, to reserve at most 5,000 bytes use `varbinary(5000)`; `varbinary(MAX)` allows for the maximum storage size, about 2 GB.</span></span>

<span data-ttu-id="402e8-165">Главным преимуществом хранения двоичных данных непосредственно в базе данных является тесную связь между двоичных данных и запись базы данных.</span><span class="sxs-lookup"><span data-stu-id="402e8-165">The main advantage of storing binary data directly in the database is the tight coupling between the binary data and the database record.</span></span> <span data-ttu-id="402e8-166">Это значительно упрощает задачи администрирования базы данных, таких как резервное копирование или перемещение базы данных на другой узел или сервер.</span><span class="sxs-lookup"><span data-stu-id="402e8-166">This greatly simplifies database administration tasks, like backups or moving the database to a different site or server.</span></span> <span data-ttu-id="402e8-167">Кроме того запись автоматически при удалении соответствующих двоичных данных.</span><span class="sxs-lookup"><span data-stu-id="402e8-167">Also, deleting a record automatically deletes the corresponding binary data.</span></span> <span data-ttu-id="402e8-168">Существуют также дополнительные небольшие преимущества хранения двоичных данных в базе данных.</span><span class="sxs-lookup"><span data-stu-id="402e8-168">There are also more subtle benefits of storing the binary data in the database.</span></span> <span data-ttu-id="402e8-169">В разделе [хранения двоичные файлы непосредственно в базе данных с помощью ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx) для более подробного рассмотрения.</span><span class="sxs-lookup"><span data-stu-id="402e8-169">See [Storing Binary Files Directly in the Database Using ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx) for a more in-depth discussion.</span></span>

> [!NOTE]
> <span data-ttu-id="402e8-170">В Microsoft SQL Server 2000 и более ранних версиях `varbinary` тип данных имели максимальное ограничение в 8 000 байт.</span><span class="sxs-lookup"><span data-stu-id="402e8-170">In Microsoft SQL Server 2000 and earlier versions, the `varbinary` data type had a maximum limit of 8,000 bytes.</span></span> <span data-ttu-id="402e8-171">Для хранения двоичных данных до 2 ГБ [ `image` тип данных](https://msdn.microsoft.com/library/ms187993.aspx) необходимо использовать вместо него.</span><span class="sxs-lookup"><span data-stu-id="402e8-171">To store up to 2 GB of binary data the [`image` data type](https://msdn.microsoft.com/library/ms187993.aspx) needs to be used instead.</span></span> <span data-ttu-id="402e8-172">С добавлением `MAX` в SQL Server 2005, однако `image` тип данных рекомендуется к использованию.</span><span class="sxs-lookup"><span data-stu-id="402e8-172">With the addition of `MAX` in SQL Server 2005, however, the `image` data type has been deprecated.</span></span> <span data-ttu-id="402e8-173">Он s по-прежнему поддерживается для обеспечения обратной совместимости, но корпорация Майкрософт объявила, `image` тип данных будет исключена в будущей версии SQL Server.</span><span class="sxs-lookup"><span data-stu-id="402e8-173">It s still supported for backwards compatibility, but Microsoft has announced that the `image` data type will be removed in a future version of SQL Server.</span></span>


<span data-ttu-id="402e8-174">Если вы работаете с более старая модель данных может появиться `image` тип данных.</span><span class="sxs-lookup"><span data-stu-id="402e8-174">If you are working with an older data model you may see the `image` data type.</span></span> <span data-ttu-id="402e8-175">База данных "Борей" s `Categories` таблица имеет `Picture` столбец, который может использоваться для хранения двоичных данных файла изображения для категории.</span><span class="sxs-lookup"><span data-stu-id="402e8-175">The Northwind database s `Categories` table has a `Picture` column that can be used to store the binary data of an image file for the category.</span></span> <span data-ttu-id="402e8-176">Поскольку в базе данных Northwind корнями в Microsoft Access и более ранних версиях SQL Server, этот столбец имеет тип `image`.</span><span class="sxs-lookup"><span data-stu-id="402e8-176">Since the Northwind database has its roots in Microsoft Access and earlier versions of SQL Server, this column is of type `image`.</span></span>

<span data-ttu-id="402e8-177">Для этого учебника и трех последующих мы будем использовать оба подхода.</span><span class="sxs-lookup"><span data-stu-id="402e8-177">For this tutorial and the next three, we'll use both approaches.</span></span> <span data-ttu-id="402e8-178">`Categories` Таблице уже есть `Picture` столбца для хранения двоичного содержимого изображения для категории.</span><span class="sxs-lookup"><span data-stu-id="402e8-178">The `Categories` table already has a `Picture` column for storing the binary content of an image for the category.</span></span> <span data-ttu-id="402e8-179">Мы добавим дополнительный столбец, `BrochurePath`для сохранения пути в PDF-файл в файловой системе сервера s web, можно использовать для предоставления качество печати, профессиональный Обзор категории.</span><span class="sxs-lookup"><span data-stu-id="402e8-179">We'll add an additional column, `BrochurePath`, to store a path to a PDF on the web server s file system that can be used to provide a print-quality, polished overview of the category.</span></span>

## <a name="step-3-adding-thebrochurepathcolumn-to-thecategoriestable"></a><span data-ttu-id="402e8-180">Шаг 3: Добавление`BrochurePath`столбец`Categories`таблицы</span><span class="sxs-lookup"><span data-stu-id="402e8-180">Step 3: Adding the`BrochurePath`Column to the`Categories`Table</span></span>

<span data-ttu-id="402e8-181">В данный момент Таблица типов имеет только четыре столбца: `CategoryID`, `CategoryName`, `Description`, и `Picture`.</span><span class="sxs-lookup"><span data-stu-id="402e8-181">Currently the Categories table has only four columns: `CategoryID`, `CategoryName`, `Description`, and `Picture`.</span></span> <span data-ttu-id="402e8-182">Помимо этих полей необходимо добавить новый, который будет указывать брошюр категории s (если он существует).</span><span class="sxs-lookup"><span data-stu-id="402e8-182">In addition to these fields, we need to add a new one that will point to the category s brochure (if one exists).</span></span> <span data-ttu-id="402e8-183">Чтобы добавить этот столбец, перейдите в обозреватель сервера детализации таблицы, щелкните правой кнопкой мыши `Categories` таблицы и нажмите кнопку Открыть определение таблицы (см. рис. 5).</span><span class="sxs-lookup"><span data-stu-id="402e8-183">To add this column, go to the Server Explorer, drill down into the Tables, right-click on the `Categories` table and choose Open Table Definition (see Figure 5).</span></span> <span data-ttu-id="402e8-184">Если вы не видите обозревателя серверов, открыть, выбрав параметр обозревателя серверов из меню «Вид» или нажмите сочетание клавиш Ctrl + Alt + S.</span><span class="sxs-lookup"><span data-stu-id="402e8-184">If you do not see the Server Explorer, bring it up by selecting the Server Explorer option from the View menu, or hit Ctrl+Alt+S.</span></span>

<span data-ttu-id="402e8-185">Добавьте новый `varchar(200)` столбец `Categories` таблицу с именем `BrochurePath` и позволяет `NULL` s и щелкните значок сохранения (или нажмите сочетание клавиш Ctrl + S).</span><span class="sxs-lookup"><span data-stu-id="402e8-185">Add a new `varchar(200)` column to the `Categories` table that is named `BrochurePath` and allows `NULL` s and click the Save icon (or hit Ctrl+S).</span></span>


<span data-ttu-id="402e8-186">[![Добавить столбец BrochurePath в таблицу Categories](uploading-files-vb/_static/image5.gif)](uploading-files-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="402e8-186">[![Add a BrochurePath Column to the Categories Table](uploading-files-vb/_static/image5.gif)](uploading-files-vb/_static/image5.png)</span></span>

<span data-ttu-id="402e8-187">**Рис. 5**: добавление `BrochurePath` столбец `Categories` таблицы ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="402e8-187">**Figure 5**: Add a `BrochurePath` Column to the `Categories` Table ([Click to view full-size image](uploading-files-vb/_static/image6.png))</span></span>


## <a name="step-4-updating-the-architecture-to-use-thepictureandbrochurepathcolumns"></a><span data-ttu-id="402e8-188">Шаг 4: Обновление архитектура для использования`Picture`и`BrochurePath`столбцов</span><span class="sxs-lookup"><span data-stu-id="402e8-188">Step 4: Updating the Architecture to Use the`Picture`and`BrochurePath`Columns</span></span>

<span data-ttu-id="402e8-189">`CategoriesDataTable` Слой доступа к данным (DAL) в настоящее время имеет четыре `DataColumn` определенных: `CategoryID`, `CategoryName`, `Description`, и `NumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="402e8-189">The `CategoriesDataTable` in the Data Access Layer (DAL) currently has four `DataColumn` s defined: `CategoryID`, `CategoryName`, `Description`, and `NumberOfProducts`.</span></span> <span data-ttu-id="402e8-190">Когда мы первоначально разработано этому DataTable в [Создание слой доступа к данным](../introduction/creating-a-data-access-layer-vb.md) учебнике `CategoriesDataTable` ставилась первых трех столбцах; `NumberOfProducts` столбец был добавлен в [главного и подчиненного представлений с помощью маркированный Список записей Master с помощью DataList сведения](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md) учебника.</span><span class="sxs-lookup"><span data-stu-id="402e8-190">When we originally designed this DataTable in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, the `CategoriesDataTable` only had the first three columns; the `NumberOfProducts` column was added in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md) tutorial.</span></span>

<span data-ttu-id="402e8-191">Как было сказано в *Создание слой доступа к данным*, DataTables типизированного набора данных составляют бизнес-объектов.</span><span class="sxs-lookup"><span data-stu-id="402e8-191">As discussed in *Creating a Data Access Layer*, the DataTables in the Typed DataSet make up the business objects.</span></span> <span data-ttu-id="402e8-192">Адаптеры таблиц отвечают за взаимодействие с базой данных и заполнения бизнес-объектов с результатами запроса.</span><span class="sxs-lookup"><span data-stu-id="402e8-192">The TableAdapters are responsible for communicating with the database and populating the business objects with the query results.</span></span> <span data-ttu-id="402e8-193">`CategoriesDataTable` Заполняется `CategoriesTableAdapter`, который имеет три метода извлечения данных:</span><span class="sxs-lookup"><span data-stu-id="402e8-193">The `CategoriesDataTable` is populated by the `CategoriesTableAdapter`, which has three data retrieval methods:</span></span>

- <span data-ttu-id="402e8-194">`GetCategories()` выполняет s основного запроса адаптера таблицы и возвращает `CategoryID`, `CategoryName`, и `Description` поля всех записей в `Categories` таблицы.</span><span class="sxs-lookup"><span data-stu-id="402e8-194">`GetCategories()` executes the TableAdapter s main query and returns the `CategoryID`, `CategoryName`, and `Description` fields of all records in the `Categories` table.</span></span> <span data-ttu-id="402e8-195">Основной запрос используется, автоматически сгенерированный `Insert` и `Update` методы.</span><span class="sxs-lookup"><span data-stu-id="402e8-195">The main query is what is used by the auto-generated `Insert` and `Update` methods.</span></span>
- <span data-ttu-id="402e8-196">`GetCategoryByCategoryID(categoryID)` Возвращает `CategoryID`, `CategoryName`, и `Description` поля категории которого `CategoryID` равняется *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="402e8-196">`GetCategoryByCategoryID(categoryID)` returns the `CategoryID`, `CategoryName`, and `Description` fields of the category whose `CategoryID` equals *categoryID*.</span></span>
- <span data-ttu-id="402e8-197">`GetCategoriesAndNumberOfProducts()` — Возвращает `CategoryID`, `CategoryName`, и `Description` поля для всех записей в `Categories` таблицы.</span><span class="sxs-lookup"><span data-stu-id="402e8-197">`GetCategoriesAndNumberOfProducts()` - returns the `CategoryID`, `CategoryName`, and `Description` fields for all records in the `Categories` table.</span></span> <span data-ttu-id="402e8-198">Также использует вложенный запрос для возврата количества продуктов, связанных с каждой категории.</span><span class="sxs-lookup"><span data-stu-id="402e8-198">Also uses a subquery to return the number of products associated with each category.</span></span>

<span data-ttu-id="402e8-199">Обратите внимание, что ни один из них возвращаемых запросами `Categories` таблицу s `Picture` или `BrochurePath` столбцы; также не `CategoriesDataTable` предоставляют `DataColumn` s для этих полей.</span><span class="sxs-lookup"><span data-stu-id="402e8-199">Notice that none of these queries return the `Categories` table s `Picture` or `BrochurePath` columns; nor does the `CategoriesDataTable` provide `DataColumn` s for these fields.</span></span> <span data-ttu-id="402e8-200">Для работы с изображением и `BrochurePath` свойства, необходимо предварительно добавить их в `CategoriesDataTable` и обновите `CategoriesTableAdapter` класса, чтобы вернуть эти столбцы.</span><span class="sxs-lookup"><span data-stu-id="402e8-200">In order to work with the Picture and `BrochurePath` properties, we need to first add them to the `CategoriesDataTable` and then update the `CategoriesTableAdapter` class to return these columns.</span></span>

## <a name="adding-thepictureandbrochurepathdatacolumn-s"></a><span data-ttu-id="402e8-201">Добавление`Picture`и`BrochurePath``DataColumn` s</span><span class="sxs-lookup"><span data-stu-id="402e8-201">Adding the`Picture`and`BrochurePath``DataColumn` s</span></span>

<span data-ttu-id="402e8-202">Начните с добавления этих двух столбцов, чтобы `CategoriesDataTable`.</span><span class="sxs-lookup"><span data-stu-id="402e8-202">Start by adding these two columns to the `CategoriesDataTable`.</span></span> <span data-ttu-id="402e8-203">Щелкните правой кнопкой мыши `CategoriesDataTable` заголовок s, выберите пункт "Добавить" в контекстном меню, а затем выберите вариант столбца.</span><span class="sxs-lookup"><span data-stu-id="402e8-203">Right-click on the `CategoriesDataTable` s header, select Add from the context menu and then choose the Column option.</span></span> <span data-ttu-id="402e8-204">Это создаст новый `DataColumn` в DataTable с именем `Column1`.</span><span class="sxs-lookup"><span data-stu-id="402e8-204">This will create a new `DataColumn` in the DataTable named `Column1`.</span></span> <span data-ttu-id="402e8-205">Переименовать этот столбец в `Picture`.</span><span class="sxs-lookup"><span data-stu-id="402e8-205">Rename this column to `Picture`.</span></span> <span data-ttu-id="402e8-206">В окне «Свойства» задайте `DataColumn` s `DataType` свойства `System.Byte[]` (это не параметр в раскрывающемся списке, вам нужно ввести его в).</span><span class="sxs-lookup"><span data-stu-id="402e8-206">From the Properties window, set the `DataColumn` s `DataType` property to `System.Byte[]` (this is not an option in the drop-down list; you need to type it in).</span></span>


<span data-ttu-id="402e8-207">[![Создание изображений DataColumn с именем, типом данных является System.Byte]](uploading-files-vb/_static/image6.gif)](uploading-files-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="402e8-207">[![Create a DataColumn Named Picture whose DataType is System.Byte[]](uploading-files-vb/_static/image6.gif)](uploading-files-vb/_static/image7.png)</span></span>

<span data-ttu-id="402e8-208">**Рис. 6**: создание `DataColumn` именованных `Picture` которого `DataType` — `System.Byte[]` ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="402e8-208">**Figure 6**: Create a `DataColumn` Named `Picture` whose `DataType` is `System.Byte[]` ([Click to view full-size image](uploading-files-vb/_static/image8.png))</span></span>


<span data-ttu-id="402e8-209">Добавьте еще один `DataColumn` в таблицу DataTable, присвоив ему имя `BrochurePath` с помощью стандартных `DataType` значение (`System.String`).</span><span class="sxs-lookup"><span data-stu-id="402e8-209">Add another `DataColumn` to the DataTable, naming it `BrochurePath` using the default `DataType` value (`System.String`).</span></span>

## <a name="returning-thepictureandbrochurepathvalues-from-the-tableadapter"></a><span data-ttu-id="402e8-210">Возвращение`Picture`и`BrochurePath`значения из адаптера таблицы</span><span class="sxs-lookup"><span data-stu-id="402e8-210">Returning the`Picture`and`BrochurePath`Values from the TableAdapter</span></span>

<span data-ttu-id="402e8-211">С помощью этих двух `DataColumn` , добавленные `CategoriesDataTable`, мы готов для обновления `CategoriesTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="402e8-211">With these two `DataColumn` s added to the `CategoriesDataTable`, we re ready to update the `CategoriesTableAdapter`.</span></span> <span data-ttu-id="402e8-212">Это может быть оба этих значения столбцов возвращаются в основной запрос адаптера таблицы, но в результате выполнения обратно двоичные данные при каждом `GetCategories()` был вызван метод.</span><span class="sxs-lookup"><span data-stu-id="402e8-212">We could have both of these column values returned in the main TableAdapter query, but this would bring back the binary data every time the `GetCategories()` method was invoked.</span></span> <span data-ttu-id="402e8-213">Вместо этого s позволяют обновить основной запрос адаптера таблицы для возврата `BrochurePath` и создайте метод получения дополнительных данных, который возвращает определенной категории s `Picture` столбца.</span><span class="sxs-lookup"><span data-stu-id="402e8-213">Instead, let s update the main TableAdapter query to bring back `BrochurePath` and create an additional data retrieval method that returns a particular category s `Picture` column.</span></span>

<span data-ttu-id="402e8-214">Чтобы обновить основной запрос адаптера таблицы, щелкните правой кнопкой мыши `CategoriesTableAdapter` s заголовка и выберите в контекстном меню Настройка.</span><span class="sxs-lookup"><span data-stu-id="402e8-214">To update the main TableAdapter query, right-click on the `CategoriesTableAdapter` s header and choose the Configure option from the context menu.</span></span> <span data-ttu-id="402e8-215">Откроется окно мастера настройки адаптера таблицы, которые мы хранить в число последних учебники.</span><span class="sxs-lookup"><span data-stu-id="402e8-215">This brings up the Table Adapter Configuration Wizard, which we ve seen in a number of past tutorials.</span></span> <span data-ttu-id="402e8-216">Обновить запрос для возврата `BrochurePath` и нажмите кнопку Готово.</span><span class="sxs-lookup"><span data-stu-id="402e8-216">Update the query to bring back the `BrochurePath` and click Finish.</span></span>


<span data-ttu-id="402e8-217">[![Обновление списка столбцов в инструкции SELECT, также возвратит BrochurePath](uploading-files-vb/_static/image7.gif)](uploading-files-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="402e8-217">[![Update the Column List in the SELECT Statement to Also Return BrochurePath](uploading-files-vb/_static/image7.gif)](uploading-files-vb/_static/image9.png)</span></span>

<span data-ttu-id="402e8-218">**Рис. 7**: обновление списка столбцов в `SELECT` инструкция также вернет `BrochurePath` ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="402e8-218">**Figure 7**: Update the Column List in the `SELECT` Statement to Also Return `BrochurePath` ([Click to view full-size image](uploading-files-vb/_static/image10.png))</span></span>


<span data-ttu-id="402e8-219">При использовании нерегламентированных инструкций SQL для адаптера таблицы, список столбцов в основном запросе обновление обновляет список столбцов для всех `SELECT` методы в TableAdapter запроса.</span><span class="sxs-lookup"><span data-stu-id="402e8-219">When using ad-hoc SQL statements for the TableAdapter, updating the column list in the main query updates the column list for all of the `SELECT` query methods in the TableAdapter.</span></span> <span data-ttu-id="402e8-220">Это означает `GetCategoryByCategoryID(categoryID)` метода теперь возвращают `BrochurePath` столбец, который может быть было предусмотрено.</span><span class="sxs-lookup"><span data-stu-id="402e8-220">That means the `GetCategoryByCategoryID(categoryID)` method has been updated to return the `BrochurePath` column, which might be what we intended.</span></span> <span data-ttu-id="402e8-221">Однако он также обновляется список столбцов в `GetCategoriesAndNumberOfProducts()` метода, удалить вложенный запрос, возвращающий число продуктов в каждой категории.</span><span class="sxs-lookup"><span data-stu-id="402e8-221">However, it also updated the column list in the `GetCategoriesAndNumberOfProducts()` method, removing the subquery that returns the number of products for each category!</span></span> <span data-ttu-id="402e8-222">Таким образом, необходимо обновить этот метод s `SELECT` запроса.</span><span class="sxs-lookup"><span data-stu-id="402e8-222">Therefore, we need to update this method s `SELECT` query.</span></span> <span data-ttu-id="402e8-223">Щелкните правой кнопкой мыши `GetCategoriesAndNumberOfProducts()` выберите Настройка метода и верните `SELECT` запрос обратно в исходное значение:</span><span class="sxs-lookup"><span data-stu-id="402e8-223">Right-click on the `GetCategoriesAndNumberOfProducts()` method, choose Configure, and revert the `SELECT` query back to its original value:</span></span>


[!code-sql[Main](uploading-files-vb/samples/sample2.sql)]

<span data-ttu-id="402e8-224">Создайте новый метод адаптера таблицы, который возвращает определенной категории s `Picture` значение столбца.</span><span class="sxs-lookup"><span data-stu-id="402e8-224">Next, create a new TableAdapter method that returns a particular category s `Picture` column value.</span></span> <span data-ttu-id="402e8-225">Щелкните правой кнопкой мыши `CategoriesTableAdapter` s заголовка и выберите пункт Добавить запрос, чтобы запустить мастер настройки запроса адаптера таблицы.</span><span class="sxs-lookup"><span data-stu-id="402e8-225">Right-click on the `CategoriesTableAdapter` s header and choose the Add Query option to launch the TableAdapter Query Configuration Wizard.</span></span> <span data-ttu-id="402e8-226">На первом шаге работы этот мастер запрашивает Если мы хотим для запроса данных с помощью инструкции SQL ad-hoc, новая хранимая процедура, уже существующий.</span><span class="sxs-lookup"><span data-stu-id="402e8-226">The first step of this wizard asks us if we want to query data using an ad-hoc SQL statement, a new stored procedure, or an existing one.</span></span> <span data-ttu-id="402e8-227">Выберите использовать инструкции SQL и нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="402e8-227">Select Use SQL statements and click Next.</span></span> <span data-ttu-id="402e8-228">Поскольку мы будет возвращать строку, выберите SELECT, возвращающая параметр строки из второй шаг.</span><span class="sxs-lookup"><span data-stu-id="402e8-228">Since we will be returning a row, choose the SELECT which returns rows option from the second step.</span></span>


<span data-ttu-id="402e8-229">[![Выберите параметр использовать SQL-инструкции](uploading-files-vb/_static/image8.gif)](uploading-files-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="402e8-229">[![Select the Use SQL statements Option](uploading-files-vb/_static/image8.gif)](uploading-files-vb/_static/image11.png)</span></span>

<span data-ttu-id="402e8-230">**Рис. 8**: выберите инструкции SQL используйте параметр ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="402e8-230">**Figure 8**: Select the Use SQL statements Option ([Click to view full-size image](uploading-files-vb/_static/image12.png))</span></span>


<span data-ttu-id="402e8-231">[![Так как запрос будет возвращать записи из таблицы Categories, выбор SELECT, возвращающая строки](uploading-files-vb/_static/image9.gif)](uploading-files-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="402e8-231">[![Since the Query Will Return a Record from the Categories Table, Choose SELECT which returns rows](uploading-files-vb/_static/image9.gif)](uploading-files-vb/_static/image13.png)</span></span>

<span data-ttu-id="402e8-232">**Рис. 9**: так как запрос будет возвращать записи из таблицы Categories, нажмите кнопку Выбрать, какие возвращает строки ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="402e8-232">**Figure 9**: Since the Query Will Return a Record from the Categories Table, Choose SELECT which returns rows ([Click to view full-size image](uploading-files-vb/_static/image14.png))</span></span>


<span data-ttu-id="402e8-233">На третьем шаге введите следующий SQL-запрос и нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="402e8-233">In the third step, enter the following SQL query and click Next:</span></span>


[!code-sql[Main](uploading-files-vb/samples/sample3.sql)]

<span data-ttu-id="402e8-234">Последним шагом является выбор имя для нового метода.</span><span class="sxs-lookup"><span data-stu-id="402e8-234">The last step is to choose the name for the new method.</span></span> <span data-ttu-id="402e8-235">Используйте `FillCategoryWithBinaryDataByCategoryID` и `GetCategoryWithBinaryDataByCategoryID` для заполнения таблицы данных и Возврат DataTable, шаблоны, соответственно.</span><span class="sxs-lookup"><span data-stu-id="402e8-235">Use `FillCategoryWithBinaryDataByCategoryID` and `GetCategoryWithBinaryDataByCategoryID` for the Fill a DataTable and Return a DataTable patterns, respectively.</span></span> <span data-ttu-id="402e8-236">Нажмите кнопку Готово, чтобы завершить работу мастера.</span><span class="sxs-lookup"><span data-stu-id="402e8-236">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="402e8-237">[![Выберите имена для s методы адаптера таблицы](uploading-files-vb/_static/image10.gif)](uploading-files-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="402e8-237">[![Choose the Names for the TableAdapter s Methods](uploading-files-vb/_static/image10.gif)](uploading-files-vb/_static/image15.png)</span></span>

<span data-ttu-id="402e8-238">**Рис. 10**: выберите имена для s адаптера таблицы методы ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="402e8-238">**Figure 10**: Choose the Names for the TableAdapter s Methods ([Click to view full-size image](uploading-files-vb/_static/image16.png))</span></span>


> [!NOTE]
> <span data-ttu-id="402e8-239">После завершения работы мастера настройки запроса адаптера таблицы может появиться диалоговое окно, информирующее о том, что новый текст команды возвращает данные со схемой отличается от схемы основного запроса.</span><span class="sxs-lookup"><span data-stu-id="402e8-239">After completing the Table Adapter Query Configuration Wizard you may see a dialog box informing you that the new command text returns data with schema different from the schema of the main query.</span></span> <span data-ttu-id="402e8-240">Иными словами, мастер отметить, что основной запрос адаптера таблицы s `GetCategories()` возвращает другую схему от того, мы только что создали.</span><span class="sxs-lookup"><span data-stu-id="402e8-240">In short, the wizard is noting that the TableAdapter s main query `GetCategories()` returns a different schema than the one we just created.</span></span> <span data-ttu-id="402e8-241">Но мы хотим, чтобы это сообщение можно пропустить.</span><span class="sxs-lookup"><span data-stu-id="402e8-241">But this is what we want, so you can disregard this message.</span></span>


<span data-ttu-id="402e8-242">Кроме того, имейте в виду, что если вы используете специализированные инструкции SQL и использовать мастер для изменения основного запроса адаптера таблицы s в более поздний момент времени, он изменит `GetCategoryWithBinaryDataByCategoryID` метод s `SELECT` инструкцию s список столбцов, чтобы включить только те столбцы из основной запрос (то есть он удалит `Picture` столбца из запроса).</span><span class="sxs-lookup"><span data-stu-id="402e8-242">Also, keep in mind that if you are using ad-hoc SQL statements and use the wizard to change the TableAdapter s main query at some later point in time, it will modify the `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement s column list to include just those columns from the main query (that is, it will remove the `Picture` column from the query).</span></span> <span data-ttu-id="402e8-243">Необходимо будет вручную обновить список столбцов, чтобы вернуть `Picture` столбцов, как и на то, что мы сделали с `GetCategoriesAndNumberOfProducts()` метод ранее на этом шаге.</span><span class="sxs-lookup"><span data-stu-id="402e8-243">You will have to manually update the column list to return the `Picture` column, similar to what we did with the `GetCategoriesAndNumberOfProducts()` method earlier in this step.</span></span>

<span data-ttu-id="402e8-244">После добавления двух `DataColumn` s, чтобы `CategoriesDataTable` и `GetCategoryWithBinaryDataByCategoryID` метод `CategoriesTableAdapter`, эти классы в конструкторе типизированного набора данных должна выглядеть на снимке экрана на рис. 11.</span><span class="sxs-lookup"><span data-stu-id="402e8-244">After adding the two `DataColumn` s to the `CategoriesDataTable` and the `GetCategoryWithBinaryDataByCategoryID` method to the `CategoriesTableAdapter`, these classes in the Typed DataSet Designer should look like the screenshot in Figure 11.</span></span>


![Конструктор наборов данных включает в себя новые столбцы и метод](uploading-files-vb/_static/image11.gif)

<span data-ttu-id="402e8-246">**Рис. 11**: конструктор набора данных включает в себя новые столбцы и метод</span><span class="sxs-lookup"><span data-stu-id="402e8-246">**Figure 11**: The DataSet Designer Includes the New Columns and Method</span></span>


## <a name="updating-the-business-logic-layer-bll"></a><span data-ttu-id="402e8-247">Обновление уровня бизнес-логики (уровень бизнес-ЛОГИКИ)</span><span class="sxs-lookup"><span data-stu-id="402e8-247">Updating the Business Logic Layer (BLL)</span></span>

<span data-ttu-id="402e8-248">Обновить DAL, все, что остается только для дополнения для него метод для нового слоя бизнес-логики (BLL) `CategoriesTableAdapter` метод.</span><span class="sxs-lookup"><span data-stu-id="402e8-248">With the DAL updated, all that remains is to augment the Business Logic Layer (BLL) to include a method for the new `CategoriesTableAdapter` method.</span></span> <span data-ttu-id="402e8-249">Добавьте следующий метод `CategoriesBLL` класса:</span><span class="sxs-lookup"><span data-stu-id="402e8-249">Add the following method to the `CategoriesBLL` class:</span></span>


[!code-vb[Main](uploading-files-vb/samples/sample4.vb)]

## <a name="step-5-uploading-a-file-from-the-client-to-the-web-server"></a><span data-ttu-id="402e8-250">Шаг 5: Загрузка файла от клиента к веб-серверу</span><span class="sxs-lookup"><span data-stu-id="402e8-250">Step 5: Uploading a File From the Client to the Web Server</span></span>

<span data-ttu-id="402e8-251">При сборе двоичных данных, зачастую это данные предоставляются конечным пользователем.</span><span class="sxs-lookup"><span data-stu-id="402e8-251">When collecting binary data, oftentimes this data is supplied by an end user.</span></span> <span data-ttu-id="402e8-252">Для сбора этой информации, пользователь должен иметь возможность загрузить файл со своего компьютера на веб-сервер.</span><span class="sxs-lookup"><span data-stu-id="402e8-252">To capture this information, the user needs to be able to upload a file from their computer to the web server.</span></span> <span data-ttu-id="402e8-253">Загруженные данные необходимо интегрировать с моделью данных, которая может означать сохранения файла в web server s файловой системы и добавление путь к файлу базы данных или записи содержимого двоичных непосредственно в базу данных.</span><span class="sxs-lookup"><span data-stu-id="402e8-253">The uploaded data then needs to be integrated with the data model, which may mean saving the file to the web server s file system and adding a path to the file in the database, or writing the binary contents directly into the database.</span></span> <span data-ttu-id="402e8-254">На этом шаге мы рассмотрим как разрешить пользователю загружать файлы со своего компьютера на сервер.</span><span class="sxs-lookup"><span data-stu-id="402e8-254">In this step we'll look at how to allow a user to upload files from their computer to the server.</span></span> <span data-ttu-id="402e8-255">В следующем уроке мы будем можем обратиться к интеграции загруженный файл с моделью данных.</span><span class="sxs-lookup"><span data-stu-id="402e8-255">In the next tutorial we'll turn our attention to integrating the uploaded file with data model.</span></span>

<span data-ttu-id="402e8-256">ASP.NET 2.0 новые [FileUpload веб-элемент управления](https://msdn.microsoft.com/library/ms227677(VS.80).aspx) предоставляет механизм для пользователей отправить файл со своего компьютера на веб-сервер.</span><span class="sxs-lookup"><span data-stu-id="402e8-256">ASP.NET 2.0 s new [FileUpload Web control](https://msdn.microsoft.com/library/ms227677(VS.80).aspx) provides a mechanism for users to send a file from their computer to the web server.</span></span> <span data-ttu-id="402e8-257">Элемент управления FileUpload готовится к просмотру как `<input>` элемент которого `type` атрибута задано значение файл, который будет отображаться в браузерах как текстовое поле с кнопкой "Обзор".</span><span class="sxs-lookup"><span data-stu-id="402e8-257">The FileUpload control renders as an `<input>` element whose `type` attribute is set to file, which browsers display as a textbox with a Browse button.</span></span> <span data-ttu-id="402e8-258">Нажав кнопку обзора появится диалоговое окно, из которого пользователь может выбрать файл.</span><span class="sxs-lookup"><span data-stu-id="402e8-258">Clicking the Browse button brings up a dialog box from which the user can select a file.</span></span> <span data-ttu-id="402e8-259">Когда форма передается назад, s содержимое выбранного файла отправляется вместе с обратной передачи.</span><span class="sxs-lookup"><span data-stu-id="402e8-259">When the form is posted back, the selected file s contents are sent along with the postback.</span></span> <span data-ttu-id="402e8-260">На стороне сервера сведения о загруженный файл доступен с помощью свойства s FileUpload элемента управления.</span><span class="sxs-lookup"><span data-stu-id="402e8-260">On the server-side, information about the uploaded file is accessible through the FileUpload control s properties.</span></span>

<span data-ttu-id="402e8-261">Чтобы продемонстрировать Отправка файлов, откройте `FileUpload.aspx` страницы в `BinaryData` , перетащите элемент управления FileUpload из области элементов в конструктор, а задать элемент управления s `ID` свойства `UploadTest`.</span><span class="sxs-lookup"><span data-stu-id="402e8-261">To demonstrate uploading files, open the `FileUpload.aspx` page in the `BinaryData` folder, drag a FileUpload control from the Toolbox onto the Designer, and set the control s `ID` property to `UploadTest`.</span></span> <span data-ttu-id="402e8-262">Добавьте кнопку веб-элемент управления параметр его `ID` и `Text` свойства `UploadButton` и отправить файл выбранные, соответственно.</span><span class="sxs-lookup"><span data-stu-id="402e8-262">Next, add a Button Web control setting its `ID` and `Text` properties to `UploadButton` and Upload Selected File, respectively.</span></span> <span data-ttu-id="402e8-263">Наконец, разместить веб-управления Label под кнопкой, очистить его `Text` и установите его `ID` свойства `UploadDetails`.</span><span class="sxs-lookup"><span data-stu-id="402e8-263">Finally, place a Label Web control beneath the Button, clear out its `Text` property and set its `ID` property to `UploadDetails`.</span></span>


<span data-ttu-id="402e8-264">[![Добавление элемента управления FileUpload страницы ASP.NET](uploading-files-vb/_static/image12.gif)](uploading-files-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="402e8-264">[![Add a FileUpload Control to the ASP.NET Page](uploading-files-vb/_static/image12.gif)](uploading-files-vb/_static/image17.png)</span></span>

<span data-ttu-id="402e8-265">**Рис. 12**: Добавление элемента управления FileUpload страницы ASP.NET ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="402e8-265">**Figure 12**: Add a FileUpload Control to the ASP.NET Page ([Click to view full-size image](uploading-files-vb/_static/image18.png))</span></span>


<span data-ttu-id="402e8-266">На рисунке 13 показано эту страницу при просмотре через браузер.</span><span class="sxs-lookup"><span data-stu-id="402e8-266">Figure 13 shows this page when viewed through a browser.</span></span> <span data-ttu-id="402e8-267">Обратите внимание, что нажатие кнопки обзора появится диалоговое окно выбора файла, позволяя пользователю выбрать файл со своих компьютеров.</span><span class="sxs-lookup"><span data-stu-id="402e8-267">Note that clicking the Browse button brings up a file selection dialog box, allowing the user to pick a file from their computer.</span></span> <span data-ttu-id="402e8-268">После выбора файла, нажмите кнопку Отправить выбранный файл вызывает обратную передачу, отправляет двоичное содержимое выбранного файла s веб-сервер.</span><span class="sxs-lookup"><span data-stu-id="402e8-268">Once a file has been selected, clicking the Upload Selected File button causes a postback that sends the selected file s binary content to the web server.</span></span>


<span data-ttu-id="402e8-269">[![Пользователь может выбрать файл для передачи со своего компьютера на сервер](uploading-files-vb/_static/image13.gif)](uploading-files-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="402e8-269">[![The User Can Select a File to Upload from their Computer to the Server](uploading-files-vb/_static/image13.gif)](uploading-files-vb/_static/image19.png)</span></span>

<span data-ttu-id="402e8-270">**Рис. 13**: пользователь может выбрать файл для передачи со своего компьютера на сервер ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="402e8-270">**Figure 13**: The User Can Select a File to Upload from their Computer to the Server ([Click to view full-size image](uploading-files-vb/_static/image20.png))</span></span>


<span data-ttu-id="402e8-271">При обратной передаче можно сохранить загруженный файл в файловой системе или двоичные данные можно работать напрямую с помощью потока.</span><span class="sxs-lookup"><span data-stu-id="402e8-271">On postback, the uploaded file can be saved to the file system or its binary data can be worked with directly through a Stream.</span></span> <span data-ttu-id="402e8-272">В этом примере позволяют создать s `~/Brochures` папку и сохранить отправленный файл существует.</span><span class="sxs-lookup"><span data-stu-id="402e8-272">For this example, let s create a `~/Brochures` folder and save the uploaded file there.</span></span> <span data-ttu-id="402e8-273">Начните с добавления `Brochures` папки на сайт как вложенную папку корневого каталога.</span><span class="sxs-lookup"><span data-stu-id="402e8-273">Start by adding the `Brochures` folder to the site as a subfolder of the root directory.</span></span> <span data-ttu-id="402e8-274">Создайте обработчик событий для `UploadButton` s `Click` событий и добавьте следующий код:</span><span class="sxs-lookup"><span data-stu-id="402e8-274">Next, create an event handler for the `UploadButton` s `Click` event and add the following code:</span></span>


[!code-vb[Main](uploading-files-vb/samples/sample5.vb)]

<span data-ttu-id="402e8-275">Элемент управления FileUpload предоставляет широкий набор свойств для работы с загруженные данные.</span><span class="sxs-lookup"><span data-stu-id="402e8-275">The FileUpload control provides a variety of properties for working with the uploaded data.</span></span> <span data-ttu-id="402e8-276">Для экземпляра [ `HasFile` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx) указывает, передаются ли файл пользователем, пока [ `FileBytes` свойство](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx) предоставляет доступ к загруженные двоичные данные в виде массива байтов.</span><span class="sxs-lookup"><span data-stu-id="402e8-276">For instance, the [`HasFile` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx) indicates whether a file was uploaded by the user, while the [`FileBytes` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx) provides access to the uploaded binary data as an array of bytes.</span></span> <span data-ttu-id="402e8-277">`Click` Запускает обработчик событий, гарантируя, что файл был загружен.</span><span class="sxs-lookup"><span data-stu-id="402e8-277">The `Click` event handler starts by ensuring that a file has been uploaded.</span></span> <span data-ttu-id="402e8-278">Если файл был загружен, метка показывает имя отправленного файла, его размер в байтах и типа содержимого.</span><span class="sxs-lookup"><span data-stu-id="402e8-278">If a file has been uploaded, the Label shows the name of the uploaded file, its size in bytes, and its content-type.</span></span>

> [!NOTE]
> <span data-ttu-id="402e8-279">Чтобы убедиться, что пользователь отправляет файл, вы можете проверить `HasFile` свойства и отображает предупреждение, если он s `False`, или вы можете использовать [управления RequiredFieldValidator](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx) вместо.</span><span class="sxs-lookup"><span data-stu-id="402e8-279">To ensure that the user uploads a file you can check the `HasFile` property and display a warning if it s `False`, or you may use the [RequiredFieldValidator control](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx) instead.</span></span>


<span data-ttu-id="402e8-280">FileUpload s `SaveAs(filePath)` сохраняет загруженный файл в указанном *filePath*.</span><span class="sxs-lookup"><span data-stu-id="402e8-280">The FileUpload s `SaveAs(filePath)` saves the uploaded file to the specified *filePath*.</span></span> <span data-ttu-id="402e8-281">*filePath* должно быть *физический путь* (`C:\Websites\Brochures\SomeFile.pdf`), а не *виртуальных* *путь* (`/Brochures/SomeFile.pdf`).</span><span class="sxs-lookup"><span data-stu-id="402e8-281">*filePath* must be a *physical path* (`C:\Websites\Brochures\SomeFile.pdf`) rather than a *virtual* *path* (`/Brochures/SomeFile.pdf`).</span></span> <span data-ttu-id="402e8-282">[ `Server.MapPath(virtPath)` Метод](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx) Получает виртуальный путь и возвращает соответствующий физический путь.</span><span class="sxs-lookup"><span data-stu-id="402e8-282">The [`Server.MapPath(virtPath)` method](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx) takes a virtual path and returns its corresponding physical path.</span></span> <span data-ttu-id="402e8-283">Здесь — виртуальный путь `~/Brochures/fileName`, где *fileName* имя отправленного файла.</span><span class="sxs-lookup"><span data-stu-id="402e8-283">Here, the virtual path is `~/Brochures/fileName`, where *fileName* is the name of the uploaded file.</span></span> <span data-ttu-id="402e8-284">В разделе [с помощью Server.MapPath](http://www.4guysfromrolla.com/webtech/121799-1.shtml) Дополнительные сведения о виртуальных и физических путей и с помощью `Server.MapPath`.</span><span class="sxs-lookup"><span data-stu-id="402e8-284">See [Using Server.MapPath](http://www.4guysfromrolla.com/webtech/121799-1.shtml) for more information on virtual and physical paths and using `Server.MapPath`.</span></span>

<span data-ttu-id="402e8-285">После завершения `Click` обработчика событий, теперь пора проверить страницы в браузере.</span><span class="sxs-lookup"><span data-stu-id="402e8-285">After completing the `Click` event handler, take a moment to test out the page in a browser.</span></span> <span data-ttu-id="402e8-286">Нажмите кнопку обзора и выберите файл с жесткого диска и затем нажмите кнопку Отправить выбранный файл.</span><span class="sxs-lookup"><span data-stu-id="402e8-286">Click the Browse button and select a file from your hard drive and then click the Upload Selected File button.</span></span> <span data-ttu-id="402e8-287">Обратная передача будет отправлять содержимое выбранного файла на веб-сервер, который затем выводит сведения о файле до сохранения его в `~/Brochures` папки.</span><span class="sxs-lookup"><span data-stu-id="402e8-287">The postback will send the contents of the selected file to the web server, which will then display information about the file before saving it to the `~/Brochures` folder.</span></span> <span data-ttu-id="402e8-288">После отправки файла, вернитесь в Visual Studio и нажмите кнопку "Обновить" в обозревателе решений.</span><span class="sxs-lookup"><span data-stu-id="402e8-288">After uploading the file, return to Visual Studio and click the Refresh button in the Solution Explorer.</span></span> <span data-ttu-id="402e8-289">Будет показан файл, загруженный в папке ~/Brochures!</span><span class="sxs-lookup"><span data-stu-id="402e8-289">You should see the file you just uploaded in the ~/Brochures folder!</span></span>


<span data-ttu-id="402e8-290">[![EvolutionValley.jpg файл был загружен для веб-сервера](uploading-files-vb/_static/image14.gif)](uploading-files-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="402e8-290">[![The File EvolutionValley.jpg Has Been Uploaded to the Web Server](uploading-files-vb/_static/image14.gif)](uploading-files-vb/_static/image21.png)</span></span>

<span data-ttu-id="402e8-291">**Рис. 14**: файл `EvolutionValley.jpg` загрузки на веб-сервер ([Просмотр полноразмерное изображение](uploading-files-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="402e8-291">**Figure 14**: The File `EvolutionValley.jpg` Has Been Uploaded to the Web Server ([Click to view full-size image](uploading-files-vb/_static/image22.png))</span></span>


![EvolutionValley.jpg Was Saved to the ~/Brochures Folder](uploading-files-vb/_static/image15.gif)

<span data-ttu-id="402e8-293">**Рис. 15**: `EvolutionValley.jpg` был сохранен на `~/Brochures` папки</span><span class="sxs-lookup"><span data-stu-id="402e8-293">**Figure 15**: `EvolutionValley.jpg` Was Saved to the `~/Brochures` Folder</span></span>


## <a name="subtleties-with-saving-uploaded-files-to-the-file-system"></a><span data-ttu-id="402e8-294">Тонкостей с сохранение переданные файлы в файловой системе</span><span class="sxs-lookup"><span data-stu-id="402e8-294">Subtleties with Saving Uploaded Files to the File System</span></span>

<span data-ttu-id="402e8-295">Существует несколько тонкостей, которые должны учитываться при сохранении передача файлов в файловой системе web server s.</span><span class="sxs-lookup"><span data-stu-id="402e8-295">There are several subtleties that must be addressed when saving uploading files to the web server s file system.</span></span> <span data-ttu-id="402e8-296">Во-первых, существует проблема безопасности.</span><span class="sxs-lookup"><span data-stu-id="402e8-296">First, there s the issue of security.</span></span> <span data-ttu-id="402e8-297">Чтобы сохранить файл в файловой системе, контекст безопасности, в котором выполняется страница ASP.NET требуются разрешения записи.</span><span class="sxs-lookup"><span data-stu-id="402e8-297">To save a file to the file system, the security context under which the ASP.NET page is executing must have Write permissions.</span></span> <span data-ttu-id="402e8-298">Веб-сервера разработки ASP.NET выполняется в контексте текущей учетной записи пользователя.</span><span class="sxs-lookup"><span data-stu-id="402e8-298">The ASP.NET Development Web Server runs under the context of your current user account.</span></span> <span data-ttu-id="402e8-299">Если вы используете s Microsoft Internet Information Services (IIS) и веб-сервер, контекст безопасности зависит от версии IIS и его конфигурации.</span><span class="sxs-lookup"><span data-stu-id="402e8-299">If you are using Microsoft s Internet Information Services (IIS) as the web server, the security context depends on the version of IIS and its configuration.</span></span>

<span data-ttu-id="402e8-300">Еще одна проблема сохранения файлов в файловой системе строится на имена файлов.</span><span class="sxs-lookup"><span data-stu-id="402e8-300">Another challenge of saving files to the file system revolves around naming the files.</span></span> <span data-ttu-id="402e8-301">В настоящее время нашу страницу сохраняет все загруженные файлы для `~/Brochures` каталог с тем же именем, как этот файл на компьютере клиента s.</span><span class="sxs-lookup"><span data-stu-id="402e8-301">Currently, our page saves all of the uploaded files to the `~/Brochures` directory using the same name as the file on the client s computer.</span></span> <span data-ttu-id="402e8-302">Если пользователь А отправляет брошюр с именем `Brochure.pdf`, файл будет сохранен как `~/Brochure/Brochure.pdf`.</span><span class="sxs-lookup"><span data-stu-id="402e8-302">If User A uploads a brochure with the name `Brochure.pdf`, the file will be saved as `~/Brochure/Brochure.pdf`.</span></span> <span data-ttu-id="402e8-303">Но что делать, если когда-нибудь более поздней версии пользователь Б отправляет брошюр другой файл с тем же именем файла (`Brochure.pdf`)?</span><span class="sxs-lookup"><span data-stu-id="402e8-303">But what if sometime later User B uploads a different brochure file that happens to have the same filename (`Brochure.pdf`)?</span></span> <span data-ttu-id="402e8-304">Кодом у нас есть теперь файл s будет заменен пользователь Б s передачи пользователя.</span><span class="sxs-lookup"><span data-stu-id="402e8-304">With the code we have now, User A s file will be overwritten with User B s upload.</span></span>

<span data-ttu-id="402e8-305">Существует несколько способов разрешения конфликтов имен файлов.</span><span class="sxs-lookup"><span data-stu-id="402e8-305">There are a number of techniques for resolving file name conflicts.</span></span> <span data-ttu-id="402e8-306">Один из вариантов — запретить загрузки файла, если уже существует с тем же именем.</span><span class="sxs-lookup"><span data-stu-id="402e8-306">One option is to prohibit uploading a file if there already exists one with the same name.</span></span> <span data-ttu-id="402e8-307">При таком подходе, когда пользователь Б пытается передать файл с именем `Brochure.pdf`, система не будет сохранить их в файл и вместо них будет отображаться сообщение о том, пользователь Б, переименуйте файл и повторите попытку.</span><span class="sxs-lookup"><span data-stu-id="402e8-307">With this approach, when User B attempts to upload a file named `Brochure.pdf`, the system would not save their file and instead display a message informing User B to rename the file and try again.</span></span> <span data-ttu-id="402e8-308">Другой подход заключается в сохранить файл, используя уникальное имя файла, который может быть [глобальный уникальный идентификатор (GUID)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier) или значение из соответствующего базы данных столбцы первичного ключа записи s (предполагая, что сопоставленный передачи конкретной строки в модели данных).</span><span class="sxs-lookup"><span data-stu-id="402e8-308">Another approach is to save the file using a unique file name, which could be a [globally unique identifier (GUID)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier) or the value from the corresponding database record s primary key column(s) (assuming that the upload is associated with a particular row in the data model).</span></span> <span data-ttu-id="402e8-309">В следующем уроке мы изучим более подробно эти параметры.</span><span class="sxs-lookup"><span data-stu-id="402e8-309">In the next tutorial we'll explore these options in more detail.</span></span>

## <a name="challenges-involved-with-very-large-amounts-of-binary-data"></a><span data-ttu-id="402e8-310">Задачам, связанным с очень больших объемов двоичных данных</span><span class="sxs-lookup"><span data-stu-id="402e8-310">Challenges Involved with Very Large Amounts of Binary Data</span></span>

<span data-ttu-id="402e8-311">В этих учебниках предполагается, что двоичные данные используется небольшого размера.</span><span class="sxs-lookup"><span data-stu-id="402e8-311">These tutorials assume that the binary data captured is modest in size.</span></span> <span data-ttu-id="402e8-312">Работа с очень больших объемов двоичных данных файлов, несколько мегабайт или больше возникают новые проблемы, которые выходят за рамки этих учебников.</span><span class="sxs-lookup"><span data-stu-id="402e8-312">Working with very large amounts of binary data files that are several megabytes or larger introduces new challenges that are beyond the scope of these tutorials.</span></span> <span data-ttu-id="402e8-313">Например, по умолчанию ASP.NET отклонит передачи более 4 МБ, несмотря на то, что это можно настроить с помощью [ `<httpRuntime>` элемент](https://msdn.microsoft.com/library/e1f13641.aspx) в `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="402e8-313">For example, by default ASP.NET will reject uploads of more than 4 MB, although this can be configured through the [`<httpRuntime>` element](https://msdn.microsoft.com/library/e1f13641.aspx) in `Web.config`.</span></span> <span data-ttu-id="402e8-314">IIS слишком налагает собственные передачи ограничений на размер файла.</span><span class="sxs-lookup"><span data-stu-id="402e8-314">IIS imposes its own file upload size limitations, too.</span></span> <span data-ttu-id="402e8-315">В разделе [объем отправляемых файлов IIS](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html) для получения дополнительной информации.</span><span class="sxs-lookup"><span data-stu-id="402e8-315">See [IIS Upload File Size](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html) for more information.</span></span> <span data-ttu-id="402e8-316">Кроме того время, необходимое для отправки больших файлов может превышать значение по умолчанию 110 секунд ожидания ASP.NET для запроса.</span><span class="sxs-lookup"><span data-stu-id="402e8-316">Furthermore, the time taken to upload large files might exceed the default 110 seconds ASP.NET will wait for a request.</span></span> <span data-ttu-id="402e8-317">Существуют также памятью и производительностью проблем, возникающих при работе с большими файлами.</span><span class="sxs-lookup"><span data-stu-id="402e8-317">There are also memory and performance issues that arise when working with large files.</span></span>

<span data-ttu-id="402e8-318">Элемент управления FileUpload оказывается нецелесообразным для передачи больших файлов.</span><span class="sxs-lookup"><span data-stu-id="402e8-318">The FileUpload control is impractical for large file uploads.</span></span> <span data-ttu-id="402e8-319">Как содержимое файла s передаются на сервер, конечный пользователь будет продолжен терпеливо без подтверждения, выполняет их отправки.</span><span class="sxs-lookup"><span data-stu-id="402e8-319">As the file s contents are being posted to the server, the end user must patiently wait without any confirmation that their upload is progressing.</span></span> <span data-ttu-id="402e8-320">Это не так много проблемы при работе с файлами могут быть загружены через несколько секунд, которые необходимо учитывать при работе с большими файлами, может потребоваться минут для загрузки.</span><span class="sxs-lookup"><span data-stu-id="402e8-320">This is not so much an issue when dealing with smaller files that can be uploaded in a few seconds, but can be an issue when dealing with larger files that may take minutes to upload.</span></span> <span data-ttu-id="402e8-321">Существует много независимых файла загрузки элементов управления, которые лучше подходят для обработки больших объемов и многие из этих поставщиков предоставляют ActiveX и индикаторов хода выполнения передачи диспетчеры, предоставляющие гораздо более профессиональный взаимодействие с пользователем.</span><span class="sxs-lookup"><span data-stu-id="402e8-321">There are a variety of third-party file upload controls that are better suited for handling large uploads and many of these vendors provide progress indicators and ActiveX upload managers that present a much more polished user experience.</span></span>

<span data-ttu-id="402e8-322">Если приложению для обработки больших файлов, необходимо тщательно определить причину проблемы и найти подходящего решения для конкретных потребностей.</span><span class="sxs-lookup"><span data-stu-id="402e8-322">If your application needs to handle large files, you'll need to carefully investigate the challenges and find suitable solutions for your particular needs.</span></span>

## <a name="summary"></a><span data-ttu-id="402e8-323">Сводка</span><span class="sxs-lookup"><span data-stu-id="402e8-323">Summary</span></span>

<span data-ttu-id="402e8-324">Построение приложения, которое требуется для записи двоичных данных представлен ряд проблем.</span><span class="sxs-lookup"><span data-stu-id="402e8-324">Building an application that needs to capture binary data introduces a number of challenges.</span></span> <span data-ttu-id="402e8-325">В этом учебнике мы изучена первых двух: Выбор места для хранения двоичных данных и дает пользователям возможность передать двоичного содержимого через веб-страницу.</span><span class="sxs-lookup"><span data-stu-id="402e8-325">In this tutorial we explored the first two: deciding where to store the binary data and allowing a user to upload binary content through a web page.</span></span> <span data-ttu-id="402e8-326">На трех следующих руководствах мы рассмотрим, как связать загруженные данные с помощью записи в базе данных, а также как Вывод двоичных данных вместе с его текст поля данных.</span><span class="sxs-lookup"><span data-stu-id="402e8-326">Over the next three tutorials, we'll see how to associate the uploaded data with a record in the database as well as how to display the binary data alongside its text data fields.</span></span>

<span data-ttu-id="402e8-327">Программирование довольны!</span><span class="sxs-lookup"><span data-stu-id="402e8-327">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="402e8-328">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="402e8-328">Further Reading</span></span>

<span data-ttu-id="402e8-329">Дополнительные сведения по темам, рассматриваемые в этом учебнике см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="402e8-329">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="402e8-330">Использование типов данных больших значений</span><span class="sxs-lookup"><span data-stu-id="402e8-330">Using Large-Value Data Types</span></span>](https://msdn.microsoft.com/library/ms178158.aspx)
- [<span data-ttu-id="402e8-331">Примеры использования элемента управления fileUpload</span><span class="sxs-lookup"><span data-stu-id="402e8-331">FileUpload Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/fileupload.aspx)
- [<span data-ttu-id="402e8-332">Элемент управления сервера ASP.NET 2.0 FileUpload</span><span class="sxs-lookup"><span data-stu-id="402e8-332">The ASP.NET 2.0 FileUpload Server Control</span></span>](http://www.wrox.com/WileyCDA/Section/id-292158.html)
- [<span data-ttu-id="402e8-333">Темный части передачи файлов</span><span class="sxs-lookup"><span data-stu-id="402e8-333">The Dark Side of File Uploads</span></span>](http://www.aspnetresources.com/articles/dark_side_of_file_uploads.aspx)

## <a name="about-the-author"></a><span data-ttu-id="402e8-334">Об авторе</span><span class="sxs-lookup"><span data-stu-id="402e8-334">About the Author</span></span>

<span data-ttu-id="402e8-335">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="402e8-335">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="402e8-336">Скотт — независимый консультант, trainer и записи.</span><span class="sxs-lookup"><span data-stu-id="402e8-336">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="402e8-337">Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="402e8-337">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="402e8-338">Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="402e8-338">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="402e8-339">Благодарности</span><span class="sxs-lookup"><span data-stu-id="402e8-339">Special Thanks To</span></span>

<span data-ttu-id="402e8-340">Этот учебник ряд прошел проверку многие полезные рецензентов.</span><span class="sxs-lookup"><span data-stu-id="402e8-340">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="402e8-341">Основными редакторами этого учебника были Мерфи Тереза д и Екатерина Leigh.</span><span class="sxs-lookup"><span data-stu-id="402e8-341">Lead reviewers for this tutorial were Teresa Murphy and Bernadette Leigh.</span></span> <span data-ttu-id="402e8-342">Объясняются моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="402e8-342">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="402e8-343">Если Да, напишите мне по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="402e8-343">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="402e8-344">[Назад](updating-and-deleting-existing-binary-data-cs.md)
> [Вперед](displaying-binary-data-in-the-data-web-controls-vb.md)</span><span class="sxs-lookup"><span data-stu-id="402e8-344">[Previous](updating-and-deleting-existing-binary-data-cs.md)
[Next](displaying-binary-data-in-the-data-web-controls-vb.md)</span></span>
