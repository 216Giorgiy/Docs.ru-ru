---
uid: web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
title: Вставка (C#) пакета | Документы Microsoft
author: rick-anderson
description: Дополнительные сведения о вставке нескольких записей базы данных в одной операции. В уровень пользовательского интерфейса, мы расширить GridView, чтобы разрешить пользователям вводить несколько n...
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/26/2007
ms.topic: article
ms.assetid: cf025e08-48fc-4385-b176-8610aa7b5565
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
msc.type: authoredcontent
ms.openlocfilehash: c8995592d9206fb17a7769414212369946304c54
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="batch-inserting-c"></a><span data-ttu-id="6e405-104">Пакетной вставки (C#)</span><span class="sxs-lookup"><span data-stu-id="6e405-104">Batch Inserting (C#)</span></span>
====================
<span data-ttu-id="6e405-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="6e405-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="6e405-106">[Загрузить код](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip) или [скачать PDF](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="6e405-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip) or [Download PDF](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span></span>

> <span data-ttu-id="6e405-107">Дополнительные сведения о вставке нескольких записей базы данных в одной операции.</span><span class="sxs-lookup"><span data-stu-id="6e405-107">Learn how to insert multiple database records in a single operation.</span></span> <span data-ttu-id="6e405-108">В уровень пользовательского интерфейса, мы расширить GridView, чтобы разрешить пользователям вводить несколько новых записей.</span><span class="sxs-lookup"><span data-stu-id="6e405-108">In the User Interface Layer we extend the GridView to allow the user to enter multiple new records.</span></span> <span data-ttu-id="6e405-109">В слое доступа к данным мы вокруг нескольких операций вставки в пределах транзакции обеспечивают выполнение всех операций вставки откат всех операций вставки.</span><span class="sxs-lookup"><span data-stu-id="6e405-109">In the Data Access Layer we wrap the multiple Insert operations within a transaction to ensure that all insertions succeed or all insertions are rolled back.</span></span>


## <a name="introduction"></a><span data-ttu-id="6e405-110">Вступление</span><span class="sxs-lookup"><span data-stu-id="6e405-110">Introduction</span></span>

<span data-ttu-id="6e405-111">В [обновление пакета](batch-updating-cs.md) учебника мы рассматривали Настройка элемента управления GridView для представления интерфейса, где несколько записей были для редактирования.</span><span class="sxs-lookup"><span data-stu-id="6e405-111">In the [Batch Updating](batch-updating-cs.md) tutorial we looked at customizing the GridView control to present an interface where multiple records were editable.</span></span> <span data-ttu-id="6e405-112">Пользователь, посетив страницу может внести ряд изменений, а затем, с одним нажатием кнопки, выполните пакетного обновления.</span><span class="sxs-lookup"><span data-stu-id="6e405-112">The user visiting the page could make a series of changes and then, with a single button click, perform a batch update.</span></span> <span data-ttu-id="6e405-113">В ситуациях, когда пользователи часто обновлять много записей за один раз, такой интерфейс можно сохранить бесчисленные щелчков мыши и клавиатуры для мыши контекстных переключений по сравнению с по умолчанию построчные возможности редактирования, которые сначала были изучены обратно в [ Общие сведения о вставке, обновление и удаление данных](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) учебника.</span><span class="sxs-lookup"><span data-stu-id="6e405-113">For situations where users commonly update many records in one go, such an interface can save countless clicks and keyboard-to-mouse context switches when compared to the default per-row editing features that were first explored back in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial.</span></span>

<span data-ttu-id="6e405-114">Эта концепция могут также применяться при добавлении записей.</span><span class="sxs-lookup"><span data-stu-id="6e405-114">This concept can also be applied when adding records.</span></span> <span data-ttu-id="6e405-115">Предположим, что здесь в компании Northwind Traders мы обычно получают отгрузок от поставщиков, которые содержат количество продуктов для определенной категории.</span><span class="sxs-lookup"><span data-stu-id="6e405-115">Imagine that here at Northwind Traders we commonly receive shipments from suppliers that contain a number of products for a particular category.</span></span> <span data-ttu-id="6e405-116">Например мы получили отгрузки шесть разных чая и кофе продуктов из Tokyo Traders.</span><span class="sxs-lookup"><span data-stu-id="6e405-116">As an example, we might receive a shipment of six different tea and coffee products from Tokyo Traders.</span></span> <span data-ttu-id="6e405-117">Если пользователь вводит шесть одного продукта во время с помощью элемента управления DetailsView, их нужно снова и снова выберите многие одинаковые значения: необходимо будет выбрать одной категории (Напитки) одного поставщика (Tokyo Traders), то неподдерживаемых (значение Значение false) и тем же единицам на порядок значение (0).</span><span class="sxs-lookup"><span data-stu-id="6e405-117">If a user enters the six products one at a time through a DetailsView control, they will have to choose many of the same values over and over again: they will need to choose the same category (Beverages), the same supplier (Tokyo Traders), the same discontinued value (False), and the same units on order value (0).</span></span> <span data-ttu-id="6e405-118">Эта запись повторяющихся данных не только много времени, но может привести к ошибкам.</span><span class="sxs-lookup"><span data-stu-id="6e405-118">This repetitive data entry is not only time consuming, but is prone to errors.</span></span>

<span data-ttu-id="6e405-119">С минимальными усилиями можно создать пакет, вставка интерфейс, позволяющий пользователю выбрать поставщика и категории один раз, ввести ряд названий продуктов и цен, а затем нажмите кнопку Добавление новых продуктов в базе данных (см. рис. 1).</span><span class="sxs-lookup"><span data-stu-id="6e405-119">With a little work we can create a batch inserting interface that enables the user to choose the supplier and category once, enter a series of product names and unit prices, and then click a button to add the new products to the database (see Figure 1).</span></span> <span data-ttu-id="6e405-120">При добавлении каждого продукта, его `ProductName` и `UnitPrice` поля данных назначаются значения, введенные в текстовые поля, пока его `CategoryID` и `SupplierID` значения присваиваются значения с элементами управления DropDownList в верхнем fo формы.</span><span class="sxs-lookup"><span data-stu-id="6e405-120">As each product is added, its `ProductName` and `UnitPrice` data fields are assigned the values entered in the TextBoxes, while its `CategoryID` and `SupplierID` values are assigned the values from the DropDownLists at the top fo the form.</span></span> <span data-ttu-id="6e405-121">`Discontinued` И `UnitsOnOrder` значения присваиваются значения жестко `false` и 0 соответственно.</span><span class="sxs-lookup"><span data-stu-id="6e405-121">The `Discontinued` and `UnitsOnOrder` values are set to the hard-coded values of `false` and 0, respectively.</span></span>


<span data-ttu-id="6e405-122">[![Интерфейс пакетной вставки](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="6e405-122">[![The Batch Inserting Interface](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span></span>

<span data-ttu-id="6e405-123">**Рис. 1**: пакетной вставки интерфейс ([Просмотр полноразмерное изображение](batch-inserting-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="6e405-123">**Figure 1**: The Batch Inserting Interface ([Click to view full-size image](batch-inserting-cs/_static/image3.png))</span></span>


<span data-ttu-id="6e405-124">В этом учебнике мы создадим страницу, которая реализует интерфейсам, приведенный на рисунке 1 пакета.</span><span class="sxs-lookup"><span data-stu-id="6e405-124">In this tutorial we will create a page that implements the batch inserting interface shown in Figure 1.</span></span> <span data-ttu-id="6e405-125">Как с двух предыдущих занятий, мы будет переносить операции вставки в пределах транзакции, чтобы гарантировать атомарность.</span><span class="sxs-lookup"><span data-stu-id="6e405-125">As with the previous two tutorials, we will wrap the insertions within the scope of a transaction to ensure atomicity.</span></span> <span data-ttu-id="6e405-126">S позволяют начать работу!</span><span class="sxs-lookup"><span data-stu-id="6e405-126">Let s get started!</span></span>

## <a name="step-1-creating-the-display-interface"></a><span data-ttu-id="6e405-127">Шаг 1: Создание интерфейса</span><span class="sxs-lookup"><span data-stu-id="6e405-127">Step 1: Creating the Display Interface</span></span>

<span data-ttu-id="6e405-128">Этот учебник состоит из одной страницы, разделенное на две области: область отображения и область вставки.</span><span class="sxs-lookup"><span data-stu-id="6e405-128">This tutorial will consist of a single page that is divided into two regions: a display region and an inserting region.</span></span> <span data-ttu-id="6e405-129">Интерфейса, который мы создадим на этом шаге, показаны продукты в элементе управления GridView и включает кнопку с названием продукта отгрузки процесса.</span><span class="sxs-lookup"><span data-stu-id="6e405-129">The display interface, which we'll create in this step, shows the products in a GridView and includes a button titled Process Product Shipment.</span></span> <span data-ttu-id="6e405-130">При нажатии этой кнопки интерфейса заменяется интерфейса вставки, как показано на рис. 1.</span><span class="sxs-lookup"><span data-stu-id="6e405-130">When this button is clicked, the display interface is replaced with the inserting interface, which is shown in Figure 1.</span></span> <span data-ttu-id="6e405-131">Возвращает интерфейса после добавить продукты из отгрузки или нажатии кнопки "Отмена".</span><span class="sxs-lookup"><span data-stu-id="6e405-131">The display interface returns after the Add Products from Shipment or Cancel buttons are clicked.</span></span> <span data-ttu-id="6e405-132">Мы создадим интерфейса вставки на шаге 2.</span><span class="sxs-lookup"><span data-stu-id="6e405-132">We'll create the inserting interface in Step 2.</span></span>

<span data-ttu-id="6e405-133">При создании страницы, использующей два интерфейса, одновременно только одна из которых будет видима, каждый интерфейс обычно помещается в [веб-панель управления](http://www.w3schools.com/aspnet/control_panel.asp), который используется в качестве контейнера для других элементов управления.</span><span class="sxs-lookup"><span data-stu-id="6e405-133">When creating a page that has two interfaces, only one of which is visible at a time, each interface typically is placed within a [Panel Web control](http://www.w3schools.com/aspnet/control_panel.asp), which serves as a container for other controls.</span></span> <span data-ttu-id="6e405-134">Таким образом нашу страницу будет иметь два элемента управления панели один для каждого интерфейса.</span><span class="sxs-lookup"><span data-stu-id="6e405-134">Therefore, our page will have two Panel controls one for each interface.</span></span>

<span data-ttu-id="6e405-135">Сначала откройте `BatchInsert.aspx` страницы в `BatchData` папки и перетащите элемент управления из области элементов в конструктор (см. рис. 2).</span><span class="sxs-lookup"><span data-stu-id="6e405-135">Start by opening the `BatchInsert.aspx` page in the `BatchData` folder and drag a Panel from the Toolbox onto the Designer (see Figure 2).</span></span> <span data-ttu-id="6e405-136">Задайте для свойства панели s `ID` свойства `DisplayInterface`.</span><span class="sxs-lookup"><span data-stu-id="6e405-136">Set the Panel s `ID` property to `DisplayInterface`.</span></span> <span data-ttu-id="6e405-137">При добавлении панели в конструкторе, его `Height` и `Width` задано значение 50px и 125px, соответственно.</span><span class="sxs-lookup"><span data-stu-id="6e405-137">When adding the Panel to the Designer, its `Height` and `Width` properties are set to 50px and 125px, respectively.</span></span> <span data-ttu-id="6e405-138">Очистить значения этих свойств в окне свойств.</span><span class="sxs-lookup"><span data-stu-id="6e405-138">Clear out these property values from the Properties window.</span></span>


<span data-ttu-id="6e405-139">[![Перетащите элемент управления из области элементов в конструктор](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="6e405-139">[![Drag a Panel from the Toolbox onto the Designer](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span></span>

<span data-ttu-id="6e405-140">**На рисунке 2**: перетащите элемент управления из области элементов в конструктор ([Просмотр полноразмерное изображение](batch-inserting-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="6e405-140">**Figure 2**: Drag a Panel from the Toolbox onto the Designer ([Click to view full-size image](batch-inserting-cs/_static/image6.png))</span></span>


<span data-ttu-id="6e405-141">Затем перетащите элемент управления Button и GridView в панель.</span><span class="sxs-lookup"><span data-stu-id="6e405-141">Next, drag a Button and GridView control into the Panel.</span></span> <span data-ttu-id="6e405-142">Настроить кнопку s `ID` свойства `ProcessShipment` и его `Text` свойства процесса отгрузки продукции.</span><span class="sxs-lookup"><span data-stu-id="6e405-142">Set the Button s `ID` property to `ProcessShipment` and its `Text` property to Process Product Shipment.</span></span> <span data-ttu-id="6e405-143">Набор GridView s `ID` свойства `ProductsGrid` и его смарт-теге, привязать его к новой ObjectDataSource с именем `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="6e405-143">Set the GridView s `ID` property to `ProductsGrid` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="6e405-144">Настройка ObjectDataSource для извлечения данных из `ProductsBLL` класса s `GetProducts` метод.</span><span class="sxs-lookup"><span data-stu-id="6e405-144">Configure the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="6e405-145">Поскольку это GridView используется только для отображения данных, установите раскрывающихся списков в UPDATE, INSERT и удаление вкладок (нет).</span><span class="sxs-lookup"><span data-stu-id="6e405-145">Since this GridView is used only to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="6e405-146">Нажмите кнопку Готово, чтобы завершить работу мастера настройки источника данных.</span><span class="sxs-lookup"><span data-stu-id="6e405-146">Click Finish to complete the Configure Data Source wizard.</span></span>


<span data-ttu-id="6e405-147">[![Просмотреть данные, возвращаемые из метода GetProducts класса ProductsBLL s](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="6e405-147">[![Display the Data Returned from the ProductsBLL Class s GetProducts Method](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span></span>

<span data-ttu-id="6e405-148">**Рис. 3**: отображения данных, возвращенных из `ProductsBLL` класса s `GetProducts` метод ([Просмотр полноразмерное изображение](batch-inserting-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="6e405-148">**Figure 3**: Display the Data Returned from the `ProductsBLL` Class s `GetProducts` Method ([Click to view full-size image](batch-inserting-cs/_static/image9.png))</span></span>


<span data-ttu-id="6e405-149">[![Установите раскрывающихся списков в UPDATE, INSERT и удаление вкладок (нет)](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="6e405-149">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span></span>

<span data-ttu-id="6e405-150">**Рис. 4**: задать раскрывающихся списков в обновления, вставки и удаления вкладок (нет) ([Просмотр полноразмерное изображение](batch-inserting-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="6e405-150">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-inserting-cs/_static/image12.png))</span></span>


<span data-ttu-id="6e405-151">После завершения работы мастера ObjectDataSource Visual Studio добавит стояли и CheckBoxField для полей данных продукта.</span><span class="sxs-lookup"><span data-stu-id="6e405-151">After completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for the product data fields.</span></span> <span data-ttu-id="6e405-152">Удалите все, кроме `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`, и `Discontinued` поля.</span><span class="sxs-lookup"><span data-stu-id="6e405-152">Remove all but the `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`, and `Discontinued` fields.</span></span> <span data-ttu-id="6e405-153">Вы можете внести любые изменения внешнего вида.</span><span class="sxs-lookup"><span data-stu-id="6e405-153">Feel free to make any aesthetic customizations.</span></span> <span data-ttu-id="6e405-154">Я решил форматирования `UnitPrice` поля в виде значения валюты, изменять расположение полей, а также некоторые поля `HeaderText` значения.</span><span class="sxs-lookup"><span data-stu-id="6e405-154">I decided to format the `UnitPrice` field as a currency value, reordered the fields, and renamed several of the fields `HeaderText` values.</span></span> <span data-ttu-id="6e405-155">Кроме того, настройте GridView, чтобы включить разбиение по страницам и сортировка поддержки, установив флажки включить разбиения на страницы и включить сортировку в GridView s смарт-тег.</span><span class="sxs-lookup"><span data-stu-id="6e405-155">Also configure the GridView to include paging and sorting support by checking the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="6e405-156">После добавления элементов управления панели, кнопки, GridView и ObjectDataSource и настройка полей s GridView, на странице s должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="6e405-156">After adding the Panel, Button, GridView, and ObjectDataSource controls and customizing the GridView s fields, your page s declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](batch-inserting-cs/samples/sample1.aspx)]

<span data-ttu-id="6e405-157">Обратите внимание, что отображаются разметку для кнопки и GridView между открывающим и закрывающим `<asp:Panel>` тегов.</span><span class="sxs-lookup"><span data-stu-id="6e405-157">Note that the markup for the Button and GridView appear within the opening and closing `<asp:Panel>` tags.</span></span> <span data-ttu-id="6e405-158">Поскольку эти элементы управления находятся в пределах `DisplayInterface` панель, мы их можно скрыть, просто задав панели s `Visible` свойства `false`.</span><span class="sxs-lookup"><span data-stu-id="6e405-158">Since these controls are within the `DisplayInterface` Panel, we can hide them by simply setting the Panel s `Visible` property to `false`.</span></span> <span data-ttu-id="6e405-159">Шаг 3 просматривает программного изменения панели s `Visible` щелкните свойство в ответ на нажатие кнопки, чтобы показать один интерфейс скрывая другой.</span><span class="sxs-lookup"><span data-stu-id="6e405-159">Step 3 looks at programmatically changing the Panel s `Visible` property in response to a button click to show one interface while hiding the other.</span></span>

<span data-ttu-id="6e405-160">Теперь пора просмотрите ход работы через браузер.</span><span class="sxs-lookup"><span data-stu-id="6e405-160">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="6e405-161">Как показано на рисунке 5, вы увидите кнопку отгрузки продукции процесса выше GridView, в которой перечислены продукты десять одновременно.</span><span class="sxs-lookup"><span data-stu-id="6e405-161">As Figure 5 shows, you should see a Process Product Shipment button above a GridView that lists the products ten at a time.</span></span>


<span data-ttu-id="6e405-162">[![GridView перечислены продукты и предлагает сортировки и разбиения по страницам](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="6e405-162">[![The GridView Lists the Products and Offers Sorting and Paging Capabilities](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span></span>

<span data-ttu-id="6e405-163">**Рис. 5**: GridView перечислены продукты и обеспечивает сортировку и разбиение по страницам возможности ([Просмотр полноразмерное изображение](batch-inserting-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="6e405-163">**Figure 5**: The GridView Lists the Products and Offers Sorting and Paging Capabilities ([Click to view full-size image](batch-inserting-cs/_static/image15.png))</span></span>


## <a name="step-2-creating-the-inserting-interface"></a><span data-ttu-id="6e405-164">Шаг 2: Создание интерфейса вставки</span><span class="sxs-lookup"><span data-stu-id="6e405-164">Step 2: Creating the Inserting Interface</span></span>

<span data-ttu-id="6e405-165">С помощью интерфейса завершена, мы готов для создания интерфейса вставки.</span><span class="sxs-lookup"><span data-stu-id="6e405-165">With the display interface complete, we re ready to create the inserting interface.</span></span> <span data-ttu-id="6e405-166">В этом учебнике позволяют создать интерфейс для вставки, запрашивает значение single поставщика и категории, а затем позволяет пользователю ввести до пяти продуктов имена и значения цены единицы s.</span><span class="sxs-lookup"><span data-stu-id="6e405-166">For this tutorial, let s create an inserting interface that prompts for a single supplier and category value and then allows the user to enter up to five product names and unit price values.</span></span> <span data-ttu-id="6e405-167">С помощью этого интерфейса пользователь может добавить одной до пяти новые продукты, все имеют те же категории и поставщика, но иметь уникальный код продукта названия и цены.</span><span class="sxs-lookup"><span data-stu-id="6e405-167">With this interface, the user can add one to five new products that all share the same category and supplier, but have unique product names and prices.</span></span>

<span data-ttu-id="6e405-168">Пуск, перетащив панели из области элементов в конструктор, поместив ее под существующий `DisplayInterface` панель.</span><span class="sxs-lookup"><span data-stu-id="6e405-168">Start by dragging a Panel from the Toolbox onto the Designer, placing it beneath the existing `DisplayInterface` Panel.</span></span> <span data-ttu-id="6e405-169">Задать `ID` этого добавления панели `InsertingInterface` и задайте его `Visible` свойства `false`.</span><span class="sxs-lookup"><span data-stu-id="6e405-169">Set the `ID` property of this newly added Panel to `InsertingInterface` and set its `Visible` property to `false`.</span></span> <span data-ttu-id="6e405-170">Мы добавим код, который задает `InsertingInterface` панель s `Visible` свойства `true` на шаге 3.</span><span class="sxs-lookup"><span data-stu-id="6e405-170">We'll add code that sets the `InsertingInterface` Panel s `Visible` property to `true` in Step 3.</span></span> <span data-ttu-id="6e405-171">Также очистить панель s `Height` и `Width` значения свойств.</span><span class="sxs-lookup"><span data-stu-id="6e405-171">Also clear out the Panel s `Height` and `Width` property values.</span></span>

<span data-ttu-id="6e405-172">Теперь нам нужны для создания интерфейса вставки, показанном обратно на рис. 1.</span><span class="sxs-lookup"><span data-stu-id="6e405-172">Next, we need to create the inserting interface that was shown back in Figure 1.</span></span> <span data-ttu-id="6e405-173">Этот интерфейс может создаваться с помощью разных методов HTML, но мы будем использовать ее очень просто: семь строк и четырех столбцов, таблица.</span><span class="sxs-lookup"><span data-stu-id="6e405-173">This interface can be created through a variety of HTML techniques, but we will use a fairly straightforward one: a four-column, seven-row table.</span></span>

> [!NOTE]
> <span data-ttu-id="6e405-174">При вводе разметки HTML `<table>` элементов, я предпочитаю использовать представление источника.</span><span class="sxs-lookup"><span data-stu-id="6e405-174">When entering markup for HTML `<table>` elements, I prefer to use the Source view.</span></span> <span data-ttu-id="6e405-175">Хотя Visual Studio имеет средства для добавления `<table>` элементов с помощью конструктора, конструктор кажется все слишком пойти для вставки незапрошенный для `style` параметры в разметку.</span><span class="sxs-lookup"><span data-stu-id="6e405-175">While Visual Studio does have tools for adding `<table>` elements through the Designer, the Designer seems all too willing to inject unasked for `style` settings into the markup.</span></span> <span data-ttu-id="6e405-176">После создания `<table>` разметки, обычно возврата в конструкторе, чтобы добавить веб-элементов управления и задайте их свойства.</span><span class="sxs-lookup"><span data-stu-id="6e405-176">Once I have created the `<table>` markup, I usually return to the Designer to add the Web controls and set their properties.</span></span> <span data-ttu-id="6e405-177">При создании таблиц с предварительно определенный столбцами и строками предпочтительно в статическом формате HTML, а не [управления веб-таблица](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) так, как веб-элементов управления, размещенных в таблице веб-элемент управления может осуществляться только с помощью `FindControl("controlID")` шаблон.</span><span class="sxs-lookup"><span data-stu-id="6e405-177">When creating tables with pre-determined columns and rows I prefer using static HTML rather than the [Table Web control](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) because any Web controls placed within a Table Web control can only be accessed using the `FindControl("controlID")` pattern.</span></span> <span data-ttu-id="6e405-178">Таблица веб-элементов управления тем не менее, использовать для таблиц, динамически размера (то есть, строк или столбцов на основе некоторые базы данных или определяемый пользователем критериям), с момента веб-таблица, элемент управления может быть создан программным образом.</span><span class="sxs-lookup"><span data-stu-id="6e405-178">I do, however, use Table Web controls for dynamically-sized tables (ones whose rows or columns are based on some database or user-specified criteria), since the Table Web control can be constructed programmatically.</span></span>


<span data-ttu-id="6e405-179">Введите следующую разметку в `<asp:Panel>` теги `InsertingInterface` панели:</span><span class="sxs-lookup"><span data-stu-id="6e405-179">Enter the following markup within the `<asp:Panel>` tags of the `InsertingInterface` Panel:</span></span>


[!code-html[Main](batch-inserting-cs/samples/sample2.html)]

<span data-ttu-id="6e405-180">Это `<table>` разметки не включает все веб-элементов управления, пока мы добавим те моментально.</span><span class="sxs-lookup"><span data-stu-id="6e405-180">This `<table>` markup does not include any Web controls yet, we'll add those momentarily.</span></span> <span data-ttu-id="6e405-181">Обратите внимание, что каждый `<tr>` элемент содержит определенный параметр класс CSS: `BatchInsertHeaderRow` для строки заголовка, куда будут направлены поставщика и категории элементами управления DropDownList; `BatchInsertFooterRow` строкой нижнего колонтитула, куда будут направлены добавить продукты из отгрузки и Отмена кнопки; и чередующихся `BatchInsertRow` и `BatchInsertAlternatingRow` значения для строк, которые будут содержать продукта и единицы измерения по цене элемента управления TextBox.</span><span class="sxs-lookup"><span data-stu-id="6e405-181">Note that each `<tr>` element contains a particular CSS class setting: `BatchInsertHeaderRow` for the header row where the supplier and category DropDownLists will go; `BatchInsertFooterRow` for the footer row where the Add Products from Shipment and Cancel Buttons will go; and alternating `BatchInsertRow` and `BatchInsertAlternatingRow` values for the rows that will contain the product and unit price TextBox controls.</span></span> <span data-ttu-id="6e405-182">Я хранить созданные соответствующие классы CSS в `Styles.css` файл для предоставления интерфейса вставки интерфейсом, аналогичным интерфейсу GridView и DetailsView управляет, мы хранить, используемые в этих учебниках.</span><span class="sxs-lookup"><span data-stu-id="6e405-182">I ve created corresponding CSS classes in the `Styles.css` file to give the inserting interface an appearance similar to the GridView and DetailsView controls we ve used throughout these tutorials.</span></span> <span data-ttu-id="6e405-183">Ниже приведены эти классы CSS.</span><span class="sxs-lookup"><span data-stu-id="6e405-183">These CSS classes are shown below.</span></span>


[!code-css[Main](batch-inserting-cs/samples/sample3.css)]

<span data-ttu-id="6e405-184">Эта разметка введены возвращается в режим конструктора.</span><span class="sxs-lookup"><span data-stu-id="6e405-184">With this markup entered, return to the Design view.</span></span> <span data-ttu-id="6e405-185">Это `<table>` должно отображаться как семь строк и четырех столбцов, таблицы в конструкторе, как показано на рис. 6.</span><span class="sxs-lookup"><span data-stu-id="6e405-185">This `<table>` should show as a four-column, seven-row table in the Designer, as Figure 6 illustrates.</span></span>


<span data-ttu-id="6e405-186">[![Вставка интерфейса состоит из четырех столбцов, семь строки таблицы](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="6e405-186">[![The Inserting Interface is Composed of a Four-Column, Seven-Row Table](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span></span>

<span data-ttu-id="6e405-187">**Рис. 6**: вставка интерфейс состоит из четырех столбцов, Таблица 7 строкой ([Просмотр полноразмерное изображение](batch-inserting-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="6e405-187">**Figure 6**: The Inserting Interface is Composed of a Four-Column, Seven-Row Table ([Click to view full-size image](batch-inserting-cs/_static/image18.png))</span></span>


<span data-ttu-id="6e405-188">Мы повторно теперь готов для добавления веб-элементов управления в интерфейсе вставки.</span><span class="sxs-lookup"><span data-stu-id="6e405-188">We re now ready to add the Web controls to the inserting interface.</span></span> <span data-ttu-id="6e405-189">Перетащите двумя элементами управления DropDownList из области элементов в соответствующие ячейки в таблице один поставщик и один для категории.</span><span class="sxs-lookup"><span data-stu-id="6e405-189">Drag two DropDownLists from the Toolbox into the appropriate cells in the table one for the supplier and one for the category.</span></span>

<span data-ttu-id="6e405-190">Задайте сведения о поставщике DropDownList s `ID` свойства `Suppliers` и привязать его к новой ObjectDataSource с именем `SuppliersDataSource`.</span><span class="sxs-lookup"><span data-stu-id="6e405-190">Set the supplier DropDownList s `ID` property to `Suppliers` and bind it to a new ObjectDataSource named `SuppliersDataSource`.</span></span> <span data-ttu-id="6e405-191">Настройка нового ObjectDataSource для извлечения данных из `SuppliersBLL` класса s `GetSuppliers` метод и обновление набора вкладку s раскрывающегося списка (нет).</span><span class="sxs-lookup"><span data-stu-id="6e405-191">Configure the new ObjectDataSource to retrieve its data from the `SuppliersBLL` class s `GetSuppliers` method and set the UPDATE tab s drop-down list to (None).</span></span> <span data-ttu-id="6e405-192">Нажмите кнопку Готово, чтобы завершить работу мастера.</span><span class="sxs-lookup"><span data-stu-id="6e405-192">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="6e405-193">[![Настройка ObjectDataSource можно использовать метод GetSuppliers класса SuppliersBLL s](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="6e405-193">[![Configure the ObjectDataSource to Use the SuppliersBLL Class s GetSuppliers Method](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span></span>

<span data-ttu-id="6e405-194">**Рис. 7**: Настройка ObjectDataSource для использования `SuppliersBLL` класса s `GetSuppliers` метод ([Просмотр полноразмерное изображение](batch-inserting-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="6e405-194">**Figure 7**: Configure the ObjectDataSource to Use the `SuppliersBLL` Class s `GetSuppliers` Method ([Click to view full-size image](batch-inserting-cs/_static/image21.png))</span></span>


<span data-ttu-id="6e405-195">У `Suppliers` отображения DropDownList `CompanyName` поля данных и использование `SupplierID` поля данных в качестве его `ListItem` s значений.</span><span class="sxs-lookup"><span data-stu-id="6e405-195">Have the `Suppliers` DropDownList display the `CompanyName` data field and use the `SupplierID` data field as its `ListItem` s values.</span></span>


<span data-ttu-id="6e405-196">[![Отобразить поле CompanyName данных и использовать в качестве значения SupplierID](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="6e405-196">[![Display the CompanyName Data Field and Use SupplierID as the Value](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span></span>

<span data-ttu-id="6e405-197">**Рис. 8**: отображение `CompanyName` поля данных и использование `SupplierID` как значение ([Просмотр полноразмерное изображение](batch-inserting-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="6e405-197">**Figure 8**: Display the `CompanyName` Data Field and Use `SupplierID` as the Value ([Click to view full-size image](batch-inserting-cs/_static/image24.png))</span></span>


<span data-ttu-id="6e405-198">Имя второй DropDownList `Categories` и привязать его к новой ObjectDataSource с именем `CategoriesDataSource`.</span><span class="sxs-lookup"><span data-stu-id="6e405-198">Name the second DropDownList `Categories` and bind it to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="6e405-199">Настройка `CategoriesDataSource` ObjectDataSource для использования `CategoriesBLL` класса s `GetCategories` метод; набор, в раскрывающемся списке перечислены вкладки UPDATE и DELETE (нет) и нажмите кнопку "Готово" для завершения работы мастера.</span><span class="sxs-lookup"><span data-stu-id="6e405-199">Configure the `CategoriesDataSource` ObjectDataSource to use the `CategoriesBLL` class s `GetCategories` method; set the drop-down lists in the UPDATE and DELETE tabs to (None) and click Finish to complete the wizard.</span></span> <span data-ttu-id="6e405-200">Наконец, иметь отображения DropDownList `CategoryName` поля данных и использование `CategoryID` как значение.</span><span class="sxs-lookup"><span data-stu-id="6e405-200">Finally, have the DropDownList display the `CategoryName` data field and use the `CategoryID` as the value.</span></span>

<span data-ttu-id="6e405-201">После добавления и привязан к соответствующим образом настроенных ObjectDataSources этими двумя элементами управления DropDownList экран должен выглядеть аналогично рис. 9.</span><span class="sxs-lookup"><span data-stu-id="6e405-201">After these two DropDownLists have been added and bound to appropriately configured ObjectDataSources, your screen should look similar to Figure 9.</span></span>


<span data-ttu-id="6e405-202">[![Строка заголовка теперь содержит поставщики и элементами управления DropDownList категорий](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="6e405-202">[![The Header Row Now Contains the Suppliers and Categories DropDownLists](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span></span>

<span data-ttu-id="6e405-203">**Рис. 9**: заголовок строки теперь содержит `Suppliers` и `Categories` элементами управления DropDownList ([Просмотр полноразмерное изображение](batch-inserting-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="6e405-203">**Figure 9**: The Header Row Now Contains the `Suppliers` and `Categories` DropDownLists ([Click to view full-size image](batch-inserting-cs/_static/image27.png))</span></span>


<span data-ttu-id="6e405-204">Теперь необходимо создать текстовые поля для сбора, имя и цену для каждого нового продукта.</span><span class="sxs-lookup"><span data-stu-id="6e405-204">We now need to create the TextBoxes to collect the name and price for each new product.</span></span> <span data-ttu-id="6e405-205">Перетащите элемент управления TextBox из области элементов в конструктор для каждой из пяти продуктов название и цену строк.</span><span class="sxs-lookup"><span data-stu-id="6e405-205">Drag a TextBox control from the Toolbox onto the Designer for each of the five product name and price rows.</span></span> <span data-ttu-id="6e405-206">Задать `ID` свойств текстовых полей к `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`, и т. д.</span><span class="sxs-lookup"><span data-stu-id="6e405-206">Set the `ID` properties of the TextBoxes to `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`, and so on.</span></span>

<span data-ttu-id="6e405-207">Добавить элемент управления CompareValidator после каждого цена текстовые поля, установка `ControlToValidate` свойство к соответствующему `ID`.</span><span class="sxs-lookup"><span data-stu-id="6e405-207">Add a CompareValidator after each of the unit price TextBoxes, setting the `ControlToValidate` property to the appropriate `ID`.</span></span> <span data-ttu-id="6e405-208">Также задать `Operator` свойства `GreaterThanEqual`, `ValueToCompare` 0, и `Type` для `Currency`.</span><span class="sxs-lookup"><span data-stu-id="6e405-208">Also set the `Operator` property to `GreaterThanEqual`, `ValueToCompare` to 0, and `Type` to `Currency`.</span></span> <span data-ttu-id="6e405-209">Эти параметры указывают CompareValidator для убедитесь, что цена, если указано, значение валют, больше или равно нулю.</span><span class="sxs-lookup"><span data-stu-id="6e405-209">These settings instruct the CompareValidator to ensure that the price, if entered, is a valid currency value that is greater than or equal to zero.</span></span> <span data-ttu-id="6e405-210">Задать `Text` свойства \*, и `ErrorMessage` цену должен быть больше или равно нулю.</span><span class="sxs-lookup"><span data-stu-id="6e405-210">Set the `Text` property to \*, and `ErrorMessage` to The price must be greater than or equal to zero.</span></span> <span data-ttu-id="6e405-211">Кроме того можно опустить любых символов валют.</span><span class="sxs-lookup"><span data-stu-id="6e405-211">Also, please omit any currency symbols.</span></span>

> [!NOTE]
> <span data-ttu-id="6e405-212">Интерфейс для вставки не включает все элементы управления RequiredFieldValidator, даже если `ProductName` в `Products` таблицы базы данных не допускает `NULL` значения.</span><span class="sxs-lookup"><span data-stu-id="6e405-212">The inserting interface does not include any RequiredFieldValidator controls, even though the `ProductName` field in the `Products` database table does not allow `NULL` values.</span></span> <span data-ttu-id="6e405-213">Это, поскольку мы хотим позволить пользователю ввести до пяти продуктов.</span><span class="sxs-lookup"><span data-stu-id="6e405-213">This is because we want to let the user enter up to five products.</span></span> <span data-ttu-id="6e405-214">Например если пользователь для обеспечения продукта название и цену за единицу для первых трех строк, если оставить пустым, последних двух строк мы d просто добавьте три новых продуктов в системе.</span><span class="sxs-lookup"><span data-stu-id="6e405-214">For example, if the user were to provide the product name and unit price for the first three rows, leaving the last two rows blank, we d just add three new products to the system.</span></span> <span data-ttu-id="6e405-215">Поскольку `ProductName` — требуется, однако нам потребуется Программная проверка, чтобы убедиться, что если цена единицы вводится предоставление соответствующее значение имени продукта.</span><span class="sxs-lookup"><span data-stu-id="6e405-215">Since `ProductName` is required, however, we will need to programmatically check to ensure that if a unit price is entered that a corresponding product name value is provided.</span></span> <span data-ttu-id="6e405-216">Мы исследуем в этом выпуске эта проверка на шаге 4.</span><span class="sxs-lookup"><span data-stu-id="6e405-216">We'll tackle this check in Step 4.</span></span>


<span data-ttu-id="6e405-217">Если проверка ввода пользователя s, CompareValidator сообщает недопустимые данные, если значение содержит символ валюты.</span><span class="sxs-lookup"><span data-stu-id="6e405-217">When validating the user s input, the CompareValidator reports invalid data if the value contains a currency symbol.</span></span> <span data-ttu-id="6e405-218">Добавьте $ перед каждой цена текстовые поля в качестве визуальная подсказка, которая указывает, что пользователю пропустить обозначение денежной единицы, при вводе цены.</span><span class="sxs-lookup"><span data-stu-id="6e405-218">Add a $ in front of each of the unit price TextBoxes to serve as a visual cue that instructs the user to omit the currency symbol when entering the price.</span></span>

<span data-ttu-id="6e405-219">И, наконец, добавьте элемент управления ValidationSummary в `InsertingInterface` панель параметров его `ShowMessageBox` свойства `true` и его `ShowSummary` свойства `false`.</span><span class="sxs-lookup"><span data-stu-id="6e405-219">Lastly, add a ValidationSummary control within the `InsertingInterface` Panel, settings its `ShowMessageBox` property to `true` and its `ShowSummary` property to `false`.</span></span> <span data-ttu-id="6e405-220">Эти параметры Если пользователь вводит значение цены Недопустимая единица измерения, будет отображаться звездочка рядом с нарушением. элементы управления TextBox и управления ValidationSummary отобразит messagebox клиентские, показано сообщение об ошибке, которую мы указали ранее.</span><span class="sxs-lookup"><span data-stu-id="6e405-220">With these settings, if the user enters an invalid unit price value, an asterisk will appear next to the offending TextBox controls and the ValidationSummary will display a client-side messagebox that shows the error message we specified earlier.</span></span>

<span data-ttu-id="6e405-221">На этом этапе экран должен выглядеть примерно на рис. 10.</span><span class="sxs-lookup"><span data-stu-id="6e405-221">At this point, your screen should look similar to Figure 10.</span></span>


<span data-ttu-id="6e405-222">[![Интерфейс для вставки теперь включает текстовые поля для продуктов, названия и цены](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="6e405-222">[![The Inserting Interface Now Includes TextBoxes for the Products Names and Prices](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span></span>

<span data-ttu-id="6e405-223">**Рис. 10**: вставка интерфейса теперь включает текстовые поля для продуктов названия и цены ([Просмотр полноразмерное изображение](batch-inserting-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="6e405-223">**Figure 10**: The Inserting Interface Now Includes TextBoxes for the Products Names and Prices ([Click to view full-size image](batch-inserting-cs/_static/image30.png))</span></span>


<span data-ttu-id="6e405-224">Далее нам нужно добавить добавить продукты из кнопок "отгрузки" и "Отмена" в строке нижнего колонтитула.</span><span class="sxs-lookup"><span data-stu-id="6e405-224">Next we need to add the Add Products from Shipment and Cancel buttons to the footer row.</span></span> <span data-ttu-id="6e405-225">Перетащите две кнопки элементы управления из области элементов в нижний колонтитул интерфейсе вставки параметра кнопки `ID` свойства `AddProducts` и `CancelButton` и `Text` свойства, чтобы добавить продукты из отгрузки и "Отмена", соответственно.</span><span class="sxs-lookup"><span data-stu-id="6e405-225">Drag two Button controls from the Toolbox into the footer of the inserting interface, setting the Buttons `ID` properties to `AddProducts` and `CancelButton` and `Text` properties to Add Products from Shipment and Cancel, respectively.</span></span> <span data-ttu-id="6e405-226">Кроме того, задать `CancelButton` управления s `CausesValidation` свойства `false`.</span><span class="sxs-lookup"><span data-stu-id="6e405-226">In addition, set the `CancelButton` control s `CausesValidation` property to `false`.</span></span>

<span data-ttu-id="6e405-227">Наконец необходимо добавить метки веб-элемент управления, который будет отображать сообщения о состоянии для двух интерфейсов.</span><span class="sxs-lookup"><span data-stu-id="6e405-227">Finally, we need to add a Label Web control that will display status messages for the two interfaces.</span></span> <span data-ttu-id="6e405-228">Например пользователь успешно добавляет новую отгрузку продуктов, мы хотим, чтобы вернуться к интерфейса и отображать сообщение с подтверждением.</span><span class="sxs-lookup"><span data-stu-id="6e405-228">For example, when a user successfully adds a new shipment of products, we want to return to the display interface and display a confirmation message.</span></span> <span data-ttu-id="6e405-229">Если, однако пользователь предоставляет цену для нового продукта, но оставляет off название продукта, нам нужно отображать предупреждающее сообщение с момента `ProductName` поле является обязательным.</span><span class="sxs-lookup"><span data-stu-id="6e405-229">If, however, the user provides a price for a new product but leaves off the product name, we need to display a warning message since the `ProductName` field is required.</span></span> <span data-ttu-id="6e405-230">Так как нам нужно это сообщение, отображаемое для обоих интерфейсов, поместите его в верхней части страницы без панелей.</span><span class="sxs-lookup"><span data-stu-id="6e405-230">Since we need this message to display for both interfaces, place it at the top of the page outside of the Panels.</span></span>

<span data-ttu-id="6e405-231">Перетащите метку веб-элемент управления из панели элементов в верхнюю часть страницы в режиме конструктора.</span><span class="sxs-lookup"><span data-stu-id="6e405-231">Drag a Label Web control from the Toolbox to the top of the page in the Designer.</span></span> <span data-ttu-id="6e405-232">Задать `ID` свойства `StatusLabel`снимите out `Text` свойства, а также установите `Visible` и `EnableViewState` свойства `false`.</span><span class="sxs-lookup"><span data-stu-id="6e405-232">Set the `ID` property to `StatusLabel`, clear out the `Text` property, and set the `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="6e405-233">Как было показано в предыдущих учебниках, установка `EnableViewState` свойства `false` позволяет программно изменять значения свойств подписи s и их автоматически восстановить их значения по умолчанию на последующую обратную передачу.</span><span class="sxs-lookup"><span data-stu-id="6e405-233">As we have seen in previous tutorials, setting the `EnableViewState` property to `false` allows us to programmatically change the Label s property values and have them automatically revert back to their defaults on the subsequent postback.</span></span> <span data-ttu-id="6e405-234">Это упрощает код для отображения сообщения о состоянии в ответ на некоторое действие пользователя, исчезнет при последующих обратной передаче.</span><span class="sxs-lookup"><span data-stu-id="6e405-234">This simplifies the code for showing a status message in response to some user action that disappears on the subsequent postback.</span></span> <span data-ttu-id="6e405-235">Задайте `StatusLabel` управления s `CssClass` свойства для предупреждения, что имя класса CSS, определенного в `Styles.css` в больших, курсив, шрифт, который отображает текст.</span><span class="sxs-lookup"><span data-stu-id="6e405-235">Finally, set the `StatusLabel` control s `CssClass` property to Warning, which is the name of a CSS class defined in `Styles.css` that displays text in a large, italic, bold, red font.</span></span>

<span data-ttu-id="6e405-236">Рис. 11 показана конструктора Visual Studio после метки был добавлен и настроен.</span><span class="sxs-lookup"><span data-stu-id="6e405-236">Figure 11 shows the Visual Studio Designer after the Label has been added and configured.</span></span>


<span data-ttu-id="6e405-237">[![Поместить элемент управления StatusLabel выше двух элементов панели управления](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="6e405-237">[![Place the StatusLabel Control Above the Two Panel Controls](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span></span>

<span data-ttu-id="6e405-238">**Рис. 11**: месте `StatusLabel` выше две панели элементов управления элемента управления ([Просмотр полноразмерное изображение](batch-inserting-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="6e405-238">**Figure 11**: Place the `StatusLabel` Control Above the Two Panel Controls ([Click to view full-size image](batch-inserting-cs/_static/image33.png))</span></span>


## <a name="step-3-switching-between-the-display-and-inserting-interfaces"></a><span data-ttu-id="6e405-239">Шаг 3: Переключение между отображением и вставка интерфейсов</span><span class="sxs-lookup"><span data-stu-id="6e405-239">Step 3: Switching Between the Display and Inserting Interfaces</span></span>

<span data-ttu-id="6e405-240">На этом этапе завершена разметку для наших отображения и вставка интерфейсов, но мы re по-прежнему остается две задачи:</span><span class="sxs-lookup"><span data-stu-id="6e405-240">At this point we have completed the markup for our display and inserting interfaces, but we re still left with two tasks:</span></span>

- <span data-ttu-id="6e405-241">Переключение между отображением и вставка интерфейсов</span><span class="sxs-lookup"><span data-stu-id="6e405-241">Switching between the display and inserting interfaces</span></span>
- <span data-ttu-id="6e405-242">Добавление продуктов в посылку в базу данных</span><span class="sxs-lookup"><span data-stu-id="6e405-242">Adding the products in the shipment to the database</span></span>

<span data-ttu-id="6e405-243">В настоящее время интерфейса отображается, но будет отображаться интерфейса вставки.</span><span class="sxs-lookup"><span data-stu-id="6e405-243">Currently, the display interface is visible but the inserting interface is hidden.</span></span> <span data-ttu-id="6e405-244">Это из-за `DisplayInterface` панель s `Visible` свойству `true` (значение по умолчанию), во время `InsertingInterface` панель s `Visible` свойству `false`.</span><span class="sxs-lookup"><span data-stu-id="6e405-244">This is because the `DisplayInterface` Panel s `Visible` property is set to `true` (the default value), while the `InsertingInterface` Panel s `Visible` property is set to `false`.</span></span> <span data-ttu-id="6e405-245">Для переключения между двумя интерфейсами, нам просто нужно переключить каждого элемента управления s `Visible` значение свойства.</span><span class="sxs-lookup"><span data-stu-id="6e405-245">To switch between the two interfaces we simply need to toggle each control s `Visible` property value.</span></span>

<span data-ttu-id="6e405-246">Мы хотим переместить из интерфейса в интерфейсе вставки при нажатии кнопки процесса отгрузки продукции.</span><span class="sxs-lookup"><span data-stu-id="6e405-246">We want to move from the display interface to the inserting interface when the Process Product Shipment button is clicked.</span></span> <span data-ttu-id="6e405-247">Таким образом, создайте обработчик событий для кнопки s `Click` событие, которое содержит следующий код:</span><span class="sxs-lookup"><span data-stu-id="6e405-247">Therefore, create an event handler for this Button s `Click` event that contains the following code:</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample4.cs)]

<span data-ttu-id="6e405-248">Этот код просто скрывает `DisplayInterface` панели и показывает `InsertingInterface` панель.</span><span class="sxs-lookup"><span data-stu-id="6e405-248">This code simply hides the `DisplayInterface` Panel and shows the `InsertingInterface` Panel.</span></span>

<span data-ttu-id="6e405-249">Создайте обработчики событий для добавления продуктов из отгрузки и кнопку Отмена элементов управления в интерфейсе вставки.</span><span class="sxs-lookup"><span data-stu-id="6e405-249">Next, create event handlers for the Add Products from Shipment and Cancel Button controls in the inserting interface.</span></span> <span data-ttu-id="6e405-250">При нажатии любой из этих кнопок, необходимо вернуться к интерфейса.</span><span class="sxs-lookup"><span data-stu-id="6e405-250">When either of these Buttons is clicked, we need to revert back to the display interface.</span></span> <span data-ttu-id="6e405-251">Создание `Click` обработчики событий для обоих кнопки, элементы управления, чтобы они вызывают `ReturnToDisplayInterface`, метод, мы добавим моментально.</span><span class="sxs-lookup"><span data-stu-id="6e405-251">Create `Click` event handlers for both Button controls so that they call `ReturnToDisplayInterface`, a method we will add momentarily.</span></span> <span data-ttu-id="6e405-252">Помимо скрытие `InsertingInterface` панели и отображение `DisplayInterface` панели `ReturnToDisplayInterface` метод необходимо вернуться к состоянию до редактирования веб-элементов управления.</span><span class="sxs-lookup"><span data-stu-id="6e405-252">In addition to hiding the `InsertingInterface` Panel and showing the `DisplayInterface` Panel, the `ReturnToDisplayInterface` method needs to return the Web controls to their pre-editing state.</span></span> <span data-ttu-id="6e405-253">При этом задается элементами управления DropDownList `SelectedIndex` свойства 0 и очистке `Text` свойства элементов управления TextBox.</span><span class="sxs-lookup"><span data-stu-id="6e405-253">This involves setting the DropDownLists `SelectedIndex` properties to 0 and clearing out the `Text` properties of the TextBox controls.</span></span>

> [!NOTE]
> <span data-ttu-id="6e405-254">Рассмотрим, что может произойти, если мы не существовал t вернуться в состояние до редактирования перед возвратом интерфейса.</span><span class="sxs-lookup"><span data-stu-id="6e405-254">Consider what might happen if we didn t return the controls to their pre-editing state before returning to the display interface.</span></span> <span data-ttu-id="6e405-255">Пользователь может отгрузки продукции процесса нажмите кнопку, введите продукты из отгрузки и нажмите кнопку Добавить продукты из отгрузки.</span><span class="sxs-lookup"><span data-stu-id="6e405-255">A user might click the Process Product Shipment button, enter the products from the shipment, and then click Add Products from Shipment.</span></span> <span data-ttu-id="6e405-256">Это следует добавить продукты и вернуть интерфейса пользователя.</span><span class="sxs-lookup"><span data-stu-id="6e405-256">This would add the products and return the user to the display interface.</span></span> <span data-ttu-id="6e405-257">На этом этапе пользователь может потребоваться добавить другой посылкой.</span><span class="sxs-lookup"><span data-stu-id="6e405-257">At this point the user might want to add another shipment.</span></span> <span data-ttu-id="6e405-258">При нажатии кнопки процесса отгрузки продукции, возвращаемыми интерфейса вставки, но DropDownList выбранные параметры и значения в текстовое поле будет по-прежнему заполняться первоначальные значения.</span><span class="sxs-lookup"><span data-stu-id="6e405-258">Upon clicking the Process Product Shipment button they would return to the inserting interface but the DropDownList selections and TextBox values would still be populated with their previous values.</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample5.cs)]

<span data-ttu-id="6e405-259">Оба `Click` просто вызывает обработчики событий `ReturnToDisplayInterface` метода, несмотря на то, что мы вернемся к продуктам добавить из отгрузки `Click` обработчик событий в шаг 4 и добавить код для сохранения продукты.</span><span class="sxs-lookup"><span data-stu-id="6e405-259">Both `Click` event handlers simply call the `ReturnToDisplayInterface` method, although we'll return to the Add Products from Shipment `Click` event handler in Step 4 and add code to save the products.</span></span> <span data-ttu-id="6e405-260">`ReturnToDisplayInterface` Запускает, возвращая `Suppliers` и `Categories` элементами управления DropDownList для их сначала параметров.</span><span class="sxs-lookup"><span data-stu-id="6e405-260">`ReturnToDisplayInterface` starts by returning the `Suppliers` and `Categories` DropDownLists to their first options.</span></span> <span data-ttu-id="6e405-261">Две константы `firstControlID` и `lastControlID` пометить начального и конечного значений индекса элемента управления, используемого для именования продукта название и цену за единицу текстовые поля в Вставка интерфейса и используются в границах `for` цикл, который задает `Text`свойства элементов управления TextBox обратно в пустую строку.</span><span class="sxs-lookup"><span data-stu-id="6e405-261">The two constants `firstControlID` and `lastControlID` mark the starting and ending control index values used in naming the product name and unit price TextBoxes in the inserting interface and are used in the bounds of the `for` loop that sets the `Text` properties of the TextBox controls back to an empty string.</span></span> <span data-ttu-id="6e405-262">Наконец, панелей `Visible` свойства сбрасываются, позволяющие интерфейса вставки является скрытым и интерфейса показано.</span><span class="sxs-lookup"><span data-stu-id="6e405-262">Finally, the Panels `Visible` properties are reset so that the inserting interface is hidden and the display interface shown.</span></span>

<span data-ttu-id="6e405-263">Теперь пора проверить эту страницу в браузере.</span><span class="sxs-lookup"><span data-stu-id="6e405-263">Take a moment to test out this page in a browser.</span></span> <span data-ttu-id="6e405-264">При первом просмотре странице вы увидите интерфейса, как было показано на рис. 5.</span><span class="sxs-lookup"><span data-stu-id="6e405-264">When first visiting the page you should see the display interface as was shown in Figure 5.</span></span> <span data-ttu-id="6e405-265">Нажмите кнопку процесса отгрузки продукции.</span><span class="sxs-lookup"><span data-stu-id="6e405-265">Click the Process Product Shipment button.</span></span> <span data-ttu-id="6e405-266">Будет обратной передачи страницы, и вы увидите интерфейса вставки как показано на рис. 12.</span><span class="sxs-lookup"><span data-stu-id="6e405-266">The page will postback and you should now see the inserting interface as shown in Figure 12.</span></span> <span data-ttu-id="6e405-267">Щелкнув либо добавить продукты из отгрузки или "Отмена" снова интерфейса.</span><span class="sxs-lookup"><span data-stu-id="6e405-267">Clicking either the Add Products from Shipment or Cancel buttons returns you to the display interface.</span></span>

> [!NOTE]
> <span data-ttu-id="6e405-268">При просмотре интерфейса вставки, теперь пора проверить CompareValidators на цену за единицу текстовые поля.</span><span class="sxs-lookup"><span data-stu-id="6e405-268">While viewing the inserting interface, take a moment to test out the CompareValidators on the unit price TextBoxes.</span></span> <span data-ttu-id="6e405-269">Вы увидите messagebox клиентские предупреждение при нажатии кнопки Добавить продукты из цен с значение меньше нуля или отгрузки кнопка с недопустимым денежных значений.</span><span class="sxs-lookup"><span data-stu-id="6e405-269">You should see a client-side messagebox warning when clicking the Add Products from Shipment button with invalid currency values or prices with a value less than zero.</span></span>


<span data-ttu-id="6e405-270">[![Интерфейс вставки отображается после нажатия кнопки отгрузки продукции процесса](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="6e405-270">[![The Inserting Interface is Displayed After Clicking the Process Product Shipment Button](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span></span>

<span data-ttu-id="6e405-271">**Рис. 12**: вставка интерфейс отображается после нажатия кнопки отгрузки продукции процесса ([Просмотр полноразмерное изображение](batch-inserting-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="6e405-271">**Figure 12**: The Inserting Interface is Displayed After Clicking the Process Product Shipment Button ([Click to view full-size image](batch-inserting-cs/_static/image36.png))</span></span>


## <a name="step-4-adding-the-products"></a><span data-ttu-id="6e405-272">Шаг 4: Добавление продуктов</span><span class="sxs-lookup"><span data-stu-id="6e405-272">Step 4: Adding the Products</span></span>

<span data-ttu-id="6e405-273">Этот учебник предназначен для сохранения продукты в базу данных в новый товар из s отгрузки кнопка остается `Click` обработчика событий.</span><span class="sxs-lookup"><span data-stu-id="6e405-273">All that remains for this tutorial is to save the products to the database in the Add Products from Shipment Button s `Click` event handler.</span></span> <span data-ttu-id="6e405-274">Это можно сделать путем создания `ProductsDataTable` и добавление `ProductsRow` для всех указанных имен продуктов.</span><span class="sxs-lookup"><span data-stu-id="6e405-274">This can be accomplished by creating a `ProductsDataTable` and adding a `ProductsRow` instance for each of the product names supplied.</span></span> <span data-ttu-id="6e405-275">После этих `ProductsRow` , которые были добавлены мы выполним вызов `ProductsBLL` класса s `UpdateWithTransaction` передачи в метод `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="6e405-275">Once these `ProductsRow` s have been added we will make a call to the `ProductsBLL` class s `UpdateWithTransaction` method passing in the `ProductsDataTable`.</span></span> <span data-ttu-id="6e405-276">Помните, что `UpdateWithTransaction` метод, который был создан в [упаковки изменения базы данных в рамках транзакции](wrapping-database-modifications-within-a-transaction-cs.md) «учебник», передает `ProductsDataTable` для `ProductsTableAdapter` s `UpdateWithTransaction` метод.</span><span class="sxs-lookup"><span data-stu-id="6e405-276">Recall that the `UpdateWithTransaction` method, which was created back in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial, passes the `ProductsDataTable` to the `ProductsTableAdapter` s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="6e405-277">После этого запускается транзакции ADO.NET и проблемы TableAdatper `INSERT` инструкцию в базе данных для каждого добавленного `ProductsRow` в DataTable.</span><span class="sxs-lookup"><span data-stu-id="6e405-277">From there, an ADO.NET transaction is started and the TableAdatper issues an `INSERT` statement to the database for each added `ProductsRow` in the DataTable.</span></span> <span data-ttu-id="6e405-278">Предположим, что все продукты добавляются без ошибок, транзакция фиксируется, в противном случае она откатывается назад.</span><span class="sxs-lookup"><span data-stu-id="6e405-278">Assuming all products are added without error, the transaction is committed, otherwise it is rolled back.</span></span>

<span data-ttu-id="6e405-279">Код для добавить продукты из кнопки отгрузки s `Click` обработчик событий также требуется выполнить проверку ошибок немного.</span><span class="sxs-lookup"><span data-stu-id="6e405-279">The code for the Add Products from Shipment Button s `Click` event handler also needs to perform a bit of error checking.</span></span> <span data-ttu-id="6e405-280">Так как существуют не RequiredFieldValidators, используемых в интерфейсе вставки, пользователь может ввести цену для продукта во время его имя.</span><span class="sxs-lookup"><span data-stu-id="6e405-280">Since there are no RequiredFieldValidators used in the inserting interface, a user could enter a price for a product while omitting its name.</span></span> <span data-ttu-id="6e405-281">Поскольку имя продукта s является обязательным, если таких условий развертывания необходимо предупредить пользователя и не продолжить выполнение операции вставки.</span><span class="sxs-lookup"><span data-stu-id="6e405-281">Since the product s name is required, if such a condition unfolds we need to alert the user and not proceed with the inserts.</span></span> <span data-ttu-id="6e405-282">Полный `Click` код обработчика событий следующим:</span><span class="sxs-lookup"><span data-stu-id="6e405-282">The complete `Click` event handler code follows:</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample6.cs)]

<span data-ttu-id="6e405-283">Обработчик события запускается, проверьте `Page.IsValid` свойство возвращает значение `true`.</span><span class="sxs-lookup"><span data-stu-id="6e405-283">The event handler starts by ensuring that the `Page.IsValid` property returns a value of `true`.</span></span> <span data-ttu-id="6e405-284">Если он возвращает `false`, это означает, что один или несколько CompareValidators указаны недопустимые данные; в этом случае мы не хотим попытки вставить введенное продуктов или мы получим исключение при попытке назначить пользователь ввел цена значение `ProductsRow` s `UnitPrice` свойство.</span><span class="sxs-lookup"><span data-stu-id="6e405-284">If it returns `false`, then that means one or more of the CompareValidators are reporting invalid data; in such a case we do not want to attempt to insert the entered products or we'll end up with an exception when attempting to assign the user-entered unit price value to the `ProductsRow` s `UnitPrice` property.</span></span>

<span data-ttu-id="6e405-285">Далее, новый `ProductsDataTable` создается экземпляр (`products`).</span><span class="sxs-lookup"><span data-stu-id="6e405-285">Next, a new `ProductsDataTable` instance is created (`products`).</span></span> <span data-ttu-id="6e405-286">Объект `for` цикл используется для итерации по продукту название и цену за единицу текстовые поля и `Text` свойства считываются в локальных переменных `productName` и `unitPrice`.</span><span class="sxs-lookup"><span data-stu-id="6e405-286">A `for` loop is used to iterate through the product name and unit price TextBoxes and the `Text` properties are read into the local variables `productName` and `unitPrice`.</span></span> <span data-ttu-id="6e405-287">Если введенное пользователем значение цены единицы, но не имя соответствующего продукта `StatusLabel` отображает сообщение при указании цену единицы, вы должны также включать имя продукта и выходе из обработчика событий.</span><span class="sxs-lookup"><span data-stu-id="6e405-287">If the user has entered a value for the unit price but not for the corresponding product name, the `StatusLabel` displays the message If you provide a unit price you must also include the name of the product and the event handler is exited.</span></span>

<span data-ttu-id="6e405-288">Если указано имя продукта, когда новый `ProductsRow` экземпляр создается с помощью `ProductsDataTable` s `NewProductsRow` метод.</span><span class="sxs-lookup"><span data-stu-id="6e405-288">If a product name has been provided, a new `ProductsRow` instance is created using the `ProductsDataTable` s `NewProductsRow` method.</span></span> <span data-ttu-id="6e405-289">Этот новый `ProductsRow` экземпляра s `ProductName` свойству текущего продукта имя текстового поля при `SupplierID` и `CategoryID` свойства, назначенные для `SelectedValue` свойства элементами управления DropDownList в заголовке Вставка интерфейса s.</span><span class="sxs-lookup"><span data-stu-id="6e405-289">This new `ProductsRow` instance s `ProductName` property is set to the current product name TextBox while the `SupplierID` and `CategoryID` properties are assigned to the `SelectedValue` properties of the DropDownLists in the inserting interface s header.</span></span> <span data-ttu-id="6e405-290">Если пользователем введено значение цена продукта s, он не будет назначен `ProductsRow` экземпляра s `UnitPrice` свойство; в противном случае свойство влево без значения, что приведет к `NULL` значение для `UnitPrice` в базе данных.</span><span class="sxs-lookup"><span data-stu-id="6e405-290">If the user entered a value for the product s price, it is assigned to the `ProductsRow` instance s `UnitPrice` property; otherwise, the property is left unassigned, which will result in a `NULL` value for `UnitPrice` in the database.</span></span> <span data-ttu-id="6e405-291">Наконец `Discontinued` и `UnitsOnOrder` свойства присваиваются значения жестко `false` и 0 соответственно.</span><span class="sxs-lookup"><span data-stu-id="6e405-291">Finally, the `Discontinued` and `UnitsOnOrder` properties are assigned to the hard-coded values `false` and 0, respectively.</span></span>

<span data-ttu-id="6e405-292">После назначения свойства `ProductsRow` добавляется в экземпляр `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="6e405-292">After the properties have been assigned to the `ProductsRow` instance it is added to the `ProductsDataTable`.</span></span>

<span data-ttu-id="6e405-293">По завершении `for` цикла, мы проверяем, были ли добавлены все продукты.</span><span class="sxs-lookup"><span data-stu-id="6e405-293">At the completion of the `for` loop, we check whether any products have been added.</span></span> <span data-ttu-id="6e405-294">Пользователь может в конце концов, щелкнул добавить продукты из отгрузки перед вводом все названия продуктов или цены.</span><span class="sxs-lookup"><span data-stu-id="6e405-294">The user may, after all, have clicked the Add Products from Shipment before entering any product names or prices.</span></span> <span data-ttu-id="6e405-295">Если имеется хотя бы один продукт в `ProductsDataTable`, `ProductsBLL` класса s `UpdateWithTransaction` вызывается метод.</span><span class="sxs-lookup"><span data-stu-id="6e405-295">If there is at least one product in the `ProductsDataTable`, the `ProductsBLL` class s `UpdateWithTransaction` method is called.</span></span> <span data-ttu-id="6e405-296">Далее, привязываются к `ProductsGrid` GridView для отображения продуктов, добавленный в интерфейса.</span><span class="sxs-lookup"><span data-stu-id="6e405-296">Next, the data is rebound to the `ProductsGrid` GridView so that the newly added products will appear in the display interface.</span></span> <span data-ttu-id="6e405-297">`StatusLabel` Обновляется и отображает сообщение с подтверждением и `ReturnToDisplayInterface` вызывается, скрытие Вставка интерфейса и отображение интерфейса.</span><span class="sxs-lookup"><span data-stu-id="6e405-297">The `StatusLabel` is updated to display a confirmation message and the `ReturnToDisplayInterface` is invoked, hiding the inserting interface and showing the display interface.</span></span>

<span data-ttu-id="6e405-298">Если продукты не были введены, но сообщение, которое продукты не были добавлены отображается интерфейс для вставки.</span><span class="sxs-lookup"><span data-stu-id="6e405-298">If no products were entered, the inserting interface remains displayed but the message No products were added.</span></span> <span data-ttu-id="6e405-299">Введите имена продуктов, цены единицы в текстовых полях отображается.</span><span class="sxs-lookup"><span data-stu-id="6e405-299">Please enter the product names and unit prices in the textboxes is displayed.</span></span>

<span data-ttu-id="6e405-300">Рисунок 13, 14 до 15 Показать Вставка и отображать интерфейсы в действии.</span><span class="sxs-lookup"><span data-stu-id="6e405-300">Figure s 13, 14, and 15 show the inserting and display interfaces in action.</span></span> <span data-ttu-id="6e405-301">На рис. 13 пользователь ввел значение цены единицы без соответствующего имени продукта.</span><span class="sxs-lookup"><span data-stu-id="6e405-301">In Figure 13, the user has entered a unit price value without a corresponding product name.</span></span> <span data-ttu-id="6e405-302">Рис. 14 показаны интерфейса после трех новых продуктов были успешно добавлены, а на рис. 15 показано двух продуктов, добавленный в GridView (третье — на предыдущей странице).</span><span class="sxs-lookup"><span data-stu-id="6e405-302">Figure 14 shows the display interface after three new products have been added successfully, while Figure 15 shows two of the newly added products in the GridView (the third one is on the previous page).</span></span>


<span data-ttu-id="6e405-303">[![Название продукта-это требуется при вводе цена единицы](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="6e405-303">[![A Product Name is Required When Entering a Unit Price](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span></span>

<span data-ttu-id="6e405-304">**Рис. 13**: название продукта —, необходимый при вводе цену единицы ([Просмотр полноразмерное изображение](batch-inserting-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="6e405-304">**Figure 13**: A Product Name is Required When Entering a Unit Price ([Click to view full-size image](batch-inserting-cs/_static/image39.png))</span></span>


<span data-ttu-id="6e405-305">[![Для поставщика были добавлены три новые Veggies Mayumi s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="6e405-305">[![Three New Veggies Have Been Added for the Supplier Mayumi s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span></span>

<span data-ttu-id="6e405-306">**Рис. 14**: три новых Veggies были добавлены для поставщика Mayumi s ([Просмотр полноразмерное изображение](batch-inserting-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="6e405-306">**Figure 14**: Three New Veggies Have Been Added for the Supplier Mayumi s ([Click to view full-size image](batch-inserting-cs/_static/image42.png))</span></span>


<span data-ttu-id="6e405-307">[![Новые продукты можно найти на последней странице элемента управления GridView](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="6e405-307">[![The New Products Can Be Found in the Last Page of the GridView](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span></span>

<span data-ttu-id="6e405-308">**Рис. 15**: новых продуктов можно найти на последней странице GridView ([Просмотр полноразмерное изображение](batch-inserting-cs/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="6e405-308">**Figure 15**: The New Products Can Be Found in the Last Page of the GridView ([Click to view full-size image](batch-inserting-cs/_static/image45.png))</span></span>


> [!NOTE]
> <span data-ttu-id="6e405-309">Вставка логику, используемую в этом учебнике пакета перенос операции вставки внутри области транзакции.</span><span class="sxs-lookup"><span data-stu-id="6e405-309">The batch inserting logic used in this tutorial wraps the inserts within the scope of transaction.</span></span> <span data-ttu-id="6e405-310">Чтобы проверить это, намеренно вызвать ошибки уровня базы данных.</span><span class="sxs-lookup"><span data-stu-id="6e405-310">To verify this, purposefully introduce a database-level error.</span></span> <span data-ttu-id="6e405-311">Например, вместо того чтобы назначение нового `ProductsRow` экземпляра s `CategoryID` свойство для значения, выбранного в `Categories` DropDownList, назначить его значение, например `i * 5`.</span><span class="sxs-lookup"><span data-stu-id="6e405-311">For example, rather than assigning the new `ProductsRow` instance s `CategoryID` property to the selected value in the `Categories` DropDownList, assign it to a value like `i * 5`.</span></span> <span data-ttu-id="6e405-312">Здесь `i` является индексатором цикла и содержит значения в диапазоне от 1 до 5.</span><span class="sxs-lookup"><span data-stu-id="6e405-312">Here `i` is the loop indexer and has values ranging from 1 to 5.</span></span> <span data-ttu-id="6e405-313">Таким образом, при добавлении двух или более продуктов в пакете вставки первого продукта получит допустимое `CategoryID` будет иметь значение (5), но последующие продукты `CategoryID` значения, которые не соответствуют до `CategoryID` значения в `Categories` таблицы.</span><span class="sxs-lookup"><span data-stu-id="6e405-313">Therefore, when adding two or more products in batch insert the first product will have a valid `CategoryID` value (5), but subsequent products will have `CategoryID` values that do not match up to `CategoryID` values in the `Categories` table.</span></span> <span data-ttu-id="6e405-314">В итоге получается, во время первого `INSERT` будет выполнена успешно, последующие условия, будут завершаться нарушение ограничения внешнего ключа.</span><span class="sxs-lookup"><span data-stu-id="6e405-314">The net effect is that while the first `INSERT` will succeed, subsequent ones will fail with a foreign key constraint violation.</span></span> <span data-ttu-id="6e405-315">Так как Пакетная вставка является атомарной, первый `INSERT` будет выполнен откат, возвращение базы данных в состояние перед пакетной вставки процесс начала.</span><span class="sxs-lookup"><span data-stu-id="6e405-315">Since the batch insert is atomic, the first `INSERT` will be rolled back, returning the database to its state before the batch insert process began.</span></span>


## <a name="summary"></a><span data-ttu-id="6e405-316">Сводка</span><span class="sxs-lookup"><span data-stu-id="6e405-316">Summary</span></span>

<span data-ttu-id="6e405-317">В этом и предыдущем два учебника мы создали интерфейсы, позволяющие для обновления, удаления, и вставлять пакеты данных, которые использовать поддержку транзакций, мы добавили в слое доступа к данным в [упаковки изменения базы данных в рамках транзакции](wrapping-database-modifications-within-a-transaction-cs.md) учебника.</span><span class="sxs-lookup"><span data-stu-id="6e405-317">Over this and the previous two tutorials we have created interfaces that allow for updating, deleting, and inserting batches of data, all of which used the transaction support we added to the Data Access Layer in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial.</span></span> <span data-ttu-id="6e405-318">Для некоторых сценариев, такие интерфейсы пользователя пакетной обработки значительно повысить эффективность работы конечных пользователей в результате разбивки вниз на количество щелчков, обратных передач и переключение контекста мышь клавиатуры, сохраняя целостность базовых данных.</span><span class="sxs-lookup"><span data-stu-id="6e405-318">For certain scenarios, such batch processing user interfaces greatly improve end user efficiency by cutting down on the number of clicks, postbacks, and keyboard-to-mouse context switches, while also maintaining the integrity of the underlying data.</span></span>

<span data-ttu-id="6e405-319">Этот учебник завершает внешнего вида в работе с данными в пакетном режиме.</span><span class="sxs-lookup"><span data-stu-id="6e405-319">This tutorial completes our look at working with batched data.</span></span> <span data-ttu-id="6e405-320">Следующий набор учебников более подробно рассматривается ряд сложных сценариев доступа к данным, включая использование хранимых процедур в методах s TableAdapter, Настройка параметров на уровне подключения и команды в DAL, шифрования строк подключения и многое другое!</span><span class="sxs-lookup"><span data-stu-id="6e405-320">The next set of tutorials explores a variety of advanced Data Access Layer scenarios, including using stored procedures in the TableAdapter s methods, configuring connection- and command-level settings in the DAL, encrypting connection strings, and more!</span></span>

<span data-ttu-id="6e405-321">Программирование довольны!</span><span class="sxs-lookup"><span data-stu-id="6e405-321">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="6e405-322">Об авторе</span><span class="sxs-lookup"><span data-stu-id="6e405-322">About the Author</span></span>

<span data-ttu-id="6e405-323">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="6e405-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="6e405-324">Скотт — независимый консультант, trainer и записи.</span><span class="sxs-lookup"><span data-stu-id="6e405-324">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="6e405-325">Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="6e405-325">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="6e405-326">Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="6e405-326">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="6e405-327">Благодарности</span><span class="sxs-lookup"><span data-stu-id="6e405-327">Special Thanks To</span></span>

<span data-ttu-id="6e405-328">Этот учебник ряд прошел проверку многие полезные рецензентов.</span><span class="sxs-lookup"><span data-stu-id="6e405-328">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="6e405-329">Привести рецензентов для этого учебника были – Хилтон Гизнау и S ren Алексей Lauritsen.</span><span class="sxs-lookup"><span data-stu-id="6e405-329">Lead reviewers for this tutorial were Hilton Giesenow and S ren Jacob Lauritsen.</span></span> <span data-ttu-id="6e405-330">Объясняются моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="6e405-330">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="6e405-331">Если Да, напишите мне по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="6e405-331">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="6e405-332">[Назад](batch-deleting-cs.md)
> [Вперед](wrapping-database-modifications-within-a-transaction-vb.md)</span><span class="sxs-lookup"><span data-stu-id="6e405-332">[Previous](batch-deleting-cs.md)
[Next](wrapping-database-modifications-within-a-transaction-vb.md)</span></span>
