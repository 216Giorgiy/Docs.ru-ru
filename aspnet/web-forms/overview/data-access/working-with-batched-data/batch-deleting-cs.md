---
uid: web-forms/overview/data-access/working-with-batched-data/batch-deleting-cs
title: "Удаление (C#) пакета | Документы Microsoft"
author: rick-anderson
description: "Узнайте, как удалить несколько записей базы данных в одной операции. В уровень пользовательского интерфейса мы созданы на основе расширенного GridView, созданные в более раннем tut..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/26/2007
ms.topic: article
ms.assetid: ac6916d0-a5ab-4218-9760-7ba9e72d258c
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-deleting-cs
msc.type: authoredcontent
ms.openlocfilehash: 71c4b323c2604d9e775f75272bb9565505580522
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="batch-deleting-c"></a>Пакетное удаление (C#)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить код](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_65_CS.zip) или [скачать PDF](batch-deleting-cs/_static/datatutorial65cs1.pdf)

> Узнайте, как удалить несколько записей базы данных в одной операции. В уровень пользовательского интерфейса мы созданы на основе расширенного GridView, созданные в более ранних учебника. В слое доступа к данным мы вокруг нескольких операций удаления в пределах транзакции, чтобы гарантировать, что все операции удаления успешно или откатываются все операции удаления.


## <a name="introduction"></a>Вступление

[Предыдущего учебника](batch-updating-cs.md) изучена способ создания пакета, интерфейс, с помощью полностью изменяемого элемента управления GridView для редактирования. В ситуациях, где пользователи часто изменяете много записей за один раз, интерфейс для редактирования пакета потребуется гораздо меньшее число обратных передач и мышь клавиатуры контекст коммутаторов, тем самым повышая эффективность s конечного пользователя. Аналогичным образом, этот метод полезен для страниц, где часто предоставляется пользователям удалять много записей за один раз.

Кто-то использовал online почтовый клиент уже знакомы с одним из наиболее распространенных пакета удаление интерфейсов: кнопку флажок в каждой строке в сетке с соответствующей удалить все флажки (см. рис. 1). Вместо этого учебника короток так как мы хранять сделали все жесткие работы в предыдущих учебниках создания веб-интерфейс и способ удаления последовательности записей в качестве одной атомарной операции. В [Добавление столбца GridView флажков](../enhancing-the-gridview/adding-a-gridview-column-of-checkboxes-cs.md) учебника мы создали GridView со столбцом флажки, а в [упаковки изменения базы данных в рамках транзакции](wrapping-database-modifications-within-a-transaction-cs.md) мы создали метод в учебнике уровень бизнес-ЛОГИКИ, который бы использовался транзакцию для удаления `List<T>` из `ProductID` значения. В этом учебнике будут созданы на основе и слияния наш предыдущий опыт для создания раздела рабочий пример удаления.


[![Каждая строка содержит флажок](batch-deleting-cs/_static/image1.gif)](batch-deleting-cs/_static/image1.png)

**Рис. 1**: каждая строка содержит флажок ([Просмотр полноразмерное изображение](batch-deleting-cs/_static/image2.png))


## <a name="step-1-creating-the-batch-deleting-interface"></a>Шаг 1: Создание пакета, удаление интерфейса

Так как мы уже создали удаление интерфейса в пакете [Добавление столбца GridView флажков](../enhancing-the-gridview/adding-a-gridview-column-of-checkboxes-cs.md) учебник, мы просто скопировать его в `BatchDelete.aspx` вместо создания ее с нуля. Сначала откройте `BatchDelete.aspx` страницы в `BatchData` папки и `CheckBoxField.aspx` страницы в `EnhancedGridView` папки. Из `CheckBoxField.aspx` страницы, перейдите в представление источника и скопируйте разметку между `<asp:Content>` теги, как показано на рис. 2.


[![Декларативная разметка CheckBoxField.aspx скопировать в буфер обмена](batch-deleting-cs/_static/image2.gif)](batch-deleting-cs/_static/image3.png)

**На рисунке 2**: скопируйте декларативной разметке `CheckBoxField.aspx` в буфер обмена ([Просмотр полноразмерное изображение](batch-deleting-cs/_static/image4.png))


Теперь перейдите к представлению источника в `BatchDelete.aspx` и вставьте содержимое буфера обмена в `<asp:Content>` тегов. Скопируйте и вставьте код из класса кода в `CheckBoxField.aspx.cs` для внутри класса кода программной части в `BatchDelete.aspx.cs` ( `DeleteSelectedProducts` кнопку s `Click` обработчик событий `ToggleCheckState` метода и `Click` обработчики событий для `CheckAll` и `UncheckAll` кнопки). После копирования через это содержимое `BatchDelete.aspx` класс страницы s кода должен содержать следующий код:


[!code-csharp[Main](batch-deleting-cs/samples/sample1.cs)]

После копирования через декларативная разметка и исходным кодом занять некоторое время для тестирования `BatchDelete.aspx` , просмотрев его через браузер. Вы увидите список первых десяти продуктов в элементе управления GridView, где каждая строка содержит название продукта s, категория и цена, а также флажок GridView. Должно быть три кнопки: Проверьте все, снимите флажки всех и удалить выбранные продукты. Кнопки проверьте все выбирает все флажки, пока снять все очищает все флажки. Нажав кнопку удаления выбранных продуктов отображает сообщение со списком `ProductID` значения выбранных продуктов, но не удаляет продукты.


[![Интерфейс из CheckBoxField.aspx был перемещен в BatchDeleting.aspx](batch-deleting-cs/_static/image3.gif)](batch-deleting-cs/_static/image5.png)

**Рис. 3**: интерфейс из `CheckBoxField.aspx` был перемещен в `BatchDeleting.aspx` ([Просмотр полноразмерное изображение](batch-deleting-cs/_static/image6.png))


## <a name="step-2-deleting-the-checked-products-using-transactions"></a>Шаг 2: Удаление Checked продуктов, использование транзакций

С пакетом, удаление интерфейса успешно скопированы `BatchDeleting.aspx`все, что остается только обновление кода, чтобы кнопка удаления выбранных продуктов удаляет checked продуктов с помощью `DeleteProductsWithTransaction` метод `ProductsBLL` класса. Этот метод добавлен в [упаковки изменения базы данных в рамках транзакции](wrapping-database-modifications-within-a-transaction-cs.md) учебник, принимает в качестве входных данных `List<T>` из `ProductID` значений и удаляет соответствующие `ProductID` в области действия транзакция.

`DeleteSelectedProducts` Кнопку s `Click` обработчик событий в настоящее время использует следующие `foreach` цикла для итерации по каждой строке GridView:


[!code-csharp[Main](batch-deleting-cs/samples/sample2.cs)]

Для каждой строки `ProductSelector` программно ссылка на элемент управления CheckBox Web. Если он установлен, строка s `ProductID` извлекается из `DataKeys` коллекции и `DeleteResults` метки s `Text` свойство обновляется и включает сообщение о том, что строки был выбран для удаления.

Приведенный выше код не удаляет какие-либо записи как вызов `ProductsBLL` класса s `Delete` закомментирован метод. Эта логика delete бы применяться, код, удаление продуктов, но не в атомарной операции. Иными словами Если первый несколько удалений в последовательности успешно, но поздней не удалось (возможно, из-за нарушения ограничения внешнего ключа), будет создано исключение, но эти продукты уже удален останется в удаленных.

Чтобы обеспечить атомарность, нам нужно вместо этого использовать `ProductsBLL` класса s `DeleteProductsWithTransaction` метод. Так как этот метод принимает список `ProductID` значения, необходимо сначала скомпилировать этот список из сетки и передайте его в качестве параметра. Сначала создается экземпляр `List<T>` типа `int`. В пределах `foreach` цикла, то необходимо добавить выбранные продукты `ProductID` значения к этому `List<T>`. После цикла это `List<T>` должны быть переданы `ProductsBLL` класса s `DeleteProductsWithTransaction` метод. Обновление `DeleteSelectedProducts` кнопку s `Click` обработчик событий следующим кодом:


[!code-csharp[Main](batch-deleting-cs/samples/sample3.cs)]

Обновленный код создает `List<T>` типа `int` (`productIDsToDelete`) и заполняет его `ProductID` значения для удаления. После `foreach` цикла, если флажок установлен, хотя бы один продукт `ProductsBLL` класса s `DeleteProductsWithTransaction` вызывается метод и передать этот список. `DeleteResults` Метка отображается также и данных привязывается к GridView (благодаря чему недавно удаленных записей больше не отображаются как строки в сетке).

На рисунке 4 показаны GridView, после несколько строк были выбраны для удаления. Рис. 5 показан экран сразу же после нажатия кнопки Удалить выбранных продуктов. Обратите внимание, что на рис. 5 `ProductID` отображаются значения удаленных записей в метке под GridView и эти строки больше не находятся в GridView.


[![Выбранные продукты будут удалены.](batch-deleting-cs/_static/image4.gif)](batch-deleting-cs/_static/image7.png)

**Рис. 4**: выбранные продукты будут удалены ([Просмотр полноразмерное изображение](batch-deleting-cs/_static/image8.png))


[![Значения удалены ProductID продуктов, перечисленные под GridView](batch-deleting-cs/_static/image5.gif)](batch-deleting-cs/_static/image9.png)

**Рис. 5**: удалить продукты `ProductID` значения, перечисленные под GridView ([Просмотр полноразмерное изображение](batch-deleting-cs/_static/image10.png))


> [!NOTE]
> Для тестирования `DeleteProductsWithTransaction` атомарность метод s, вручную добавьте запись для продукта в `Order Details` таблицы, а затем попытаться удалить этот продукт (вместе с другими разделами). При попытке удалить продукт с связанного заказа, но Обратите внимание на то, как другие удаления выбранных продуктов выполняется откат, вы получите нарушение ограничения внешнего ключа.


## <a name="summary"></a>Сводка

Создание пакета, удаление интерфейса включает в себя добавление GridView со столбцом флажки и кнопки веб-элемента управления, если он выбран, приведет к удалению всех выбранных строк в одной атомарной операции. В этом учебнике мы созданных такой интерфейс комбинирования работа, выполненная в двух предыдущих занятий, [Добавление столбца GridView флажков](../enhancing-the-gridview/adding-a-gridview-column-of-checkboxes-cs.md) и [упаковки изменения базы данных в рамках транзакции](wrapping-database-modifications-within-a-transaction-cs.md). В первом руководстве мы создали GridView со столбцом флажки и во втором мы реализации метода в МЕТОДА, при передаче `List<T>` из `ProductID` значения, удалить их все в рамках транзакции.

В следующем уроке мы создадим интерфейс для выполнения пакетной вставки.

Программирование довольны!

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года. Скотт — независимый консультант, trainer и записи. Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [http://ScottOnWriting.NET](http://ScottOnWriting.NET).

## <a name="special-thanks-to"></a>Благодарности

Этот учебник ряд прошел проверку многие полезные рецензентов. Основными редакторами этого учебника были – Хилтон Гизнау и Мерфи Тереза д. Объясняются моих последующих статей для MSDN? Если Да, напишите мне по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)

>[!div class="step-by-step"]
[Назад](batch-updating-cs.md)
[Вперед](batch-inserting-cs.md)
