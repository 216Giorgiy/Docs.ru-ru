---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/updating-the-tableadapter-to-use-joins-cs
title: Обновление адаптера таблицы для использования соединения (C#) | Документы Microsoft
author: rick-anderson
description: При работе с базой данных вполне запрашивать данные, распределены по нескольким таблицам. Для получения данных из двух различных таблиц можно использовать либо...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/18/2007
ms.topic: article
ms.assetid: 675531a7-cb54-4dd6-89ac-2636e4c285a5
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/updating-the-tableadapter-to-use-joins-cs
msc.type: authoredcontent
ms.openlocfilehash: be74be8865b021be1f2e2d8181d2eb42cb74eb75
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="updating-the-tableadapter-to-use-joins-c"></a>Обновление адаптера таблицы для использования соединения (C#)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить код](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_69_CS.zip) или [скачать PDF](updating-the-tableadapter-to-use-joins-cs/_static/datatutorial69cs1.pdf)

> При работе с базой данных вполне запрашивать данные, распределены по нескольким таблицам. Для получения данных из двух различных таблиц можно использовать операцию СОЕДИНЕНИЯ или коррелированные вложенные запросы. В этом учебнике мы сравнить коррелированные вложенные запросы и синтаксисе СОЕДИНЕНИЯ перед рассмотрением Создание адаптера таблицы, содержащий соединение в его основном запросе.


## <a name="introduction"></a>Вступление

В реляционных базах данных данные, которые мы будем рады получить при работе с часто распределены по нескольким таблицам. Например при отображении сведения о продукте мы скорее всего требуется перечислить каждый соответствующую категорию продукта s и s имен поставщиков. `Products` Таблица имеет `CategoryID` и `SupplierID` значения, но фактические имена категорию и поставщика, в `Categories` и `Suppliers` таблицы, соответственно.

Чтобы получить информацию из другого, связанные таблицы, мы можем использовать либо *коррелированных запросов* или `JOIN` *s*. Коррелированные вложенные запросы вложена в `SELECT` запрос, который ссылается на столбцы внешнего запроса. Например, в [Создание слой доступа к данным](../introduction/creating-a-data-access-layer-cs.md) мы использовали двух коррелированных запросов осуществляется в учебнике `ProductsTableAdapter` s основной запрос для возврата имен категорию и поставщика, для каждого продукта. Объект `JOIN` — конструкция SQL, которая объединяет связанные строки из двух различных таблиц. Мы использовали `JOIN` в [запрос данных с помощью элемента управления SqlDataSource](../accessing-the-database-directly-from-an-aspnet-page/querying-data-with-the-sqldatasource-control-cs.md) учебника, чтобы отобразить сведения о категории вместе с каждого продукта.

Причина, мы abstained с помощью `JOIN` s с помощью адаптеров таблиц — из-за ограничений в мастере адаптера таблицы s автоматически создает соответствующий `INSERT`, `UPDATE`, и `DELETE` инструкции. В частности Если основной запрос адаптера таблицы s содержит любые `JOIN` s, адаптер таблицы не может автоматически создавать специализированные инструкции SQL или хранимые процедуры для его `InsertCommand`, `UpdateCommand`, и `DeleteCommand` свойства.

В этом учебнике мы кратко сравнивает и контрастность коррелированных запросов и `JOIN` s перед изучением Создание адаптера таблицы, которая включает `JOIN` s в его основном запросе.

## <a name="comparing-and-contrasting-correlated-subqueries-andjoin-s"></a>Сравнивает и противопоставляет коррелированных запросов и`JOIN` s

Помните, что `ProductsTableAdapter` созданы в первом учебнике `Northwind` набор данных использует коррелированные вложенные запросы для возврата каждого s соответствующего категорию и поставщика название продукта. `ProductsTableAdapter` s основного запроса приведен ниже.


[!code-sql[Main](updating-the-tableadapter-to-use-joins-cs/samples/sample1.sql)]

Двух коррелированных запросов - `(SELECT CategoryName FROM Categories WHERE Categories.CategoryID = Products.CategoryID)` и `(SELECT CompanyName FROM Suppliers WHERE Suppliers.SupplierID = Products.SupplierID)` -являются `SELECT` запросы, которые возвращают одиночное значение каждого продукта в качестве дополнительного столбца во внешнем `SELECT` инструкцию s список столбцов.

Кроме того `JOIN` можно использовать для возврата каждого имени поставщика и категории продукта s. Следующий запрос возвращает такие же выходные данные, что и выше, но использует `JOIN` s вместо вложенных запросов:


[!code-sql[Main](updating-the-tableadapter-to-use-joins-cs/samples/sample2.sql)]

Объект `JOIN` объединяет записи из одной таблицы с записями из другой таблицы, в зависимости от некоторых условий. В указанном выше запросе, например `LEFT JOIN Categories ON Categories.CategoryID = Products.CategoryID` указывает, что SQL Server для слияния каждой записи продукта с категорией запись которого `CategoryID` значение соответствует продукту s `CategoryID` значение. Результаты слияния позволяет работать с в соответствующие поля категории для каждого продукта (например, `CategoryName`).

> [!NOTE]
> `JOIN` s обычно используются при запросе данных из реляционных баз данных. Если вы не знакомы с `JOIN` синтаксиса или нужно немного подтянуть свои навыки по его использованию, d рекомендуется [SQL Join учебника](http://www.w3schools.com/sql/sql_join.asp) в [школы W3](http://www.w3schools.com/). Также следует ознакомиться, [ `JOIN` основы](https://msdn.microsoft.com/library/ms191517.aspx) и [запросах](https://msdn.microsoft.com/library/ms189575.aspx) разделы [электронной документации по SQL](https://msdn.microsoft.com/library/ms130214.aspx).


Поскольку `JOIN` s и коррелированные вложенные запросы могут использоваться для получения взаимосвязанных данных из других таблиц, многие разработчики остаются затруднения, их заголовки и узнать, какие подходы использовать. Все специалистами SQL я хранить общались сказать примерно то же самое, что он t важны с точки как SQL Server будет создавать планы выполнения примерно идентичными. Его советам, будет использовать метод, при котором вы и ваша команда наиболее удобен. Заслуживает, отметить, что после imparting это требование экспертам немедленно express их предпочтения `JOIN` s через коррелированные вложенные запросы.

При построении слой доступа к данным с помощью типизированных наборов данных, средства подходят использование вложенных запросов. В частности, мастер TableAdapter s не автоматически создаст соответствующий `INSERT`, `UPDATE`, и `DELETE` инструкции, если основной запрос содержит любые `JOIN` s, но автоматически создаст эти инструкции, когда коррелированных вложенных запросов используются.

Чтобы изучить этот недостаток, создание временных типизированного набора данных в `~/App_Code/DAL` папки. В процессе работы мастера настройки адаптера таблицы выберите использование нерегламентированных инструкций SQL и введите следующую `SELECT` запроса (см. рис. 1):


[!code-sql[Main](updating-the-tableadapter-to-use-joins-cs/samples/sample3.sql)]


[![Введите основной запрос, который содержит соединения](updating-the-tableadapter-to-use-joins-cs/_static/image2.png)](updating-the-tableadapter-to-use-joins-cs/_static/image1.png)

**Рис. 1**: Введите запрос Main, который содержит `JOIN` s ([Просмотр полноразмерное изображение](updating-the-tableadapter-to-use-joins-cs/_static/image3.png))


По умолчанию, автоматически создаст TableAdapter `INSERT`, `UPDATE`, и `DELETE` инструкций на основе основного запроса. При нажатии кнопки "Дополнительно" вы увидите, что эта функция включена. Несмотря на этот параметр адаптера таблицы не смогут создавать `INSERT`, `UPDATE`, и `DELETE` инструкции, так как содержит основной запрос `JOIN`.


![Введите основной запрос, который содержит соединения](updating-the-tableadapter-to-use-joins-cs/_static/image4.png)

**На рисунке 2**: введите основной запрос, который содержит `JOIN` s


Нажмите кнопку Готово, чтобы завершить работу мастера. На этом этапе s вашего набора данных конструктор будет включать для каждого из полей, возвращаемых в одном адаптере таблицы с объект DataTable со столбцами `SELECT` запроса s список столбцов. Сюда входят `CategoryName` и `SupplierName`, как показано на рис. 3.


![Таблицы данных содержит столбец для каждого поля, возвращенные в списке столбцов](updating-the-tableadapter-to-use-joins-cs/_static/image5.png)

**Рис. 3**: DataTable содержит столбец для каждого поля, возвращаемого в списке столбцов


Хотя DataTable имеет соответствующие столбцы, адаптер таблицы не имеет значения для его `InsertCommand`, `UpdateCommand`, и `DeleteCommand` свойства. Чтобы проверить это, щелкните адаптера таблицы в конструкторе, а затем перейдите в окно «Свойства». Что вы увидите, что `InsertCommand`, `UpdateCommand`, и `DeleteCommand` задано значение (нет).


[![Свойства DeleteCommand InsertCommand, UpdateCommand и устанавливаются (нет)](updating-the-tableadapter-to-use-joins-cs/_static/image7.png)](updating-the-tableadapter-to-use-joins-cs/_static/image6.png)

**Рис. 4**: `InsertCommand`, `UpdateCommand`, и `DeleteCommand` задано значение (нет) ([Просмотр полноразмерное изображение](updating-the-tableadapter-to-use-joins-cs/_static/image8.png))


Чтобы устранить этот недостаток, мы можно вручную указать инструкций SQL и параметры для `InsertCommand`, `UpdateCommand`, и `DeleteCommand` свойства с помощью окна «Свойства». Кроме того, мы можно начать с настройки адаптера таблицы s основной запрос для *не* должно содержать `JOIN` s. Это позволит `INSERT`, `UPDATE`, и `DELETE` инструкций создаваться автоматически для нас. По завершении работы мастера мы может затем вручную обновить TableAdapter s `SelectCommand` из окна «Свойства», чтобы он включал `JOIN` синтаксиса.

Хотя такой подход работает, это очень значительно усложняло работу при использовании нерегламентированные запросы SQL, так как каждый раз s основного запроса адаптера таблицы, повторно настроить в мастере, автоматически сгенерированный `INSERT`, `UPDATE`, и `DELETE` инструкций создаются повторно. Это означает, что все пользовательские настройки, мы сделали более поздней версии будут потеряны, если мы правой кнопкой мыши в TableAdapter, выберите в контекстном меню Настройка и мастер завершен.

Хрупкость TableAdapter s создан `INSERT`, `UPDATE`, и `DELETE` инструкций, к счастью, ограничиваясь нерегламентированных инструкций SQL. Если TableAdapter использует хранимые процедуры, вы можете настроить `SelectCommand`, `InsertCommand`, `UpdateCommand`, или `DeleteCommand` хранимые процедуры и повторно запустите мастер настройки адаптера таблицы без необходимости пугайтесь, будут ли хранимые процедуры изменить.

Посредством следующего несколько шагов, мы создадим TableAdapter, изначально использует основной запрос, который опускает любой `JOIN` s, чтобы соответствующий вставки, обновления и удаления хранимых процедур будут созданы автоматически. Затем мы обновим `SelectCommand` таким образом, использующий `JOIN` , возвращающий дополнительные столбцы из связанных таблиц. Наконец мы создать соответствующий класс уровня бизнес-логики и демонстрируют использование адаптера таблицы в веб-страницу ASP.NET.

## <a name="step-1-creating-the-tableadapter-using-a-simplified-main-query"></a>Шаг 1: Создание с помощью упрощенного основного запроса адаптера таблицы

В этом учебнике мы добавим адаптера таблицы и строго типизированный объект DataTable для `Employees` в таблицу `NorthwindWithSprocs` набора данных. `Employees` Таблица содержит `ReportsTo` поле, которое указано `EmployeeID` менеджера сотрудника s. Например, сотрудник имеет Ясеневой `ReportTo` значение 5, которое является `EmployeeID` из Андрей Иванов. Следовательно Anne отчетов Стивен ее Менеджер. А также отчеты каждому сотруднику s `ReportsTo` значение, может также потребоваться получить имя руководителя. Это можно сделать с помощью `JOIN`. Однако с помощью `JOIN` при первоначальном создании TableAdapter исключает мастер автоматически формировать соответствующие инструкции insert, update и delete возможности. Таким образом, мы начнем с создания адаптера таблицы, чьи основной запрос не содержит `JOIN` s. Затем, в шаге 2, корпорация Майкрософт будет обновлять основной запрос хранимой процедуры, чтобы получить имя диспетчера s через `JOIN`.

Сначала откройте `NorthwindWithSprocs` набора данных в `~/App_Code/DAL` папки. Щелкните правой кнопкой мыши в конструкторе, выберите в контекстном меню пункт Добавить и выберите пункт меню адаптера таблицы. Будет запущен мастер настройки адаптера таблицы. Как показано на рис. 5, с помощью мастера создать новые хранимые процедуры и нажмите кнопку Далее. О создании новых хранимых процедур с помощью мастера TableAdapter s, обратитесь к [создание новых хранимых процедур для типизированного набора данных s адаптеры таблиц TableAdapter](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) учебника.


[![Выберите создать новые хранимые процедуры, параметр](updating-the-tableadapter-to-use-joins-cs/_static/image10.png)](updating-the-tableadapter-to-use-joins-cs/_static/image9.png)

**Рис. 5**: выберите создания новых хранимых процедур параметр ([Просмотр полноразмерное изображение](updating-the-tableadapter-to-use-joins-cs/_static/image11.png))


Используйте следующие `SELECT` оператора для главного запроса адаптера таблицы s:


[!code-sql[Main](updating-the-tableadapter-to-use-joins-cs/samples/sample4.sql)]

Поскольку этот запрос не содержит `JOIN` s, адаптера таблицы мастер автоматически создаст хранимые процедуры с соответствующими `INSERT`, `UPDATE`, и `DELETE` инструкции, а также хранимой процедуры для выполнения основных запрос.

Следующий шаг позволяет нам имя TableAdapter s хранимой процедуры. Используйте имена `Employees_Select`, `Employees_Insert`, `Employees_Update`, и `Employees_Delete`, как показано на рис. 6.


[![Имя TableAdapter s хранимой процедуры](updating-the-tableadapter-to-use-joins-cs/_static/image13.png)](updating-the-tableadapter-to-use-joins-cs/_static/image12.png)

**Рис. 6**: имя адаптера таблицы хранимых процедур s ([Просмотр полноразмерное изображение](updating-the-tableadapter-to-use-joins-cs/_static/image14.png))


Последний шаг предлагает нам имя s методы адаптера таблицы. Используйте `Fill` и `GetEmployees` как имена методов. Кроме того оставить создавать методы для отправки обновлений непосредственно в базу данных (GenerateDBDirectMethods) флажок.


[![Имя TableAdapter s методов заливки и GetEmployees](updating-the-tableadapter-to-use-joins-cs/_static/image16.png)](updating-the-tableadapter-to-use-joins-cs/_static/image15.png)

**Рис. 7**: имя s адаптера таблицы методы `Fill` и `GetEmployees` ([Просмотр полноразмерное изображение](updating-the-tableadapter-to-use-joins-cs/_static/image17.png))


По завершении работы мастера занять некоторое время для проверки хранимых процедур в базе данных. Должно появиться четыре новых: `Employees_Select`, `Employees_Insert`, `Employees_Update`, и `Employees_Delete`. Затем проверьте `EmployeesDataTable` и `EmployeesTableAdapter` только что создали. Таблицы данных содержит столбец для каждого поля, возвращенной основным запросом. Щелкните адаптер таблицы, а затем перейдите в окно «Свойства». Что вы увидите, что `InsertCommand`, `UpdateCommand`, и `DeleteCommand` свойства настроены правильно для вызова соответствующих хранимых процедур.


[![Адаптер таблицы включает в себя инструкции Insert, Update и удалить возможности](updating-the-tableadapter-to-use-joins-cs/_static/image19.png)](updating-the-tableadapter-to-use-joins-cs/_static/image18.png)

**Рис. 8**: TableAdapter включает Insert, Update и удалить возможности ([Просмотр полноразмерное изображение](updating-the-tableadapter-to-use-joins-cs/_static/image20.png))


С помощью вставки, обновления и удаления, хранимые процедуры, автоматически созданные и `InsertCommand`, `UpdateCommand`, и `DeleteCommand` правильно настраивать свойства, можно приступать к настройке `SelectCommand` s хранимые процедуры возвращают Дополнительные сведения о диспетчере каждого сотрудника s. В частности, необходимо обновить `Employees_Select` хранимой процедуры для использования `JOIN` и вернуть диспетчера s `FirstName` и `LastName` значения. После обновления хранимой процедуры, необходимо обновить объект DataTable, таким образом, чтобы он включает следующие дополнительные столбцы. Мы исследуем в этом выпуске эти две задачи на шагах 2 и 3.

## <a name="step-2-customizing-the-stored-procedure-to-include-ajoin"></a>Шаг 2: Настройка хранимой процедуры для включения`JOIN`

Запуск, перейдите в обозреватель серверов, детализация в папке Stored Procedures s базы данных Northwind и открыв `Employees_Select` хранимой процедуры. Если эта хранимая процедура не отображается, щелкните правой кнопкой мыши папку хранимые процедуры и нажмите кнопку обновления. Обновить хранимую процедуру, чтобы он использовал `LEFT JOIN` для возврата manager s сначала имени и фамилии:


[!code-sql[Main](updating-the-tableadapter-to-use-joins-cs/samples/sample5.sql)]

После обновления `SELECT` инструкции, сохранить эти изменения, перейдите в меню «файл» и выбрав команду сохранения `Employees_Select`. Кроме того можно щелкните значок «сохранить» на панели инструментов или нажмите сочетание клавиш Ctrl + S. После сохранения изменений, щелкните правой кнопкой мыши `Employees_Select` хранимую процедуру в обозревателе серверов и выберите команду выполнить. Это будет запустите хранимую процедуру и показать его результаты в окне вывода (см. рис. 9).


[![Результаты хранимой процедуры отображаются в окне вывода](updating-the-tableadapter-to-use-joins-cs/_static/image22.png)](updating-the-tableadapter-to-use-joins-cs/_static/image21.png)

**Рис. 9**: результаты хранимой процедуры отображаются в окне вывода ([Просмотр полноразмерное изображение](updating-the-tableadapter-to-use-joins-cs/_static/image23.png))


## <a name="step-3-updating-the-datatable-s-columns"></a>Шаг 3: Обновление столбцов s DataTable

На этом этапе `Employees_Select` хранимая процедура возвращает `ManagerFirstName` и `ManagerLastName` значения, но `EmployeesDataTable` отсутствует этих столбцов. Эти отсутствующие столбцы могут быть добавлены в таблицу DataTable в одном из двух способов:

- **Вручную** — щелкните правой кнопкой мыши в таблице в конструкторе наборов данных и из меню "Добавить", выберите столбец. Можно затем имя столбца и задать его свойства соответствующим образом.
- **Автоматически** -мастера настройки адаптера таблицы будет обновлять столбцы s DataTable для отражения поля, возвращаемые `SelectCommand` хранимой процедуры. При использовании нерегламентированных инструкций SQL, мастер также приведет к удалению `InsertCommand`, `UpdateCommand`, и `DeleteCommand` свойства с момента `SelectCommand` теперь содержит `JOIN`. Но при использовании хранимых процедур, эти свойства команды останутся неизменными.

Мы изучили Ручное добавление столбцов таблицы данных в предыдущих занятий, включая [главный/Detail, с помощью маркированного списка из главного записей с DataList сведения](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) и [передачи файлов](../working-with-binary-files/uploading-files-cs.md), и мы и сделаем Рассмотрим этот процесс повторно более подробно в обучении Далее. В этом учебнике однако позволяет s автоматического подход через мастер настройки адаптера таблицы.

Запустите, щелкнув правой кнопкой мыши `EmployeesTableAdapter` и выбрав пункт "Настройка" в контекстном меню. Откроется окно мастера настройки адаптера таблицы, в котором перечислены хранимые процедуры, используемые для выбора, вставки, обновления и удаления, вместе с их возвращаемые значения и параметры (если таковые имеются). На рисунке 10 показано этот мастер. Здесь мы видим, `Employees_Select` хранимая процедура возвращает сейчас `ManagerFirstName` и `ManagerLastName` поля.


[![Мастер отображает список обновленных столбцов для Employees_Select хранимой процедуры](updating-the-tableadapter-to-use-joins-cs/_static/image25.png)](updating-the-tableadapter-to-use-joins-cs/_static/image24.png)

**Рис. 10**: В мастере отображается список столбцов обновлен для `Employees_Select` хранимой процедуры ([Просмотр полноразмерное изображение](updating-the-tableadapter-to-use-joins-cs/_static/image26.png))


Завершите работу мастера, нажав кнопку Готово. При возвращении в конструкторе наборов данных `EmployeesDataTable` включает два дополнительных столбца: `ManagerFirstName` и `ManagerLastName`.


[![EmployeesDataTable содержит два новых столбца](updating-the-tableadapter-to-use-joins-cs/_static/image28.png)](updating-the-tableadapter-to-use-joins-cs/_static/image27.png)

**Рис. 11**: `EmployeesDataTable` содержит два новых столбца ([Просмотр полноразмерное изображение](updating-the-tableadapter-to-use-joins-cs/_static/image29.png))


Для иллюстрации, обновленный `Employees_Select` действует хранимой процедуры и что вставки, обновления и удаления возможностей адаптера таблицы все еще работают, позволяя создать веб-страницу, которая позволяет пользователям просматривать и удалять сотрудников s. Перед тем как создать такой страницы, тем не менее, необходимо сначала создать новый класс в бизнес-логики для работы с сотрудниками из `NorthwindWithSprocs` набора данных. На шаге 4 мы создадим `EmployeesBLLWithSprocs` класса. На шаге 5 мы будем использовать этот класс со страницы ASP.NET.

## <a name="step-4-implementing-the-business-logic-layer"></a>Шаг 4: Реализация уровня бизнес-логики

Создать новый файл класса в `~/App_Code/BLL` папку с именем `EmployeesBLLWithSprocs.cs`. Этот класс имитирует семантика существующих `EmployeesBLL` класса, только этот новый один обеспечивает меньшее число методов и использует `NorthwindWithSprocs` набора данных (вместо `Northwind` набора данных). Добавьте следующий код в класс `EmployeesBLLWithSprocs`.


[!code-csharp[Main](updating-the-tableadapter-to-use-joins-cs/samples/sample6.cs)]

`EmployeesBLLWithSprocs` Класса s `Adapter` свойство возвращает экземпляр `NorthwindWithSprocs` DataSet s `EmployeesTableAdapter`. Это значение используется класс s `GetEmployees` и `DeleteEmployee` методы. `GetEmployees` Вызовы метода `EmployeesTableAdapter` соответствующий s `GetEmployees` метод, который вызывает `Employees_Select` хранимой процедуры и заполняет его результаты в `EmployeeDataTable`. `DeleteEmployee` Аналогичным образом вызывает метод `EmployeesTableAdapter` s `Delete` метод, который вызывает `Employees_Delete` хранимой процедуры.

## <a name="step-5-working-with-the-data-in-the-presentation-layer"></a>Шаг 5: Работа с данными на уровне представления данных

С `EmployeesBLLWithSprocs` класс завершения мы готов для работы с данными о сотрудниках по странице ASP.NET. Откройте `JOINs.aspx` страницы в `AdvancedDAL` папки и перетащите элемент управления GridView с панели элементов в конструктор параметр его `ID` свойства `Employees`. Далее смарт-теге s GridView, сетку привязать новый элемент управления ObjectDataSource `EmployeesDataSource`.

Настройка ObjectDataSource для использования `EmployeesBLLWithSprocs` класса и убедитесь, что на вкладках SELECT и DELETE `GetEmployees` и `DeleteEmployee` методы выбираются из раскрывающихся списков. Нажмите кнопку Готово для завершения настройки ObjectDataSource s.


[![Настройка ObjectDataSource с помощью класса EmployeesBLLWithSprocs](updating-the-tableadapter-to-use-joins-cs/_static/image31.png)](updating-the-tableadapter-to-use-joins-cs/_static/image30.png)

**Рис. 12**: Настройка ObjectDataSource для использования `EmployeesBLLWithSprocs` класса ([Просмотр полноразмерное изображение](updating-the-tableadapter-to-use-joins-cs/_static/image32.png))


[![У использования ObjectDataSource GetEmployees и методы DeleteEmployee](updating-the-tableadapter-to-use-joins-cs/_static/image34.png)](updating-the-tableadapter-to-use-joins-cs/_static/image33.png)

**Рис. 13**: для использования ObjectDataSource `GetEmployees` и `DeleteEmployee` методы ([Просмотр полноразмерное изображение](updating-the-tableadapter-to-use-joins-cs/_static/image35.png))


Visual Studio добавит поле BoundField GridView для каждого из `EmployeesDataTable` s столбцов. Удалите все эти стояли, за исключением `Title`, `LastName`, `FirstName`, `ManagerFirstName`, и `ManagerLastName` и переименуйте `HeaderText` свойства для последних четырех стояли Фамилия, имя, имя диспетчера s, и Диспетчер s фамилии, соответственно.

Чтобы разрешить пользователям удалять сотрудников на этой странице, необходимо сделать две вещи. Во-первых дайте указание GridView для обеспечения возможности удаления, установив параметр Разрешить удаление из его смарт-тег. Во-вторых, измените ObjectDataSource s `OldValuesParameterFormatString` свойство из значения установлено мастером ObjectDataSource (`original_{0}`) к значению по умолчанию (`{0}`). После внесения этих изменений, к GridView и ObjectDataSource s должна выглядеть следующим образом:


[!code-aspx[Main](updating-the-tableadapter-to-use-joins-cs/samples/sample7.aspx)]

Проверить страницу посетив через браузер. Как показано на рис. 14, на странице будут перечислены каждого сотрудника и вводил s имя диспетчера (если они есть).


[![СОЕДИНЕНИЕ в Employees_Select хранимая процедура возвращает имя диспетчера s](updating-the-tableadapter-to-use-joins-cs/_static/image37.png)](updating-the-tableadapter-to-use-joins-cs/_static/image36.png)

**Рис. 14**: `JOIN` в `Employees_Select` хранимая процедура возвращает имя диспетчера ([Просмотр полноразмерное изображение](updating-the-tableadapter-to-use-joins-cs/_static/image38.png))


Кнопка удаления запускает удаление рабочего процесса, завершающийся выполнения `Employees_Delete` хранимой процедуры. Однако попытка `DELETE` инструкции в хранимой процедуре завершается неудачно из-за нарушения ограничения внешнего ключа (см. рис. 15). В частности, каждый сотрудник имеет одну или несколько записей `Orders` таблицы, вызывает сбой удаления.


[![Удаление сотрудник, имеющий соответствующие заказы результаты в нарушение ограничения внешнего ключа](updating-the-tableadapter-to-use-joins-cs/_static/image40.png)](updating-the-tableadapter-to-use-joins-cs/_static/image39.png)

**Рис. 15**: удаление сотрудник, имеющий соответствующие заказы результаты в нарушение ограничения внешнего ключа ([Просмотр полноразмерное изображение](updating-the-tableadapter-to-use-joins-cs/_static/image41.png))


Чтобы разрешить сотрудника удаленные вы может:

- Ограничение внешнего ключа для каскадной операции удаления, обновления
- Вручную удалите записи из `Orders` таблицы для сотрудников, которые требуется удалить, или
- Обновление `Employees_Delete` хранимую процедуру, чтобы сначала удалить связанные записи из `Orders` таблицы перед удалением `Employees` записи. Мы рассмотрели этот прием в [существующих хранимых процедур для типизированного набора данных s адаптеры таблиц TableAdapter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) учебника.

Я это поле оставить в качестве упражнения для модуля чтения.

## <a name="summary"></a>Сводка

При работе с реляционными базами данных, обычно для запросов получить данные из нескольких связанных таблиц. Зависимые вложенные запросы и `JOIN` предоставляет два различных способа для доступа к данным из связанных таблиц в запросе. В предыдущих уроках мы внесли чаще всего использовать коррелированные вложенные запросы, так как адаптер таблицы не может автоматически создавать `INSERT`, `UPDATE`, и `DELETE` инструкций для запросов к `JOIN` s. Хотя эти значения можно задать вручную, при использовании нерегламентированных инструкций SQL будут перезаписаны все настройки после завершения мастера настройки адаптера таблицы.

К счастью адаптеры таблиц, созданных с помощью хранимых процедур не приводит к снижению же хрупкость как триггеры, созданные с помощью нерегламентированных инструкций SQL. Таким образом, невозможно создать адаптер которого основной запрос использует `JOIN` при использовании хранимых процедур. В этом учебнике мы узнали, как создать такой адаптер. Мы начали с помощью `JOIN`-меньше `SELECT` запросить основного запроса адаптера таблицы s, чтобы соответствующий вставки, обновления и удаления хранимых процедур будет создана автоматически. TableAdapter s начальной после завершения настройки, усилить `SelectCommand` хранимой процедуры для использования `JOIN` и повторного запуска мастера настройки адаптера таблицы для обновления `EmployeesDataTable` s столбцов.

Повторный запуск мастера настройки адаптера таблицы автоматически обновляется `EmployeesDataTable` столбцы для отображения поля данных, возвращенных `Employees_Select` хранимой процедуры. Кроме того может добавлена эти столбцы вручную в DataTable. Мы рассмотрим Ручное добавление столбцов в таблицу DataTable в следующем уроке.

Программирование довольны!

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года. Скотт — независимый консультант, trainer и записи. Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).

## <a name="special-thanks-to"></a>Благодарности

Этот учебник ряд прошел проверку многие полезные рецензентов. Основными редакторами этого учебника были Хилтон Geisenow, Дэвид Suru и Мерфи Тереза д. Объясняются моих последующих статей для MSDN? Если Да, напишите мне по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)
> [Вперед](adding-additional-datatable-columns-cs.md)
