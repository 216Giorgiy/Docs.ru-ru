---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/configuring-the-data-access-layer-s-connection-and-command-level-settings-vb
title: Настройка параметров подключения и команды уровень уровня доступа к данным (Visual Basic) | Документы Microsoft
author: rick-anderson
description: Адаптеры таблиц TableAdapter внутри типизированного набора данных автоматически выполняет подключение к базе данных, выполнения команд и Заполнение DataTable с результатами...
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/03/2007
ms.topic: article
ms.assetid: d57dfa2b-d627-45cb-b5b1-abbf3159d770
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/configuring-the-data-access-layer-s-connection-and-command-level-settings-vb
msc.type: authoredcontent
ms.openlocfilehash: b73c6113e84e290025e5835781fa2f85587289b1
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="configuring-the-data-access-layers-connection--and-command-level-settings-vb"></a>Настройка параметров подключения и команды уровень уровня доступа к данным (Visual Basic)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить код](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_72_VB.zip) или [скачать PDF](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/datatutorial72vb1.pdf)

> Адаптеры таблиц TableAdapter внутри типизированного набора данных автоматически выполняет подключение к базе данных, выполнения команд и Заполнение DataTable с результатами. Бывают ситуации, однако если требуется выполнять эти сведения о себе, а в этом учебнике мы изучения доступа к параметры подключения и команды уровень базы данных в адаптер таблицы.


## <a name="introduction"></a>Вступление

На протяжении ряда учебника мы использовали типизированные наборы данных для реализации уровня доступа к данным и бизнес-объектов нашей многоуровневой архитектуры. Как было сказано в [первом учебнике](../introduction/creating-a-data-access-layer-vb.md), s типизированного набора данных, таблицы данных служат в качестве репозитория данных, тогда как TableAdapters выступать в качестве оболочки для взаимодействия с базой данных для извлечения и изменения базовых данных. Адаптеры таблиц инкапсуляции сложности, применяемыми при работе с базой данных и избавляет от необходимости писать код для подключения к базе данных, выполнять команду или заполнения результаты в таблицу данных.

Бывают случаи, тем не менее, когда необходимо burrow в особенностях TableAdapter и написать код, который работает непосредственно с объектами ADO.NET. В [упаковки изменения базы данных в рамках транзакции](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) учебник, например, мы добавили методы адаптера таблицы для начала, фиксации и отката транзакций в ADO.NET. Эти методы используются внутренние, созданные вручную `SqlTransaction` объект, который был назначен TableAdapter s `SqlCommand` объектов.

В этом учебнике мы рассмотрим, как получить доступ к параметрам уровне соединений и команд базы данных в адаптер таблицы. В частности, мы будем добавлять функциональные возможности для `ProductsTableAdapter` , обеспечивает доступ к базовой строки подключения и параметры времени ожидания команды.

## <a name="working-with-data-using-adonet"></a>Работа с данными с помощью ADO.NET

Microsoft .NET Framework содержит множество классов, предназначенных специально для работы с данными. Эти классы, найденных в [ `System.Data` имен](https://msdn.microsoft.com/library/system.data.aspx), называются *ADO.NET* классы. Некоторые классы в рамках ADO.NET, привязаны к конкретной *поставщик данных*. Поставщик данных можно считать канал связи, позволяющее сведения для передачи между классами ADO.NET и базового хранилища данных. Нет обобщенный поставщиков, например OleDb и ODBC, а также поставщиков, которые специально разработаны для конкретной базы данных системы. Например хотя и существует возможность подключения к базе данных Microsoft SQL Server с помощью поставщика OLE DB, Поставщик SqlClient намного более эффективным, как он был разработан и оптимизирован специально для SQL Server.

При программном доступе к данным, обычно используется следующий шаблон:

1. Установите подключение к базе данных.
2. Выполните команду.
3. Для `SELECT` запросов, работать с результирующие записи.

Существуют отдельные классы ADO.NET для выполнения каждого из следующих действий. Чтобы подключиться к базе данных с помощью поставщика SqlClient, например, использовать [ `SqlConnection` класса](https://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection(VS.80).aspx). Проблемы `INSERT`, `UPDATE`, `DELETE`, или `SELECT` команды в базу данных, используйте [ `SqlCommand` класса](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.aspx).

За исключением [упаковки изменения базы данных в рамках транзакции](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) учебник, мы не приходится писать код низкоуровневые ADO.NET, сами поскольку адаптеры таблиц TableAdapter автоматически созданный код включает функции, необходимые для подключения к базе данных, команд, получения данных и добавления данных в таблицы данных. Тем не менее могут возникнуть ситуации, когда необходимо настроить эти параметры низкого уровня. На следующих шагах мы рассмотрим, как в объекты ADO.NET, используются внутренними механизмами адаптеров таблиц.

## <a name="step-1-examining-with-the-connection-property"></a>Шаг 1: Проверка с помощью свойства соединения

Каждый класс адаптера таблицы имеет `Connection` свойство, которое указывает сведения о подключении базы данных. Этот тип данных свойства s и `ConnectionString` значение определяются значений, заданных в мастере настройки адаптера таблицы. Помните, что мы сначала добавить адаптер таблицы типизированным набором данных этот мастер запрашивает нами для базы данных источника (см. рис. 1). В списке на первом этапе включает эти базы данных, заданные в файле конфигурации, а также других баз данных в обозревателе серверов s подключения к данным. Если мы хотим использовать Выбранная база данных не существует в раскрывающемся списке, щелкнув кнопку новое подключение и предоставление сведений о соединении, необходимые можно указать подключение к новой базе данных.


[![На первом шаге мастера настройки адаптера таблицы](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image2.png)](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image1.png)

**Рис. 1**: первый шаг мастера настройки адаптера таблицы ([Просмотр полноразмерное изображение](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image3.png))


Let s теперь пора проверить код для TableAdapter s `Connection` свойство. Как отмечалось в [Создание слой доступа к данным](../introduction/creating-a-data-access-layer-vb.md) учебнике мы просмотра кода адаптера таблицы создан, перейдите в окно представления классов, выполняя детализацию до соответствующего класса и дважды щелкнув имя члена.

Перейдите в окно представления классов, перейдите в меню «Вид» и выберите представление класса (или введите сочетание клавиш Ctrl + Shift + C). В верхней части окна классов детализации углублением до `NorthwindTableAdapters` пространство имен и выберите `ProductsTableAdapter` класса. При этом отобразится `ProductsTableAdapter` s членов в нижней половине представления классов, как показано на рис. 2. Дважды щелкните `Connection` свойство, чтобы просмотреть ее код.


![Дважды щелкните свойство соединения в представлении классов, чтобы просмотреть его автоматически созданный код](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image4.png)

**На рисунке 2**: дважды щелкните свойство соединения в представлении классов, чтобы просмотреть его автоматически созданный код


TableAdapter s `Connection` свойства и другие относящиеся к соединению кода следующим образом:


[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample1.vb)]

При создании экземпляра класса адаптера таблицы, переменной-члена `_connection` равен `Nothing`. Когда `Connection` доступ к свойству, он сначала проверяет `_connection` был создан экземпляр переменной-члена. Если нет, `InitConnection` вызывается метод, который создает `_connection` и задает его `ConnectionString` свойство значение строки соединения из первого шага s мастер настройки адаптера таблицы.

`Connection` Свойства также могут быть назначены `SqlConnection` объекта. Это связывает новый `SqlConnection` объект со всеми TableAdapter s `SqlCommand` объектов.

## <a name="step-2-exposing-connection-level-settings"></a>Шаг 2: Предоставление настройки уровня соединения

Сведения о соединении необходимо остаются инкапсулированный в TableAdapter и не быть доступными для других слоев в архитектуре приложения. Однако возможны сценарии, когда сведения уровня соединения s TableAdapter должен быть доступен или настраиваемые для запроса, пользователя или страницы ASP.NET.

Позволяют расширить s `ProductsTableAdapter` в `Northwind` необходимо включить `ConnectionString` свойство, которое может использоваться для чтения или изменить строку подключения, используемую адаптера таблицы, уровень бизнес-логики.

> [!NOTE]
> Объект *строка подключения* является строка, указывающая сведения о соединении базы данных, например службу, чтобы использовать расположение базы данных, учетные данные проверки подлинности и другие параметры, относящиеся к базе данных. Список шаблонов строка подключения используется по-разному и поставщики хранилищ данных, в разделе [ConnectionStrings.com](http://www.connectionstrings.com/).


Как было сказано в [Создание слой доступа к данным](../introduction/creating-a-data-access-layer-vb.md) учебник, автоматически создаваемые классы s типизированного набора данных могут быть расширены за счет использования разделяемых классов. Во-первых, создайте новую вложенную папку в проекте с именем `ConnectionAndCommandSettings` под `~/App_Code/DAL` папки.


![Добавить вложенную папку с именем ConnectionAndCommandSettings](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image5.png)

**Рис. 3**: добавить вложенную папку с именем `ConnectionAndCommandSettings`


Добавьте новый файл класса с именем `ProductsTableAdapter.ConnectionAndCommandSettings.vb` и введите следующий код:


[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample2.vb)]

Добавляет этот разделяемый класс `Public` свойство с именем `ConnectionString` для `ProductsTableAdapter` класс, который позволяет любой слой, чтобы считывать или обновлять строку соединения для адаптера таблицы s Базовое соединение.

В этот разделяемый класс для создания и сохранения, откройте `ProductsBLL` класса. Перейдите к одной из существующих методов и введите `Adapter` и затем нажмите клавишу периода для вызова IntelliSense. Вы увидите новый `ConnectionString` свойства, доступные в IntelliSense, то есть программными средствами чтения или изменить это значение из МЕТОДА.

## <a name="exposing-the-entire-connection-object"></a>Предоставление объекта все соединения

Этот класс предоставляет только одно свойство базового объекта соединения: `ConnectionString`. Если необходимо освободить все подключение объекта за границы адаптера таблицы в качестве альтернативы можно изменить `Connection` свойство s уровень защиты. Автоматически создаваемый код, который мы рассмотрели в шаге 1 показали, что TableAdapter s `Connection` свойство помечено как `Friend`, это означает, что он будет доступен только с помощью классов в той же сборке. Это можно изменить, однако через TableAdapter s `ConnectionModifier` свойство.

Откройте `Northwind` набора данных, если щелкнуть `ProductsTableAdatper` в конструкторе и перейдите в окно «Свойства». Здесь можно увидеть `ConnectionModifier` присвоено значение по умолчанию `Assembly`. Чтобы сделать `Connection` доступный за пределами сборки s типизированного набора данных, измените свойство `ConnectionModifier` свойства `Public`.


[![Уровень доступности s свойства соединения можно настроить с помощью свойства ConnectionModifier](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image7.png)](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image6.png)

**Рис. 4**: `Connection` свойства специальных возможностей можно настроить уровень s через `ConnectionModifier` свойство ([Просмотр полноразмерное изображение](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/_static/image8.png))


Сохранить набор данных, а затем вернитесь к `ProductsBLL` класса. Как и прежде, перейдите на один из существующих методов и введите в `Adapter` и затем нажмите клавишу периода для вызова IntelliSense. Этот список должен содержать `Connection` свойства, это означает, что теперь программными средствами чтения или назначить любые настройки уровня соединения из МЕТОДА.

## <a name="step-3-examining-the-command-related-properties"></a>Шаг 3: Проверка свойств, связанных с командой

Адаптер таблицы состоит из основного запроса, по умолчанию создан `INSERT`, `UPDATE`, и `DELETE` инструкции. Этот основной запрос s `INSERT`, `UPDATE`, и `DELETE` инструкции выполняются в коде адаптера таблицы s как объект адаптера данных ADO.NET через `Adapter` свойство. Как и с его `Connection` свойство, `Adapter` свойство s тип данных определяется поставщиком данных используется. Поскольку в этих учебниках используется поставщик SqlClient `Adapter` свойство относится к типу [ `SqlDataAdapter` ](https://msdn.microsoft.com/library/system.data.sqlclient.sqldataadapter(VS.80).aspx).

TableAdapter s `Adapter` свойство имеет три свойства типа `SqlCommand` , используемого для проблемы `INSERT`, `UPDATE`, и `DELETE` инструкции:

- `InsertCommand`
- `UpdateCommand`
- `DeleteCommand`

Объект `SqlCommand` объект отвечает за отправку определенного запроса к базе данных и содержит свойства, например: [ `CommandText` ](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtext.aspx), который содержит нерегламентированные инструкции SQL или хранимую процедуру для выполнения; и [ `Parameters` ](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.parameters.aspx), которое является коллекцией из `SqlParameter` объектов. Как мы видели в [Создание слой доступа к данным](../introduction/creating-a-data-access-layer-vb.md) учебнике эти команды объекты можно настроить с помощью окна «Свойства».

В дополнение к его основной запрос адаптера таблицы могут включать переменное число методов, при вызове перенаправления указанной команды в базу данных. Объект command основной запрос s и командных объектов для всех дополнительных методов хранятся в TableAdapter s `CommandCollection` свойство.

Let s Подведем посмотрите на код, сгенерированный `ProductsTableAdapter` в `Northwind` набор данных для этих двух свойств вспомогательные переменных-членов и их вспомогательные методы:


[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample3.vb)]

Код для `Adapter` и `CommandCollection` свойства точно имитирует, `Connection` свойство. Существует переменных-членов, содержащих объекты, используемые свойства. Свойства `Get` методы доступа начните с проверки, находится ли соответствующей переменной члена `Nothing`. Если Да, метод инициализации вызывается которого создается экземпляр переменной-члена и назначает основные свойства, связанные с команды.

## <a name="step-4-exposing-command-level-settings"></a>Шаг 4: Предоставление настройки на уровне команды

В идеальном случае сведения на уровне команды должны оставаться инкапсулированный в пределах уровня доступа к данным. Понадобится эти сведения в других слоях архитектуры, тем не менее, он может предоставляться через разделяемого класса, так же, как с параметрами уровня соединения.

Так как адаптер имеет только один `Connection` свойства, код для предоставления настройки уровня соединения выполняется очень просто. Обстоятельства немного сложнее при изменении настройки на уровне команды, так как адаптер может иметь несколько командных объектов - `InsertCommand`, `UpdateCommand`, и `DeleteCommand`, вместе с переменным числом объектов команд в `CommandCollection` свойство. При обновлении параметров на уровне команды, эти параметры должны быть распространены на все объекты команд.

Например предположим, что в адаптер таблицы, в результате непредвиденных долго были некоторых запросов. При использовании адаптера таблицы для выполнения одной из этих запросов, может потребоваться увеличить объект команды s [ `CommandTimeout` свойства](https://msdn.microsoft.com/library/system.data.sqlclient.sqlcommand.commandtimeout.aspx). Это свойство указывает количество секунд ожидания выполнения команды и по умолчанию используется значение 30.

Чтобы разрешить `CommandTimeout` свойство отрегулировать уровень бизнес-ЛОГИКИ, добавьте следующий `Public` метод `ProductsDataTable` использовать файл разделяемого класса, созданную в шаге 2 (`ProductsTableAdapter.ConnectionAndCommandSettings.vb`):


[!code-vb[Main](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb/samples/sample4.vb)]

Этот метод может вызываться из уровень бизнес-ЛОГИКИ или уровень представления данных для задания времени ожидания команды для всех ошибок, команды из экземпляра адаптера таблицы.

> [!NOTE]
> `Adapter` И `CommandCollection` свойства, помечаются как `Private`, то есть они может осуществляться только из кода внутри адаптера таблицы. В отличие от `Connection` свойства, эти модификаторы доступа не могут быть изменены. Таким образом, необходимо использовать свойства на уровне команды на другие слои в архитектуре необходимо использовать разделяемый класс подход, описанный выше, для обеспечения `Public` метод или свойство, которое считывает или записывает `Private` объектов команд.


## <a name="summary"></a>Сводка

Адаптеры таблиц TableAdapter внутри типизированного набора данных служат для инкапсуляции данных данные доступа и сложности. С помощью адаптеров таблиц, не нужно беспокоиться о написании кода ADO.NET для подключения к базе данных, выполнять команду или заполнения результаты в таблицу данных. Он все обрабатывается автоматически для нас.

Тем не менее могут возникнуть ситуации, когда необходимо настроить низкоуровневые ADO.NET особенностей, например изменение строки подключения или значения времени ожидания подключения или команду по умолчанию. Адаптер таблицы создан `Connection`, `Adapter`, и `CommandCollection` свойства, но они являются либо `Friend` или `Private`, по умолчанию. Эта Внутренняя информация может быть предоставлен расширение TableAdapter, используя разделяемые классы для включения `Public` методов или свойств. Кроме того, s TableAdapter `Connection` модификатор доступа свойства можно настроить с помощью адаптера таблицы s `ConnectionModifier` свойство.

Программирование довольны!

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года. Скотт — независимый консультант, trainer и записи. Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).

## <a name="special-thanks-to"></a>Благодарности

Этот учебник ряд прошел проверку многие полезные рецензентов. Основными редакторами этого учебника были Burnadette Leigh, S ren Lauritsen Алексей Мерфи Тереза д и Хилтон Geisenow. Объясняются моих последующих статей для MSDN? Если Да, напишите мне по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](working-with-computed-columns-vb.md)
> [Вперед](protecting-connection-strings-and-other-configuration-information-vb.md)
