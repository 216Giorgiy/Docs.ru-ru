---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/working-with-computed-columns-vb
title: "Работа с вычисляемыми столбцами (VB) | Документы Microsoft"
author: rick-anderson
description: "При создании таблицы базы данных Microsoft SQL Server позволяет определить вычисляемый столбец, значение которого вычисляется из выражения, обычно referen..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/03/2007
ms.topic: article
ms.assetid: 5811b8ff-ed56-40fc-9397-6b69ae09a8f6
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/working-with-computed-columns-vb
msc.type: authoredcontent
ms.openlocfilehash: a6ff0df27e19d6feecde27a77d4b212d1e9bc45e
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="working-with-computed-columns-vb"></a>Работа с вычисляемыми столбцами (Visual Basic)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить код](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_71_VB.zip) или [скачать PDF](working-with-computed-columns-vb/_static/datatutorial71vb1.pdf)

> При создании таблицы базы данных Microsoft SQL Server позволяет определить вычисляемый столбец, значение которого вычисляется из выражения, которое обычно ссылается на другие значения в одной и той же записи базы данных. Такие значения доступны только для чтения в базе данных требуются особые соображения при работе с адаптеры таблиц TableAdapter. В этом учебнике рассказано, как для решения проблем, вызванных вычисляемых столбцов.


## <a name="introduction"></a>Вступление

Microsoft SQL Server позволяет  *[вычисляемые столбцы](https://msdn.microsoft.com/en-us/library/ms191250.aspx)*, которые являются столбцы, значения которого вычисляются по выражению, обычно ссылается на значения из других столбцов той же таблицы. Например, времени, отслеживание модели данных может иметь таблицу по имени `ServiceLog` со столбцами, включая `ServicePerformed`, `EmployeeID`, `Rate`, и `Duration`, среди прочего. Хотя сумма из-за каждой службы элементов (частота, умноженному на длительность) может быть вычислено через веб-страницы или другой программный интерфейс, может быть полезно включить столбец в `ServiceLog` таблицу с именем `AmountDue` , сообщила, что это сведения. Этот столбец может быть создан как обычный столбец, но он будет должны быть обновлены в любое время `Rate` или `Duration` изменения значений столбцов. Удачным подходом было бы делать `AmountDue` столбец вычисляемый столбец, с помощью выражения `Rate * Duration`. Это приведет к SQL Server, чтобы автоматически вычислить `AmountDue` значение столбца, каждый раз, когда он указан в запросе.

Поскольку значение вычисляемого столбца s зависит от выражения, такие столбцы доступны только для чтения, и таким образом не может иметь значения присвоены их в `INSERT` или `UPDATE` инструкции. Тем не менее, когда вычисляемые столбцы являются частью основного запроса для TableAdapter, использующего нерегламентированных инструкций SQL, они автоматически включаются в автоматически созданный `INSERT` и `UPDATE` инструкции. Следовательно, s TableAdapter `INSERT` и `UPDATE` запросы и `InsertCommand` и `UpdateCommand` свойства должны обновляться, чтобы удалить ссылки на все вычисляемые столбцы.

Одна из проблем с помощью вычисляемых столбцов с помощью адаптера таблицы, использующий нерегламентированных инструкций SQL является то, что TableAdapter s `INSERT` и `UPDATE` запросы автоматически восстанавливаются при каждом завершении выполнения мастера настройки адаптера таблицы. Таким образом, вычисляемые столбцы вручную удалены из `INSERT` и `UPDATE` запросов появятся в том случае, если мастер запускается повторно. Несмотря на то, что адаптеры таблиц, в которых используются хранимые процедуры не хотите t страдает от этой хрупкость, они имеют свои собственные особенности, которые мы поговорим на шаге 3.

В этом руководстве мы добавим вычисляемого столбца для `Suppliers` таблицы в базе данных Northwind, а затем создать соответствующий адаптер таблицы, для работы с этой таблицы и ее вычисляемого столбца. Мы будет использовать хранимые процедуры вместо нерегламентированных инструкций SQL, чтобы наши t упорядочивая настройки теряются при использовании мастера настройки адаптера таблицы TableAdapter.

S позволяют начать работу!

## <a name="step-1-adding-a-computed-column-to-thesupplierstable"></a>Шаг 1: Добавление вычисляемого столбца для`Suppliers`таблицы

Базы данных Northwind нет все вычисляемые столбцы, поэтому нам потребуется добавить один сами. Для этого учебника позволяют добавить вычисляемый столбец для s `Suppliers` таблицу с именем `FullContactName` , возвращающий имя контакта s, заголовок и компании, которые работают в в следующем формате: `ContactName` (`ContactTitle`, `CompanyName`). Этот вычисляемый столбец может использоваться в отчетах при отображении сведения о поставщиках.

Сначала откройте `Suppliers` определение таблицы, щелкнув правой кнопкой мыши `Suppliers` таблицу в обозревателе серверов и выбрав в контекстном меню Открыть определение таблицы. Столбцы таблицы и их свойств, например их типами данных, появится ли они позволяют `NULL` s и т. д. Чтобы добавить вычисляемый столбец, запустите, введя имя столбца в определении таблицы. Затем введите выражение в текстовое поле (Формула) в разделе Спецификация вычисляемого столбца в окне «Свойства столбца» (см. рис. 1). Имя вычисляемого столбца `FullContactName` и использовать следующее выражение:


[!code-sql[Main](working-with-computed-columns-vb/samples/sample1.sql)]

Обратите внимание, что строки могут быть объединены в SQL с помощью `+` оператор. `CASE` Инструкции могут быть использованы как разбиений в традиционных языках программирования. В предыдущем выражении `CASE` заявление можно рассматривать как: Если `ContactTitle` не `NULL` вывод `ContactTitle` порождение объединенное с разделителями, в противном случае — значение nothing. Для получения дополнительных сведений об полезность `CASE` инструкции, в разделе [Power SQL `CASE` инструкции](http://www.4guysfromrolla.com/webtech/102704-1.shtml).

> [!NOTE]
> Вместо использования `CASE` здесь инструкции можно было бы также использовать `ISNULL(ContactTitle, '')`. [`ISNULL(checkExpression, replacementValue)`](https://msdn.microsoft.com/en-us/library/ms184325.aspx)Возвращает *checkExpression* , если оно отлично от NULL, в противном случае он возвращает *Заменяющее_значение*. Хотя либо `ISNULL` или `CASE` будет работать в этом случае существует более сложных сценариях где гибкость `CASE` инструкции не могут быть сопоставлены с `ISNULL`.


После добавления этого вычисляемого столбца экран должен выглядеть как на показанную на рисунке 1.


[![Добавить вычисляемый столбец с именем FullContactName таблицу Suppliers](working-with-computed-columns-vb/_static/image2.png)](working-with-computed-columns-vb/_static/image1.png)

**Рис. 1**: добавить вычисляемый столбец с именем `FullContactName` для `Suppliers` таблицы ([Просмотр полноразмерное изображение](working-with-computed-columns-vb/_static/image3.png))


После именования вычисляемый столбец и введите выражение, сохраните изменения в таблицу, щелкнув значок сохранения на панели инструментов, нажав клавиши Ctrl + S или, перейдя в меню «файл» и выбрав сохранение `Suppliers`.

Сохранение в таблице следует обновить обозреватель серверов, включая только что добавленного столбца в `Suppliers` список столбцов таблицы s. Кроме того, выражения, введенные в текстовое поле (Формула) автоматически настроит эквивалентное выражение, которое удаляет ненужные пробелы, вокруг имен столбцов в квадратные скобки (`[]`) и включает круглые скобки, чтобы показать более явно порядок операций:


[!code-sql[Main](working-with-computed-columns-vb/samples/sample2.sql)]

Дополнительные сведения о вычисляемых столбцов в Microsoft SQL Server см. [технической документации](https://msdn.microsoft.com/en-us/library/ms191250.aspx). Можно также выбрать [как: Specify Computed Columns](https://msdn.microsoft.com/en-us/library/ms188300.aspx) для пошагового создания вычисляемых столбцов.

> [!NOTE]
> По умолчанию вычисляемых столбцов физически не хранится в таблице, но вместо вычисляются каждый раз, когда они указываются в запросе. С помощью флажков сохраняется, можно настроить SQL Server для физического хранения вычисляемых столбцов в таблице. Это позволяет создать индекс создан по вычисляемому столбцу, что может повысить производительность запросов, использующих значения вычисляемого столбца в их `WHERE` предложения. В разделе [создание индексов вычисляемых столбцов](https://msdn.microsoft.com/en-us/library/ms189292.aspx) для получения дополнительной информации.


## <a name="step-2-viewing-the-computed-column-s-values"></a>Шаг 2: Просмотр значений s вычисляемого столбца

Прежде чем начать работы на уровне доступа к данным, позволяют s внимательно просмотреть `FullContactName` значения. В обозревателе сервера щелкните правой кнопкой мыши `Suppliers` имя таблицы и выберите в контекстном меню новый запрос. Появится окно запроса, которое запрашивает у нас выбрать, какие таблицы следует включить в запрос. Добавить `Suppliers` таблицы, а затем нажмите кнопку Закрыть. Затем проверьте `CompanyName`, `ContactName`, `ContactTitle`, и `FullContactName` столбцы из таблицы «Поставщики». Наконец щелкните значок красный восклицательный знак в панели инструментов, чтобы выполнить запрос и просмотреть результаты.

Как показано на рисунке 2, то результаты включают `FullContactName`, какие списки `CompanyName`, `ContactName`, и `ContactTitle` столбцы в формате `ContactName` (`ContactTitle`, `CompanyName`).


[![FullContactName использует формат ContactName (ОрганизацияИлиОтдел, CompanyName)](working-with-computed-columns-vb/_static/image5.png)](working-with-computed-columns-vb/_static/image4.png)

**На рисунке 2**: `FullContactName` в формате `ContactName` (`ContactTitle`, `CompanyName`) ([Просмотр полноразмерное изображение](working-with-computed-columns-vb/_static/image6.png))


## <a name="step-3-adding-thesupplierstableadapterto-the-data-access-layer"></a>Шаг 3: Добавление`SuppliersTableAdapter`для доступа к данным

Для работы с сведения о поставщиках в приложении необходимо сначала создать TableAdapter и DataTable в DAL. В идеальном случае это будет сделать, используя те же шаги прост, проверены в предыдущих учебниках. Тем не менее работе с вычисляемыми столбцами создает несколько Морщины, которые заслуживают более подробного обсуждения.

Если вы используете TableAdapter, использующего нерегламентированных инструкций SQL, можно просто включить вычисляемый столбец в основном запросе TableAdapter s через мастер настройки адаптера таблицы. Это, однако автоматически создаст `INSERT` и `UPDATE` инструкции, содержащие вычисляемый столбец. При попытке выполнить один из этих методов, `SqlException` с сообщением столбец *ColumnName* изменить нельзя, поскольку он является либо вычисляемым столбцом или выдается результат оператора UNION. Хотя `INSERT` и `UPDATE` инструкции можно вручную изменить с помощью адаптера таблицы s `InsertCommand` и `UpdateCommand` свойства, эти настройки будут потеряны при каждом повторного запуска мастера настройки адаптера таблицы.

Из-за хрупкость адаптеры таблиц TableAdapter, использовать специализированные инструкции SQL рекомендуется мы используем хранимых процедур при работе с вычисляемыми столбцами. Если вы используете существующие хранимые процедуры, просто настройте адаптер как описано в [существующих хранимых процедур для типизированного набора данных s адаптеры таблиц TableAdapter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) учебника. При наличии адаптера таблицы мастер создает хранимые процедуры для пользователя, однако важно изначально опускаются все вычисляемые столбцы из основного запроса. Если включать вычисляемые столбцы в главном запросе, мастер настройки адаптера таблицы сообщит вам, по завершении не удается создать соответствующие хранимые процедуры. Иными словами, нам необходимо изначально настроить с помощью вычисляемого столбца освободить основного запроса адаптера таблицы и вручную обновить соответствующая хранимая процедура и TableAdapter `SelectCommand` для включения в вычисляемый столбец. Этот подход аналогичен используемому в [обновление адаптера таблицы для использования](updating-the-tableadapter-to-use-joins-vb.md)`JOIN`*s* учебника.

В этом учебнике позволяют s добавьте новый адаптер таблицы, и он автоматически создавать хранимые процедуры для нас. Следовательно, необходимо опустить изначально `FullContactName` вычисляемый столбец из основного запроса.

Сначала откройте `NorthwindWithSprocs` набора данных в `~/App_Code/DAL` папки. Щелкните правой кнопкой мыши в конструкторе и в контекстном меню выбрать и добавить новый адаптер таблицы. Будет запущен мастер настройки адаптера таблицы. Укажите базу данных для запроса данных из (`NORTHWNDConnectionString` из `Web.config`) и нажмите кнопку Далее. Так как мы еще не создали все хранимые процедуры, создавать запросы или изменяя `Suppliers` таблица, установите создать новые хранимые процедуры параметр, чтобы мастер будет создавать их нам и нажмите кнопку Далее.


[![Выберите создать новые хранимые процедуры параметр](working-with-computed-columns-vb/_static/image8.png)](working-with-computed-columns-vb/_static/image7.png)

**Рис. 3**: выберите создать новые хранимые процедуры параметр ([Просмотр полноразмерное изображение](working-with-computed-columns-vb/_static/image9.png))


Последующий шаг запрашивает основного запроса. Введите следующий запрос, возвращающий `SupplierID`, `CompanyName`, `ContactName`, и `ContactTitle` столбцов для каждого поставщика. Обратите внимание, что этот запрос намеренно пропущены вычисляемого столбца (`FullContactName`); Корпорация Майкрософт будет обновлять соответствующая хранимая процедура для включения данного столбца в шаге 4.


[!code-sql[Main](working-with-computed-columns-vb/samples/sample3.sql)]

После ввода основного запроса и нажмите кнопку Далее, мастер позволяет нам имя будет создавать четырех хранимых процедур. Эти хранимые процедуры имя `Suppliers_Select`, `Suppliers_Insert`, `Suppliers_Update`, и `Suppliers_Delete`, как показано на рис.


[![Настройка имен автоматически формируемые хранимые процедуры](working-with-computed-columns-vb/_static/image11.png)](working-with-computed-columns-vb/_static/image10.png)

**Рис. 4**: Настройка имен хранимых процедур Auto-Generated ([Просмотр полноразмерное изображение](working-with-computed-columns-vb/_static/image12.png))


Следующий шаг мастера позволяет нам имя s методы адаптера таблицы и указать шаблоны, используемые для доступа и обновления данных. Оставьте все три флажка этот флажок установлен, но Переименовать `GetData` метод `GetSuppliers`. Нажмите кнопку Готово, чтобы завершить работу мастера.


[![Переименуйте метод GetData GetSuppliers](working-with-computed-columns-vb/_static/image14.png)](working-with-computed-columns-vb/_static/image13.png)

**Рис. 5**: переименование `GetData` метод `GetSuppliers` ([Просмотр полноразмерное изображение](working-with-computed-columns-vb/_static/image15.png))


После нажатия кнопки Готово, мастер создания четырех хранимых процедур и добавление адаптера таблицы и соответствующий объект DataTable с типизированным набором данных.

## <a name="step-4-including-the-computed-column-in-the-tableadapter-s-main-query"></a>Шаг 4: Включение вычисляемый столбец в s основного запроса адаптера таблицы

Теперь нам нужно обновить TableAdapter и DataTable созданной на шаге 3, чтобы включить `FullContactName` вычисляемого столбца. Это происходит в два этапа:

1. Обновление `Suppliers_Select` хранимые процедуры возвращают `FullContactName` вычисляемого столбца и
2. Обновление таблицы данных для включения соответствующего `FullContactName` столбца.

Запуск, перейдите в обозреватель серверов и детализация в папке Stored Procedures. Откройте `Suppliers_Select` хранимой процедуры и обновление `SELECT` запрос, чтобы включить `FullContactName` вычисляемого столбца:


[!code-sql[Main](working-with-computed-columns-vb/samples/sample4.sql)]

Сохранить хранимую процедуру, щелкнув значок сохранения на панели инструментов, нажав клавиши Ctrl + S или выбрав сохранения `Suppliers_Select` параметр меню "файл".

После этого вернитесь в конструктор набора данных, щелкните правой кнопкой мыши `SuppliersTableAdapter`и выберите команду "Настройка" в контекстном меню. Обратите внимание, что `Suppliers_Select` теперь включает столбец `FullContactName` столбца в коллекции столбцов данных.


[![Запустите мастер настройки TableAdapter s для обновления столбцов s DataTable](working-with-computed-columns-vb/_static/image17.png)](working-with-computed-columns-vb/_static/image16.png)

**Рис. 6**: запустить s адаптера таблицы мастер настройки, чтобы обновить s DataTable столбцов ([Просмотр полноразмерное изображение](working-with-computed-columns-vb/_static/image18.png))


Нажмите кнопку Готово, чтобы завершить работу мастера. Это автоматически добавит соответствующего столбца в `SuppliersDataTable`. Мастер TableAdapter, обнаружение `FullContactName` столбец является вычисляемым столбцом и доступен только для чтения. Следовательно, он задает столбец s `ReadOnly` свойства `true`. Чтобы проверить это, выберите столбец из `SuppliersDataTable` и перейдите в окно свойств (см. рис. 7). Обратите внимание, что `FullContactName` столбец s `DataType` и `MaxLength` также задано соответствующим образом.


[![FullContactName столбец помечен как доступный только для чтения](working-with-computed-columns-vb/_static/image20.png)](working-with-computed-columns-vb/_static/image19.png)

**Рис. 7**: `FullContactName` столбец помечен как доступный только для чтения ([Просмотр полноразмерное изображение](working-with-computed-columns-vb/_static/image21.png))


## <a name="step-5-adding-agetsupplierbysupplieridmethod-to-the-tableadapter"></a>Шаг 5: Добавление`GetSupplierBySupplierID`метод адаптера таблицы

В этом учебнике мы создадим страницы ASP.NET, которая отображает поставщиков в обновляемый сетки. В предыдущих учебниках мы обновили одной записи из уровня бизнес-логики, получая попадет запись из DAL как строго типизированный объект DataTable, обновляя ее свойства и последующей отправки обновленных DataTable передаются DAL для распространения изменений на База данных. Для выполнения первого шага — получение записи, которая обновляется из DAL - необходимо сначала добавить `GetSupplierBySupplierID(supplierID)` метод DAL.

Щелкните правой кнопкой мыши `SuppliersTableAdapter` в конструктора наборов данных и в контекстном меню выберите Добавить запрос. Как мы делали на шаге 3, позволить мастеру создать новую хранимую процедуру для нас, выбрав параметр Создать новые хранимые процедуры (см. обратно на рисунке 3 показана этого шага мастера). Так как этот метод будет возвращать записи с несколькими столбцами, указывают, что мы хотим использовать SQL-запрос, который является инструкция SELECT, которая возвращает строки, а затем нажмите кнопку Далее.


[![Выберите SELECT, возвращающая строки параметра](working-with-computed-columns-vb/_static/image23.png)](working-with-computed-columns-vb/_static/image22.png)

**Рис. 8**: выберите SELECT, возвращающая строки параметра ([Просмотр полноразмерное изображение](working-with-computed-columns-vb/_static/image24.png))


Последующий шаг предлагает нам запрос, используемый для этого метода. Введите следующую команду, который возвращает те же поля данных основного запроса, но для конкретного поставщика.


[!code-sql[Main](working-with-computed-columns-vb/samples/sample5.sql)]

Следующий экран появляется запрос на имя хранимой процедуры, которая будет создаваться автоматически. Имя этой хранимой процедуры `Suppliers_SelectBySupplierID` и нажмите кнопку Далее.


[![Имя хранимой процедуры Suppliers_SelectBySupplierID](working-with-computed-columns-vb/_static/image26.png)](working-with-computed-columns-vb/_static/image25.png)

**Рис. 9**: имя хранимой процедуры `Suppliers_SelectBySupplierID` ([Просмотр полноразмерное изображение](working-with-computed-columns-vb/_static/image27.png))


Наконец мастер приглашения нами для данных, доступ к шаблонов и имена методов для адаптера таблицы. Оставить установленными оба флажка, но Переименовать `FillBy` и `GetDataBy` методы для `FillBySupplierID` и `GetSupplierBySupplierID`соответственно.


[![Имя FillBySupplierID методы адаптера таблицы и GetSupplierBySupplierID](working-with-computed-columns-vb/_static/image29.png)](working-with-computed-columns-vb/_static/image28.png)

**Рис. 10**: имя адаптера таблицы методы `FillBySupplierID` и `GetSupplierBySupplierID` ([Просмотр полноразмерное изображение](working-with-computed-columns-vb/_static/image30.png))


Нажмите кнопку Готово, чтобы завершить работу мастера.

## <a name="step-6-creating-the-business-logic-layer"></a>Шаг 6: Создание уровня бизнес-логики

Перед тем как создать страницу ASP.NET, которая использует вычисляемый столбец, созданной на шаге 1, необходимо сначала добавить соответствующие методы в МЕТОДА. Нашу страницу ASP.NET, который мы создадим в шаге 7, позволит пользователям просматривать и изменять поставщиков. Таким образом мы должны нашей МЕТОДА, чтобы указать, как минимум, метод, чтобы получить все поставщики, а другой для обновления конкретного поставщика.

Создать новый файл класса с именем `SuppliersBLLWithSprocs` в `~/App_Code/BLL` папку и добавьте следующий код:


[!code-vb[Main](working-with-computed-columns-vb/samples/sample6.vb)]

Как и другие классы уровень бизнес-ЛОГИКИ, `SuppliersBLLWithSprocs` имеет `Protected` `Adapter` свойство, которое возвращает экземпляр `SuppliersTableAdapter` класса вместе с двумя `Public` методы: `GetSuppliers` и `UpdateSupplier`. `GetSuppliers` Метод вызывает и возвращает `SuppliersDataTable` возвращаемых соответствующим `GetSupplier` метода на уровне доступа к данным. `UpdateSupplier` Метод извлекает сведения о конкретного поставщика, выполняется обновление через вызов DAL s `GetSupplierBySupplierID(supplierID)` метод. Затем обновляет `CategoryName`, `ContactName`, и `ContactTitle` свойства и фиксирует эти изменения в базе данных путем вызова уровня доступа к данным s `Update` метод, передав в измененной `SuppliersRow` объекта.

> [!NOTE]
> За исключением `SupplierID` и `CompanyName`, все столбцы в таблице Поставщики позволяют `NULL` значения. Таким образом Если переданный `contactName` или `contactTitle` параметры `Nothing` необходимо установить соответствующий `ContactName` и `ContactTitle` свойства `NULL` значение базы данных с помощью `SetContactNameNull` и `SetContactTitleNull`методы, соответственно.


## <a name="step-7-working-with-the-computed-column-from-the-presentation-layer"></a>Шаг 7: Работа с вычисляемым столбцом от уровня представления

С вычисляемым столбцом, добавляемый `Suppliers` таблицы и DAL и уровень бизнес-ЛОГИКИ обновлен соответствующим образом, все готово для создания страницы ASP.NET, которая работает с `FullContactName` вычисляемого столбца. Сначала откройте `ComputedColumns.aspx` страницы в `AdvancedDAL` папки и перетащите элемент управления GridView с панели элементов в конструктор. Набор GridView s `ID` свойства `Suppliers` и его смарт-теге, привязать его к новой ObjectDataSource с именем `SuppliersDataSource`. Настройка ObjectDataSource для использования `SuppliersBLLWithSprocs` класса, мы добавили обратно в шаге 6 и нажмите кнопку Далее.


[![Настройка ObjectDataSource с помощью класса SuppliersBLLWithSprocs](working-with-computed-columns-vb/_static/image32.png)](working-with-computed-columns-vb/_static/image31.png)

**Рис. 11**: Настройка ObjectDataSource для использования `SuppliersBLLWithSprocs` класса ([Просмотр полноразмерное изображение](working-with-computed-columns-vb/_static/image33.png))


Существует только два метода, определенного в `SuppliersBLLWithSprocs` класса: `GetSuppliers` и `UpdateSupplier`. Убедитесь, что эти два метода указаны в инструкции SELECT и соответственно обновить вкладок и нажмите кнопку Готово, чтобы завершить настройку ObjectDataSource.

После завершения работы мастера настройки источника данных Visual Studio добавит поле BoundField для каждого из полей данных, возвращаемых. Удалить `SupplierID` BoundField и измените `HeaderText` свойства `CompanyName`, `ContactName`, `ContactTitle`, и `FullContactName` стояли компании, контактное имя, заголовок и полное имя контакта, соответственно. Смарт-теге установите флажок Разрешить изменение, чтобы включить GridView s встроенных возможностей редактирования.

Помимо добавления стояли к GridView, завершения работы мастера источника данных также вызывает Visual Studio, чтобы установить ObjectDataSource s `OldValuesParameterFormatString` свойство исходный\_{0}. Вернуться обратно к значению по умолчанию {0}.

После внесения этих изменений в GridView и ObjectDataSource, их должна выглядеть следующим образом:


[!code-aspx[Main](working-with-computed-columns-vb/samples/sample7.aspx)]

Затем посетите эту страницу через браузер. Как показано на рис. 12, каждый поставщик указан в сетке, которая включает в себя `FullContactName` столбец, значение которого является просто объединение трех столбцов в формате `ContactName` (`ContactTitle`, `CompanyName`).


[![Каждый поставщик, перечисленных в сетке](working-with-computed-columns-vb/_static/image35.png)](working-with-computed-columns-vb/_static/image34.png)

**Рис. 12**: каждый поставщик, перечисленных в сетке ([Просмотр полноразмерное изображение](working-with-computed-columns-vb/_static/image36.png))


Нажав кнопку "Изменить" для конкретного поставщика вызывает обратную передачу, и имеет этой строки, отображаемый в его редактирования интерфейса (см. рис. 13). Первые три столбца отрисовки в значения по умолчанию, интерфейс редактирования - элемент управления TextBox `Text` свойству присвоено значение поля данных. `FullContactName` Столбца, однако остается как текст. Когда стояли были добавлены к GridView, после завершения работы мастера настройки источника данных, `FullContactName` BoundField s `ReadOnly` было задано значение `True` так как соответствующий `FullContactName` столбца в `SuppliersDataTable` имеет его `ReadOnly` свойство `True`. Как указано в шаге 4 `FullContactName` s `ReadOnly` было задано значение `True` поскольку TableAdapter обнаружил, что столбец является вычисляемым столбцом.


[![Столбец FullContactName является не могут быть изменены](working-with-computed-columns-vb/_static/image38.png)](working-with-computed-columns-vb/_static/image37.png)

**Рис. 13**: `FullContactName` столбца не изменяется ([Просмотр полноразмерное изображение](working-with-computed-columns-vb/_static/image39.png))


Теперь обновите значение из одного или нескольких столбцов для редактирования и нажмите кнопку обновления. Обратите внимание как `FullContactName` значение s автоматически обновляется для отражения изменений.

> [!NOTE]
> GridView в настоящее время использует стояли изменяемых полей приведет к редактирования интерфейс по умолчанию. Поскольку `CompanyName` поле является обязательным, его следует преобразовать в TemplateField, включающий RequiredFieldValidator. Я это поле оставить в качестве упражнения для интересующихся. Обратитесь к [Добавление проверяющих элементов управления для редактирования и вставка интерфейсов](../editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md) учебника пошаговые инструкции по перевод BoundField и TemplateField и добавление элементов управления проверки.


## <a name="summary"></a>Сводка

При определении схемы для таблицы, Microsoft SQL Server позволяет включение вычисляемых столбцов. Это столбцы, значения которого вычисляются по выражению, обычно ссылается на значения из других столбцов в той же записи. Поскольку значения для вычисляемых столбцов основана на выражении, они доступны только для чтения и не может быть присвоено значение в `INSERT` или `UPDATE` инструкции. Это создает проблемы при использовании вычисляемого столбца в основной запрос адаптера таблицы, которую пытается автоматически создать соответствующие `INSERT`, `UPDATE`, и `DELETE` инструкции.

В этом учебнике мы рассмотрели методы для обхода проблем, вызванных вычисляемых столбцов. В частности мы использовали хранимых процедур в TableAdapter для преодоления хрупкость, присущие адаптеры таблиц TableAdapter, использовать специализированные инструкции SQL. При необходимости адаптера таблицы мастер создания новых хранимых процедур, важно наличие изначально опустить все вычисляемые столбцы, так как их наличие предотвращает изменение хранимой процедуры данные основного запроса. После первоначальной настройки адаптера таблицы его `SelectCommand` хранимая процедура может retooled включать все вычисляемые столбцы.

Программирование довольны!

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года. Скотт — независимый консультант, trainer и записи. Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [http://ScottOnWriting.NET](http://ScottOnWriting.NET).

## <a name="special-thanks-to"></a>Благодарности

Этот учебник ряд прошел проверку многие полезные рецензентов. Основными редакторами этого учебника были Хилтон Geisenow и Мерфи Тереза д. Объясняются моих последующих статей для MSDN? Если Да, напишите мне по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)

>[!div class="step-by-step"]
[Назад](adding-additional-datatable-columns-vb.md)
[Вперед](configuring-the-data-access-layer-s-connection-and-command-level-settings-vb.md)
