---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/debugging-stored-procedures-vb
title: "Отладка хранимых процедур (Visual Basic) | Документы Microsoft"
author: rick-anderson
description: "Выпуски Visual Studio Professional и Team System позволяют задавать точки останова и прохождение для хранимых процедур в SQL Server, ускоряя отладку хранимых..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/03/2007
ms.topic: article
ms.assetid: 9ed8ccb5-5f31-4eb4-976d-cabf4b45ca09
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/debugging-stored-procedures-vb
msc.type: authoredcontent
ms.openlocfilehash: ad09847d828d02019a72e3022d035a8fbe921568
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2018
---
<a name="debugging-stored-procedures-vb"></a>Отладка хранимых процедур (Visual Basic)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить код](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_74_VB.zip) или [скачать PDF](debugging-stored-procedures-vb/_static/datatutorial74vb1.pdf)

> Выпуски Visual Studio Professional и Team System позволяют задавать точки останова и прохождение для хранимых процедур в SQL Server, ускоряя отладку хранимых процедур, так же легко, как отладка кода приложения. В этом учебнике показано прямой отладки базы данных и хранимых процедур отладки приложения.


## <a name="introduction"></a>Вступление

Visual Studio предоставляет широкие возможности отладки. С несколько нажатий клавиш и щелчки мышью его можно использовать точки останова для остановки выполнения программы и проверьте его состояние и управления потоком s. Вместе с отладки кода приложения, Visual Studio обеспечивает поддержку для отладки хранимых процедур в SQL Server. Так же, как можно установить точки останова в коде класса фонового кода ASP.NET или уровень бизнес-логики класса, поэтому слишком они помещены в хранимых процедурах.

В этом учебнике мы рассмотрим шаг с заходом в хранимые процедуры из обозревателя серверов в среде Visual Studio также как установить точки останова, которые срабатывают при хранимая процедура вызывается из работающего приложения ASP.NET.

> [!NOTE]
> К сожалению хранимые процедуры можно только пошаговое выполнение и отладку через версии Visual Studio Professional и системы Team. При использовании стандартной версии Visual Studio или Visual Web Developer, мы приглашаем вас на чтение вместе, как мы выполните эти шаги, необходимые для отладки хранимых процедур, но вы не сможете реплицировать эти действия на компьютере.


## <a name="sql-server-debugging-concepts"></a>Основные понятия отладки SQL Server

Microsoft SQL Server 2005 был разработан для обеспечения интеграции с [Common Language Runtime (CLR)](https://msdn.microsoft.com/netframework/aa497266.aspx), передаваемый в среде выполнения все сборки .NET. Следовательно SQL Server 2005 поддерживает управляемые объекты базы данных. То есть как методы в классе Visual Basic можно создать объекты базы данных, таких как хранимые процедуры и определяемые пользователем функции (UDF). Это позволяет эти хранимые процедуры и определяемые пользователем функции, чтобы использовать функциональные возможности в платформе .NET Framework и из пользовательских классов. Конечно SQL Server 2005 также обеспечивает поддержку для объектов базы данных T-SQL.

SQL Server 2005 обеспечивает поддержку отладки T-SQL и управляемых объектов базы данных. Тем не менее эти объекты можно отлаживать только в его разных выпусках Visual Studio 2005 Professional и систем команды. В этом учебнике мы рассмотрим отладки объектов базы данных T-SQL. Последующие учебнике рассматривается отладки управляемых объектов базы данных.

[Обзор T-SQL и отладки среды CLR в SQL Server 2005](https://blogs.msdn.com/sqlclr/archive/2006/06/29/651644.aspx) запись в блоге из [интеграция со средой CLR SQL Server 2005 team](https://blogs.msdn.com/sqlclr/default.aspx) выделяет три способа отладки объектов SQL Server 2005 из Visual Studio:

- **Прямой отладки базы данных (DDD)** — из обозревателя серверов, мы можно выполнить пошаговую отладку любого объекта базы данных T-SQL, таких как хранимые процедуры и определяемые пользователем функции. Изучим DDD на шаге 1.
- **Отладка приложений** -можно установить точки останова в объекте базы данных и затем запустить нашего приложения ASP.NET. При выполнении объекта базы данных будет достигнута точка останова и управления переворачиваются в отладчик. Обратите внимание, что с отладкой приложения мы невозможно выполнить пошаговую отладку объекта базы данных из кода приложения. Нам необходимо явно задать точки останова в этих хранимых процедур или определяемых пользователем функций нужном останов отладчика. Отладка приложения проверяется начиная с шага 2.
- **Отладку из проекта SQL Server** -выпуски Visual Studio Professional и систем Team расширение проекта SQL Server, обычно используется для создания управляемых объектов базы данных. Рассмотрим использование проектов SQL Server и отладка их содержимое в следующем уроке.

Visual Studio поддерживает отладку хранимых процедур на локальных и удаленных экземпляров SQL Server. Локальный экземпляр SQL Server будет установлена на том же компьютере, что и Visual Studio. Если база данных SQL Server, которую вы используете, не находится на компьютере разработки, он считается удаленным экземпляром. В этих учебниках мы использовали локальные экземпляры SQL Server. Отладка хранимых процедур на удаленном экземпляре SQL server требует дополнительных шагов настройки, чем при отладке хранимых процедур на локальном экземпляре.

Если вы используете локальный экземпляр SQL Server, можно начать с шага 1 и работе этого учебника до конца. При использовании удаленного экземпляра SQL Server, тем не менее, необходимо сначала необходимо убедиться, что при отладке вы выполнили вход в систему на компьютере с учетной записью пользователя Windows, который имеет имя входа SQL Server на удаленном экземпляре. Moveover, это имя входа базы данных и имя входа базы данных, используемое для подключения к базе данных из работающего приложения ASP.NET должны быть членами группы `sysadmin` роли. Объекты базы данных отладки T-SQL на раздел удаленных экземпляров см. в конце этого учебника, Дополнительные сведения о настройке Visual Studio и SQL Server для отладки на удаленном экземпляре.

Наконец понимать, что отладка поддержки для объектов базы данных T-SQL не как функция широкие возможности, как отладка поддержку для приложений .NET. Например, условия точек останова и фильтры не поддерживаются, подмножество окон отладки доступны только изменить и продолжить невозможно использовать, окно "Интерпретация" отображается бесполезными и т. д. В разделе [ограничения на команды и функции отладчика](https://msdn.microsoft.com/library/ms165035(VS.80).aspx) для получения дополнительной информации.

## <a name="step-1-directly-stepping-into-a-stored-procedure"></a>Шаг 1: Непосредственно шаг с заходом в хранимую процедуру

Visual Studio позволяет легко непосредственно отладки объекта базы данных. Разрешить s рассмотрим, как использовать функцию прямой отладки базы данных (DDD) выполнять шаги с заходом `Products_SelectByCategoryID` хранимой процедуры в базе данных Northwind. Как и предполагает его имя, `Products_SelectByCategoryID` возвращает сведения о продукте для определенной категории; она была создана в [существующих хранимых процедур для типизированного набора данных s адаптеры таблиц TableAdapter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) учебника. Запуск, перейдите в обозреватель серверов и разверните узел базы данных "Борей". Далее углубляться в папке Stored Procedures, щелкните правой кнопкой мыши `Products_SelectByCategoryID` хранимой процедуры и выберите в контекстном меню шаг с заходом сохраненная процедура. Будет запущен отладчик.

Поскольку `Products_SelectByCategoryID` ожидаемыми хранимой процедурой `@CategoryID` входного параметра, нас просят указать это значение. Введите 1, который будет возвращать сведения о напитков.


![Используйте значение 1 для @CategoryID параметр](debugging-stored-procedures-vb/_static/image1.png)

**Рис. 1**: используйте значение 1 для `@CategoryID` параметр


После указания значения для `@CategoryID` выполняется параметра хранимой процедуры. А не выполнится до конца, отладчик останавливает выполнение на первой инструкции. Обратите внимание, желтая стрелка на поле, указывающее текущее расположение в хранимой процедуре. Можно просматривать и изменять значения параметров в окне контрольных значений, так и при наведении указателя мыши на имя параметра в хранимой процедуре.


[![Произошла остановка отладчика на первой инструкции хранимой процедуры](debugging-stored-procedures-vb/_static/image3.png)](debugging-stored-procedures-vb/_static/image2.png)

**На рисунке 2**: отладчиком остановлена на первой инструкции хранимой процедуры ([Просмотр полноразмерное изображение](debugging-stored-procedures-vb/_static/image4.png))


Для пошагового выполнения одного оператора хранимой процедуры одновременно, нажмите кнопку «шаг с обходом» на панели инструментов или нажмите клавишу F10. `Products_SelectByCategoryID` Хранимая процедура содержит единственный `SELECT` инструкции, поэтому F10 будет перейти к одной инструкции и завершения выполнения хранимой процедуры. После завершения хранимой процедуры, выходные данные будут отображаться в окне вывода и отладчик будет завершена.

> [!NOTE]
> Отладку T-SQL происходит на уровне инструкций; не удается шаг с заходом `SELECT` инструкции.


## <a name="step-2-configuring-the-website-for-application-debugging"></a>Шаг 2: Настройка веб-сайта для отладки приложения

Хотя отладка хранимой процедуры непосредственно из обозревателя серверов под рукой, во многих сценариях нас интересуют более отладку хранимой процедуры, при вызове из нашего приложения ASP.NET. Мы можно добавлять точки останова в хранимую процедуру из среды Visual Studio и затем запустите отладку приложения ASP.NET. При вызове хранимой процедуры с точками останова в приложении выполнение будет остановлено в точке останова, и мы просмотреть и изменить значения параметров для хранимой процедуры s и пошаговое выполнение его операторов так же, как мы делали на шаге 1.

Прежде чем мы можем запустить отладку хранимой процедуры, вызванные из приложения, необходимо настроить веб-приложение ASP.NET для интеграции с помощью отладчика SQL Server. Начните с правой кнопкой мыши имя веб-сайта в обозревателе решений (`ASPNET_Data_Tutorial_74_VB`). Выберите параметр страницы свойств в контекстном меню, выберите элемент "Параметры запуска" слева и установите флажок SQL Server в разделе отладчики (см. рис. 3).


[![Установите флажок SQL Server на странице свойств приложения s](debugging-stored-procedures-vb/_static/image6.png)](debugging-stored-procedures-vb/_static/image5.png)

**Рис. 3**: установите флажок SQL Server в приложение s страницы свойств ([Просмотр полноразмерное изображение](debugging-stored-procedures-vb/_static/image7.png))


Кроме того необходимо обновить строку подключения базы данных, используемые приложением, чтобы пул подключений отключен. Когда закрывается соединение с базой данных, соответствующий `SqlConnection` объект помещается в пул доступных подключений. При установке подключения к базе данных, доступные подключения объекта могут быть получены из этого пула вместо того, чтобы создать и установить новое соединение. Объединения в пул объектов подключения для повышения производительности и включена по умолчанию. Тем не менее при отладке мы хотим отключить пул подключений, поскольку инфраструктура отладки не восстанавливаются правильно при работе с подключением, полученным из пула.

Для пулов соединений отключено, обновите `NORTHWNDConnectionString` в `Web.config` , чтобы оно включало параметр `Pooling=false` .


[!code-xml[Main](debugging-stored-procedures-vb/samples/sample1.xml)]

> [!NOTE]
> После завершения отладки SQL Server в приложении ASP.NET не забудьте возобновить использование пулов соединений, удалив `Pooling` из строки подключения (или присвоив ему значение `Pooling=true` ).


На этом этапе приложение ASP.NET настроена позволяет Visual Studio для отладки объектов базы данных SQL Server, при вызове с помощью веб-приложения. Этап — добавьте точку останова в хранимую процедуру и начните отладку!

## <a name="step-3-adding-a-breakpoint-and-debugging"></a>Шаг 3: Добавление точки останова и отладка

Откройте `Products_SelectByCategoryID` хранимой процедуры и установите точку останова в начале `SELECT` инструкции, щелкнув в поле в соответствующее место или поместив курсор в начале `SELECT` инструкции и нажав клавишу F9. Как показано на рис. 4, точка останова отображается красный круг на поле.


[![Установите точку останова в Products_SelectByCategoryID хранимой процедуры](debugging-stored-procedures-vb/_static/image9.png)](debugging-stored-procedures-vb/_static/image8.png)

**Рис. 4**: установите точку останова в `Products_SelectByCategoryID` хранимой процедуры ([Просмотр полноразмерное изображение](debugging-stored-procedures-vb/_static/image10.png))


Чтобы объект базы данных SQL для отладки через клиентское приложение крайне важно, базы данных были настроены для поддержки отладки приложений. Если сначала установить точку останова, этот параметр должен быть автоматически переключаются, но целесообразно следует внимательно. Щелкните правой кнопкой мыши `NORTHWND.MDF` узел в обозревателе серверов. В контекстном меню следует включить checked команды отладки приложения.


![Убедитесь, что включен параметр отладки приложения](debugging-stored-procedures-vb/_static/image11.png)

**Рис. 5**: Убедитесь, что включен параметр отладки приложения


С набором точек останова и включенным параметром отладки приложения мы готовы выполнить отладку хранимой процедуры, при вызове из приложения ASP.NET. Запустите отладчик, перейдите в меню "Отладка" и выбрав начать отладку, нажав F5 или с помощью кнопки воспроизведения значок на панели инструментов. Это будет запустить отладчик и запуска веб-сайта.

`Products_SelectByCategoryID` Хранимая процедура была создана в [существующих хранимых процедур для типизированного набора данных s адаптеры таблиц TableAdapter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) учебника. Его соответствующей веб-страницы (`~/AdvancedDAL/ExistingSprocs.aspx`) содержит GridView, отображающий результаты, возвращаемые этой хранимой процедуры. Посетите эту страницу в браузере. После достижения страницы, точки останова в `Products_SelectByCategoryID` хранимая процедура будет достигнута и управление вернется к Visual Studio. Так же, как на шаге 1, можно пройти по операторы s хранимые процедуры и представления и измените значения параметров.


[![На странице ExistingSprocs.aspx сначала отображает напитков](debugging-stored-procedures-vb/_static/image13.png)](debugging-stored-procedures-vb/_static/image12.png)

**Рис. 6**: `ExistingSprocs.aspx` страницы сначала отображает напитков ([Просмотр полноразмерное изображение](debugging-stored-procedures-vb/_static/image14.png))


[![Хранимая процедура s был достигнут точки останова](debugging-stored-procedures-vb/_static/image16.png)](debugging-stored-procedures-vb/_static/image15.png)

**Рис. 7**: s хранимой процедуры при достижении точки останова ([Просмотр полноразмерное изображение](debugging-stored-procedures-vb/_static/image17.png))


В окне контрольных значений в показано на рис. 7, значение `@CategoryID` параметр равен 1. Это вызвано `ExistingSprocs.aspx` страницы изначально отображает продукты в категории "Напитки", которая имеет `CategoryID` значение 1. Выберите другую категорию из раскрывающегося списка. Это вызывает обратную передачу и повторно выполняет `Products_SelectByCategoryID` хранимой процедуры. Останова еще раз, но на этот раз `@CategoryID` параметр s значение отражает выбранного раскрывающегося списка элемент s `CategoryID`.


[![Выберите другую категорию из раскрывающегося списка](debugging-stored-procedures-vb/_static/image19.png)](debugging-stored-procedures-vb/_static/image18.png)

**Рис. 8**: выберите другую категорию из раскрывающегося списка ([Просмотр полноразмерное изображение](debugging-stored-procedures-vb/_static/image20.png))


[![@CategoryID Параметр отражает категории, выбранные из веб-страницы](debugging-stored-procedures-vb/_static/image22.png)](debugging-stored-procedures-vb/_static/image21.png)

**Рис. 9**: `@CategoryID` параметр отражает выбранных категорий из веб-страницы ([Просмотр полноразмерное изображение](debugging-stored-procedures-vb/_static/image23.png))


> [!NOTE]
> Если точка останова в `Products_SelectByCategoryID` хранимой процедуры не срабатывает при посещении `ExistingSprocs.aspx` убедитесь, что флажок SQL Server была возвращена отладчиков s страница свойств приложения ASP.NET, успешного пулов соединений отключена и включения базы данных s параметр отладки приложения. Если вы по-прежнему возникают проблемы, перезапустите Visual Studio и повторите попытку.


## <a name="debugging-t-sql-database-objects-on-remote-instances"></a>Отладка объектов базы данных T-SQL в удаленных экземплярах

Отладки объектов базы данных с помощью Visual Studio, достаточно просто, если экземпляр базы данных SQL Server, находится на том же компьютере, что и Visual Studio. Однако если SQL Server и Visual Studio находятся на разных компьютерах некоторые внимательной настройки требуется сделать все работает правильно. Существует два основных задач, которые мы столкнулись с необходимостью.

- Убедитесь, что имя входа, используемое для подключения к базе данных через ADO.NET принадлежит `sysadmin` роли.
- Убедитесь, что учетной записи пользователя Windows, используемый в Visual Studio на компьютере разработчика допустимую учетную запись входа SQL Server, которой принадлежит `sysadmin` роли.

Первым шагом является относительно просто. Во-первых, определите учетную запись для подключения к базе данных из приложения ASP.NET и добавьте из SQL Server Management Studio, учетную запись входа для `sysadmin` роли.

Вторая задача требует учетную запись пользователя Windows, который используется для отладки приложения является допустимым именем входа в удаленную базу данных. Тем не менее скорее всего, учетная запись Windows, которую вы вошли в систему рабочей станции с не является допустимым именем входа на SQL Server. Вместо того, чтобы добавить свою учетную запись конкретного имени входа SQL Server, лучше было бы назначить некоторые учетной записи пользователя Windows в качестве учетной записи SQL Server для отладки. Затем отладки объектов базы данных удаленного экземпляра SQL Server, вы запускаете Visual Studio, с помощью этой учетной записи s учетные данные входа Windows.

Пример следует уточнить вещей. Представьте, что учетной записи Windows с именем `SQLDebug` в домене Windows. Эта учетная запись будет необходимо добавить к удаленному экземпляру SQL Server является допустимым именем входа, а член `sysadmin` роли. Затем, чтобы выполнить отладку удаленного экземпляра SQL Server из Visual Studio, мы необходимо запустить Visual Studio в качестве `SQLDebug` пользователя. Это можно сделать, выполнив вход из наших рабочей станции входа в систему в качестве `SQLDebug`, и затем запустив Visual Studio, но более простой подход будет войти в наш рабочую станцию с помощью собственных учетных данных, а затем использовать `runas.exe` для запуска Visual Studio в качестве `SQLDebug` пользователя. `runas.exe`позволяет конкретного приложения для выполнения под прикрытием другой учетной записью. Чтобы запустить Visual Studio в качестве `SQLDebug`, можно ввести следующую инструкцию в командной строке:


[!code-console[Main](debugging-stored-procedures-vb/samples/sample2.cmd)]

Более подробное описание на этом процессе см. в разделе [Вон R. Уильям](http://betav.com/BLOG/billva/) s *дал s руководства по Visual Studio и SQL Server, выпуск седьмой* производительны, чем [How To: Настройка разрешений SQL Server для отладки](https://msdn.microsoft.com/library/w1bhybwz(VS.80).aspx).

> [!NOTE]
> Если ваш компьютер для разработки работает под управлением Windows XP Service Pack 2 будет необходимо настроить брандмауэр подключения к Интернету, чтобы разрешить удаленную отладку. [Как для: отладки SQL Server 2005](https://msdn.microsoft.com/library/s0fk6z6e(VS.80).aspx) статье заметки о том, что это происходит в два этапа: (a) на хост-компьютере Visual Studio, необходимо добавить `Devenv.exe` в список исключений и откройте порт TCP 135; и (б) на удаленном компьютере (SQL), необходимо открыть TCP 135 порта и добавить `sqlservr.exe` в список исключений. Если политика домена требует сетевого взаимодействия, чтобы сделать с помощью IPSec, необходимо открыть порты UDP 4500 и UDP 500.


## <a name="summary"></a>Сводка

Помимо поддержки отладки для кода приложения .NET, Visual Studio также предоставляет разнообразные параметры отладки для SQL Server 2005. В этом учебнике мы рассмотрели два из этих параметров: прямой отладки базы данных и отладки приложения. Для прямой отладки объекта базы данных T-SQL, найдите объект через обозреватель серверов, щелкните его правой кнопкой мыши и выберите шаг с заходом. Это запускает отладчик и останавливается на первой инструкции в объекте базы данных на этом этапе можно пошагово инструкций s объекта и представления и изменения значений параметров. На шаге 1, мы использовали этот подход выполнять шаги с заходом `Products_SelectByCategoryID` хранимой процедуры.

Отладка приложения позволяет ставить точки останова непосредственно в объекты базы данных. При вызове объекта базы данных с точками останова из клиентского приложения (например, веб-приложения ASP.NET), программа останавливается, как отладчик переходит. Отладка приложения полезно, поскольку более четко показывает, какое действие приложения вызывает объекта определенной базы данных должен быть вызван. Однако он требует более Установка и настройка чем прямой отладки базы данных.

Также возможна отладка объектов базы данных через проекты SQL Server. Мы рассмотрим использование проектов SQL Server, и способ их использования для создания и отладки управляемых объектов базы данных в следующем уроке.

Программирование довольны!

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года. Скотт — независимый консультант, trainer и записи. Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [http://ScottOnWriting.NET](http://ScottOnWriting.NET).

>[!div class="step-by-step"]
[Назад](protecting-connection-strings-and-other-configuration-information-vb.md)
[Вперед](creating-stored-procedures-and-user-defined-functions-with-managed-code-vb.md)
