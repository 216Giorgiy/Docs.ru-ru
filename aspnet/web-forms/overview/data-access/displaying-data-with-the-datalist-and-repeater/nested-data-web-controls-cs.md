---
uid: web-forms/overview/data-access/displaying-data-with-the-datalist-and-repeater/nested-data-web-controls-cs
title: Вложенные данные веб-элементов управления (C#) | Документы Microsoft
author: rick-anderson
description: В данном руководстве, мы рассмотрим способы использования повторитель вложена в другую повторителя. Примеры иллюстрируют заполнения внутреннего повторителя обоих d...
ms.author: aspnetcontent
manager: wpickett
ms.date: 09/13/2006
ms.topic: article
ms.assetid: ad3cb0ec-26cf-42d7-b81b-184a34ec9f86
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/displaying-data-with-the-datalist-and-repeater/nested-data-web-controls-cs
msc.type: authoredcontent
ms.openlocfilehash: 4957f555691efaeaafa5bcf92141e0bef1cb1de9
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="nested-data-web-controls-c"></a>Вложенные данные веб-элементов управления (C#)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить пример приложения](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_32_CS.exe) или [скачать PDF](nested-data-web-controls-cs/_static/datatutorial32cs1.pdf)

> В данном руководстве, мы рассмотрим способы использования повторитель вложена в другую повторителя. Примеры иллюстрируют заполнения внутреннего повторителя декларативно и программно.


## <a name="introduction"></a>Вступление

Помимо статического HTML и синтаксис привязки данных шаблоны могут также включать веб-элементы управления и пользовательские элементы управления. Эти веб-элементы управления могут иметь их свойства назначаемая декларативный, синтаксис привязки данных или может осуществляться программными средствами в соответствующие серверные обработчики событий.

Путем внедрения элементов управления в шаблоне, могут быть настроены и улучшенные средства внешний вид и взаимодействия с пользователем. Например, в [с помощью TemplateFields в элементе управления GridView](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) учебника, мы узнали, как для настройки отображения s GridView путем добавления элемента управления календаря в TemplateField для отображения s Дата найма сотрудника, а в [Добавление Проверяющие элементы управления для редактирования и вставка интерфейсов](../editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md) и [Настройка интерфейса изменения данных](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) учебники, мы узнали, как настроить редактирование и вставка интерфейсов путем добавления проверки элементы управления, текстовые поля, элементами управления DropDownList и других веб-элементов управления.

Шаблоны также может содержать другие данные веб-элементов управления. Это значит мы может быть DataList, содержащий другой DataList (или повторителя или GridView или DetailsView и так далее) в пределах его шаблонов. Задача при такой интерфейс привязан соответствующие данные внутренние данные веб-элемента управления. Существует несколько разных подходов, от декларативной параметрами, используя элемент управления ObjectDataSource программный из них.

В данном руководстве, мы рассмотрим способы использования повторитель вложена в другую повторителя. Внешнее повторителя будет содержать элемент для каждой категории в базе данных, отображение s название и описание категории. Каждого элемента категории s внутреннее повторителя отобразит сведения о каждом товаре, принадлежащих к этой категории (см. рис. 1) в виде маркированного списка. Наши примеры иллюстрируют заполнения внутреннего повторителя декларативно и программно.


[![Перечислены каждой категории вместе с его продуктов](nested-data-web-controls-cs/_static/image2.png)](nested-data-web-controls-cs/_static/image1.png)

**Рис. 1**: каждой категории вместе с свои продукты перечислены ([Просмотр полноразмерное изображение](nested-data-web-controls-cs/_static/image3.png))


## <a name="step-1-creating-the-category-listing"></a>Шаг 1: Создание списка категорий

При построении страницы, использующей вложенных данных веб-элементов управления, я полезны для разработки, создания и тестирования внешней веб-управления во-первых, защищающим даже внутреннего вложенного элемента управления. Таким образом позволяют запустить путем прохода шаги добавить на страницу, на которой указаны имя и описание для каждой категории повторитель s.

Сначала откройте `NestedControls.aspx` страницы в `DataListRepeaterBasics` папки и добавьте на страницу параметра управления повторителем его `ID` свойства `CategoryList`. Выберите повторителя s смарт-тег создать новый элемент управления ObjectDataSource с именем `CategoriesDataSource`.


[![Имя нового ObjectDataSource CategoriesDataSource](nested-data-web-controls-cs/_static/image5.png)](nested-data-web-controls-cs/_static/image4.png)

**На рисунке 2**: имя нового ObjectDataSource `CategoriesDataSource` ([Просмотр полноразмерное изображение](nested-data-web-controls-cs/_static/image6.png))


Настройте элемент управления ObjectDataSource таким образом, чтобы он извлекает данные из `CategoriesBLL` класса s `GetCategories` метод.


[![Настройка ObjectDataSource использовать метод GetCategories класса CategoriesBLL s](nested-data-web-controls-cs/_static/image8.png)](nested-data-web-controls-cs/_static/image7.png)

**Рис. 3**: Настройка ObjectDataSource для использования `CategoriesBLL` класса s `GetCategories` метод ([Просмотр полноразмерное изображение](nested-data-web-controls-cs/_static/image9.png))


Чтобы указать шаблон повторителя s содержимого необходимо перейти в представление источника и вручную ввести декларативного синтаксиса. Добавить `ItemTemplate` , отображает имя категории s в `<h4>` элемент и описание категории s в элементе абзаца (`<p>`). Кроме того, позволяют s их нужно разделять каждой категории горизонтальную линию (`<hr>`). После внесения этих изменений на странице должен содержать декларативного синтаксиса для повторителя и ObjectDataSource, аналогичный следующему:


[!code-aspx[Main](nested-data-web-controls-cs/samples/sample1.aspx)]

На рисунке 4 показаны ход работы при просмотре через браузер.


[![Каждая категория s имя и описание присутствует в списке, разделенных горизонтальную линию](nested-data-web-controls-cs/_static/image11.png)](nested-data-web-controls-cs/_static/image10.png)

**Рис. 4**: s каждой категории имя и описание присутствует в списке, разделенных горизонтальную линию ([Просмотр полноразмерное изображение](nested-data-web-controls-cs/_static/image12.png))


## <a name="step-2-adding-the-nested-product-repeater"></a>Шаг 2: Добавление повторителя вложенных продукта

Теперь нам с категорией, список завершения, является добавление повторителя для `CategoryList` s `ItemTemplate` , отображающее сведения об этих продуктах, относящихся к соответствующей категории. Существует несколько способов для этого внутреннего повторителя, два из которых мы изучим скоро можно будет получить данные. Теперь позволяют s просто создать повторителя продукты в `CategoryList` повторителя s `ItemTemplate`. В частности позволяют s имеют повторителя отображения каждого продукта в виде маркированного списка с каждым элемент списка, включая имя продукта s и цену продукта.

Чтобы создать этот повторителя, необходимо вручную ввести внутреннее повторителя s декларативный синтаксис и шаблоны в `CategoryList` s `ItemTemplate`. Добавьте следующую разметку в `CategoryList` повторителя s `ItemTemplate`:


[!code-aspx[Main](nested-data-web-controls-cs/samples/sample2.aspx)]

## <a name="step-3-binding-the-category-specific-products-to-the-productsbycategorylist-repeater"></a>Шаг 3: Привязка повторителя ProductsByCategoryList категориям продуктов

Если на этом этапе посетите страницу через браузер, экрана выглядит таким же, как показано на рис. 4 так как мы хранять еще для привязки данных повторителя. Существует несколько способов, мы захватить записи соответствующих продуктов и привязывать их к повторителя некоторые более эффективно, чем другие. Основная сложность здесь является получение соответствующих продуктов для определенной категории.

Данные для привязки к внутренним управления повторителем либо доступно декларативно, через ObjectDataSource в `CategoryList` повторителя s `ItemTemplate`, или программно, на странице ASP.NET страницы s кода. Аналогичным образом, эти данные могут быть привязаны к внутренним повторителя либо декларативно - через внутренний повторителя s `DataSourceID` свойства или посредством синтаксиса декларативной привязки данных, или программно, ссылаясь на внутреннем повторителя в `CategoryList` повторителя s `ItemDataBound` обработчик событий, программной настройке его `DataSource` свойства и вызвать его `DataBind()` метод. Позволяет просмотреть каждый из этих подходов s.

## <a name="accessing-the-data-declaratively-with-an-objectdatasource-control-and-theitemdataboundevent-handler"></a>Доступ к данным, декларативно с помощью элемента управления ObjectDataSource и`ItemDataBound`обработчика событий

Поскольку мы открывалось ObjectDataSource широко на протяжении этого учебника ряда самым естественным выбором для доступа к данным в этом примере используются для покидайте ObjectDataSource. `ProductsBLL` Класс имеет `GetProductsByCategoryID(categoryID)` метод, возвращающий сведения об этих продуктов, относящихся к заданному *`categoryID`*. Таким образом, можно добавить элемент управления ObjectDataSource `CategoryList` повторителя s `ItemTemplate` и настройте его для доступа к данным из этого метода класса s.

К сожалению повторителя разрешает его шаблоны для редактирования в режиме конструктора, поэтому необходимо вручную добавить декларативный синтаксис для этого элемента управления ObjectDataSource. В следующем показан синтаксис `CategoryList` повторителя s `ItemTemplate` после добавления этой новой ObjectDataSource (`ProductsByCategoryDataSource`):


[!code-aspx[Main](nested-data-web-controls-cs/samples/sample3.aspx)]

При использовании подхода ObjectDataSource нам нужно указать `ProductsByCategoryList` повторителя s `DataSourceID` свойства `ID` из ObjectDataSource (`ProductsByCategoryDataSource`). Кроме того, обратите внимание, что наши ObjectDataSource имеет `<asp:Parameter>` элемент, который задает *`categoryID`* значение, которое будет передано в `GetProductsByCategoryID(categoryID)` метод. Но, как следует указывать это значение? В идеальном случае d мы сможем просто установите `DefaultValue` свойство `<asp:Parameter>` элемента, используя синтаксис привязки данных, следующим образом:


[!code-aspx[Main](nested-data-web-controls-cs/samples/sample4.aspx)]

К сожалению, привязка данных синтаксис является допустимым только в элементах управления, которые имеют `DataBinding` событий. `Parameter` Класса нет такого события, и поэтому указанный выше синтаксис является недопустимым и приведет к ошибке времени выполнения.

Чтобы задать это значение, необходимо создать обработчик событий для `CategoryList` повторителя s `ItemDataBound` событий. Помните, что `ItemDataBound` событие запускается один раз для каждого элемента, привязанный к повторителя. Таким образом, каждый раз, это событие вызывается для внешнего повторителя можно назначить текущий `CategoryID` значение `ProductsByCategoryDataSource` ObjectDataSource s `CategoryID` параметра.

Создайте обработчик событий для `CategoryList` повторителя s `ItemDataBound` событий следующим кодом:


[!code-csharp[Main](nested-data-web-controls-cs/samples/sample5.cs)]

Этот обработчик событий запускает за счет того, мы повторно с данными элемента вместо элемента заголовка, нижнего колонтитула или разделитель. Далее мы ссылаться на фактический `CategoriesRow` экземпляр, который привязан только к текущему `RepeaterItem`. Наконец, мы ссылку ObjectDataSource в `ItemTemplate` и назначить его `CategoryID` значение параметра для `CategoryID` текущего `RepeaterItem`.

Этот обработчик событий `ProductsByCategoryList` повторителя в каждом `RepeaterItem` привязан к эти продукты из `RepeaterItem` категории. Рис. 5 показан снимок экрана полученный результат.


[![Внешнее повторителя перечислены каждой категории; Один внутренний перечислены продукты для этой категории](nested-data-web-controls-cs/_static/image14.png)](nested-data-web-controls-cs/_static/image13.png)

**Рис. 5**: внешнее повторителя перечислены каждой категории; списки один внутренний продукты для этой категории ([Просмотр полноразмерное изображение](nested-data-web-controls-cs/_static/image15.png))


## <a name="accessing-the-products-by-category-data-programmatically"></a>Доступ к продукты по категориям данных программным способом

Для получения продуктов для данной категории вместо ObjectDataSource удалось создать метод в нашей ASP.NET s кода класса страницы (или в `App_Code` папку или в отдельном проекте библиотеки классов), возвращает соответствующий набор продукты, в случае передачи `CategoryID`. Предположим, имеется такой метод в классе кода страницы s нашей ASP.NET и он назывался `GetProductsInCategory(categoryID)`. С помощью этого метода в месте мы привязки для данной категории продуктов для внутреннего повторителя, используя следующий синтаксис:


[!code-aspx[Main](nested-data-web-controls-cs/samples/sample6.aspx)]

Повторителя s `DataSource` свойство использует синтаксис привязки данных для указания, что его данные извлекаются из `GetProductsInCategory(categoryID)` метод. Поскольку `Eval("CategoryID")` возвращает значение типа `Object`, мы приведите объект к `Integer` перед передачей его в `GetProductsInCategory(categoryID)` метод. Обратите внимание, что `CategoryID` доступа через привязку данных синтаксис вот `CategoryID` в *внешнего* повторителя (`CategoryList`), один s привязаны к записям в `Categories` таблицы. Таким образом, мы знаем, что `CategoryID` не может быть базой данных `NULL` значение, поэтому мы просто можно привести `Eval` метод без проверки, если мы re задействования `DBNull`.

В этом случае потребуется создать `GetProductsInCategory(categoryID)` метода и его получения соответствующего набора продуктов, учитывая предоставленного *`categoryID`*. Это можно сделать путем простого возврата `ProductsDataTable` возвращенных `ProductsBLL` класса s `GetProductsByCategoryID(categoryID)` метод. Разрешить создание s `GetProductsInCategory(categoryID)` метод в класс кода программной части для наших `NestedControls.aspx` страницы. Сделать с помощью следующего кода.


[!code-csharp[Main](nested-data-web-controls-cs/samples/sample7.cs)]

Этот метод просто создает экземпляр `ProductsBLL` метод и возвращает результаты `GetProductsByCategoryID(categoryID)` метод. Обратите внимание, что метод должен быть помечен `Public` или `Protected`; Если метод помечен `Private`, он не будет доступен из декларативная разметка страницы s ASP.NET.

После внесения этих изменений, чтобы использовать этот новый метод, занять некоторое время, чтобы перейти на страницу с помощью браузера. Выходные данные должны быть идентичны выходные данные при использовании ObjectDataSource и `ItemDataBound` подход обработчик событий (указывают назад см. снимок экрана рис. 5).

> [!NOTE]
> Это может показаться busywork для создания `GetProductsInCategory(categoryID)` метод в классе страницы s фонового кода ASP.NET. В конце концов, этот метод просто создает экземпляр `ProductsBLL` и возвращает результаты его `GetProductsByCategoryID(categoryID)` метод. Почему нельзя просто вызвать этот метод напрямую с помощью синтаксиса привязки данных в внутреннее повторителя как: `DataSource='<%# ProductsBLL.GetProductsByCategoryID((int)(Eval("CategoryID"))) %>'`? Несмотря на то, что этот синтаксис выиграл, не работают с нашей текущей реализации `ProductsBLL` класса (с момента `GetProductsByCategoryID(categoryID)` метод является методом экземпляра), можно изменить `ProductsBLL` включать статический `GetProductsByCategoryID(categoryID)` метода или сделайте включают статическийкласс`Instance()` метод для возврата нового экземпляра `ProductsBLL` класса.


Хотя такие изменения будут отпадает необходимость `GetProductsInCategory(categoryID)` метод в классе фонового кода ASP.NET страницы s метод класса кода программной дает большую гибкость при работе с полученными данными, которые мы рассмотрим чуть ниже.

## <a name="retrieving-all-of-the-product-information-at-once"></a>Извлекает все данные продукта за один раз

Два различных способа предшествующую мы хранять проверить удерживая эти продукты для данной категории вызова `ProductsBLL` класса s `GetProductsByCategoryID(categoryID)` метод (первый подход сделал это с помощью ObjectDataSource второй, третий `GetProductsInCategory(categoryID)` метод в класс кода программной части). При каждом вызове этого метода, вызовы уровня бизнес-логики до уровня доступа к данным, который запрашивает базу данных инструкцией SQL, которая возвращает строки из `Products` таблица, `CategoryID` поле соответствует указанный входной параметр.

Получает *N* категории в системе, этот подход сравнивается *N* + 1 вызывает одну базу данных в базу данных запрос для получения всех категорий и затем *N* вызовы для получения продуктов применяется только к каждой категории. Тем не менее, мы получающий все необходимые данные в одном вызове вызывает только две базы данных для получения всех категорий, а другой для получения всех продуктов. После получения всех продуктов, эти продукты можно отфильтровать таким образом, только те продукты, соответствующие текущим `CategoryID` привязаны к этой категории s внутреннее повторителя.

Для поддержки этой функции, нам нужно только внести небольшие изменения `GetProductsInCategory(categoryID)` метод в классе кода страницы s нашей ASP.NET. Вместо того чтобы вслепую возвращение результатов `ProductsBLL` класса s `GetProductsByCategoryID(categoryID)` метод, мы можем вместо сначала получить доступ к *все* продуктов (если они не удалось t был доступ к уже), а затем возвращают только отфильтрованное представление на основе продуктов на переданный `CategoryID`.


[!code-csharp[Main](nested-data-web-controls-cs/samples/sample8.cs)]

Обратите внимание, добавление переменной уровня страницы `allProducts`. Содержит сведения обо всех продуктах и заполняется первый раз `GetProductsInCategory(categoryID)` вызывается метод. Убедившись, что `allProducts` объект создан и заполняется, метод фильтрует результаты s DataTable таким образом, что только те строки, `CategoryID` соответствует указанному `CategoryID` доступны. Этот подход уменьшает количество раз, базы данных осуществляется через *N* + 1 до двух.

Это улучшение не вносит изменений для отображения разметки страницы, а также перевести обратно меньше записей, чем другие подходы. Он просто уменьшает количество вызовов к базе данных.

> [!NOTE]
> Один интуитивно причин, что уменьшение числа обращений к базе данных несомненно улучшило бы производительность. Тем не менее это может оказаться так. При наличии большого числа продуктов, `CategoryID` — `NULL`, для примера, то вызов `GetProducts` метод возвращает количество продуктов, которые никогда не отображаются. Кроме того, возвращение всех продуктов, может быть затратные Если вы повторно отображаются только подмножество категории, которые могут случиться, если вы применили разбиения на страницы.


Как всегда, когда дело доходит до анализ производительности из двух технологий, только всегда проходила на ура мер является управляемой тесты для вашего приложения s распространенных сценариев.

## <a name="summary"></a>Сводка

В этом учебнике мы узнали, как вкладывать один веб-управления данными в другую, в частности Проверка способа получения внешнего повторителя отображается элемент, для каждой категории с внутренним повторителя, список продуктов в каждой категории, в виде маркированного списка. Основная сложность в создание вложенных пользовательского интерфейса заключается в доступе к и привязка к веб-элемент управления данных внутренний правильные данные. Существует широкий набор методов, два из которых мы рассмотрели в этом учебнике. Первый подход просмотренных используется ObjectDataSource в данные внешнего веб-элемент управления s `ItemTemplate` , был привязан к веб-элемент управления данных внутренний через его `DataSourceID` свойство. Второй способ получить доступ к данным через метод в класс кода программной s страницы ASP.NET. Затем этот метод можно привязать к внутренним данным веб-элемент управления s `DataSource` свойства через синтаксис привязки данных.

При работе с вложенной пользовательского интерфейса, которые проверяются в этом учебнике повторитель вложены повторитель, эти методы можно использовать для других элементов управления Web данных. Можно вкладывать друг в друга повторителя в элементе управления GridView или GridView в DataList и так далее.

Программирование довольны!

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года. Скотт — независимый консультант, trainer и записи. Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).

## <a name="special-thanks-to"></a>Благодарности

Этот учебник ряд прошел проверку многие полезные рецензентов. Основными редакторами этого учебника были Зак Джонс и (Liz Shulok). Объясняются моих последующих статей для MSDN? Если Да, напишите мне по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)

> [!div class="step-by-step"]
> [Назад](showing-multiple-records-per-row-with-the-datalist-control-cs.md)
> [Вперед](displaying-data-with-the-datalist-and-repeater-controls-vb.md)
