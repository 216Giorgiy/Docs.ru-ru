---
uid: web-forms/overview/data-access/displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs
title: "Форматирование DataList и повторителя на основе данных (C#) | Документы Microsoft"
author: rick-anderson
description: "В этом учебнике предстоит пошаговый примеры как мы изменить внешний вид элементов управления DataList и повторителя, либо с помощью функции форматирования с..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 09/13/2006
ms.topic: article
ms.assetid: 83e3d759-82b8-41e6-8d62-f0f4b3edec41
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs
msc.type: authoredcontent
ms.openlocfilehash: 6e5bc0d9ac26801f48560cf07d4a0ab3854d5f74
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="formatting-the-datalist-and-repeater-based-upon-data-c"></a>Форматирование DataList и повторителя на основе данных (C#)
====================
по [Скотт Митчелл](https://twitter.com/ScottOnWriting)

[Загрузить пример приложения](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_30_CS.exe) или [скачать PDF](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/datatutorial30cs1.pdf)

> В этом учебнике предстоит пошагово примеры как мы изменить внешний вид элементов управления DataList и повторителя, либо с помощью функции форматирования в шаблонах, либо путем обработки события с привязкой к данным.


## <a name="introduction"></a>Вступление

Как упоминалось в предыдущем учебнике DataList предлагает ряд свойств, относящихся к стилю, определяющие его внешний вид. В частности, мы узнали, как назначить по умолчанию классы CSS к элементу управления DataList s `HeaderStyle`, `ItemStyle`, `AlternatingItemStyle`, и `SelectedItemStyle` свойства. В дополнение к эти четыре свойства DataList включает ряд других относящихся к стилю свойств, таких как `Font`, `ForeColor`, `BackColor`, и `BorderWidth`, Вот некоторые из них. Элементе управления повторителем не содержит все свойства, связанные со стилем. Значения этих параметров стиля должно выполняться непосредственно в разметку в шаблонах s повторителя.

Часто, способ форматирования данных зависит от самих данных. Например, при отображении списка продуктов мы может потребоваться отобразить сведения о продукте в светло-серый цвет, если он больше не поддерживается, или нужно выделить `UnitsInStock` значение, если это значение равно нулю. Как было показано в предыдущих учебниках, GridView, DetailsView и FormView имеют два различных способа форматирования их внешний вид на основе своих данных.

- **`DataBound` Событий** создайте обработчик событий для соответствующей `DataBound` событие, которое возникает после привязки данных для каждого элемента (для GridView, она была `RowDataBound` события; для DataList и повторителя это `ItemDataBound`событий). В этом случае можно проверить обработчик только данные, привязанные и принятие решений о форматировании его. Мы рассмотрели этот прием в [форматирование на основе по данным](../custom-formatting/custom-formatting-based-upon-data-cs.md) учебника.
- **Функций в шаблонах форматирования** при использовании TemplateFields в элементы управления DetailsView или GridView или шаблона в элементе управления FormView, можно добавить в класс фонового кода ASP.NET страницы s, уровень бизнес-логики или любые функции форматирования другие библиотеки классов, доступного из веб-приложения. Эта функция форматирования может принимать произвольное число входных параметров, но должны возвращать в HTML в шаблоне. Функции форматирования сначала были проверены в [с помощью TemplateFields в элементе управления GridView](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) учебника.

Эти методы форматирования доступны с помощью элементов управления DataList и повторителя. В этом учебнике предстоит пошагово примеры использования обоих методов для обоих элементов управления.

## <a name="using-theitemdataboundevent-handler"></a>С помощью`ItemDataBound`обработчика событий

При привязке данных к DataList, из элемента управления источником данных, либо путем программного связывания данных к элементу управления s `DataSource` и вызова его `DataBind()` метод DataList s `DataBinding` инициирует событие, перечисления, источник данных и каждая запись данных привязан к элементу управления DataList. Для каждой записи в источнике данных, создает DataList [ `DataListItem` ](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalistitem.aspx) объект, то связан с текущей записью. Во время этого процесса DataList вызывает два события:

- **`ItemCreated`**срабатывает после `DataListItem` был создан
- **`ItemDataBound`**вызывается после привязано к текущей записи`DataListItem`

Ниже описан процесс привязки данных для элемента управления DataList.

1. Элемент управления DataList s [ `DataBinding` событие](https://msdn.microsoft.com/en-us/library/system.web.ui.control.databinding.aspx) активируется
2. Данные, привязанные к элементу управления DataList  
  
 Для каждой записи в источнике данных 

    1. Создание `DataListItem` объекта
    2. Пожара [ `ItemCreated` событий](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.itemcreated.aspx)
    3. Запись привязывается к`DataListItem`
    4. Пожара [ `ItemDataBound` событий](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalist.itemdatabound.aspx)
    5. Добавить `DataListItem` для `Items` коллекции

Привязка данных к элементу управления повторителем, продвижения через ту же последовательность шагов. Единственным различием является вместо `DataListItem` использует повторителя создания экземпляров, [ `RepeaterItem` ](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.repeateritem(VS.80).aspx)s.

> [!NOTE]
> Проницательный читатель заметить небольшие аномалий между последовательность шагов, которые происходят при DataList и повторителя привязанных к данным и при привязке к данным GridView упорядочении. В конце заключительного процесса привязки данных вызывает GridView `DataBound` события; тем не менее, элемент управления DataList ни повторителя имеет такого события. Это так, как элементы управления DataList и повторителя созданных обратно в ASP.NET 1.x временные рамки, до шаблон обработчик событий до и после уровня становится популярным.


Как и с GridView, один из вариантов форматирования на основе данных для создания обработчика событий для `ItemDataBound` события. Этот обработчик событий должен проверить данные, которые только что привязанного к `DataListItem` или `RepeaterItem` и влияет на форматирование элемента управления при необходимости.

Для элемента управления DataList изменения форматирования для всего элемента может осуществляться с помощью `DataListItem` s относящихся к стилю свойств, включающих стандартный `Font`, `ForeColor`, `BackColor`, `CssClass`, и т. д. Чтобы влияют на форматирование определенного веб-элементов управления в шаблоне DataList s, нужно получить программный доступ и изменение стиля этих веб-элементов управления. Мы узнали, как выполнять его обратно в *форматирование на основе по данным* учебника. Аналогичен элементу управления повторителем `RepeaterItem` класс имеет свойства, не относящихся к стилю; таким образом, все связанные со стилем изменения в `RepeaterItem` в `ItemDataBound` обработчик событий должен выполнять программным путем доступа и обновления веб-элементов управления в шаблон.

Поскольку `ItemDataBound` форматирование прием для DataList и повторителя практически идентичны, нашем примере мы сосредоточимся на использовании DataList.

## <a name="step-1-displaying-product-information-in-the-datalist"></a>Шаг 1: Отображение сведений о продукте в DataList

Прежде чем мы беспокоиться о форматировании, позволяют s сначала создать страницы, использующей DataList для отображения сведений о продукте. В [с предыдущим учебником](displaying-data-with-the-datalist-and-repeater-controls-cs.md) мы создали DataList которого `ItemTemplate` отображается каждого s название продукта, категория, поставщик, количество за единицу и цены. Разрешить s Повторите этих функциональных возможностей в этом учебнике. Для этого можно воссоздать DataList и его ObjectDataSource с нуля или скопировать в эти элементы управления на странице, созданной в предыдущем учебнике (`Basics.aspx`) и вставьте их в страницы в этом учебнике (`Formatting.aspx`).

После репликации DataList и ObjectDataSource функции `Basics.aspx` в `Formatting.aspx`, занять некоторое время для изменения DataList s `ID` свойство из `DataList1` на более описательное `ItemDataBoundFormattingExample`. После этого просмотра DataList в браузере. Как показано на рис. 1, форматирования между каждого продукта отличается только что переключается цвет фона.


[![Продукты отображаются в элементе управления DataList](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image2.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image1.png)

**Рис. 1**: продукты отображаются в элементе управления DataList ([Просмотр полноразмерное изображение](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image3.png))


В этом учебнике позволяют s форматирования DataList таким образом, что все продукты с ценой менее $20,00 будет иметь оба его имя и цену единицы выделен желтым цветом.

## <a name="step-2-programmatically-determining-the-value-of-the-data-in-the-itemdatabound-event-handler"></a>Шаг 2: Программное определение значений данных в обработчике событий ItemDataBound

Поскольку только те продукты, цена в $20,00 будет применен пользовательский формат, должен быть могут определять каждую s цену продукта. При привязке данных к DataList, DataList перечисляет записей в источник данных и для каждой записи создается `DataListItem` экземпляра, запись в источнике данных для привязки `DataListItem`. После конкретной записи s привязки данных к текущему `DataListItem` объекта DataList s `ItemDataBound` событие. Можно создать обработчик событий для этого события, чтобы проверить значения данных для текущего `DataListItem` и, основываясь на эти значения, внесите необходимые изменения форматирования.

Создание `ItemDataBound` событий для DataList и добавьте следующий код:


[!code-csharp[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample1.cs)]

Во время концепции и семантикой DataList s `ItemDataBound` обработчик событий совпадают с используемыми GridView s `RowDataBound` обработчик событий в *форматирование на основе по данным* учебнике ее синтаксис отличается немного. При `ItemDataBound` события `DataListItem` только с привязкой к данным, передается в соответствующий обработчик событий через `e.Item` (вместо `e.Row`, как и в случае с GridView s `RowDataBound` обработчика событий). Элемент управления DataList s `ItemDataBound` запускает обработчик событий для *каждого* строки, добавляемой в DataList, включая строки верхнего колонтитула, нижнего колонтитула и разделитель строк. Тем не менее сведения о продукте ограничена только на строки данных. Таким образом при использовании `ItemDataBound` события, чтобы проверить данные привязаны к DataList, нам нужно убедиться, что мы re работа с элементом данных. Это можно сделать, проверив `DataListItem` s [ `ItemType` свойство](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datalistitem.itemtype.aspx), который может иметь одно из [следующих восьми значений](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listitemtype.aspx):

- `AlternatingItem`
- `EditItem`
- `Footer`
- `Header`
- `Item`
- `Pager`
- `SelectedItem`
- `Separator`

Оба `Item` и `AlternatingItem``DataListItem` элементов данных s состава DataList s. При условии, что мы re работа с `Item` или `AlternatingItem`, мы доступа к самим `ProductsRow` экземпляр, который был связан с текущим `DataListItem`. `DataListItem` s [ `DataItem` свойство](https://msdn.microsoft.com/en-us/system.web.ui.webcontrols.datalistitem.dataitem.aspx) содержит ссылку на `DataRowView` объекта, в которых `Row` свойство предоставляет ссылку на фактический `ProductsRow` объекта.

Далее мы проверяем, `ProductsRow` экземпляра s `UnitPrice` свойство. Поскольку для таблицы Products s `UnitPrice` поле позволяет `NULL` значения, прежде чем пытаться получить доступ к `UnitPrice` свойство нам необходимо проверить, имеет ли `NULL` с использованием `IsUnitPriceNull()` метод. Если `UnitPrice` значение не `NULL`, затем проверьте ли его s меньше $20,00. Если это действительно в разделе 20,00 долларов, нам потребуется применения пользовательских форматов.

## <a name="step-3-highlighting-the-product-s-name-and-price"></a>Шаг 3: Выделение s имя продукта и цену

Когда мы знаем, что цена продукта s — меньше $20,00, остается выделите ее название и цену. Чтобы сделать это, мы сначала необходимо программно добавить ссылку меток в `ItemTemplate` , отобразить имя продукта s и цену. Теперь нам нужны отображение желтым фоном. Эти сведения о форматировании могут применяться изменения непосредственно в метках `BackColor` свойства (`LabelID.BackColor = Color.Yellow`); в идеальном случае менее, все аспекты использования отображение связанных должна быть выражена через каскадные таблицы стилей. На самом деле у нас уже есть таблицы стилей, предоставляет нужный формат, определенный в `Styles.css`  -  `AffordablePriceEmphasis`, которой был создан и обсуждается в *форматирование на основе по данным* учебника.

Чтобы применить форматирование, просто установите два элемента управления Label Web `CssClass` свойства `AffordablePriceEmphasis`, как показано в следующем коде:


[!code-csharp[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample2.cs)]

С `ItemDataBound` завершения обработчика событий, повторное использование `Formatting.aspx` страницы в браузере. Как показано на рисунке 2, эти продукты с ценой под $20,00 иметь их имени и цена выделяются.


[![Эти продукты меньше $20,00 выделяются](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image5.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image4.png)

**На рисунке 2**: тех продуктов меньше $20,00 выделяются ([Просмотр полноразмерное изображение](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image6.png))


> [!NOTE]
> Поскольку элемент управления DataList подготавливается к просмотру как HTML `<table>`, ее `DataListItem` экземпляры имеют относящихся к стилю свойств, которые могут быть установлены для применения определенных стилей для всего элемента. Например, если требуется выделить *всей* yellow элемента при его стоимость была меньше $20,00, нам удалось заменили код, ссылки на метки и задайте их `CssClass` свойства с помощью следующей строки кода: `e.Item.CssClass = "AffordablePriceEmphasis"` (см. рис. 3).


`RepeaterItem` , Составляющих элементе управления повторителем, однако t больше не предоставляют такие свойства стиля уровня. Таким образом Применение пользовательского форматирования для повторителя требуется применение свойства стиля для веб-элементов управления в шаблонах повторителя s, так же, как мы делали на рис. 2.


[![Для продуктов в списке $20,00 выделяется весь элемент продукта](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image8.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image7.png)

**Рис. 3**: для продуктов в списке $20,00 выделяется весь элемент продукта ([Просмотр полноразмерное изображение](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image9.png))


## <a name="using-formatting-functions-from-within-the-template"></a>С помощью функции форматирования из шаблона

В *с помощью TemplateFields в элементе управления GridView* учебника мы узнали, как использовать функции форматирования в GridView TemplateField для применения пользовательских форматов на основе данных, привязанным с строкам s GridView. Функции форматирования — метод, который может вызываться из шаблона и возвращает HTML-код может быть выпущен в его место. Функции форматирования может находиться в классе фонового кода ASP.NET страницы s или будет сосредоточено в файлах классов в `App_Code` папке или в отдельном проекте библиотеки классов. Перемещение функции форматирования из класс кода программной s страницы ASP.NET, лучше, если вы планируете использовать одну и ту же функцию форматирования на нескольких страницах ASP.NET, или в других веб-приложений ASP.NET.

Для демонстрации функции форматирования, s позволяют иметь сведения о продукте, которая включает текст [DISCONTINUED] рядом с именем product s, при его s более не поддерживается. Также позволяют s имеют выделенный желтый Если цена его s меньше $20,00 (как это делалось `ItemDataBound` пример обработчика событий); Если цена таких товаров не $20,00 или выше, позволяют s Отображает фактические цены, но вместо этого текст, выполните вызов цены. На рисунке 4 показаны снимок экрана список с правилами форматирования применяется продуктов.


[![Дорогих товаров цена заменяется текст, вызовите цены](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image11.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image10.png)

**Рис. 4**: дорогих товаров, цена заменяется текст, вызовите цены ([Просмотр полноразмерное изображение](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image12.png))


## <a name="step-1-create-the-formatting-functions"></a>Шаг 1: Создание функции форматирования

В этом примере мы должны две функции форматирования, один, отображающий название продукта вместе с текстом [DISCONTINUED], при необходимости, а другой, выделенная цены, если он меньше, чем $20,00 или текст, вызовите для предложения цены в противном случае. Разрешить s создания этих функций в классе фонового кода ASP.NET страницы s и назовите их `DisplayProductNameAndDiscontinuedStatus` и `DisplayPrice`. Оба метода должны возвращать HTML для подготовки к просмотру в виде строки и должны быть помечены `Protected` (или `Public`) для вызова из области декларативный синтаксис страницы s в ASP.NET. Код для этих двух методов выглядит следующим образом:


[!code-csharp[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample3.cs)]

Обратите внимание, что `DisplayProductNameAndDiscontinuedStatus` метод принимает значения `productName` и `discontinued` как скалярные значения поля данных, тогда как `DisplayPrice` метод принимает `ProductsRow` экземпляра (а не `unitPrice` скалярное значение). Оба подхода могут использоваться; Тем не менее работает ли функции форматирования со скалярными значениями, которые могут содержать базы данных `NULL` значения (такие как `UnitPrice`; ни один из `ProductName` ни `Discontinued` Разрешить `NULL` значения), необходимо уделить особое при обработке этих скалярные входных данных.

В частности, входной параметр должен иметь тип `Object` поскольку входящее значение может быть `DBNull` экземпляром, а не в ожидаемый тип данных. Кроме того, чтобы определить, является ли входное значение базы данных необходимо сделать проверку `NULL` значение. То есть если бы мы хотели `DisplayPrice` метод, принимающий цена в виде скалярного значения, d, мы должны использовать следующий код:


[!code-csharp[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample4.cs)]

Обратите внимание, что `unitPrice` входной параметр имеет тип `Object` и, чтобы выяснить, если был изменен условного оператора `unitPrice` — `DBNull` или нет. Кроме того, с момента `unitPrice` входного параметра передается в качестве `Object`, он должен быть приведен в десятичное значение.

## <a name="step-2-calling-the-formatting-function-from-the-datalist-s-itemtemplate"></a>Шаг 2: Вызов функции форматирования из DataList s ItemTemplate

С помощью форматирования функции, добавленные в нашем ASP.NET s кода класса страницы, остается только для вызова этих функций из DataList s форматирования `ItemTemplate`. Для вызова функции форматирования на основе шаблона, поместите вызов функции в синтаксис привязки данных:


[!code-aspx[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample5.aspx)]

В DataList s `ItemTemplate` `ProductNameLabel` веб-управления Label в данный момент отображаются имя продукта s, назначив его `Text` свойство результат из `<%# Eval("ProductName") %>`. Чтобы отобразить имя и текст [DISCONTINUED], при необходимости, обновите декларативный синтаксис так, чтобы вместо назначает `Text` свойства значение из `DisplayProductNameAndDiscontinuedStatus` метод. При этом необходимо передать в название продукта s и неподдерживаемые значения, с использованием `Eval("columnName")` синтаксиса. `Eval`Возвращает значение типа `Object`, но `DisplayProductNameAndDiscontinuedStatus` метод ожидает входные параметры типа `String` и `Boolean`; таким образом, мы должны приведены значения, возвращаемые методом `Eval` метод типам ожидаемый входной параметр следующим образом:


[!code-aspx[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample6.aspx)]

Чтобы отобразить цены, мы просто задать `UnitPriceLabel` метки s `Text` свойство в значение, возвращаемое `DisplayPrice` метод так же, как мы для отображения имени продукта s, а [НЕПОДДЕРЖИВАЕМЫЕ] текста. Однако вместо передачи в `UnitPrice` как скалярный входной параметр, вместо этого передается во всем `ProductsRow` экземпляр:


[!code-aspx[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample7.aspx)]

С вызовами функций форматирования в месте мгновение просмотрите ход работы в браузере. Экран должен выглядеть аналогично рис. 5 с неподдерживаемые продукты, включая текст [DISCONTINUED] и продукты стоимостью более $20,00 необходимости их цена заменяются текст выполните вызов цены.


[![Дорогих товаров цена заменяется текст, вызовите цены](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image14.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image13.png)

**Рис. 5**: дорогих товаров, цена заменяется текст, вызовите цены ([Просмотр полноразмерное изображение](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image15.png))


## <a name="summary"></a>Сводка

Форматирование содержимого элемента управления DataList и повторителя на основе данных может выполняться с помощью двух методов. Первый способ состоит в том, чтобы создать обработчик событий для `ItemDataBound` событие, которое вызывается при каждой записи в источнике данных, привязанного к новый `DataListItem` или `RepeaterItem`. В `ItemDataBound` обработчик событий, можно проверить текущие данные элемент s и затем форматирование может применяться к содержимое шаблона, или для `DataListItem` s для всего самого элемента.

Кроме того пользовательский формат можно реализовать через функций форматирования. Функции форматирования — метод, который может быть вызвана из DataList или повторителя s шаблоны, которые возвращает HTML-код для создания на его месте. Часто возвращаемые функцией форматирования HTML определяется значениями, которая привязывается к текущему элементу. Эти значения можно передать в функцию форматирования как скалярные значения или путем передачи всего объекта, которая привязывается к элементу (такие как `ProductsRow` экземпляра).

Программирование довольны!

## <a name="about-the-author"></a>Об авторе

[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года. Скотт — независимый консультант, trainer и записи. Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco). Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [http://ScottOnWriting.NET](http://ScottOnWriting.NET).

## <a name="special-thanks-to"></a>Благодарности

Этот учебник ряд прошел проверку многие полезные рецензентов. Основными редакторами этого учебника были Yaakov Эллис (Ellis) и Рэнди Шмидт, (Liz Shulok). Объясняются моих последующих статей для MSDN? Если Да, напишите мне по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)

>[!div class="step-by-step"]
[Назад](displaying-data-with-the-datalist-and-repeater-controls-cs.md)
[Вперед](showing-multiple-records-per-row-with-the-datalist-control-cs.md)
