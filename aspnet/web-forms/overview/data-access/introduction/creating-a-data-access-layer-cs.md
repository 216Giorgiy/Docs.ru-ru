---
uid: web-forms/overview/data-access/introduction/creating-a-data-access-layer-cs
title: Создание уровня доступа к данным (C#) | Документы Microsoft
author: rick-anderson
description: В этом учебнике мы будем запустите с самого начала и создайте данных Access Layer (DAL), с помощью типизированных наборов данных, доступ к сведениям в базе данных.
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/05/2010
ms.topic: article
ms.assetid: cfe2a6a0-1e56-4dc8-9537-c8ec76ba96a4
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-data-access-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: 7e1a457c23ef659bf7ee9c15b66dc5c2d8a31416
ms.sourcegitcommit: 6784510cfb589308c3875ccb5113eb31031766b4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/08/2018
ms.locfileid: "30891475"
---
<a name="creating-a-data-access-layer-c"></a><span data-ttu-id="8b4b7-103">Создание уровня доступа к данным (C#)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-103">Creating a Data Access Layer (C#)</span></span>
====================
<span data-ttu-id="8b4b7-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="8b4b7-105">[Загрузить пример приложения](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_1_CS.exe) или [скачать PDF](creating-a-data-access-layer-cs/_static/datatutorial01cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-105">[Download Sample App](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_1_CS.exe) or [Download PDF](creating-a-data-access-layer-cs/_static/datatutorial01cs1.pdf)</span></span>

> <span data-ttu-id="8b4b7-106">В этом учебнике мы будем запустите с самого начала и создайте данных Access Layer (DAL), с помощью типизированных наборов данных, доступ к сведениям в базе данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-106">In this tutorial we'll start from the very beginning and create the Data Access Layer (DAL), using typed DataSets, to access the information in a database.</span></span>


## <a name="introduction"></a><span data-ttu-id="8b4b7-107">Вступление</span><span class="sxs-lookup"><span data-stu-id="8b4b7-107">Introduction</span></span>

<span data-ttu-id="8b4b7-108">Веб-разработчиков нашей жизни связана с работой с данными.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-108">As web developers, our lives revolve around working with data.</span></span> <span data-ttu-id="8b4b7-109">Мы создаем базы данных для хранения данных, код для извлечения и изменения и веб-страницы для сбора и обобщения.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-109">We create databases to store the data, code to retrieve and modify it, and web pages to collect and summarize it.</span></span> <span data-ttu-id="8b4b7-110">Это в первом учебнике ряд, будут рассмотрены приемы реализации этих распространенных схем в ASP.NET 2.0.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-110">This is the first tutorial in a lengthy series that will explore techniques for implementing these common patterns in ASP.NET 2.0.</span></span> <span data-ttu-id="8b4b7-111">Мы начнем с создания [архитектура программного обеспечения](http://en.wikipedia.org/wiki/Software_architecture) состоит из данных Access Layer (DAL) с помощью типизированных наборов данных, слой бизнес-логики (BLL), в котором принудительно пользовательских бизнес-правил и состоит из ASP.NET уровня представления страниц, совместно использовать общий макет страницы.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-111">We'll start with creating a [software architecture](http://en.wikipedia.org/wiki/Software_architecture) composed of a Data Access Layer (DAL) using Typed DataSets, a Business Logic Layer (BLL) that enforces custom business rules, and a presentation layer composed of ASP.NET pages that share a common page layout.</span></span> <span data-ttu-id="8b4b7-112">После этого внутреннего фундамента, мы перейдем к созданию отчетов, показывающий, как отобразить, суммировать, собирать и проверять данные из веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-112">Once this backend groundwork has been laid, we'll move into reporting, showing how to display, summarize, collect, and validate data from a web application.</span></span> <span data-ttu-id="8b4b7-113">Эти учебники предназначены для краткого и содержат пошаговые инструкции с множеством снимков экранов, дающих процесс визуально.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-113">These tutorials are geared to be concise and provide step-by-step instructions with plenty of screen shots to walk you through the process visually.</span></span> <span data-ttu-id="8b4b7-114">В каждом учебнике доступен в C# и Visual Basic версии и загрузить полный код, используемый.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-114">Each tutorial is available in C# and Visual Basic versions and includes a download of the complete code used.</span></span> <span data-ttu-id="8b4b7-115">(Первый учебный курс довольно длинный, но остальные будут представлены в значительно снизилось фрагментов).</span><span class="sxs-lookup"><span data-stu-id="8b4b7-115">(This first tutorial is quite lengthy, but the rest are presented in much more digestible chunks.)</span></span>

<span data-ttu-id="8b4b7-116">Эти руководства мы будем работать с Microsoft SQL Server 2005 Express Edition версию базы данных Northwind, помещаются в **приложения\_данные** каталога.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-116">For these tutorials we'll be using a Microsoft SQL Server 2005 Express Edition version of the Northwind database placed in the **App\_Data** directory.</span></span> <span data-ttu-id="8b4b7-117">В дополнение к файлу базы данных **приложения\_данные** папка также содержит скрипты SQL для создания базы данных, в случае, если вы хотите использовать версию другой базе данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-117">In addition to the database file, the **App\_Data** folder also contains the SQL scripts for creating the database, in case you want to use a different database version.</span></span> <span data-ttu-id="8b4b7-118">Эти сценарии могут также быть [загружаются непосредственно от корпорации Майкрософт](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en), если вы хотите использовать.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-118">These scripts can be also be [downloaded directly from Microsoft](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en), if you'd prefer.</span></span> <span data-ttu-id="8b4b7-119">При использовании другой версии SQL Server, базы данных Northwind, необходимо обновить **NORTHWNDConnectionString** в приложения **Web.config** файла.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-119">If you use a different SQL Server version of the Northwind database, you will need to update the **NORTHWNDConnectionString** setting in the application's **Web.config** file.</span></span> <span data-ttu-id="8b4b7-120">Веб-приложения был создан с помощью Visual Studio 2005 Professional Edition как проект веб-сайта на основе системы файла.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-120">The web application was built using Visual Studio 2005 Professional Edition as a file system-based Web site project.</span></span> <span data-ttu-id="8b4b7-121">Однако все части руководства будут работать одинаково хорошо с бесплатная версия Visual Studio 2005 [Visual Web Developer](https://msdn.microsoft.com/vstudio/express/vwd/).</span><span class="sxs-lookup"><span data-stu-id="8b4b7-121">However, all of the tutorials will work equally well with the free version of Visual Studio 2005, [Visual Web Developer](https://msdn.microsoft.com/vstudio/express/vwd/).</span></span>  
  
<span data-ttu-id="8b4b7-122">В этом учебнике мы будем запустите с самого начала и создайте данных Access Layer (DAL), следуют создания слой бизнес-логики (BLL) второй учебника и работы на макет страницы и навигация в третьем.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-122">In this tutorial we'll start from the very beginning and create the Data Access Layer (DAL), followed by creating the Business Logic Layer (BLL) in the second tutorial, and working on page layout and navigation in the third.</span></span> <span data-ttu-id="8b4b7-123">После третий будет основываться на фундаменте учебников упорядочивается в первых трех.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-123">The tutorials after the third one will build upon the foundation laid in the first three.</span></span> <span data-ttu-id="8b4b7-124">У нас есть много в первом учебнике, поэтому запускайте Visual Studio и давайте начнем!</span><span class="sxs-lookup"><span data-stu-id="8b4b7-124">We've got a lot to cover in this first tutorial, so fire up Visual Studio and let's get started!</span></span>

## <a name="step-1-creating-a-web-project-and-connecting-to-the-database"></a><span data-ttu-id="8b4b7-125">Шаг 1: Создание веб-проекта и подключение к базе данных</span><span class="sxs-lookup"><span data-stu-id="8b4b7-125">Step 1: Creating a Web Project and Connecting to the Database</span></span>

<span data-ttu-id="8b4b7-126">Прежде чем создавать наш слой доступа к данным (DAL), сначала необходимо создать веб-сайт и настроить базу данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-126">Before we can create our Data Access Layer (DAL), we first need to create a web site and setup our database.</span></span> <span data-ttu-id="8b4b7-127">Начните с создания нового файла на основе системы веб-сайт ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-127">Start by creating a new file system-based ASP.NET web site.</span></span> <span data-ttu-id="8b4b7-128">Чтобы сделать это, перейдите в меню «файл» и выберите новый веб-сайт, отображает диалоговое окно нового веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-128">To accomplish this, go to the File menu and choose New Web Site, displaying the New Web Site dialog box.</span></span> <span data-ttu-id="8b4b7-129">Выберите шаблон веб-сайт ASP.NET, указывает расположение раскрывающегося списка в файловой системе, выберите папку для размещения веб-сайта и выбранный язык C#.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-129">Choose the ASP.NET Web Site template, set the Location drop-down list to File System, choose a folder to place the web site, and set the language to C#.</span></span>


<span data-ttu-id="8b4b7-130">[![Создать новый файл на основе системы веб-сайта](creating-a-data-access-layer-cs/_static/image2.png)](creating-a-data-access-layer-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-130">[![Create a New File System-Based Web Site](creating-a-data-access-layer-cs/_static/image2.png)](creating-a-data-access-layer-cs/_static/image1.png)</span></span>

<span data-ttu-id="8b4b7-131">**Рис. 1**: Создание веб-сайта New File System-Based ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-131">**Figure 1**: Create a New File System-Based Web Site ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image3.png))</span></span>


<span data-ttu-id="8b4b7-132">Это создаст новый веб-сайт с **Default.aspx** страницы ASP.NET и **приложения\_данные** папки.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-132">This will create a new web site with a **Default.aspx** ASP.NET page and an **App\_Data** folder.</span></span>

<span data-ttu-id="8b4b7-133">Созданный веб-сайт создан следующим шагом является добавление ссылки на базу данных в обозревателе серверов Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-133">With the web site created, the next step is to add a reference to the database in Visual Studio's Server Explorer.</span></span> <span data-ttu-id="8b4b7-134">Путем добавления базы данных в обозревателе серверов можно добавить таблицы, хранимые процедуры, представления и т. д. все это выполняется из среды Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-134">By adding a database to the Server Explorer you can add tables, stored procedures, views, and so on all from within Visual Studio.</span></span> <span data-ttu-id="8b4b7-135">Также можно просматривать табличные данные или создавать собственные запросы вручную или графически через построитель запросов.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-135">You can also view table data or create your own queries either by hand or graphically via the Query Builder.</span></span> <span data-ttu-id="8b4b7-136">Кроме того при конструировании типизированных наборов данных для DAL нам нужно будет переключить Visual Studio в базу данных, из которого можно составить типизированных наборов данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-136">Furthermore, when we build the Typed DataSets for the DAL we'll need to point Visual Studio to the database from which the Typed DataSets should be constructed.</span></span> <span data-ttu-id="8b4b7-137">Хотя имеется возможность предоставить эти сведения о подключении на момент времени, Visual Studio автоматически заполняет список раскрывающегося списка баз данных, уже зарегистрирован в обозревателе серверов.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-137">While we can provide this connection information at that point in time, Visual Studio automatically populates a drop-down list of the databases already registered in the Server Explorer.</span></span>

<span data-ttu-id="8b4b7-138">Шаги для добавления базы данных Northwind в обозреватель сервера зависят от того, требуется ли использовать базу данных SQL Server 2005, экспресс-выпуск в **приложения\_данные** папке или при наличии Microsoft SQL Server 2000 или 2005 Настройка сервера базы данных, которую требуется использовать вместо него.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-138">The steps for adding the Northwind database to the Server Explorer depend on whether you want to use the SQL Server 2005 Express Edition database in the **App\_Data** folder or if you have a Microsoft SQL Server 2000 or 2005 database server setup that you want to use instead.</span></span>

## <a name="using-a-database-in-theappdatafolder"></a><span data-ttu-id="8b4b7-139">Использование базы данных в theApp\_DataFolder</span><span class="sxs-lookup"><span data-stu-id="8b4b7-139">Using a Database in theApp\_DataFolder</span></span>

<span data-ttu-id="8b4b7-140">Если у вас SQL Server 2000 или 2005 сервер базы данных для подключения к или просто хотите избежать добавления базы данных на сервере базы данных, можно использовать версию SQL Server 2005, экспресс-выпуск базы данных Northwind, расположенного в загруженный websit e's **приложения\_данные** папку (**NORTHWND. MDF**).</span><span class="sxs-lookup"><span data-stu-id="8b4b7-140">If you do not have a SQL Server 2000 or 2005 database server to connect to, or you simply want to avoid having to add the database to a database server, you can use the SQL Server 2005 Express Edition version of the Northwind database that is located in the downloaded website's **App\_Data** folder (**NORTHWND.MDF**).</span></span>

<span data-ttu-id="8b4b7-141">База данных, помещенная в **приложения\_данные** , автоматически добавляется в обозреватель серверов.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-141">A database placed in the **App\_Data** folder is automatically added to the Server Explorer.</span></span> <span data-ttu-id="8b4b7-142">Если предположить, что SQL Server 2005 Express Edition установлены на компьютере должна появиться узел с именем NORTHWND. MDF в обозревателе серверов, которые можно развернуть и изучить его таблицы, представления, хранимые процедуры и т. д (см. рис. 2).</span><span class="sxs-lookup"><span data-stu-id="8b4b7-142">Assuming you have SQL Server 2005 Express Edition installed on your machine you should see a node named NORTHWND.MDF in the Server Explorer, which you can expand and explore its tables, views, stored procedure, and so on (see Figure 2).</span></span>

<span data-ttu-id="8b4b7-143">**Приложения\_данные** могут содержаться также Microsoft Access **.mdb** файлы, которые, как их аналоги SQL Server, автоматически добавляются в обозревателе серверов.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-143">The **App\_Data** folder can also hold Microsoft Access **.mdb** files, which, like their SQL Server counterparts, are automatically added to the Server Explorer.</span></span> <span data-ttu-id="8b4b7-144">Если вы не хотите использовать любые из параметров SQL Server, вы всегда можете [загрузить версию файла базы данных "Борей" Microsoft Access](https://www.microsoft.com/downloads/details.aspx?FamilyID=C6661372-8DBE-422B-8676-C632D66C529C&amp;displaylang=EN) в **приложения\_данные** каталога.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-144">If you don't want to use any of the SQL Server options, you can always [download a Microsoft Access version of the Northwind database file](https://www.microsoft.com/downloads/details.aspx?FamilyID=C6661372-8DBE-422B-8676-C632D66C529C&amp;displaylang=EN) and drop into the **App\_Data** directory.</span></span> <span data-ttu-id="8b4b7-145">Необходимо помнить, однако, базы данных Access не так многофункциональны, как SQL Server и не предназначен для использования в сценариях веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-145">Keep in mind, however, that Access databases aren't as feature-rich as SQL Server, and aren't designed to be used in web site scenarios.</span></span> <span data-ttu-id="8b4b7-146">Кроме того несколько учебников 35 + будет использовать некоторые функции уровня базы данных, не поддерживаемые доступа.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-146">Furthermore, a couple of the 35+ tutorials will utilize certain database-level features that aren't supported by Access.</span></span>

## <a name="connecting-to-the-database-in-a-microsoft-sql-server-2000-or-2005-database-server"></a><span data-ttu-id="8b4b7-147">Подключение к базе данных на сервере базы данных Microsoft SQL Server 2000 или 2005</span><span class="sxs-lookup"><span data-stu-id="8b4b7-147">Connecting to the Database in a Microsoft SQL Server 2000 or 2005 Database Server</span></span>

<span data-ttu-id="8b4b7-148">Кроме того можно подключиться к базе данных Northwind, установленной на сервере базы данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-148">Alternatively, you may connect to a Northwind database installed on a database server.</span></span> <span data-ttu-id="8b4b7-149">Если сервер базы данных еще не установлены базы данных Northwind, сначала необходимо добавить его к серверу базы данных, запустив сценарий установки, входящий в этом учебнике для загрузки или с помощью [загрузки версии SQL Server 2000 для данных "Борей" и сценария установки](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en) непосредственно с веб-сайта корпорации Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-149">If the database server does not already have the Northwind database installed, you first must add it to database server by running the installation script included in this tutorial's download or by [downloading the SQL Server 2000 version of Northwind and installation script](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en) directly from Microsoft's web site.</span></span>

<span data-ttu-id="8b4b7-150">После установки базы данных, перейдите в обозреватель серверов в Visual Studio, щелкните правой кнопкой мыши узел подключения данных и выберите Добавить подключение.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-150">Once you have the database installed, go to the Server Explorer in Visual Studio, right-click on the Data Connections node, and choose Add Connection.</span></span> <span data-ttu-id="8b4b7-151">Если вы не видите перейдите в представление обозревателя серверов / обозревателя серверов, или нажмите сочетание клавиш Ctrl + Alt + S.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-151">If you don't see the Server Explorer go to the View / Server Explorer, or hit Ctrl+Alt+S.</span></span> <span data-ttu-id="8b4b7-152">Откроется диалоговое окно Добавить подключение, в котором можно указать сервер для подключения, сведения для проверки подлинности и имя базы данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-152">This will bring up the Add Connection dialog box, where you can specify the server to connect to, the authentication information, and the database name.</span></span> <span data-ttu-id="8b4b7-153">После успешно настроить соединение с базой данных и нажатии кнопки «ОК», базе данных будет добавлен как узел в узле подключения к данным.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-153">Once you have successfully configured the database connection information and clicked the OK button, the database will be added as a node underneath the Data Connections node.</span></span> <span data-ttu-id="8b4b7-154">Можно развернуть узел базы данных для просмотра таблиц, представлений, хранимых процедур и т. д.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-154">You can expand the database node to explore its tables, views, stored procedures, and so on.</span></span>


![Добавить подключение к базе данных сервера базы данных "Борей"](creating-a-data-access-layer-cs/_static/image4.png)

<span data-ttu-id="8b4b7-156">**На рисунке 2**: добавить подключение к базе данных сервера базы данных "Борей"</span><span class="sxs-lookup"><span data-stu-id="8b4b7-156">**Figure 2**: Add a Connection to Your Database Server's Northwind Database</span></span>


## <a name="step-2-creating-the-data-access-layer"></a><span data-ttu-id="8b4b7-157">Шаг 2: Создание уровня доступа к данным</span><span class="sxs-lookup"><span data-stu-id="8b4b7-157">Step 2: Creating the Data Access Layer</span></span>

<span data-ttu-id="8b4b7-158">При работе с данным один вариант — встраивать логику конкретных данных непосредственно в слой представления (в веб-приложения образуют уровень представления страниц ASP.NET).</span><span class="sxs-lookup"><span data-stu-id="8b4b7-158">When working with data one option is to embed the data-specific logic directly into the presentation layer (in a web application, the ASP.NET pages make up the presentation layer).</span></span> <span data-ttu-id="8b4b7-159">Это может занять виде написания кода ADO.NET в часть кода страницы ASP.NET или с помощью элемента управления SqlDataSource из части, содержащей разметку.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-159">This may take the form of writing ADO.NET code in the ASP.NET page's code portion or using the SqlDataSource control from the markup portion.</span></span> <span data-ttu-id="8b4b7-160">В любом случае этот подход жестко связывает логики доступа к данным со слоем представления.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-160">In either case, this approach tightly couples the data access logic with the presentation layer.</span></span> <span data-ttu-id="8b4b7-161">Рекомендуемый подход, то для разделения логики доступа к данным от уровня представления.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-161">The recommended approach, however, is to separate the data access logic from the presentation layer.</span></span> <span data-ttu-id="8b4b7-162">Этот отдельный уровень называется уровня доступа к данным, коротко DAL и обычно реализуется в виде отдельного проекта библиотеки классов.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-162">This separate layer is referred to as the Data Access Layer, DAL for short, and is typically implemented as a separate Class Library project.</span></span> <span data-ttu-id="8b4b7-163">Подробно описаны преимущества этой многоуровневой архитектуры (см. раздел «Дополнительные материалы» в конце этого учебника, чтобы сведения об этих преимуществах) и является подход, который будет использоваться в этой серии.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-163">The benefits of this layered architecture are well documented (see the "Further Readings" section at the end of this tutorial for information on these advantages) and is the approach we will take in this series.</span></span>

<span data-ttu-id="8b4b7-164">Весь код, определенных в базовом источнике данных, например для создания подключения к базе данных, выдачи **ВЫБЕРИТЕ**, **вставить**, **обновление**, и  **Удалить** команды и т. д должен находиться в каталоге DAL.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-164">All code that is specific to the underlying data source such as creating a connection to the database, issuing **SELECT**, **INSERT**, **UPDATE**, and **DELETE** commands, and so on should be located in the DAL.</span></span> <span data-ttu-id="8b4b7-165">Уровень представления не должно содержать все ссылки на такой код доступа к данным, но вместо этого следует выполнять вызовы DAL для всех запросов.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-165">The presentation layer should not contain any references to such data access code, but should instead make calls into the DAL for any and all data requests.</span></span> <span data-ttu-id="8b4b7-166">Слои доступа к данным обычно содержат методы для доступа к данным базы данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-166">Data Access Layers typically contain methods for accessing the underlying database data.</span></span> <span data-ttu-id="8b4b7-167">Базы данных Northwind, например, имеет **продуктов** и **категории** которых регистрируются продукты для продажи и категории, к которым они принадлежат.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-167">The Northwind database, for example, has **Products** and **Categories** tables that record the products for sale and the categories to which they belong.</span></span> <span data-ttu-id="8b4b7-168">В DAL имеются методы, такие как:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-168">In our DAL we will have methods like:</span></span>

- <span data-ttu-id="8b4b7-169">**GetCategories(),** которого будут возвращены сведения о всех категорий</span><span class="sxs-lookup"><span data-stu-id="8b4b7-169">**GetCategories(),** which will return information about all of the categories</span></span>
- <span data-ttu-id="8b4b7-170">**GetProducts()**, который возвращает сведения обо всех продуктов</span><span class="sxs-lookup"><span data-stu-id="8b4b7-170">**GetProducts()**, which will return information about all of the products</span></span>
- <span data-ttu-id="8b4b7-171">**GetProductsByCategoryID (*categoryID*)**, возвращающий все продукты, принадлежащие к указанной категории</span><span class="sxs-lookup"><span data-stu-id="8b4b7-171">**GetProductsByCategoryID(*categoryID*)**, which will return all products that belong to a specified category</span></span>
- <span data-ttu-id="8b4b7-172">**GetProductByProductID (*productID*)**, который возвращает сведения об определенном продукте</span><span class="sxs-lookup"><span data-stu-id="8b4b7-172">**GetProductByProductID(*productID*)**, which will return information about a particular product</span></span>

<span data-ttu-id="8b4b7-173">При вызове этих методов подключения к базе данных, создать соответствующий запрос и возвращают результаты.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-173">These methods, when invoked, will connect to the database, issue the appropriate query, and return the results.</span></span> <span data-ttu-id="8b4b7-174">Важно способ возврата результатов.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-174">How we return these results is important.</span></span> <span data-ttu-id="8b4b7-175">Эти методы могут просто вернуть набор данных или DataReader, заполненный посредством запроса к базе данных, но в идеале данные должны быть возвращены результаты с помощью *строго типизированных объектов*.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-175">These methods could simply return a DataSet or DataReader populated by the database query, but ideally these results should be returned using *strongly-typed objects*.</span></span> <span data-ttu-id="8b4b7-176">Строго типизированный объект является одним, схема которого жестко определяется во время компиляции, в то время как противоположность слабо типизированный объект является одним, схема которой не известен до времени выполнения.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-176">A strongly-typed object is one whose schema is rigidly defined at compile time, whereas the opposite, a loosely-typed object, is one whose schema is not known until runtime.</span></span>

<span data-ttu-id="8b4b7-177">Например DataReader и DataSet (по умолчанию) являются слабо типизированных объектов, поскольку их схема определяется столбцов, возвращаемых запросом к базе данных, используемые для их заполнения.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-177">For example, the DataReader and the DataSet (by default) are loosely-typed objects since their schema is defined by the columns returned by the database query used to populate them.</span></span> <span data-ttu-id="8b4b7-178">Для доступа к определенному столбцу из слабо типизированный объект DataTable, необходимо использовать следующий синтаксис:  <strong><em>DataTable</em>. Строки [<em>индекс</em>] [»<em>columnName</em>«]</strong>.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-178">To access a particular column from a loosely-typed DataTable we need to use syntax like: <strong><em>DataTable</em>.Rows[<em>index</em>]["<em>columnName</em>"]</strong>.</span></span> <span data-ttu-id="8b4b7-179">В этом примере нестрогая типизация объекта DataTable проявляется тот факт, что нам нужно получить доступ к имени столбца, с помощью строка или порядковый номер.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-179">The DataTable's loose typing in this example is exhibited by the fact that we need to access the column name using a string or ordinal index.</span></span> <span data-ttu-id="8b4b7-180">Строго типизированный объект DataTable, с другой стороны, будут иметь все его столбцы реализованы в виде свойств, возникающие в коде, который выглядит следующим образом:  <strong><em>DataTable</em>. Строки [<em>индекс</em>]. *columnName</strong>*.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-180">A strongly-typed DataTable, on the other hand, will have each of its columns implemented as properties, resulting in code that looks like: <strong><em>DataTable</em>.Rows[<em>index</em>].*columnName</strong>*.</span></span>

<span data-ttu-id="8b4b7-181">Чтобы вернуть строго типизированных объектов, разработчики можно создать собственные настраиваемые бизнес-объекты или использовать типизированные наборы данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-181">To return strongly-typed objects, developers can either create their own custom business objects or use Typed DataSets.</span></span> <span data-ttu-id="8b4b7-182">Бизнес-объект реализуется разработчиком как представляет класс, как правило, свойства которого отражают столбцы базовой таблицы базы данных бизнес-объекта.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-182">A business object is implemented by the developer as a class whose properties typically reflect the columns of the underlying database table the business object represents.</span></span> <span data-ttu-id="8b4b7-183">Типизированный набор данных — это класс, созданный Visual Studio, на основе схемы базы данных и, члены которого являются строго типизированными в соответствии с этой схемы.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-183">A Typed DataSet is a class generated for you by Visual Studio based on a database schema and whose members are strongly-typed according to this schema.</span></span> <span data-ttu-id="8b4b7-184">Типизированные сам набор данных состоит из классов, расширяющих классы ADO.NET DataSet, DataTable и DataRow.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-184">The Typed DataSet itself consists of classes that extend the ADO.NET DataSet, DataTable, and DataRow classes.</span></span> <span data-ttu-id="8b4b7-185">Помимо строго типизированных объектов DataTable типизированные наборы данных теперь также включают адаптеры таблиц TableAdapter, которые являются классы, методы для заполнения таблицы данных набора данных и внесения изменений, сделанных в объектах DataTable в базе данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-185">In addition to strongly-typed DataTables, Typed DataSets now also include TableAdapters, which are classes with methods for populating the DataSet's DataTables and propagating modifications within the DataTables back to the database.</span></span>

> [!NOTE]
> <span data-ttu-id="8b4b7-186">Дополнительные сведения о преимуществах и недостатках использования типизированных наборов данных и пользовательских бизнес-объектов см. [проектирование компоненты уровня данных и передачи данных через уровни](https://msdn.microsoft.com/library/ms978496.aspx).</span><span class="sxs-lookup"><span data-stu-id="8b4b7-186">For more information on the advantages and disadvantages of using Typed DataSets versus custom business objects, refer to [Designing Data Tier Components and Passing Data Through Tiers](https://msdn.microsoft.com/library/ms978496.aspx).</span></span>


<span data-ttu-id="8b4b7-187">Эти учебники по архитектуре, мы будем использовать строго типизированных наборов данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-187">We'll use strongly-typed DataSets for these tutorials' architecture.</span></span> <span data-ttu-id="8b4b7-188">На рисунке 3 показан рабочий процесс между различными уровнями приложения, использующего типизированные наборы данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-188">Figure 3 illustrates the workflow between the different layers of an application that uses Typed DataSets.</span></span>


<span data-ttu-id="8b4b7-189">[![Все код доступа к данным делегированием компонента DAL](creating-a-data-access-layer-cs/_static/image6.png)](creating-a-data-access-layer-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-189">[![All Data Access Code is Relegated to the DAL](creating-a-data-access-layer-cs/_static/image6.png)](creating-a-data-access-layer-cs/_static/image5.png)</span></span>

<span data-ttu-id="8b4b7-190">**Рис. 3**: все код доступа к данным делегированием компонента DAL ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image7.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-190">**Figure 3**: All Data Access Code is Relegated to the DAL ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image7.png))</span></span>


## <a name="creating-a-typed-dataset-and-table-adapter"></a><span data-ttu-id="8b4b7-191">Создание типизированного набора данных и адаптера таблиц</span><span class="sxs-lookup"><span data-stu-id="8b4b7-191">Creating a Typed DataSet and Table Adapter</span></span>

<span data-ttu-id="8b4b7-192">Чтобы начать создание DAL, начнем с добавления типизированного набора данных в свой проект.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-192">To begin creating our DAL, we start by adding a Typed DataSet to our project.</span></span> <span data-ttu-id="8b4b7-193">Для этого щелкните правой кнопкой мыши узел проекта в обозревателе решений и выберите команду Добавить новый элемент.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-193">To accomplish this, right-click on the project node in the Solution Explorer and choose Add a New Item.</span></span> <span data-ttu-id="8b4b7-194">Выберите параметр набора данных из списка шаблонов и назовите его **именем Northwind.xsd**.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-194">Select the DataSet option from the list of templates and name it **Northwind.xsd**.</span></span>


<span data-ttu-id="8b4b7-195">[![Добавить новый набор данных в проект](creating-a-data-access-layer-cs/_static/image9.png)](creating-a-data-access-layer-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-195">[![Choose to Add a New DataSet to Your Project](creating-a-data-access-layer-cs/_static/image9.png)](creating-a-data-access-layer-cs/_static/image8.png)</span></span>

<span data-ttu-id="8b4b7-196">**Рис. 4**: добавить в проект новый набор данных ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-196">**Figure 4**: Choose to Add a New DataSet to Your Project ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image10.png))</span></span>


<span data-ttu-id="8b4b7-197">После нажатия кнопки Добавить, когда будет предложено добавить набор данных **приложения\_кода** папку, выберите "Да".</span><span class="sxs-lookup"><span data-stu-id="8b4b7-197">After clicking Add, when prompted to add the DataSet to the **App\_Code** folder, choose Yes.</span></span> <span data-ttu-id="8b4b7-198">Конструктор для типизированного набора данных будет отображаться и запустится мастер настройки адаптера таблицы, позволяя добавлять первый адаптер TableAdapter к типизированному DataSet.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-198">The Designer for the Typed DataSet will then be displayed, and the TableAdapter Configuration Wizard will start, allowing you to add your first TableAdapter to the Typed DataSet.</span></span>

<span data-ttu-id="8b4b7-199">Типизированный набор данных служит в качестве строго типизированной коллекции данных. он состоит из строго типизированных экземпляров таблицы DataTable, в свою очередь каждый из которых состоит из строго типизированных экземпляров строки DataRow.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-199">A Typed DataSet serves as a strongly-typed collection of data; it is composed of strongly-typed DataTable instances, each of which is in turn composed of strongly-typed DataRow instances.</span></span> <span data-ttu-id="8b4b7-200">Мы создадим строго типизированный объект DataTable для каждого из базовых таблиц базы данных, необходимых для работы с этой серии учебники.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-200">We will create a strongly-typed DataTable for each of the underlying database tables that we need to work with in this tutorials series.</span></span> <span data-ttu-id="8b4b7-201">Начнем с создания таблицы DataTable для **продуктов** таблицы.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-201">Let's start with creating a DataTable for the **Products** table.</span></span>

<span data-ttu-id="8b4b7-202">Имейте в виду, что строго типизированных объектов DataTable не включены сведения о том, как получить доступ к данным из их базовой таблицы базы данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-202">Keep in mind that strongly-typed DataTables do not include any information on how to access data from their underlying database table.</span></span> <span data-ttu-id="8b4b7-203">Для получения данных для заполнения таблицы данных, мы используем класс TableAdapter, который действует как наш уровень доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-203">In order to retrieve the data to populate the DataTable, we use a TableAdapter class, which functions as our Data Access Layer.</span></span> <span data-ttu-id="8b4b7-204">Для наших **продуктов** DataTable, адаптера таблицы будет содержать методы **GetProducts()**, **GetProductByCategoryID (*categoryID*)** и так далее, будут вызываться из уровня представления.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-204">For our **Products** DataTable, the TableAdapter will contain the methods **GetProducts()**, **GetProductByCategoryID(*categoryID*)**, and so on that we'll invoke from the presentation layer.</span></span> <span data-ttu-id="8b4b7-205">Роль объекта DataTable, — в качестве строго типизированных объектов, используемым для передачи данных между слоями.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-205">The DataTable's role is to serve as the strongly-typed objects used to pass data between the layers.</span></span>

<span data-ttu-id="8b4b7-206">Мастер настройки адаптера таблицы начинается с приглашением выбрать базу данных для работы с.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-206">The TableAdapter Configuration Wizard begins by prompting you to select which database to work with.</span></span> <span data-ttu-id="8b4b7-207">Раскрывающемся списке показаны эти базы данных в обозревателе серверов.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-207">The drop-down list shows those databases in the Server Explorer.</span></span> <span data-ttu-id="8b4b7-208">Если базы данных Northwind не добавляется в обозреватель серверов, можно нажмите кнопку новое подключение в данный момент для этого.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-208">If you did not add the Northwind database to the Server Explorer, you can click the New Connection button at this time to do so.</span></span>


<span data-ttu-id="8b4b7-209">[![Выберите из раскрывающегося списка базу данных Northwind](creating-a-data-access-layer-cs/_static/image12.png)](creating-a-data-access-layer-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-209">[![Choose the Northwind Database from the Drop-Down List](creating-a-data-access-layer-cs/_static/image12.png)](creating-a-data-access-layer-cs/_static/image11.png)</span></span>

<span data-ttu-id="8b4b7-210">**Рис. 5**: выберите из раскрывающегося списка базу данных Northwind ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-210">**Figure 5**: Choose the Northwind Database from the Drop-Down List ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image13.png))</span></span>


<span data-ttu-id="8b4b7-211">После выбора базы данных и нажмите кнопку Далее, запрашивается Если вы хотите сохранить строку подключения в **Web.config** файла.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-211">After selecting the database and clicking Next, you'll be asked if you want to save the connection string in the **Web.config** file.</span></span> <span data-ttu-id="8b4b7-212">Сохранение строки подключения позволяет избежать внесения ее жестких закодированных классов TableAdapter, что упрощает ситуацию, если в будущем изменяет строку подключения.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-212">By saving the connection string you'll avoid having it hard coded in the TableAdapter classes, which simplifies things if the connection string information changes in the future.</span></span> <span data-ttu-id="8b4b7-213">Если вы решили сохранить строку подключения в файле конфигурации, он помещается в **&lt;connectionStrings&gt;** секции, которая может быть [при необходимости зашифрованные](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx) для улучшения безопасность или изменены позднее в новую страницу свойств ASP.NET 2.0 в рамках средства графического пользовательского интерфейса администрирования IIS, которое более идеально подходит для администраторов.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-213">If you opt to save the connection string in the configuration file it's placed in the **&lt;connectionStrings&gt;** section, which can be [optionally encrypted](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx) for improved security or modified later through the new ASP.NET 2.0 Property Page within the IIS GUI Admin Tool, which is more ideal for administrators.</span></span>


<span data-ttu-id="8b4b7-214">[![Сохранение строки подключения в файле Web.config](creating-a-data-access-layer-cs/_static/image15.png)](creating-a-data-access-layer-cs/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-214">[![Save the Connection String to Web.config](creating-a-data-access-layer-cs/_static/image15.png)](creating-a-data-access-layer-cs/_static/image14.png)</span></span>

<span data-ttu-id="8b4b7-215">**Рис. 6**: сохранить строку подключения для **Web.config** ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-215">**Figure 6**: Save the Connection String to **Web.config** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image16.png))</span></span>


<span data-ttu-id="8b4b7-216">Далее необходимо определить схему для первой строго типизированный объект DataTable и предоставить первый метод для наших адаптера таблицы для использования при заполнении строго типизированного набора данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-216">Next, we need to define the schema for the first strongly-typed DataTable and provide the first method for our TableAdapter to use when populating the strongly-typed DataSet.</span></span> <span data-ttu-id="8b4b7-217">Следующие два действия выполняются одновременно, создав запрос, который возвращает столбцы из таблицы, которые требуется отразить в нашем объекте DataTable.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-217">These two steps are accomplished simultaneously by creating a query that returns the columns from the table that we want reflected in our DataTable.</span></span> <span data-ttu-id="8b4b7-218">В конце работы мастера мы указываем имя метода для этого запроса.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-218">At the end of the wizard we'll give a method name to this query.</span></span> <span data-ttu-id="8b4b7-219">Если, завершены, этот метод может вызываться из слоя представления.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-219">Once that's been accomplished, this method can be invoked from our presentation layer.</span></span> <span data-ttu-id="8b4b7-220">Метод будет выполнить определенный запрос и заполните строго типизированный объект DataTable.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-220">The method will execute the defined query and populate a strongly-typed DataTable.</span></span>

<span data-ttu-id="8b4b7-221">Чтобы приступить к определению запроса SQL, сначала необходимо указать как мы хотим TableAdapter будет выдавать запрос.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-221">To get started defining the SQL query we must first indicate how we want the TableAdapter to issue the query.</span></span> <span data-ttu-id="8b4b7-222">Мы можно использовать инструкцию SQL ad-hoc, создать новую хранимую процедуру или использовать существующую хранимую процедуру.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-222">We can use an ad-hoc SQL statement, create a new stored procedure, or use an existing stored procedure.</span></span> <span data-ttu-id="8b4b7-223">Эти руководства мы будем использовать специализированные инструкции SQL.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-223">For these tutorials we'll use ad-hoc SQL statements.</span></span> <span data-ttu-id="8b4b7-224">Ссылаться на [Брайан Нойс](http://briannoyes.net/)в статью, [сборки уровня доступа к данным с помощью конструктора набора данных Visual Studio 2005](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner) пример использования хранимых процедур.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-224">Refer to [Brian Noyes](http://briannoyes.net/)'s article, [Build a Data Access Layer with the Visual Studio 2005 DataSet Designer](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner) for an example of using stored procedures.</span></span>


<span data-ttu-id="8b4b7-225">[![Запрос данных с помощью инструкции SQL Ad-Hoc](creating-a-data-access-layer-cs/_static/image18.png)](creating-a-data-access-layer-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-225">[![Query the Data Using an Ad-Hoc SQL Statement](creating-a-data-access-layer-cs/_static/image18.png)](creating-a-data-access-layer-cs/_static/image17.png)</span></span>

<span data-ttu-id="8b4b7-226">**Рис. 7**: запрос данных с помощью инструкции SQL Ad-Hoc ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image19.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-226">**Figure 7**: Query the Data Using an Ad-Hoc SQL Statement ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image19.png))</span></span>


<span data-ttu-id="8b4b7-227">На этом этапе можно ввести запрос SQL вручную.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-227">At this point we can type in the SQL query by hand.</span></span> <span data-ttu-id="8b4b7-228">При создании первого метода в адаптере таблиц обычно требуется запрос возвращает те столбцы, которые должны выражаться в соответствующем объекте DataTable.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-228">When creating the first method in the TableAdapter you typically want to have the query return those columns that need to be expressed in the corresponding DataTable.</span></span> <span data-ttu-id="8b4b7-229">Это можно сделать, создав запрос, возвращающий все столбцы и строки из **продуктов** таблицы:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-229">We can accomplish this by creating a query that returns all columns and all rows from the **Products** table:</span></span>


<span data-ttu-id="8b4b7-230">[![Введите запрос SQL в текстовое поле](creating-a-data-access-layer-cs/_static/image21.png)](creating-a-data-access-layer-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-230">[![Enter the SQL Query Into the Textbox](creating-a-data-access-layer-cs/_static/image21.png)](creating-a-data-access-layer-cs/_static/image20.png)</span></span>

<span data-ttu-id="8b4b7-231">**Рис. 8**: Введите SQL запрос в текстовое поле ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-231">**Figure 8**: Enter the SQL Query Into the Textbox ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image22.png))</span></span>


<span data-ttu-id="8b4b7-232">Можно также использовать построитель запросов и графически конструирования запроса, как показано на рис. 9.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-232">Alternatively, use the Query Builder and graphically construct the query, as shown in Figure 9.</span></span>


<span data-ttu-id="8b4b7-233">[![Создайте запрос графически посредством редактора запросов](creating-a-data-access-layer-cs/_static/image24.png)](creating-a-data-access-layer-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-233">[![Create the Query Graphically, through the Query Editor](creating-a-data-access-layer-cs/_static/image24.png)](creating-a-data-access-layer-cs/_static/image23.png)</span></span>

<span data-ttu-id="8b4b7-234">**Рис. 9**: создайте запрос графически посредством редактора запросов ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-234">**Figure 9**: Create the Query Graphically, through the Query Editor ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image25.png))</span></span>


<span data-ttu-id="8b4b7-235">После создания запроса, но до перехода к следующему экрану нажмите кнопку Дополнительно.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-235">After creating the query, but before moving onto the next screen, click the Advanced Options button.</span></span> <span data-ttu-id="8b4b7-236">В проектах веб-сайта «создать инструкции Insert, Update и Delete инструкции» является единственным дополнительный параметр выбран по умолчанию. Если запустить этот мастер из библиотеки классов или проекта Windows также выбирается параметр «Использовать оптимистичный параллелизм».</span><span class="sxs-lookup"><span data-stu-id="8b4b7-236">In Web Site Projects, "Generate Insert, Update, and Delete statements" is the only advanced option selected by default; if you run this wizard from a Class Library or a Windows Project the "Use optimistic concurrency" option will also be selected.</span></span> <span data-ttu-id="8b4b7-237">Не устанавливайте параметр «Использовать оптимистичный параллелизм» флажок сейчас.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-237">Leave the "Use optimistic concurrency" option unchecked for now.</span></span> <span data-ttu-id="8b4b7-238">Мы рассмотрим оптимистичного параллелизма в будущих учебниках.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-238">We'll examine optimistic concurrency in future tutorials.</span></span>


<span data-ttu-id="8b4b7-239">[![Только создать инструкции Insert, Update и Delete инструкции SELECT параметр](creating-a-data-access-layer-cs/_static/image27.png)](creating-a-data-access-layer-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-239">[![Select Only the Generate Insert, Update, and Delete statements Option](creating-a-data-access-layer-cs/_static/image27.png)](creating-a-data-access-layer-cs/_static/image26.png)</span></span>

<span data-ttu-id="8b4b7-240">**Рис. 10**: только создать инструкции Insert, Update и Delete инструкции Select параметр ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-240">**Figure 10**: Select Only the Generate Insert, Update, and Delete statements Option ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image28.png))</span></span>


<span data-ttu-id="8b4b7-241">Проверив Дополнительные параметры, нажмите кнопку Далее, чтобы перейти к последней странице.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-241">After verifying the advanced options, click Next to proceed to the final screen.</span></span> <span data-ttu-id="8b4b7-242">Здесь мы будет предложено выбрать, какие методы для добавления в адаптер таблицы.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-242">Here we are asked to select which methods to add to the TableAdapter.</span></span> <span data-ttu-id="8b4b7-243">Существует два варианта внесения данных:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-243">There are two patterns for populating data:</span></span>

- <span data-ttu-id="8b4b7-244">**Заполнить таблицу данных** при таком подходе создается метод, принимающий DataTable в качестве параметра и заполняющий его на основе результатов запроса.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-244">**Fill a DataTable** with this approach a method is created that takes in a DataTable as a parameter and populates it based on the results of the query.</span></span> <span data-ttu-id="8b4b7-245">Класс ADO.NET DataAdapter, например, реализует этот шаблон, с его **Fill()** метод.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-245">The ADO.NET DataAdapter class, for example, implements this pattern with its **Fill()** method.</span></span>
- <span data-ttu-id="8b4b7-246">**Вернуть таблицу данных** при таком подходе метод создает и заполняет DataTable и возвращает его в качестве возвращаемого значения метода.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-246">**Return a DataTable** with this approach the method creates and fills the DataTable for you and returns it as the methods return value.</span></span>

<span data-ttu-id="8b4b7-247">Может иметь TableAdapter реализовывать один или оба этих способа.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-247">You can have the TableAdapter implement one or both of these patterns.</span></span> <span data-ttu-id="8b4b7-248">Можно также переименовать приведенные здесь методы.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-248">You can also rename the methods provided here.</span></span> <span data-ttu-id="8b4b7-249">Оставим установленными оба флажка, несмотря на то, что мы будем только использовать второй вариант в этих учебниках.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-249">Let's leave both checkboxes checked, even though we'll only be using the latter pattern throughout these tutorials.</span></span> <span data-ttu-id="8b4b7-250">Кроме того, переименуем довольно общий **GetData** метод **GetProducts**.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-250">Also, let's rename the rather generic **GetData** method to **GetProducts**.</span></span>

<span data-ttu-id="8b4b7-251">Если этот флажок установлен, последний флажок «GenerateDBDirectMethods», создает **Insert()**, **Update()**, и **Delete()** методы адаптера таблицы.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-251">If checked, the final checkbox, "GenerateDBDirectMethods," creates **Insert()**, **Update()**, and **Delete()** methods for the TableAdapter.</span></span> <span data-ttu-id="8b4b7-252">Если этот флажок не установлен, все обновления потребуется сделать с помощью адаптера таблицы единственная **Update()** метод, который принимает типизированного набора DataSet, DataTable, отдельный объект DataRow или массив объектов DataRow.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-252">If you leave this option unchecked, all updates will need to be done through the TableAdapter's sole **Update()** method, which takes in the Typed DataSet, a DataTable, a single DataRow, or an array of DataRows.</span></span> <span data-ttu-id="8b4b7-253">(Если вы уже снят флажок «Создать инструкции Insert, Update и Delete операторы» параметр из дополнительных свойств на рис. 9 этот флажок параметра не повлияет.) Давайте оставить этот флажок установленным.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-253">(If you've unchecked the "Generate Insert, Update, and Delete statements" option from the advanced properties in Figure 9 this checkbox's setting will have no effect.) Let's leave this checkbox selected.</span></span>


<span data-ttu-id="8b4b7-254">[![Измените имя метода GetData для GetProducts](creating-a-data-access-layer-cs/_static/image30.png)](creating-a-data-access-layer-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-254">[![Change the Method Name from GetData to GetProducts](creating-a-data-access-layer-cs/_static/image30.png)](creating-a-data-access-layer-cs/_static/image29.png)</span></span>

<span data-ttu-id="8b4b7-255">**Рис. 11**: измените имя метода **GetData** для **GetProducts** ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-255">**Figure 11**: Change the Method Name from **GetData** to **GetProducts** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image31.png))</span></span>


<span data-ttu-id="8b4b7-256">Завершите работу мастера, нажав кнопку Готово.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-256">Complete the wizard by clicking Finish.</span></span> <span data-ttu-id="8b4b7-257">После завершения работы мастера мы возвращаются конструктора наборов данных, которые показаны только что созданный объект DataTable.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-257">After the wizard closes we are returned to the DataSet Designer which shows the DataTable we just created.</span></span> <span data-ttu-id="8b4b7-258">Можно просмотреть список столбцов в **продуктов** DataTable (**ProductID**, **ProductName**и так далее), а также методы  **ProductsTableAdapter** (**Fill()** и **GetProducts()**).</span><span class="sxs-lookup"><span data-stu-id="8b4b7-258">You can see the list of columns in the **Products** DataTable (**ProductID**, **ProductName**, and so on), as well as the methods of the **ProductsTableAdapter** (**Fill()** and **GetProducts()**).</span></span>


<span data-ttu-id="8b4b7-259">[![DataTable продуктов и ProductsTableAdapter были добавлены к типизированному DataSet](creating-a-data-access-layer-cs/_static/image33.png)](creating-a-data-access-layer-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-259">[![The Products DataTable and ProductsTableAdapter have been Added to the Typed DataSet](creating-a-data-access-layer-cs/_static/image33.png)](creating-a-data-access-layer-cs/_static/image32.png)</span></span>

<span data-ttu-id="8b4b7-260">**Рис. 12**: **продуктов** DataTable и **ProductsTableAdapter** были добавлены к типизированному DataSet ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-260">**Figure 12**: The **Products** DataTable and **ProductsTableAdapter** have been Added to the Typed DataSet ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image34.png))</span></span>


<span data-ttu-id="8b4b7-261">На этом этапе у нас есть типизированного набора данных с одним объектом DataTable (**Northwind.Products**) и строго типизированный класс DataAdapter (**NorthwindTableAdapters.ProductsTableAdapter**) с  **GetProducts()** метод.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-261">At this point we have a Typed DataSet with a single DataTable (**Northwind.Products**) and a strongly-typed DataAdapter class (**NorthwindTableAdapters.ProductsTableAdapter**) with a **GetProducts()** method.</span></span> <span data-ttu-id="8b4b7-262">Эти объекты можно использовать для доступа к списку всех продуктов из кода следующего вида:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-262">These objects can be used to access a list of all products from code like:</span></span>

[!code-html[Main](creating-a-data-access-layer-cs/samples/sample1.html)]

<span data-ttu-id="8b4b7-263">Этот код не требует от нас написать один бит кода, характерного для доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-263">This code did not require us to write one bit of data access-specific code.</span></span> <span data-ttu-id="8b4b7-264">Нам не нужно создать все классы ADO.NET, нам не пришлось ссылаться на любые строки подключения SQL-запросов или хранимых процедур.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-264">We did not have to instantiate any ADO.NET classes, we didn't have to refer to any connection strings, SQL queries, or stored procedures.</span></span> <span data-ttu-id="8b4b7-265">Вместо этого TableAdapter предоставляет код доступа к данным на нижнем уровне для нас.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-265">Instead, the TableAdapter provides the low-level data access code for us.</span></span>

<span data-ttu-id="8b4b7-266">Каждый объект, используемый в этом примере также является строго типизированным, что позволяет Visual Studio для обеспечения поддержки технологии IntelliSense и проверки типов во время компиляции.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-266">Each object used in this example is also strongly-typed, allowing Visual Studio to provide IntelliSense and compile-time type checking.</span></span> <span data-ttu-id="8b4b7-267">И лучшее из всех таблиц данных, возвращенных адаптера таблицы могут быть привязаны к данным ASP.NET веб-элементов управления GridView, DetailsView, DropDownList, CheckBoxList и несколько других.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-267">And best of all the DataTables returned by the TableAdapter can be bound to ASP.NET data Web controls, such as the GridView, DetailsView, DropDownList, CheckBoxList, and several others.</span></span> <span data-ttu-id="8b4b7-268">В следующем примере демонстрируется привязка DataTable, возвращенный **GetProducts()** к GridView в только что просмотров три строки кода в **страницы\_нагрузки** обработчика событий.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-268">The following example illustrates binding the DataTable returned by the **GetProducts()** method to a GridView in just a scant three lines of code within the **Page\_Load** event handler.</span></span>

<span data-ttu-id="8b4b7-269">AllProducts.aspx</span><span class="sxs-lookup"><span data-stu-id="8b4b7-269">AllProducts.aspx</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample2.aspx)]

<span data-ttu-id="8b4b7-270">AllProducts.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="8b4b7-270">AllProducts.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample3.cs)]


<span data-ttu-id="8b4b7-271">[![Список продуктов, отображаемый в GridView](creating-a-data-access-layer-cs/_static/image36.png)](creating-a-data-access-layer-cs/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-271">[![The List of Products is Displayed in a GridView](creating-a-data-access-layer-cs/_static/image36.png)](creating-a-data-access-layer-cs/_static/image35.png)</span></span>

<span data-ttu-id="8b4b7-272">**Рис. 13**: список продуктов, отображаемый в элементе управления GridView ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image37.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-272">**Figure 13**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image37.png))</span></span>


<span data-ttu-id="8b4b7-273">Хотя в этом примере потребовалось написать три строки кода в странице ASP.NET **страницы\_нагрузки** обработчик событий, в будущих учебниках мы изучим, как использовать элемент управления ObjectDataSource для декларативного извлечения данных из DAL.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-273">While this example required that we write three lines of code in our ASP.NET page's **Page\_Load** event handler, in future tutorials we'll examine how to use the ObjectDataSource to declaratively retrieve the data from the DAL.</span></span> <span data-ttu-id="8b4b7-274">Использование ObjectDataSource вам не придется писать код и получите поддержку разбиения по страницам и сортировки!</span><span class="sxs-lookup"><span data-stu-id="8b4b7-274">With the ObjectDataSource we'll not have to write any code and will get paging and sorting support as well!</span></span>

## <a name="step-3-adding-parameterized-methods-to-the-data-access-layer"></a><span data-ttu-id="8b4b7-275">Шаг 3: Добавление параметризованных методы для доступа к данным</span><span class="sxs-lookup"><span data-stu-id="8b4b7-275">Step 3: Adding Parameterized Methods to the Data Access Layer</span></span>

<span data-ttu-id="8b4b7-276">На этом этапе нашей **ProductsTableAdapter** обладает всего лишь один метод **GetProducts()**, который возвращает все продукты в базе данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-276">At this point our **ProductsTableAdapter** class has but one method, **GetProducts()**, which returns all of the products in the database.</span></span> <span data-ttu-id="8b4b7-277">Возможность работы со всеми продуктами определенно полезен, бывают ситуации, когда нам требуется получить сведения о определенному продукту или все продукты, относящиеся к определенной категории.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-277">While being able to work with all products is definitely useful, there are times when we'll want to retrieve information about a specific product, or all products that belong to a particular category.</span></span> <span data-ttu-id="8b4b7-278">Добавление таких функций к слою доступа данных можно добавить параметризованные методы в адаптер таблицы.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-278">To add such functionality to our Data Access Layer we can add parameterized methods to the TableAdapter.</span></span>

<span data-ttu-id="8b4b7-279">Давайте добавим **GetProductsByCategoryID (*categoryID*)** метод.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-279">Let's add the **GetProductsByCategoryID(*categoryID*)** method.</span></span> <span data-ttu-id="8b4b7-280">Для добавления нового метода DAL, вернитесь в конструкторе наборов данных, щелкните правой кнопкой мыши в **ProductsTableAdapter** и выберите Добавить запрос.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-280">To add a new method to the DAL, return to the DataSet Designer, right-click in the **ProductsTableAdapter** section, and choose Add Query.</span></span>


![Щелкните правой кнопкой мыши в TableAdapter и выберите команду Добавить запрос](creating-a-data-access-layer-cs/_static/image38.png)

<span data-ttu-id="8b4b7-282">**Рис. 14**: щелкните правой кнопкой мыши в TableAdapter и выберите команду Добавить запрос</span><span class="sxs-lookup"><span data-stu-id="8b4b7-282">**Figure 14**: Right-Click on the TableAdapter and Choose Add Query</span></span>


<span data-ttu-id="8b4b7-283">Мы сначала будет предложено мы хотим получить доступ к базе данных с помощью нерегламентированных инструкций SQL или новой или существующей хранимой процедуры.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-283">We are first prompted about whether we want to access the database using an ad-hoc SQL statement or a new or existing stored procedure.</span></span> <span data-ttu-id="8b4b7-284">Давайте решено использовать инструкции SQL ad-hoc еще раз.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-284">Let's choose to use an ad-hoc SQL statement again.</span></span> <span data-ttu-id="8b4b7-285">Затем запрашивается тип запроса SQL, мы хотели бы использовать.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-285">Next, we are asked what type of SQL query we'd like to use.</span></span> <span data-ttu-id="8b4b7-286">Поскольку нам требуется возвратить все продукты, принадлежащие к указанной категории, нам потребуется написать **ВЫБЕРИТЕ** инструкции, которая возвращает строки.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-286">Since we want to return all products that belong to a specified category, we want to write a **SELECT** statement which returns rows.</span></span>


<span data-ttu-id="8b4b7-287">[![Выберите для создания инструкции SELECT, возвращающая строки](creating-a-data-access-layer-cs/_static/image40.png)](creating-a-data-access-layer-cs/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-287">[![Choose to Create a SELECT Statement Which Returns Rows](creating-a-data-access-layer-cs/_static/image40.png)](creating-a-data-access-layer-cs/_static/image39.png)</span></span>

<span data-ttu-id="8b4b7-288">**Рис. 15**: выберите, чтобы создать **ВЫБЕРИТЕ** инструкции которого возвращает строки ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image41.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-288">**Figure 15**: Choose to Create a **SELECT** Statement Which Returns Rows ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image41.png))</span></span>


<span data-ttu-id="8b4b7-289">Следующим шагом является определение SQL-запрос, используемый для доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-289">The next step is to define the SQL query used to access the data.</span></span> <span data-ttu-id="8b4b7-290">Поскольку нам требуется возвратить только те продукты, которые принадлежат определенной категории, используйте тот же <strong>ВЫБЕРИТЕ</strong> инструкции от <strong>GetProducts()</strong>, но с добавлением следующего <strong>ГДЕ</strong> предложение: <strong>ГДЕ CategoryID = @CategoryID</strong> .</span><span class="sxs-lookup"><span data-stu-id="8b4b7-290">Since we want to return only those products that belong to a particular category, I use the same <strong>SELECT</strong> statement from <strong>GetProducts()</strong>, but add the following <strong>WHERE</strong> clause: <strong>WHERE CategoryID = @CategoryID</strong>.</span></span> <span data-ttu-id="8b4b7-291"><strong>@CategoryID</strong> Параметр указывает Мастер TableAdapter, что мы создаем метод будет требуется входной параметр соответствующего типа (а именно неотрицательного целого).</span><span class="sxs-lookup"><span data-stu-id="8b4b7-291">The <strong>@CategoryID</strong> parameter indicates to the TableAdapter wizard that the method we're creating will require an input parameter of the corresponding type (namely, a nullable integer).</span></span>


<span data-ttu-id="8b4b7-292">[![Введите запрос, чтобы возвращать только продуктов в указанной категории](creating-a-data-access-layer-cs/_static/image43.png)](creating-a-data-access-layer-cs/_static/image42.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-292">[![Enter a Query to Only Return Products in a Specified Category](creating-a-data-access-layer-cs/_static/image43.png)](creating-a-data-access-layer-cs/_static/image42.png)</span></span>

<span data-ttu-id="8b4b7-293">**На рисунке 16**: Введите запрос только возвращают продукты в категории указано ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image44.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-293">**Figure 16**: Enter a Query to Only Return Products in a Specified Category ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image44.png))</span></span>


<span data-ttu-id="8b4b7-294">На последнем шаге можно выбрать которой шаблоны для использования, а также настроить имена создаваемых методов доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-294">In the final step we can choose which data access patterns to use, as well as customize the names of the methods generated.</span></span> <span data-ttu-id="8b4b7-295">Для шаблона Fill изменим имя <strong>FillByCategoryID</strong> и для возврата объекта DataTable возвращенное шаблон ( <strong>получить*X</strong>*  методы), воспользуемся  <strong>GetProductsByCategoryID</strong>.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-295">For the Fill pattern, let's change the name to <strong>FillByCategoryID</strong> and for the return a DataTable return pattern (the <strong>Get*X</strong>* methods), let's use <strong>GetProductsByCategoryID</strong>.</span></span>


<span data-ttu-id="8b4b7-296">[![Выберите имена для методы адаптера таблицы](creating-a-data-access-layer-cs/_static/image46.png)](creating-a-data-access-layer-cs/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-296">[![Choose the Names for the TableAdapter Methods](creating-a-data-access-layer-cs/_static/image46.png)](creating-a-data-access-layer-cs/_static/image45.png)</span></span>

<span data-ttu-id="8b4b7-297">**Рисунок 17**: выберите имена для методы адаптера таблицы ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image47.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-297">**Figure 17**: Choose the Names for the TableAdapter Methods ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image47.png))</span></span>


<span data-ttu-id="8b4b7-298">По завершении работы мастера конструктор набора данных включает в себя новые методы адаптера таблицы.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-298">After completing the wizard, the DataSet Designer includes the new TableAdapter methods.</span></span>


![Теперь продукты можно запрашивать по категории](creating-a-data-access-layer-cs/_static/image48.png)

<span data-ttu-id="8b4b7-300">**На рисунке 18**: теперь продукты можно запрашивать по категории</span><span class="sxs-lookup"><span data-stu-id="8b4b7-300">**Figure 18**: The Products Can Now be Queried by Category</span></span>


<span data-ttu-id="8b4b7-301">Теперь пора добавить **GetProductByProductID (*productID*)** метод таким же способом.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-301">Take a moment to add a **GetProductByProductID(*productID*)** method using the same technique.</span></span>

<span data-ttu-id="8b4b7-302">Эти параметризованные запросы можно протестировать непосредственно из конструктора наборов данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-302">These parameterized queries can be tested directly from the DataSet Designer.</span></span> <span data-ttu-id="8b4b7-303">Щелкните правой кнопкой мыши метод в TableAdapter и выберите данные для предварительного просмотра.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-303">Right-click on the method in the TableAdapter and choose Preview Data.</span></span> <span data-ttu-id="8b4b7-304">Затем введите значения для параметров и нажмите кнопку просмотра.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-304">Next, enter the values to use for the parameters and click Preview.</span></span>


<span data-ttu-id="8b4b7-305">[![Показаны эти продукты, принадлежащие к категории напитков](creating-a-data-access-layer-cs/_static/image50.png)](creating-a-data-access-layer-cs/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-305">[![Those Products Belonging to the Beverages Category are Shown](creating-a-data-access-layer-cs/_static/image50.png)](creating-a-data-access-layer-cs/_static/image49.png)</span></span>

<span data-ttu-id="8b4b7-306">**На рисунке 19**: отображаются те продукты, принадлежащие к категории «Напитки» ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image51.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-306">**Figure 19**: Those Products Belonging to the Beverages Category are Shown ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image51.png))</span></span>


<span data-ttu-id="8b4b7-307">С **GetProductsByCategoryID (*categoryID*)** метод в DAL, теперь можно создать страницы ASP.NET, которая отображает только те продукты, в указанной категории.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-307">With the **GetProductsByCategoryID(*categoryID*)** method in our DAL, we can now create an ASP.NET page that displays only those products in a specified category.</span></span> <span data-ttu-id="8b4b7-308">В следующем примере показано все продукты в категории "Напитки", которые имеют **CategoryID** 1.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-308">The following example shows all products that are in the Beverages category, which have a **CategoryID** of 1.</span></span>

<span data-ttu-id="8b4b7-309">Beverages.ASP</span><span class="sxs-lookup"><span data-stu-id="8b4b7-309">Beverages.asp</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample4.aspx)]

<span data-ttu-id="8b4b7-310">Beverages.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="8b4b7-310">Beverages.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample5.cs)]


<span data-ttu-id="8b4b7-311">[![Отображаются продукты в категории «Напитки»](creating-a-data-access-layer-cs/_static/image53.png)](creating-a-data-access-layer-cs/_static/image52.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-311">[![Those Products in the Beverages Category are Displayed](creating-a-data-access-layer-cs/_static/image53.png)](creating-a-data-access-layer-cs/_static/image52.png)</span></span>

<span data-ttu-id="8b4b7-312">**Рис. 20**: отображаются те продукты в категории «Напитки» ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image54.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-312">**Figure 20**: Those Products in the Beverages Category are Displayed ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image54.png))</span></span>


## <a name="step-4-inserting-updating-and-deleting-data"></a><span data-ttu-id="8b4b7-313">Шаг 4: Вставка, обновление и удаление данных</span><span class="sxs-lookup"><span data-stu-id="8b4b7-313">Step 4: Inserting, Updating, and Deleting Data</span></span>

<span data-ttu-id="8b4b7-314">Существует два варианта, обычно используется для вставки, обновления и удаления данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-314">There are two patterns commonly used for inserting, updating, and deleting data.</span></span> <span data-ttu-id="8b4b7-315">Первый шаблон, который мы будем называть непосредственной схемы базы данных, включает в себя создание методов, которые при вызове проблема **вставить**, **обновление**, или **удалить** команды База данных, работающая на запись в одной базе данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-315">The first pattern, which I'll call the database direct pattern, involves creating methods that, when invoked, issue an **INSERT**, **UPDATE**, or **DELETE** command to the database that operates on a single database record.</span></span> <span data-ttu-id="8b4b7-316">Такие методы обычно передается в виде последовательности скалярных значений (целые числа, строки, логические значения, даты и т. д.), соответствующие значения для вставки, обновления или удаления.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-316">Such methods are typically passed in a series of scalar values (integers, strings, Booleans, DateTimes, and so on) that correspond to the values to insert, update, or delete.</span></span> <span data-ttu-id="8b4b7-317">Например, с помощью этого шаблона для **продуктов** принимает целочисленный параметр, метод удаления таблицы, указывающее, **ProductID** записи для удаления, а метод insert принимает Строка для **ProductName**, десятичное число для **UnitPrice**, целое число для **UnitsOnStock**, и т. д.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-317">For example, with this pattern for the **Products** table the delete method would take in an integer parameter, indicating the **ProductID** of the record to delete, while the insert method would take in a string for the **ProductName**, a decimal for the **UnitPrice**, an integer for the **UnitsOnStock**, and so on.</span></span>


<span data-ttu-id="8b4b7-318">[![Для базы данных немедленно отправляется каждой вставки, обновления и запрос на удаление](creating-a-data-access-layer-cs/_static/image56.png)](creating-a-data-access-layer-cs/_static/image55.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-318">[![Each Insert, Update, and Delete Request is Sent to the Database Immediately](creating-a-data-access-layer-cs/_static/image56.png)](creating-a-data-access-layer-cs/_static/image55.png)</span></span>

<span data-ttu-id="8b4b7-319">**Рисунок 21**: каждой вставки, обновления и запроса на удаление отправляется базы данных немедленно ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image57.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-319">**Figure 21**: Each Insert, Update, and Delete Request is Sent to the Database Immediately ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image57.png))</span></span>


<span data-ttu-id="8b4b7-320">Другая схема, которую я буду называть пакетного обновления шаблон, является обновление всей DataSet, DataTable или коллекции из DataRow в один вызов метода.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-320">The other pattern, which I'll refer to as the batch update pattern, is to update an entire DataSet, DataTable, or collection of DataRows in one method call.</span></span> <span data-ttu-id="8b4b7-321">С этим шаблоном разработчик удаляет, вставка и изменение объектов DataRow в DataTable и затем передает эти DataRow или DataTable в метод обновления.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-321">With this pattern a developer deletes, inserts, and modifies the DataRows in a DataTable and then passes those DataRows or DataTable into an update method.</span></span> <span data-ttu-id="8b4b7-322">Затем этот метод перечисляет переданные DataRow, определяет ли они были изменены, добавленных или удаленных (через DataRow [свойства RowState](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) значение) и отправляет запрос к соответствующей базе данных для каждой записи.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-322">This method then enumerates the DataRows passed in, determines whether or not they've been modified, added, or deleted (via the DataRow's [RowState property](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) value), and issues the appropriate database request for each record.</span></span>


<span data-ttu-id="8b4b7-323">[![Все изменения синхронизируются с базой данных при вызове метода обновления](creating-a-data-access-layer-cs/_static/image59.png)](creating-a-data-access-layer-cs/_static/image58.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-323">[![All Changes are Synchronized with the Database When the Update Method is Invoked](creating-a-data-access-layer-cs/_static/image59.png)](creating-a-data-access-layer-cs/_static/image58.png)</span></span>

<span data-ttu-id="8b4b7-324">**На рисунке 22**: все изменения синхронизируются с базой данных при вызове метода Update ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image60.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-324">**Figure 22**: All Changes are Synchronized with the Database When the Update Method is Invoked ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image60.png))</span></span>


<span data-ttu-id="8b4b7-325">Адаптер таблицы по умолчанию используется схема пакетного обновления, но также поддерживает непосредственной схемы.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-325">The TableAdapter uses the batch update pattern by default, but also supports the DB direct pattern.</span></span> <span data-ttu-id="8b4b7-326">Поскольку мы выбран параметр «Создать инструкции Insert, Update и Delete инструкции» из дополнительные свойства при создании TableAdapter, **ProductsTableAdapter** содержит **Update()** метода реализующий схему пакетного обновления.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-326">Since we selected the "Generate Insert, Update, and Delete statements" option from the Advanced Properties when creating our TableAdapter, the **ProductsTableAdapter** contains an **Update()** method, which implements the batch update pattern.</span></span> <span data-ttu-id="8b4b7-327">В частности, TableAdapter содержит **Update()** метод, который может быть передан типизированного набора данных, строго типизированный объект DataTable или один или несколько строк DataRow.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-327">Specifically, the TableAdapter contains an **Update()** method that can be passed the Typed DataSet, a strongly-typed DataTable, or one or more DataRows.</span></span> <span data-ttu-id="8b4b7-328">Если параметр «GenerateDBDirectMethods» флажок установлен, при первоначальном создании TableAdapter непосредственная схема базы данных также будет реализована через **Insert()**, **Update()**, и **Delete()**  методы.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-328">If you left the "GenerateDBDirectMethods" checkbox checked when first creating the TableAdapter the DB direct pattern will also be implemented via **Insert()**, **Update()**, and **Delete()** methods.</span></span>

<span data-ttu-id="8b4b7-329">Обе схемы изменения данных используют свойства **InsertCommand**, **UpdateCommand**, и **DeleteCommand** свойства для выдачи их **вставки** , **Обновление**, и **удалить** команды в базу данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-329">Both data modification patterns use the TableAdapter's **InsertCommand**, **UpdateCommand**, and **DeleteCommand** properties to issue their **INSERT**, **UPDATE**, and **DELETE** commands to the database.</span></span> <span data-ttu-id="8b4b7-330">Можно проверять и изменять **InsertCommand**, **UpdateCommand**, и **DeleteCommand** свойств, щелкнув адаптера таблицы в конструкторе наборов данных, а затем перейдя в окне «Свойства».</span><span class="sxs-lookup"><span data-stu-id="8b4b7-330">You can inspect and modify the **InsertCommand**, **UpdateCommand**, and **DeleteCommand** properties by clicking on the TableAdapter in the DataSet Designer and then going to the Properties window.</span></span> <span data-ttu-id="8b4b7-331">(Убедитесь, что выбран TableAdapter и что **ProductsTableAdapter** объект является выбранный в раскрывающемся списке в окне «Свойства».)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-331">(Make sure you have selected the TableAdapter, and that the **ProductsTableAdapter** object is the one selected in the drop-down list in the Properties window.)</span></span>


<span data-ttu-id="8b4b7-332">[![Адаптер таблицы имеет InsertCommand, UpdateCommand и DeleteCommand свойства](creating-a-data-access-layer-cs/_static/image62.png)](creating-a-data-access-layer-cs/_static/image61.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-332">[![The TableAdapter has InsertCommand, UpdateCommand, and DeleteCommand Properties](creating-a-data-access-layer-cs/_static/image62.png)](creating-a-data-access-layer-cs/_static/image61.png)</span></span>

<span data-ttu-id="8b4b7-333">**На рисунке 23**: имеет TableAdapter **InsertCommand**, **UpdateCommand**, и **DeleteCommand** свойства ([щелкните представление полного размера изображение](creating-a-data-access-layer-cs/_static/image63.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-333">**Figure 23**: The TableAdapter has **InsertCommand**, **UpdateCommand**, and **DeleteCommand** Properties ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image63.png))</span></span>


<span data-ttu-id="8b4b7-334">Чтобы просмотреть или изменить любые из этих свойств команды базы данных, нажмите кнопку **CommandText** вложенное свойство, чтобы открыть построитель запросов.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-334">To examine or modify any of these database command properties, click on the **CommandText** subproperty, which will bring up the Query Builder.</span></span>


<span data-ttu-id="8b4b7-335">[![Настройка в построителе запросов INSERT, UPDATE и DELETE инструкции](creating-a-data-access-layer-cs/_static/image65.png)](creating-a-data-access-layer-cs/_static/image64.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-335">[![Configure the INSERT, UPDATE, and DELETE Statements in the Query Builder](creating-a-data-access-layer-cs/_static/image65.png)](creating-a-data-access-layer-cs/_static/image64.png)</span></span>

<span data-ttu-id="8b4b7-336">**Рис. 24**: Настройка **вставить**, **обновление**, и **удаление** операторы в построителе запросов ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image66.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-336">**Figure 24**: Configure the **INSERT**, **UPDATE**, and **DELETE** Statements in the Query Builder ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image66.png))</span></span>


<span data-ttu-id="8b4b7-337">В следующем примере кода показано, как использовать схему пакетного обновления выполнить удвоение цены всех продуктов, не поддерживаются и имеют 25 единиц на складе или менее:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-337">The following code example shows how to use the batch update pattern to double the price of all products that are not discontinued and that have 25 units in stock or less:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample6.cs)]

<span data-ttu-id="8b4b7-338">В следующем примере кода показано, как использовать программно удалить конкретный продукт, а затем обновить один непосредственной схемы, а затем добавьте новое:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-338">The code below illustrates how to use the DB direct pattern to programmatically delete a particular product, then update one, and then add a new one:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample7.cs)]

## <a name="creating-custom-insert-update-and-delete-methods"></a><span data-ttu-id="8b4b7-339">Создание пользовательских вставки, обновления и удаления методов</span><span class="sxs-lookup"><span data-stu-id="8b4b7-339">Creating Custom Insert, Update, and Delete Methods</span></span>

<span data-ttu-id="8b4b7-340">**Insert()**, **Update()**, и **Delete()** методы, созданные с непосредственным методом базы данных может быть немного сложно, особенно для таблиц с большим числом столбцов.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-340">The **Insert()**, **Update()**, and **Delete()** methods created by the DB direct method can be a bit cumbersome, especially for tables with many columns.</span></span> <span data-ttu-id="8b4b7-341">Просмотрев в предыдущем примере без функции IntelliSense помочь неясно, особенно то, что **продуктов** сопоставляет каждый входной параметр **Update()** и **Insert()**  методы.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-341">Looking at the previous code example, without IntelliSense's help it's not particularly clear what **Products** table column maps to each input parameter to the **Update()** and **Insert()** methods.</span></span> <span data-ttu-id="8b4b7-342">Могут возникнуть ситуации, когда требуется только обновить один или два столбца или требуется настраиваемый **Insert()** метод, возможно, будет возвращать значение вновь вставленной записи **УДОСТОВЕРЕНИЕ** (с автоматическим приращением) поле.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-342">There may be times when we only want to update a single column or two, or want a customized **Insert()** method that will, perhaps, return the value of the newly inserted record's **IDENTITY** (auto-increment) field.</span></span>

<span data-ttu-id="8b4b7-343">Чтобы создать пользовательский метод, вернитесь в конструктор набора данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-343">To create such a custom method, return to the DataSet Designer.</span></span> <span data-ttu-id="8b4b7-344">Щелкните правой кнопкой мыши в TableAdapter и выберите Добавить запрос, возврат к мастеру TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-344">Right-click on the TableAdapter and choose Add Query, returning to the TableAdapter wizard.</span></span> <span data-ttu-id="8b4b7-345">На второй экран мы указываем тип создаваемого запроса.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-345">On the second screen we can indicate the type of query to create.</span></span> <span data-ttu-id="8b4b7-346">Давайте создадим метод, который добавляет новый продукт и возвращает значение вновь добавленной записи **ProductID**.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-346">Let's create a method that adds a new product and then returns the value of the newly added record's **ProductID**.</span></span> <span data-ttu-id="8b4b7-347">Таким образом, попробовать создать **вставить** запроса.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-347">Therefore, opt to create an **INSERT** query.</span></span>


<span data-ttu-id="8b4b7-348">[![Создайте метод для добавления новой строки к таблице Products](creating-a-data-access-layer-cs/_static/image68.png)](creating-a-data-access-layer-cs/_static/image67.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-348">[![Create a Method to Add a New Row to the Products Table](creating-a-data-access-layer-cs/_static/image68.png)](creating-a-data-access-layer-cs/_static/image67.png)</span></span>

<span data-ttu-id="8b4b7-349">**Рис. 25**: создать метод, чтобы добавить новые строки **продуктов** таблицы ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image69.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-349">**Figure 25**: Create a Method to Add a New Row to the **Products** Table ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image69.png))</span></span>


<span data-ttu-id="8b4b7-350">На следующем экране **InsertCommand** **CommandText** отображается.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-350">On the next screen the **InsertCommand**'s **CommandText** appears.</span></span> <span data-ttu-id="8b4b7-351">Расширить этот запрос, добавив **Выбор области\_IDENTITY()** в конце запроса, который возвращает последнее значение идентификатора, вставленное в **УДОСТОВЕРЕНИЕ** столбец в той же области.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-351">Augment this query by adding **SELECT SCOPE\_IDENTITY()** at the end of the query, which will return the last identity value inserted into an **IDENTITY** column in the same scope.</span></span> <span data-ttu-id="8b4b7-352">(См. [технической документации](https://msdn.microsoft.com/library/ms190315.aspx) Дополнительные сведения о **область\_IDENTITY()** и поэтому может потребоваться [использовать область\_IDENTITY() вместо @ @IDENTITY](http://weblogs.sqlteam.com/travisl/archive/2003/10/29/405.aspx).) Убедитесь, что завершить **вставить** инструкция точкой с запятой перед добавлением **ВЫБЕРИТЕ** инструкции.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-352">(See the [technical documentation](https://msdn.microsoft.com/library/ms190315.aspx) for more information about **SCOPE\_IDENTITY()** and why you probably want to [use SCOPE\_IDENTITY() in lieu of @@IDENTITY](http://weblogs.sqlteam.com/travisl/archive/2003/10/29/405.aspx).) Make sure that you end the **INSERT** statement with a semi-colon before adding the **SELECT** statement.</span></span>


<span data-ttu-id="8b4b7-353">[![Запрос должен возвращать значение SCOPE_IDENTITY() дополнения](creating-a-data-access-layer-cs/_static/image71.png)](creating-a-data-access-layer-cs/_static/image70.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-353">[![Augment the Query to Return the SCOPE_IDENTITY() Value](creating-a-data-access-layer-cs/_static/image71.png)](creating-a-data-access-layer-cs/_static/image70.png)</span></span>

<span data-ttu-id="8b4b7-354">**Рис. 26**: дополнять запроса для возврата **область\_IDENTITY()** значение ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image72.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-354">**Figure 26**: Augment the Query to Return the **SCOPE\_IDENTITY()** Value ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image72.png))</span></span>


<span data-ttu-id="8b4b7-355">Наконец, назовите новый метод **InsertProduct**.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-355">Finally, name the new method **InsertProduct**.</span></span>


<span data-ttu-id="8b4b7-356">[![Задайте имя нового метода InsertProduct](creating-a-data-access-layer-cs/_static/image74.png)](creating-a-data-access-layer-cs/_static/image73.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-356">[![Set the New Method Name to InsertProduct](creating-a-data-access-layer-cs/_static/image74.png)](creating-a-data-access-layer-cs/_static/image73.png)</span></span>

<span data-ttu-id="8b4b7-357">**Рис. 27**: присвоено имя нового метода **InsertProduct** ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image75.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-357">**Figure 27**: Set the New Method Name to **InsertProduct** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image75.png))</span></span>


<span data-ttu-id="8b4b7-358">При возвращении в конструкторе наборов данных можно увидеть, **ProductsTableAdapter** содержит новый метод **InsertProduct**.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-358">When you return to the DataSet Designer you'll see that the **ProductsTableAdapter** contains a new method, **InsertProduct**.</span></span> <span data-ttu-id="8b4b7-359">Если этого нового метода нет параметра для каждого столбца в **продуктов** таблицы, скорее всего, вы забыли завершить **вставить** инструкция точкой с запятой.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-359">If this new method doesn't have a parameter for each column in the **Products** table, chances are you forgot to terminate the **INSERT** statement with a semi-colon.</span></span> <span data-ttu-id="8b4b7-360">Настройка **InsertProduct** метод и убедиться в наличии операторы **вставить** и **ВЫБЕРИТЕ** инструкции.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-360">Configure the **InsertProduct** method and ensure you have a semi-colon delimiting the **INSERT** and **SELECT** statements.</span></span>

<span data-ttu-id="8b4b7-361">По умолчанию вставьте методы без запросов методы проблему, это означает, что они возвращают количество задействованных строк.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-361">By default, insert methods issue non-query methods, meaning that they return the number of affected rows.</span></span> <span data-ttu-id="8b4b7-362">Тем не менее, мы хотим **InsertProduct** метод для возврата значения, возвращенные запросом, не число обработанных строк.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-362">However, we want the **InsertProduct** method to return the value returned by the query, not the number of rows affected.</span></span> <span data-ttu-id="8b4b7-363">Для этого настройте **InsertProduct** метода **ExecuteMode** свойства **скаляр**.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-363">To accomplish this, adjust the **InsertProduct** method's **ExecuteMode** property to **Scalar**.</span></span>


<span data-ttu-id="8b4b7-364">[![Измените свойство ExecuteMode скалярных](creating-a-data-access-layer-cs/_static/image77.png)](creating-a-data-access-layer-cs/_static/image76.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-364">[![Change the ExecuteMode Property to Scalar](creating-a-data-access-layer-cs/_static/image77.png)](creating-a-data-access-layer-cs/_static/image76.png)</span></span>

<span data-ttu-id="8b4b7-365">**Рис. 28**: изменение **ExecuteMode** свойства **скаляр** ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image78.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-365">**Figure 28**: Change the **ExecuteMode** Property to **Scalar** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image78.png))</span></span>


<span data-ttu-id="8b4b7-366">В следующем коде показан этот новый **InsertProduct** метод в действии:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-366">The following code shows this new **InsertProduct** method in action:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample8.cs)]

## <a name="step-5-completing-the-data-access-layer"></a><span data-ttu-id="8b4b7-367">Шаг 5: Завершение работы на уровне доступа к данным</span><span class="sxs-lookup"><span data-stu-id="8b4b7-367">Step 5: Completing the Data Access Layer</span></span>

<span data-ttu-id="8b4b7-368">Обратите внимание, что **ProductsTableAdapters** возвращает **CategoryID** и **SupplierID** значения из **продуктов** таблицы, но не включает **CategoryName** столбец из **категории** таблицы или **CompanyName** столбец из **поставщики**таблицы, несмотря на то, что это скорее всего столбцы, которые необходимо отобразить при выводе информации о продукте.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-368">Note that the **ProductsTableAdapters** class returns the **CategoryID** and **SupplierID** values from the **Products** table, but doesn't include the **CategoryName** column from the **Categories** table or the **CompanyName** column from the **Suppliers** table, although these are likely the columns we want to display when showing product information.</span></span> <span data-ttu-id="8b4b7-369">Можно расширить исходный метод адаптера таблицы, **GetProducts()**, чтобы включить оба **CategoryName** и **CompanyName** значений столбцов, что приведет к обновлению строго типизированный объект DataTable для включения этих новых столбцов.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-369">We can augment the TableAdapter's initial method, **GetProducts()**, to include both the **CategoryName** and **CompanyName** column values, which will update the strongly-typed DataTable to include these new columns as well.</span></span>

<span data-ttu-id="8b4b7-370">Это может оказаться сложной задачей, тем не менее, как методы адаптера таблицы для вставки, обновления и удаления данных зависят от вне этого исходного метода.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-370">This can present a problem, however, as the TableAdapter's methods for inserting, updating, and deleting data are based off of this initial method.</span></span> <span data-ttu-id="8b4b7-371">К счастью, создаваемые автоматически методы для вставки, обновления и удаления не влияет подзапросы в **ВЫБЕРИТЕ** предложения.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-371">Fortunately, the auto-generated methods for inserting, updating, and deleting are not affected by subqueries in the **SELECT** clause.</span></span> <span data-ttu-id="8b4b7-372">При этом не забудьте добавить наши запросы к **категории** и **поставщики** как подзапросы, а не **JOIN** s, мы не придется переделывать эти методы изменения данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-372">By taking care to add our queries to **Categories** and **Suppliers** as subqueries, rather than **JOIN** s, we'll avoid having to rework those methods for modifying data.</span></span> <span data-ttu-id="8b4b7-373">Щелкните правой кнопкой мыши **GetProducts()** метод в **ProductsTableAdapter** и выберите команду Настройка.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-373">Right-click on the **GetProducts()** method in the **ProductsTableAdapter** and choose Configure.</span></span> <span data-ttu-id="8b4b7-374">Затем измените **ВЫБЕРИТЕ** предложение, чтобы он выглядел как:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-374">Then, adjust the **SELECT** clause so that it looks like:</span></span>

[!code-sql[Main](creating-a-data-access-layer-cs/samples/sample9.sql)]


<span data-ttu-id="8b4b7-375">[![Обновить эту инструкцию SELECT для метода GetProducts()](creating-a-data-access-layer-cs/_static/image80.png)](creating-a-data-access-layer-cs/_static/image79.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-375">[![Update the SELECT Statement for the GetProducts() Method](creating-a-data-access-layer-cs/_static/image80.png)](creating-a-data-access-layer-cs/_static/image79.png)</span></span>

<span data-ttu-id="8b4b7-376">**Рис. 29**: обновление **ВЫБЕРИТЕ** инструкции для **GetProducts()** метод ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image81.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-376">**Figure 29**: Update the **SELECT** Statement for the **GetProducts()** Method ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image81.png))</span></span>


<span data-ttu-id="8b4b7-377">После обновления **GetProducts()** способ использования этого нового запроса, таблицы данных будет включать два новых столбца: **CategoryName** и **«название»**.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-377">After updating the **GetProducts()** method to use this new query the DataTable will include two new columns: **CategoryName** and **SupplierName**.</span></span>


![Продукты DataTable содержит два новых столбца](creating-a-data-access-layer-cs/_static/image82.png)

<span data-ttu-id="8b4b7-379">**Рис. 30**: **продуктов** DataTable содержит два новых столбца</span><span class="sxs-lookup"><span data-stu-id="8b4b7-379">**Figure 30**: The **Products** DataTable has Two New Columns</span></span>


<span data-ttu-id="8b4b7-380">Теперь пора обновление **ВЫБЕРИТЕ** предложения в **GetProductsByCategoryID (*categoryID*)** также метод.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-380">Take a moment to update the **SELECT** clause in the **GetProductsByCategoryID(*categoryID*)** method as well.</span></span>

<span data-ttu-id="8b4b7-381">При обновлении **GetProducts()** **ВЫБЕРИТЕ** с помощью **JOIN** конструктор DataSet не сможет автоматически создавать методы для вставки, обновления и удаления с помощью непосредственной схемы базы данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-381">If you update the **GetProducts()** **SELECT** using **JOIN** syntax the DataSet Designer won't be able to auto-generate the methods for inserting, updating, and deleting database data using the DB direct pattern.</span></span> <span data-ttu-id="8b4b7-382">Вместо этого необходимо создать их вручную гораздо, как мы сделали с **InsertProduct** метод ранее в этом учебнике.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-382">Instead, you'll have to manually create them much like we did with the **InsertProduct** method earlier in this tutorial.</span></span> <span data-ttu-id="8b4b7-383">Кроме того, вы будете вручную должны предоставить **InsertCommand**, **UpdateCommand**, и **DeleteCommand** значения свойств, если вы хотите использовать схему пакетного обновления.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-383">Furthermore, you'll manually have to provide the **InsertCommand**, **UpdateCommand**, and **DeleteCommand** property values if you want to use the batch updating pattern.</span></span>

## <a name="adding-the-remaining-tableadapters"></a><span data-ttu-id="8b4b7-384">Добавление оставшиеся адаптеры таблиц TableAdapter</span><span class="sxs-lookup"><span data-stu-id="8b4b7-384">Adding the Remaining TableAdapters</span></span>

<span data-ttu-id="8b4b7-385">До сих пор мы только рассмотрели работа с адаптер для одной таблицы базы данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-385">Up until now, we've only looked at working with a single TableAdapter for a single database table.</span></span> <span data-ttu-id="8b4b7-386">Однако базы данных Northwind содержит несколько связанных таблиц, нам нужно будет работать с нашей веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-386">However, the Northwind database contains several related tables that we'll need to work with in our web application.</span></span> <span data-ttu-id="8b4b7-387">Типизированный набор данных может содержать несколько связанных таблиц DataTable.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-387">A Typed DataSet can contain multiple, related DataTables.</span></span> <span data-ttu-id="8b4b7-388">Таким образом чтобы завершить DAL необходимо добавить таблицы данных для других таблиц, которые мы будем использовать в этих учебниках.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-388">Therefore, to complete our DAL we need to add DataTables for the other tables we'll be using in these tutorials.</span></span> <span data-ttu-id="8b4b7-389">Чтобы добавить новый адаптер таблицы типизированного набора данных, откройте конструктор наборов данных, щелкните правой кнопкой мыши в конструкторе и выберите Добавить / TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-389">To add a new TableAdapter to a Typed DataSet, open the DataSet Designer, right-click in the Designer, and choose Add / TableAdapter.</span></span> <span data-ttu-id="8b4b7-390">Будет создан новый объект DataTable и TableAdapter и пошаговыми руководствами мастер, который мы рассмотрели ранее в этом учебнике.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-390">This will create a new DataTable and TableAdapter and walk you through the wizard we examined earlier in this tutorial.</span></span>

<span data-ttu-id="8b4b7-391">Занять несколько минут, чтобы создать следующие адаптеры таблиц TableAdapter и методы, с помощью следующих запросов.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-391">Take a few minutes to create the following TableAdapters and methods using the following queries.</span></span> <span data-ttu-id="8b4b7-392">Обратите внимание, что запросы в **ProductsTableAdapter** включают вложенные запросы, для извлечения имен категорию и поставщика каждого продукта.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-392">Note that the queries in the **ProductsTableAdapter** include the subqueries to grab each product's category and supplier names.</span></span> <span data-ttu-id="8b4b7-393">Кроме того, если вы выполняли, вы уже добавили **ProductsTableAdapter** класса **GetProducts()** и **GetProductsByCategoryID (*categoryID* )** методы.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-393">Additionally, if you've been following along, you've already added the **ProductsTableAdapter** class's **GetProducts()** and **GetProductsByCategoryID(*categoryID*)** methods.</span></span>

- <span data-ttu-id="8b4b7-394">**ProductsTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="8b4b7-394">**ProductsTableAdapter**</span></span>

  - <span data-ttu-id="8b4b7-395">**GetProducts**:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-395">**GetProducts**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample10.sql)]
  - <span data-ttu-id="8b4b7-396">**GetProductsByCategoryID**:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-396">**GetProductsByCategoryID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample11.sql)]
  - <span data-ttu-id="8b4b7-397">**GetProductsBySupplierID**:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-397">**GetProductsBySupplierID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample12.sql)]
  - <span data-ttu-id="8b4b7-398">**GetProductByProductID**:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-398">**GetProductByProductID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample13.sql)]
- <span data-ttu-id="8b4b7-399">**CategoriesTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="8b4b7-399">**CategoriesTableAdapter**</span></span>

  - <span data-ttu-id="8b4b7-400">**GetCategories**:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-400">**GetCategories**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample14.sql)]
  - <span data-ttu-id="8b4b7-401">**GetCategoryByCategoryID**:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-401">**GetCategoryByCategoryID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample15.sql)]
- <span data-ttu-id="8b4b7-402">**SuppliersTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="8b4b7-402">**SuppliersTableAdapter**</span></span>

  - <span data-ttu-id="8b4b7-403">**GetSuppliers**:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-403">**GetSuppliers**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample16.sql)]
  - <span data-ttu-id="8b4b7-404">**GetSuppliersByCountry**:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-404">**GetSuppliersByCountry**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample17.sql)]
  - <span data-ttu-id="8b4b7-405">**GetSupplierBySupplierID**:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-405">**GetSupplierBySupplierID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample18.sql)]
- <span data-ttu-id="8b4b7-406">**EmployeesTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="8b4b7-406">**EmployeesTableAdapter**</span></span>

  - <span data-ttu-id="8b4b7-407">**GetEmployees**:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-407">**GetEmployees**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample19.sql)]
  - <span data-ttu-id="8b4b7-408">**GetEmployeesByManager**:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-408">**GetEmployeesByManager**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample20.sql)]
  - <span data-ttu-id="8b4b7-409">**GetEmployeeByEmployeeID**:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-409">**GetEmployeeByEmployeeID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample21.sql)]


<span data-ttu-id="8b4b7-410">[![Конструктор наборов данных после добавления четырех адаптеров таблиц](creating-a-data-access-layer-cs/_static/image84.png)](creating-a-data-access-layer-cs/_static/image83.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-410">[![The DataSet Designer After the Four TableAdapters Have Been Added](creating-a-data-access-layer-cs/_static/image84.png)](creating-a-data-access-layer-cs/_static/image83.png)</span></span>

<span data-ttu-id="8b4b7-411">**Рис. 31**: набора данных конструктор после четырех адаптеров таблиц были добавлены ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image85.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-411">**Figure 31**: The DataSet Designer After the Four TableAdapters Have Been Added ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image85.png))</span></span>


## <a name="adding-custom-code-to-the-dal"></a><span data-ttu-id="8b4b7-412">Добавление пользовательского кода в DAL</span><span class="sxs-lookup"><span data-stu-id="8b4b7-412">Adding Custom Code to the DAL</span></span>

<span data-ttu-id="8b4b7-413">Адаптеры таблиц TableAdapter и добавить в типизированный набор данных DataTables выражаются в виде файла определения схемы XML (**именем Northwind.xsd**).</span><span class="sxs-lookup"><span data-stu-id="8b4b7-413">The TableAdapters and DataTables added to the Typed DataSet are expressed as an XML Schema Definition file (**Northwind.xsd**).</span></span> <span data-ttu-id="8b4b7-414">Эти данные схемы можно просмотреть, щелкнув правой кнопкой мыши **именем Northwind.xsd** в обозревателе решений и выбрав команду Просмотреть код.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-414">You can view this schema information by right-clicking on the **Northwind.xsd** file in the Solution Explorer and choosing View Code.</span></span>


<span data-ttu-id="8b4b7-415">[![Файл схемы XML (XSD) определение для Northwinds типизированного набора данных](creating-a-data-access-layer-cs/_static/image87.png)](creating-a-data-access-layer-cs/_static/image86.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-415">[![The XML Schema Definition (XSD) File for the Northwinds Typed DataSet](creating-a-data-access-layer-cs/_static/image87.png)](creating-a-data-access-layer-cs/_static/image86.png)</span></span>

<span data-ttu-id="8b4b7-416">**Рис. 32**: файл определения схемы XML (XSD) для типизированного набора данных Northwinds ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image88.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-416">**Figure 32**: The XML Schema Definition (XSD) File for the Northwinds Typed DataSet ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image88.png))</span></span>


<span data-ttu-id="8b4b7-417">Эти сведения схемы преобразуются в код C# или Visual Basic во время разработки при компиляции или во время выполнения (при необходимости), после чего можно пройти по с помощью отладчика.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-417">This schema information is translated into C# or Visual Basic code at design time when compiled or at runtime (if needed), at which point you can step through it with the debugger.</span></span> <span data-ttu-id="8b4b7-418">Чтобы просмотреть этот автоматически созданный код перейдите в представление классов и детализации для классов TableAdapter или типизированного набора данных.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-418">To view this auto-generated code go to the Class View and drill down to the TableAdapter or Typed DataSet classes.</span></span> <span data-ttu-id="8b4b7-419">Если вы не видите представления классов, на экране, перейдите в меню "Вид" и выберите его оттуда или нажмите сочетание клавиш Ctrl + Shift + C.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-419">If you don't see the Class View on your screen, go to the View menu and select it from there, or hit Ctrl+Shift+C.</span></span> <span data-ttu-id="8b4b7-420">Из представления классов, вы увидите, свойства, методы и события классов типизированного набора данных и адаптера таблицы.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-420">From the Class View you can see the properties, methods, and events of the Typed DataSet and TableAdapter classes.</span></span> <span data-ttu-id="8b4b7-421">Просмотр кода для конкретного метода, или дважды щелкните имя метода в представлении классов щелкните его правой кнопкой мыши и выберите перейти к определению.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-421">To view the code for a particular method, double-click the method name in the Class View or right-click on it and choose Go To Definition.</span></span>


![Проверьте автоматически созданный код, выбрав перейти к определению из представления классов](creating-a-data-access-layer-cs/_static/image89.png)

<span data-ttu-id="8b4b7-423">**На рисунке 33**: Проверьте автоматически созданный код, выбрав перейти к определению из представления классов</span><span class="sxs-lookup"><span data-stu-id="8b4b7-423">**Figure 33**: Inspect the Auto-Generated Code by Selecting Go To Definition from the Class View</span></span>


<span data-ttu-id="8b4b7-424">Автоматически созданный код может быть сэкономить много времени, часто очень универсальный код и необходимо настроить в соответствии с потребностями приложения.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-424">While auto-generated code can be a great time saver, the code is often very generic and needs to be customized to meet the unique needs of an application.</span></span> <span data-ttu-id="8b4b7-425">Риск расширение автоматически создаваемый код, — что средства, создавшего код может решить, что пора «восстановить» и перезаписать сделанные настройки.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-425">The risk of extending auto-generated code, though, is that the tool that generated the code might decide it's time to "regenerate" and overwrite your customizations.</span></span> <span data-ttu-id="8b4b7-426">С .NET 2.0 новая концепция разделяемый класс можно легко разделить класс в нескольких файлах.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-426">With .NET 2.0's new partial class concept, it's easy to split a class across multiple files.</span></span> <span data-ttu-id="8b4b7-427">Это позволяет добавлять собственные методы, свойства и события для автоматически создаваемые классы не нужно беспокоиться о перезаписи сделанных настроек Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-427">This enables us to add our own methods, properties, and events to the auto-generated classes without having to worry about Visual Studio overwriting our customizations.</span></span>

<span data-ttu-id="8b4b7-428">Чтобы продемонстрировать, как настроить DAL, добавим **GetProducts()** метод **SuppliersRow** класса.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-428">To demonstrate how to customize the DAL, let's add a **GetProducts()** method to the **SuppliersRow** class.</span></span> <span data-ttu-id="8b4b7-429">**SuppliersRow** класс представляет одну запись в **поставщики** таблица; каждый поставщик может ноль для многих продуктов, поэтому **GetProducts()** будет возвращать те продукты указанного поставщика.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-429">The **SuppliersRow** class represents a single record in the **Suppliers** table; each supplier can provider zero to many products, so **GetProducts()** will return those products of the specified supplier.</span></span> <span data-ttu-id="8b4b7-430">Для выполнения этого создавать новый файл класса в **приложения\_кода** папку с именем **SuppliersRow.cs** и добавьте следующий код:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-430">To accomplish this create a new class file in the **App\_Code** folder named **SuppliersRow.cs** and add the following code:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample22.cs)]

<span data-ttu-id="8b4b7-431">Этот разделяемый класс указывает компилятору что при построении **Northwind.SuppliersRow** класса для включения **GetProducts()** только определенный метод.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-431">This partial class instructs the compiler that when building the **Northwind.SuppliersRow** class to include the **GetProducts()** method we just defined.</span></span> <span data-ttu-id="8b4b7-432">Если сборка проекта, а затем вернитесь в представление класса вы увидите **GetProducts()** теперь указана как метод **Northwind.SuppliersRow**.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-432">If you build your project and then return to the Class View you'll see **GetProducts()** now listed as a method of **Northwind.SuppliersRow**.</span></span>


![Метод GetProducts() является теперь входит в класс Northwind.SuppliersRow](creating-a-data-access-layer-cs/_static/image90.png)

<span data-ttu-id="8b4b7-434">**Рисунок 34**: **GetProducts()** метод входит теперь **Northwind.SuppliersRow** класса</span><span class="sxs-lookup"><span data-stu-id="8b4b7-434">**Figure 34**: The **GetProducts()** Method is Now Part of the **Northwind.SuppliersRow** Class</span></span>


<span data-ttu-id="8b4b7-435">**GetProducts()** метод теперь может использоваться для перечисления набора продуктов для конкретного поставщика, как показано в следующем коде:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-435">The **GetProducts()** method can now be used to enumerate the set of products for a particular supplier, as the following code shows:</span></span>

[!code-html[Main](creating-a-data-access-layer-cs/samples/sample23.html)]

<span data-ttu-id="8b4b7-436">Эти данные также могут отображаться в любом из ASP. Данные в NET веб-элементов управления.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-436">This data can also be displayed in any of ASP.NET's data Web controls.</span></span> <span data-ttu-id="8b4b7-437">На следующей странице используется элемент управления GridView с двумя полями:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-437">The following page uses a GridView control with two fields:</span></span>

- <span data-ttu-id="8b4b7-438">Отображает имя каждого поставщика, BoundField и</span><span class="sxs-lookup"><span data-stu-id="8b4b7-438">A BoundField that displays the name of each supplier, and</span></span>
- <span data-ttu-id="8b4b7-439">Содержащий элемент управления маркированный список, к которому привязан результаты, возвращенные TemplateField **GetProducts()** для каждого поставщика.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-439">A TemplateField that contains a BulletedList control that is bound to the results returned by the **GetProducts()** method for each supplier.</span></span>

<span data-ttu-id="8b4b7-440">Мы рассмотрим способы отображения таких отчетов основной подробности в будущих учебниках.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-440">We'll examine how to display such master-detail reports in future tutorials.</span></span> <span data-ttu-id="8b4b7-441">Теперь этот пример предназначен для иллюстрации использования пользовательского метода, добавленного к **Northwind.SuppliersRow** класса.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-441">For now, this example is designed to illustrate using the custom method added to the **Northwind.SuppliersRow** class.</span></span>

<span data-ttu-id="8b4b7-442">SuppliersAndProducts.aspx</span><span class="sxs-lookup"><span data-stu-id="8b4b7-442">SuppliersAndProducts.aspx</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample24.aspx)]

<span data-ttu-id="8b4b7-443">SuppliersAndProducts.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="8b4b7-443">SuppliersAndProducts.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample25.cs)]


<span data-ttu-id="8b4b7-444">[![Название компании-поставщика, перечисленные в столбце слева их продуктов в правом](creating-a-data-access-layer-cs/_static/image92.png)](creating-a-data-access-layer-cs/_static/image91.png)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-444">[![The Supplier's Company Name is Listed in the Left Column, Their Products in the Right](creating-a-data-access-layer-cs/_static/image92.png)](creating-a-data-access-layer-cs/_static/image91.png)</span></span>

<span data-ttu-id="8b4b7-445">**На рисунке 35**: название компании-поставщика, перечисленные в столбце слева их продуктов в правом ([Просмотр полноразмерное изображение](creating-a-data-access-layer-cs/_static/image93.png))</span><span class="sxs-lookup"><span data-stu-id="8b4b7-445">**Figure 35**: The Supplier's Company Name is Listed in the Left Column, Their Products in the Right ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image93.png))</span></span>


## <a name="summary"></a><span data-ttu-id="8b4b7-446">Сводка</span><span class="sxs-lookup"><span data-stu-id="8b4b7-446">Summary</span></span>

<span data-ttu-id="8b4b7-447">При построении веб-приложения, создание DAL должно быть на одной из первых этапов, до начала создания слоя представления.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-447">When building a web application creating the DAL should be one of your first steps, occurring before you start creating your presentation layer.</span></span> <span data-ttu-id="8b4b7-448">С помощью Visual Studio слой DAL на основе типизированных наборов — это задача, можно выполнить без написания кода 10 – 15 минут.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-448">With Visual Studio, creating a DAL based on Typed DataSets is a task that can be accomplished in 10-15 minutes without writing a line of code.</span></span> <span data-ttu-id="8b4b7-449">Учебники, продвижение вперед, будут созданы на основе этого DAL.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-449">The tutorials moving forward will build upon this DAL.</span></span> <span data-ttu-id="8b4b7-450">В [следующее руководство](creating-a-business-logic-layer-cs.md) мы определен ряд бизнес-правил и способы их реализации в отдельном уровне бизнес-логики.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-450">In the [next tutorial](creating-a-business-logic-layer-cs.md) we'll define a number of business rules and see how to implement them in a separate Business Logic Layer.</span></span>

<span data-ttu-id="8b4b7-451">Программирование довольны!</span><span class="sxs-lookup"><span data-stu-id="8b4b7-451">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="8b4b7-452">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="8b4b7-452">Further Reading</span></span>

<span data-ttu-id="8b4b7-453">Дополнительные сведения по темам, рассматриваемые в этом учебнике см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="8b4b7-453">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="8b4b7-454">Построение DAL, с помощью строго типизированные адаптеры таблицы и таблицы данных в VS 2005 и ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="8b4b7-454">Building a DAL using Strongly Typed TableAdapters and DataTables in VS 2005 and ASP.NET 2.0</span></span>](https://weblogs.asp.net/scottgu/435498)
- [<span data-ttu-id="8b4b7-455">Проектирование компоненты уровня данных и передачи данных через уровни</span><span class="sxs-lookup"><span data-stu-id="8b4b7-455">Designing Data Tier Components and Passing Data Through Tiers</span></span>](https://msdn.microsoft.com/library/ms978496.aspx)
- [<span data-ttu-id="8b4b7-456">Построение слой доступа к данным с помощью конструктора набора данных Visual Studio 2005</span><span class="sxs-lookup"><span data-stu-id="8b4b7-456">Build a Data Access Layer with the Visual Studio 2005 DataSet Designer</span></span>](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner)
- [<span data-ttu-id="8b4b7-457">Шифрование данных конфигурации в ASP.NET 2.0 приложений</span><span class="sxs-lookup"><span data-stu-id="8b4b7-457">Encrypting Configuration Information in ASP.NET 2.0 Applications</span></span>](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)
- [<span data-ttu-id="8b4b7-458">Общие сведения об адаптере таблиц</span><span class="sxs-lookup"><span data-stu-id="8b4b7-458">TableAdapter Overview</span></span>](https://msdn.microsoft.com/library/bz9tthwx.aspx)
- [<span data-ttu-id="8b4b7-459">Работа с типизированного набора данных</span><span class="sxs-lookup"><span data-stu-id="8b4b7-459">Working with a Typed DataSet</span></span>](https://msdn.microsoft.com/library/esbykkzb.aspx)
- [<span data-ttu-id="8b4b7-460">С помощью доступа к строго типизированным данным в Visual Studio 2005 и ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="8b4b7-460">Using Strongly-Typed Data Access in Visual Studio 2005 and ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/020806-1.aspx)
- [<span data-ttu-id="8b4b7-461">Способы расширения методы адаптера таблицы</span><span class="sxs-lookup"><span data-stu-id="8b4b7-461">How to Extend TableAdapter Methods</span></span>](https://blogs.msdn.com/vbteam/archive/2005/05/04/ExtendingTableAdapters.aspx)
- [<span data-ttu-id="8b4b7-462">Извлечение скалярных данных из хранимой процедуры</span><span class="sxs-lookup"><span data-stu-id="8b4b7-462">Retrieving Scalar Data from a Stored Procedure</span></span>](http://aspnet.4guysfromrolla.com/articles/062905-1.aspx)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="8b4b7-463">Видео на разделы, содержащиеся в этом учебнике</span><span class="sxs-lookup"><span data-stu-id="8b4b7-463">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="8b4b7-464">Уровни доступа к данным в приложениях ASP.NET</span><span class="sxs-lookup"><span data-stu-id="8b4b7-464">Data Access Layers in ASP.NET Applications</span></span>](../../../videos/data-access/adonet-data-services/data-access-layers-in-aspnet-applications.md)
- [<span data-ttu-id="8b4b7-465">Как вручную связать набор данных в элемент управления Datagrid</span><span class="sxs-lookup"><span data-stu-id="8b4b7-465">How to Manually Bind a Dataset to a Datagrid</span></span>](../../../videos/data-access/adonet-data-services/how-to-manually-bind-a-dataset-to-a-datagrid.md)
- [<span data-ttu-id="8b4b7-466">Порядок работы с наборами данных и фильтры приложения ASP</span><span class="sxs-lookup"><span data-stu-id="8b4b7-466">How to Work with Datasets and Filters from an ASP Application</span></span>](../../../videos/data-access/adonet-data-services/how-to-work-with-datasets-and-filters-from-an-asp-application.md)

## <a name="about-the-author"></a><span data-ttu-id="8b4b7-467">Об авторе</span><span class="sxs-lookup"><span data-stu-id="8b4b7-467">About the Author</span></span>

<span data-ttu-id="8b4b7-468">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-468">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="8b4b7-469">Скотт — независимый консультант, trainer и записи.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-469">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="8b4b7-470">Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="8b4b7-470">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="8b4b7-471">Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-471">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="8b4b7-472">или через его блог, который можно найти в [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="8b4b7-472">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="8b4b7-473">Благодарности</span><span class="sxs-lookup"><span data-stu-id="8b4b7-473">Special Thanks To</span></span>

<span data-ttu-id="8b4b7-474">Этот учебник ряд прошел проверку многие полезные рецензентов.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-474">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="8b4b7-475">Основными редакторами этого учебника были Николай зеленый, – Хилтон Гизнау, Деннис Патерсона, (Liz Shulok), метка Gomez и Карлос Сантос.</span><span class="sxs-lookup"><span data-stu-id="8b4b7-475">Lead reviewers for this tutorial were Ron Green, Hilton Giesenow, Dennis Patterson, Liz Shulok, Abel Gomez, and Carlos Santos.</span></span> <span data-ttu-id="8b4b7-476">Объясняются моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="8b4b7-476">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="8b4b7-477">Если Да, напишите мне по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8b4b7-477">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="8b4b7-478">Вперед</span><span class="sxs-lookup"><span data-stu-id="8b4b7-478">Next</span></span>](creating-a-business-logic-layer-cs.md)
