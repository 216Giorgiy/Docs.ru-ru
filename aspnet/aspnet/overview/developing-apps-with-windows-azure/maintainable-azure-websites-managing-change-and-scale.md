---
uid: aspnet/overview/developing-apps-with-windows-azure/maintainable-azure-websites-managing-change-and-scale
title: "Практического занятия: поддерживаемого веб-сайтов Azure: управление изменениями и масштаб | Документы Microsoft"
author: rick-anderson
description: "Microsoft Azure позволяет легко создавать и развертывать веб-сайтов в рабочей среде. Но не закончите при динамической приложения, вы новичок! Вы..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/16/2014
ms.topic: article
ms.assetid: ecfd0eb4-c4ad-44e6-9db9-a2a66611ff6a
ms.technology: 
ms.prod: .net-framework
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/maintainable-azure-websites-managing-change-and-scale
msc.type: authoredcontent
ms.openlocfilehash: 1d6d9265d93fbd32e2d9c22e2ac3db9b5ffd9776
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="hands-on-lab-maintainable-azure-websites-managing-change-and-scale"></a>Практического занятия: поддерживаемого веб-сайтов Azure: управление изменениями и масштабирования
====================
по [Web лагеря команды](https://twitter.com/webcamps)

[Загрузите комплект учебных материалов лагеря Web](http://aka.ms/webcamps-training-kit)

> Microsoft Azure позволяет легко создавать и развертывать веб-сайтов в рабочей среде. Но не закончите при динамической приложения, вы новичок! Необходимо для обработки изменяющихся требования, обновления базы данных, масштаб и многое другое. К счастью службы приложения Azure имеется связанная со множеством возможностей помогает защищать бесперебойной сайты.
> 
> Azure предлагает безопасные и гибкие возможности разработки, развертывания и масштабирования для веб-приложения любого размера. Используйте существующие средства для создания и развертывания приложений, не загружая управляющую инфраструктуру.
> 
> Предоставьте производственного веб-приложение самостоятельно в минутах простого развертывания содержимое, созданное с помощью вашей другого средства разработки. Можно развернуть существующий сайт напрямую из системы управления версиями с поддержкой **Git**, **GitHub**, **Bitbucket**, **TFS**и даже  **Общий банк данных**. Развертывание непосредственно из вашего избранного интегрированной среды разработки или скриптов с использованием **PowerShell** в Windows или **CLI** средств, работающих в любой операционной системе. После развертывания актуальность сайты постоянно поддержки для непрерывного развертывания.
> 
> Azure предоставляет масштабируемые и устойчивые облачного хранилища, резервного копирования и восстановления решений для любых данных, большие или малой. При развертывании приложений в производственной среде, службы хранилища, например таблиц, больших двоичных объектов и баз данных SQL, позволяют масштабировать приложения в облаке.
> 
> С базами данных SQL очень важно обновлять производительность базы данных, при развертывании новых версий приложения. Благодаря **Entity Framework Code First Migrations**, разработка и развертывание модели данных, был упрощен для обновления среды в минутах. Данная практическая работа Показать различных разделов, которые могут возникнуть при развертывании веб-приложения в рабочей среде в Microsoft Azure.
> 
> Все образцы кода и фрагменты кода включаются в Web лагеря комплект учебных материалов, доступных в [http://aka.ms/webcamps-training-kit](http://aka.ms/webcamps-training-kit).
> 
> Более подробные сведения этого раздела см. в разделе [Создание реальных облачных приложений с Azure электронная книга](building-real-world-cloud-apps-with-windows-azure/introduction.md).


<a id="Overview"></a>
## <a name="overview"></a>Обзор

<a id="Objectives"></a>
### <a name="objectives"></a>Цели

В этой практической вы узнаете, как:

- Включить Entity Framework миграции с существующей модели
- Обновить модель объектов и базы данных с использованием Entity Framework миграции
- Развертывание на службе приложений Azure с помощью Git
- Откат до предыдущего развертывания с помощью портала управления Azure
- Используйте хранилище Azure, чтобы масштабировать веб-приложение
- Настройка автоматического масштабирования для веб-приложения с помощью портала управления Azure
- Создать и настроить проект нагрузочного теста в Visual Studio

<a id="Prerequisites"></a>
### <a name="prerequisites"></a>Предварительные требования

Для завершения этой практической требуется следующее:

- [Visual Studio Express 2013 для Web](https://www.microsoft.com/visualstudio/) или выше
- [Azure SDK для .NET 2.2](https://www.microsoft.com/windowsazure/sdk/)
- [Система управления версиями GIT](http://git-scm.com/download)
- Подписки Microsoft Azure 

    - Зарегистрироваться в службе [бесплатной пробной версии](http://aka.ms/watk-freetrial)
    - При наличии Visual Studio Professional, Test Professional, Premium или Ultimate с подписчиком MSDN или платформы MSDN активации вашей [преимущество MSDN](http://aka.ms/watk-msdn) сейчас, чтобы начать разработку и тестирование на платформе Azure
    - [BizSpark](http://aka.ms/watk-bizspark) элементы автоматически получать Azure преимущество по их Visual Studio Ultimate с подпиской MSDN
    - Члены [Microsoft Partner Network](http://aka.ms/watk-mpn) Cloud Essentials программа получать ежемесячные кредиты Azure бесплатно

<a id="Setup"></a>
### <a name="setup"></a>Установка

Чтобы выполнить упражнения в этой практической, необходимо настроить среду.

1. Откройте проводник и найдите в лаборатории **источника** папки.
2. Щелкните правой кнопкой мыши **Setup.cmd** и выберите **Запуск от имени администратора** для запуска процесса установки, будет настроить среду и установить фрагменты кода Visual Studio для этой лабораторной работы.
3. Если отображается диалоговое окно контроля учетных записей, подтвердите действие для продолжения.

> [!NOTE]
> Убедитесь, что все зависимости для этой лабораторной работы вы вернули перед запуском программы установки.


<a id="CodeSnippets"></a>
### <a name="using-the-code-snippets"></a>Фрагменты кода

В документе лаборатории будет предложено вставлять блоки кода. Visual Studio к фрагментам кода, к которому можно получить из в Visual Studio 2013, чтобы избежать необходимости вручную добавить большая часть кода предоставляется для удобства.

> [!NOTE]
> Каждого упражнения сопровождается начальный решений, расположенный в **начать** папку расчетов, позволяющий выполнить каждого упражнения независимо от других. Имейте в виду, что фрагменты кода, которые добавляются во время упражнения, отсутствуют на их запуск решения и могут не работать до завершения этого упражнения. В исходном коде для упражнения, вы также найдете **окончания** папку, содержащую решение Visual Studio с кодом, полученный в результате выполнения действий в соответствующий упражнении. Эти решения можно использовать как рекомендации, если вам нужна дополнительная помощь, отвечая на этой практической.


* * *

<a id="Exercises"></a>
## <a name="exercises"></a>Упражнения

Данная практическая работа включает следующие упражнения:

1. [С помощью Entity Framework миграции](#Exercise1)
2. [Развертывание веб-приложения для промежуточного хранения](#Exercise2)
3. [Выполнение отката развертывания в рабочей среде](#Exercise3)
4. [С помощью хранилища Azure](#Exercise4)
5. [С помощью автоматического масштабирования для веб-приложений](#Exercise5) (необязательно для Visual Studio 2013 Ultimate edition)

Предполагаемое время для выполнения этого занятия: **75 минут**

> [!NOTE]
> При первом запуске Visual Studio, необходимо выбрать одну из коллекций предварительно определенных параметров. Каждая предопределенная коллекция соответствует конкретному стилю разработки и определяет макетов окон, поведение редактора, фрагменты кода IntelliSense и параметры диалогового окна. В этой лаборатории описаны действия, необходимые для выполнения данной задачи в Visual Studio при использовании **обычные параметры разработки** коллекции. При выборе другого набора параметров для среды разработки может быть отличия в этапах, которые следует принимать во внимание.


<a id="Exercise1"></a>
### <a name="exercise-1-using-entity-framework-migrations"></a>Упражнение 1: Использовать Entity Framework миграции

При разработке приложения, модели данных могут измениться с течением времени. Эти изменения могут повлиять на существующей модели в базе данных (при создании новой версии) и очень важно для поддержания актуального состояния, чтобы избежать ошибок базы данных.

Для упрощения отслеживания этих изменений в модели, **Entity Framework Code First Migrations** автоматически обнаруживает изменения, сравнение модели с помощью схемы базы данных и приводит к возникновению ошибки конкретного кода для обновления базы данных, Создание нового *версии* базы данных.

В этом упражнении показано, как включить **миграций** для приложения и как можно легко определить и создать изменения для обновления базы данных.

<a id="Ex1Task1"></a>
#### <a name="task-1--enabling-migrations"></a>Задача 1 – включение миграции

В этой задаче будет выполняться действия по включению **Entity Framework Code First Migrations** для **компьютерный фанат тест** базы данных, изменение модели и общие сведения о том, как эти изменения отражаются в База данных.

1. Откройте Visual Studio и откройте **GeekQuiz.sln** файл решения из **Source\Ex1 UsingEntityFrameworkMigrations\Begin**.
2. Постройте решение, чтобы загрузить и установить **NuGet** зависимости пакетов. Для этого щелкните правой кнопкой мыши решение и выберите **построить решение** или нажмите клавишу **Ctrl + Shift + B**.
3. Из **средства** в Visual Studio, выберите пункт меню **диспетчер пакетов библиотеки**, а затем нажмите кнопку **консоль диспетчера пакетов**.
4. В **консоль диспетчера пакетов**, введите следующую команду и нажмите клавишу **ввод**. Будет создана первоначальной миграции, на основе существующей модели.

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample1.ps1)]

    ![Включение миграции](maintainable-azure-websites-managing-change-and-scale/_static/image1.png "включение миграции")

    *Включение миграции*

    > [!NOTE]
    > Эта команда добавляет **миграций** папка головоломка компьютерный фанат проект, содержащий файл называется **Configuration.cs**. **Конфигурации** позволяет определить поведение миграции для текущего контекста.
5. С помощью миграций и включена, необходимо обновить **конфигурации** класс, чтобы заполнить базу данных с начальными данными, **компьютерный фанат тест** требует. В разделе **миграций**, замените **Configuration.cs** файл с тем, который расположен в **Source\Assets** папку части этой лаборатории.

    > [!NOTE]
    > Поскольку **миграций** вызовет **начальное значение** метод при каждом обновлении базы данных, необходимо убедиться, что записи не повторяются в базе данных. **AddOrUpdate** метод поможет предотвратить дублирование данных.
6. Чтобы добавить первоначальной миграции, введите следующую команду и нажмите клавишу **ввод**.

    > [!NOTE]
    > Убедитесь, что нет базы данных с именем &quot;GeekQuizProd&quot; в экземпляре LocalDB.

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample2.ps1)]

    ![Добавление основной схемы миграции](maintainable-azure-websites-managing-change-and-scale/_static/image2.png "Добавление базовой схемы миграции")

    *Добавление основной схемы миграции*

    > [!NOTE]
    > **Добавить миграции** будет формировать следующую миграцию на основе изменений, внесенные в модель с момента создания последней миграции. В этом случае это первой миграции проекта будет добавлен скрипты для создания всех таблиц, определенных в **TriviaContext** класса.
7. Выполнение миграции для обновления базы данных, выполнив следующую команду. Для этой команды необходимо указать **Verbose** флаг, чтобы просмотреть инструкции SQL, применяемые к целевой базе данных.

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample3.ps1)]

    ![Создание начальной базы данных](maintainable-azure-websites-managing-change-and-scale/_static/image3.png "Создание начальной базы данных")

    *Создание начальной базы данных*

    > [!NOTE]
    > **Update-Database** будет применять любые незавершенные миграции к базе данных. В этом случае она будет создана база данных, с помощью строки подключения, определенные в файле web.config.
8. Последовательно выберите пункты **представление** меню и открыть **обозреватель объектов SQL Server**.

    ![Открыть в обозревателе объектов SQL Server](maintainable-azure-websites-managing-change-and-scale/_static/image4.png "открыть в обозревателе объектов SQL Server")

    *Открыть в обозревателе объектов SQL Server*
9. В **обозреватель объектов SQL Server** окна, подключиться к своему экземпляру LocalDB, щелкнув правой кнопкой мыши **SQL Server** узла и выбрав **добавить SQL Server...**  параметр.

    ![Добавление экземпляра SQL Server](maintainable-azure-websites-managing-change-and-scale/_static/image5.png "Добавление экземпляра SQL Server")

    *Добавление экземпляра SQL Server в обозревателе объектов SQL Server*
10. Задать **имя сервера** для *(localdb) \v11.0* и оставить **проверки подлинности Windows** как свой режим проверки подлинности. Нажмите кнопку **Connect** для продолжения.

    ![Подключение к LocalDB](maintainable-azure-websites-managing-change-and-scale/_static/image6.png "подключение к LocalDB")

    *Подключение к LocalDB*
11. Откройте **GeekQuizProd** базы данных и разверните **таблиц** узла. Как видите, **Update-Database** команда создается все таблицы, определенные в **TriviaContext** класса. Найдите **dbo. TriviaQuestions** таблицы и откройте узел «столбцы». В следующей задаче будет добавить новый столбец в этой таблице и обновлять базу данных при помощи **миграций**.

    ![Trivia вопросы столбцы](maintainable-azure-websites-managing-change-and-scale/_static/image7.png "Trivia вопросы столбцов")

    *Trivia вопросы столбцов*

<a id="Ex1Task2"></a>
#### <a name="task-2--updating-database-schema-using-migrations"></a>Задача 2 – обновление схемы базы данных с помощью миграции

В этой задаче будет использоваться **Entity Framework Code First Migrations** обнаруживать изменения в модели и создания необходимого кода для обновления базы данных. Потребуется обновить **TriviaQuestions** сущности, добавив новое свойство. Затем можно будет выполнить команды, чтобы создать новую миграцию для включения нового столбца в таблице.

1. В **обозревателе решений**, дважды щелкните **TriviaQuestion.cs** файл, расположенный внутри **моделей** папки.
2. Добавить новое свойство с именем **указание**, как показано в следующем фрагменте кода.

    [!code-csharp[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample4.cs)]
3. В **консоль диспетчера пакетов**, введите следующую команду и нажмите клавишу **ввод**. Будет создан новый миграции отражения изменений в нашей модели.

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample5.ps1)]

    ![Добавить миграции](maintainable-azure-websites-managing-change-and-scale/_static/image8.png "добавьте миграции")

    *Добавить миграции*

    > [!NOTE]
    > Файл для миграции состоит из двух методов **копирование** и **работу**.
    > 
    > - **Копирование** метод будет использоваться для указания того, какие изменения в текущей версии наших потребностей приложения для применения к базе данных.
    > - **Работу** используется для отмены изменений, мы добавили **копирование** метод.
    > 
    > При миграции базы данных обновляет базу данных, оно будет выполнено при всех переносах в порядке отметки времени и только те, которые не были использованы с момента последнего обновления ( \_MigrationHistory таблица отслеживает отслеживания объекта были применены какие миграции). **Копирование** будет вызван метод всех операций миграции и будут внесены изменения, заданных в базу данных. Если мы решили вернуться к предыдущей миграции, **работу** метод будет вызываться, чтобы внести изменения в обратном порядке.
4. В **консоль диспетчера пакетов**, введите следующую команду и нажмите клавишу **ввод**.

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample6.ps1)]
5. Выходные данные **Update-Database** созданную команду **Alter Table** инструкции SQL, чтобы добавить новый столбец в **TriviaQuestions** таблицы, как показано на рисунке ниже.

    ![Добавьте инструкцию SQL столбца создается](maintainable-azure-websites-managing-change-and-scale/_static/image9.png "добавьте инструкцию SQL столбца создан")

    *Добавьте инструкцию SQL столбца создан*
6. В **обозреватель объектов SQL Server**, обновите **dbo. TriviaQuestions** таблицу и убедитесь, что новый **указание** отображается столбец.

    ![Отображение нового столбца указание](maintainable-azure-websites-managing-change-and-scale/_static/image10.png "отображение нового столбца подсказки")

    *Отображение нового столбца подсказки*
7. В **TriviaQuestion.cs** редактор добавьте **StringLength** ограничение *указание* свойства, как показано в следующем фрагменте кода.

    [!code-csharp[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample7.cs)]
8. В **консоль диспетчера пакетов**, введите следующую команду и нажмите клавишу **ввод**.

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample8.ps1)]
9. В **консоль диспетчера пакетов**, введите следующую команду и нажмите клавишу **ввод**.

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample9.ps1)]
10. Выходные данные **Update-Database** созданную команду **Alter Table** инструкции SQL для обновления *указание* столбец, имеющий тип **TriviaQuestions** таблицы, как показано на рисунке ниже.

    ![Инструкции изменения столбцов SQL создается](maintainable-azure-websites-managing-change-and-scale/_static/image11.png "инструкции изменения столбцов SQL создается")

    *Инструкции изменения столбцов SQL создается*
11. В **обозреватель объектов SQL Server**, обновите **dbo. TriviaQuestions** таблицу и убедитесь, что **указание** столбец имеет тип **nvarchar(150)**.

    ![Отображение нового ограничения](maintainable-azure-websites-managing-change-and-scale/_static/image12.png "отображение нового ограничения")

    *Отображение нового ограничения*

<a id="Exercise2"></a>
### <a name="exercise-2-deploying-a-web-app-to-staging"></a>Упражнение 2: Развертывание веб-приложения для промежуточного хранения

**Веб-приложений в службе приложений Azure** позволяет выполнять промежуточную публикацию. Промежуточную публикацию создает промежуточный слот сайта для каждого рабочего сайта по умолчанию и позволяет менять слоты без простоев. Это очень полезны для проверки изменений перед освобождением общедоступным, постепенно интегрировать содержимое сайта и откатывается, если изменения не работают надлежащим образом.

В этом упражнении мы Развернем **компьютерный фанат тест** приложение в промежуточной среде веб-приложения с помощью системы управления версиями Git. Чтобы сделать это, необходимо создать веб-приложение и подготовить все необходимые компоненты на портале управления, настроить **Git** репозитория и отправка приложения в исходном коде на локальном компьютере для промежуточного слота. Обновит рабочей базы данных с **Code First Migrations** в предыдущем упражнении. Затем будет выполняться приложение в данной тестовой среды для проверки своей работы. После проверки, что приложение работает согласно ожиданиям, переходе приложения в рабочей среде.

> [!NOTE]
> Чтобы включить промежуточную публикацию, должен быть веб-приложения в **стандартный режим**. Обратите внимание, что при изменении веб-приложения в стандартном режиме будет взиматься дополнительная плата. Дополнительные сведения о ценах см. в разделе [цены на службу приложения](https://azure.microsoft.com/en-us/pricing/details/app-service/).


<a id="Ex2Task1"></a>
#### <a name="task-1--creating-a-web-app-in-azure-app-service"></a>Задача 1 – Создание веб-приложения в службе приложений Azure

В этой задаче вы создадите веб-приложения в **службе приложений Azure** на портале управления. Необходимо также настроить **базы данных SQL** для сохранения данных приложения и настройки локального репозитория Git для системы управления версиями.

1. Последовательно выберите пункты [портала управления Azure](https://manage.windowsazure.com) и войдите с использованием учетной записи Майкрософт, связанную с вашей подпиской.

    ![Войдите в портал управления Azure](maintainable-azure-websites-managing-change-and-scale/_static/image13.png)

    *Войдите в портал управления Azure*
2. Нажмите кнопку **New** на панели команд в нижней части страницы.

    ![Создание нового веб-приложения](maintainable-azure-websites-managing-change-and-scale/_static/image14.png "Создание нового веб-приложения")

    *Создание нового веб-приложения*
3. Нажмите кнопку **вычислений**, **веб-сайт** и затем **настраиваемое создание**.

    ![Создание нового веб-приложения с помощью настраиваемое создание](maintainable-azure-websites-managing-change-and-scale/_static/image15.png "Создание нового веб-приложения с помощью настраиваемое Создание")

    *Создание нового веб-приложения с помощью настраиваемое Создание*
4. В **новый веб-узел - настраиваемое создание** диалогового окна введите доступный **URL-адрес** (например *головоломки компьютерный фанат*), выберите расположение, в **область** раскрывающегося списка, а затем выберите **создать новую базу данных SQL** в **базы данных** раскрывающегося списка. Наконец, выберите **публикации из системы управления версиями** флажок и нажмите кнопку **Далее**.

    ![Настройка нового веб-приложения](maintainable-azure-websites-managing-change-and-scale/_static/image16.png)

    *Настройка нового веб-приложения*
5. Укажите следующие сведения для настройки базы данных:

    - В **имя** текста введите имя базы данных (например *geekquiz\_db*)
    - На сервере **раскрывающемся** выберите **сервера базы данных SQL, новый**. Кроме того можно выбрать существующий сервер.
    - В **имя пользователя базы данных** и **пароль базы данных** , введите имя пользователя администратора и пароль для базы данных SQL server. Если выбрать сервер уже создан, предложит ввести пароль.

    ![Задание параметров базы данных](maintainable-azure-websites-managing-change-and-scale/_static/image17.png)

    *Задание параметров базы данных*
6. Чтобы продолжить, нажмите кнопку **Далее** .
7. Выберите **локального репозитория Git** для системы управления версиями, и нажмите кнопку **Далее**.

    > [!NOTE]
    > Вы может запрашиваться учетные данные развертывания (имя пользователя и пароль).

    ![Создание репозитория Git](maintainable-azure-websites-managing-change-and-scale/_static/image18.png)

    *Создание репозитория Git*
8. Подождите, пока не будет создан новый веб-приложения.

    > [!NOTE]
    > По умолчанию, Azure предоставляет доменах на *azurewebsites.net* , но также предоставляет возможность задать пользовательские домены, с помощью портала управления Azure. Тем не менее можно управлять только пользовательских доменов при использовании определенных режимах службе приложений Azure.
    > 
    > Служба приложений Azure доступен в выпусках Free, Shared, Basic, Standard и Premium. В режиме Free и Shared все веб-приложения выполняются в многопользовательской среде и имеет квот на использование ЦП, памяти и сети. Максимальное число бесплатных приложений зависит от плана. В стандартном режиме выберите, какие приложения запустить на выделенных виртуальных машинах, которые соответствуют стандартной Azure вычислительные ресурсы. Можно найти конфигурацию в режиме web app в **шкалы** меню веб-приложения.
    > 
    > ![Служба приложений Azure режимы](maintainable-azure-websites-managing-change-and-scale/_static/image19.png "режимы службы приложений Azure")
    > 
    > Если вы используете **Shared** или **Стандартная** режиме, вы сможете управлять пользовательских доменов для веб-приложения, перейдя в свое приложение **Настройка** меню и выбрав пункт **Управление доменами** под *доменных имен*.
    > 
    > ![Управление доменами](maintainable-azure-websites-managing-change-and-scale/_static/image20.png "Управление доменами")
    > 
    > ![Управление пользовательскими доменами](maintainable-azure-websites-managing-change-and-scale/_static/image21.png "управление пользовательскими доменами")
9. После создания веб-приложения по ссылке **URL-адрес** столбец для проверки того, что новое веб-приложение работает.

    ![Просмотр нового веб-приложения](maintainable-azure-websites-managing-change-and-scale/_static/image22.png)

    *Просмотр нового веб-приложения*

    ![Запуск веб-приложения](maintainable-azure-websites-managing-change-and-scale/_static/image23.png)

    *Запуск веб-приложения*

<a id="Ex2Task2"></a>
#### <a name="task-2--creating-the-production-sql-database"></a>Задача 2 – Создание рабочей базы данных SQL

В этой задаче будет использоваться **Entity Framework Code First Migrations** для создания базы данных, предназначенных для **базы данных SQL Azure** экземпляром, созданным в предыдущей задаче.

1. На портале управления перейдите к веб-приложения, созданного в предыдущей задаче и перейти к его **мониторинга**.
2. В **мониторинга** щелкните **Просмотр строк подключения** ссылку в списке **быстрый обзор** раздела.

    ![Просмотреть строки подключения](maintainable-azure-websites-managing-change-and-scale/_static/image24.png "Просмотр строк подключения")

    *Просмотр строк подключения*
3. Копировать **строка подключения** значение и закрыть диалоговое окно.

    ![Строка подключения на портале управления Azure](maintainable-azure-websites-managing-change-and-scale/_static/image25.png "строку подключения на портале управления Azure")

    *Строка подключения на портале управления Azure*
4. Нажмите кнопку **баз данных SQL** для просмотра списка баз данных SQL в Azure

    ![База данных SQL меню](maintainable-azure-websites-managing-change-and-scale/_static/image26.png "меню базы данных SQL")

    *Меню базы данных SQL*
5. Найдите базу данных, созданный в предыдущей задаче и нажмите кнопку на сервере.

    ![База данных SQL server](maintainable-azure-websites-managing-change-and-scale/_static/image27.png "базы данных SQL server")

    *База данных SQL server*
6. В **быстрый запуск** страницы сервера, нажмите кнопку **Настройка**.

    ![Настройка меню](maintainable-azure-websites-managing-change-and-scale/_static/image28.png "Настройка меню")

    *Настройка меню*
7. В **допускается IP-адреса** щелкните **добавить в разрешенные IP-адреса** ссылку, чтобы включить на IP-адрес для подключения к базе данных SQL server.

    ![Разрешенные IP-адреса](maintainable-azure-websites-managing-change-and-scale/_static/image29.png "допускается IP-адресов")

    *Разрешенные IP-адреса*
8. Нажмите кнопку **Сохранить** в нижней части страницы для выполнения шага.
9. Переключитесь в Visual Studio.
10. В **консоль диспетчера пакетов**, выполните следующие команды, заменив *[строка YOUR подключения]* заполнителя в строке подключения, скопированные из Azure

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample10.ps1)]

    ![Обновление базы данных, предназначенных для Windows Azure SQL Database](maintainable-azure-websites-managing-change-and-scale/_static/image30.png "обновление базы данных, предназначенных для базы данных SQL Windows Azure")

    *Обновление базы данных, предназначенных для базы данных SQL Azure*

<a id="Ex2Task3"></a>
#### <a name="task-3--deploying-geek-quiz-to-staging-using-git"></a>Задача 3 – развертывание компьютерный фанат тест для промежуточного хранения, с помощью Git

В этой задаче будет включить промежуточную публикацию в веб-приложения. После этого вы используете Git для публикации приложения головоломка компьютерный фанат непосредственно с локального компьютера в промежуточной среде веб-приложения.

1. Вернитесь на портал и щелкните имя веб-приложения в разделе **имя** столбец для отображения страницы управления.

    ![Открытие приложения управления веб-страниц](maintainable-azure-websites-managing-change-and-scale/_static/image31.png)

    *Открытие приложения управления веб-страниц*
2. Перейдите к **шкалы** страницы. В разделе **Общие** выберите **Стандартная** конфигурации и нажмите кнопку **Сохранить** на панели команд.

    > [!NOTE]
    > Для выполнения всех веб-приложений в текущей области и подписки в **Стандартная** режиме, оставьте **выделить все** флажком в **выберите сайты** конфигурации. В противном случае снимите **выделить все** флажок.

    ![Обновление веб-приложения в стандартном режиме](maintainable-azure-websites-managing-change-and-scale/_static/image32.png "обновление до стандартного режима веб-приложения")

    *Обновление до стандартного режима веб-приложения*
3. Нажмите кнопку **Да** для подтверждения изменения.

    ![Подтверждение изменений в стандартном режиме](maintainable-azure-websites-managing-change-and-scale/_static/image33.png "продолжить изменение режима приложения веб-сервере")

    *Подтверждение изменений в стандартном режиме*
4. Последовательно выберите пункты **мониторинга** и нажмите кнопку **Enable промежуточная публикация** под **быстрый обзор** раздела.

    ![Включить промежуточную публикацию](maintainable-azure-websites-managing-change-and-scale/_static/image34.png "Включение промежуточная публикация")

    *Включить промежуточную публикацию*
5. Нажмите кнопку **Да** хотите включить промежуточную публикацию.

    ![Подтверждение промежуточная публикация](maintainable-azure-websites-managing-change-and-scale/_static/image35.png "щелкните Да, чтобы включить промежуточную публикацию")

    *Подтверждение промежуточную публикацию*
6. В списке веб-приложений разверните знак слева от имя вашего веб-приложения для отображения промежуточный слот сайта. Он имеет имя веб-приложения, за которым следует ***(промежуточный)***. Щелкните промежуточный сайт, чтобы перейти на страницу управления.

    ![Переход к промежуточной веб-приложения](maintainable-azure-websites-managing-change-and-scale/_static/image36.png "переход к промежуточной веб-приложения")

    *Переход к промежуточного приложения*
7. Обратите внимание, что эта страница управления он выглядит как страница управления любые другие веб-приложения. Перейдите к **развертываний** страницы и скопируйте **URL-адрес Git** значение. Далее в этом упражнении будет использовать его.

    ![При копировании значения URL-адрес Git](maintainable-azure-websites-managing-change-and-scale/_static/image37.png)

    *При копировании значения URL-адрес Git*
8. Откройте новый **Git Bash** консоли и выполните следующие команды. Обновление *[путь ВАШЕГО приложения]* заполнитель с путем к **GeekQuiz** решений, расположенный в **Source\Ex1 DeployingWebSiteToStaging\Begin** папки Эта лаборатория.

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample11.cmd)]

    ![Инициализация Git и первой сборки](maintainable-azure-websites-managing-change-and-scale/_static/image38.png)

    *Инициализация Git и первой сборки*
9. Выполните следующую команду для принудительной отправки веб-приложения на удаленном **Git** репозитория. Замените заполнитель URL-адрес, полученный из портала управления. Будет приглашение ввести пароль развертывания.

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample12.cmd)]

    ![Помещает в Windows Azure](maintainable-azure-websites-managing-change-and-scale/_static/image39.png)

    *Отправка в Azure*

    > [!NOTE]
    > При развертывании содержимого на FTP-узле или репозитории GIT веб-приложения, необходимо пройти подлинность с помощью **учетные данные развертывания** , созданный на основе веб-приложения **быстрый запуск** или **панели мониторинга**  страниц управления. Если вы не знаете, учетные данные развертывания можно легко сбросить их с помощью портала управления. Откройте веб-приложения **мониторинга** и нажмите кнопку **Сброс учетных данных развертывания** ссылку. Введите новый пароль и нажмите кнопку **ОК**. Учетные данные развертывания можно использовать для всех веб-приложений, связанных с подпиской.
10. Чтобы проверить веб-приложения был успешно отправлен в Azure, вернитесь на портал управления и нажмите кнопку **веб-сайтов**.
11. Найдите веб-приложения и разверните запись для отображения промежуточный слот сайта. Щелкните его **имя** переход на страницу управления.
12. Нажмите кнопку **развертываний** для просмотра **журнала развертывания**. Убедитесь, что **активное развертывание** с вашей  *&quot;начальной зафиксировать&quot;*.

    ![Активное развертывание](maintainable-azure-websites-managing-change-and-scale/_static/image40.png)

    *Активное развертывание*
13. Наконец, нажмите кнопку **Обзор** на панели команд, чтобы перейти на веб-приложения.

    ![Обзор веб-приложения](maintainable-azure-websites-managing-change-and-scale/_static/image41.png)

    *Обзор веб-приложения*
14. Если приложение успешно развернуто, вы увидите страницу входа компьютерный фанат тест.

    > [!NOTE]
    > URL-адрес развертываемом приложении содержит имя веб-приложения, за которым следует *-промежуточных*.

    ![Приложение, работающее в среде промежуточного хранения](maintainable-azure-websites-managing-change-and-scale/_static/image42.png)

    *Приложение, работающее в среде промежуточного хранения*
15. Если вы хотите исследовать приложения, нажмите кнопку **зарегистрировать** для регистрации нового пользователя. Завершите сведения учетной записи, указав имя пользователя, адрес электронной почты и пароль. После этого приложение показывает первый вопрос головоломки. Ответьте на несколько вопросов, чтобы убедиться в том, что он работает должным образом.

    ![Приложение можно будет использовать](maintainable-azure-websites-managing-change-and-scale/_static/image43.png)

    *Приложение можно будет использовать*

<a id="Ex2Task4"></a>
#### <a name="task-4--promoting-the-web-app-to-production"></a>Задача 4 — повышение уровня веб-приложения в рабочей среде

Теперь, когда вы убедились, что веб-приложение работает правильно, в промежуточной среде, можно приступать к его распространение в рабочей среде. В этой задаче будет переключить промежуточный слот сайта на производственный слот сайта.

1. Вернитесь на портал управления и выберите промежуточный слот сайта. Нажмите кнопку **замены** на панели команд.

    ![Переключение в рабочей среде](maintainable-azure-websites-managing-change-and-scale/_static/image44.png)

    *Переключение в рабочей среде*
2. Нажмите кнопку **Да** в диалоговом окне подтверждения, чтобы продолжить операцию замены. Azure будет немедленно замены содержимого рабочего сайта с помощью содержимого промежуточный сайт.

    > [!NOTE]
    > Некоторые параметры из промежуточных версии будет автоматически копироваться в рабочей версии (например строка соединения переопределений, сопоставления обработчика, т. д.), но другие параметры не изменится (например DNS конечные точки, привязки SSL, и т. д.).

    ![Подтверждение операции замены](maintainable-azure-websites-managing-change-and-scale/_static/image45.png)

    *Подтверждение операции замены*
3. После завершения замены выберите производственный слот и нажмите кнопку **Обзор** на панели команд, чтобы открыть рабочего сайта. Обратите внимание, URL-адрес в адресной строке.

    > [!NOTE]
    > Может потребоваться обновить браузер, чтобы очистить кэш. В Internet Explorer, это можно сделать, нажав клавишу **CTRL + R**.

    ![Веб-приложения в рабочей среде](maintainable-azure-websites-managing-change-and-scale/_static/image46.png)
4. В **GitBash** консоли, обновить удаленный URL-адрес локального репозитория Git ориентироваться на производственный слот. Чтобы сделать это, выполните следующую команду, заменив заполнители с вашим именем пользователя развертывания и имя веб-приложения.

    > [!NOTE]
    > В следующих упражнениях будет отправьте изменения рабочего сайта вместо промежуточной только для простоты лаборатории. В реальном сценарии рекомендуется проверить изменения в промежуточной среде перед повышением роли в рабочей среде.

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample13.cmd)]

<a id="Exercise3"></a>
### <a name="exercise-3-performing-deployment-rollback-in-production"></a>Упражнение 3: Выполнение отката развертывания в рабочей среде

Существуют сценарии, где у вас промежуточный слот для выполнения горячей замены между промежуточной и производственной среде, например, если вы работаете с **Free** или **Shared** режим. В этих сценариях следует протестировать приложение в тестовой среде — локально или на удаленном узле — перед развертыванием в рабочей среде. Тем не менее существует возможность, что проблемы не обнаружены на этапе тестирования может возникнуть в рабочего сайта. В этом случае важно иметь механизм для простоты перехода предыдущий и более стабильной версии приложения, как можно быстрее.

В **службе приложений Azure**, непрерывное развертывание из системы управления версиями делает это возможным благодаря для **повторно развернуть** действия, доступные на портале управления. Azure отслеживает развертываний, связанных с фиксаций передаче в репозиторий и предоставляет возможность повторного развертывания приложения с помощью любой из предыдущих развертываний, в любое время.

В этом упражнении будет выполнять изменений в код в **головоломка компьютерный фанат** приложения, которое вставляет намеренно *ошибки*. Будет развертывание приложения в производственную среду, чтобы увидеть ошибку и затем будет воспользоваться преимуществами функции повторного развертывания, чтобы вернуться к предыдущему состоянию.

<a id="Ex3Task1"></a>
#### <a name="task-1--updating-the-geek-quiz-application"></a>Задача 1 – обновление приложения компьютерный фанат головоломки

В этой задаче рефакторинга небольшая часть кода **TriviaController** класс для извлечения часть логики, которая извлекает головоломки выбранный параметр из базы данных в новый метод.

1. Перейдите к экземпляру Visual Studio с **GeekQuiz** решения в предыдущем упражнении.
2. В **обозревателе решений**откройте **TriviaController.cs** файла внутри **контроллеров** папки.
3. Найдите **StoreAsync** метод и выберите код выделяются на следующем рисунке.

    ![При выборе в коде](maintainable-azure-websites-managing-change-and-scale/_static/image47.png)

    *При выборе в коде*
4. Щелкните правой кнопкой мыши выделенный код, разверните **рефакторинг** и выбрать пункт **метода извлечения...** .

    ![Извлечение как новый метод в коде](maintainable-azure-websites-managing-change-and-scale/_static/image48.png)

    *Выбор способа извлечения*
5. В **извлечение метода** диалоговом имя нового метода *MatchesOption* и нажмите кнопку **ОК**.

    ![Указывая имя метода](maintainable-azure-websites-managing-change-and-scale/_static/image49.png)

    *Указание имени для извлечения метода*
6. Выделенный код затем извлекается в **MatchesOption** метод. В следующем фрагменте показан итоговый код.

    [!code-csharp[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample14.cs)]
7. Нажмите клавишу **сочетание клавиш CTRL + S** для сохранения изменений.

<a id="Ex3Task2"></a>
#### <a name="task-2--redeploying-the-geek-quiz-application"></a>Задача 2 — повторного развертывания приложения компьютерный фанат головоломки

Теперь будет передавать изменения, внесенные в предыдущей задаче репозитория, который будет активировать новое развертывание в рабочей среде. После этого будет и устранение проблем проблему с помощью **средства разработки F12** предоставляемое Internet Explorer и затем выполнить откат предыдущего развертывания на портале управления Azure.

1. Откройте новый **Git Bash** консоль для развертывания обновленного приложения в службе приложений Azure.
2. Выполните следующие команды для изменения в Azure. Обновление *[путь ВАШЕГО приложения]* заполнитель с путем к **GeekQuiz** решения. Будет приглашение ввести пароль развертывания.

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample15.cmd)]

    ![Передача рефакторингу кода на Azure](maintainable-azure-websites-managing-change-and-scale/_static/image50.png)

    *Передача рефакторингу кода на Azure*
3. Откройте Internet Explorer и перейдите на веб-приложение (например `http://<your-web-site>.azurewebsites.net`). Вход с помощью ранее созданного учетные данные.
4. Нажмите клавишу **F12** для запуска средства разработки, выберите **сети** и нажмите кнопку **воспроизведение** кнопку, чтобы начать запись.

    ![Начиная с сеть записи](maintainable-azure-websites-managing-change-and-scale/_static/image51.png "начала записи в сети")

    *Запуск записи сети*
5. Выберите любой параметр головоломку. Вы увидите, что ничего не происходит.
6. В **F12** окно, элемент, соответствующий запрос POST HTTP показывает HTTP **500** результат.

    ![HTTP 500 ошибок](maintainable-azure-websites-managing-change-and-scale/_static/image52.png)

    *HTTP 500 ошибок*
7. Выберите **консоли** вкладки. В журнал подробные сведения о причину.

    ![Журнал ошибок](maintainable-azure-websites-managing-change-and-scale/_static/image53.png)

    *Журнал ошибок*
8. Найдите часть сведений об ошибке. Очевидно Эта ошибка вызвана кодом, рефакторинг вы были зафиксированы на предыдущих шагах.

    `Details: LINQ to Entities does not recognize the method 'Boolean MatchesOption ...`.
9. Не закрывайте браузер.
10. В новом экземпляре браузера, перейдите к [портала управления Azure](https://manage.windowsazure.com) и войдите с использованием учетной записи Майкрософт, связанную с вашей подпиской.
11. Выберите **веб-сайтов** и щелкните веб-приложения, созданного в упражнении 2.
12. Перейдите к **развертываний** страницы. Обратите внимание, что выполнены все фиксации, перечислены в журнал развертывания.

    ![Список существующих развертываний](maintainable-azure-websites-managing-change-and-scale/_static/image54.png)

    *Список существующих развертываний*
13. Выберите предыдущую фиксацию и нажмите кнопку **повторно развернуть** на панели команд.

    ![Повторное развертывание предыдущую фиксацию](maintainable-azure-websites-managing-change-and-scale/_static/image55.png)

    *Повторное развертывание предыдущую фиксацию*
14. При появлении запроса на подтверждение нажмите кнопку **Да**.

    ![Подтверждение повторное развертывание](maintainable-azure-websites-managing-change-and-scale/_static/image56.png)
15. После завершения развертывания переключитесь обратно на экземпляр обозревателя с веб-приложения и нажмите клавишу **сочетание клавиш CTRL + F5**.
16. Щелкните любой из параметров. Переворачивающейся анимации теперь займет месте и результат (*успешных и неуспешных попыток*) будет отображаться.
17. (Необязательно) Переключитесь в **Git Bash** консоли и выполните следующие команды, чтобы вернуться к предыдущей операции фиксации.

    > [!NOTE]
    > Эти команды создают новые фиксации, которая отменяет все изменения в репозиторий Git, внесенные в неверный фиксации. Azure затем выполнить повторное развертывание приложения с помощью нового фиксации.

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample16.cmd)]

<a id="Exercise4"></a>
### <a name="exercise-4-scaling-using-azure-storage"></a>Упражнение 4: Масштабирования с помощью хранилища Azure

**Большие двоичные объекты** — это самый простой способ хранить большие объемы неструктурированных текстовых или двоичных данных, таких как видео, аудио и изображения. Перемещение к статическому содержимому приложения в хранилище, позволяет масштабировать приложения, выполняющих изображения или документы непосредственно в браузере.

В этом упражнении будет переместить статическое содержимое приложения в контейнер больших двоичных объектов. Затем будет настроить приложение, чтобы добавить **правил переопределения URL-адресов ASP.NET** в **Web.config** для перенаправления содержимого в контейнере больших двоичных объектов.

<a id="Ex4Task1"></a>
#### <a name="task-1--creating-an-azure-storage-account"></a>Задача 1 – Создание учетной записи хранилища Azure

В этой задаче вы узнаете, как создать новую учетную запись хранилища с помощью портала управления.

1. Перейдите к [портала управления Azure](https://manage.windowsazure.com) и войдите с использованием учетной записи Майкрософт, связанную с вашей подпиской.
2. Выберите **новые | Службы данных | Хранилище | Быстрое создание** Чтобы приступить к созданию новой учетной записи хранения. Введите уникальное имя для учетной записи и выберите **область** из списка. Нажмите кнопку **создать учетную запись хранилища** для продолжения.

    ![Создание новой учетной записи хранения](maintainable-azure-websites-managing-change-and-scale/_static/image57.png "Создание новой учетной записи хранения")

    *Создание новой учетной записи хранения*
3. В **хранения** статьи, подождите, пока не изменится состояние учетной записи хранения на *Online* чтобы продолжить на следующем шаге.

    ![Создается учетная запись хранения](maintainable-azure-websites-managing-change-and-scale/_static/image58.png "создается учетная запись хранения")

    *Создается учетная запись хранения*
4. Щелкните имя учетной записи хранилища, а затем нажмите кнопку **мониторинга** ссылку в верхней части страницы. **Мониторинга** страница содержит сведения о состоянии учетной записи и конечные точки службы, которые могут использоваться в приложениях.

    ![Отображение панели мониторинга учетной записи хранения](maintainable-azure-websites-managing-change-and-scale/_static/image59.png "отображение панели мониторинга учетной записи хранения")

    *Отображение панели мониторинга учетной записи хранения*
5. Нажмите кнопку **управление ключами доступа** кнопки на панели навигации.

    ![Управление ключами доступа кнопка](maintainable-azure-websites-managing-change-and-scale/_static/image60.png "кнопку Управление ключами доступа")

    *Управление кнопку клавиши доступа*
6. В **управление ключами доступа** диалоговое окно, скопируйте **имя учетной записи хранения** и **первичный ключ доступа** как они понадобятся вам в следующем упражнении. Закройте диалоговое окно.

    ![Диалоговое окно Управление ключом доступа](maintainable-azure-websites-managing-change-and-scale/_static/image61.png "диалоговое окно «Управление ключами доступа»")

    *Ключ доступа диалоговое окно Управление*

<a id="Ex4Task2"></a>
#### <a name="task-2--uploading-an-asset-to-azure-blob-storage"></a>Задача 2 — Отправка актива в хранилище BLOB-объектов Azure

В этой задаче будет использовать окно обозревателя серверов из Visual Studio для подключения к учетной записи хранилища. Затем создайте контейнер больших двоичных объектов и отправить файл с эмблемой компьютерный фанат головоломка в контейнер.

1. Перейдите к экземпляру Visual Studio с **GeekQuiz** решения в предыдущем упражнении.
2. В строке меню выберите **представление** и нажмите кнопку **обозревателя серверов**.
3. В **обозревателя серверов**, щелкните правой кнопкой мыши **Azure** , а затем выберите **подключение к Azure...** . Вход с использованием учетной записи Майкрософт, связанную с вашей подпиской.

    ![Подключиться к Windows Azure](maintainable-azure-websites-managing-change-and-scale/_static/image62.png)

    *Подключиться к Azure*
4. Разверните **Azure** узел, щелкните правой кнопкой мыши **хранения** и выберите **присоединить внешнее хранилище...** .
5. В **добавить новую учетную запись хранения** диалогового окна введите **имя учетной записи** и **ключ учетной записи** вы получили в предыдущей задаче и нажмите кнопку **ОК**.

    ![Добавление новой учетной записи хранения-диалоговое окно](maintainable-azure-websites-managing-change-and-scale/_static/image63.png)

    *Добавление новой учетной записи хранения-диалоговое окно*
6. Учетной записи хранилища будут отображаться под **хранения** узла. Ваша учетная запись хранения, щелкните правой кнопкой **большие двоичные объекты** и выберите **создать контейнер больших двоичных объектов...** .

    ![Создание контейнера больших двоичных объектов](maintainable-azure-websites-managing-change-and-scale/_static/image64.png "создать контейнер больших двоичных объектов")

    *Создание контейнера больших двоичных объектов*
7. В **создать контейнер больших двоичных объектов** диалогового окна введите имя контейнера больших двоичных объектов и нажмите кнопку **ОК**.

    ![Диалоговое окно Создание контейнера больших двоичных объектов](maintainable-azure-websites-managing-change-and-scale/_static/image65.png "диалоговое окно «Создание контейнера больших двоичных объектов»")

    *Создать контейнер больших двоичных объектов-диалоговое окно*
8. Новый контейнер больших двоичных объектов, которые должны быть добавлены в **большие двоичные объекты** узла. Изменение разрешений доступа в контейнере сделать контейнер общедоступным. Для этого щелкните правой кнопкой мыши **изображения** контейнер и выберите **свойства**.

    ![свойства контейнера изображений](maintainable-azure-websites-managing-change-and-scale/_static/image66.png "свойства контейнера изображений")

    *Свойства контейнера изображений*
9. В **свойства** задайте **общего доступа на чтение** для **контейнер**.

    ![Изменение свойства общего доступа на чтение](maintainable-azure-websites-managing-change-and-scale/_static/image67.png "изменение свойства общего доступа на чтение")

    *Изменение свойства общего доступа на чтение*
10. При появлении запроса, если вы уверены, необходимо изменить свойство общего доступа, нажмите кнопку **Да**.

    ![Microsoft Visual Studio предупреждение](maintainable-azure-websites-managing-change-and-scale/_static/image68.png "предупреждение Microsoft Visual Studio")

    *Предупреждение Microsoft Visual Studio*
11. В **обозревателя серверов**, щелкните правой кнопкой мыши **изображения** контейнер больших двоичных объектов и выберите **контейнер больших двоичных объектов представления**.

    ![Просмотреть контейнер больших двоичных объектов](maintainable-azure-websites-managing-change-and-scale/_static/image69.png "просмотреть контейнер больших двоичных объектов")

    *Контейнер больших двоичных объектов представления*
12. Контейнер образов следует открыть в новом окне, и без элементов условных обозначений должно быть показано. Нажмите кнопку **отправить** значок, чтобы загрузить файл в контейнер больших двоичных объектов.

    ![Контейнер образов с записями](maintainable-azure-websites-managing-change-and-scale/_static/image70.png "изображения контейнер без элементов")

    *Контейнер образов без элементов*
13. В **отправить BLOB-объект** диалоговом окне перейдите к **активы** папку лаборатории. Выберите **логотип big.png** файла и нажмите кнопку **откройте**.
14. Дождитесь завершения передачи файла. По завершении отправки файла должен быть указан в контейнере изображения. Щелкните правой кнопкой мыши запись файла и выберите **скопировать URL-адрес**.

    ![Скопируйте URL-адрес большого двоичного объекта](maintainable-azure-websites-managing-change-and-scale/_static/image71.png "скопируйте URL-адрес файла большого двоичного объекта")

    *Скопируйте URL-адрес большого двоичного объекта*
15. Откройте Internet Explorer и вставьте URL-адрес. Следующие изображения должен отображаться в браузере.

    ![Эмблема big.png изображения из хранилища больших двоичных объектов Windows](maintainable-azure-websites-managing-change-and-scale/_static/image72.png "big.png логотип изображения из хранилища")

    *Эмблема big.png изображения из хранилища больших двоичных объектов*

<a id="Ex4Task3"></a>
#### <a name="task-3--updating-the-solution-to-consume-static-content-from-azure-blob-storage"></a>Задача 3 – обновление решения для использования статического содержимого из хранилища BLOB-объектов Azure

В этой задаче вы настроите **GeekQuiz** решение, чтобы использовать изображение переданы хранилища больших двоичных объектов (вместо образа, расположенного в веб-приложения), добавив правило подстановки URL-адреса ASP.NET в **web.config**файла.

1. В Visual Studio откройте **Web.config** файла внутри **GeekQuiz** проекта и найдите  **&lt;system.webServer&gt;**  элемента.
2. Добавьте следующий код для добавления URL-адрес перепишите правило, обновление заполнитель с вашей учетной записи хранилища.

    (Фрагмент - кода *UrlRewriteRule WebSitesInProduction - Ex4 -*)

    [!code-xml[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample17.xml)]

    > [!NOTE]
    > Перезапись URL-адрес — это процесс перехвата входящего веб-запроса и перенаправляет их на другой ресурс. URL-адрес правила перезаписи подсистема переписывания при необходимости перенаправить запрос, и где они должны перенаправляться. Перезаписи правило состоит из двух строк: шаблон для поиска запрошенного URL-адреса (как правило, с помощью регулярных выражений), и строка для замены с шаблоном, если он найден. Дополнительные сведения см. в разделе [перезаписи URL-адресов в ASP.NET](https://msdn.microsoft.com/en-us/library/ms972974.aspx).
3. Нажмите клавишу **сочетание клавиш CTRL + S** для сохранения изменений.
4. Откройте новый **Git Bash** консоль для развертывания обновленного приложения в службе приложений Azure.
5. Выполните следующие команды для изменения в Azure. Обновление *[путь ВАШЕГО приложения]* заполнитель с путем к **GeekQuiz** решения. Будет приглашение ввести пароль развертывания.

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample18.cmd)]

    ![Развертывание обновления для Azure](maintainable-azure-websites-managing-change-and-scale/_static/image73.png)

    *Развертывание обновления для Azure*

<a id="Ex4Task4"></a>
#### <a name="task-4--verification"></a>Задача 4 – Проверка

В этой задаче будут использованы **Internet Explorer** для просмотра **головоломка компьютерный фанат** приложение и проверьте, что URL-адрес перепишите правило для образов работает и вы будете перенаправлены изображения, размещенные в **больших двоичных объектов Azure Хранилище**.

1. Откройте Internet Explorer и перейдите на веб-приложение (например `http://<your-web-site>.azurewebsites.net`). Вход с помощью ранее созданного учетные данные.

    ![Отображение компьютерный фанат тест веб-приложения с изображением](maintainable-azure-websites-managing-change-and-scale/_static/image74.png "отображающий компьютерный фанат тест веб-приложение с изображением")

    *Отображение компьютерный фанат тест веб-приложения с изображением*
2. Нажмите клавишу **F12** для запуска средства разработки, выберите **сети** вкладку и начать запись.

    ![Начиная с сеть записи](maintainable-azure-websites-managing-change-and-scale/_static/image75.png "начала записи в сети")

    *Запуск записи сети*
3. Нажмите клавишу **сочетание клавиш CTRL + F5** для обновления веб-страницы.
4. После завершения загрузки страницы, вы увидите HTTP-запроса для **/img/logo-big.png** URL-адрес с HTTP **301** результат (перенаправление) и другим запросом `http://[YOUR-STORAGE-ACCOUNT].blob.core.windows.net/images/logo-big.png` URL-адрес с HTTP **200** результат.

    ![Проверка URL-адрес перенаправления](maintainable-azure-websites-managing-change-and-scale/_static/image76.png "отображение перенаправления в средствах разработки")

    *Проверка URL-адрес перенаправления*

<a id="Exercise5"></a>
### <a name="exercise-5-using-autoscale-for-web-apps"></a>Упражнение 5: С помощью автоматического масштабирования для веб-приложений

> [!NOTE]
> В этом упражнении необязателен, так как он требует поддержки веб-нагрузку &amp; тестирования производительности, который доступен только для **Visual Studio 2013 Ultimate Edition**. Дополнительные сведения об определенных функциях Visual Studio 2013 сравнить версии [здесь](https://www.microsoft.com/visualstudio/eng/products/compare).


**Приложение службы веб-приложения Azure** предоставляет возможность автоматического масштабирования для веб-приложений, работающих в **стандартный режим**. Автоматического масштабирования позволяет Azure автоматически масштабировала число экземпляров веб-приложения в зависимости от нагрузки. Если Автомасштабирование включено, Azure проверяет нагрузку ЦП для веб-приложения каждые пять минут и добавляет экземпляры при необходимости на момент времени. В случае низкой ЦП Azure убирает экземпляры каждые 2 часа, чтобы убедиться, что не снижается производительность веб-приложения.

В этом упражнении вы перейдете выполнить шаги, необходимые для настройки **автомасштабирования** возможностей **компьютерный фанат тест** веб-приложения. Этот компонент будет проверить, выполнив нагрузочного теста Visual Studio для создания достаточной нагрузки ЦП в приложение, чтобы запустить обновление экземпляра.

<a id="Ex5Task1"></a>
#### <a name="task-1--configuring-autoscale-based-on-the-cpu-metric"></a>Задача 1 — Настройка автоматического масштабирования, в зависимости от метрики ЦП

В этой задаче будет использовать портал управления Azure, чтобы включить функцию автоматического масштабирования для веб-приложения, созданный в упражнении 2.

1. В [портала управления Azure](https://manage.windowsazure.com/)выберите **веб-сайтов** и щелкните веб-приложения, созданного в упражнении 2.
2. Перейдите к **шкалы** страницы. В разделе **емкость** выберите **ЦП** для **масштабирование по метрике** конфигурации.

    > [!NOTE]
    > При масштабировании по ЦП Azure динамически регулирует количество экземпляров, которые приложение использует при изменении ЦП.

    ![При выборе масштабирование по ЦП](maintainable-azure-websites-managing-change-and-scale/_static/image77.png "выбора метрики ЦП для автоматического масштабирования")

    *При выборе масштабирование по ЦП*
3. Изменение **целевой Процессор** конфигурации для **20**-**40** процентов.

    > [!NOTE]
    > Этот диапазон представляет среднее использование ЦП для веб-приложения. Azure будет добавлять или удалять экземпляры, чтобы удержать веб-приложения в этом диапазоне. Минимальное и максимальное число экземпляров, используемых для масштабирования указывается в **число экземпляров** конфигурации. Azure будет никогда не выйдут за установленные за рамками этого ограничения.
    > 
    > Значение по умолчанию **целевой Процессор** значения изменяются только в целях этой лаборатории. Настроив диапазон ЦП с небольшими значениями, вы увеличиваете вероятность для запуска автоматического масштабирования при помещении умеренной нагрузки на приложение.

    ![Изменение целевой ЦП, чтобы быть в диапазоне от 20 до 40 процентов](maintainable-azure-websites-managing-change-and-scale/_static/image78.png "Изменение целевой ЦП, чтобы быть в диапазоне от 20 до 40 процентов")

    *Изменение целевой ЦП, чтобы быть в диапазоне от 20 до 40 процентов*
4. Нажмите кнопку **Сохранить** на панели команд, чтобы сохранить изменения.

<a id="Ex5Task2"></a>
#### <a name="task-2--load-testing-with-visual-studio"></a>Задача 2 — нагрузочного тестирования с Visual Studio

Теперь, когда **автомасштабирования** была настроена, вы создадите **веб-тестов производительности и загрузить тестовый проект** в Visual Studio для создания некоторых загрузку ЦП на веб-приложения.

1. Откройте **Visual Studio Ultimate 2013** и выберите **файл | Новые | Проект...**  для запуска нового решения.

    ![Создание нового проекта](maintainable-azure-websites-managing-change-and-scale/_static/image79.png "Создание нового проекта")

    *Создание нового проекта*
2. В **новый проект** выберите **веб-тестов производительности и нагрузки тестовый проект** под **Visual C# | Тест** вкладки. Убедитесь, что **.NET Framework 4.5** — флажок установлен, назовите проект *WebAndLoadTestProject*, выберите **расположение** и нажмите кнопку **ОК**.

    ![Создание нового проекта веб- и нагрузочного теста](maintainable-azure-websites-managing-change-and-scale/_static/image80.png "создания нагрузочных тестов и веб-проекта")

    *Создание нового проекта веб- и нагрузочного теста*
3. В **WebTest1.webtest** щелкните правой кнопкой мыши **WebTest1** и выберите команду **добавить запрос**.

    ![Запрос на добавление WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image81.png "запрос на добавление WebTest1")

    *Запрос на добавление WebTest1*
4. В **свойства** окно нового узла запроса обновления **URL-адрес** свойство, чтобы указать URL-адрес веб-приложения (например  *[http://geek-quiz.azurewebsites.net/](http://geek-quiz.azurewebsites.net/)* ).

    ![Изменение свойства URL-адрес](maintainable-azure-websites-managing-change-and-scale/_static/image82.png "изменения свойства в URL-адрес")

    *Изменение свойства URL-адрес*
5. В **WebTest1.webtest** окно, щелкните правой кнопкой мыши **WebTest1** и нажмите кнопку **добавьте цикл...** .

    ![Добавление цикла WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image83.png "Добавление цикла WebTest1")

    *Добавление цикла WebTest1*
6. В **Добавьте условное правило и элементы в цикл** выберите **цикл For** правила и измените следующие свойства.

    1. **Дифференциальное значение:** 1000
    2. **Имя параметра контекста:** итератора
    3. **Значение приращения:** 1

    ![Выберите правило для цикла и обновление свойств](maintainable-azure-websites-managing-change-and-scale/_static/image84.png "выберите правило для цикла и обновление свойств")

    *Выберите правило для цикла и обновление свойств*
7. В разделе **элементы в цикле** выберите запрос, созданный ранее первого и последнего элемента для цикла. Нажмите кнопку **ОК** , чтобы продолжить.

    ![При выборе первый и последний элемент цикла](maintainable-azure-websites-managing-change-and-scale/_static/image85.png "при выборе первый и последний элемент цикла")

    *При выборе первый и последний элемент цикла*
8. В **обозревателе решений**, щелкните правой кнопкой мыши **WebAndLoadTestProject** проекта, разверните **добавить** и выбрать пункт **нагрузочного теста...** .

    ![Добавление нагрузочного теста в проект WebAndLoadTestProject](maintainable-azure-websites-managing-change-and-scale/_static/image86.png "Добавление в проект WebAndLoadTestProject нагрузочного теста")

    *Добавление в проект WebAndLoadTestProject нагрузочного теста*
9. В **мастера тестовой нагрузки** диалоговое окно, нажмите кнопку **Далее**.

    ![Мастер тестовой нагрузки](maintainable-azure-websites-managing-change-and-scale/_static/image87.png "мастера тестовой нагрузки")

    *Мастер тестовой нагрузки*
10. В **сценарий** выберите **не использовать время на обдумывание** и нажмите кнопку **Далее**.

    ![При выборе отказаться от использования времени на обдумывание](maintainable-azure-websites-managing-change-and-scale/_static/image88.png "при выборе отказаться от использования времени на обдумывание")

    *При выборе отказаться от использования времени на обдумывание*
11. В **шаблона нагрузки** убедитесь, что **постоянной нагрузки** выбран параметр. Изменение **число пользователей** параметру **250** пользователей и нажмите кнопку **Далее**.

    ![Изменение числа пользователей на 250](maintainable-azure-websites-managing-change-and-scale/_static/image89.png "изменение числа пользователей на 250")

    *Изменение числа пользователей на 250*
12. В **модель тестового набора** выберите **на основе порядка теста для последовательных** и нажмите кнопку **Далее**.

    ![Выбор модели тестового набора](maintainable-azure-websites-managing-change-and-scale/_static/image90.png "Выбор модели тестового набора")

    *Выбор модели тестового набора*
13. В **модель тестового набора** щелкните **добавить...**  для добавления в набор тестов.

    ![Добавление теста в тестовый набор](maintainable-azure-websites-managing-change-and-scale/_static/image91.png "Добавление теста в тестовый набор")

    *Добавление теста в тестовый набор*
14. В **добавить тесты** диалоговое окно, дважды щелкните **WebTest1** Чтобы добавить тест в **выбранные тесты** списка. Нажмите кнопку **ОК** , чтобы продолжить.

    ![Добавление теста WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image92.png "добавления WebTest1 теста")

    *Добавление теста WebTest1*
15. В **тестового набора** щелкните **Далее**.

    ![Завершение работы страница тестового набора](maintainable-azure-websites-managing-change-and-scale/_static/image93.png "завершение страница тестового набора")

    *Завершение работы страница тестового набора*
16. В **смешанного сетевого профиля** щелкните **Далее**.

    ![Нажав кнопку Далее на странице смешанного сетевого профиля](maintainable-azure-websites-managing-change-and-scale/_static/image94.png "нажатии кнопки рядом на странице смешанный сетевой профиль")

    *Нажмите кнопку Далее на странице смешанный сетевой профиль*
17. В **набора браузеров** выберите **Internet Explorer 10.0** тип браузера и нажмите **Далее**.

    ![При выборе типа обозревателя](maintainable-azure-websites-managing-change-and-scale/_static/image95.png "при выборе типа браузера")

    *Выбрав тип браузера*
18. В **наборы счетчиков** щелкните **Далее**.

    ![Нажав кнопку "Далее" на странице наборы счетчиков](maintainable-azure-websites-managing-change-and-scale/_static/image96.png "нажмите кнопку "Далее", на странице наборы счетчиков")

    *Нажав кнопку "Далее" на странице наборы счетчиков*
19. В **параметры запуска** задайте **длительность нагрузочного теста** для **5 минут** и нажмите кнопку **Готово**.

    ![Длительность нагрузочного теста установите значение 5 минут](maintainable-azure-websites-managing-change-and-scale/_static/image97.png "параметр длительность нагрузочного теста в 5 минут")

    *Длительность нагрузочного теста установите значение 5 минут*
20. В **обозревателе решений**, дважды щелкните **Local.settings** файл для просмотра параметров тестирования. По умолчанию Visual Studio использует локального компьютера для выполнения тестов.

    > [!NOTE]
    > Кроме того, можно настроить тестовый проект для выполнения нагрузочных тестов в облаке, используя **Visual Studio Online (VSO)**. VSO предоставляет Облачное нагрузочное тестирование службы, которая имитирует нагрузки более реалистичным, как избежать ограничений локальной среде, как ЦП, объем доступной памяти и пропускной способности сети. Дополнительные сведения об использовании VSO для запуска нагрузочных тестов см. в разделе [в этой статье](https://www.visualstudio.com/get-started/load-test-your-app-vs).

    ![Параметры тестирования](maintainable-azure-websites-managing-change-and-scale/_static/image98.png)

<a id="Ex5Task3"></a>
#### <a name="task-3--autoscale-verification"></a>Задача 3 – Проверка автоматического масштабирования

Необходимо выполнить нагрузочный тест, созданный в предыдущей задаче и увидеть, как ведет себя веб-приложения под нагрузкой.

1. В **обозревателе решений**, дважды щелкните **LoadTest1.loadtest** Открытие нагрузочного теста.

    ![Открытие LoadTest1.loadtest](maintainable-azure-websites-managing-change-and-scale/_static/image99.png "Открытие LoadTest1.loadtest")

    *Открытие LoadTest1.loadtest*
2. В **LoadTest1.loadtest** окно, нажмите первую кнопку на панели элементов для выполнения нагрузочного теста.

    ![Запуск нагрузочного теста](maintainable-azure-websites-managing-change-and-scale/_static/image100.png "нагрузочных тестов")

    *Запуск нагрузочного теста*
3. Дождитесь завершения нагрузочного теста.

    > [!NOTE]
    > Нагрузочный тест моделируется нескольких пользователей, которые одновременно отправлять запросы к веб-приложению. При выполнении теста, вы можете отслеживать доступные счетчики для обнаружения ошибок, предупреждений или другие сведения, относящиеся к запусков нагрузочных тестов.

    ![Загрузить тест будет выполняться](maintainable-azure-websites-managing-change-and-scale/_static/image101.png "дождаться завершения нагрузочного теста")

    *Нагрузочный тест будет выполняться*
4. После завершения теста, вернитесь на портал управления и перейдите к **шкалы** страницы веб-приложения. В разделе **емкость** раздел, вы увидите на графике новый экземпляр был развернут автоматически.

    ![Автоматическое развертывание нового экземпляра](maintainable-azure-websites-managing-change-and-scale/_static/image102.png)

    *Автоматическое развертывание нового экземпляра*

    > [!NOTE]
    > Он может занять несколько минут для изменения отображаются на диаграмме (нажмите клавишу **сочетание клавиш CTRL + F5** периодически, чтобы обновить страницу). Если вы не видите все изменения, то можно выполнить следующие действия:
    > 
    > - Увеличьте продолжительность нагрузочного теста (например, чтобы **10 минут**)
    > - Уменьшить максимальное и минимальное значения **целевой Процессор** диапазона в настройке автомасштабирования веб-приложения
    > - Запуск нагрузочного теста в облаке **Visual Studio Online**. Дополнительные сведения о [здесь](https://www.visualstudio.com/en-us/get-started/load-test-your-app-vs.aspx)

* * *

<a id="Summary"></a>
## <a name="summary"></a>Сводка

В этой практической вы узнали, как настроить и развернуть приложение в рабочей среде веб-приложений в Azure. Запущен путем обнаружения и обновления баз данных, используя **Entity Framework Code First Migrations**, затем продолжает, развернув узел с помощью новых версий **Git** и выполнения отката для Последняя стабильная версия веб-узла. Кроме того вы узнали, как масштабировать приложение с помощью хранилища для перемещения статического содержимого контейнера BLOB-объекта.
