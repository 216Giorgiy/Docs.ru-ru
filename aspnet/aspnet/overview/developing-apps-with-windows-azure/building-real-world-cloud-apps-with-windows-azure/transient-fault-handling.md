---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/transient-fault-handling
title: Transient Fault Handling (Создание реальных облачных приложений с Azure) | Документы Microsoft
author: MikeWasson
description: Построение реального мира облачными приложениями с помощью Azure электронная книга основан на разработанный Скотт Гатри презентации. Объясняет, 13 шаблоны и рекомендации, которые он может...
ms.author: aspnetcontent
manager: wpickett
ms.date: 11/03/2015
ms.topic: article
ms.assetid: 7ead83bc-c08c-4b26-8617-00e07292e35c
ms.technology: ''
ms.prod: .net-framework
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/transient-fault-handling
msc.type: authoredcontent
ms.openlocfilehash: 86bd67b04931ae2452f6e063e6475a434a0125bc
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="transient-fault-handling-building-real-world-cloud-apps-with-azure"></a>Transient Fault Handling (Создание реальных облачных приложений с Azure)
====================
по [Mike Wasson](https://github.com/MikeWasson), [Рик Андерсон](https://github.com/Rick-Anderson), [Tom Dykstra](https://github.com/tdykstra)

[Загрузка решение проект](http://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) или [Загрузите электронную](http://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)

> **Построение реального мира облачными приложениями с помощью Azure** электронная книга основана на представления, разработанный Скотт Гатри. Объясняются 13 шаблоны и рекомендации, которые помогут вам быть успешной разработки веб-приложений для облака. Сведения об электронных книг см. в разделе [первой главы](introduction.md).


При разработке реального облачного приложения, одна из задачи, которые нужно думать о — способ обработки временных перерывов в обслуживании. Эту проблему однозначно важно в облачных приложений, так как вы являетесь зависеть от сетевых подключений и внешние службы. Часто можно получить небольшими проблемами, которые обычно самовосстановление, и если вы не готовы обрабатывать их, они будут приводить сказываться на работе для ваших клиентов.

## <a name="causes-of-transient-failures"></a>Причины временных сбоев

Происходит периодически, в облачной среде вы найдете, сбой и удалении подключения к базе данных. Это отчасти потому, что используете через несколько подсистем балансировки нагрузки, по сравнению с локальной средой где веб-сервер и сервер базы данных имеют собой физическое соединение. Кроме того иногда в том случае, когда вы будете зависит от нескольких клиентов службы вы увидите вызовы get службы медленнее или истечения времени ожидания из-за того, кто использует службы попадание сильно. В других случаях может быть пользователь слишком часто попадание службы и службы намеренно регулирует вы — запрещает подключения — Чтобы избежать негативного воздействия других клиентов службы.

## <a name="use-smart-retryback-off-logic-to-mitigate-the-effect-of-transient-failures"></a>Использовать смарт-логику повторов и отсрочки, чтобы снизить влияние временных сбоев

Вместо создания исключения и отображать на странице не доступен или ошибка вашему клиенту, может распознавать ошибки, которые обычно являются временными и автоматически повторить операцию, которая привела к ошибке, в рассчитывает, перед долго будет успешной. В большинстве случаев операция будет выполнена успешно при повторной попытке и обеспечивает восстановление из-за ошибки без клиента, когда-либо будучи помнить, что возникла проблема.

Можно реализовать логику повторных попыток смарт-несколькими способами.

- Шаблоны Microsoft &amp; рекомендациям группа имеет [временных Fault Handling Application Block](https://msdn.microsoft.com/library/dn440719(v=pandp.60).aspx) , который выполняет все автоматически при использовании ADO.NET для доступа к базе данных SQL (не через Entity Framework). Можно просто задать политику для повторных попыток — сколько раз, чтобы повторить попытку запроса или команды и длительность ожидания между попытками — и переноса кода SQL в *с помощью* блока.

    [!code-csharp[Main](transient-fault-handling/samples/sample1.cs)]

    Также поддерживает TFH [кэша роли Azure](https://msdn.microsoft.com/library/windowsazure/dn386103.aspx) и [Service Bus](https://azure.microsoft.com/services/service-bus/).
- При использовании платформы Entity Framework вы обычно не работают непосредственно с подключениями SQL, поэтому нельзя использовать этот пакет, шаблоны и рекомендации, но Entity Framework 6 строит такая логика повторных попыток прямо в framework. Аналогичным образом укажите стратегию повторных попыток, а затем EF использует эта стратегия, каждый раз, когда он получает доступ к базе данных.

    Для использования этой функции в приложении устранения, что нужно сделать всего добавить класс, производный от *DbConfiguration* и включите логику повторных попыток.

    [!code-csharp[Main](transient-fault-handling/samples/sample2.cs)]

    Для исключения базы данных SQL, которые платформа определяет как обычно временные ошибки код, показанный указывает, что EF для повторения операции до 3 раз с экспоненциальной отсрочки задержки между повторными попытками и Максимальная задержка 5 секунд. Экспоненциальная означает, что после каждого повтора неудачных он ждет более длительный период времени, прежде чем повторить попытку. При сбое на трех попыток подряд он вызовет исключение. В следующем разделе о выключатели объясняется, почему нужно экспоненциальная и ограниченное число повторных попыток.

    При использовании в службе хранилища Azure, как приложение исправить не для больших двоичных объектов и API клиента хранилища .NET уже реализует логику тот же тип, может иметь аналогичные проблемы. Просто укажите политику повтора или даже не делать, если вы довольны параметры по умолчанию.

<a id="circuitbreakers"></a>
## <a name="circuit-breakers"></a>Выключатели

Существует несколько причин, почему вы не хотите повторить попытку слишком много раз слишком много времени в течение:

- Слишком много пользователей, постоянно повтора неудачных запросов может привести к снижению качества других пользователей. Если миллионы людей — это все, что повторяющиеся повторов запроса вы удалось продолжительный очереди диспетчера IIS и предотвращает обработку запросов, поскольку в противном случае может обрабатывать успешно приложения.
- Если все восстанавливается из-за сбоя службы, может быть так много запросов в очередь, служба получает переполняющее при запуске для восстановления.
- Если ошибка из-за регулирования и служба использует для регулирования временное окно, постоянной попыток удалось перемещение окна и вызвать регулирования для продолжения.
- Возможно, пользователь ожидания для веб-страницы к просмотру. Слишком много времени ожидания людей внесения может более раздражающих, относительно быстро о том, их, чтобы повторить попытку позже.

Экспоненциальная устраняет некоторые эти проблемы путем ограничения частоты повторов службы можно получить из приложения. Однако необходимо иметь *размыкатели*: это означает, что в определенный повторите пороговое значение приложении останавливает повтор и выполняет других действий, таких как один из следующих:

- Настраиваемый резервный. Если не удается получить цену акций из Reuters, может быть его можно получить на Bloomberg; или, если не удается получить данные из базы данных, может быть ее можно загрузить из кэша.
- Сбой автоматической. Если нужные сведения из службы не подразумевает для вашего приложения, просто возвращать значение null, если не удается получить данные. Если отображается задача ее исправить, а служба BLOB-объектов не отвечает, можно отобразить сведения о задаче без изображения.
- Быстрый отказ. Ошибка ожидания пользователя позволяет избежать перегрузки службы с retry запросов, которые могут привести к нарушению работы службы для других пользователей или расширить периода регулирования. Можно отобразить понятного сообщения «повторить попытку позже».

Нет политики универсальными повторных попыток. Можно повторить еще раз и ожидать больше в асинхронного фонового рабочего процесса, чем в синхронные веб-приложения, где пользователь ожидает ответа. Можно отложить больше между попытками служба реляционных баз данных, чем для службы кэша. Ниже приведены некоторые образцы рекомендуется повторить политики помогут понять, как числа могут быть различными. («Быстрое первый» означает отсутствие задержки перед первой повторной попытки.

![Образец политик повторных попыток](transient-fault-handling/_static/image1.png)

Инструкции политики повтора базы данных SQL см. [Устранение временных сбоев и ошибок подключения к базе данных SQL](https://azure.microsoft.com/documentation/articles/sql-database-connectivity-issues/).

## <a name="summary"></a>Сводка

Стратегии повторов и отсрочки помогают сделать временные ошибки невидимыми для клиента большую часть времени, и корпорация Майкрософт предоставляет платформ, которые можно использовать, чтобы свести к минимуму работу реализации стратегии при использовании ADO.NET Entity Framework и Azure Служба хранилища.

В [следующей главе](distributed-caching.md), мы рассмотрим способы повышения производительности и надежности с помощью распределенное кэширование.

## <a name="resources"></a>Ресурсы

Дополнительные сведения см. в следующих ресурсах:

Документация

- [Советы и рекомендации по проектированию крупномасштабных служб в облачных службах Azure](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx). Технический документ, Марк Симмс и Майкл Томасси. Аналогично Безаварийность рядов, но переход в Дополнительные практические сведения. В разделе телеметрии и диагностики.
- [Отказоустойчивость: Руководство по гибкой облачной архитектуре](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx). Технический документ по Marc Mercuri, Ульрих Хоманн и Эндрю Таунхилл. Версия веб-страницы серия видеоматериалов Безаварийность.
- [Шаблоны и методики - руководство по Azure Майкрософт](https://msdn.microsoft.com/library/dn568099.aspx). В разделе "Повторить" шаблона, шаблон начальника агента планировщика.
- [Отказоустойчивость в базе данных Azure SQL](https://blogs.msdn.com/b/windowsazure/archive/2012/07/30/fault-tolerance-in-windows-azure-sql-database.aspx). Запись блога по Tony Petrossian.
- [Entity Framework — устойчивость подключений и логика повторных попыток](https://msdn.microsoft.com/data/dn456835). Как использовать и настраивать transient fault handling функции Entity Framework 6.
- [Устойчивость подключения и команды перехвата с платформой Entity Framework в приложении ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/connection-resiliency-and-command-interception-with-the-entity-framework-in-an-asp-net-mvc-application.md). Четвертый в ряде девять частей учебника показано, как настроить EF 6 функция устойчивости подключений для базы данных SQL.

Видеоролики

- [Отказоустойчивость: Построение масштабируемых, надежных облачные службы](https://channel9.msdn.com/Series/FailSafe). Девять выпусков, Ульрих Хоманн, Marc Mercuri и Марк Симмс. Представляет высокоуровневых концепциях и принципов архитектуры в виде очень доступна и интересные истории, полученными в результате Advisory Team Microsoft клиентов (CAT) опыт работы с фактических клиентов. В описании выключатели в серии 3, начиная с 40:55.
- [Построение Big: Уроках, извлеченных из клиентам Azure — часть II](https://channel9.msdn.com/Events/Build/2012/3-030). Марк Симмс обсуждения о разработке для сбоя, временные ошибки обработки и инструментирования приложений, все данные.

Образец кода

- [Основы облачных служб в Azure](https://code.msdn.microsoft.com/Cloud-Service-Fundamentals-4ca72649). Образец приложения, созданные в Microsoft Azure группа консультантов по, демонстрирует использование [Enterprise библиотеки блок обработки временных сбоев](http://nuget.org/packages/EnterpriseLibrary.TransientFaultHandling/) (TFH). Дополнительные сведения см. в разделе [облачной службы основы уровня доступа к данным — обработка временных сбоев](https://social.technet.microsoft.com/wiki/contents/articles/18665.cloud-service-fundamentals-data-access-layer-transient-fault-handling.aspx). TFH рекомендуется использовать для доступа к базе данных с помощью ADO.NET напрямую (без использования платформы Entity Framework).

> [!div class="step-by-step"]
> [Назад](monitoring-and-telemetry.md)
> [Вперед](distributed-caching.md)
