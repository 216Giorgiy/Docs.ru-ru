---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/automate-everything
title: "Автоматизация все компоненты (Создание реальных облачных приложений с Azure) | Документы Microsoft"
author: MikeWasson
description: "Построение реального мира облачными приложениями с помощью Azure электронная книга основан на разработанный Скотт Гатри презентации. Объясняет, 13 шаблоны и рекомендации, которые он может..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/12/2014
ms.topic: article
ms.assetid: ba6e6baa-9b9f-471f-b39d-b007a3addadc
ms.technology: 
ms.prod: .net-framework
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/automate-everything
msc.type: authoredcontent
ms.openlocfilehash: cf1cb7b07ffe8750724e58e4fb66854c9a033a54
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="automate-everything-building-real-world-cloud-apps-with-azure"></a>Автоматизация все компоненты (Создание реальных облачных приложений с Azure)
====================
по [Mike Wasson](https://github.com/MikeWasson), [Рик Андерсон](https://github.com/Rick-Anderson), [Tom Dykstra](https://github.com/tdykstra)

[Загрузка решение проект](http://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) или [Загрузите электронную](http://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)

> **Построение реального мира облачными приложениями с помощью Azure** электронная книга основана на представления, разработанный Скотт Гатри. Объясняются 13 шаблоны и рекомендации, которые помогут вам быть успешной разработки веб-приложений для облака. Введение электронных книг см. в разделе [первой главы](introduction.md).


Первые три закономерности, которые мы рассмотрим применяют любой проект разработки программного обеспечения, но особенно облачных проектах. Этот шаблон является об автоматизации задач разработки. Это важная тема, так как ручные процессы медленным и ненадежным; Автоматизация столько их в качестве возможных помогает настройки быстрый, надежный и гибкой разработки рабочего процесса. Очень важно уникально для разработки облачных приложений так, как легко можно автоматизировать многие задачи, которые слишком сложно или невозможно автоматизировать в локальной среде. Например, можно настроить всего теста сред, включая новый веб-сервера и внутреннего интерфейса виртуальные машины, базы данных, больших двоичных объектов хранилища (хранилище файлов), очередей, и т. д.

## <a name="devops-workflow"></a>Рабочий процесс DevOps

Все чаще вы слышите термин «DevOps.» Термин, разработанный за пределы признать, что нужно интегрировать задачах разработки и эксплуатации для эффективной разработки программного обеспечения. Тип рабочего процесса, который вы хотите включить — один, в котором вы можно разработки приложения, развернуть его, узнать из производственного использования его, измените его в ответ на полученные знания и повторения цикла быстрой и надежной.

Некоторые команды разработчиков эффективное облако развернуть несколько раз в день в динамической среде. Команды Azure, используемый для развертывания основной обновлять каждые 2-3 месяцев, но теперь выпуски незначительными обновлениями, каждые 2 – 3 дня и основной освобождает каждые 2-3 недель. Получение в последовательность, действительно помогает отреагирует на отзывы клиентов.

Чтобы сделать это, необходимо включить в цикл разработки и развертывания, который repeatable, надежная и прогнозируемый, а имеет время низкой цикла.

![Рабочий процесс DevOps](automate-everything/_static/image1.png)

Другими словами период времени между при наличии сведений для функции и при его использования и предоставления отзывов клиентов должен быть как можно более коротким. В первых трех шаблонов — автоматизации все системы управления версиями, и непрерывной интеграции и доставки — относятся все рекомендации, которые корпорация Майкрософт рекомендует, чтобы включить этот тип процесса.

## <a name="azure-management-scripts"></a>Сценарии управления Azure

В [введение в электронных книг](introduction.md), вы видели, веб-консоли, портала управления Azure. На портале управления позволяет отслеживать и контролировать все ресурсы, которые были развернуты в Azure. Это простой способ создания и удаления службы, такие как веб-приложениями и виртуальными машинами, настройте эти службы, наблюдения за работой службы и пр. Это мощный инструмент, но с его помощью выполняется вручную. Если вы собираетесь разработки производственного приложения любого размера, и особенно в среде рабочей группы, мы рекомендуем перейти на портале пользовательского интерфейса для изучения и исследовать Azure и затем автоматизировать процессы, которые вы будете делать несколько раз.

Практически все, что можно сделать вручную на портале управления или из Visual Studio можно сделать путем вызова API управления REST. Можно записать сценарии, с помощью [Windows PowerShell](https://msdn.microsoft.com/en-us/library/windowsazure/jj156055.aspx), или можно использовать это платформа с открытым исходным кодом, такие как [Chef](http://www.opscode.com/chef/) или [Puppet](http://puppetlabs.com/puppet/what-is-puppet). Можно также использовать средство командной строки Bash в среде Mac или Linux. Azure имеет сценариев API-интерфейсы для этих различных сред и его [API-интерфейса управления .NET](http://www.hanselman.com/blog/PennyPinchingInTheCloudAutomatingEverythingWithTheWindowsAzureManagementLibrariesAndNET.aspx) в случае, если требуется написать код, а не скрипт.

Для приложения исправить мы создали некоторые сценарии Windows PowerShell для автоматизации процессов Создание тестовой среде и развертывание проекта в этой среде, и мы рассмотрим некоторые содержимое этих сценариев.

## <a name="environment-creation-script"></a>Скрипт создания среды

Первый сценарий, мы рассмотрим называется *New AzureWebsiteEnv.ps1*. Он создает среду Azure, можно развернуть ее исправить для тестируемого приложения. Ниже перечислены основные задачи, которые выполняет этот скрипт.

- Создайте веб-приложение.
- Создайте учетную запись хранилища. (Требуется для больших двоичных объектов и очередей, как вы увидите в последующих главах).
- Создание сервера базы данных SQL и две базы данных: базы данных приложения и базы данных членства.
- Сохраните параметры в Azure, что приложение будет использовать для доступа к учетной записи хранения и баз данных.
- Создайте файлы параметров, которые будут использоваться для автоматизации развертывания.

### <a name="run-the-script"></a>Запустите сценарий


> [!NOTE]
> В этой части раздела приведены примеры сценариев и команд, введенных для их работы. Этот демонстрационный ролик и не предоставляет все, что нужно знать, чтобы выполнить эти сценарии. Пошаговые инструкции инструкциями-в-it см [приложение: исправьте его образец приложения](the-fix-it-sample-application.md#deploybase).


Для выполнения сценария PowerShell, который управляет служб Azure необходимо установить консоль Azure PowerShell и настроить его для работы с вашей подпиской Azure. После настройки нужных параметров можно выполнить ее исправить среды создания скрипт с помощью команды, похожее на следующее:

`.\New-AzureWebsiteEnv.ps1 -Name <websitename> -SqlDatabasePassword <password>`

`Name` Параметр указывает имя для использования при создании учетных записей базы данных и хранилища и `SqlDatabasePassword` указывает пароль для учетной записи администратора, который будет создан для базы данных SQL. Существуют другие параметры, которые можно использовать, мы рассмотрим позже.

![Окно PowerShell](automate-everything/_static/image2.png)

По завершении сценария вы увидите в на портале управления, что было создано. Вы найдете две базы данных:

![Базы данных](automate-everything/_static/image3.png)

Учетная запись хранения:

![Учетная запись хранения](automate-everything/_static/image4.png)

И веб-приложения:

![Веб-сайт](automate-everything/_static/image5.png)

На **Настройка** вкладку веб-приложения вы обнаружила, что он имеет параметры учетной записи хранилища и строки подключения к базе данных SQL для установки исправления его приложения.

![appSettings и connectionStrings](automate-everything/_static/image6.png)

*Автоматизации* теперь содержатся  *&lt;websitename&gt;.pubxml* файла. Этот файл содержит параметры, MSBuild будет использовать для развертывания приложения в среде Azure, который был только что создан. Пример:

[!code-xml[Main](automate-everything/samples/sample1.xml)]

Как видите, скрипт создан в среде выполнения теста и весь процесс выполняется в около 90 секунд.

Если кто-то другой команды хочет создать тестовую среду, они просто запустите скрипт. Не только происходит быстро, но также они могут быть уверены, что они используют не отличается от используемой среды. Не удалось выполнить довольно как уверенным, если все Настройка вручную с помощью портала управления пользовательского интерфейса.

### <a name="a-look-at-the-scripts"></a>Рассмотрим скриптов

Существует фактически трех сценариев, работающих. Вызывается один из командной строки и автоматически использует две другие кнопки для выполнения некоторых задач:

- *Новый AzureWebSiteEnv.ps1* является основной скрипт.

    - *Новый AzureStorage.ps1* создает учетную запись хранения.
    - *Новый AzureSql.ps1* создает базы данных.

### <a name="parameters-in-the-main-script"></a>Параметры в основной скрипт

Основной скрипт *New AzureWebSiteEnv.ps1*, определяет несколько параметров:

[!code-powershell[Main](automate-everything/samples/sample2.ps1)]

Требуются два параметра:

- Имя веб-приложения, который создает скрипт. (Это также используется для URL-адрес: `<name>.azurewebsites.net`.)
- Пароль для нового администратора сервера базы данных, который создает скрипт.

Необязательные параметры позволяют указать расположение центра обработки данных (по умолчанию «Западная часть США»), имя администратора сервера базы данных (по умолчанию «dbuser») и правила брандмауэра для сервера базы данных.

### <a name="create-the-web-app"></a>Создать веб-приложение

Первое, что сценарий выполняет — создание веб-приложения путем вызова `New-AzureWebsite` командлета, передав в него веб-приложения имя и расположение значения параметров:

[!code-powershell[Main](automate-everything/samples/sample3.ps1?highlight=2)]

### <a name="create-the-storage-account"></a>Создать учетную запись хранения

Основной скрипт выполняет *New AzureStorage.ps1* скрипта, указав "*&lt;websitename&gt;*хранилища» для имени учетной записи хранилища и те же данные цеха как веб-приложения.

[!code-powershell[Main](automate-everything/samples/sample4.ps1?highlight=3)]

*Новый AzureStorage.ps1* вызовы `New-AzureStorageAccount` для создания учетной записи хранилища, который возвращает учетную запись, имя и доступа к значения ключа. Приложения должны эти значения для доступа к большим двоичным объектам и очередям в учетной записи хранения.

[!code-powershell[Main](automate-everything/samples/sample5.ps1?highlight=2)]

Не всегда можно создать новую учетную запись хранения; скрипт может улучшить, добавив параметр, который направляет его на использование существующей учетной записи хранения при необходимости.

### <a name="create-the-databases"></a>Создание баз данных

Основной скрипт запускает скрипт создания базы данных, *New AzureSql.ps1*, после настройки базы данных по умолчанию и имена правил брандмауэра:

[!code-powershell[Main](automate-everything/samples/sample6.ps1)]

[!code-powershell[Main](automate-everything/samples/sample7.ps1?highlight=2)]

Скрипт создания базы данных получает IP-адреса компьютера разработки и задает правило брандмауэра, чтобы компьютер разработки можно подключиться и управления сервером. Скрипт создания базы данных, затем проходит через несколько шагов для настройки баз данных:

- Создает сервер с помощью `New-AzureSqlDatabaseServer` командлета.

    [!code-powershell[Main](automate-everything/samples/sample8.ps1?highlight=1)]
- Создает правила брандмауэра, чтобы включить на компьютере разработки для управления сервером и включения веб-приложения для подключения к нему. 

    [!code-powershell[Main](automate-everything/samples/sample9.ps1?highlight=3,5)]
- Создает контекст базы данных, которая включает имя сервера и учетные данные, с помощью `New-AzureSqlDatabaseServerContext` командлета.

    [!code-powershell[Main](automate-everything/samples/sample10.ps1?highlight=4)]

    `New-PSCredentialFromPlainText`Это функция в скрипт, который вызывает `ConvertTo-SecureString` командлет для шифрования пароля и возвращает `PSCredential` объект того же типа, который `Get-Credential` командлетом.
- Создает базу данных приложения и базы данных членства с помощью `New-AzureSqlDatabase` командлета.

    [!code-powershell[Main](automate-everything/samples/sample11.ps1?highlight=2,5)]
- Вызывает tocreates локально определенная функция строку подключения для каждой базы данных. Приложение будет использовать эти строки подключения для доступа к базе данных. 

    [!code-powershell[Main](automate-everything/samples/sample12.ps1?highlight=1-2)]

    Get-SQLAzureDatabaseConnectionString является функция, определенная в скрипт, который создает строку подключения из значения параметра, переданные в него.

    [!code-powershell[Main](automate-everything/samples/sample13.ps1?highlight=1)]
- Возвращает хэш-таблицу с именем сервера базы данных и строки подключения.

    [!code-powershell[Main](automate-everything/samples/sample14.ps1)]

Приложение ее исправить использует отдельные членства и базы данных приложения. Можно также поместить данные членства и приложения в одной базе данных.

### <a name="store-app-settings-and-connection-strings"></a>Для хранения параметров приложения и строки подключения

Azure имеется функция, которая позволяет хранить и строки подключения, которые автоматически переопределяют возвращаемые приложению при попытке чтения `appSettings` или `connectionStrings` коллекций в файле Web.config. Это является альтернативой применение [преобразования Web.config](../../../../web-forms/overview/deployment/visual-studio-web-deployment/web-config-transformations.md) во время развертывания. Дополнительные сведения см. в разделе [хранить конфиденциальные данные в Azure](source-control.md#appsettings) далее в этой книге e.

Сохраняет скрипт создания среды в Azure все `appSettings` и `connectionStrings` значения, необходимые приложению для доступа к учетной записи хранения и баз данных, когда оно работает в Azure.

[!code-powershell[Main](automate-everything/samples/sample15.ps1)]

[!code-powershell[Main](automate-everything/samples/sample16.ps1)]

[!code-powershell[Main](automate-everything/samples/sample17.ps1?highlight=2)]

[New Relic](http://newrelic.com/) — это платформа телеметрии, показывается в [мониторинг и данные телеметрии](monitoring-and-telemetry.md) главы. Скрипт создания среды также перезапускает веб-приложения, убедитесь, что он выбирает параметры New Relic.

[!code-powershell[Main](automate-everything/samples/sample18.ps1?highlight=2)]

### <a name="preparing-for-deployment"></a>Подготовка к развертыванию

В конце процесса скрипт создания среда вызывает две функции для создания файлов, которые будут использоваться с помощью сценария развертывания.

Один из этих функций создает профиль публикации *(&lt;websitename&gt;.pubxml* файла). Код вызывает API REST Azure, чтобы получить параметры публикации, и сохраняет данные в *.publishsettings* файла. Затем она использует сведения из этого файла вместе с файлом шаблона (*pubxml.template*) для создания *.pubxml* файл, содержащий профиль публикации. Это двухэтапный процесс имитирует возможностях Visual Studio: загрузить *.publishsettings* файл и импортировать, чтобы создать профиль публикации.

Другая функция использует другого файла шаблона (веб-сайт environment.template) для создания *веб-сайт environment.xml* файла, содержащего параметры скрипта развертывания будет использоваться вместе с *.pubxml*файла.

### <a name="troubleshooting-and-error-handling"></a>Устранение неполадок и обработка ошибок

Сценарии, как программы: они могут завершиться ошибкой, и при этом необходимо знать настолько, насколько можно о сбое и его причины. По этой причине сценарий создания среды изменяет значение `VerbosePreference` переменную `SilentlyContinue` для `Continue` так, чтобы отображались все подробные сообщения. Он также изменяет значение `ErrorActionPreference` переменную `Continue` для `Stop`, так что сценарий останавливается, даже когда он встречает устранимые ошибки:

[!code-powershell[Main](automate-everything/samples/sample19.ps1)]

Перед этим какой-либо работы, сценарий сохраняет время начала, чтобы его можно вычислить общее затраченное время, при завершении:

[!code-powershell[Main](automate-everything/samples/sample20.ps1)]

После завершения работы, сценарий отображает затраченное время:

[!code-powershell[Main](automate-everything/samples/sample21.ps1)]

И для каждой операции ключа скрипт записывает подробные сообщения, например:

[!code-powershell[Main](automate-everything/samples/sample22.ps1)]

## <a name="deployment-script"></a>Сценарий развертывания

Что *New AzureWebsiteEnv.ps1* сценарий выполняет для создания среды *AzureWebsite.ps1 публикации* сценарий выполняет для развертывания приложения.

Скрипт развертывания получает имя веб-приложения из *environment.xml веб-сайт* файла, созданного скрипта создания среды.

[!code-powershell[Main](automate-everything/samples/sample23.ps1)]

Он получает пароль пользователя развертывания из *.publishsettings* файла:

[!code-powershell[Main](automate-everything/samples/sample24.ps1)]

Он выполняет [MSBuild](http://msbuildbook.com/) команду, которая строит и развертывает проект:

[!code-powershell[Main](automate-everything/samples/sample25.ps1)]

И если вы указали `Launch` параметр в командной строке, он вызывает `Show-AzureWebsite` командлет, чтобы открыть браузер по умолчанию для URL-адрес веб-сайта.

[!code-powershell[Main](automate-everything/samples/sample26.ps1?highlight=3)]

Сценарий развертывания с помощью команды, похожее на следующее:

`.\Publish-AzureWebsite.ps1 ..\MyFixIt\MyFixIt.csproj -Launch`

И при завершении его в браузере будет открыта с сайта, работающими в облаке на `<websitename>.azurewebsites.net` URL-адрес.

![Решение приложение, развернутое в Windows Azure](automate-everything/_static/image7.png)

## <a name="summary"></a>Сводка

С помощью этих скриптов можно быть уверенным, что те же шаги всегда будет выполняться в том же порядке, используя те же параметры. Это помогает убедиться, что каждый разработчик в команде не пропущено ничего или что-нибудь перепутать или что-либо пользовательские на своей машине, может не работать фактически так же, как в среде другой член команды или в рабочей среде развертывания.

Аналогичным образом можно автоматизировать наиболее Azure функций управления, которые можно выполнять на портале управления с помощью API-интерфейса REST, сценарии Windows PowerShell, язык .NET API или Bash служебную программу, которая можно запускать на Linux или Mac.

В [следующей главе](source-control.md) мы рассмотрим исходного кода и объясняется, почему важно включить скрипты в репозитория исходного кода.

## <a name="resources"></a>Ресурсы

- [Установка и настройка Windows PowerShell для Azure](https://docs.microsoft.com/powershell/azure/overview?view=azurermps-4.3.1). Объясняет, как установить командлеты Azure PowerShell и установка сертификата, что вы должны на компьютере, чтобы управлять Azure учетную запись. Это лучшее место, чтобы приступить к работе, так как он также содержит ссылки на ресурсы для обучения работе с PowerShell сам.
- [Центр сценариев Azure](https://docs.microsoft.com/azure/automation/automation-runbook-gallery). Портал WindowsAzure.com ресурсы для разработки сценариев, управляющих служб Azure, со ссылками на начало работы учебники, командлет Справочник по документации и исходный код и примеры сценариев
- [Выходные дни-Scripter: Приступая к работе с Azure и PowerShell](http://blogs.technet.com/b/heyscriptingguy/archive/2013/06/22/weekend-scripter-getting-started-with-windows-azure-and-powershell.aspx). В блоге, предназначенный для Windows PowerShell этой записи обеспечивает значительные введение в использование PowerShell для функций управления Azure.
- [Установка и настройка Azure межплатформенного интерфейса командной строки](https://docs.microsoft.com/cli/azure/install-azure-cli?view=azure-cli-latest). Приступая к работе учебник платформу Azure сценария, работающего на Mac и Linux, а также Windows систем.
- [Средства командной строки раздела загрузки Azure SDK и средства](https://azure.microsoft.com/downloads/). Страница портала для документации и загружаемые компоненты для средства командной строки для Azure.
- [Автоматизация все данные с помощью библиотеки управления Azure и .NET](http://www.hanselman.com/blog/PennyPinchingInTheCloudAutomatingEverythingWithTheWindowsAzureManagementLibrariesAndNET.aspx). Скотт Хансельман предоставляет API управления .NET для Azure.
- [С помощью скриптов Windows PowerShell для публикации в среды разработки и тестирования](https://msdn.microsoft.com/library/azure/dn642480.aspx). Содержит сведения об использовании документации MSDN публикации скриптов, которые Visual Studio автоматически создает для веб-проектов.
- [Инструменты PowerShell для Visual Studio 2013](https://visualstudiogallery.msdn.microsoft.com/c9eb3ba8-0c59-4944-9a62-6eee37294597). Расширение Visual Studio добавляет поддержку языка для Windows PowerShell в Visual Studio.

>[!div class="step-by-step"]
[Назад](introduction.md)
[Вперед](source-control.md)
