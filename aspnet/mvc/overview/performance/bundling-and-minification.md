---
uid: mvc/overview/performance/bundling-and-minification
title: "Объединение и Минификация | Документы Microsoft"
author: Rick-Anderson
description: "Объединение и Минификация — это два метода можно использовать в ASP.NET 4.5 для уменьшения времени загрузки для запроса. Объединение и Минификация сокращает время загрузки reducin..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/23/2012
ms.topic: article
ms.assetid: 5894dc13-5d45-4dad-8096-136499120f1d
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/performance/bundling-and-minification
msc.type: authoredcontent
ms.openlocfilehash: e83be2446ef1e3ff1275d06d5b743fb5b9444a6a
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="bundling-and-minification"></a>Объединение и Минификация
====================
По [Рик Андерсон](https://github.com/Rick-Anderson)

> Объединение и Минификация — это два метода можно использовать в ASP.NET 4.5 для уменьшения времени загрузки для запроса. Объединение и Минификация повышает время загрузки, уменьшая число запросов к серверу и уменьшения размера запрошенных ресурсов (например, CSS и JavaScript.)


Большая часть текущего основные обозреватели ограничить число [одновременных подключений](http://www.browserscope.org/?category=network) на каждого имени узла до 6. Это означает, что во время обработки запросов на шесть дополнительных запросов для ресурсов на узле будут помещены в очередь с помощью браузера. На приведенном ниже рисунке вкладки сети средств разработчика IE F12 показано время для активы, необходимые для представления о программе образца приложения.

![B И M](bundling-and-minification/_static/image1.png)

Серые линии показывают время, запрос помещается в очередь ожидание предел для числа подключений шесть браузером. Желтая панель — это запрос время до получения первого байта, то есть время, затраченное на отправку запроса и получения первого ответа с сервера. Синие полосы отобразить время, затраченное на получение данных ответа от сервера. Вы можете дважды щелкнуть актива для получения подробных сведений. Например, на следующем рисунке показана сведений о времени для загрузки */Scripts/MyScripts/JavaScript6.js* файла.

![](bundling-and-minification/_static/image2.png)

В предыдущем показано изображение **запуск** событие, которое содержит время запроса в очередь из-за браузер ограничить число одновременных подключений. В этом случае запрос в очередь и 46 миллисекунд ожидания завершения другого запроса.

## <a name="bundling"></a>Объединение

Объединение — это новая функция в ASP.NET 4.5, упрощающий для объединения или объединить несколько файлов в один файл. Можно создать CSS, JavaScript и другие пакеты. Меньшее число файлов означает, что меньшее количество HTTP-запросов, которые может повысить производительность нагрузки первой страницы.

Ниже приведен одинаковое представление времени представление о программе показано ранее, но на этот раз с объединение и Минификация включена.

![](bundling-and-minification/_static/image3.png)

## <a name="minification"></a>Минификации

Минификации выполняет различные оптимизации кода различных сценариев или css, например удаления лишних пробелов и комментарии и сократить имена переменных в один символ. Рассмотрим следующую функцию JavaScript.

[!code-javascript[Main](bundling-and-minification/samples/sample1.js)]

После минификации функция сокращается до следующее:

[!code-javascript[Main](bundling-and-minification/samples/sample2.js)]

Помимо удаление комментариев и ненужные пробелы, следующие параметры и имена переменных были переименованы (сокращено) следующим образом:

| **Исходный текст** | **Переименовать** |
| --- | --- |
| imageTagAndImageID | n |
| в пределах изображения | т |
| imageElement | i |

## <a name="impact-of-bundling-and-minification"></a>Влияние объединение и Минификация

Ниже приведены несколько важных различий между все активы по отдельности и объединение и Минификация (B и M) в программу данного образца.

|  | **С помощью B и M** | **Без B и M** | **Изменение** |
| --- | --- | --- | --- |
| **Запросы файлов** | 9 | 34 | 256% |
| **Отправлено КБ** | 3.26 | 11.92 | 266% |
| **Получено КБ** | 388.51 | 530 | 36% |
| **Время загрузки** | 510 MS | 780 MS | 53% |

Отправлено байт было значительное сокращение с объединением как браузеры довольно verbose с заголовками HTTP, к которому они применяются в запросах. Сокращение полученные байты не большего размера из-за самых больших файлов (*Scripts\jquery-ui-1.8.11.min.js* и *Scripts\jquery-1.7.1.min.js*) уже уменьшено. Примечание: Затраты времени на образец программы, используемой [Fiddler](http://www.fiddler2.com/fiddler2/) средства для имитации медленной сети. (Из Fiddler **правила** последовательно выберите пункты **производительности** затем **имитировать скоростей**.)

## <a name="debugging-bundled-and-minified-javascript"></a>Отладка объединено и уменьшена JavaScript

Можно легко выполнить отладку JavaScript в среде разработки (где [компиляции элемент](https://msdn.microsoft.com/en-us/library/s10awwz0.aspx) в *Web.config* файла задано значение `debug="true"` ) потому, что файлы JavaScript не поставляются в пакете или уменьшена. Можно также отлаживать сборку выпуска, где объединяются в один пакет и уменьшена файлы JavaScript. С помощью средств разработчика IE F12, отладке, функция JavaScript, включенные в уменьшенный пакет, используя следующий подход:

1. Выберите **сценарий** и затем выберите **начать отладку** кнопки.
2. Выберите пакет, в котором необходимо выполнить отладку с помощью кнопки активы функция JavaScript.  
    ![](bundling-and-minification/_static/image4.png)
3. Формат уменьшенный JavaScript, выбрав **кнопка конфигурации** ![](bundling-and-minification/_static/image5.png), а затем выбрав **формат JavaScript**.
4. В **сценария поиска** t поле ввода, выберите имя функции, который требуется отладить. На следующем рисунке **AddAltToImg** был введен в **сценария поиска** t поля ввода.  
    ![](bundling-and-minification/_static/image6.png)

Дополнительные сведения об отладке с помощью средств разработчика F12, см. в статье MSDN [с помощью средств разработчика F12 для отладки ошибок JavaScript](https://msdn.microsoft.com/en-us/library/ie/gg699336(v=vs.85).aspx).

## <a name="controlling-bundling-and-minification"></a>Управляющий объединение и Минификация

Объединение и Минификация включен или отключен, установив значение атрибута отладки в [компиляции элемент](https://msdn.microsoft.com/en-us/library/s10awwz0.aspx) в *Web.config* файла. В следующем XML `debug` задано значение true, объединение и Минификация отключена.

[!code-xml[Main](bundling-and-minification/samples/sample3.xml?highlight=2)]

Чтобы включить объединение и Минификация, задайте `debug` значение «false». Можно переопределить *Web.config* с `EnableOptimizations` свойство `BundleTable` класса. Следующий код обеспечивает объединение и Минификация и переопределяет любые значения параметров в *Web.config* файла.

[!code-csharp[Main](bundling-and-minification/samples/sample4.cs?highlight=7)]

> [!NOTE]
> Если не `EnableOptimizations` — `true` или атрибут debug в [компиляции элемент](https://msdn.microsoft.com/en-us/library/s10awwz0.aspx) в *Web.config* файла задано значение `false`, файлы не будет включаться или уменьшена. Кроме того не будет использоваться .min версию файлов, будут выбираться полных отладочных версий. `EnableOptimizations`переопределяет атрибут debug в [компиляции элемент](https://msdn.microsoft.com/en-us/library/s10awwz0.aspx) в *Web.config* файла


## <a name="using-bundling-and-minification-with-aspnet-web-forms-and-web-pages"></a>С помощью объединение и Минификация с веб-форм ASP.NET и веб-страницы

- Для веб-страниц см. в записи блога [Добавление веб-оптимизация для веб-страниц сайта](https://blogs.msdn.com/b/rickandy/archive/2012/08/15/adding-web-optimization-to-a-web-pages-site.aspx).
- Для веб-формы, см. в записи блога [Добавление объединение и Минификация для веб-форм](https://blogs.msdn.com/b/rickandy/archive/2012/08/14/adding-bundling-and-minification-to-web-forms.aspx).

## <a name="using-bundling-and-minification-with-aspnet-mvc"></a>С помощью объединение и Минификация с ASP.NET MVC

В этом разделе мы создадим ASP.NET MVC проекта для проверки объединение и Минификация. Во-первых, создайте новый проект ASP.NET MVC Интернета с именем **MvcBM** без изменения все значения по умолчанию.

Откройте *приложения\_Start\BundleConfig.cs* файл и проверьте `RegisterBundles` метод, который используется для создания и настройки пакетов. В следующем коде показано часть `RegisterBundles` метод.

[!code-csharp[Main](bundling-and-minification/samples/sample5.cs)]

Приведенный выше код создает новый пакет JavaScript с именем *~/bundles/jquery* , включающего все соответствующие (являющийся отладки или уменьшена, но не. *vsdoc*) файлы в *сценариев* , соответствующие подстановочному знаку строку «.js ~/Scripts/jquery-{version}». Для ASP.NET MVC 4, это означает отладочной конфигурации файла *jquery 1.7.1.js* будут добавлены в пакет. В конфигурации выпуска *jquery 1.7.1.min.js* будут добавлены. Объединение framework соглашениям несколько распространенных такие как:

- Выбрав файл «.min» для выпуска, если существуют «FileX.min.js» и «FileX.js».
- Выбор версии не «.min» для отладки.
- Пропуск «-vsdoc» файлы (например jquery-1.7.1-vsdoc.js), которые используются только технологией IntelliSense.

`{version}` Показанный выше сопоставление шаблонов используется для автоматического создания пакета jQuery с соответствующей версией jQuery в вашей *сценариев* папки. В этом примере с помощью подстановочного знака предоставляет следующие преимущества:

- Позволяет использовать NuGet для обновления до более новой версии jQuery, без изменения кода выше объединение или jQuery ссылки на страницах представления.
- Автоматически выбирает полную версию для конфигураций отладки и версии «.min» для версии сборок.

## <a name="using-a-cdn"></a>Использование CDN

 Следующий код заменяет пакет jQuery локальный пакет jQuery CDN.

[!code-csharp[Main](bundling-and-minification/samples/sample6.cs)]

В приведенном выше коде jQuery будет запрашиваться из сети CDN, а в выпуске режим и отладочная версия jQuery будут выбираться локально в режиме отладки. При использовании CDN, должно иметь резервный механизм в случае сбоя запроса CDN. В конце макета файла показан сценарий, добавленный запросить jQuery следует CDN fail фрагмент следующую разметку.

[!code-cshtml[Main](bundling-and-minification/samples/sample7.cshtml?highlight=5-13)]

## <a name="creating-a-bundle"></a>Создание пакета

[Пакета](https://msdn.microsoft.com/en-us/library/system.web.optimization.bundle(v=VS.110).aspx) класса `Include` метод принимает массив строк, где каждая строка является виртуальный путь к ресурсу. Следующий код в методе RegisterBundles в *приложения\_Start\BundleConfig.cs* файле показано, как несколько файлы добавляются в пакет:

[!code-csharp[Main](bundling-and-minification/samples/sample8.cs)]

[Пакета](https://msdn.microsoft.com/en-us/library/system.web.optimization.bundle(v=VS.110).aspx) класса `IncludeDirectory` метод предоставляется для добавления необходимых файлов в каталог (и при необходимости все подкаталоги), соответствующих шаблону поиска. [Пакета](https://msdn.microsoft.com/en-us/library/system.web.optimization.bundle(v=VS.110).aspx) класса `IncludeDirectory` API, показано ниже:

[!code-csharp[Main](bundling-and-minification/samples/sample9.cs)]

Пакеты ссылаются представления, используя метод Render ( `Styles.Render` для CSS и `Scripts.Render` для JavaScript). Приведенная ниже разметка из *представления\общие\\_Layout.cshtml* файле показано, как представления проекта ASP.NET Интернета по умолчанию ссылки на пакеты, CSS и JavaScript.

[!code-cshtml[Main](bundling-and-minification/samples/sample10.cshtml?highlight=5-6,11)]

Обратите внимание, методы отрисовки принимает массив строк, поэтому можно добавить несколько пакетов в одной строке кода. Можно использовать методы отрисовки, создающими HTML, необходимые для указания ресурса. Можно использовать `Url` метод для создания URL-адрес ресурса без разметки, необходимые для указания ресурса. Предположим, что требуется для использования нового HTML5 [async](http://www.whatwg.org/specs/web-apps/current-work/#attr-script-async) атрибута. Ниже показано, как ссылаться с помощью modernizr `Url` метод.

[!code-cshtml[Main](bundling-and-minification/samples/sample11.cshtml?highlight=11)]

## <a name="using-the--wildcard-character-to-select-files"></a>С помощью «\*» подстановочный знак для выбора файлов

Виртуальный путь, указанный в `Include` метод и поиск шаблона в `IncludeDirectory` метод может принимать один "\*" подстановочный знак в качестве префикса или суффикса в последний сегмент пути. Строка поиска без учета регистра. `IncludeDirectory` Метод имеет параметр поиска в подкаталогах.

Рассмотрим проект, содержащий следующие файлы JavaScript:

- *Scripts\Common\AddAltToImg.js*
- *Scripts\Common\ToggleDiv.js*
- *Scripts\Common\ToggleImg.js*
- *Scripts\Common\Sub1\ToggleLinks.js*

![dir imag](bundling-and-minification/_static/image7.png)

В следующей таблице показаны файлы, добавленные к пакету, с помощью подстановочного знака, как показано:

| **Call** | **Файлы, добавленные или возникло исключение** |
| --- | --- |
| Включить («~/Scripts/Common/\*.js») | *ToggleImg.js AddAltToImg.js ToggleDiv.js,* |
| Включить («~/Scripts/Common/T\*.js») | Недопустимый шаблон исключение. Подстановочный знак можно использовать только в префиксе или суффиксе. |
| Включить («~/Scripts/Common/\*og.\*») | Недопустимый шаблон исключение. Допускается только один подстановочный знак. |
| «Включить («~/Scripts/Common/T\*») | *ToggleDiv.js ToggleImg.js* |
| «Включить («~/Scripts/Common/\*») | Недопустимый шаблон исключение. Сегмент-Подстановка чисто является недопустимым. |
| IncludeDirectory («~/Scripts/Common», «T\*») | *ToggleDiv.js ToggleImg.js* |
| IncludeDirectory («~/Scripts/Common», «T\*", true) | *ToggleLinks.js ToggleDiv.js ToggleImg.js,* |

Явного добавления каждого файла к пакету рекомендуется через шаблон загрузку файлов по следующим причинам:

- Добавление скриптов по умолчанию подстановочные загружая их в алфавитном порядке, который обычно не нужны. Файлов CSS и JavaScript часто должны быть добавлены в определенном порядке (не являющиеся буквами). Можно уменьшить этот риск путем добавления настраиваемого [IBundleOrderer](https://msdn.microsoft.com/en-us/library/system.web.optimization.ibundleorderer(VS.110).aspx) реализации, но явного добавления каждого файла не менее подвержен ошибкам. Например, можно добавить новые ресурсы в папку в будущем, может потребоваться изменить ваш [IBundleOrderer](https://msdn.microsoft.com/en-us/library/system.web.optimization.ibundleorderer(VS.110).aspx) реализации.
- Во всех представлениях, ссылающиеся на этот пакет может быть включено представление определенные файлы добавлены в каталог с помощью загрузки подстановочному знаку. Если определенный сценарий представление будет добавлен к пакету, может получить ошибку JavaScript с использованием других представлений, которые ссылаются на пакет.
- CSS-файлах, которые импортируют другие файлы привести импортированных файлов, загруженных в два раза. Например следующий код создает пакет с большинством jQuery UI темы CSS-файл загружен дважды. 

    [!code-csharp[Main](bundling-and-minification/samples/sample12.cs)]

 Селектор подстановочными»\*.css» объединяет в каждой CSS-файл в папке, включая *Content\themes\base\jquery.ui.all.css* файла. *Jquery.ui.all.css* файл импортирует других файлов CSS.

## <a name="bundle-caching"></a>Объединить кэширования

Пакеты задайте один год истечения срока действия заголовка HTTP из при создании пакета. При переходе на предыдущую страницу, Fiddler передачи, которые IE не выполняет условного запроса для пакета, то есть не HTTP-запросы GET от IE для пакеты и не HTTP 304-ответов от сервера. Вы можете принудительно IE для условного запроса для каждого пакета с клавишей F5 (полученный в ответе HTTP 304 для каждого пакета). Можно выполнить полное обновление с помощью ^ F5 (в результате чего ответ HTTP 200 для каждого пакета.)

На следующем рисунке показана **кэширование** области Fiddler ответа:

![Fiddler кэширования изображений](bundling-and-minification/_static/image8.png)

Запрос   
`http://localhost/MvcBM_time/bundles/AllMyScripts?v=r0sLDicvP58AIXN_mc3QdyVvVj5euZNzdsa2N1PKvb81`  
 для пакета **AllMyScripts** и содержит пару строка запроса **v = r0sLDicvP58AIXN\_mc3QdyVvVj5euZNzdsa2N1PKvb81**. Строка запроса **v** имеет значение токена, то есть уникальный идентификатор, используемый для кэширования. До тех пор, пока пакет не меняются, приложение ASP.NET может потребовать **AllMyScripts** объединить с помощью этого токена. При изменении любого файла в пакете, платформа ASP.NET для оптимизации создаст новый маркер, гарантируя, что запросы браузера для пакета будут получены последние пакета.

Если вы запускаете средства разработчика IE9 F12 и перейдите на страницу ранее загруженную, IE неправильно показывает условного запросов GET в каждом пакете и на сервере, возвращая HTTP 304. Можно считывать, почему IE9 возникли неполадки, определить, был ли создан условного запрос в записи блога [с помощью CDN и заканчивается, чтобы повысить производительность веб-узла](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).

## <a name="less-coffeescript-scss-sass-bundling"></a>МЕНЕЕ CoffeeScript, SCSS, Sass объединение.

Объединение и Минификация framework предоставляет механизм для обработки промежуточные языки, такие как [SCSS](http://sass-lang.com/), [Sass](http://sass-lang.com/), [меньше](http://www.dotlesscss.org/) или [Coffeescript ](http://coffeescript.org/)и применения преобразований, таких как минификации в результирующий набор. Например, чтобы добавить [.less](http://www.dotlesscss.org/) файлы в проект MVC 4:

1. Создайте папку для меньше содержимого. В следующем примере используется *Content\MyLess* папки.
2. Добавить [.less](http://www.dotlesscss.org/) пакет NuGet **указывалось** в проект.  
    ![Без точки установки NuGet](bundling-and-minification/_static/image9.png)
3. Добавьте класс, реализующий [IBundleTransform](https://msdn.microsoft.com/en-us/library/system.web.optimization.ibundletransform(VS.110).aspx) интерфейса. Для преобразования .less добавьте следующий код в проект.

    [!code-csharp[Main](bundling-and-minification/samples/sample13.cs)]
4. Создание пакета меньше файлов с `LessTransform` и [CssMinify](https://msdn.microsoft.com/en-us/library/system.web.optimization.cssminify(VS.110).aspx) преобразования. Добавьте следующий код в `RegisterBundles` метод в *приложения\_Start\BundleConfig.cs* файла.

    [!code-csharp[Main](bundling-and-minification/samples/sample14.cs)]
5. Добавьте следующий код ко всем представлениям, на которые ссылается меньше пакета.

    [!code-cshtml[Main](bundling-and-minification/samples/sample15.cshtml)]

## <a name="bundle-considerations"></a>Вопросы пакета

Хороший соглашение для выполнения при создании пакетов является включение «объединить» как префикс в имени пакета. Это позволяет избежать возможного [маршрутизации конфликт](https://forums.asp.net/post/5012037.aspx).

После обновления один файл в пакете для параметра строки запроса пакета создается новый маркер и его полного пакета необходимо загрузить при очередном клиент запрашивает страницу, содержащую пакет. В традиционных разметки, где перечислено каждый актив будет загружаться только измененный файл. Активы, которые часто изменяются, не могут быть хорошими кандидатами для объединения.

Объединение и Минификация главным образом улучшить время загрузки первого запроса страницы. После запросил веб-страницы браузер кэширует активы (JavaScript, CSS и изображения), объединение и Минификация не даст любое повышение производительности при запросе ту же страницу или сайт страниц на том же запросе же активы. Если вы не задали заголовок правильно на Ваши активы истечения срока действия и не используйте объединение и Минификация, эвристики актуальность браузеров будут отмечены как активы устаревших через несколько дней и требуется браузер запроса на проверку для каждого ресурса. В этом случае объединение и Минификация обеспечивают повышение производительности после первого запроса страницы. Дополнительные сведения см. в записи [с помощью CDN и заканчивается, чтобы повысить производительность веб-узла](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).

Ограничения обозревателя шесть одновременных соединений на каждого имени узла можно снизить, используя [CDN](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx). Так как чем сайта размещения CDN будет иметь разные имена узлов, активов запросы от CDN будет ограничение не подпадают шесть одновременных подключений к среде размещения. CDN может также предоставлять общие пакета кэширования и границей, преимущества кэширования.

Пакеты должны быть секционированы по страницам, где они необходимы. Например шаблон ASP.NET MVC для веб-приложение по умолчанию создает пакет проверки jQuery отдельно от jQuery. Поскольку представления по умолчанию, созданные входные данные не имеют и не размещайте значения, они не включать в себя набор проверки.

`System.Web.Optimization` Реализован в System.Web.Optimization.DLL пространства имен. Он использует библиотеки WebGrease (WebGrease.dll) минификации возможностей, который в свою очередь использует Antlr3.Runtime.dll.

*Использовать ли быстрый блогах общего ссылки Twitter. Мой дескриптор Twitter*:[@RickAndMSFT](http://twitter.com/RickAndMSFT)

## <a name="additional-resources"></a>Дополнительные ресурсы

- Видео:[объединение и оптимизация](https://channel9.msdn.com/Events/aspConf/aspConf/Bundling-and-Optimizing) по [Говард Дайеркинг](https://twitter.com/#!/howard_dierking)
- [Добавление веб-оптимизация веб-страниц сайта](https://blogs.msdn.com/b/rickandy/archive/2012/08/15/adding-web-optimization-to-a-web-pages-site.aspx).
- [Добавление объединение и Минификация для веб-форм](https://blogs.msdn.com/b/rickandy/archive/2012/08/14/adding-bundling-and-minification-to-web-forms.aspx).
- [Влияние на производительность объединение и Минификация на просмотр веб-страниц](https://blogs.msdn.com/b/henrikn/archive/2012/06/17/performance-implications-of-bundling-and-minification-on-http.aspx) по [Nielsen F Хенрик](http://en.wikipedia.org/wiki/Henrik_Frystyk_Nielsen)[@frystyk](https://twitter.com/frystyk)
- [С помощью CDN и истечения срока действия для повышения производительности веб-сайте](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx) по Рик Андерсон[@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)
- [Свести к минимуму время приема-Передачи (времени приема-передачи)](https://developers.google.com/speed/docs/best-practices/rtt)

## <a name="contributors"></a>Авторы

- Поздравить hao
- [Говард Дайеркинг](https://twitter.com/#!/howard_dierking)
- Diana LaRose
