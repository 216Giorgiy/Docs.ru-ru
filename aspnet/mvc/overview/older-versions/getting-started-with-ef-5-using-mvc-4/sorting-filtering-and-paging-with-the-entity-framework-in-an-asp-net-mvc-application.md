---
uid: mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application
title: "Сортировку, фильтрацию и разбиение по страницам с платформой Entity Framework в приложении ASP.NET MVC (3 из 10) | Документы Microsoft"
author: tdykstra
description: "Contoso университета примера веб-приложения демонстрирует создание приложения ASP.NET MVC 4, с помощью Entity Framework 5 Code First и Visual Studio..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/30/2013
ms.topic: article
ms.assetid: 8af630e0-fffa-4110-9eca-c96e201b2724
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: 18c3825c58e7cfe0a73817a8431593c661c5fa4f
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="sorting-filtering-and-paging-with-the-entity-framework-in-an-aspnet-mvc-application-3-of-10"></a><span data-ttu-id="2a090-103">Сортировку, фильтрацию и разбиение по страницам с платформой Entity Framework в приложении ASP.NET MVC (3 из 10)</span><span class="sxs-lookup"><span data-stu-id="2a090-103">Sorting, Filtering, and Paging with the Entity Framework in an ASP.NET MVC Application (3 of 10)</span></span>
====================
<span data-ttu-id="2a090-104">По [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="2a090-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="2a090-105">Загрузка завершенного проекта</span><span class="sxs-lookup"><span data-stu-id="2a090-105">Download Completed Project</span></span>](http://code.msdn.microsoft.com/Getting-Started-with-dd0e2ed8)

> <span data-ttu-id="2a090-106">Contoso университета примера веб-приложения демонстрирует создание приложения ASP.NET MVC 4, с помощью Entity Framework 5 Code First и Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="2a090-106">The Contoso University sample web application demonstrates how to create ASP.NET MVC 4 applications using the Entity Framework 5 Code First and Visual Studio 2012.</span></span> <span data-ttu-id="2a090-107">Сведения о учебника серии см [в первом учебнике ряда](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="2a090-107">For information about the tutorial series, see [the first tutorial in the series](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span> <span data-ttu-id="2a090-108">Учебник рядов можно запустить с самого начала или [загрузить начальный проект для этой главы](building-the-ef5-mvc4-chapter-downloads.md) и начните здесь.</span><span class="sxs-lookup"><span data-stu-id="2a090-108">You can start the tutorial series from the beginning or [download a starter project for this chapter](building-the-ef5-mvc4-chapter-downloads.md) and start here.</span></span>
> 
> > [!NOTE] 
> > 
> > <span data-ttu-id="2a090-109">Если возникли проблемы, не удается устранить, [загрузить завершенного главе](building-the-ef5-mvc4-chapter-downloads.md) и попробуйте воспроизвести проблему.</span><span class="sxs-lookup"><span data-stu-id="2a090-109">If you run into a problem you can't resolve, [download the completed chapter](building-the-ef5-mvc4-chapter-downloads.md) and try to reproduce your problem.</span></span> <span data-ttu-id="2a090-110">Обычно можно найти решение проблемы путем сравнения код для завершения кода.</span><span class="sxs-lookup"><span data-stu-id="2a090-110">You can generally find the solution to the problem by comparing your code to the completed code.</span></span> <span data-ttu-id="2a090-111">Некоторые распространенные ошибки и способы их устранения см. в разделе [ошибок и способы их устранения.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span><span class="sxs-lookup"><span data-stu-id="2a090-111">For some common errors and how to solve them, see [Errors and Workarounds.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span></span>


<span data-ttu-id="2a090-112">В предыдущем учебнике реализован ряд веб-страниц для основные операции CRUD для `Student` сущностей.</span><span class="sxs-lookup"><span data-stu-id="2a090-112">In the previous tutorial you implemented a set of web pages for basic CRUD operations for `Student` entities.</span></span> <span data-ttu-id="2a090-113">В этом учебнике вы добавите сортировку, фильтрацию и разбиения по страницам для **учащихся** страницы индекса.</span><span class="sxs-lookup"><span data-stu-id="2a090-113">In this tutorial you'll add sorting, filtering, and paging functionality to the **Students** Index page.</span></span> <span data-ttu-id="2a090-114">Здесь также создается страница, выполняющий простым группированием.</span><span class="sxs-lookup"><span data-stu-id="2a090-114">You'll also create a page that does simple grouping.</span></span>

<span data-ttu-id="2a090-115">Ниже показано, как будет выглядеть страница после завершения.</span><span class="sxs-lookup"><span data-stu-id="2a090-115">The following illustration shows what the page will look like when you're done.</span></span> <span data-ttu-id="2a090-116">Заголовки столбцов являются ссылками, пользователь может щелкнуть для сортировки по этому столбцу.</span><span class="sxs-lookup"><span data-stu-id="2a090-116">The column headings are links that the user can click to sort by that column.</span></span> <span data-ttu-id="2a090-117">При щелчке заголовка многократно переключается между сортировкой по возрастанию и убыванию.</span><span class="sxs-lookup"><span data-stu-id="2a090-117">Clicking a column heading repeatedly toggles between ascending and descending sort order.</span></span>

![Students_Index_page_with_paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image1.png)

## <a name="add-column-sort-links-to-the-students-index-page"></a><span data-ttu-id="2a090-119">Добавить столбец сортировки ссылки на страницы индекса для учащихся</span><span class="sxs-lookup"><span data-stu-id="2a090-119">Add Column Sort Links to the Students Index Page</span></span>

<span data-ttu-id="2a090-120">Для добавления, страница индекса студента сортировки, мы изменим `Index` метод `Student` контроллера и добавьте код для `Student` Индексируйте представление.</span><span class="sxs-lookup"><span data-stu-id="2a090-120">To add sorting to the Student Index page, you'll change the `Index` method of the `Student` controller and add code to the `Student` Index view.</span></span>

### <a name="add-sorting-functionality-to-the-index-method"></a><span data-ttu-id="2a090-121">Добавление функции сортировки в Index-метод</span><span class="sxs-lookup"><span data-stu-id="2a090-121">Add Sorting Functionality to the Index Method</span></span>

<span data-ttu-id="2a090-122">В *Controllers\StudentController.cs*, замените `Index` метод следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="2a090-122">In *Controllers\StudentController.cs*, replace the `Index` method with the following code:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.cs)]

<span data-ttu-id="2a090-123">Этот код получает `sortOrder` параметра из строки запроса в URL-АДРЕСЕ.</span><span class="sxs-lookup"><span data-stu-id="2a090-123">This code receives a `sortOrder` parameter from the query string in the URL.</span></span> <span data-ttu-id="2a090-124">Значение строки запроса, предоставляемые ASP.NET MVC как параметр методу действия.</span><span class="sxs-lookup"><span data-stu-id="2a090-124">The query string value is provided by ASP.NET MVC as a parameter to the action method.</span></span> <span data-ttu-id="2a090-125">Параметр будет строка, являющаяся «Name» или «Date» последовать знак подчеркивания и строку «desc», чтобы указать порядок по убыванию.</span><span class="sxs-lookup"><span data-stu-id="2a090-125">The parameter will be a string that's either "Name" or "Date", optionally followed by an underscore and the string "desc" to specify descending order.</span></span> <span data-ttu-id="2a090-126">По умолчанию используется порядок сортировки по возрастанию.</span><span class="sxs-lookup"><span data-stu-id="2a090-126">The default sort order is ascending.</span></span>

<span data-ttu-id="2a090-127">При первом запросе страницы индекса имеется строка запроса отсутствует.</span><span class="sxs-lookup"><span data-stu-id="2a090-127">The first time the Index page is requested, there's no query string.</span></span> <span data-ttu-id="2a090-128">Студенты, отображаются в возрастающем порядке по `LastName`, используемого по умолчанию, установленные с проходом регистром `switch` инструкции.</span><span class="sxs-lookup"><span data-stu-id="2a090-128">The students are displayed in ascending order by `LastName`, which is the default as established by the fall-through case in the `switch` statement.</span></span> <span data-ttu-id="2a090-129">Когда пользователь щелкает гиперссылку заголовок столбца, соответствующего `sortOrder` значение указано в строке запроса.</span><span class="sxs-lookup"><span data-stu-id="2a090-129">When the user clicks a column heading hyperlink, the appropriate `sortOrder` value is provided in the query string.</span></span>

<span data-ttu-id="2a090-130">Два `ViewBag` переменные, которые используются, чтобы представление можно настроить гиперссылки заголовок столбца со значениями строки соответствующего запроса:</span><span class="sxs-lookup"><span data-stu-id="2a090-130">The two `ViewBag` variables are used so that the view can configure the column heading hyperlinks with the appropriate query string values:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.cs)]

<span data-ttu-id="2a090-131">Это троичный инструкции.</span><span class="sxs-lookup"><span data-stu-id="2a090-131">These are ternary statements.</span></span> <span data-ttu-id="2a090-132">Указывает, что если первый `sortOrder` параметра равно null или пусто, `ViewBag.NameSortParm` должно быть равно «имя\_desc»; в противном случае задается равным пустой строке.</span><span class="sxs-lookup"><span data-stu-id="2a090-132">The first one specifies that if the `sortOrder` parameter is null or empty, `ViewBag.NameSortParm` should be set to "name\_desc"; otherwise, it should be set to an empty string.</span></span> <span data-ttu-id="2a090-133">Следующие два оператора включите представление для задания гиперссылки заголовка столбца следующим образом:</span><span class="sxs-lookup"><span data-stu-id="2a090-133">These two statements enable the view to set the column heading hyperlinks as follows:</span></span>

| <span data-ttu-id="2a090-134">Текущий порядок сортировки</span><span class="sxs-lookup"><span data-stu-id="2a090-134">Current sort order</span></span> | <span data-ttu-id="2a090-135">Последнее имя гиперссылки</span><span class="sxs-lookup"><span data-stu-id="2a090-135">Last Name Hyperlink</span></span> | <span data-ttu-id="2a090-136">Дата гиперссылки</span><span class="sxs-lookup"><span data-stu-id="2a090-136">Date Hyperlink</span></span> |
| --- | --- | --- |
| <span data-ttu-id="2a090-137">Последняя имени: по возрастанию</span><span class="sxs-lookup"><span data-stu-id="2a090-137">Last Name ascending</span></span> | <span data-ttu-id="2a090-138">по убыванию</span><span class="sxs-lookup"><span data-stu-id="2a090-138">descending</span></span> | <span data-ttu-id="2a090-139">по возрастанию</span><span class="sxs-lookup"><span data-stu-id="2a090-139">ascending</span></span> |
| <span data-ttu-id="2a090-140">Последняя имени: по убыванию</span><span class="sxs-lookup"><span data-stu-id="2a090-140">Last Name descending</span></span> | <span data-ttu-id="2a090-141">по возрастанию</span><span class="sxs-lookup"><span data-stu-id="2a090-141">ascending</span></span> | <span data-ttu-id="2a090-142">по возрастанию</span><span class="sxs-lookup"><span data-stu-id="2a090-142">ascending</span></span> |
| <span data-ttu-id="2a090-143">По возрастанию даты</span><span class="sxs-lookup"><span data-stu-id="2a090-143">Date ascending</span></span> | <span data-ttu-id="2a090-144">по возрастанию</span><span class="sxs-lookup"><span data-stu-id="2a090-144">ascending</span></span> | <span data-ttu-id="2a090-145">по убыванию</span><span class="sxs-lookup"><span data-stu-id="2a090-145">descending</span></span> |
| <span data-ttu-id="2a090-146">Дата по убыванию</span><span class="sxs-lookup"><span data-stu-id="2a090-146">Date descending</span></span> | <span data-ttu-id="2a090-147">по возрастанию</span><span class="sxs-lookup"><span data-stu-id="2a090-147">ascending</span></span> | <span data-ttu-id="2a090-148">по возрастанию</span><span class="sxs-lookup"><span data-stu-id="2a090-148">ascending</span></span> |

<span data-ttu-id="2a090-149">Этот метод использует [LINQ to Entities](https://msdn.microsoft.com/en-us/library/bb386964.aspx) для указания столбца, по которому выполняется сортировка.</span><span class="sxs-lookup"><span data-stu-id="2a090-149">The method uses [LINQ to Entities](https://msdn.microsoft.com/en-us/library/bb386964.aspx) to specify the column to sort by.</span></span> <span data-ttu-id="2a090-150">Код создает [IQueryable](https://msdn.microsoft.com/en-us/library/bb351562.aspx) переменной перед `switch` инструкции, изменяет его в `switch` инструкции и вызовы `ToList` метод после `switch` инструкции.</span><span class="sxs-lookup"><span data-stu-id="2a090-150">The code creates an [IQueryable](https://msdn.microsoft.com/en-us/library/bb351562.aspx) variable before the `switch` statement, modifies it in the `switch` statement, and calls the `ToList` method after the `switch` statement.</span></span> <span data-ttu-id="2a090-151">После создания и изменения `IQueryable` переменные, не отправляется запрос базы данных.</span><span class="sxs-lookup"><span data-stu-id="2a090-151">When you create and modify `IQueryable` variables, no query is sent to the database.</span></span> <span data-ttu-id="2a090-152">Запрос не выполняется до преобразования `IQueryable` объект в коллекции, такие как вызов метода `ToList`.</span><span class="sxs-lookup"><span data-stu-id="2a090-152">The query is not executed until you convert the `IQueryable` object into a collection by calling a method such as `ToList`.</span></span> <span data-ttu-id="2a090-153">Таким образом, этот код вызывает один запрос, который не выполняется до `return View` инструкции.</span><span class="sxs-lookup"><span data-stu-id="2a090-153">Therefore, this code results in a single query that is not executed until the `return View` statement.</span></span>

### <a name="add-column-heading-hyperlinks-to-the-student-index-view"></a><span data-ttu-id="2a090-154">Добавление гиперссылки в представление индекс студента заголовок столбца</span><span class="sxs-lookup"><span data-stu-id="2a090-154">Add Column Heading Hyperlinks to the Student Index View</span></span>

<span data-ttu-id="2a090-155">В *Views\Student\Index.cshtml*, замените `<tr>` и `<th>` элементы для строки заголовка с выделенным кодом:</span><span class="sxs-lookup"><span data-stu-id="2a090-155">In *Views\Student\Index.cshtml*, replace the `<tr>` and `<th>` elements for the heading row with the highlighted code:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cshtml?highlight=5-15)]

<span data-ttu-id="2a090-156">Этот код использует эти сведения в `ViewBag` свойства для настройки гиперссылки с соответствующего запроса строковые значения.</span><span class="sxs-lookup"><span data-stu-id="2a090-156">This code uses the information in the `ViewBag` properties to set up hyperlinks with the appropriate query string values.</span></span>

<span data-ttu-id="2a090-157">Запустите страницу и щелкните **Фамилия** и **Дата регистрации** заголовки столбцов, чтобы проверить, Сортировка работает.</span><span class="sxs-lookup"><span data-stu-id="2a090-157">Run the page and click the **Last Name** and **Enrollment Date** column headings to verify that sorting works.</span></span>

![Students_Index_page_with_sort_hyperlinks](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image2.png)

<span data-ttu-id="2a090-159">После нажатия кнопки **Фамилия** заголовком учащихся, отображаются в порядке убывания последнее имя.</span><span class="sxs-lookup"><span data-stu-id="2a090-159">After you click the **Last Name** heading, students are displayed in descending last name order.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image3.png)

## <a name="add-a-search-box-to-the-students-index-page"></a><span data-ttu-id="2a090-160">Добавить поле поиска на страницу индекса студентов</span><span class="sxs-lookup"><span data-stu-id="2a090-160">Add a Search Box to the Students Index Page</span></span>

<span data-ttu-id="2a090-161">Добавление фильтрации на страницу индекса учащихся, мы добавим текстовое поле и кнопку отправки для представления и внесите соответствующие изменения в `Index` метод.</span><span class="sxs-lookup"><span data-stu-id="2a090-161">To add filtering to the Students Index page, you'll add a text box and a submit button to the view and make corresponding changes in the `Index` method.</span></span> <span data-ttu-id="2a090-162">Текстовое поле можно ввести строку для поиска в полями имени и имени.</span><span class="sxs-lookup"><span data-stu-id="2a090-162">The text box will let you enter a string to search for in the first name and last name fields.</span></span>

### <a name="add-filtering-functionality-to-the-index-method"></a><span data-ttu-id="2a090-163">Добавьте функцию фильтра в метод индекса</span><span class="sxs-lookup"><span data-stu-id="2a090-163">Add Filtering Functionality to the Index Method</span></span>

<span data-ttu-id="2a090-164">В *Controllers\StudentController.cs*, замените `Index` метод (изменения выделены) следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="2a090-164">In *Controllers\StudentController.cs*, replace the `Index` method with the following code (the changes are highlighted):</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cs?highlight=1,7-11)]

<span data-ttu-id="2a090-165">Вы добавили `searchString` параметр `Index` метода.</span><span class="sxs-lookup"><span data-stu-id="2a090-165">You've added a `searchString` parameter to the `Index` method.</span></span> <span data-ttu-id="2a090-166">Вы добавили в инструкции LINQ `where` clausethat выбирает только учащихся, имя или фамилия содержит строку поиска.</span><span class="sxs-lookup"><span data-stu-id="2a090-166">You've also added to the LINQ statement a `where` clausethat selects only students whose first name or last name contains the search string.</span></span> <span data-ttu-id="2a090-167">Строковое значение поиска получается из текстового поля, который вам предстоит добавить в представление индекс. Оператор, который добавляет [где](https://msdn.microsoft.com/en-us/library/bb535040.aspx) предложение выполняется только в том случае, если значение для поиска.</span><span class="sxs-lookup"><span data-stu-id="2a090-167">The search string value is received from a text box that you'll add to the Index view.The statement that adds the [where](https://msdn.microsoft.com/en-us/library/bb535040.aspx) clause is executed only if there's a value to search for.</span></span>

> [!NOTE]
> <span data-ttu-id="2a090-168">Во многих случаях можно вызвать тот же метод в наборе сущностей Entity Framework или как метод расширения для коллекции в памяти.</span><span class="sxs-lookup"><span data-stu-id="2a090-168">In many cases you can call the same method either on an Entity Framework entity set or as an extension method on an in-memory collection.</span></span> <span data-ttu-id="2a090-169">Обычно такие же результаты, но в некоторых случаях могут различаться.</span><span class="sxs-lookup"><span data-stu-id="2a090-169">The results are normally the same but in some cases may be different.</span></span> <span data-ttu-id="2a090-170">Например, реализация .NET Framework `Contains` метод возвращает все строки, если передать пустую строку, но поставщик Entity Framework для SQL Server Compact 4.0 возвращает нуль строк, наличие пустых строк.</span><span class="sxs-lookup"><span data-stu-id="2a090-170">For example, the .NET Framework implementation of the `Contains` method returns all rows when you pass an empty string to it, but the Entity Framework provider for SQL Server Compact 4.0 returns zero rows for empty strings.</span></span> <span data-ttu-id="2a090-171">Поэтому код в примере (размещение `Where` инструкции внутри `if` инструкции) гарантирует, что получить те же результаты для всех версий SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2a090-171">Therefore the code in the example (putting the `Where` statement inside an `if` statement) makes sure that you get the same results for all versions of SQL Server.</span></span> <span data-ttu-id="2a090-172">Кроме того, реализация .NET Framework `Contains` метод выполняет сравнение с учетом регистра по умолчанию, но поставщики Entity Framework SQL Server по умолчанию выполняют сравнения без учета регистра.</span><span class="sxs-lookup"><span data-stu-id="2a090-172">Also, the .NET Framework implementation of the `Contains` method performs a case-sensitive comparison by default, but Entity Framework SQL Server providers perform case-insensitive comparisons by default.</span></span> <span data-ttu-id="2a090-173">Таким образом, вызов `ToUpper` метод производится проверка явно без учета регистра гарантирует, что не изменяются при изменении кода позже в репозитории, которая вернет `IEnumerable` коллекции вместо `IQueryable` объекта.</span><span class="sxs-lookup"><span data-stu-id="2a090-173">Therefore, calling the `ToUpper` method to make the test explicitly case-insensitive ensures that results do not change when you change the code later to use a repository, which will return an `IEnumerable` collection instead of an `IQueryable` object.</span></span> <span data-ttu-id="2a090-174">(При вызове `Contains` метод `IEnumerable` коллекции, получить реализации .NET Framework; при его вызове на `IQueryable` объекта, вы получаете реализации поставщика базы данных.)</span><span class="sxs-lookup"><span data-stu-id="2a090-174">(When you call the `Contains` method on an `IEnumerable` collection, you get the .NET Framework implementation; when you call it on an `IQueryable` object, you get the database provider implementation.)</span></span>


### <a name="add-a-search-box-to-the-student-index-view"></a><span data-ttu-id="2a090-175">Добавить поле поиска в представление индекс студента</span><span class="sxs-lookup"><span data-stu-id="2a090-175">Add a Search Box to the Student Index View</span></span>

<span data-ttu-id="2a090-176">В *Views\Student\Index.cshtml*, добавьте выделенный код непосредственно перед открытием `table` тег, чтобы создать текстовое поле заголовка и **поиска** кнопку.</span><span class="sxs-lookup"><span data-stu-id="2a090-176">In *Views\Student\Index.cshtml*, add the highlighted code immediately before the opening `table` tag in order to create a caption, a text box, and a **Search** button.</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cshtml?highlight=5-10)]

<span data-ttu-id="2a090-177">Откройте страницу, введите строку поиска и нажмите кнопку **поиска** для проверки корректности фильтрации.</span><span class="sxs-lookup"><span data-stu-id="2a090-177">Run the page, enter a search string, and click **Search** to verify that filtering is working.</span></span>

![Students_Index_page_with_search_box](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image4.png)

<span data-ttu-id="2a090-179">Обратите внимание, что URL-адрес не содержит «» строка поиска, это означает, что если закладку для этой страницы вы не сможете получить отфильтрованный список при использовании закладки.</span><span class="sxs-lookup"><span data-stu-id="2a090-179">Notice the URL doesn't contain the "an" search string, which means that if you bookmark this page, you won't get the filtered list when you use the bookmark.</span></span> <span data-ttu-id="2a090-180">Мы изменим **поиска** кнопку, чтобы использовать в критериях фильтра строки запроса, далее в этом учебнике.</span><span class="sxs-lookup"><span data-stu-id="2a090-180">You'll change the **Search** button to use query strings for filter criteria later in the tutorial.</span></span>

## <a name="add-paging-to-the-students-index-page"></a><span data-ttu-id="2a090-181">Добавить разбиение на страницы на страницу индекса студентов</span><span class="sxs-lookup"><span data-stu-id="2a090-181">Add Paging to the Students Index Page</span></span>

<span data-ttu-id="2a090-182">Добавление страницы индекса учащихся разбиения на страницы, вы начнете, установив **PagedList.Mvc** пакет NuGet.</span><span class="sxs-lookup"><span data-stu-id="2a090-182">To add paging to the Students Index page, you'll start by installing the **PagedList.Mvc** NuGet package.</span></span> <span data-ttu-id="2a090-183">Затем будет вносить дополнительные изменения в `Index` метод и добавьте ссылки подкачки `Index` представления.</span><span class="sxs-lookup"><span data-stu-id="2a090-183">Then you'll make additional changes in the `Index` method and add paging links to the `Index` view.</span></span> <span data-ttu-id="2a090-184">**PagedList.Mvc** является одним из многих хорошо постраничного просмотра и сортировки пакетов для ASP.NET MVC и его использование здесь предназначено исключительно в качестве примера, не в качестве рекомендации по изменению его через другие параметры.</span><span class="sxs-lookup"><span data-stu-id="2a090-184">**PagedList.Mvc** is one of many good paging and sorting packages for ASP.NET MVC, and its use here is intended only as an example, not as a recommendation for it over other options.</span></span> <span data-ttu-id="2a090-185">На следующем рисунке ссылки разбиения на страницы.</span><span class="sxs-lookup"><span data-stu-id="2a090-185">The following illustration shows the paging links.</span></span>

![Students_index_page_with_paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image5.png)

### <a name="install-the-pagedlistmvc-nuget-package"></a><span data-ttu-id="2a090-187">Установка пакета PagedList.MVC NuGet</span><span class="sxs-lookup"><span data-stu-id="2a090-187">Install the PagedList.MVC NuGet Package</span></span>

<span data-ttu-id="2a090-188">NuGet **PagedList.Mvc** пакет автоматически устанавливает **PagedList** пакета в качестве зависимости.</span><span class="sxs-lookup"><span data-stu-id="2a090-188">The NuGet **PagedList.Mvc** package automatically installs the **PagedList** package as a dependency.</span></span> <span data-ttu-id="2a090-189">**PagedList** пакет устанавливает `PagedList` коллекцию типов и расширения методы для `IQueryable` и `IEnumerable` коллекции.</span><span class="sxs-lookup"><span data-stu-id="2a090-189">The **PagedList** package installs a `PagedList` collection type and extension methods for `IQueryable` and `IEnumerable` collections.</span></span> <span data-ttu-id="2a090-190">Методы расширения создают одной страницы данных в `PagedList` коллекции из вашего `IQueryable` или `IEnumerable`и `PagedList` коллекция предоставляет несколько свойств и методов, предназначенных для упрощения разбиения на страницы.</span><span class="sxs-lookup"><span data-stu-id="2a090-190">The extension methods create a single page of data in a `PagedList` collection out of your `IQueryable` or `IEnumerable`, and the `PagedList` collection provides several properties and methods that facilitate paging.</span></span> <span data-ttu-id="2a090-191">**PagedList.Mvc** пакет устанавливает подкачки вспомогательный класс, отображающий кнопки разбиения по страницам.</span><span class="sxs-lookup"><span data-stu-id="2a090-191">The **PagedList.Mvc** package installs a paging helper that displays the paging buttons.</span></span>

<span data-ttu-id="2a090-192">Из **средства** последовательно выберите пункты **диспетчер пакетов библиотеки** и затем **управление пакетами NuGet для решения**.</span><span class="sxs-lookup"><span data-stu-id="2a090-192">From the **Tools** menu, select **Library Package Manager** and then **Manage NuGet Packages for Solution**.</span></span>

<span data-ttu-id="2a090-193">В **управление пакетами NuGet** диалоговое окно, нажмите кнопку **Online** слева, а затем введите «выгружаемого» в поле поиска.</span><span class="sxs-lookup"><span data-stu-id="2a090-193">In the **Manage NuGet Packages** dialog box, click the **Online** tab on the left and then enter "paged" in the search box.</span></span> <span data-ttu-id="2a090-194">При появлении **PagedList.Mvc** пакет, нажмите кнопку **установить**.</span><span class="sxs-lookup"><span data-stu-id="2a090-194">When you see the **PagedList.Mvc** package, click **Install**.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image6.png)

<span data-ttu-id="2a090-195">В **выберите проекты** щелкните **ОК**.</span><span class="sxs-lookup"><span data-stu-id="2a090-195">In the **Select Projects** box, click **OK**.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image7.png)

### <a name="add-paging-functionality-to-the-index-method"></a><span data-ttu-id="2a090-196">Добавьте в метод индекс разбиения по страницам</span><span class="sxs-lookup"><span data-stu-id="2a090-196">Add Paging Functionality to the Index Method</span></span>

<span data-ttu-id="2a090-197">В *Controllers\StudentController.cs*, добавьте `using` инструкции для `PagedList` пространство имен:</span><span class="sxs-lookup"><span data-stu-id="2a090-197">In *Controllers\StudentController.cs*, add a `using` statement for the `PagedList` namespace:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.cs)]

<span data-ttu-id="2a090-198">Замените метод `Index` следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="2a090-198">Replace the `Index` method with the following code:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample7.cs)]

<span data-ttu-id="2a090-199">Этот код добавляет `page` параметра, текущий параметр порядка сортировки и текущий параметр фильтра к сигнатуре метода, как показано ниже:</span><span class="sxs-lookup"><span data-stu-id="2a090-199">This code adds a `page` parameter, a current sort order parameter, and a current filter parameter to the method signature, as shown here:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample8.cs)]

<span data-ttu-id="2a090-200">Первый раз, когда страница отображается или если пользователь не щелкнет подкачки или сортировки ссылку, все параметры будут иметь значение null.</span><span class="sxs-lookup"><span data-stu-id="2a090-200">The first time the page is displayed, or if the user hasn't clicked a paging or sorting link, all the parameters will be null.</span></span> <span data-ttu-id="2a090-201">Если щелкнуть ссылку подкачки `page` переменная будет содержать номер страницы для отображения.</span><span class="sxs-lookup"><span data-stu-id="2a090-201">If a paging link is clicked, the `page` variable will contain the page number to display.</span></span>

<span data-ttu-id="2a090-202">`A ViewBag`свойство предоставляет представление определения порядка сортировки, так как это должны быть включены в ссылки разбиения на страницы для сохранит порядок сортировки во время разбиения на страницы:</span><span class="sxs-lookup"><span data-stu-id="2a090-202">`A ViewBag` property provides the view with the current sort order, because this must be included in the paging links in order to keep the sort order the same while paging:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample9.cs)]

<span data-ttu-id="2a090-203">Другое свойство `ViewBag.CurrentFilter`, обеспечивает представление с текущей строки фильтра.</span><span class="sxs-lookup"><span data-stu-id="2a090-203">Another property, `ViewBag.CurrentFilter`, provides the view with the current filter string.</span></span> <span data-ttu-id="2a090-204">Это значение должны быть включены в ссылки разбиения на страницы для поддержки настройки фильтра во время разбиения на страницы, и она должна быть восстановлена к текстовому полю, когда отобразится страница.</span><span class="sxs-lookup"><span data-stu-id="2a090-204">This value must be included in the paging links in order to maintain the filter settings during paging, and it must be restored to the text box when the page is redisplayed.</span></span> <span data-ttu-id="2a090-205">Если строка поиска, которая изменяется во время разбиения на страницы, страницы должен быть равным 1, так как новый фильтр может показать различные данные.</span><span class="sxs-lookup"><span data-stu-id="2a090-205">If the search string is changed during paging, the page has to be reset to 1, because the new filter can result in different data to display.</span></span> <span data-ttu-id="2a090-206">Строка поиска, которая изменяется при нажатии кнопки "Отправить", если ввести значение в текстовом поле.</span><span class="sxs-lookup"><span data-stu-id="2a090-206">The search string is changed when a value is entered in the text box and the submit button is pressed.</span></span> <span data-ttu-id="2a090-207">В этом случае `searchString` параметра не равно null.</span><span class="sxs-lookup"><span data-stu-id="2a090-207">In that case, the `searchString` parameter is not null.</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample10.cs)]

<span data-ttu-id="2a090-208">В конце метода `ToPagedList` метод расширения в слушателей `IQueryable` объект преобразует запрос студента на одной странице учеников в тип коллекции, который поддерживает разбиение по страницам.</span><span class="sxs-lookup"><span data-stu-id="2a090-208">At the end of the method, the `ToPagedList` extension method on the students `IQueryable` object converts the student query to a single page of students in a collection type that supports paging.</span></span> <span data-ttu-id="2a090-209">Страницы учащихся затем передается в представление:</span><span class="sxs-lookup"><span data-stu-id="2a090-209">That single page of students is then passed to the view:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample11.cs)]

<span data-ttu-id="2a090-210">`ToPagedList` Метод принимает номер страницы.</span><span class="sxs-lookup"><span data-stu-id="2a090-210">The `ToPagedList` method takes a page number.</span></span> <span data-ttu-id="2a090-211">Два знака вопроса указывают [оператор объединения с null](https://msdn.microsoft.com/en-us/library/ms173224.aspx).</span><span class="sxs-lookup"><span data-stu-id="2a090-211">The two question marks represent the [null-coalescing operator](https://msdn.microsoft.com/en-us/library/ms173224.aspx).</span></span> <span data-ttu-id="2a090-212">Оператор объединения с null определяет значение по умолчанию для типа значения NULL; выражение `(page ?? 1)` означает возвращают значение `page` если он имеет значение, или возвращает 1, если `page` имеет значение null.</span><span class="sxs-lookup"><span data-stu-id="2a090-212">The null-coalescing operator defines a default value for a nullable type; the expression `(page ?? 1)` means return the value of `page` if it has a value, or return 1 if `page` is null.</span></span>

### <a name="add-paging-links-to-the-student-index-view"></a><span data-ttu-id="2a090-213">Добавить разбиение на страницы ссылки на представление Index студента</span><span class="sxs-lookup"><span data-stu-id="2a090-213">Add Paging Links to the Student Index View</span></span>

<span data-ttu-id="2a090-214">В *Views\Student\Index.cshtml*, замените существующий код следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="2a090-214">In *Views\Student\Index.cshtml*, replace the existing code with the following code:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample12.cshtml?highlight=6,9,14-20,56-58)]

<span data-ttu-id="2a090-215">`@model` В верхней части страницы указывает теперь возвращает представление `PagedList` объекта вместо `List` объекта.</span><span class="sxs-lookup"><span data-stu-id="2a090-215">The `@model` statement at the top of the page specifies that the view now gets a `PagedList` object instead of a `List` object.</span></span>

<span data-ttu-id="2a090-216">`using` Инструкции для `PagedList.Mvc` предоставляет доступ к вспомогательным методом MVC для кнопки разбиения по страницам.</span><span class="sxs-lookup"><span data-stu-id="2a090-216">The `using` statement for `PagedList.Mvc` gives access to the MVC helper for the paging buttons.</span></span>

<span data-ttu-id="2a090-217">В коде используется перегруженная версия [BeginForm](https://msdn.microsoft.com/en-us/library/system.web.mvc.html.formextensions.beginform(v=vs.108).aspx) , позволяющее указать [FormMethod.Get](https://msdn.microsoft.com/en-us/library/system.web.mvc.formmethod(v=vs.100).aspx/css).</span><span class="sxs-lookup"><span data-stu-id="2a090-217">The code uses an overload of [BeginForm](https://msdn.microsoft.com/en-us/library/system.web.mvc.html.formextensions.beginform(v=vs.108).aspx) that allows it to specify [FormMethod.Get](https://msdn.microsoft.com/en-us/library/system.web.mvc.formmethod(v=vs.100).aspx/css).</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample13.cshtml?highlight=1)]

<span data-ttu-id="2a090-218">Значение по умолчанию [BeginForm](https://msdn.microsoft.com/en-us/library/system.web.mvc.html.formextensions.beginform(v=vs.108).aspx) отправки данных с помощью запроса POST, это означает, что параметры передаются в тексте сообщения HTTP, а не в URL-адрес как строки запросов.</span><span class="sxs-lookup"><span data-stu-id="2a090-218">The default [BeginForm](https://msdn.microsoft.com/en-us/library/system.web.mvc.html.formextensions.beginform(v=vs.108).aspx) submits form data with a POST, which means that parameters are passed in the HTTP message body and not in the URL as query strings.</span></span> <span data-ttu-id="2a090-219">При указании HTTP GET, данные формы переданный URL-адрес как строки запроса, который позволяет пользователям bookmark URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="2a090-219">When you specify HTTP GET, the form data is passed in the URL as query strings, which enables users to bookmark the URL.</span></span> <span data-ttu-id="2a090-220">[Рекомендации W3C для использования HTTP GET](http://www.w3.org/2001/tag/doc/whenToUseGet.html) укажите, должен использовать GET, если действие не приводит к появлению обновления.</span><span class="sxs-lookup"><span data-stu-id="2a090-220">The [W3C guidelines for the use of HTTP GET](http://www.w3.org/2001/tag/doc/whenToUseGet.html) specify that you should use GET when the action does not result in an update.</span></span>

<span data-ttu-id="2a090-221">При нажатии кнопки новую страницу для отображения текущей искомой строки, текстовое поле инициализируется текущей искомой строки.</span><span class="sxs-lookup"><span data-stu-id="2a090-221">The text box is initialized with the current search string so when you click a new page you can see the current search string.</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample14.cshtml?highlight=1)]

<span data-ttu-id="2a090-222">Ссылки в заголовках столбцов использовать строку запроса для передачи текущей искомой строки к контроллеру, чтобы пользователь может сортировать в результаты фильтрации:</span><span class="sxs-lookup"><span data-stu-id="2a090-222">The column header links use the query string to pass the current search string to the controller so that the user can sort within filter results:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample15.cshtml?highlight=1)]

<span data-ttu-id="2a090-223">Отображаются текущей страницы и общее число страниц.</span><span class="sxs-lookup"><span data-stu-id="2a090-223">The current page and total number of pages are displayed.</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample16.cshtml)]

<span data-ttu-id="2a090-224">Если отсутствуют страницы для отображения, отображается «Страница 0 0».</span><span class="sxs-lookup"><span data-stu-id="2a090-224">If there are no pages to display, "Page 0 of 0" is shown.</span></span> <span data-ttu-id="2a090-225">(В этом случае номер страницы больше, чем количество страниц из-за `Model.PageNumber` -1, и `Model.PageCount` — 0.)</span><span class="sxs-lookup"><span data-stu-id="2a090-225">(In that case the page number is greater than the page count because `Model.PageNumber` is 1, and `Model.PageCount` is 0.)</span></span>

<span data-ttu-id="2a090-226">Отображаются кнопки разбиения на страницы с `PagedListPager` поддержки:</span><span class="sxs-lookup"><span data-stu-id="2a090-226">The paging buttons are displayed by the `PagedListPager` helper:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample17.cshtml)]

<span data-ttu-id="2a090-227">`PagedListPager` Вспомогательные предоставляет ряд возможностей, которые можно настраивать, включая URL-адреса и оформление.</span><span class="sxs-lookup"><span data-stu-id="2a090-227">The `PagedListPager` helper provides a number of options that you can customize, including URLs and styling.</span></span> <span data-ttu-id="2a090-228">Дополнительные сведения см. в разделе [TroyGoode / PagedList](https://github.com/TroyGoode/PagedList) на сайте GitHub.</span><span class="sxs-lookup"><span data-stu-id="2a090-228">For more information, see [TroyGoode / PagedList](https://github.com/TroyGoode/PagedList) on the GitHub site.</span></span>

<span data-ttu-id="2a090-229">Запустите страницу.</span><span class="sxs-lookup"><span data-stu-id="2a090-229">Run the page.</span></span>

![Students_index_page_with_paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image8.png)

<span data-ttu-id="2a090-231">По ссылкам разбиения на страницы в различными порядками сортировки, чтобы убедиться, что работает разбиения на страницы.</span><span class="sxs-lookup"><span data-stu-id="2a090-231">Click the paging links in different sort orders to make sure paging works.</span></span> <span data-ttu-id="2a090-232">Затем введите строку поиска и повторите подкачки еще раз, чтобы проверить правильность разбиения на страницы также с сортировкой и фильтрацией.</span><span class="sxs-lookup"><span data-stu-id="2a090-232">Then enter a search string and try paging again to verify that paging also works correctly with sorting and filtering.</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image9.png)

## <a name="create-an-about-page-that-shows-student-statistics"></a><span data-ttu-id="2a090-233">Создание о страницы, отображающей студента статистики</span><span class="sxs-lookup"><span data-stu-id="2a090-233">Create an About Page That Shows Student Statistics</span></span>

<span data-ttu-id="2a090-234">Для Contoso университета веб-сайта о странице как отображать количество студентов регистрации для каждой даты регистрации.</span><span class="sxs-lookup"><span data-stu-id="2a090-234">For the Contoso University website's About page, you'll display how many students have enrolled for each enrollment date.</span></span> <span data-ttu-id="2a090-235">Для этого простого группировки и выполнения расчетов по группам.</span><span class="sxs-lookup"><span data-stu-id="2a090-235">This requires grouping and simple calculations on the groups.</span></span> <span data-ttu-id="2a090-236">Для выполнения этой задачи вы выполните следующее:</span><span class="sxs-lookup"><span data-stu-id="2a090-236">To accomplish this, you'll do the following:</span></span>

- <span data-ttu-id="2a090-237">Создание класса модели представления для данных, которые нужно передать в представление.</span><span class="sxs-lookup"><span data-stu-id="2a090-237">Create a view model class for the data that you need to pass to the view.</span></span>
- <span data-ttu-id="2a090-238">Изменить `About` метод в `Home` контроллера.</span><span class="sxs-lookup"><span data-stu-id="2a090-238">Modify the `About` method in the `Home` controller.</span></span>
- <span data-ttu-id="2a090-239">Изменить `About` представления.</span><span class="sxs-lookup"><span data-stu-id="2a090-239">Modify the `About` view.</span></span>

### <a name="create-the-view-model"></a><span data-ttu-id="2a090-240">Создание модели представления</span><span class="sxs-lookup"><span data-stu-id="2a090-240">Create the View Model</span></span>

<span data-ttu-id="2a090-241">Создание *ViewModels* папки.</span><span class="sxs-lookup"><span data-stu-id="2a090-241">Create a *ViewModels* folder.</span></span> <span data-ttu-id="2a090-242">В этой папке, добавьте файл класса *EnrollmentDateGroup.cs* и замените существующий код следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="2a090-242">In that folder, add a class file *EnrollmentDateGroup.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample18.cs)]

### <a name="modify-the-home-controller"></a><span data-ttu-id="2a090-243">Контроллер Home</span><span class="sxs-lookup"><span data-stu-id="2a090-243">Modify the Home Controller</span></span>

<span data-ttu-id="2a090-244">В *HomeController.cs*, добавьте следующий `using` инструкции в верхней части файла:</span><span class="sxs-lookup"><span data-stu-id="2a090-244">In *HomeController.cs*, add the following `using` statements at the top of the file:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample19.cs)]

<span data-ttu-id="2a090-245">Добавьте переменную класса для контекста базы данных сразу же после открывающей фигурной скобки для класса:</span><span class="sxs-lookup"><span data-stu-id="2a090-245">Add a class variable for the database context immediately after the opening curly brace for the class:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample20.cs?highlight=3)]

<span data-ttu-id="2a090-246">Замените метод `About` следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="2a090-246">Replace the `About` method with the following code:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample21.cs)]

<span data-ttu-id="2a090-247">Инструкции LINQ группирует учащихся сущностей, Дата регистрации, вычисляет число сущностей в каждой группе и сохраняет результаты в коллекцию `EnrollmentDateGroup` просматривать объекты модели.</span><span class="sxs-lookup"><span data-stu-id="2a090-247">The LINQ statement groups the student entities by enrollment date, calculates the number of entities in each group, and stores the results in a collection of `EnrollmentDateGroup` view model objects.</span></span>

<span data-ttu-id="2a090-248">Добавить `Dispose` метод:</span><span class="sxs-lookup"><span data-stu-id="2a090-248">Add a `Dispose` method:</span></span>

[!code-csharp[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample22.cs)]

### <a name="modify-the-about-view"></a><span data-ttu-id="2a090-249">Изменить представление</span><span class="sxs-lookup"><span data-stu-id="2a090-249">Modify the About View</span></span>

<span data-ttu-id="2a090-250">Замените код в *Views\Home\About.cshtml* файла следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="2a090-250">Replace the code in the *Views\Home\About.cshtml* file with the following code:</span></span>

[!code-cshtml[Main](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample23.cshtml)]

<span data-ttu-id="2a090-251">Запустите приложение и нажмите кнопку **о** ссылку.</span><span class="sxs-lookup"><span data-stu-id="2a090-251">Run the app and click the **About** link.</span></span> <span data-ttu-id="2a090-252">Количества учащихся для каждой даты регистрации отображается в таблице.</span><span class="sxs-lookup"><span data-stu-id="2a090-252">The count of students for each enrollment date is displayed in a table.</span></span>

![About_page](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image10.png)

## <a name="optional-deploy-the-app-to-windows-azure"></a><span data-ttu-id="2a090-254">Необязательно: Развертывание приложения в Windows Azure</span><span class="sxs-lookup"><span data-stu-id="2a090-254">Optional: Deploy the app to Windows Azure</span></span>

<span data-ttu-id="2a090-255">Пока приложение работает локально в IIS Express на компьютере разработчика.</span><span class="sxs-lookup"><span data-stu-id="2a090-255">So far your application has been running locally in IIS Express on your development computer.</span></span> <span data-ttu-id="2a090-256">Чтобы сделать его доступным для других пользователей в Интернете, необходимо развернуть его на веб-поставщик услуг размещения.</span><span class="sxs-lookup"><span data-stu-id="2a090-256">To make it available for other people to use over the Internet, you have to deploy it to a web hosting provider.</span></span> <span data-ttu-id="2a090-257">В этом дополнительном разделе учебника вы развернете его для веб-сайта Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="2a090-257">In this optional section of the tutorial you'll deploy it to a Windows Azure Web Site.</span></span>

### <a name="using-code-first-migrations-to-deploy-the-database"></a><span data-ttu-id="2a090-258">С помощью Code First Migrations развертывание базы данных</span><span class="sxs-lookup"><span data-stu-id="2a090-258">Using Code First Migrations to Deploy the Database</span></span>

<span data-ttu-id="2a090-259">Для развертывания базы данных потребуется использовать Code First Migrations.</span><span class="sxs-lookup"><span data-stu-id="2a090-259">To deploy the database you'll use Code First Migrations.</span></span> <span data-ttu-id="2a090-260">При создании профиля публикации, который используется для настройки параметров для развертывания из Visual Studio будет предложено выбрать флажок под названием **выполнять миграции Code First (запускается при запуске приложения)**.</span><span class="sxs-lookup"><span data-stu-id="2a090-260">When you create the publish profile that you use to configure settings for deploying from Visual Studio, you'll select a check box that is labeled **Execute Code First Migrations (runs on application start)**.</span></span> <span data-ttu-id="2a090-261">Этот параметр задан, то процесс развертывания, чтобы автоматически настроить приложение *Web.config* файлов на целевом сервере, чтобы Code First использует `MigrateDatabaseToLatestVersion` класс инициализатора.</span><span class="sxs-lookup"><span data-stu-id="2a090-261">This setting causes the deployment process to automatically configure the application *Web.config* file on the destination server so that Code First uses the `MigrateDatabaseToLatestVersion` initializer class.</span></span>

<span data-ttu-id="2a090-262">Visual Studio не выполняет никаких действий с базой данных во время развертывания.</span><span class="sxs-lookup"><span data-stu-id="2a090-262">Visual Studio does not do anything with the database during the deployment process.</span></span> <span data-ttu-id="2a090-263">Когда развернутое приложение обращается к базе данных в первый раз после развертывания, Code First автоматически создает базу данных или обновляет схему базы данных до последней версии.</span><span class="sxs-lookup"><span data-stu-id="2a090-263">When the deployed application accesses the database for the first time after deployment, Code First automatically creates the database or updates the database schema to the latest version.</span></span> <span data-ttu-id="2a090-264">Если приложение поддерживает миграцию `Seed` метода, метод выполняется, после создания базы данных или обновления схемы.</span><span class="sxs-lookup"><span data-stu-id="2a090-264">If the application implements a Migrations `Seed` method, the method runs after the database is created or the schema is updated.</span></span>

<span data-ttu-id="2a090-265">Миграции `Seed` метод вставляет данные теста.</span><span class="sxs-lookup"><span data-stu-id="2a090-265">Your Migrations `Seed` method inserts test data.</span></span> <span data-ttu-id="2a090-266">При развертывании в рабочей среде, необходимо изменить `Seed` метода, так что он вставляет только те данные, необходимые для вставки в рабочей базы данных.</span><span class="sxs-lookup"><span data-stu-id="2a090-266">If you were deploying to a production environment, you would have to change the `Seed` method so that it only inserts data that you want to be inserted into your production database.</span></span> <span data-ttu-id="2a090-267">Например в текущей модели данных можно иметь реальные курсов, но вымышленной студентов в базе данных разработки.</span><span class="sxs-lookup"><span data-stu-id="2a090-267">For example, in your current data model you might want to have real courses but fictional students in the development database.</span></span> <span data-ttu-id="2a090-268">Можно написать `Seed` метод для загрузки в разработке и закомментируйте вымышленной учащихся перед развертыванием в рабочей среде.</span><span class="sxs-lookup"><span data-stu-id="2a090-268">You can write a `Seed` method to load both in development, and then comment out the fictional students before you deploy to production.</span></span> <span data-ttu-id="2a090-269">Или можно написать `Seed` для загрузки только курсы и вводить вымышленные студентов в тестовую базу данных вручную с помощью пользовательского интерфейса приложения.</span><span class="sxs-lookup"><span data-stu-id="2a090-269">Or you can write a `Seed` method to load only courses, and enter the fictional students in the test database manually by using the application's UI.</span></span>

### <a name="get-a-windows-azure-account"></a><span data-ttu-id="2a090-270">Получить учетную запись Windows Azure</span><span class="sxs-lookup"><span data-stu-id="2a090-270">Get a Windows Azure account</span></span>

<span data-ttu-id="2a090-271">Вам потребуется учетная запись Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="2a090-271">You'll need a Windows Azure account.</span></span> <span data-ttu-id="2a090-272">Если у вас еще нет один, можно создать бесплатную пробную учетную запись всего за несколько минут.</span><span class="sxs-lookup"><span data-stu-id="2a090-272">If you don't already have one, you can create a free trial account in just a couple of minutes.</span></span> <span data-ttu-id="2a090-273">Дополнительные сведения см. в разделе [бесплатная пробная версия Windows](https://azure.microsoft.com/free/?WT.mc_id=A443DD604).</span><span class="sxs-lookup"><span data-stu-id="2a090-273">For details, see [Windows Azure Free Trial](https://azure.microsoft.com/free/?WT.mc_id=A443DD604).</span></span>

### <a name="create-a-web-site-and-a-sql-database-in-windows-azure"></a><span data-ttu-id="2a090-274">Создание веб-сайта и базы данных SQL в Windows Azure</span><span class="sxs-lookup"><span data-stu-id="2a090-274">Create a web site and a SQL database in Windows Azure</span></span>

<span data-ttu-id="2a090-275">Веб-сайте Windows Azure будет выполняться в общей среде размещения, это означает, что он работает на виртуальных машинах (ВМ), которые являются общими с другими клиентами Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="2a090-275">Your Windows Azure Web Site will run in a shared hosting environment, which means it runs on virtual machines (VMs) that are shared with other Windows Azure clients.</span></span> <span data-ttu-id="2a090-276">Способ недорогих в общей среде размещения приступить к работе в облаке.</span><span class="sxs-lookup"><span data-stu-id="2a090-276">A shared hosting environment is a low-cost way to get started in the cloud.</span></span> <span data-ttu-id="2a090-277">Более поздней версии увеличивается веб-трафика, удовлетворяющее потребностям, запустив на выделенных виртуальных машин можно масштабировать приложение.</span><span class="sxs-lookup"><span data-stu-id="2a090-277">Later, if your web traffic increases, the application can scale to meet the need by running on dedicated VMs.</span></span> <span data-ttu-id="2a090-278">Если требуются более сложные архитектуры, можно перенести в облачную службу Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="2a090-278">If you need a more complex architecture, you can migrate to a Windows Azure Cloud Service.</span></span> <span data-ttu-id="2a090-279">Облачные службы запустите на выделенных виртуальных машин, которые можно настроить в соответствии с вашими потребностями.</span><span class="sxs-lookup"><span data-stu-id="2a090-279">Cloud services run on dedicated VMs that you can configure according to your needs.</span></span>

<span data-ttu-id="2a090-280">База данных SQL Windows Azure является службой реляционных баз данных на основе облака, основанное на технологии SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2a090-280">Windows Azure SQL Database is a cloud-based relational database service that is built on SQL Server technologies.</span></span> <span data-ttu-id="2a090-281">Средств и приложений, работающих с SQL Server также работают с базой данных SQL.</span><span class="sxs-lookup"><span data-stu-id="2a090-281">Tools and applications that work with SQL Server also work with SQL Database.</span></span>

1. <span data-ttu-id="2a090-282">В [портала управления Windows Azure](https://manage.windowsazure.com/), нажмите кнопку **веб-сайтов** в левой вкладке, а затем выберите **New**.</span><span class="sxs-lookup"><span data-stu-id="2a090-282">In the [Windows Azure Management Portal](https://manage.windowsazure.com/), click **Web Sites** in the left tab, and then click **New**.</span></span>

    ![Новая кнопка на портале управления](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image11.png)
2. <span data-ttu-id="2a090-284">Нажмите кнопку **НАСТРАИВАЕМОЕ создание**.</span><span class="sxs-lookup"><span data-stu-id="2a090-284">Click **CUSTOM CREATE**.</span></span>

    ![Создать ссылку на базу данных на портале управления](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image12.png)

 <span data-ttu-id="2a090-286">**Нового веб-сайта — настраиваемое создание** откроется мастер.</span><span class="sxs-lookup"><span data-stu-id="2a090-286">The **New Web Site - Custom Create** wizard opens.</span></span>
3. <span data-ttu-id="2a090-287">В **новый веб-сайт** шаг мастера введите строку в **URL-адрес** поле для использования в качестве уникальный URL-адрес для вашего приложения.</span><span class="sxs-lookup"><span data-stu-id="2a090-287">In the **New Web Site** step of the wizard, enter a string in the **URL** box to use as the unique URL for your application.</span></span> <span data-ttu-id="2a090-288">Полный URL-адрес будет состоять из, вводимая здесь и суффикса, которое будет отображаться рядом с текстовым полем.</span><span class="sxs-lookup"><span data-stu-id="2a090-288">The complete URL will consist of what you enter here plus the suffix that you see next to the text box.</span></span> <span data-ttu-id="2a090-289">На рисунке «ConU», но этот URL-адрес берется скорее всего, будет необходимо выбрать другой.</span><span class="sxs-lookup"><span data-stu-id="2a090-289">The illustration shows "ConU", but that URL is probably taken so you will have to choose a different one.</span></span>

    ![Создать ссылку на базу данных на портале управления](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image13.png)
4. <span data-ttu-id="2a090-291">В **область** раскрывающегося списка выберите регион, ближайший к вам.</span><span class="sxs-lookup"><span data-stu-id="2a090-291">In the **Region** drop-down list, choose a region close to you.</span></span> <span data-ttu-id="2a090-292">Этот параметр указывает каком веб-сайте будет выполняться в центре обработки данных.</span><span class="sxs-lookup"><span data-stu-id="2a090-292">This setting specifies which data center your web site will run in.</span></span>
5. <span data-ttu-id="2a090-293">В **базы данных** раскрывающегося списка выберите **создать бесплатную базу данных 20 МБ SQL**.</span><span class="sxs-lookup"><span data-stu-id="2a090-293">In the **Database** drop-down list, choose **Create a free 20 MB SQL database**.</span></span>

    ![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image14.png)
6. <span data-ttu-id="2a090-294">В **имя строки СОЕДИНЕНИЯ DB**, введите *SchoolContext*.</span><span class="sxs-lookup"><span data-stu-id="2a090-294">In the **DB CONNECTION STRING NAME**, enter *SchoolContext*.</span></span>

    ![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image15.png)
7. <span data-ttu-id="2a090-295">Щелкните стрелку, указывающую справа внизу окна.</span><span class="sxs-lookup"><span data-stu-id="2a090-295">Click the arrow that points to the right at the bottom of the box.</span></span> <span data-ttu-id="2a090-296">В мастере открывается **параметры базы данных** шаг.</span><span class="sxs-lookup"><span data-stu-id="2a090-296">The wizard advances to the **Database Settings** step.</span></span>
8. <span data-ttu-id="2a090-297">В **имя** введите *ContosoUniversityDB*.</span><span class="sxs-lookup"><span data-stu-id="2a090-297">In the **Name** box, enter *ContosoUniversityDB*.</span></span>
9. <span data-ttu-id="2a090-298">В **сервера** выберите **новой базы данных SQL server**.</span><span class="sxs-lookup"><span data-stu-id="2a090-298">In the **Server** box, select **New SQL Database server**.</span></span> <span data-ttu-id="2a090-299">Кроме того Если вы ранее был создан сервер, этот сервер можно выбрать из раскрывающегося списка.</span><span class="sxs-lookup"><span data-stu-id="2a090-299">Alternatively, if you previously created a server, you can select that server from the drop-down list.</span></span>
10. <span data-ttu-id="2a090-300">Введите администратор **имя входа** и **пароль**.</span><span class="sxs-lookup"><span data-stu-id="2a090-300">Enter an administrator **LOGIN NAME** and **PASSWORD**.</span></span> <span data-ttu-id="2a090-301">Если вы выбрали **новой базы данных SQL server** не ввода существующих имя и пароль для этой учетной записи, вводите новое имя и пароль, который вы определяете теперь для последующего использования при доступе к базе данных.</span><span class="sxs-lookup"><span data-stu-id="2a090-301">If you selected **New SQL Database server** you aren't entering an existing name and password here, you're entering a new name and password that you're defining now to use later when you access the database.</span></span> <span data-ttu-id="2a090-302">Если был выбран сервер, который вы создали ранее, будет введите учетные данные для этого сервера.</span><span class="sxs-lookup"><span data-stu-id="2a090-302">If you selected a server that you created previously, you'll enter credentials for that server.</span></span> <span data-ttu-id="2a090-303">В этом учебнике не будет выбран ***Дополнительно*** флажок.</span><span class="sxs-lookup"><span data-stu-id="2a090-303">For this tutorial, you won't select the ***Advanced*** check box.</span></span> <span data-ttu-id="2a090-304">***Дополнительно*** параметры можно использовать для настройки базы данных [сортировки](https://msdn.microsoft.com/en-us/library/aa174903(v=SQL.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="2a090-304">The ***Advanced*** options enable you to set the database [collation](https://msdn.microsoft.com/en-us/library/aa174903(v=SQL.80).aspx).</span></span>
11. <span data-ttu-id="2a090-305">Выбрать то же **область** , выбранное для веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="2a090-305">Choose the same **Region** that you chose for the web site.</span></span>
12. <span data-ttu-id="2a090-306">Щелкните значок галочки в правом нижнем углу используется для указания, что по завершении вы сможете.</span><span class="sxs-lookup"><span data-stu-id="2a090-306">Click the check mark at the bottom right of the box to indicate that you're finished.</span></span>   
  
    ![Шаг настройки базы данных для нового веб-сайта — создать с помощью мастера баз данных](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image16.png)  

 <span data-ttu-id="2a090-308">На следующем рисунке, используя существующий SQL Server и имя входа.</span><span class="sxs-lookup"><span data-stu-id="2a090-308">The following image shows using an existing SQL Server and Login.</span></span>   
  
    ![Шаг настройки базы данных для нового веб-сайта — создать с помощью мастера баз данных](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image17.png)  
  
 <span data-ttu-id="2a090-310">На портале управления возвращается на страницу веб-сайтов и **состояние** столбец показывает, что создается сайт.</span><span class="sxs-lookup"><span data-stu-id="2a090-310">The Management Portal returns to the Web Sites page, and the **Status** column shows that the site is being created.</span></span> <span data-ttu-id="2a090-311">Через некоторое время (обычно меньше, чем через минуту) **состояние** столбец показывает, что узел был успешно создан.</span><span class="sxs-lookup"><span data-stu-id="2a090-311">After a while (typically less than a minute), the **Status** column shows that the site was successfully created.</span></span> <span data-ttu-id="2a090-312">На панели навигации слева отображается число сайтов в вашей учетной записи имеется рядом с **веб-сайтов** значок и число баз данных отображается рядом с **баз данных SQL** значок.</span><span class="sxs-lookup"><span data-stu-id="2a090-312">In the navigation bar at the left, the number of sites you have in your account appears next to the **Web Sites** icon, and the number of databases appears next to the **SQL Databases** icon.</span></span>

## <a name="deploy-the-application-to-windows-azure"></a><span data-ttu-id="2a090-313">Развертывание приложения в Windows Azure</span><span class="sxs-lookup"><span data-stu-id="2a090-313">Deploy the application to Windows Azure</span></span>

1. <span data-ttu-id="2a090-314">В Visual Studio щелкните правой кнопкой мыши проект в **обозревателе решений** и выберите **публикации** в контекстном меню.</span><span class="sxs-lookup"><span data-stu-id="2a090-314">In Visual Studio, right-click the project in **Solution Explorer** and select **Publish** from the context menu.</span></span>  
  
    ![Публикация в контекстном меню проекта](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image18.png)
2. <span data-ttu-id="2a090-316">В **профиль** вкладке **веб-публикация** мастера, нажмите кнопку **импорта**.</span><span class="sxs-lookup"><span data-stu-id="2a090-316">In the **Profile** tab of the **Publish Web** wizard, click **Import**.</span></span>  
  
    ![Параметры импорта публикации](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image19.png)
3. <span data-ttu-id="2a090-318">Если вы не добавили ранее подписки Windows Azure в Visual Studio, выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="2a090-318">If you have not previously added your Windows Azure subscription in Visual Studio, perform the following steps.</span></span> <span data-ttu-id="2a090-319">В этом пошаговом руководстве, чтобы в раскрывающемся списке в группе, добавьте подписку **Импорт из веб-сайта Windows Azure** будет содержать веб-сайте.</span><span class="sxs-lookup"><span data-stu-id="2a090-319">In these steps you add your subscription so that the drop-down list under **Import from a Windows Azure web site** will include your web site.</span></span>

    <span data-ttu-id="2a090-320">1.</span><span class="sxs-lookup"><span data-stu-id="2a090-320">a.</span></span> <span data-ttu-id="2a090-321">В **Импорт профиля публикации** диалоговое окно, нажмите кнопку **Импорт из веб-сайта Windows Azure**, а затем нажмите кнопку **подписки Windows Azure, добавить**.</span><span class="sxs-lookup"><span data-stu-id="2a090-321">In the **Import Publish Profile** dialog box, click **Import from a Windows Azure web site**, and then click **Add Windows Azure subscription**.</span></span>

    ![Добавление подписки Windows Azure](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image20.png)

    <span data-ttu-id="2a090-323">2.</span><span class="sxs-lookup"><span data-stu-id="2a090-323">b.</span></span> <span data-ttu-id="2a090-324">В **импорта подписки Windows Azure** диалоговое окно, нажмите кнопку **загрузки файла подписки**.</span><span class="sxs-lookup"><span data-stu-id="2a090-324">In the **Import Windows Azure Subscriptions** dialog box, click **Download subscription file**.</span></span>

    ![загрузить файл подписки](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image21.png)

    <span data-ttu-id="2a090-326">В.</span><span class="sxs-lookup"><span data-stu-id="2a090-326">c.</span></span> <span data-ttu-id="2a090-327">В окне браузера, сохраните *.publishsettings* файла.</span><span class="sxs-lookup"><span data-stu-id="2a090-327">In your browser window, save the *.publishsettings* file.</span></span>

    ![Загрузите файл PUBLISHSETTINGS](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image22.png)

    > [!WARNING]
    > <span data-ttu-id="2a090-329">Безопасность — *publishsettings* файл содержит учетные данные (Незакодированные), используемые для управления подписками Windows Azure и служб.</span><span class="sxs-lookup"><span data-stu-id="2a090-329">Security - The *publishsettings* file contains your credentials (unencoded) that are used to administer your Windows Azure subscriptions and services.</span></span> <span data-ttu-id="2a090-330">Рекомендациям по безопасности для этого файла требуется временно сохранить за пределами исходных каталогов (например в *Libraries\Documents* папки), а затем удалите его после завершения операции импорта.</span><span class="sxs-lookup"><span data-stu-id="2a090-330">The security best practice for this file is to store it temporarily outside your source directories (for example in the *Libraries\Documents* folder), and then delete it once the import has completed.</span></span> <span data-ttu-id="2a090-331">Злоумышленник, получивший доступ к `.publishsettings` файл можно изменять, создавать и удалять службы Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="2a090-331">A malicious user who gains access to the `.publishsettings` file can edit, create, and delete your Windows Azure services.</span></span>

    <span data-ttu-id="2a090-332">Г.</span><span class="sxs-lookup"><span data-stu-id="2a090-332">d.</span></span> <span data-ttu-id="2a090-333">В **импорта подписки Windows Azure** диалоговое окно, нажмите кнопку **Обзор** и перейдите к *.publishsettings* файла.</span><span class="sxs-lookup"><span data-stu-id="2a090-333">In the **Import Windows Azure Subscriptions** dialog box, click **Browse** and navigate to the *.publishsettings* file.</span></span>

    ![Загрузите sub](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image23.png)

    <span data-ttu-id="2a090-335">Д.</span><span class="sxs-lookup"><span data-stu-id="2a090-335">e.</span></span> <span data-ttu-id="2a090-336">Нажмите кнопку **Импортировать**.</span><span class="sxs-lookup"><span data-stu-id="2a090-336">Click **Import**.</span></span>

    ![импорт](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image24.png)
4. <span data-ttu-id="2a090-338">В **Импорт профиля публикации** выберите **Импорт из веб-сайта Windows Azure**, выберите веб-сайт из раскрывающегося списка и нажмите кнопку **ОК**.</span><span class="sxs-lookup"><span data-stu-id="2a090-338">In the **Import Publish Profile** dialog box, select **Import from a Windows Azure web site**, select your web site from the drop-down list, and then click **OK**.</span></span>  
  
    ![Импорт профиля публикации](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image25.png)
5. <span data-ttu-id="2a090-340">В **подключения** щелкните **проверить подключение** чтобы убедиться в том, что настройки указаны верно.</span><span class="sxs-lookup"><span data-stu-id="2a090-340">In the **Connection** tab, click **Validate Connection** to make sure that the settings are correct.</span></span>  
  
    ![Проверка подключения](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image26.png)
6. <span data-ttu-id="2a090-342">После проверки подключения отображается рядом с зеленой галочкой **проверить подключение** кнопки.</span><span class="sxs-lookup"><span data-stu-id="2a090-342">When the connection has been validated, a green check mark is shown next to the **Validate Connection** button.</span></span> <span data-ttu-id="2a090-343">Нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="2a090-343">Click **Next**.</span></span>  
  
    ![Успешно проверенные соединения](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image27.png)
7. <span data-ttu-id="2a090-345">Откройте **строку подключения к удаленному** раскрывающегося списка в разделе **SchoolContext** и выберите строку подключения для базы данных, вы создали.</span><span class="sxs-lookup"><span data-stu-id="2a090-345">Open the **Remote connection string** drop-down list under **SchoolContext** and select the connection string for the database you created.</span></span>
8. <span data-ttu-id="2a090-346">Выберите **выполнять миграции Code First (запускается при запуске приложения)**.</span><span class="sxs-lookup"><span data-stu-id="2a090-346">Select **Execute Code First Migrations (runs on application start)**.</span></span>
9. <span data-ttu-id="2a090-347">Снимите флажок **использовать эту строку подключения во время выполнения** для **UserContext (DefaultConnection)**, поскольку это приложение не использует базы данных членства.</span><span class="sxs-lookup"><span data-stu-id="2a090-347">Uncheck **Use this connection string at runtime** for the **UserContext (DefaultConnection)**, since this application is not using the membership database.</span></span>   
  
    ![Вкладка "Параметры"](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image28.png)
10. <span data-ttu-id="2a090-349">Нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="2a090-349">Click **Next**.</span></span>
11. <span data-ttu-id="2a090-350">В **предварительного просмотра** щелкните **начать просмотр**.</span><span class="sxs-lookup"><span data-stu-id="2a090-350">In the **Preview** tab, click **Start Preview**.</span></span>  
  
    ![StartPreview кнопки на вкладке «Предварительный просмотр»](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image29.png)  
  
 <span data-ttu-id="2a090-352">Вкладка отображает список файлов, которые будут скопированы на сервер.</span><span class="sxs-lookup"><span data-stu-id="2a090-352">The tab displays a list of the files that will be copied to the server.</span></span> <span data-ttu-id="2a090-353">Предварительного просмотра не требуется для публикации приложения, но полезна функция следует учитывать.</span><span class="sxs-lookup"><span data-stu-id="2a090-353">Displaying the preview isn't required to publish the application but is a useful function to be aware of.</span></span> <span data-ttu-id="2a090-354">В этом случае не нужно выполнять никаких действий со списком файлов, который отображается.</span><span class="sxs-lookup"><span data-stu-id="2a090-354">In this case, you don't need to do anything with the list of files that is displayed.</span></span> <span data-ttu-id="2a090-355">При последующем развертывании этого приложения в этом списке будут только измененные файлы.</span><span class="sxs-lookup"><span data-stu-id="2a090-355">The next time you deploy this application, only the files that have changed will be in this list.</span></span>  
  
    ![Выходной файл StartPreview](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image30.png)
12. <span data-ttu-id="2a090-357">Нажмите кнопку **Опубликовать**.</span><span class="sxs-lookup"><span data-stu-id="2a090-357">Click **Publish**.</span></span>  
 <span data-ttu-id="2a090-358">Visual Studio начинает процесс копирования файлов на сервер Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="2a090-358">Visual Studio begins the process of copying the files to the Windows Azure server.</span></span>
13. <span data-ttu-id="2a090-359">**Вывода** окно показывает выполненные действия развертывания и сообщает успешного завершения развертывания.</span><span class="sxs-lookup"><span data-stu-id="2a090-359">The **Output** window shows what deployment actions were taken and reports successful completion of the deployment.</span></span>  
  
    ![Успешное развертывание модуля создания отчетов в окне вывода](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image31.png)
14. <span data-ttu-id="2a090-361">После успешного развертывания браузер по умолчанию автоматически открывается на URL-адрес развернутой веб-сайта.</span><span class="sxs-lookup"><span data-stu-id="2a090-361">Upon successful deployment, the default browser automatically opens to the URL of the deployed web site.</span></span>  
 <span data-ttu-id="2a090-362">Созданное приложение теперь работает в облаке.</span><span class="sxs-lookup"><span data-stu-id="2a090-362">The application you created is now running in the cloud.</span></span> <span data-ttu-id="2a090-363">Перейдите на вкладку учащихся.</span><span class="sxs-lookup"><span data-stu-id="2a090-363">Click the Students tab.</span></span>  
  
    ![Students_index_page_with_paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image32.png)

<span data-ttu-id="2a090-365">На этом этапе вашей *SchoolContext* база данных создана в базе данных SQL Windows Azure, так как вы выбрали **выполнять миграции Code First (запускается при запуске приложения)**.</span><span class="sxs-lookup"><span data-stu-id="2a090-365">At this point your *SchoolContext* database has been created in the Windows Azure SQL Database because you selected **Execute Code First Migrations (runs on app start)**.</span></span> <span data-ttu-id="2a090-366">*Web.config* файл развернутого веб-сайте был изменен, чтобы [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/en-us/library/hh829476(v=vs.103).aspx) инициализатор будет запускать при первом кода считывает или записывает данные в базе данных (который произошло при выборе **учащихся** вкладка):</span><span class="sxs-lookup"><span data-stu-id="2a090-366">The *Web.config* file in the deployed web site has been changed so that the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/en-us/library/hh829476(v=vs.103).aspx) initializer would run the first time your code reads or writes data in the database (which happened when you selected the **Students** tab):</span></span>

![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image33.png)

<span data-ttu-id="2a090-367">Процесс развертывания также создается новая строка подключения *(SchoolContext\_DatabasePublish*) для миграции Code First для обновления схемы базы данных и заполнения базы данных.</span><span class="sxs-lookup"><span data-stu-id="2a090-367">The deployment process also created a new connection string *(SchoolContext\_DatabasePublish*) for Code First Migrations to use for updating the database schema and seeding the database.</span></span>

![Строка подключения Database_Publish](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image34.png)

<span data-ttu-id="2a090-369">*DefaultConnection* строка подключения предназначена для базы данных членства (которая не используются в этом учебнике).</span><span class="sxs-lookup"><span data-stu-id="2a090-369">The *DefaultConnection* connection string is for the membership database (which we are not using in this tutorial).</span></span> <span data-ttu-id="2a090-370">*SchoolContext* строка подключения предназначена для ContosoUniversity базы данных.</span><span class="sxs-lookup"><span data-stu-id="2a090-370">The *SchoolContext* connection string is for the ContosoUniversity database.</span></span>

<span data-ttu-id="2a090-371">Можно найти в файл Web.config на локальном компьютере в развернутой версии *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. Доступ к развернутой *Web.config* самом файле по протоколу FTP.</span><span class="sxs-lookup"><span data-stu-id="2a090-371">You can find the deployed version of the Web.config file on your own computer in *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. You can access the deployed *Web.config* file itself by using FTP.</span></span> <span data-ttu-id="2a090-372">Инструкции см. в разделе [ASP.NET веб-развертывания с помощью Visual Studio: развертывание обновления кода](../../../../web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update.md).</span><span class="sxs-lookup"><span data-stu-id="2a090-372">For instructions, see [ASP.NET Web Deployment using Visual Studio: Deploying a Code Update](../../../../web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update.md).</span></span> <span data-ttu-id="2a090-373">Следуйте инструкциям, которые начинаются с «Чтобы использовать средство FTP, необходимы три вещи: URL-адрес FTP, имя пользователя и пароль.»</span><span class="sxs-lookup"><span data-stu-id="2a090-373">Follow the instructions that start with "To use an FTP tool, you need three things: the FTP URL, the user name, and the password."</span></span>

> [!NOTE]
> <span data-ttu-id="2a090-374">Веб-приложение не реализует безопасности, поэтому любой пользователь находит URL-адрес можно изменить данные.</span><span class="sxs-lookup"><span data-stu-id="2a090-374">The web app doesn't implement security, so anyone who finds the URL can change the data.</span></span> <span data-ttu-id="2a090-375">Инструкции по защите веб-сайта см. в разделе [развертывание приложения безопасного ASP.NET MVC с членством, OAuth и базы данных SQL для веб-сайта Windows Azure](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span><span class="sxs-lookup"><span data-stu-id="2a090-375">For instructions on how to secure the web site, see [Deploy a Secure ASP.NET MVC app with Membership, OAuth, and SQL Database to a Windows Azure Web Site](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span></span> <span data-ttu-id="2a090-376">Отключать других пользователей, с помощью сайта с помощью портала управления Windows Azure или **обозревателя серверов** в Visual Studio, чтобы остановить сайт.</span><span class="sxs-lookup"><span data-stu-id="2a090-376">You can prevent other people from using the site by using the Windows Azure Management Portal or **Server Explorer** in Visual Studio to stop the site.</span></span>


![](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image35.png)

## <a name="code-first-initializers"></a><span data-ttu-id="2a090-377">Инициализаторы первого кода</span><span class="sxs-lookup"><span data-stu-id="2a090-377">Code First Initializers</span></span>

<span data-ttu-id="2a090-378">В разделе «развертывание», вы видели [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/en-us/library/hh829476(v=vs.103).aspx) используется инициализатор.</span><span class="sxs-lookup"><span data-stu-id="2a090-378">In the deployment section you saw the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/en-us/library/hh829476(v=vs.103).aspx) initializer being used.</span></span> <span data-ttu-id="2a090-379">Код сначала также предоставляет другие инициализаторы, которые можно использовать, включая [CreateDatabaseIfNotExists](https://msdn.microsoft.com/en-us/library/gg679221(v=vs.103).aspx) (по умолчанию), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/en-us/library/gg679604(v=VS.103).aspx) и [ DropCreateDatabaseAlways](https://msdn.microsoft.com/en-us/library/gg679506(v=VS.103).aspx).</span><span class="sxs-lookup"><span data-stu-id="2a090-379">Code First also provides other initializers that you can use, including [CreateDatabaseIfNotExists](https://msdn.microsoft.com/en-us/library/gg679221(v=vs.103).aspx) (the default), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/en-us/library/gg679604(v=VS.103).aspx) and [DropCreateDatabaseAlways](https://msdn.microsoft.com/en-us/library/gg679506(v=VS.103).aspx).</span></span> <span data-ttu-id="2a090-380">`DropCreateAlways` Инициализатор может быть полезна при настройке условий для модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="2a090-380">The `DropCreateAlways` initializer can be useful for setting up conditions for unit tests.</span></span> <span data-ttu-id="2a090-381">Можно также написать собственную инициализаторы и инициализатор можно вызвать явным образом, если не нужно подождать, пока приложение для чтения и записи в базу данных.</span><span class="sxs-lookup"><span data-stu-id="2a090-381">You can also write your own initializers, and you can call an initializer explicitly if you don't want to wait until the application reads from or writes to the database.</span></span> <span data-ttu-id="2a090-382">Подробное объяснение инициализаторы в главе 6 книги [программирования платформы Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) Джули Лерман и Миллер Роуэном.</span><span class="sxs-lookup"><span data-stu-id="2a090-382">For a comprehensive explanation of initializers, see chapter 6 of the book [Programming Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) by Julie Lerman and Rowan Miller.</span></span>

## <a name="summary"></a><span data-ttu-id="2a090-383">Сводка</span><span class="sxs-lookup"><span data-stu-id="2a090-383">Summary</span></span>

<span data-ttu-id="2a090-384">В этом учебнике вы знаете, как создать модель данных и реализации основных CRUD, сортировку, фильтрацию, разбиение по страницам и группировку функциональности.</span><span class="sxs-lookup"><span data-stu-id="2a090-384">In this tutorial you've seen how to create a data model and implement basic CRUD, sorting, filtering, paging, and grouping functionality.</span></span> <span data-ttu-id="2a090-385">В следующем уроке вы начнете, просмотрев более сложные вопросы, развернув модели данных.</span><span class="sxs-lookup"><span data-stu-id="2a090-385">In the next tutorial you'll begin looking at more advanced topics by expanding the data model.</span></span>

<span data-ttu-id="2a090-386">Ссылки на другие ресурсы Entity Framework можно найти в [Карта содержимого для доступа к данным ASP.NET](../../../../whitepapers/aspnet-data-access-content-map.md).</span><span class="sxs-lookup"><span data-stu-id="2a090-386">Links to other Entity Framework resources can be found in the [ASP.NET Data Access Content Map](../../../../whitepapers/aspnet-data-access-content-map.md).</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="2a090-387">[Назад](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application.md)
[Вперед](creating-a-more-complex-data-model-for-an-asp-net-mvc-application.md)</span><span class="sxs-lookup"><span data-stu-id="2a090-387">[Previous](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application.md)
[Next](creating-a-more-complex-data-model-for-an-asp-net-mvc-application.md)</span></span>
