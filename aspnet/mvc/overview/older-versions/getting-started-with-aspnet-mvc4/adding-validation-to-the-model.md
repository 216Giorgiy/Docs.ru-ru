---
uid: mvc/overview/older-versions/getting-started-with-aspnet-mvc4/adding-validation-to-the-model
title: "Добавление проверки для модели | Документы Microsoft"
author: Rick-Anderson
description: "Примечание: Обновленную версию этого учебника доступен здесь, использующий ASP.NET MVC 5 и Visual Studio 2013. Это более безопасный, гораздо проще выполните и демонстрационных..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/28/2012
ms.topic: article
ms.assetid: 5d9a2999-fcc4-4c45-a018-271fddf74a3b
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions/getting-started-with-aspnet-mvc4/adding-validation-to-the-model
msc.type: authoredcontent
ms.openlocfilehash: 93b4df5fcbde8d87866d00dffda8a241d0dd596b
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/24/2018
---
<a name="adding-validation-to-the-model"></a>Добавление проверки для модели
====================
По [Рик Андерсон](https://github.com/Rick-Anderson)

> > [!NOTE]
> > Доступна обновленная версия этого учебника [здесь](../../getting-started/introduction/getting-started.md) , с использованием ASP.NET MVC 5 и Visual Studio 2013. Он является более безопасны, выполните гораздо проще и показаны дополнительные возможности.


В этом в этом разделе вы добавите логику проверки в `Movie` модель и необходимо убедиться, что правила проверки применяются каждый раз при попытке создать или изменить фильм, с помощью приложения.

## <a name="keeping-things-dry"></a>Чтобы оставить ТОНЕРА

Одна из основных принципов разработки ASP.NET MVC — ПРОБНОГО (&quot;не повторяться&quot;). ASP.NET MVC рекомендует как можно указать только один раз возможности или поведение и включить его everywhere отражаться в приложении. Это уменьшает объем кода, который необходимо написать и делает код, который вы написали менее подвержен ошибкам и проще.

Поддержка проверки в ASP.NET MVC и Entity Framework Code First является отличным примером ТОНЕРА принципа в действии. Правила проверки можно задать декларативно в одном месте (в класс модели) и правила применяются везде в приложении.

Давайте взглянем на как можно воспользоваться преимуществами этой поддержки проверки в приложении фильма.

## <a name="adding-validation-rules-to-the-movie-model"></a>Добавление правил проверки модели фильма

Сначала добавить некоторую логику проверки для `Movie` класса.

Откройте файл *Movie.cs*. Добавить `using` инструкции в верхней части файла, который ссылается на [ `System.ComponentModel.DataAnnotations` ](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.aspx) пространство имен:

[!code-csharp[Main](adding-validation-to-the-model/samples/sample1.cs)]

Обратите внимание на то, пространство имен не содержит `System.Web`. DataAnnotations предоставляет встроенный набор атрибутов проверки, которые декларативно применяются к любому классу или свойству.

Теперь обновите `Movie` класса, чтобы воспользоваться преимуществами встроенной [ `Required` ](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.requiredattribute.aspx), [ `StringLength` ](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.stringlengthattribute.aspx), и [ `Range` ](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.rangeattribute.aspx) атрибутов проверки . В качестве примера для применения атрибутов, используйте следующий код.

[!code-csharp[Main](adding-validation-to-the-model/samples/sample2.cs?highlight=4,10,13,17)]

Запустите приложение и снова возникнет следующая ошибка времени выполнения:

***Модель резервного контекст «MovieDBContext» изменилось с момента создания базы данных. Рассмотрите возможность обновления базы данных с помощью Code First Migrations ([https://go.microsoft.com/fwlink/?LinkId=238269](https://go.microsoft.com/fwlink/?LinkId=238269)).***

Мы будем использовать миграции для обновления схемы. Постройте решение, а затем откройте **консоль диспетчера пакетов** окно и введите следующие команды:

[!code-console[Main](adding-validation-to-the-model/samples/sample3.cmd)]

По завершении этой команды Visual Studio открывает файл класса, который определяет новый `DbMIgration` производного класса с заданным именем (*AddDataAnnotationsMig*) и в `Up` метода можно просмотреть код, который обновляет ограничения схемы. `Title` И `Genre` поля больше не допускает значения NULL (то есть, необходимо ввести значение) и `Rating` поле не должно превышать 5.

Атрибуты проверки определяют поведение для свойств модели, к которым они применяются. `Required` Атрибут указывает, что свойство должно иметь значение; в этом образце фильм должен иметь значения для `Title`, `ReleaseDate`, `Genre`, и `Price` свойства, чтобы быть допустимыми. Атрибут `Range` ограничивает диапазон значений. Атрибут `StringLength` позволяет задать максимальную и при необходимости минимальную длину строкового свойства. Встроенные типы (такие как `decimal, int, float, DateTime`) требуются по умолчанию и нет необходимости `Required` атрибута.

Код сначала проверяет, применение правил проверки, заданные на класс модели перед приложение сохраняет изменения в базе данных. Например, в приведенном ниже коде возникает исключение при `SaveChanges` вызывается метод, так как некоторые необходимые `Movie` отсутствуют значения свойств и цена равно нулю (то выходит за пределы допустимого диапазона).

[!code-csharp[Main](adding-validation-to-the-model/samples/sample4.cs?highlight=7-8)]

С платформой .NET Framework автоматически применяются правила проверки помогает сделать приложение более надежным. Это также гарантирует, что в любом случае будут выполнены все проверки и в базе данных не будут случайно оставлены поврежденные данные.

Ниже приведен полный код для обновленного *Movie.cs* файла:

[!code-csharp[Main](adding-validation-to-the-model/samples/sample5.cs)]

## <a name="validation-error-ui-in-aspnet-mvc"></a>Ошибка проверки пользовательского интерфейса в ASP.NET MVC

Повторно запустите приложение и перейдите к */Movies* URL-адрес.

Нажмите кнопку **создать новый** ссылку, чтобы добавить новый фильма. Заполните форму с некоторые недопустимые значения, а затем нажмите кнопку **создать** кнопки.

![8_validationErrors](adding-validation-to-the-model/_static/image1.png)

> [!NOTE]
> Поддержка проверки jQuery для языков, кроме английского, используйте запятую (&quot;,&quot;) для десятичной запятой, необходимо включить *globalize.js* и конкретных *cultures/globalize.cultures.js* файл (из [https://github.com/jquery/globalize](https://github.com/jquery/globalize) ) и JavaScript, чтобы использовать `Globalize.parseFloat`. В следующем коде показано изменения в файле Views\Movies\Edit.cshtml для работы с &quot;fr-FR&quot; языка и региональных параметров:


[!code-cshtml[Main](adding-validation-to-the-model/samples/sample6.cshtml)]

Обратите внимание, как форма автоматически использовал цвет красной границей выделять текстовые поля, содержащие недопустимые данные и испускаемого соответствующее сообщение об ошибке проверки рядом с каждой. Эти ошибки применяются как на стороне клиента (с помощью JavaScript и jQuery), так и на стороне сервера (если пользователь отключает JavaScript).

Реальное преимущество имеет нет необходимости ни одной строки кода в `MoviesController` класса или в *Create.cshtml* представления для включения проверки пользовательского интерфейса. В контроллере и представлениях, создаваемых в рамках этого руководства, автоматически применяются правила проверки, для определения которых к свойствам класса модели `Movie` были применены атрибуты.

Вы могли заметить для свойств `Title` и `Genre`, необходимый атрибут не применяется принудительно до отправки формы (попаданий **создать** кнопки), или введите текст в поле ввода и она удалена. Которая изначально пуста (например, поля для создания представления) и содержит только необходимый атрибут и нет других атрибутов проверки для поля можно выполнить следующую команду для запуска проверки:

1. Нажатием клавиши TAB в поле.
2. Введите любой текст.
3. Нажатием клавиши TAB out.
4. Перейти обратно в поле.
5. Удалите текст.
6. Нажатием клавиши TAB out.

Порядок операций будет активировать проверку без нажатие кнопки "Отправить". Просто нажатие кнопки "Отправить" без ввода любое поле, запускающих проверки на стороне клиента. Данные формы передаются на сервер только после того, как будут устранены любые ошибки на стороне клиента. Это можно проверить, разместить точки останова в методе HTTP Post или используя [инструмента fiddler](http://fiddler2.com/fiddler2/) или IE 9 [средств разработчика F12](https://msdn.microsoft.com/ie/aa740478).

![](adding-validation-to-the-model/_static/image2.png)

## <a name="how-validation-occurs-in-the-create-view-and-create-action-method"></a>О том, как проверка происходит в создания, просмотра и создания метода действия

Вам может быть интересно, как пользовательский интерфейс проверки создается без обновления кода контроллера или представлений. Далее показан что `Create` методы в `MovieController` класса, как будет выглядеть. Они отличается от способа их создания ранее в этом учебнике.

[!code-csharp[Main](adding-validation-to-the-model/samples/sample7.cs?highlight=12,15)]

Первый метод действия `Create` (HTTP GET) отображает исходную форму создания. Вторая версия (`[HttpPost]`) обрабатывает передачу формы. Второй метод `Create` (версия `HttpPost`) вызывает `ModelState.IsValid`, который определяет наличие ошибок проверки в фильме. При вызове этого метода оцениваются все атрибуты проверки, которые были применены к объекту. При наличии ошибок проверки в объекте метод `Create` повторно отображает форму. Если ошибок нет, метод сохраняет новый фильм в базе данных. В нашем примере фильм, мы используем **формы не отправляется на сервер при наличии ошибок проверки, обнаруженных на стороне клиента; второй** `Create` **никогда не вызывается метод**. Если отключить JavaScript в браузере, проверка клиента отключена и HTTP POST `Create` вызовы метода `ModelState.IsValid` , чтобы проверить, имеет ли фильма ошибок проверки.

Вы можете установить точку останова в метод `HttpPost Create` и убедиться, что он не вызывается и данные формы не передаются, если на стороне клиента присутствуют ошибки проверки. Если отключить JavaScript в браузере и отправить форму с ошибками, будет достигнута точка останова. Без JavaScript вы по-прежнему будете получать полную проверку. На рисунке показано, как отключить JavaScript в Internet Explorer.

![](adding-validation-to-the-model/_static/image3.png)

![](adding-validation-to-the-model/_static/image4.png)

На следующем рисунке показано, как отключить JavaScript в браузере FireFox.

![](adding-validation-to-the-model/_static/image5.png)

На рисунке показано, как отключить JavaScript с помощью браузера Chrome.

![](adding-validation-to-the-model/_static/image6.png)

Ниже приведен *Create.cshtml* представление шаблон, который вы формирования шаблонов ранее в этом учебнике. Он используется в показанных выше методах действия для отображения исходной формы и повторного вывода формы в случае ошибки.

[!code-cshtml[Main](adding-validation-to-the-model/samples/sample8.cshtml?highlight=22-23,30-31,38-39,46-47)]

Обратите внимание на то, как код использует `Html.EditorFor` вспомогательный метод для вывода `<input>` для каждого элемента `Movie` свойство. Рядом с этого вспомогательного объекта представляет собой вызов `Html.ValidationMessageFor` вспомогательный метод. Эти два вспомогательных метода работы с объект модели, который передается по контроллера в представление (в этом случае `Movie` объекта). Они автоматически выполняют поиск проверки атрибутов, указанных в модели отображения сообщения об ошибках и соответствующим образом.

Что очень удобно об этом подходе является, что контроллер ни Просмотр шаблона создать знает ничего о применяются правила проверки или отображаются сообщения об ошибках. Правила проверки и строки ошибок указываются только в классе `Movie`. Представление изменения и других представлений шаблонов, можно создать, изменить модель автоматически применяются такие же правила проверки.

Если вы хотите изменить логику проверки позднее, вы ее можно сделать только в одном месте путем добавления атрибутов проверки для модели (в этом примере `movie` класса). Вам не придется беспокоиться о несогласованности применения правил в различных частях приложения, поскольку вся логика проверки будет определена в одном месте и начнет применяться по всему приложению. Это позволяет максимально оптимизировать код и обеспечить удобство его совершенствования и поддержки. А это означает, что вы будете полностью учитывая ТОНЕРА принцип.

## <a name="adding-formatting-to-the-movie-model"></a>Добавление форматирования к модели фильма

Откройте файл *Movie.cs* и проверьте класс `Movie`. [ `System.ComponentModel.DataAnnotations` ](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.aspx) Пространство имен содержит атрибуты форматирования помимо встроенный набор атрибутов проверки. Мы уже использовали [ `DataType` ](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.datatype.aspx) значение перечисления для даты выпуска и поля цены. В следующем коде показано `ReleaseDate` и `Price` свойства с помощью соответствующих [ `DisplayFormat` ](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.displayformatattribute.aspx) атрибута.

[!code-csharp[Main](adding-validation-to-the-model/samples/sample9.cs)]

[ `DataType` ](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.datatype.aspx) Атрибуты не являются атрибутами проверки, они используются для определить обработчик представлений, Подготовка к просмотру HTML. В приведенном выше примере `DataType.Date` атрибут отображает фильма даты в виде даты, без времени. Например, следующая [ `DataType` ](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.datatype.aspx) атрибуты не проверки формата данных:

[!code-csharp[Main](adding-validation-to-the-model/samples/sample10.cs)]

Атрибуты, перечисленные выше только предоставить подсказки для обработчика представлений для форматирования данных (и укажите атрибуты, такие как &lt;&gt; для URL-адреса и &lt;href =&quot;mailto:EmailAddress.com&quot; &gt; для электронной почты. Можно использовать [регулярное выражение](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.regularexpressionattribute.aspx) атрибут для проверки формата данных.

Альтернативный подход к использованию `DataType` атрибутов, можно явно задать [ `DataFormatString` ](https://msdn.microsoft.com/library/system.string.format.aspx) значение. В следующем коде показано свойство даты выпуска с помощью строки формата даты (а именно, &quot;d&quot;). Это будет использовать для указания, что вы не хотите времени как часть даты выпуска.

[!code-csharp[Main](adding-validation-to-the-model/samples/sample11.cs)]

Полный `Movie` класса приведен ниже.

[!code-csharp[Main](adding-validation-to-the-model/samples/sample12.cs)]

Запустите приложение и перейдите к `Movies` контроллера. Дата выпуска и цена хорошо формате. На рисунке ниже показана дата выпуска и с помощью цены &quot;fr-FR&quot; языку и региональным параметрам.

![8_format_SM](adding-validation-to-the-model/_static/image7.png)

На следующем рисунке показаны те же данные, которые отображаются с языком и региональными параметрами по умолчанию (Американский английский).

![](adding-validation-to-the-model/_static/image8.png)

В следующей части этой серии мы рассмотрим приложение и внесем ряд изменений в автоматически создаваемые методы `Details` и `Delete`.

>[!div class="step-by-step"]
[Назад](adding-a-new-field-to-the-movie-model-and-table.md)
[Вперед](examining-the-details-and-delete-methods.md)
