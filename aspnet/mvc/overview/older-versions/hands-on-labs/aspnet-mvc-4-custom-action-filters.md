---
uid: mvc/overview/older-versions/hands-on-labs/aspnet-mvc-4-custom-action-filters
title: ASP.NET MVC 4 настраиваемых фильтров действий | Документы Microsoft
author: rick-anderson
description: ASP.NET MVC предоставляет фильтры действий для выполнения логику фильтрации до или после вызова метода действия. Фильтры действий представляют собой пользовательские атрибуты tha...
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/18/2013
ms.topic: article
ms.assetid: 969ab824-1b98-4552-81fe-b60ef5fc6887
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions/hands-on-labs/aspnet-mvc-4-custom-action-filters
msc.type: authoredcontent
ms.openlocfilehash: 8b135b23aea64b0c7c7d4368eef9ee80914159e4
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
ms.locfileid: "30877714"
---
# <a name="aspnet-mvc-4-custom-action-filters"></a>ASP.NET MVC 4 настраиваемых фильтров действий

По [Web лагеря команды](https://twitter.com/webcamps)

[Загрузите комплект учебных материалов лагеря Web](https://aka.ms/webcamps-training-kit)

ASP.NET MVC предоставляет фильтры действий для выполнения логику фильтрации до или после вызова метода действия. Фильтры действий представляют собой пользовательские атрибуты, позволяющие декларативным образом добавлять поведение до и после действия в методы действий контроллера.

В этой лаборатории практических создаст атрибут фильтра настраиваемое действие в MvcMusicStore решение для перехвата запросов контроллера и регистрирует действия узла в таблицу базы данных. Можно добавить любой контроллер или действие фильтра ведения журнала путем внедрения кода. Наконец вы увидите представление журнала, где отображается список посетителей.

Это Практическое лабораторное занятие предполагает иметь базовые знания об **ASP.NET MVC**. Если вы не использовали **ASP.NET MVC** раньше, мы рекомендуем перейти **ASP.NET MVC 4 основы** Практическое лабораторное занятие.

> [!NOTE]
> Все образцы кода и фрагменты кода включаются в Web лагеря комплект учебных материалов, доступные в [выпуски Microsoft Web/WebCampTrainingKit](https://aka.ms/webcamps-training-kit). Проект для этой лаборатории доступен на [действия настраиваемые фильтры для ASP.NET MVC 4](https://github.com/Microsoft-Web/HOL-MVC4CustomActionFilters).

<a id="Objectives"></a>
### <a name="objectives"></a>Цели

В этой лаборатории практических вы узнаете, как:

- Создайте атрибут фильтра настраиваемого действия, чтобы расширить возможности фильтрации
- Применение пользовательского атрибута фильтра путем внедрения кода до определенного уровня
- Регистрация пользовательских фильтров действий глобально

<a id="Prerequisites"></a>

<a id="Prerequisites"></a>
### <a name="prerequisites"></a>Предварительные требования

Необходимо иметь следующие элементы для этой лаборатории.

- [Microsoft Visual Studio Express 2012 для Web](https://www.microsoft.com/visualstudio/eng/products/visual-studio-express-for-web) или выше (чтение [приложение A](#AppendixA) инструкции по его установке).

<a id="Setup"></a>

<a id="Setup"></a>
### <a name="setup"></a>Установка

**Установка фрагменты кода**

Для удобства большая часть кода, который вы планируете управлять вдоль этой лаборатории доступна как фрагменты кода Visual Studio. Чтобы установить фрагменты кода запуска **.\Source\Setup\CodeSnippets.vsi** файла.

Если вы не знакомы с фрагментов кода Visual Studio и хотите узнать о способах их использования, можно ссылаться в приложение из этого документа &quot; [фрагменты кода с помощью приложение C:](#AppendixC)&quot;.

* * *

<a id="Exercises"></a>

<a id="Exercises"></a>
## <a name="exercises"></a>Упражнения

Это Практическое лабораторное занятие состоит в выполнении следующих упражнений.

1. [Упражнение 1: Ведение журнала действий](#Exercise1)
2. [Упражнение 2: Управление нескольких фильтров](#Exercise2)

Предполагаемое время для выполнения этого занятия: **30 минут**.

> [!NOTE]
> Каждого упражнения сопровождается **окончания** папку, содержащую полученное в результате решение, должен быть получен после завершения выполнения упражнений. Это решение можно использовать как руководство, если вам нужна дополнительная помощь при выполнении упражнений.


<a id="Exercise1"></a>

<a id="Exercise_1_Logging_Actions"></a>
### <a name="exercise-1-logging-actions"></a>Упражнение 1: Ведение журнала действий

В этом упражнении вы узнаете, как для создания пользовательского журнала фильтра действий с помощью поставщики фильтров ASP.NET MVC 4. Для этой цели будет применен фильтр ведения журнала на сайт MusicStore, регистрировать все действия в выбранных контроллеров.

Будет расширить фильтр **ActionFilterAttributeClass** и Переопределите **OnActionExecuting** метод перехватывать каждый запрос, а затем выполнять ведение журнала действий. Контекстные сведения об HTTP-запросов, выполнение методов, результаты и параметры будут предоставляться ASP.NET MVC **ActionExecutingContext** класса **.**

> [!NOTE]
> ASP.NET MVC 4 также имеет поставщики фильтров по умолчанию, которые можно использовать без создания пользовательского фильтра. ASP.NET MVC 4 предоставляет следующие типы фильтров:
> 
> - **Авторизация** фильтрации, что делает безопасности решений о необходимости выполнения метода действия, такие как выполнение проверки подлинности или проверки свойств запроса.
> - **Действие** фильтр, который создает оболочку для выполнения метода действия. Этот фильтр может выполнять дополнительную обработку, например предоставлять дополнительные данные методу действия, инспектировать возвращаемое значение или отменять выполнение метода действия
> - **Результат** фильтр, который является оболочкой для исполнения объекта ActionResult. Этот фильтр может выполнять дополнительную обработку результата, например изменить HTTP-ответа.
> - **Исключение** фильтр, который выполняется при наличии необработанного исключения в методе действия, начиная с фильтры авторизации и заканчивая выполнением результата. Фильтры исключений можно использовать для ведения журнала или отображения страниц об ошибках.
> 
> Дополнительные сведения о поставщиках фильтры посетите эту ссылку MSDN: ([https://msdn.microsoft.com/library/dd410209.aspx](https://msdn.microsoft.com/library/dd410209.aspx)).


<a id="AboutLoggingFeature"></a>

<a id="About_MVC_Music_Store_Application_logging_feature"></a>
#### <a name="about-mvc-music-store-application-logging-feature"></a>О функции ведения журнала хранилища музыка MVC-приложения

Это решение Music Store имеет новую таблицу модели данных для ведения журнала для сайта, **ActionLog**, со следующими полями: имя контроллера, который получил запрос, вызываемые действия, IP-адрес клиента и отметки времени.

![Модель данных. Таблица ActionLog. ](aspnet-mvc-4-custom-action-filters/_static/image1.png "Модели данных. Таблица ActionLog.")

*Модель данных — ActionLog таблицы*

Решение обеспечивает представление MVC ASP.NET в журнал действий, можно найти в **MvcMusicStores/представления/ActionLog**:

![Просмотр журнала действий](aspnet-mvc-4-custom-action-filters/_static/image2.png "представление журнала действий")

*Просмотр журнала действий*

Таким образом получает структуры вся работа будет фокус ввода на прерывания запроса контроллера и выполнения ведения журнала с помощью пользовательских фильтрации.

<a id="Ex1Task1"></a>

<a id="Task_1_-_Creating_a_Custom_Filter_to_Catch_a_Controllers_Request"></a>
#### <a name="task-1---creating-a-custom-filter-to-catch-a-controllers-request"></a>Задача 1. Создание пользовательского фильтра для перехвата запроса контроллера

В этой задаче вы создадите класс атрибут пользовательского фильтра, который будет содержать логику занесения данных. Для этой цели можно расширить ASP.NET MVC **ActionFilterAttribute** класса и реализуйте интерфейс **IActionFilter**.

> [!NOTE]
> **ActionFilterAttribute** является базовым классом для всех атрибутов фильтров. Он предоставляет следующие методы для выполнения определенной логики после и перед выполнением действия контроллера:
> 
> - **OnActionExecuting**(ActionExecutingContext filterContext): метод вызывается непосредственно перед действие.
> - **OnActionExecuted**(ActionExecutedContext filterContext): после вызова метода действия и перед выполнением результат (до отображения представления).
> - **OnResultExecuting**(ResultExecutingContext filterContext): перед выполняется результат (до отображения представления).
> - **OnResultExecuted**(ResultExecutedContext filterContext): после выполнения результата (после визуализации представления).
> 
> Путем переопределения любого из этих методов в производном классе, выполнением кода фильтрации.


1. Откройте **начать** решений, расположенный **\Source\Ex01-LoggingActions\Begin** папки.

   1. Необходимо будет загрузить несколько отсутствующих пакетов NuGet, прежде чем продолжить. Чтобы сделать это, нажмите кнопку **проекта** и выбрать пункт **управление пакетами NuGet**.
   2. В **управление пакетами NuGet** диалоговое окно, нажмите кнопку **восстановить** чтобы скачивать отсутствующие пакеты.
   3. Наконец, постройте решение, нажав кнопку **построения** | **построить решение**.

      > [!NOTE]
      > Одним из преимуществ использования NuGet является у вас не указан для отправки всех библиотек в вашем проекте, уменьшив размер проекта. С помощью NuGet Power Tools указав версий пакета в файле Packages.config можно для загрузки всех необходимых библиотек первый раз, при запуске проекта. Вот почему необходимо будет выполнить эти шаги после открытия существующего решения в этой лаборатории.
      > 
      > Дополнительные сведения см. в разделе этой статьи: [ http://docs.nuget.org/docs/workflows/using-nuget-without-committing-packages ](http://docs.nuget.org/docs/workflows/using-nuget-without-committing-packages).
2. Добавьте новый класс C# в **фильтры** папки и назовите его *CustomActionFilter.cs*. В этой папке будут храниться все настраиваемые фильтры.
3. Откройте **CustomActionFilter.cs** и добавьте ссылку на **System.Web.Mvc** и **MvcMusicStore.Models** пространства имен:

    (Фрагмент - кода *ASP.NET MVC 4 настраиваемых фильтров действий - сервера Ex1 CustomActionFilterNamespaces*)

    [!code-csharp[Main](aspnet-mvc-4-custom-action-filters/samples/sample1.cs)]
4. Наследовать **CustomActionFilter** класса из **ActionFilterAttribute** и затем **CustomActionFilter** Реализуйте класс **IActionFilter** интерфейса.

    [!code-csharp[Main](aspnet-mvc-4-custom-action-filters/samples/sample2.cs)]
5. Сделать **CustomActionFilter** класс переопределить метод **OnActionExecuting** и добавьте необходимую логику в журнал выполнения фильтра. Чтобы сделать это, добавьте следующий выделенный код в **CustomActionFilter** класса.

    (Фрагмент - кода *ASP.NET MVC 4 настраиваемых фильтров действий - сервера Ex1 LoggingActions*)

    [!code-csharp[Main](aspnet-mvc-4-custom-action-filters/samples/sample3.cs#Highlight)]

    > [!NOTE]
    > **OnActionExecuting** использует метод **Entity Framework** для добавления нового ActionLog регистра. Он создает и заполняет новый экземпляр сущности из сведений о контексте **filterContext**.
    > 
    > Дополнительные сведения о **параметром ControllerContext** класса в [msdn](https://msdn.microsoft.com/library/system.web.mvc.controllercontext.aspx).

<a id="Ex1Task2"></a>

<a id="Task_2_-_Injecting_a_Code_Interceptor_into_the_Store_Controller_Class"></a>
#### <a name="task-2---injecting-a-code-interceptor-into-the-store-controller-class"></a>Задача 2 - Добавление перехватчик код в класс контроллера хранилища

В этой задаче вы добавите пользовательский фильтр, внедряя его для всех классов контроллеров и действий контроллера, которые будут регистрироваться. Для этого упражнения класс контроллера хранилища будут иметь журналов.

Метод **OnActionExecuting** из **ActionLogFilterAttribute** настраиваемого фильтра выполняется при вызове внедренного элемента.

Можно также перехватывать метод конкретному контроллеру.

1. Откройте **StoreController** в **MvcMusicStore\Controllers** и добавьте ссылку на **фильтры** пространство имен:

    [!code-csharp[Main](aspnet-mvc-4-custom-action-filters/samples/sample4.cs)]
2. Внедрить пользовательский фильтр **CustomActionFilter** в **StoreController** класс, добавив **[CustomActionFilter]** перед объявлением класса.

    [!code-csharp[Main](aspnet-mvc-4-custom-action-filters/samples/sample5.cs)]

   > [!NOTE]
   > Если фильтр вставляется в класс контроллера, также добавляются все свои действия. Если вы хотите применить фильтр только для набора действий, потребовалось бы ввести **[CustomActionFilter]** для каждой из них:
   > 
   > [!code-csharp[Main](aspnet-mvc-4-custom-action-filters/samples/sample6.cs)]

<a id="Ex1Task3"></a>

<a id="Task_3_-_Running_the_Application"></a>
#### <a name="task-3---running-the-application"></a>Задача 3. запуск приложения

В этой задаче вы проверите, что фильтр регистрации работает. Будет запустите приложение и посетить магазин, и затем производится проверка журнала действий.

1. Нажмите клавишу **F5** для запуска приложения.
2. Перейдите к **/ActionLog** начальное состояние представления журнала:

    ![Состояние отслеживания перед действием страницы журнала](aspnet-mvc-4-custom-action-filters/_static/image3.png "отслеживания состояния перед действием страницы журнала")

    *Состояние регистрации журнала до действия "страницы"*

   > [!NOTE]
   > По умолчанию он всегда будет отображаться один элемент, который создается при получении существующих жанров для меню.
   > 
   > В целях упрощения мы происходит очистка **ActionLog** таблицы при каждом запуске приложения, будут отображаться только журналы проверки каждой конкретной задачи.
   > 
   > Может потребоваться удалить следующий код из **сеанса\_запустить** метода (в **Global.asax** класса), чтобы сохранить журнал для всех действий, которые были выполнены в хранилище Контроллер.
   > 
   > [!code-csharp[Main](aspnet-mvc-4-custom-action-filters/samples/sample7.cs)]
3. Выберите один из **жанров** из меню и выполнять некоторые действия, такие как просмотр доступных альбома.
4. Перейдите к **/ActionLog** и при наличии журнала пустой клавишу **F5** обновления страницы. Проверьте, что были отслежены посещенных:

    ![Журнал действий с записываемого действия](aspnet-mvc-4-custom-action-filters/_static/image4.png "журнал действий с действием в журнал")

    *Журнал действий с действием в журнал*

<a id="Exercise2"></a>

<a id="Exercise_2_Managing_Multiple_Action_Filters"></a>
### <a name="exercise-2-managing-multiple-action-filters"></a>Упражнение 2: Управление нескольких фильтров

В этом упражнении будет добавить второй настраиваемый фильтр действий в класс StoreController и определить определенного порядка, в котором будет выполняться оба фильтра. Затем будет обновить код, чтобы зарегистрировать глобальный фильтр.

Существуют различные варианты необходимо учитывать при определении порядка выполнения фильтров. Например свойство Order и области фильтрации:

Можно определить **область** для каждого из фильтров, например, вы может ограничить область видимости все фильтры действий для запуска в составе **область контроллера**и все фильтры авторизации для запуска в **глобальной области видимости** . Области имеют порядок определения выполнение.

Кроме того для каждого фильтра действия есть свойство Order, который используется для определения порядка выполнения в область фильтра.

Дополнительные сведения о порядке выполнения настраиваемые фильтры действий можно найти в этой статье MSDN: ([https://msdn.microsoft.com/library/dd381609(v=vs.98).aspx](https://msdn.microsoft.com/library/dd381609(v=vs.98).aspx)).

<a id="Ex2Task1"></a>

<a id="Task_1_Creating_a_new_Custom_Action_Filter"></a>
#### <a name="task-1-creating-a-new-custom-action-filter"></a>Задача 1: Создание нового настраиваемого фильтра действий

В этой задаче вы создадите новый настраиваемый фильтр действий для вставки в классе StoreController научиться управлять порядок выполнения фильтров.

1. Откройте **начать** решений, расположенный **\Source\Ex02-ManagingMultipleActionFilters\Begin** папки. В противном случае можно продолжить использование **окончания** решения получен путем выполнения в предыдущем упражнении.

    1. Если вы открыли указанных **начать** решение, необходимо будет загрузить несколько отсутствующих пакетов NuGet прежде чем продолжить. Чтобы сделать это, нажмите кнопку **проекта** и выбрать пункт **управление пакетами NuGet**.
    2. В **управление пакетами NuGet** диалоговое окно, нажмите кнопку **восстановить** чтобы скачивать отсутствующие пакеты.
    3. Наконец, постройте решение, нажав кнопку **построения** | **построить решение**.

        > [!NOTE]
        > Одним из преимуществ использования NuGet является у вас не указан для отправки всех библиотек в вашем проекте, уменьшив размер проекта. С помощью NuGet Power Tools указав версий пакета в файле Packages.config можно для загрузки всех необходимых библиотек первый раз, при запуске проекта. Вот почему необходимо будет выполнить эти шаги после открытия существующего решения в этой лаборатории.
        > 
        > Дополнительные сведения см. в разделе этой статьи: [ http://docs.nuget.org/docs/workflows/using-nuget-without-committing-packages ](http://docs.nuget.org/docs/workflows/using-nuget-without-committing-packages).
2. Добавьте новый класс C# в **фильтры** папки и назовите его *MyNewCustomActionFilter.cs*
3. Откройте **MyNewCustomActionFilter.cs** и добавьте ссылку на **System.Web.Mvc** и **MvcMusicStore.Models** пространство имен:

    (Фрагмент - кода *ASP.NET MVC 4 настраиваемых фильтров действий - Ex2 MyNewCustomActionFilterNamespaces*)

    [!code-csharp[Main](aspnet-mvc-4-custom-action-filters/samples/sample8.cs)]
4. Замените объявление класса по умолчанию с помощью следующего кода.

    (Фрагмент - кода *ASP.NET MVC 4 настраиваемых фильтров действий - Ex2 MyNewCustomActionFilterClass*)

    [!code-csharp[Main](aspnet-mvc-4-custom-action-filters/samples/sample9.cs)]

    > [!NOTE]
    > Этот настраиваемый фильтр действий почти не отличается от той, которую вы создали в предыдущем упражнении. Основное отличие заключается в том, что он имеет *&quot;входа по&quot;* атрибута, который обновляется с именем этот новый класс, чтобы определить фильтр, который зарегистрирован в журнале.

<a id="Ex2Task2"></a>

<a id="Task_2_Injecting_a_new_Code_Interceptor_into_the_StoreController_Class"></a>
#### <a name="task-2-injecting-a-new-code-interceptor-into-the-storecontroller-class"></a>Задача 2: Добавление нового перехватчик код в класс StoreController

В этой задаче будет добавить в класс StoreController новый настраиваемый фильтр и запустите решение, чтобы проверить, как оба фильтра совместной работы.

1. Откройте **StoreController** класса, расположенный **MvcMusicStore\Controllers** и вставляют новый настраиваемый фильтр **MyNewCustomActionFilter** в  **StoreController** класса, как показано в следующем коде.

    [!code-csharp[Main](aspnet-mvc-4-custom-action-filters/samples/sample10.cs)]
2. Теперь запустите приложение, чтобы увидеть, как работают эти две настраиваемые фильтры действий. Чтобы сделать это, нажмите клавишу **F5** и подождите, пока приложение запускается.
3. Перейдите к **/ActionLog** для просмотра исходного состояния представление журнала.

    ![Состояние отслеживания перед действием страницы журнала](aspnet-mvc-4-custom-action-filters/_static/image5.png "отслеживания состояния перед действием страницы журнала")

    *Состояние регистрации журнала до действия "страницы"*
4. Выберите один из **жанров** из меню и выполнять некоторые действия, такие как просмотр доступных альбома.
5. Убедитесь, что это время; посещенных отслеживались дважды: после добавления в для каждого из фильтров действий пользовательского **готовности StorageController** класса.

    ![Журнал действий с записываемого действия](aspnet-mvc-4-custom-action-filters/_static/image6.png "журнал действий с действием в журнал")

    *Журнал действий с действием в журнал*
6. Закройте браузер.

<a id="Ex2Task3"></a>

<a id="Task_3_Managing_Filter_Ordering"></a>
#### <a name="task-3-managing-filter-ordering"></a>Задача 3: Управление упорядочение фильтра

В этой задаче рассматривается управление порядок выполнения фильтров с помощью свойства заказа.

1. Откройте **StoreController** класса, расположенный **MvcMusicStore\Controllers** и укажите **порядок** свойству в оба фильтра, такому как показано ниже.

    [!code-csharp[Main](aspnet-mvc-4-custom-action-filters/samples/sample11.cs)]
2. Теперь проверьте, как фильтры выполняются в зависимости от значения свойства Order. Вы найдете, фильтр с наименьшим значением (**CustomActionFilter**) является первым, выполняется. Нажмите клавишу **F5** и подождите, пока приложение запускается.
3. Перейдите к **/ActionLog** для просмотра исходного состояния представление журнала.

    ![Состояние отслеживания перед действием страницы журнала](aspnet-mvc-4-custom-action-filters/_static/image7.png "отслеживания состояния перед действием страницы журнала")

    *Состояние регистрации журнала до действия "страницы"*
4. Выберите один из **жанров** из меню и выполнять некоторые действия, такие как просмотр доступных альбома.
5. Проверьте, что на этот раз посещенных отслеживались упорядоченные по фильтрации порядковый номер: **CustomActionFilter** журналы первой.

    ![Журнал действий с записываемого действия](aspnet-mvc-4-custom-action-filters/_static/image8.png "журнал действий с действием в журнал")

    *Журнал действий с действием в журнал*
6. Теперь будет обновлять значения порядка фильтров и проверьте, как изменяется порядок ведения журнала. В **StoreController** класса, обновить значение порядка фильтрации, как показано ниже.

    [!code-csharp[Main](aspnet-mvc-4-custom-action-filters/samples/sample12.cs)]
7. Снова запустите приложение, нажав клавишу **F5**.
8. Выберите один из **жанров** из меню и выполнять некоторые действия, такие как просмотр доступных альбома.
9. Проверьте, что на этот раз журналов, созданных **MyNewCustomActionFilter** фильтра отображаются первыми.

    ![Журнал действий с записываемого действия](aspnet-mvc-4-custom-action-filters/_static/image9.png "журнал действий с действием в журнал")

    *Журнал действий с действием в журнал*

<a id="Ex2Task4"></a>

<a id="Task_4_Registering_Filters_Globally"></a>
#### <a name="task-4-registering-filters-globally"></a>Задача 4: Регистрация фильтрует глобально

В этой задаче будет обновить решение, чтобы зарегистрировать новый фильтр (**MyNewCustomActionFilter**) как глобальный. Таким образом, он будет запускаться все perfomed действия в приложении, а не только в StoreController из них, как в предыдущей задаче.

1. В **StoreController** класса, удалите **[MyNewCustomActionFilter]** атрибутов и свойств заказа из **[CustomActionFilter]**. Он должен выглядеть следующим образом:

    [!code-csharp[Main](aspnet-mvc-4-custom-action-filters/samples/sample13.cs)]
2. Откройте **Global.asax** и найдите **приложения\_запустить** метод. Обратите внимание, что при каждом запуске приложения его регистрация глобальных фильтров путем вызова **RegisterGlobalFilters** метода в **FilterConfig** класса.

    ![Регистрация глобальных фильтров в файле Global.asax](aspnet-mvc-4-custom-action-filters/_static/image10.png "регистрация глобальных фильтров в файле Global.asax")

    *Регистрация глобальных фильтров в файле Global.asax*
3. Откройте **FilterConfig.cs** файл включен в **приложения\_запустить** папки.
4. Добавьте ссылку на System.Web.Mvc; с помощью с помощью MvcMusicStore.Filters; пространство имен.

    [!code-csharp[Main](aspnet-mvc-4-custom-action-filters/samples/sample14.cs)]
5. Обновление **RegisterGlobalFilters** метод добавления пользовательского фильтра. Чтобы сделать это, добавьте выделенный код:

    [!code-csharp[Main](aspnet-mvc-4-custom-action-filters/samples/sample15.cs)]
6. Запустите приложение, нажав клавишу **F5**.
7. Выберите один из **жанров** из меню и выполнять некоторые действия, такие как просмотр доступных альбома.
8. Проверьте, что теперь **[MyNewCustomActionFilter]** , введенного в HomeController и ActionLogController слишком.

    ![Журнал действий с записываемого действия](aspnet-mvc-4-custom-action-filters/_static/image11.png "журнал действий с действием в журнал")

    *Журнал действий с глобальной записываемого действия.*

> [!NOTE]
> Кроме того, можно развернуть это приложение на веб-сайтов Windows Azure ниже [приложение б. публикация приложения ASP.NET MVC 4 с помощью веб-развертывания](#AppendixB).


* * *

<a id="Summary"></a>

<a id="Summary"></a>
## <a name="summary"></a>Сводка

Выполнив это Практическое лабораторное занятие изучено расширить фильтр действий для выполнения настраиваемых действий. Вы также узнали, как внедрить любой фильтр контроллеры страницы. Были использованы следующие понятия:

- Создание настраиваемого действия фильтров в классе ASP.NET MVC ActionFilterAttribute
- Как для добавления фильтров в ASP.NET MVC контроллеры
- Управление фильтра упорядочение с помощью свойства Order
- Как зарегистрировать фильтры глобально

<a id="AppendixA"></a>

<a id="Appendix_A_Installing_Visual_Studio_Express_2012_for_Web"></a>
## <a name="appendix-a-installing-visual-studio-express-2012-for-web"></a>Приложение а. Установка Visual Studio Express 2012 для Web

Можно установить **Microsoft Visual Studio Express 2012 для Web** или другой &quot;Express&quot; версию, используя **[Microsoft Web Platform Installer](https://www.microsoft.com/web/downloads/platform.aspx)**. Следующие инструкции описывают действия, необходимые для установки *Visual studio Express 2012 для Web* с помощью *Microsoft Web Platform Installer*.

1. Последовательно выберите пункты [ [ https://go.microsoft.com/? linkid = 9810169](https://go.microsoft.com/?linkid=9810169)](https://go.microsoft.com/?linkid=9810169). Кроме того, если вы уже установили установщика веб-платформы, можно открыть его и выполните поиск продукта &quot; <em>Visual Studio Express 2012 для Web с пакетом Windows Azure SDK</em>&quot;.
2. Щелкните **установить сейчас**. Если у вас **Web Platform Installer** вы будете перенаправлены, чтобы загрузить и установить ее сначала.
3. Один раз **Web Platform Installer** открыто, нажмите кнопку **установить** для запуска программы установки.

    ![Установка Visual Studio Express](aspnet-mvc-4-custom-action-filters/_static/image12.png "установка Visual Studio Express")

    *Установка Visual Studio Express*
4. Чтение всех продуктов лицензий и условия и нажмите кнопку **принимаю** для продолжения.

    ![Принятие условий лицензионного соглашения](aspnet-mvc-4-custom-action-filters/_static/image13.png)

    *Принятие условий лицензионного соглашения*
5. Дождитесь завершения процесса загрузки и установки.

    ![Ход установки](aspnet-mvc-4-custom-action-filters/_static/image14.png)

    *Ход выполнения установки*
6. По завершении установки нажмите кнопку **Готово**.

    ![Установка завершена](aspnet-mvc-4-custom-action-filters/_static/image15.png)

    *Установка завершена*
7. Нажмите кнопку **выхода** закрыть установщик веб-платформы.
8. Чтобы открыть Visual Studio Express для Web, перейдите к **запустить** экрана и начинается запись &quot; **VS Express**&quot;, выберите команду **VS Express для Web** Плитка.

    ![VS Express для Web плитки](aspnet-mvc-4-custom-action-filters/_static/image16.png)

    *VS Express для Web плитки*

<a id="AppendixB"></a>

<a id="Appendix_B_Publishing_an_ASPNET_MVC_4_Application_using_Web_Deploy"></a>
## <a name="appendix-b-publishing-an-aspnet-mvc-4-application-using-web-deploy"></a>Приложение б. публикация приложения ASP.NET MVC 4 с помощью веб-развертывания

В этом приложении будет показано, как создать новый веб-сайт на портале управления Windows Azure и публикация приложения, получить, выполнив в лаборатории преимуществами средство публикации веб-развертывания, предоставленного Windows Azure.

<a id="ApxBTask1"></a>

<a id="Task_1_-_Creating_a_New_Web_Site_from_the_Windows_Azure_Portal"></a>
#### <a name="task-1---creating-a-new-web-site-from-the-windows-azure-portal"></a>Задача 1. Создание нового веб-узла с Windows Azure Portal

1. Последовательно выберите пункты [портала управления Windows Azure](https://manage.windowsazure.com/) и войдите с использованием учетных данных Майкрософт, связанную с вашей подпиской.

    > [!NOTE]
    > С помощью Windows Azure можно бесплатно размещения 10 веб-сайтов ASP.NET и затем масштабирование по мере увеличения трафика. Вы можете зарегистрироваться [здесь](http://aka.ms/aspnet-hol-azure).

    ![Войдите на портал Windows Azure](aspnet-mvc-4-custom-action-filters/_static/image17.png "входа на портал Windows Azure")

    *Выполните вход на портале управления Windows Azure*
2. Нажмите кнопку **New** на панели команд.

    ![Создание нового веб-сайта](aspnet-mvc-4-custom-action-filters/_static/image18.png "создания нового веб-сайта")

    *Создание нового веб-сайта*
3. Нажмите кнопку **вычислений** | **веб-сайт**. Выберите **быстрое создание** параметр. Укажите URL-адрес доступен для нового веб-сайта и нажмите кнопку **Создание веб-сайта**.

    > [!NOTE]
    > Веб-приложение, работающее в облаке, вы можете управлять размещается веб-сайта Windows Azure. Параметр быстрого создания позволяет развернуть завершенное веб-приложение для Windows Azure веб-сайта из вне портала. Он не включает действия по настройке базы данных.

    ![Создание нового веб-сайта с помощью быстрого создания](aspnet-mvc-4-custom-action-filters/_static/image19.png "создания нового веб-сайта с помощью быстрого создания")

    *Создание нового веб-сайта с помощью быстрого создания*
4. Подождите, пока новый **веб-сайт** создается.
5. После создания веб-сайта по ссылке **URL-адрес** столбца. Проверьте, что новый веб-сайт работает.

    ![Просмотр новых веб-сайт](aspnet-mvc-4-custom-action-filters/_static/image20.png "просмотра на новый веб-сайт")

    *Просмотр новых веб-сайт*

    ![Веб-сайта под управлением](aspnet-mvc-4-custom-action-filters/_static/image21.png "веб-сайта под управлением")

    *Запуск веб-сайта*
6. Вернитесь на портал и щелкните имя веб-сайта в разделе **имя** столбец для отображения страницы управления.

    ![Открытие страницы управления веб-сайт](aspnet-mvc-4-custom-action-filters/_static/image22.png "Открытие страниц управления веб-сайта")

    *Открытие страницы управления веб-сайта*
7. В **панели мониторинга** в разделе **беглого** щелкните **загрузить профиль публикации** ссылку.

    > [!NOTE]
    > *Профиль публикации* содержит все сведения, необходимые для публикации веб-приложения на веб-сайте Windows Azure для каждого разрешенного метода публикации. Профиль публикации содержит URL-адреса, учетные данные пользователя и строк базы данных, необходимых для подключения и проверки подлинности с каждой из конечных точек, для которых включен метода публикации. **Microsoft WebMatrix 2**, **Microsoft Visual Studio Express для Web** и **Microsoft Visual Studio 2012** поддерживают чтение профилей публикации для автоматизации настройки этих программ для Публикация веб-приложений на веб-сайтов Windows Azure.

    ![Профиль публикации веб-сайт загрузки](aspnet-mvc-4-custom-action-filters/_static/image23.png "профиль публикации веб-сайта загрузки")

    *Профиль публикации веб-сайта загрузки*
8. Загрузите файл профиля публикации в известном расположении. Далее в этом упражнении вы увидите как использовать этот файл для публикации веб-приложения для веб-сайтов, Windows Azure из Visual Studio.

    ![Сохранить файл профиля публикации](aspnet-mvc-4-custom-action-filters/_static/image24.png "Сохранение профиля публикации")

    *Сохранить файл профиля публикации*

<a id="ApxBTask2"></a>

<a id="Task_2_-_Configuring_the_Database_Server"></a>
#### <a name="task-2---configuring-the-database-server"></a>Задача 2 - Настройка сервера базы данных

Если приложение использует SQL Server базы данных, необходимо будет создать сервер базы данных SQL. Если вы хотите развернуть простое приложение, которое не использует SQL Server может пропустить эту задачу.

1. Сервер базы данных SQL необходимо для хранения базы данных приложения. Можно просматривать серверы базы данных SQL из подписки на портале управления Windows Azure в **баз данных Sql** | **серверы** | **сервера Панель мониторинга**. Если у вас на сервер, созданный, можно создать ее, используя **добавить** кнопки на панели команд. Обратите внимание **имя сервера и URL-адрес, имя входа администратора и пароль**, как будет использовать их в следующие задачи. Не следует создавать базу данных, как он будет создан в более поздней стадии.

    ![Панель мониторинга базы данных SQL Server](aspnet-mvc-4-custom-action-filters/_static/image25.png "панель мониторинга базы данных SQL Server")

    *Панель мониторинга базы данных SQL Server*
2. В следующей задаче требуется проверить подключение к базе данных из Visual Studio, по этой причине необходимо включить локальный IP-адреса в список серверов **разрешенные IP-адреса**. Чтобы сделать это, нажмите кнопку **Настройка**, выберите IP-адрес из **текущий IP-адрес клиента** и вставьте его на **начальный IP-адрес** и **конечный IP-адрес** текстовые поля и нажмите кнопку ![add-client-ip-address-ok-button](aspnet-mvc-4-custom-action-filters/_static/image26.png) кнопки.

    ![Добавление IP-адрес клиента](aspnet-mvc-4-custom-action-filters/_static/image27.png)

    *Добавление IP-адрес клиента*
3. Один раз **IP-адрес клиента** добавляется разрешенных IP-адресов выберите на **Сохранить** для подтверждения изменения.

    ![Подтверждение изменений](aspnet-mvc-4-custom-action-filters/_static/image28.png)

    *Подтверждение изменений*

<a id="ApxBTask3"></a>

<a id="Task_3_-_Publishing_an_ASPNET_MVC_4_Application_using_Web_Deploy"></a>
#### <a name="task-3---publishing-an-aspnet-mvc-4-application-using-web-deploy"></a>Задача 3. публикация приложения ASP.NET MVC 4 с помощью веб-развертывания

1. Вернитесь в решении ASP.NET MVC 4. В **обозревателе решений**, щелкните правой кнопкой мыши проект веб-сайта и выберите **публикации**.

    ![Публикация приложения](aspnet-mvc-4-custom-action-filters/_static/image29.png "публикация приложения")

    *Публикация веб-сайта*
2. Импортируйте профиль публикации, сохраненный в первой задаче.

    ![Импорт профиля публикации](aspnet-mvc-4-custom-action-filters/_static/image30.png "Импорт профиля публикации")

    *Импорт профиля публикации*
3. Нажмите кнопку **Проверка подключения**. После завершения проверки нажмите кнопку **Далее**.

    > [!NOTE]
    > Проверка завершена, как только вы увидите зеленый флажок рядом с "Проверить подключение".

    ![Проверка подключения](aspnet-mvc-4-custom-action-filters/_static/image31.png "Проверка подключения")

    *Проверка подключения*
4. В **параметры** в разделе **баз данных** статьи, нажмите кнопку рядом с текстового поля для подключения к базе данных (т. е. **DefaultConnection**).

    ![Конфигурация веб-развертывания](aspnet-mvc-4-custom-action-filters/_static/image32.png "конфигурация веб-развертывания")

    *Конфигурация веб-развертывания*
5. Настройте подключение к базе данных следующим образом.

   - В **имя сервера** введите ваш URL-адрес сервера базы данных SQL с помощью *tcp:* префикс.
   - В **имя пользователя** введите имя входа администратора сервера.
   - В **пароль** введите пароль входа администратора сервера.
   - Введите имя новой базы данных.

     ![Настройка строки подключения назначения](aspnet-mvc-4-custom-action-filters/_static/image33.png "Настройка целевой строки подключения")

     *Настройка целевой строки подключения*
6. Затем нажмите кнопку **ОК**. Когда появится запрос на создание базы данных щелкните **Да**.

    ![Создание базы данных](aspnet-mvc-4-custom-action-filters/_static/image34.png "Создание строки базы данных")

    *Создание базы данных*
7. Строка подключения, который будет использоваться для подключения к базе данных SQL в Windows Azure отображается внутри текстового поля по умолчанию соединения. Затем нажмите кнопку **Далее**.

    ![Строка подключения, указывающий базу данных SQL](aspnet-mvc-4-custom-action-filters/_static/image35.png "строку соединения, указывающий базу данных SQL")

    *Строка подключения, указывающий базу данных SQL*
8. В **предварительного просмотра** щелкните **публикации**.

    ![Публикация веб-приложения](aspnet-mvc-4-custom-action-filters/_static/image36.png "публикации веб-приложения")

    *Публикация веб-приложения*
9. После завершения процесса публикации в браузере по умолчанию откроется опубликованного веб-узла.

<a id="AppendixC"></a>

<a id="Appendix_C_Using_Code_Snippets"></a>
## <a name="appendix-c-using-code-snippets"></a>Приложение в. фрагменты кода

С помощью фрагментов кода у вас есть весь код, который требуется под рукой. Документ лаборатории сообщает только при их использовании, как показано на следующем рисунке.

![Фрагменты кода Visual Studio для вставки кода в проекте](aspnet-mvc-4-custom-action-filters/_static/image37.png "фрагменты кода с помощью Visual Studio вставьте код в проект")

*Фрагменты кода Visual Studio для вставки кода в проекте*

***Добавление фрагмента кода, с помощью клавиатуры (только C#)***

1. Поместите курсор в место вставки кода.
2. Начните вводить имя фрагмента (без пробелов и дефисы).
3. Смотрите, как IntelliSense отображает, совпадающие с именами фрагменты.
4. Выберите правильный фрагмент (или продолжите ввод, пока не будет выделен весь фрагмент имени).
5. Нажмите клавишу Tab дважды, чтобы вставить фрагмент в положении курсора.

![Начните вводить имя фрагмента](aspnet-mvc-4-custom-action-filters/_static/image38.png "начните вводить имя фрагмента")

*Начните вводить имя фрагмента*

![Нажмите клавишу Tab, чтобы выделить выделенный фрагмент](aspnet-mvc-4-custom-action-filters/_static/image39.png "нажмите клавишу Tab, чтобы выделить выделенный фрагмент")

*Нажмите клавишу Tab, чтобы выделить выделенный фрагмент*

![Снова нажмите клавишу Tab и фрагмент будет расширен](aspnet-mvc-4-custom-action-filters/_static/image40.png "будет расширен, снова нажмите клавишу Tab и фрагмента кода")

*Снова нажмите клавишу Tab и фрагмент будет расширен*

***Добавление фрагмента кода, с помощью мыши (C#, Visual Basic и XML)*** 1. Щелкните правой кнопкой мыши место вставки фрагмента кода.

1. Выберите **вставить фрагмент** следуют **Мои фрагменты кода**.
2. Выберите соответствующий фрагмент из списка, щелкнув по ней.

![Щелкните правой кнопкой мыши место для вставки фрагмента кода и выбора вставить фрагмент](aspnet-mvc-4-custom-action-filters/_static/image41.png "место для вставки фрагмента кода и выбора вставить фрагмент кода щелкните правой кнопкой мыши")

*Щелкните правой кнопкой мыши в место вставки фрагмента кода и выберите Вставить фрагмент*

![Выберите из списка, соответствующего фрагмента, щелкнув его](aspnet-mvc-4-custom-action-filters/_static/image42.png "выбрать соответствующий фрагмент из списка, щелкнув по ней")

*Выберите соответствующий фрагмент из списка, щелкнув по ней*
