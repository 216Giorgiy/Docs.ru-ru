---
uid: mvc/overview/older-versions/hands-on-labs/whats-new-in-aspnet-mvc-4
title: "Новые возможности в ASP.NET MVC 4 | Документы Microsoft"
author: rick-anderson
description: "ASP.NET MVC 4 — это платформа для создания масштабируемых, основанную на стандартах веб-приложений с помощью надежных конструктивных шаблонов и эффективных возможностей ASP.NET и..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/18/2013
ms.topic: article
ms.assetid: 48f7feb3-872f-485d-b96f-e30011ff8c4a
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions/hands-on-labs/whats-new-in-aspnet-mvc-4
msc.type: authoredcontent
ms.openlocfilehash: 35f9402ad6090c0441425a23b2b8063350892210
ms.sourcegitcommit: 7ac15eaae20b6d70e65f3650af050a7880115cbf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/02/2018
---
# <a name="whats-new-in-aspnet-mvc-4"></a>Новые возможности в ASP.NET MVC 4

По [Web лагеря команды](https://twitter.com/webcamps)

[Загрузите комплект учебных материалов лагеря Web](https://aka.ms/webcamps-training-kit)

ASP.NET MVC 4 — это платформа для создания масштабируемых, основанную на стандартах веб-приложений с помощью надежных конструктивных шаблонов и эффективных возможностей ASP.NET и .NET framework. Этот новый, четвертая версия платформы основное внимание уделяется упрощение разработки мобильных веб-приложений.

Вначале при создании нового проекта ASP.NET MVC 4 теперь имеется шаблон проекта приложений для мобильных устройств, которые можно использовать для построения отдельное приложение, специально для мобильных устройств. Кроме того ASP.NET MVC 4 интегрируется с jQuery Mobile через jQuery.Mobile.MVC пакет NuGet. jQuery Mobile — это платформа на основе HTML5, для разработки веб-приложений, совместимых с всех платформ популярных мобильных устройствах, включая Windows Phone, iPhone, Android и т. д. Тем не менее если вам требуется специализации, ASP.NET MVC 4 также позволяет обслуживать различные представления для различных устройств и обеспечивают оптимизацию для конкретного устройства.

В этой практической будет начинаться с ASP.NET MVC 4 &quot;веб-приложение&quot; шаблон проекта для создания приложения фотоальбома. Постепенно, поможет повысить эффективность приложения с помощью jQuery Mobile, а также новые функции ASP.NET MVC 4, чтобы сделать его совместимым с различных мобильных устройств и настольных компьютеров веб-браузеры. Также вы узнаете о новых рецепты кода для создания кода, а также как ASP.NET MVC 4 проще написать асинхронные методы действия с помощью поддержки задачи&lt;ActionResult&gt; типы возвращаемых значений.

> [!NOTE]
> Все образцы кода и фрагменты кода включаются в Web лагеря комплект учебных материалов, доступных в [выпуски Microsoft Web/WebCampTrainingKit](https://aka.ms/webcamps-training-kit). Проект для этой лаборатории доступен на [новые возможности веб-форм в ASP.NET 4.5](https://github.com/Microsoft-Web/HOL-ASPNETWebForms).

<a id="Objectives"></a>
### <a name="objectives"></a>Цели

В этой практической вы узнаете, как:

- Воспользоваться преимуществами расширений для ASP.NET MVC проект шаблоны, в том числе нового шаблона проекта приложений для мобильных устройств
- Использовать атрибут просмотра HTML5 и медиа-запросами CSS для улучшения отображения на мобильных устройствах
- Используйте jQuery Mobile для прогрессивного улучшения и для создания оптимизированных для сенсорных экранов веб-интерфейса
- Создавать мобильные особых представлений
- Использовать компонент представления переключателя для переключения между представлениями мобильные и Классические приложения
- Создание асинхронных контроллеров с помощью поддержки задач

<a id="Prerequisites"></a>

<a id="Prerequisites"></a>
### <a name="prerequisites"></a>Предварительные требования

Необходимо иметь следующие элементы для этой лаборатории.

- [Microsoft Visual Studio Express 2012 для Web](https://www.microsoft.com/visualstudio/eng/products/visual-studio-express-for-web) или выше (чтение [приложении Б](#AppendixB) инструкции по его установке).
- [ASP.NET MVC 4](../../../mvc4.md) (включен в установку Microsoft Visual Studio 2012)
- Эмулятор Windows Phone (включен в [Windows Phone 7.1.1 SDK](https://www.microsoft.com/download/details.aspx?id=29233))
- Необязательно — [WebMatrix 2](https://www.microsoft.com/web/webmatrix/) с **Electric Plum iPhone симулятор** расширения (только для Упражнение 3 используется для просмотра веб-приложения с эмулятор iPhone)

<a id="Setup"></a>

<a id="Setup"></a>
### <a name="setup"></a>Установка

В документе лаборатории будет предложено вставлять блоки кода. Для удобства большинство этого кода предоставляется как Visual Studio к фрагментам кода, который можно использовать из среды Visual Studio, чтобы избежать необходимости вручную добавить.

Чтобы установить фрагменты кода:

1. Откройте окно проводника Windows и перейдите в лаборатории **Source\Setup** папки.
2. Дважды щелкните **Setup.cmd** файл в этой папке, чтобы установить фрагменты кода Visual Studio.

Если вы не знакомы с фрагментов кода Visual Studio и хотите узнать о способах их использования, можно ссылаться в приложение из этого документа &quot; [с помощью фрагментов кода в приложении A:](#AppendixA)&quot;.

<a id="Exercises"></a>

<a id="Exercises"></a>
## <a name="exercises"></a>Упражнения

Данная практическая работа включает следующие упражнения:

1. [Новые шаблоны проектов ASP.NET MVC 4](#Exercise1)
2. [Создание веб-приложения фотоальбом](#Exercise2)
3. [Добавление поддержки для мобильных устройств](#Exercise3)
4. [Использование асинхронных контроллеров](#Exercise4)

> [!NOTE]
> Каждого упражнения сопровождается **окончания** папку, содержащую полученное в результате решение, должен быть получен после завершения выполнения упражнений. Это решение можно использовать как руководство, если вам нужна дополнительная помощь при выполнении упражнений.


Предполагаемое время для выполнения этого занятия: **60 минут**.

<a id="Exercise1"></a>

<a id="Exercise_1_New_ASPNET_MVC_4_Project_Templates"></a>
### <a name="exercise-1-new-aspnet-mvc-4-project-templates"></a>Упражнение 1: Новые шаблоны проектов ASP.NET MVC 4

В этом упражнении вы исследуете улучшения, внесенные в шаблоны проекта ASP.NET MVC 4. Дополнение к шаблону веб-приложение, уже присутствует в MVC 3, эта версия теперь включает отдельный шаблон для мобильных приложений. Во-первых будут рассмотрены некоторые возможности соответствующие каждый из этих шаблонов. После этого будет работать в визуализации страницы правильно на различных платформах с использованием правильного подхода.

<a id="Task_1_-_Exploring_the_Internet_Application_Template"></a>
#### <a name="task-1---exploring-the-internet-application-template"></a>Задача 1. изучение шаблона приложения Интернета

1. Откройте **Visual Studio**.
2. Выберите **файл | Новые | Проект** команду меню. В **новый проект** диалогового окна выберите **Visual C# | Web** шаблона на левой панели дерева, а затем выберите **веб-приложение ASP.NET MVC 4.** Назовите проект **PhotoGallery**, выберите расположение (или оставьте значение по умолчанию) и нажмите кнопку **ОК**.

    > [!NOTE]
    > После этого следует настроить сейчас вы создаете решение Коллекция фотографий ASP.NET MVC 4.

    ![Создание нового проекта](whats-new-in-aspnet-mvc-4/_static/image1.png "Создание нового проекта")

    *Создание нового проекта*
3. В **нового проекта ASP.NET MVC 4** диалогового окна выберите **веб-приложение** шаблон проекта и нажмите кнопку **ОК**. Убедитесь, что были выбраны в качестве обработчика представлений Razor.

    ![Создание нового приложения ASP.NET MVC 4 Интернет](whats-new-in-aspnet-mvc-4/_static/image2.png "Создание нового приложения ASP.NET MVC 4 Интернета")

    *Создание нового приложения ASP.NET MVC 4 Интернета*

    > [!NOTE]
    > Синтаксис Razor была введена в ASP.NET MVC 3. Его задача — чтобы свести к минимуму число знаков и нажатий клавиш в файл, включение fast и жидкости кодирования рабочего процесса. Razor использует существующие C# и VB (или других) языковые навыки и доставляет синтаксиса разметки шаблона, который включает это здорово рабочий процесс построения HTML.
4. Нажмите клавишу **F5** для запуска решения и просмотреть обновленные шаблоны. Проверьте работу следующих функций:

    **Шаблоны в современном стиле**

    Шаблоны были обновлены, предоставляя дополнительные стили, современный вид.

    ![Шаблоны ASP.NET MVC 4 приведен](whats-new-in-aspnet-mvc-4/_static/image3.png "приведен шаблоны MVC 4")

    *Шаблоны ASP.NET MVC 4 приведен*

    ![Новая страница контакт](whats-new-in-aspnet-mvc-4/_static/image4.png "страницы нового контакта")

    *Новая страница контакта*

    **Адаптивной отрисовки**

    Извлеките изменения размера окна браузера и обратите внимание на то, как динамически адаптируется макет страницы и новый размер окна. Эти шаблоны использовать методика адаптивной отрисовки к просмотру правильно в настольных и мобильных платформ без настройки.

    ![Шаблон проекта ASP.NET MVC 4 в другом браузере размеры](whats-new-in-aspnet-mvc-4/_static/image5.png "шаблон проекта ASP.NET MVC 4 в другом браузере размеры")

    *Шаблон проекта ASP.NET MVC 4 в другом браузере размеры*

    **Обширные возможности пользовательского интерфейса с помощью JavaScript**

    Другое усовершенствование шаблоны проектов по умолчанию является использование JavaScript для обеспечения более интерактивны JavaScript. Ссылки входа и регистрации, используемые в шаблоне проиллюстрировать, как использовать jQuery проверки для проверки ввода поля со стороны клиента.

    ![jQuery проверки](whats-new-in-aspnet-mvc-4/_static/image6.png)

    *jQuery проверки*

    > [!NOTE]
    > Обратите внимание, что два журнала в разделах, в первом разделе можно в систему под учетной записью зарегистрированный на узле и во втором разделе, вы можете altenativelly в систему с помощью другой службы проверки подлинности, например google (отключено по умолчанию).
5. Закройте браузер, чтобы остановить отладчик и вернуться в Visual Studio.
6. Откройте файл **AuthConfig.cs** в компоненте **приложения\_запустить** папки.
7. Удаление комментария из последней строки для регистрации клиента Google для *OAuth* проверки подлинности.


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample1.cs)]

    > [!NOTE]
    > Обратите внимание, что можно легко включить проверку подлинности с использованием любой OpenID или OAuth службы как Facebook, Twitter, Майкрософт, и т. д.
8. Нажмите клавишу **F5** для запуска решения, а затем перейдите на страницу входа.
9. Выберите **Google** службу для входа.

    ![При выборе журнала в службе](whats-new-in-aspnet-mvc-4/_static/image7.png)

    *При выборе журнала в службе*
10. Вход с помощью учетной записи Google.
11. Разрешить узла (localhost) для извлечения сведений из учетной записи Google.
12. Наконец необходимо зарегистрировать на сайте, чтобы связать учетную запись Google.

    ![Связать учетную запись Google](whats-new-in-aspnet-mvc-4/_static/image8.png)

    *Связывание учетной записи Google*
13. Закройте браузер, чтобы остановить отладчик и вернуться в Visual Studio.
14. Теперь изучите решение, чтобы извлечь некоторые новые возможности, появившиеся в ASP.NET MVC 4 в шаблоне проекта.

    ![Шаблон проекта ASP.NET MVC 4 Интернет приложений](whats-new-in-aspnet-mvc-4/_static/image9.png "шаблон проекта ASP.NET MVC 4 Интернет приложений")

    *Шаблон проекта приложения Internet ASP.NET MVC 4*

    - **HTML 5 разметки**

        Обзор представлений шаблона, чтобы узнать, разметку новой темы.

        ![Новый шаблон с помощью Razor и HTML5 About.cshtml разметки. ] (whats-new-in-aspnet-mvc-4/_static/image10.png "Новый шаблон, с помощью Razor и HTML5 About.cshtml разметки.")

        *Новый шаблон с помощью Razor и HTML5 разметки (About.cshtml).*
    - **Обновленные библиотек JavaScript**

        Шаблон по умолчанию ASP.NET MVC 4 теперь включает использованием KnockoutJS, платформа JavaScript MVVM, которая позволяет создавать разнообразные и с высокой скоростью отклика веб-приложений, с помощью JavaScript и HTML. Как и в MVC3, jQuery и jQuery библиотеки пользовательского интерфейса также включаются в ASP.NET MVC 4.

        > [!NOTE]
        > Можно получить дополнительные сведения о библиотеке с использованием KnockOutJS в этой связи: [ [http://learn.knockoutjs.com/](http://learn.knockoutjs.com/)](http://learn.knockoutjs.com/). Кроме того, вы можете узнать о jQuery и jQuery UI в [ [http://docs.jquery.com/](http://docs.jquery.com/)](http://docs.jquery.com/).

<a id="Task_2_-_Exploring_the_Mobile_Application_Template"></a>
#### <a name="task-2---exploring-the-mobile-application-template"></a>Задача 2 - изучение шаблон мобильных приложений

ASP.NET MVC 4 облегчает разработку веб-сайты для мобильных устройств и браузеров планшета. Этот шаблон имеет такую же структуру приложения как веб-приложение, шаблон (Обратите внимание, что код контроллера практически идентичен), но его стиль был изменен для отображаться должным образом в мобильных устройств на базе сенсорный ввод.

1. Выберите **файл | Новые | Проект** команду меню. В **новый проект** диалогового окна выберите **Visual C# | Web** шаблона на левой панели дерева, а затем выберите **веб-приложение ASP.NET MVC 4.** Назовите проект **PhotoGallery.Mobile**, выберите расположение (или оставьте значение по умолчанию), выберите &quot;добавить решение&quot; и нажмите кнопку **ОК**.
2. В **нового проекта ASP.NET MVC 4** диалогового окна выберите **мобильного приложения** шаблон проекта и нажмите кнопку **ОК**. Убедитесь, что были выбраны в качестве обработчика представлений Razor.

    ![Создание нового приложения ASP.NET MVC 4 Mobile](whats-new-in-aspnet-mvc-4/_static/image11.png "Создание нового приложения ASP.NET MVC 4 мобильных устройств")

    *Создание нового приложения ASP.NET MVC 4 мобильных устройств*
3. Теперь имеется возможность просматривать решения и посмотрите, какие новые функции, представленные в шаблоне решения ASP.NET MVC 4 для мобильных устройств:

    - **jQuery Mobile библиотеки**

        Шаблон проекта приложения для мобильных устройств включает мобильных библиотеки jQuery, который является библиотекой открытым исходным кодом для мобильных устройств с браузерами. jQuery Mobile применяет прогрессивном расширении браузеры для мобильных устройств, поддерживающих CSS и JavaScript. Прогрессивном расширении включает все браузеры для отображения базовое содержимое веб-страницы, хотя позволяет самых мощных браузеры отображение сложных элементов. JavaScript и CSS, включенные в файлы jQuery мобильных стиль помочь браузеры для мобильных устройств в соответствии с содержимым на экране, без внесения изменений в разметке страницы.

        ![jQuery-mobile-library-included-in-the-template](whats-new-in-aspnet-mvc-4/_static/image12.png)

        *библиотеки jQuery мобильных устройств, включенных в шаблон*
    - **Разметки на основе HTML5**

        ![Mobile-application-template-using-HTML5-markup](whats-new-in-aspnet-mvc-4/_static/image13.png)

        *Шаблон мобильного приложения, используя разметку HTML5, (Login.cshtml и index.cshtml)*
4. Нажмите клавишу **F5** для запуска решения.
5. Откройте **Windows Phone 7 эмулятор**.
6. На начальном экране телефона откройте Internet Explorer. Извлечь URL-адрес, где запущен приложения рабочего стола и перейдите в этот URL-адрес, по телефону (например `http://localhost:[PortNumber]/`).
7. Теперь можно ввести страницы входа или извлечь о странице. Обратите внимание, что стиль веб-сайта основана на новое приложение магазина Windows для мобильных устройств. Шаблон проекта ASP.NET MVC 4 правильно отображается на мобильных устройствах, убедившись, что все элементы страницы были видимы и включены. Обратите внимание, что ссылки в заголовке достаточно большой, касании или щелчке.

    ![Проект шаблона страниц в мобильном устройстве](whats-new-in-aspnet-mvc-4/_static/image14.png "проект шаблона страниц в мобильных устройств")

    *Страницы шаблона проекта в мобильных устройств*
8. Новый шаблон также использует **просмотра метатег**. Большинство мобильных браузеров определяют ширину окна браузера виртуальный или &quot;просмотра&quot;, которого больше, чем фактическую ширину мобильного устройства. Это позволяет браузеры для мобильных устройств для отображения всей веб-страницы внутри виртуального экрана. **Просмотра метатег** позволяет веб-разработчикам задать ширину, высоту и масштабирования области обозревателя на мобильных устройствах **.** Шаблон для мобильных приложений ASP.NET MVC 4 задает окно просмотра по ширине устройства (&quot;ширина = устройство ширина&quot;) в шаблон макета (*одну\_Layout.cshtml*), после чего все страницы будут иметь их просмотра значение ширины экрана устройства. Обратите внимание, просмотра метатег не изменится в представление браузера по умолчанию.
9. Откройте  **\_Layout.cshtml**, расположенного в **представления | Общие** папки и комментарий метатег окна просмотра. Запустите приложение, если нет уже открыт и извлечь различия.


    [!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample2.cshtml)]

    ![Сайт, преобразовав метатег окно просмотра](whats-new-in-aspnet-mvc-4/_static/image15.png "сайта преобразовав метатег окна просмотра")

    *Узел, преобразовав метатег окна просмотра*
10. В Visual Studio нажмите клавишу **SHIFT** + **F5** остановить отладку приложения.
11. Раскомментируйте метатег окна просмотра.


    [!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample3.cshtml)]

<a id="Task_3_-_Using_Adaptive_Rendering"></a>
#### <a name="task-3---using-adaptive-rendering"></a>Задача 3 - с помощью адаптивной отрисовки

В этой задаче вы узнаете, как другой метод для отображения веб-страницы правильно на мобильных устройствах и веб-браузеров в то же время без настройки. Вы уже использовали просмотра метатег с одинаковой цели. Теперь будет соответствовать другой мощный метод: *адаптивной отрисовки*.

Методика адаптивной отрисовки использует **медиа-запросами CSS3** настроить стиль, применяемый к странице. Медиа-запросами определить условия внутри таблицы стилей, группирование стилей CSS при определенном условии. Только в том случае, если условие равно true, стиль применяется к объявленным объектов.

Гибкие возможности, предоставляемые методика адаптивной отрисовки включает любые настройки для отображения сайта на разных устройствах. Можно определить столько стили, которые нужно на отдельную таблицу стилей без написания кода логики Выбор стиля. Таким образом это очень аккуратно способ адаптации стили страницы, как он позволяет сократить дублирование кода и логику для подготовки к просмотру целей. С другой стороны использование полосы пропускания возрастет, как ненамного удается увеличить размер файлов CSS.

С помощью технологии адаптивной отрисовки, ваш сайт будет **отображаются правильно, независимо от браузера.** Однако следует учитывать, если загрузка дополнительных пропускной способности является серьезной проблемой.

> [!NOTE]
> Стандартный формат носителя запроса имеет: @media \[область: все | портативные | печати | проекции | экрана\] ([значение: свойство] и... [свойство: значение])


Примеры запросов носителя: &gt;  **@media все и (максимальная ширина: 1000px) и (минимальной ширины: 700px) {}:** для всех разрешений между 700px и 1000px.

> **@media экран и (минимальной ширины: 400 пикс) и (максимальная ширина: 700px) {...}:** только для экранов. Разрешение должно быть в диапазоне от 400 до 700px.
> 
> **@media портативные и (минимальной ширины: 20em), экран и (минимальной ширины: 20em) {...}:** для карманных ПК (устройств и мобильных устройств) и экраны. Минимальная ширина должна быть больше 20em.
> 
> Дополнительные сведения об этом можно найти на [сайт консорциума W3C](http://www.w3.org/TR/css3-mediaqueries/).


Теперь будет изучено, как работает адаптивной отрисовки, повышения удобочитаемости ASP.NET MVC 4 по умолчанию шаблона веб-сайта.

1. Откройте **PhotoGallery.sln** решений, созданных в задаче 1 и выберите **PhotoGallery** проекта. Нажмите клавишу **F5** для запуска решения.
2. Изменение ширины браузера, установка windows вдвое или меньше, чем четверти его исходный размер. Обратите внимание, что происходит с элементами в заголовке: некоторые элементы не будут отображаться в видимой области заголовка.
3. Откройте **Site.css** файл из обозревателя решений Visual Studio, расположенный в **содержимого** папки проекта. Нажмите клавишу **сочетание клавиш CTRL + F** откройте Visual Studio интегрированный поиск и запись  **@media**  искомый **запрос носителя CSS**.

    Условия запроса мультимедиа, определенные в этом шаблоне работает таким образом: если меньше размера окна браузера **850 px**, применены правила CSS, являются определены внутри этого блока носителя.

    ![Выбрать запрос носителя](whats-new-in-aspnet-mvc-4/_static/image16.png "поиск запрос носителя")

    *Поиск запросов мультимедиа*
4. Замените значение атрибута Максимальная ширина 850 px с **10px**, чтобы отключить адаптивной отрисовки и нажмите клавишу **сочетание клавиш CTRL + S** для сохранения изменений. Вернуться к браузера и нажмите клавишу **сочетание клавиш CTRL + F5** обновления страницы с внесенные изменения. Имеются различия в обе страницы при изменении ширины окна.

    ![В левой части страницы применяет @media задан стиль в правом стиль](whats-new-in-aspnet-mvc-4/_static/image17.png "применяет в левой части страницы @media задан стиль в правом стиль")

    *В левой части страницы применяет @media стиля в правом стиль пропущен*

    Теперь проверим, что происходит на мобильных устройствах:

    ![В левой части страницы применяет @media задан стиль в правом стиль](whats-new-in-aspnet-mvc-4/_static/image18.png "применяет в левой части страницы @media задан стиль в правом стиль")

    *В левой части страницы применяет @media стиля в правом стиль пропущен*

    Несмотря на то, что вы заметите, что изменения при отображении страницы в браузере не очень важно при использовании мобильного устройства различия становятся более очевидным. В левой части изображения мы видим, что пользовательский стиль повысить читаемость.

    Во многих сценариях дополнительные, что упрощает применение условного стиля на веб-сайт и решить общие проблемы со стилями аккуратно подход можно использовать адаптивной отрисовки.

    Метатег окна просмотра и медиа-запросами CSS не являются специфичными для ASP.NET MVC 4, можно воспользоваться преимуществами этих функций в любой веб-приложения.
5. В Visual Studio нажмите клавишу **SHIFT** + **F5** остановить отладку приложения.

<a id="Exercise2"></a>

<a id="Exercise_2_Creating_the_Photo_Gallery_Web_Application"></a>
### <a name="exercise-2-creating-the-photo-gallery-web-application"></a>Упражнение 2: Создание веб-приложения фотоальбом

В этом упражнении будет работать в приложении фотоальбома для отображения фотографий. Начните с шаблона проекта ASP.NET MVC 4, и затем нужно добавить компонент для получения фотографий из службы и отображать их на домашней странице.

В следующем упражнении обновит это решение для улучшения способ отображения на мобильных устройствах.

<a id="Task_1_-_Creating_a_Mock_Photo_Service"></a>
#### <a name="task-1---creating-a-mock-photo-service"></a>Задача 1. Создание службы макетов фото

В этой задаче вы создадите макетов фото службы для получения содержимого, которое будет отображаться в коллекции. Чтобы сделать это, будет добавлен новый контроллер, просто возвращает JSON-файла с данными каждой фотографии.

1. Откройте **Visual Studio** Если еще не открыт.
2. Выберите **файл | Новые | Проект** команду меню. В **новый проект** диалогового окна выберите **Visual C# | Web** шаблона на левой панели дерева, а затем выберите **веб-приложение ASP.NET MVC 4.** Назовите проект **PhotoGallery**, выберите расположение (или оставьте значение по умолчанию) и нажмите кнопку **ОК**. Кроме того, вы можете продолжать работать с вашей существующей ASP.NET MVC 4 **веб-приложение** решения от **упражнении 1** и пропустить следующий шаг.
3. В **нового проекта ASP.NET MVC 4** выберите **веб-приложение** шаблон проекта и нажмите кнопку **ОК**. Убедитесь, что у вас выбран в качестве обработчика представлений Razor.
4. В **обозревателе решений**, щелкните правой кнопкой мыши **приложения\_данные** папку проекта и выберите **добавить | Существующий элемент**. Перейдите к **Source\Assets\App\_данные** папку части этой лаборатории и добавьте **Photos.json** файла.
5. Создание нового контроллера с именем **PhotoController**. Для этого щелкните правой кнопкой мыши **контроллеров** папки, перейдите на **добавить** и выберите **контроллера.** Полное имя контроллера, оставьте **контроллер MVC пустой** шаблона и нажмите кнопку **добавить**.

    ![Добавление PhotoController](whats-new-in-aspnet-mvc-4/_static/image19.png "Добавление PhotoController")

    *Добавление PhotoController*
6. Замените **индекс** метод со следующими **коллекции** действие и возвращают содержимое из файла JSON, вы недавно добавили в проект.

    (Фрагмент - кода *действия коллекции ASP.NET MVC 4 лаборатории - Ex02 -*)


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample4.cs)]
7. Нажмите клавишу **F5** для запуска решения и перейдите в следующий URL-адрес для тестирования службы макеты фото: `http://localhost:[port]/photo/gallery` (значение [порт] зависит от текущего порта, где было запущено приложение). Этот URL-адрес запроса, должны извлекать содержимое **Photos.json** файла.

    ![Тестирование службы макеты фото](whats-new-in-aspnet-mvc-4/_static/image20.png "тестирование службы макеты фото")

    *Тестирование службы макеты фото*

В фактической реализации можно было использовать [веб-API ASP.NET](../../../../web-api/index.md) для реализации службы фотоальбома. Веб-API ASP.NET — это платформа, которая позволяет легко создавать службы HTTP широкого диапазона клиентов, включая браузеры и мобильные устройства. ASP.NET Web API - это идеальная платформа для сборки REST-приложений на базе .NET Framework.

<a id="Task_2_-_Displaying_the_Photo_Gallery"></a>
#### <a name="task-2---displaying-the-photo-gallery"></a>Задача 2 - отображение коллекции фотографий

В этой задаче будет обновлять домашнюю страницу, чтобы показать коллекции фотографий с помощью службы макеты, созданный в первой задаче этого упражнения. Добавим файлы модели и обновить представления коллекции.

1. В Visual Studio нажмите клавишу **SHIFT** + **F5** остановить отладку приложения.
2. Создание **фото** класса в **моделей** папки. Для этого щелкните правой кнопкой мыши **моделей** выберите **добавить** и нажмите кнопку **класса**. Задайте имя **Photo.cs** и нажмите кнопку **добавить**.
3. Добавьте следующие члены для **фото** класса.

    (Фрагмент - кода *модели ASP.NET MVC 4 лаборатории - Ex02 - фотография*)


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample5.cs)]
4. Откройте файл **HomeController.cs** в папке **Controllers**.
5. Добавьте следующие инструкции using.

    (Фрагмент - кода *HomeController директивы ASP.NET MVC 4 лаборатории - Ex02 -*)


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample6.cs)]
6. Обновление **индекс** действие, чтобы использовать **HttpClient** для получения коллекции данных, а затем используйте **JavaScriptSerializer** десериализуемые модели представления.

    (Фрагмент - кода *действие индекса ASP.NET MVC 4 лаборатории - Ex02 -*)


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample7.cs)]
7. Откройте **Index.cshtml** файла, расположенного в **Views\Home** папки и замените все содержимое следующим кодом.

    Этот код просматривает все фотографии, полученный из службы и отображает их в неупорядоченный список.

    (Фрагмент - кода *список фото ASP.NET MVC 4 лаборатории - Ex02 -*)


    [!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample8.cshtml)]
8. В **обозревателе решений**, щелкните правой кнопкой мыши **содержимого** папку проекта и выберите **добавить | Существующий элемент**. Перейдите к **Source\Assets\Content** папку части этой лаборатории и добавьте **Site.css** файла. Необходимо будет подтвердить его замену. Если у вас есть **Site.css** файл открыт, необходимо будет подтвердить также перезагрузить файл.
9. Откройте проводник и скопировать всю **фотографии** папка размещена в **Source\Assets** папку части этой лаборатории в корневую папку проекта в обозревателе решений.
10. Запустите приложение. Теперь вы увидите домашнюю страницу отображения фотографий в коллекции.

    ![Фотоальбом](whats-new-in-aspnet-mvc-4/_static/image21.png "фотоальбом")

    *Фотоальбом*
11. В Visual Studio нажмите клавишу **SHIFT** + **F5** остановить отладку приложения.

<a id="Exercise3"></a>

<a id="Exercise_3_Adding_support_for_mobile_devices"></a>
### <a name="exercise-3-adding-support-for-mobile-devices"></a>Упражнение 3: Добавление поддержки для мобильных устройств

Одно из ключевых обновлений в ASP.NET MVC 4 — поддержка разработки мобильных приложений. В этом упражнении вы исследуете новые возможности мобильных приложений ASP.NET MVC 4, расширяя Коллекция фотографий решения, созданный в предыдущем упражнении.

<a id="Task_1_-_Installing_jQuery_Mobile_in_an_ASPNET_MVC_4_Application"></a>
#### <a name="task-1---installing-jquery-mobile-in-an-aspnet-mvc-4-application"></a>Задача 1. Установка jQuery Mobile, в приложении ASP.NET MVC 4

1. Откройте **начать** решений, расположенный **источника/Ex3-MobileSupport/начало/** папки. В противном случае можно продолжить использование **окончания** решения получен путем выполнения в предыдущем упражнении.

    1. Если вы открыли указанных **начать** решение, необходимо будет загрузить несколько отсутствующих пакетов NuGet прежде чем продолжить. Чтобы сделать это, нажмите кнопку **проекта** и выбрать пункт **управление пакетами NuGet**.
    2. В **управление пакетами NuGet** диалоговое окно, нажмите кнопку **восстановить** чтобы скачивать отсутствующие пакеты.
    3. Наконец, постройте решение, нажав кнопку **построения** | **построить решение**.

    > [!NOTE]
    > Одним из преимуществ использования NuGet является у вас не указан для отправки всех библиотек в вашем проекте, уменьшив размер проекта. С помощью NuGet Power Tools указав версий пакета в файле Packages.config можно для загрузки всех необходимых библиотек первый раз, при запуске проекта. Вот почему необходимо будет выполнить эти шаги после открытия существующего решения в этой лаборатории.
2. Откройте **консоль диспетчера пакетов** , щелкнув **средства** &gt; **диспетчер пакетов библиотеки** &gt; **диспетчера пакетов Консоль** пункт меню.

    ![Открытие консоли диспетчера пакетов NuGet](whats-new-in-aspnet-mvc-4/_static/image22.png "Открытие консоли диспетчера пакетов NuGet")

    *Открытие консоли диспетчера пакетов NuGet*
3. В консоли диспетчера пакетов выполните следующую команду, чтобы установить **jQuery.Mobile.MVC** пакета.

    jQuery Mobile — это библиотека открытым исходным кодом, для создания оптимизированных для сенсорных экранов веб-интерфейса. Пакет NuGet jQuery.Mobile.MVC включает вспомогательные методы для использования с приложением ASP.NET MVC 4 jQuery Mobile.

    > [!NOTE]
    > Выполнив следующую команду, будут загружать библиотеки jQuery.Mobile.MVC из Nuget.

    по полудню

    [!code-powershell[Main](whats-new-in-aspnet-mvc-4/samples/sample9.ps1)]

    Эта команда устанавливает jQuery Mobile и некоторые вспомогательные файлы, включая следующие:

    - **Представления/Общие/\_Layout.Mobile.cshtml**: макет мобильное jQuery, оптимизированный для меньшего размера экрана. Если веб-сайт получает запрос от мобильных браузеров, он заменяет исходного макета (\_Layout.cshtml) на следующее.
    - Переключатель вида компонента: состоит из **представления/Общие/\_ViewSwitcher.cshtml** частичного представления и **ViewSwitcherController.cs** контроллера. Этот компонент будет отображать ссылку на браузеры мобильных устройств, чтобы пользователь мог перейти к рабочему столу версии страницы.  
        ![Проект фотоальбома с поддержка мобильных устройств](whats-new-in-aspnet-mvc-4/_static/image23.png "проект фотоальбома с поддержка мобильных устройств")

        *Проект фотоальбома с поддержка мобильных устройств*
4. Регистрация мобильных устройств пакеты. Чтобы сделать это, откройте **Global.asax.cs** файл и добавьте следующую строку.

    (Фрагмент - кода *ASP.NET MVC 4 лаборатории - Ex03 - регистрация мобильных устройств пакеты*)


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample10.cs)]
5. Запустите приложение с помощью рабочего стола веб-браузер.
6. Откройте **эмуляторе Windows Phone 7** в **меню «Пуск» | Все программы | Windows Phone SDK 7.1 | Эмулятор Windows Phone.**
7. На начальном экране телефона откройте Internet Explorer. Извлечь URL-адрес, где запуска приложения и перейдите к URL-адреса с помощью браузера телефона (например `http://localhost:[PortNumber]/`).

    Обратите внимание, что приложение будет выглядеть в эмуляторе Windows Phone, как jQuery.Mobile.MVC создал новые ресурсы в проекте, которые показывают представления, оптимизированный для мобильных устройств.

    Сообщение в верхней части телефона, обозначающие связи, переключается в представление рабочего стола. Кроме того  **\_Layout.Mobile.cshtml** макет, который был создан пакет установки — включая структуру, в приложении.

    > [!NOTE]
    > На данный момент нет ссылки вернуться назад в представление для мобильных устройств. Он включается в более поздних версиях.

    ![Представление коллекции фотографий на домашней странице для мобильных устройств](whats-new-in-aspnet-mvc-4/_static/image24.png "представление коллекции фотографий на домашней странице для мобильных устройств")

    *Представление коллекции фотографий на домашней странице для мобильных устройств*
8. В Visual Studio нажмите клавишу **SHIFT** + **F5** остановить отладку приложения.

<a id="Task_2_-_Creating_Mobile_Views"></a>
#### <a name="task-2---creating-mobile-views"></a>Задача 2 - Создание мобильных представлений

В этой задаче вы создадите мобильной версии индекс представления с содержимым, адаптированная для повышения appareance на мобильных устройствах.

1. Копировать **Views\Home\Index.cshtml** просмотра и вставьте его для создания копии, переименовать новый файл в **Index.Mobile.cshtml**.
2. Открытие нового созданного **Index.Mobile.cshtml** просмотра и замените существующий &lt;ul&gt; тег с этим кодом. Таким образом происходит обновление &lt;ul&gt; тег с заметками jQuery мобильных данных использование мобильных тем из jQuery.


    [!code-html[Main](whats-new-in-aspnet-mvc-4/samples/sample11.html)]

    > [!NOTE] 
    > 
    > Обратите внимание на указанные ниже моменты.
    > 
    > - **Роли данных** атрибута **listview** будет отображаться в список с помощью стилей listview.
    > 
    > - **Вставки данных** атрибута равным true будет отображать список со скругленными углами и поля.
    > 
    > - **Фильтр данных** атрибута **true** создаст поле поиска.
    > 
    > Дополнительные сведения о соглашениях мобильных jQuery в документации для проекта: [ [http://jquerymobile.com/demos/1.1.1/](http://jquerymobile.com/demos/1.1.1/)](http://jquerymobile.com/demos/1.1.1/)
3. Нажмите клавишу **сочетание клавиш CTRL + S** для сохранения изменений.
4. Переключитесь в **эмулятор Windows Phone** и обновите узел. Обратите внимание, новый внешний вид списка коллекции, а также новое поле поиска, расположенных в верхней части страницы. Введите слово в поле поиска (например, **Tulips**) для начала поиска в коллекции фотографий.

    ![Коллекции, используя стиль listview с фильтрацией](whats-new-in-aspnet-mvc-4/_static/image25.png "коллекции, используя стиль listview с фильтрацией")

    *Коллекции, используя стиль listview с фильтрацией*

    Итак, вы использовали рецепт Mobilizer представление для создания копии индекс представления с &quot;мобильных&quot; суффикс. Этот суффикс указывает ASP.NET MVC 4, что каждый запрос, созданный на мобильном устройстве будет использовать эту копию индекса. Кроме того были обновлены мобильной версии индекс представления, чтобы использовать jQuery Mobile для повышения сайта интерфейса на мобильных устройствах.
5. Вернитесь в Visual Studio и откройте **Site.Mobile.css** в компоненте **содержимого** папки.
6. Исправьте позиционирования Название фотографии, чтобы отобразить в правой части изображения. Чтобы сделать это, добавьте следующий код в **Site.Mobile.css** файла.

    CSS

    [!code-css[Main](whats-new-in-aspnet-mvc-4/samples/sample12.css)]
7. Нажмите клавишу **сочетание клавиш CTRL + S** для сохранения изменений.
8. Вернитесь в **эмулятор Windows Phone** и обновите узел. Обратите внимание, что название фотографии теперь позиционируется.

    ![Заголовок располагается справа от изображения](whats-new-in-aspnet-mvc-4/_static/image26.png "заголовок располагается справа от изображения")

    *Заголовок располагается справа от изображения*

<a id="Task_3_-_jQuery_Mobile_Themes"></a>
#### <a name="task-3---jquery-mobile-themes"></a>Задача 3 - jQuery Mobile темы

Каждый макет и мини-приложение в jQuery Mobile построена новую объектно ориентированного CSS платформу, делает возможным применение темы полные унифицированную визуального проектирования сайтов и приложений.

по умолчанию jQuery Mobile темы включает 5 образцов, которые получают буквы (a, b, c, d, e) краткий справочник.

В этой задаче будет обновлена мобильных макет для использования другой темы по умолчанию.

1. Переключитесь в Visual Studio.
2. Откройте  **\_Layout.Mobile.cshtml** файл, расположенный в **представления\общие**.
3. Найдите элемент div с равным роли данных &quot;страницы&quot; и обновить **данных темы** для &quot; **e**&quot;.


    [!code-html[Main](whats-new-in-aspnet-mvc-4/samples/sample13.html)]
4. Нажмите клавишу **сочетание клавиш CTRL + S** для сохранения изменений.
5. Обновить список узлов в **эмулятор Windows Phone** и обратите внимание, новая схема цветов.

    ![Макет мобильных устройств с другой цветовой схемы](whats-new-in-aspnet-mvc-4/_static/image27.png "мобильных макет с другой цветовой схемы")

    *Макет мобильных устройств с другой цветовой схемы*

<a id="Task_4_-_Using_the_View-Switcher_Component_and_the_Browser_Overriding_Features"></a>
#### <a name="task-4---using-the-view-switcher-component-and-the-browser-overriding-features"></a>Задача 4 - с помощью переключателя представление компонента и браузер переопределение функций

Соглашение для веб-страниц, оптимизированные для мобильных устройств — Добавление ссылки, текст которых стоит как представление рабочего стола или режиме весь сайт, который позволяет пользователям перейти рабочего стола версии страницы. В пакете jQuery.Mobile.MVC образец **-переключателя** компонента для этой цели используется в  **\_Layout.Mobile.cshtml** представления.

![Ссылку, чтобы переключиться в представление рабочего стола](whats-new-in-aspnet-mvc-4/_static/image28.png "ссылку, чтобы переключиться в представление рабочего стола")

*Ссылку для переключения в представление рабочего стола*

Новая функция, называемая использует переключателя **переопределения браузера**. Эта функция позволяет приложению рассматривать запросы, как если бы они поступали от той, которую они фактически получены другой браузер (агент пользователя).

В этой задаче будет изучено пример реализации просмотреть переключатель добавления, jQuery.Mobile.MVC и новый браузер переопределение функции в ASP.NET MVC 4.

1. Переключитесь в Visual Studio.
2. Откройте  **\_Layout.Mobile.cshtml** представление, расположенную под **одну** папки и обратите внимание, адресуемый как частичное представление компонента представления переключателя.

    ![Мобильные макета с помощью переключателя представление компонента](whats-new-in-aspnet-mvc-4/_static/image29.png "мобильных макета с помощью переключателя компонента")

    *Мобильные макета с помощью переключателя компонента*
3. Откройте  **\_ViewSwitcher.cshtml** частичного представления.

    Частичное представление использует новый метод **ViewContext.HttpContext.GetOverriddenBrowser()** для определения источника веб-запроса и отображения соответствующую ссылку для переключения, либо для просмотра рабочего стола или мобильных устройств.

    **GetOverridenBrowser** возвращает **HttpBrowserCapabilitiesBase** экземпляра, соответствующего агента пользователя, заданных в настоящее время для запроса (фактические или переопределения). Это значение можно использовать для получения свойств, таких как **IsMobileDevice**.

    ![Частичное представление ViewSwitcher](whats-new-in-aspnet-mvc-4/_static/image30.png "ViewSwitcher частичного представления")

    *Частичное представление ViewSwitcher*
4. Откройте **ViewSwitcherController.cs** класс находится в **контроллеров** папки. Ознакомьтесь с этой SwitchView действие вызывается по ссылке в компоненте ViewSwitcher и обратите внимание, новые методы HttpContext.

    - **HttpContext.ClearOverridenBrowser()** метод удаляет все переопределенные агенты пользователя для текущего запроса.
    - **HttpContext.SetOverridenBrowser()** метод переопределяет значение агента пользователя запроса, с указанием указанного агента пользователя.  
        ![Контроллер ViewSwitcher](whats-new-in-aspnet-mvc-4/_static/image31.png "ViewSwitcher контроллера")  
*ViewSwitcher контроллера*

        Переопределение браузера является основной функцией ASP.NET MVC 4, который можно получить и даже если не установить пакет jQuery.Mobile.MVC. Тем не менее эта функция влияет только на просмотр, макет и частичного представления, и он не влияет на функциональные возможности, которые зависят от объекта Request.Browser.

<a id="Task_5_-_Adding_the_View-Switcher_in_the_Desktop_View"></a>
#### <a name="task-5---adding-the-view-switcher-in-the-desktop-view"></a>Задача 5 - Добавление переключателем представлений в представлении рабочего стола

В этой задаче будет обновлена формата рабочего стола для включения переключателем представлений. Это позволит мобильных пользователей, чтобы вернуться в представление для мобильных устройств при просмотре представление рабочего стола.

1. Обновить список узлов в **эмулятор Windows Phone**.
2. Щелкните **представление рабочего стола** ссылку в верхней части галереи. Обратите внимание, что в представлении рабочего стола, чтобы разрешить вернуться к представлению мобильных устройств не-переключателя.
3. Вернитесь в Visual Studio и откройте  **\_Layout.cshtml** представления.
4. Найдите раздел входа и вставить вызов для подготовки к просмотру  **\_ViewSwitcher** частичного представления ниже  **\_LogOnPartial** частичного представления. Затем нажмите клавишу **сочетание клавиш CTRL + S** для сохранения изменений.


    [!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample14.cshtml)]
5. Нажмите клавишу **сочетание клавиш CTRL + S** для сохранения изменений.
6. Обновите страницу в эмуляторе Windows Phone и дважды щелкните на экране, чтобы увеличить масштаб. Обратите внимание, что теперь на домашней странице отображаются **представление для мобильных устройств** ссылку, которая переходит от мобильных устройств для рабочего стола.

    ![Просмотр переключателя, отображаются в представлении рабочего стола](whats-new-in-aspnet-mvc-4/_static/image32.png "переключателя отображается в представлении рабочего стола")

    *Просмотреть переключатель отображается в представлении рабочего стола*
7. Снова перейдите в представление для мобильных устройств и перейдите к **о** страницы (http://localhost [порт] / Home/о). Обратите внимание, что, даже если еще не создан для представления About.Mobile.cshtml, о программе страницы с использованием мобильных макета (\_Layout.Mobile.cshtml).

    ![О странице](whats-new-in-aspnet-mvc-4/_static/image33.png "о странице")

    *О странице*
8. Наконец откройте сайт в веб-браузер для настольных компьютеров. Обратите внимание, что ни один из предыдущих обновлений повлияла представление рабочего стола.

    ![Коллекция фотографий представление рабочего стола](whats-new-in-aspnet-mvc-4/_static/image34.png "представление рабочего стола Коллекция фотографий")

    *Коллекция фотографий представление рабочего стола*

<a id="Task_6_-_Creating_New_Display_Modes"></a>
#### <a name="task-6---creating-new-display-modes"></a>Задача 6. Создание нового режимы отображения

Новая функция режимов отображения для работы приложения выберите представления, в зависимости от браузера, создающего запрос. Например, если браузер на компьютере запросы на домашней странице, приложение возвращает **Views\Home\Index.cshtml** шаблона. Затем, если мобильный браузер запрашивает домашнюю страницу, приложение возвращает **Views\Home\Index.mobile.cshtml** шаблона.

В этой задаче вы создадите пользовательского макета для устройств iPhone и будет необходимо смоделировать запросы из устройства iPhone. Для этого можно использовать либо эмулятор или эмулятор iPhone (как [должен быть электрический Mobile симулятор](http://www.electricplum.com/)) или в браузере с надстройками, изменяющие агента пользователя. Инструкции о том, как задать строку агента пользователя в обозревателе Safari для эмуляции iPhone см. в разделе [как предоставить Safari представьте это IE](http://www.davidalison.com/2008/05/how-to-let-safari-pretend-its-ie.html) в блоге Дэвида Alison.

**Обратите внимание, что эта задача является необязательным, и можно перейти в лаборатории. без его выполнения.**

1. В Visual Studio нажмите клавишу **SHIFT** + **F5** остановить отладку приложения.
2. Откройте **Global.asax.cs** и добавьте следующий код с помощью инструкции.


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample15.cs)]
3. Добавьте следующий выделенный код в приложение\_Start-метод.

    (Фрагмент - кода *ASP.NET MVC 4 лаборатории - Ex03 - iPhone DisplayMode*)


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample16.cs)]

    Вы зарегистрировали новый **DefaultDisplayMode с именем &quot;iPhone&quot;**, внутри статического **DisplayModeProvider.Instance.Modes** статического списка, который будет сопоставлена с каждого входящего запроса. Если входящий запрос содержит строку &quot;iPhone&quot;, ASP.NET MVC поиск представлений, имя которого содержит &quot;iPhone&quot; суффикс. Параметр 0 указывает, как определенные новый режим; Например, данное представление является более точным определением, чем обычные &quot;.mobile&quot; правилом, которое сопоставляет запросы от мобильных устройств.

    После выполнения этого кода, если в браузере iPhone создает запрос, приложение будет использовать **представления\общие\\_Layout.iPhone.cshtml** макет, вы создадите в следующих шагах.

    > [!NOTE]
    > Этот способ проверки запроса для iPhone был упрощен в целях демонстрации и может не работать должным образом для каждой строки агента пользователя iPhone (для тестирования пример — с учетом регистра).
4. Создать копию  **\_Layout.Mobile.cshtml** файла в **представления\общие** папку и переименуйте копию для &quot;  **\_Layout.iPhone.csthml** &quot;.
5. Откройте  **\_Layout.iPhone.csthml** создан на предыдущем шаге.
6. Найдите элемент div с атрибутом роли данных, равным **страницы** и измените **данных темы** атрибут &quot;**a**&quot;.


    [!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample17.cshtml)]

    Теперь имеется 3 макеты в приложении ASP.NET MVC 4:

    1. **\_Layout.cshtml**: макет по умолчанию, используемый для браузеров настольных компьютеров.
    2. **\_Layout.Mobile.cshtml**: макет по умолчанию, используемый для мобильных устройств.
    3. **\_Layout.iPhone.cshtml**: определенного макета для устройств iPhone, с помощью другой цветовой схемы для различения \_Layout.mobile.cshtml.
7. Нажмите клавишу **F5** для запуска приложения и перейдите на сайт в **эмулятор Windows Phone**.
8. Откройте **iPhone симулятор** (см. [приложении C](#AppendixC) инструкции о том, как установить и настроить эмулятор iPhone) и перейти на сайт слишком. Обратите внимание, что каждый телефона использует указанный шаблон.

    ![Using-different-views-for-each-mobile-device2](whats-new-in-aspnet-mvc-4/_static/image35.png)

    *С помощью различных представлений для каждого мобильного устройства*

<a id="Exercise4"></a>

<a id="Exercise_4_Using_Asynchronous_Controllers"></a>
### <a name="exercise-4-using-asynchronous-controllers"></a>Упражнение 4: Использование асинхронных контроллеров

Microsoft .NET Framework 4.5 предоставляет новые возможности языка C# и Visual Basic для предоставления новой платформы для асинхронности в программировании .NET. Этот новый foundation делает асинхронное программирование аналогично - и примерно так же просто, как и - синхронное. Теперь имеется возможность написать асинхронные методы действия в ASP.NET MVC 4 с помощью **AsyncController и контроллеры** класса. Асинхронные методы действия можно использовать для долго выполняющихся, не связаны с ЦП запросов. Это предотвращает блокировку веб-сервера от выполнения операций во время обработки запроса. AsyncController и контроллеры класс обычно используется для длительных вызовы веб-службы.

В этом упражнении объясняет основы асинхронных операций в ASP.NET MVC 4. Если вы хотите подробно, можно извлечь следующую статью: [ [https://msdn.microsoft.com/library/ee728598%28v=vs.100%29.aspx](https://msdn.microsoft.com/library/ee728598%28v=vs.100%29.aspx)](https://msdn.microsoft.com/library/ee728598%28v=vs.100%29.aspx)

<a id="Task_1_-_Implementing_an_Asynchronous_Controller"></a>
#### <a name="task-1---implementing-an-asynchronous-controller"></a>Задача 1 - реализации асинхронного контроллера

1. Откройте **начать** решений, расположенный **источника/Ex4-Async иBegin/** папки. В противном случае можно продолжить использование **окончания** решения получен путем выполнения в предыдущем упражнении.

    1. Если вы открыли указанных **начать** решение, необходимо будет загрузить несколько отсутствующих пакетов NuGet прежде чем продолжить. Чтобы сделать это, нажмите кнопку **проекта** и выбрать пункт **управление пакетами NuGet**.
    2. В **управление пакетами NuGet** диалоговое окно, нажмите кнопку **восстановить** чтобы скачивать отсутствующие пакеты.
    3. Наконец, постройте решение, нажав кнопку **построения** | **построить решение**.

    > [!NOTE]
    > Одним из преимуществ использования NuGet является у вас не указан для отправки всех библиотек в вашем проекте, уменьшив размер проекта. С помощью NuGet Power Tools указав версий пакета в файле Packages.config можно для загрузки всех необходимых библиотек первый раз, при запуске проекта. Вот почему необходимо будет выполнить эти шаги после открытия существующего решения в этой лаборатории.
2. Откройте **HomeController.cs** класса из **контроллеров** папки.
3. Добавьте следующий код с помощью инструкции.


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample18.cs)]
4. Обновление **HomeController** наследование от класса **AsyncController и контроллеры**. Контроллеры, которые являются производными от AsyncController и контроллеры позволяют ASP.NET выполнять обработку асинхронных запросов, и они могут обслуживать синхронные методы действия.


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample19.cs)]
5. Добавить **async** ключевое слово **индекс** метод и сделать его возвращаемый тип **задачи&lt;ActionResult&gt;**.


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample20.cs)]

    > [!NOTE]
    > **Async** ключевое слово является одним из .NET Framework 4.5 предоставляет новые ключевые слова; он сообщает компилятору, что этот метод содержит асинхронного кода. Объект **задачи** представляет асинхронную операцию, которая может выполняться в некоторый момент в будущем.
6. Замените **клиента. GetAsync()** вызов с полной async версии с помощью await ключевое слово, как показано ниже.

    (Фрагмент - кода *GetAsync ASP.NET MVC 4 лаборатории - Ex04 -*)


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample21.cs)]

    > [!NOTE]
    > В предыдущей версии, вы использовали **результат** свойство из **задачи** объекта, чтобы блокировать поток до возврата результата (версия sync).
    > 
    > Добавление **await** ключевое слово сообщает компилятору, чтобы асинхронно ожидать задачи, возвращаемой из вызова метода. Это означает, что остальной части кода выполняется как обратный вызов только после завершения ожидающей метод. Другой обстоятельством является не необходимо изменить в блок try-catch, чтобы обеспечить работоспособность: исключения, которые происходят в фоновом режиме или на переднем плане по-прежнему будет перехвачено без дополнительных действий с помощью обработчика, предоставляемых платформой.
7. Изменить код, чтобы продолжить асинхронную реализацию путем замены строки с новым кодом, как показано ниже

    (Фрагмент - кода *ReadAsStringAsync ASP.NET MVC 4 лаборатории - Ex04 -*)


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample22.cs)]
8. Запустите приложение. Можно заметить существенных изменений, но код не будет блокировать поток из пула потоков, делая лучше использования ресурсов сервера и повышения производительности.

    > [!NOTE]
    > Дополнительные сведения о новых асинхронных средств программирования в лаборатории &quot; **асинхронное программирование в .NET 4.5 с C# и Visual Basic** &quot; включены в пакет средств Visual Studio обучения.

<a id="Task_2_-_Handling_Time-Outs_with_Cancellation_Tokens"></a>
#### <a name="task-2---handling-time-outs-with-cancellation-tokens"></a>Задача 2 - обработка времени ожидания, токены отмены

Асинхронные методы действия, возвращающих экземпляры задач также могут поддерживать истечение времени ожидания. В этой задаче будет обновлять код метода индекс для обработки времени ожидания сценария, с помощью токена отмены.

1. Вернитесь в Visual Studio и нажмите клавишу **SHIFT + F5** остановить отладку.
2. Добавьте следующий оператор using **HomeController.cs** файла.


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample23.cs)]
3. Обновление действия индекса для получения **CancellationToken** аргумент.


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample24.cs)]
4. Обновление **GetAsync** вызов передать токен отмены.

    (Фрагмент - кода *SendAsync - Ex04 - лаборатории ASP.NET MVC 4 с CancellationToken*)


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample25.cs)]
5. Украшение *индекс* метод с **AsyncTimeout** атрибуту присвоено значение 500 миллисекунд и **HandleError** настроен для обработки атрибута  **TaskCanceledException** путем перенаправления **TimedOut** представления.

    (Фрагмент - кода *атрибуты ASP.NET MVC 4 лаборатории - Ex04 -*)


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample26.cs)]
6. Откройте **PhotoController** класс и обновление **коллекции** метод задержки в миллисекундах выполнения 1000 (1 секунда), для имитации длительной задачи.


    [!code-csharp[Main](whats-new-in-aspnet-mvc-4/samples/sample27.cs)]
7. Откройте **Web.config** файл и включите настраиваемых ошибок, добавив следующий элемент.


    [!code-xml[Main](whats-new-in-aspnet-mvc-4/samples/sample28.xml)]
8. Создание нового представления в **представления\общие** с именем **TimedOut** и использовать макет по умолчанию. В обозревателе решений щелкните правой кнопкой мыши **представления\общие** папку и выберите **добавить | Представление**.

    ![С помощью различных представлений для каждого мобильного устройства](whats-new-in-aspnet-mvc-4/_static/image36.png "с помощью различных представлений для каждого мобильного устройства")

    *С помощью различных представлений для каждого мобильного устройства*
9. Обновление **TimedOut** просматривать содержимое, как показано ниже.


    [!code-cshtml[Main](whats-new-in-aspnet-mvc-4/samples/sample29.cshtml)]
10. Запустите приложение и перейдите в корневой URL-адрес. Как вы добавили **Thread.Sleep** 1000 миллисекунд, возникнет ошибка времени ожидания, созданные **AsyncTimeout** атрибута и catch **HandleError** атрибут.

    ![Исключение обрабатывается](whats-new-in-aspnet-mvc-4/_static/image37.png "исключение обрабатывается")

    *Исключение обрабатывается*

> [!NOTE]
> Кроме того, можно развернуть это приложение на веб-сайтов Windows Azure ниже [приложение D: публикации приложения ASP.NET MVC 4 с помощью веб-развертывания](#AppendixD).


<a id="Summary"></a>

<a id="Summary"></a>
## <a name="summary"></a>Сводка

В этом практическая работа вы встречающейся некоторые новые компоненты находятся в ASP.NET MVC 4. Обсуждались следующие понятия:

- Воспользоваться преимуществами расширений для ASP.NET MVC проект шаблоны, в том числе нового шаблона проекта приложений для мобильных устройств
- Использовать атрибут просмотра HTML5 и медиа-запросами CSS для улучшения отображения на мобильных устройствах
- Используйте jQuery Mobile для прогрессивного улучшения и для создания оптимизированных для сенсорных экранов веб-интерфейса
- Создавать мобильные особых представлений
- Использовать компонент представления переключателя для переключения между представлениями мобильные и Классические приложения
- Создание асинхронных контроллеров с помощью поддержки задач

<a id="AppendixA"></a>

<a id="Appendix_A_Using_Code_Snippets"></a>
## <a name="appendix-a-using-code-snippets"></a>Приложение а. Использование фрагментов кода

С помощью фрагментов кода у вас есть весь код, который требуется под рукой. Документ лаборатории сообщает только при их использовании, как показано на следующем рисунке.

![Фрагменты кода Visual Studio для вставки кода в проекте](whats-new-in-aspnet-mvc-4/_static/image38.png "фрагменты кода с помощью Visual Studio вставьте код в проект")

*Фрагменты кода Visual Studio для вставки кода в проекте*

***Добавление фрагмента кода, с помощью клавиатуры (только C#)***

1. Поместите курсор в место вставки кода.
2. Начните вводить имя фрагмента (без пробелов и дефисы).
3. Смотрите, как IntelliSense отображает, совпадающие с именами фрагменты.
4. Выберите правильный фрагмент (или продолжите ввод, пока не будет выделен весь фрагмент имени).
5. Нажмите клавишу Tab дважды, чтобы вставить фрагмент в положении курсора.

![Начните вводить имя фрагмента](whats-new-in-aspnet-mvc-4/_static/image39.png "начните вводить имя фрагмента")

*Начните вводить имя фрагмента*

![Нажмите клавишу Tab, чтобы выделить выделенный фрагмент](whats-new-in-aspnet-mvc-4/_static/image40.png "нажмите клавишу Tab, чтобы выделить выделенный фрагмент")

*Нажмите клавишу Tab, чтобы выделить выделенный фрагмент*

![Снова нажмите клавишу Tab и фрагмент будет расширен](whats-new-in-aspnet-mvc-4/_static/image41.png "будет расширен, снова нажмите клавишу Tab и фрагмента кода")

*Снова нажмите клавишу Tab и фрагмент будет расширен*

***Добавление фрагмента кода, с помощью мыши (C#, Visual Basic и XML)***

1. Щелкните правой кнопкой мыши место вставки фрагмента кода.
2. Выберите **вставить фрагмент** следуют **Мои фрагменты кода**.
3. Выберите соответствующий фрагмент из списка, щелкнув по ней.

![Щелкните правой кнопкой мыши место для вставки фрагмента кода и выбора вставить фрагмент](whats-new-in-aspnet-mvc-4/_static/image42.png "место для вставки фрагмента кода и выбора вставить фрагмент кода щелкните правой кнопкой мыши")

*Щелкните правой кнопкой мыши в место вставки фрагмента кода и выберите Вставить фрагмент*

![Выберите из списка, соответствующего фрагмента, щелкнув его](whats-new-in-aspnet-mvc-4/_static/image43.png "выбрать соответствующий фрагмент из списка, щелкнув по ней")

*Выберите соответствующий фрагмент из списка, щелкнув по ней*

<a id="AppendixB"></a>

<a id="Appendix_B_Installing_Visual_Studio_Express_2012_for_Web"></a>
## <a name="appendix-b-installing-visual-studio-express-2012-for-web"></a>Приложение б. Установка Visual Studio Express 2012 для Web

Можно установить **Microsoft Visual Studio Express 2012 для Web** или другой &quot;Express&quot; версию, используя  **[Microsoft Web Platform Installer](https://www.microsoft.com/web/downloads/platform.aspx)** . Следующие инструкции описывают действия, необходимые для установки *Visual studio Express 2012 для Web* с помощью *Microsoft Web Platform Installer*.

1. Последовательно выберите пункты [ [https://go.microsoft.com/?linkid=9810169](https://go.microsoft.com/?linkid=9810169)](https://go.microsoft.com/?linkid=9810169). Кроме того, если вы уже установили установщика веб-платформы, можно открыть его и выполните поиск продукта &quot; *Visual Studio Express 2012 для Web с пакетом Windows Azure SDK*&quot;.
2. Щелкните **установить сейчас**. Если у вас **Web Platform Installer** вы будете перенаправлены, чтобы загрузить и установить ее сначала.
3. Один раз **Web Platform Installer** открыто, нажмите кнопку **установить** для запуска программы установки.

    ![Установка Visual Studio Express](whats-new-in-aspnet-mvc-4/_static/image44.png "установка Visual Studio Express")

    *Установка Visual Studio Express*
4. Чтение всех продуктов лицензий и условия и нажмите кнопку **принимаю** для продолжения.

    ![Принятие условий лицензионного соглашения](whats-new-in-aspnet-mvc-4/_static/image45.png)

    *Принятие условий лицензионного соглашения*
5. Дождитесь завершения процесса загрузки и установки.

    ![Ход установки](whats-new-in-aspnet-mvc-4/_static/image46.png)

    *Ход выполнения установки*
6. По завершении установки нажмите кнопку **Готово**.

    ![Установка завершена](whats-new-in-aspnet-mvc-4/_static/image47.png)

    *Установка завершена*
7. Нажмите кнопку **выхода** закрыть установщик веб-платформы.
8. Чтобы открыть Visual Studio Express для Web, перейдите к **запустить** экрана и начинается запись &quot; **VS Express**&quot;, выберите команду **VS Express для Web** Плитка.

    ![VS Express для Web плитки](whats-new-in-aspnet-mvc-4/_static/image48.png)

    *VS Express для Web плитки*

<a id="AppendixC"></a>

<a id="Appendix_C_Installing_WebMatrix_2_and_iPhone_Simulator"></a>
## <a name="appendix-c-installing-webmatrix-2-and-iphone-simulator"></a>Приложение в. Установка WebMatrix 2 и iPhone симулятор

Для запуска веб-узла на устройстве iPhone имитацию можно использовать расширения WebMatrix &quot;должен быть электрический симулятор Mobile для iPhone&quot;. Кроме того можно настроить то же самое расширение, для запуска имитатора из Visual Studio 2012.

<a id="ApxCTask1"></a>

<a id="Task_1_-_Installing_WebMatrix_2"></a>
#### <a name="task-1---installing-webmatrix-2"></a>Задача 1. Установка WebMatrix 2

1. Последовательно выберите пункты [ [https://go.microsoft.com/?linkid=9809776](https://go.microsoft.com/?linkid=9809776)](https://go.microsoft.com/?linkid=9810169). Кроме того, если вы уже установили установщика веб-платформы, можно открыть его и выполните поиск продукта &quot; *WebMatrix 2*&quot;.
2. Щелкните **установить сейчас**. Если у вас **Web Platform Installer** вы будете перенаправлены, чтобы загрузить и установить ее сначала.
3. Один раз **Web Platform Installer** открыто, нажмите кнопку **установить** для запуска программы установки.

    ![Установка WebMatrix 2](whats-new-in-aspnet-mvc-4/_static/image49.png "Установка WebMatrix 2")

    *Установка WebMatrix 2*
4. Чтение всех продуктов лицензий и условия и нажмите кнопку **принимаю** для продолжения.

    ![Принятие условий лицензионного соглашения](whats-new-in-aspnet-mvc-4/_static/image50.png "принятие условий лицензионного соглашения")

    *Принятие условий лицензионного соглашения*
5. Дождитесь завершения процесса загрузки и установки.

    ![Ход выполнения установки](whats-new-in-aspnet-mvc-4/_static/image51.png "ход выполнения установки")

    *Ход выполнения установки*
6. По завершении установки нажмите кнопку **Готово**.

    ![Установка завершена](whats-new-in-aspnet-mvc-4/_static/image52.png "Установка завершена")

    *Установка завершена*
7. Нажмите кнопку **выхода** закрыть установщик веб-платформы.

<a id="ApxCTask2"></a>

<a id="Task_2_-_Installing_the_iPhone_Simulator_Extension"></a>
#### <a name="task-2---installing-the-iphone-simulator-extension"></a>Задача 2 - Установка iPhone симулятор расширения

1. Запустите **WebMatrix** и откройте любой существующий веб-сайт или создайте новую.
2. Нажмите кнопку **запуска** кнопку **Главная** ленты и выберите **добавить новую**.

    ![Добавление нового расширения WebMatrix](whats-new-in-aspnet-mvc-4/_static/image53.png "Добавление нового расширения WebMatrix")

    *Добавление нового расширения WebMatrix*
3. Выберите **iPhone симулятор** и нажмите кнопку **установить**.

    ![Просмотр расширения WebMatrix](whats-new-in-aspnet-mvc-4/_static/image54.png "расширения WebMatrix, просмотр")

    *Просмотр расширения WebMatrix*
4. Сведения о пакете, щелкните **установить** для продолжения установки расширения.

    ![iPhone расширения симулятор](whats-new-in-aspnet-mvc-4/_static/image55.png "iPhone симулятор расширения")

    *iPhone симулятор расширения*
5. Прочтите и примите лицензионное соглашение расширения.

    ![Расширения WebMatrix лицензионное соглашение](whats-new-in-aspnet-mvc-4/_static/image56.png "расширения WebMatrix лицензионное соглашение")

    *Расширения WebMatrix лицензионное соглашение*
6. Теперь можно запустить веб-сайта из WebMatrix с помощью iPhone имитатор параметр.

    ![Запустить с помощью iPhone](whats-new-in-aspnet-mvc-4/_static/image57.png "запустить с помощью iPhone")

    *Запустить с помощью iPhone*

<a id="ApxCTask3"></a>

<a id="Task_3_-_Configuring_Visual_Studio_2012_to_run_iPhone_Simulator"></a>
#### <a name="task-3---configuring-visual-studio-2012-to-run-iphone-simulator"></a>Задача 3. Настройка Visual Studio 2012 для запуска симулятора iPhone

1. Откройте **Visual Studio 2012** и открыть любой веб-сайт или создайте новый проект.
2. Щелкните стрелку вниз, с помощью выполнения кнопки и выберите **перейти с**.

    ![Просмотр с помощью](whats-new-in-aspnet-mvc-4/_static/image58.png "просмотреть с помощью")

    *Просмотр с помощью*
3. В &quot;просмотр с помощью&quot; диалоговое окно, нажмите кнопку **добавить**.
4. В &quot;добавить программу&quot; диалогового окна, используйте следующие значения:

    - **Программа**: C:\Users\*{CurrentUser}*\AppData\Local\Microsoft\WebMatrix\Extensions\20\iPhoneSimulator\ElectricMobileSim\ElectricMobileSim.exe *(соответствующим образом обновить путь)*
    - **Аргументы**: &quot;1&quot;
    - **Понятное имя**: iPhone симулятора

    ![Добавление программы](whats-new-in-aspnet-mvc-4/_static/image59.png "Добавление программы")

    *Добавьте программу, чтобы перейти с*
5. Нажмите кнопку **ОК** и закрыть все диалоговые окна.
6. Теперь имеется возможность запустить веб-приложений в симуляторе iPhone из Visual Studio 2012.

    ![Просмотр с помощью iPhone симулятор](whats-new-in-aspnet-mvc-4/_static/image60.png "просмотреть с помощью iPhone симулятора")

    *Просмотр с помощью iPhone симулятора*

<a id="AppendixD"></a>

<a id="Appendix_D_Publishing_an_ASPNET_MVC_4_Application_using_Web_Deploy"></a>
## <a name="appendix-d-publishing-an-aspnet-mvc-4-application-using-web-deploy"></a>Приложение г. публикация приложения ASP.NET MVC 4 с помощью веб-развертывания

В этом приложении будет показано, как создать новый веб-сайт на портале управления Windows Azure и публикация приложения, получить, выполнив в лаборатории преимуществами средство публикации веб-развертывания, предоставленного Windows Azure.

<a id="ApxDTask1"></a>

<a id="Task_1_-_Creating_a_New_Web_Site_from_the_Windows_Azure_Portal"></a>
#### <a name="task-1---creating-a-new-web-site-from-the-windows-azure-portal"></a>Задача 1. Создание нового веб-узла с Windows Azure Portal

1. Последовательно выберите пункты [портала управления Windows Azure](https://manage.windowsazure.com/) и войдите с использованием учетных данных Майкрософт, связанную с вашей подпиской.

    > [!NOTE]
    > С помощью Windows Azure можно бесплатно размещения 10 веб-сайтов ASP.NET и затем масштабирование по мере увеличения трафика. Вы можете зарегистрироваться [здесь](http://aka.ms/aspnet-hol-azure).

    ![Войдите на портал Windows Azure](whats-new-in-aspnet-mvc-4/_static/image61.png "входа на портал Windows Azure")

    *Выполните вход на портале управления Windows Azure*
2. Нажмите кнопку **New** на панели команд.

    ![Создание нового веб-сайта](whats-new-in-aspnet-mvc-4/_static/image62.png "создания нового веб-сайта")

    *Создание нового веб-сайта*
3. Нажмите кнопку **вычислений** | **веб-сайт**. Выберите **быстрое создание** параметр. Укажите URL-адрес доступен для нового веб-сайта и нажмите кнопку **Создание веб-сайта**.

    > [!NOTE]
    > Веб-приложение, работающее в облаке, вы можете управлять размещается веб-сайта Windows Azure. Параметр быстрого создания позволяет развернуть завершенное веб-приложение для Windows Azure веб-сайта из вне портала. Он не включает действия по настройке базы данных.

    ![Создание нового веб-сайта с помощью быстрого создания](whats-new-in-aspnet-mvc-4/_static/image63.png "создания нового веб-сайта с помощью быстрого создания")

    *Создание нового веб-сайта с помощью быстрого создания*
4. Подождите, пока новый **веб-сайт** создается.
5. После создания веб-сайта по ссылке **URL-адрес** столбца. Проверьте, что новый веб-сайт работает.

    ![Просмотр новых веб-сайт](whats-new-in-aspnet-mvc-4/_static/image64.png "просмотра на новый веб-сайт")

    *Просмотр новых веб-сайт*

    ![Веб-сайта под управлением](whats-new-in-aspnet-mvc-4/_static/image65.png "веб-сайта под управлением")

    *Запуск веб-сайта*
6. Вернитесь на портал и щелкните имя веб-сайта в разделе **имя** столбец для отображения страницы управления.

    ![Открытие страницы управления веб-сайт](whats-new-in-aspnet-mvc-4/_static/image66.png "Открытие страниц управления веб-сайта")

    *Открытие страницы управления веб-сайта*
7. В **панели мониторинга** в разделе **беглого** щелкните **загрузить профиль публикации** ссылку.

    > [!NOTE]
    > *Профиль публикации* содержит все сведения, необходимые для публикации веб-приложения на веб-сайте Windows Azure для каждого разрешенного метода публикации. Профиль публикации содержит URL-адреса, учетные данные пользователя и строк базы данных, необходимых для подключения и проверки подлинности с каждой из конечных точек, для которых включен метода публикации. **Microsoft WebMatrix 2**, **Microsoft Visual Studio Express для Web** и **Microsoft Visual Studio 2012** поддерживают чтение профилей публикации для автоматизации настройки этих программ для Публикация веб-приложений на веб-сайтов Windows Azure.

    ![Профиль публикации веб-сайт загрузки](whats-new-in-aspnet-mvc-4/_static/image67.png "профиль публикации веб-сайта загрузки")

    *Профиль публикации веб-сайта загрузки*
8. Загрузите файл профиля публикации в известном расположении. Далее в этом упражнении вы увидите как использовать этот файл для публикации веб-приложения для веб-сайтов, Windows Azure из Visual Studio.

    ![Сохранить файл профиля публикации](whats-new-in-aspnet-mvc-4/_static/image68.png "Сохранение профиля публикации")

    *Сохранить файл профиля публикации*

<a id="ApxDTask2"></a>

<a id="Task_2_-_Configuring_the_Database_Server"></a>
#### <a name="task-2---configuring-the-database-server"></a>Задача 2 - Настройка сервера базы данных

Если приложение использует SQL Server базы данных, необходимо будет создать сервер базы данных SQL. Если вы хотите развернуть простое приложение, которое не использует SQL Server может пропустить эту задачу.

1. Сервер базы данных SQL необходимо для хранения базы данных приложения. Можно просматривать серверы базы данных SQL из подписки на портале управления Windows Azure в **баз данных Sql** | **серверы** | **сервера Панель мониторинга**. Если у вас на сервер, созданный, можно создать ее, используя **добавить** кнопки на панели команд. Обратите внимание **имя сервера и URL-адрес, имя входа администратора и пароль**, как будет использовать их в следующие задачи. Не следует создавать базу данных, как он будет создан в более поздней стадии.

    ![Панель мониторинга базы данных SQL Server](whats-new-in-aspnet-mvc-4/_static/image69.png "панель мониторинга базы данных SQL Server")

    *Панель мониторинга базы данных SQL Server*
2. В следующей задаче требуется проверить подключение к базе данных из Visual Studio, по этой причине необходимо включить локальный IP-адреса в список серверов **разрешенные IP-адреса**. Чтобы сделать это, нажмите кнопку **Настройка**, выберите IP-адрес из **текущий IP-адрес клиента** и вставьте его на **начальный IP-адрес** и **конечный IP-адрес** текстовые поля и нажмите кнопку ![add-client-ip-address-ok-button](whats-new-in-aspnet-mvc-4/_static/image70.png) кнопки.

    ![Добавление IP-адрес клиента](whats-new-in-aspnet-mvc-4/_static/image71.png)

    *Добавление IP-адрес клиента*
3. Один раз **IP-адрес клиента** добавляется разрешенных IP-адресов выберите на **Сохранить** для подтверждения изменения.

    ![Подтверждение изменений](whats-new-in-aspnet-mvc-4/_static/image72.png)

    *Подтверждение изменений*

<a id="ApxDTask3"></a>

<a id="Task_3_-_Publishing_an_ASPNET_MVC_4_Application_using_Web_Deploy"></a>
#### <a name="task-3---publishing-an-aspnet-mvc-4-application-using-web-deploy"></a>Задача 3. публикация приложения ASP.NET MVC 4 с помощью веб-развертывания

1. Вернитесь в решении ASP.NET MVC 4. В **обозревателе решений**, щелкните правой кнопкой мыши проект веб-сайта и выберите **публикации**.

    ![Публикация приложения](whats-new-in-aspnet-mvc-4/_static/image73.png "публикация приложения")

    *Публикация веб-сайта*
2. Импортируйте профиль публикации, сохраненный в первой задаче.

    ![Импорт профиля публикации](whats-new-in-aspnet-mvc-4/_static/image74.png "Импорт профиля публикации")

    *Импорт профиля публикации*
3. Нажмите кнопку **Проверка подключения**. После завершения проверки нажмите кнопку **Далее**.

    > [!NOTE]
    > Проверка завершена, как только вы увидите зеленый флажок рядом с "Проверить подключение".

    ![Проверка подключения](whats-new-in-aspnet-mvc-4/_static/image75.png "Проверка подключения")

    *Проверка подключения*
4. В **параметры** в разделе **баз данных** статьи, нажмите кнопку рядом с текстового поля для подключения к базе данных (т. е. **DefaultConnection**).

    ![Конфигурация веб-развертывания](whats-new-in-aspnet-mvc-4/_static/image76.png "конфигурация веб-развертывания")

    *Конфигурация веб-развертывания*
5. Настройте подключение к базе данных следующим образом.

    - В **имя сервера** введите ваш URL-адрес сервера базы данных SQL с помощью *tcp:* префикс.
    - В **имя пользователя** введите имя входа администратора сервера.
    - В **пароль** введите пароль входа администратора сервера.
    - Введите имя новой базы данных, например: *MVC4SampleDB*.

    ![Настройка строки подключения назначения](whats-new-in-aspnet-mvc-4/_static/image77.png "Настройка целевой строки подключения")

    *Настройка целевой строки подключения*
6. Затем нажмите кнопку **ОК**. Когда появится запрос на создание базы данных щелкните **Да**.

    ![Создание базы данных](whats-new-in-aspnet-mvc-4/_static/image78.png "Создание строки базы данных")

    *Создание базы данных*
7. Строка подключения, который будет использоваться для подключения к базе данных SQL в Windows Azure отображается внутри текстового поля по умолчанию соединения. Затем нажмите кнопку **Далее**.

    ![Строка подключения, указывающий базу данных SQL](whats-new-in-aspnet-mvc-4/_static/image79.png "строку соединения, указывающий базу данных SQL")

    *Строка подключения, указывающий базу данных SQL*
8. В **предварительного просмотра** щелкните **публикации**.

    ![Публикация веб-приложения](whats-new-in-aspnet-mvc-4/_static/image80.png "публикации веб-приложения")

    *Публикация веб-приложения*
9. После завершения процесса публикации в браузере по умолчанию откроется опубликованного веб-узла.

    ![Публикации приложения в Windows Azure](whats-new-in-aspnet-mvc-4/_static/image81.png "публикации приложения в Windows Azure")

    *Приложения, опубликованные в Windows Azure*
