---
uid: mvc/overview/older-versions/mvc-music-store/mvc-music-store-part-3
title: 'Часть 3: Представления и ViewModels | Документы Microsoft'
author: jongalloway
description: Этот учебник ряд подробно описываются шаги, необходимые для построения образца приложения ASP.NET MVC Music Store. Часть 3 описывает представления и ViewModels.
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/21/2011
ms.topic: article
ms.assetid: 94297aa0-1f2d-4d72-bbcb-63f64653e0c0
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions/mvc-music-store/mvc-music-store-part-3
msc.type: authoredcontent
ms.openlocfilehash: 497c2898db2e03b0650982c3ad1e6b5ac5ca639d
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="part-3-views-and-viewmodels"></a>Часть 3: Представления и ViewModels
====================
по [Джон Гэллоуэй](https://github.com/jongalloway)

> MVC Music Store является учебное приложение, которое вводятся и описываются пошаговые способы использования Visual Studio и ASP.NET MVC для веб-разработки.  
>   
> MVC Music Store показана реализация хранилища упрощенных образец продает велосипеды через Интернет альбомы, которое реализует Администрирование сайта основные, вход пользователей и функциональные возможности корзины покупок.  
>   
> Этот учебник ряд подробно описываются шаги, необходимые для построения образца приложения ASP.NET MVC Music Store. Часть 3 описывает представления и ViewModels.


Пока мы просто возврат строк из действия контроллера. Это хорошо способ получить представление о работе контроллеров, но это не будет способа построения реальных веб-приложения. Мы собираемся требуется более эффективный способ создания HTML-кода обратно в браузерах, посетите наш сайт — один, где можно использовать файлы шаблонов для упрощения настройки HTML-содержимого, отправка обратно. Именно это сделать представления.

## <a name="adding-a-view-template"></a>Добавление шаблона представления

Чтобы использовать шаблон представления, мы изменить индекс HomeController метод для возврата ActionResult и возвращать View(), например, ниже:

[!code-csharp[Main](mvc-music-store-part-3/samples/sample1.cs)]

Выше изменение означает, что вместо возвратил строку, вместо этого мы хотим использовать «Представление» для получения результата обратно.

Теперь мы добавим соответствующий шаблон представления в свой проект. Для этого мы будем поместите курсор в методе действия, индекс, текст затем щелкните правой кнопкой мыши и выберите «Добавить представление». Откроется диалоговое окно добавления представления:

![](mvc-music-store-part-3/_static/image1.jpg) ![](mvc-music-store-part-3/_static/image1.png)

Диалоговое окно «Добавление представления» позволяет быстро и легко создавать файлы шаблона представления. По умолчанию «Добавление представления» диалогового окна предварительно определяет имя шаблона представления для создания, чтобы он соответствовал метод действия, который будет его использовать. Так как мы использовали контекстное меню «Добавление представления» в методе действия Index() нашей HomeController, диалоговое окно «Добавление представления» выше совпадает с «Индекс» подставлен по умолчанию имя представления. Не нужно изменять любые параметры в этом диалоговом окне, нажмите кнопку Добавить.

После нажатия кнопки "Добавить", Visual Web Developer создаст новый Index.cshtml Просмотр шаблона нам в каталоге \Views\Home папка создается, если еще не существует.

![](mvc-music-store-part-3/_static/image2.png)

Имя и расположение файла «Index.cshtml» важен и проходит соглашения об именовании ASP.NET MVC по умолчанию. Имя каталога, \Views\Home, соответствует контроллеру - называется HomeController. Имя шаблона просмотр индекса, соответствует метод действия контроллера, который будет применяться для отображения представления.

ASP.NET MVC позволяет избежать необходимости явно указывать имя или расположение шаблона представления, если мы используем это соглашение об именовании для возврата представления. Он будет по умолчанию отображать \Views\Home\Index.cshtml Просмотр шаблона при написании кода ниже в нашем HomeController:

[!code-csharp[Main](mvc-music-store-part-3/samples/sample2.cs)]

Visual Web Developer создается и открывается шаблон представления «Index.cshtml», после мы нажата кнопка «Добавить» в диалоговом окне «Добавление представления». Содержимое Index.cshtml приведены ниже.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample3.cshtml)]

Это представление используется синтаксис Razor, который является более лаконичны, чем веб-форм обработчик представлений, используемый в предыдущих версиях ASP.NET MVC и веб-форм ASP.NET. Обработчик представлений Web Forms по-прежнему доступен в ASP.NET MVC 3, но многим разработчикам кажутся представлений Razor действительно хорошо подходит разработки ASP.NET MVC.

Первые три строки установки с помощью ViewBag.Title заголовка страницы. Мы рассмотрим как это работает более подробно скоро, но сначала давайте обновления текст заголовка текста и просмотрите страницу. Обновление &lt;h2&gt; тег, чтобы сказать «это — домашняя страница», как показано ниже.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample4.cshtml)]

Запуск приложения показано, что наш новый текст отображается на домашней странице.

![](mvc-music-store-part-3/_static/image3.png)

## <a name="using-a-layout-for-common-site-elements"></a>С использованием макета для общих элементов сайта

У большинства веб-сайтов содержимого, которое совместно используется много страниц: навигации, нижние колонтитулы, изображения логотипа, ссылки на таблицы стилей, и т. д. Представлений Razor делает это облегчает управление с помощью страница с именем \_Layout.cshtml, который автоматически был создан для нас расположен в папке/представления/Shared.

![](mvc-music-store-part-3/_static/image4.png)

Дважды щелкните эту папку для просмотра содержимого, в которой будут показаны ниже.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample5.cshtml)]

Будет отображаться содержимое из наших отдельных представлений @RenderBodyкоманда () и любые типичного содержимого, мы хотим находиться за пределами, добавляемыми \_Layout.cshtml разметки. Будем нашей MVC Music Store могут иметь общие заголовок со ссылками нашей область домашней страницы и хранилища на всех страницах на сайте, и, будет добавлен в шаблон непосредственно над ней @RenderBodyинструкции ().

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample6.cshtml)]

## <a name="updating-the-stylesheet"></a>Обновление таблицы стилей

Шаблон пустого проекта содержит очень упрощенный CSS-файл, включающий только стили, используемые для отображения сообщений проверки. Наш конструктор обеспечивает некоторые дополнительные CSS и изображения для определяет внешний вид и поведение для наших сайта, поэтому мы добавим их сейчас.

Обновленные CSS-файл и изображения включены в каталоге содержимого MvcMusicStore Assets.zip, находящейся на [MVC Music Store](https://github.com/evilDave/MVC-Music-Store). Мы выберите оба параметра в проводнике Windows и разместить их в папку содержимого наши решения в Visual Web Developer, как показано ниже:

![](mvc-music-store-part-3/_static/image5.png)

Вам будет предложено подтвердить, следует ли перезаписать существующий файл Site.css. Нажмите кнопку Да.

![](mvc-music-store-part-3/_static/image6.png)

Папки содержимого приложения теперь будет выглядеть следующим образом:

![](mvc-music-store-part-3/_static/image7.png)

Теперь давайте запустить приложение и увидеть, как изменения будут отображаться на домашней странице.

![](mvc-music-store-part-3/_static/image8.png)

- Рассмотрим, что изменено: метод действия индекса HomeController найден и отображаются шаблона \Views\Home\Index.cshtmlView, несмотря на то, что наш код называется «возвращаемого View()», поскольку нашей Просмотр шаблона, а затем стандартного соглашения об именовании.
- Домашняя страница отображает простой приветственное сообщение, которое определено в шаблоне \Views\Home\Index.cshtml представления.
- Использование домашней странице нашей \_Layout.cshtml шаблона, и поэтому приветственное сообщение, содержащихся в макет узла стандартный HTML.

## <a name="using-a-model-to-pass-information-to-our-view"></a>С помощью модели для передачи данных в нашем представление

Просмотр шаблона, который просто отображает жестко закодировано HTML не будет делать очень интересно веб-сайта. Для создания динамического веб-узла, мы вместо этого потребуется передачи данных из наших действий контроллера наших шаблонов представлений.

В шаблон Model-View-Controller термин модели относится к объектов, которые представляют данные в приложении. Часто объекты модели соответствуют таблицам в базе данных, но это не обязательно.

Методы действий контроллера, которые возвращают ActionResult можно передать объект модели представления. Это позволяет контроллеру четко пакета все данные, необходимые для создания ответа, а затем передать эти сведения для шаблона представления, используемый для создания соответствующих HTML-ответа. Это проще всего понять путем его просмотр в действии, так что давайте начнем.

Сначала мы создадим некоторые классы модели для представления жанров и альбомам в нашем хранилище. Давайте начнем с создания класса жанра. Щелкните правой кнопкой мыши папку «Модели» в проекте, выберите параметр «Добавить класс» и присвойте файлу имя «Genre.cs».

![](mvc-music-store-part-3/_static/image2.jpg)

![](mvc-music-store-part-3/_static/image9.png)

Затем добавьте строку открытого свойства имени класса, который был создан:

[!code-csharp[Main](mvc-music-store-part-3/samples/sample7.cs)]

*Примечание: В случае, вам интересно {get; задать;} нотации делает использование C# автоматически реализуемые свойства функции. Это дает преимущества свойства без необходимости нами для объявления резервным полем.*

Затем выполните эти шаги, чтобы создать класс альбома (с именем Album.cs), имеет заголовок и жанр свойство.

[!code-csharp[Main](mvc-music-store-part-3/samples/sample8.cs)]

Теперь можно изменять StoreController для использования представлений, отображающих динамические сведения из нашей модели. При - прямо сейчас - для демонстрационных целей мы назвали нашей альбомы, на основе идентификатора запроса, мы Показывать эти сведения, как в представлении ниже.

![](mvc-music-store-part-3/_static/image10.png)

Мы начнем, изменив действие сведения о хранилище для отображения сведений для одного альбома. Добавьте оператор «using» в начало **StoreControllers** класса для включения пространства имен MvcMusicStore.Models, поэтому мы не нужно вводить MvcMusicStore.Models.Album мы хотим использовать класс альбома. Должен появиться в разделе «директивы using» этого класса как показано ниже.

[!code-csharp[Main](mvc-music-store-part-3/samples/sample9.cs)]

Далее будет обновлена на действие Details контроллер, чтобы он возвращал ActionResult, а не строкой, как это делалось с помощью метода HomeController индекса.

[!code-csharp[Main](mvc-music-store-part-3/samples/sample10.cs)]

Теперь можно изменять логику для возвращения объекта альбом в представление. Далее в этом учебнике мы будем извлекать данные из базы данных, но в настоящий момент мы будем использовать «пустой данных», чтобы приступить к работе.

[!code-csharp[Main](mvc-music-store-part-3/samples/sample11.cs)]

*Примечание: Если вы знакомы с C#, вы могут предположить, что с помощью var означает, что наши переменной альбом позднего связывания. Неправильный — вывод типа на основе на то, что мы назначения переменной, чтобы определить, что этом альбоме имеет тип альбом и компиляция альбом локальной переменной как тип альбома, поэтому мы получаем проверки во время компиляции и в редакторе кода Visual Studio использует компилятор C# Поддержка.*

Теперь создадим представление шаблона, который использует нашей альбом для создания HTML-ответа. Перед этим необходимо построить проект, чтобы добавить представление диалогового окна известно о наших только что созданный класс альбома. Можно построить проект, выбрав Debug⇨Build MvcMusicStore элемента меню (дополнение, можно использовать сочетание клавиш Ctrl-Shift-B для построения проекта).

![](mvc-music-store-part-3/_static/image11.png)

Мы настроили наши вспомогательные классы, мы готовы выполнить сборку шаблона наши представления. Щелкните правой кнопкой мыши внутри метода сведения и выберите пункт «Добавить представление...» в контекстном меню.

![](mvc-music-store-part-3/_static/image12.png)

Мы собираемся создавать новый шаблон представления, как и раньше с HomeController. Поскольку мы создаем из StoreController он будет по умолчанию создаваться в файле \Views\Store\Index.cshtml.

В отличие от ранее, мы собираемся представление флажок «Создать строго типизированной». Затем мы собираемся выберите нами класса «Альбом» в «Класс представления данных —» drop-downlist. Это приведет к диалогового окна «Добавление представления», чтобы создать шаблон представления, который ожидает альбом объекта передается его для использования.

![](mvc-music-store-part-3/_static/image13.png)

При нажатии кнопки «Добавить» наши \Views\Store\Details.cshtml Просмотр шаблона создается, содержащий следующий код.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample12.cshtml)]

Обратите внимание, первую строку, которая указывает, что данное представление является строго типизированный класс нашей альбома. Обработчик представлений Razor понимает, что он передан объект альбома, чтобы мы могли легко получить доступ к свойствам модели и даже воспользоваться преимуществами технологии IntelliSense в редакторе Visual Web Developer.

Обновление &lt;h2&gt; тег, отображается свойство название альбома, изменив эту строку, чтобы выглядеть следующим образом.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample13.cshtml)]

Обратите внимание, что IntelliSense запускается при вводе в течение периода времени @Model ключевое слово, показывающий свойства и методы, которые поддерживает класс альбома.

Теперь давайте повторного запуска проекта и посетите URL-адрес хранилища, сведения и 5. Мы рассмотрим подробные сведения о альбом как ниже.

![](mvc-music-store-part-3/_static/image14.png)

Теперь мы выполним подобное обновление для метода действия Обзор хранилища. Обновить метод, чтобы он возвращал ActionResult и измените логику метода, он создает новый объект жанр и возвращает его в представление.

[!code-csharp[Main](mvc-music-store-part-3/samples/sample14.cs)]

Щелкните правой кнопкой мыши в методе обзора и выберите пункт «Добавить представление...» в контекстном меню, затем добавьте представление, которое является строго типизированной добавить строго типизированный класс жанра.

![](mvc-music-store-part-3/_static/image15.png)

Обновление &lt;h2&gt; элемент в представлении кода (в /Views/Store/Browse.cshtml) для отображения сведений жанра.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample15.cshtml)]

Теперь давайте повторного запуска проекта и найдите/Store/обзора? Жанр = Disco URL-адрес. Мы рассмотрим, как ниже отображается страница «Обзор».

![](mvc-music-store-part-3/_static/image16.png)

Наконец, создадим немного более сложными, обновление **хранения индекса** метода действия и представления для отображения списка всех жанров в нашем хранилище. Сделаем с помощью список жанров как объект нашей модели, а не только одного жанра.

[!code-csharp[Main](mvc-music-store-part-3/samples/sample16.cs)]

Щелкните правой кнопкой мыши в методе действия индекс хранилища и выберите Добавить представление, как и прежде, выделите как класс модели и нажмите кнопку Добавить.

![](mvc-music-store-part-3/_static/image17.png)

Сначала мы изменим @model объявления, чтобы указать, что представление будет ожидать жанр несколько объектов вместо того, чтобы только один. Изменение в первой строке /Store/Index.cshtml следующим образом:

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample17.cshtml)]

Это значение определяет представлений Razor, он будет работать объекта модели, который может содержать несколько объектов жанра. Мы используем IEnumerable&lt;жанр&gt; вместо списка&lt;жанр&gt; так, как это более общий, позволяющего изменить тип нашей модели в более поздней версии на любой тип объекта, который поддерживает интерфейс IEnumerable.

Далее предстоит перебор жанр объекты в модели, как показано в приведенном ниже примере кода завершенные.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample18.cshtml)]

Обратите внимание, что у нас есть полную поддержку IntelliSense вводе данного кода, так что если мы введем «@Model.» мы видим, что все методы и свойства, поддерживаемые IEnumerable типа жанра.

![](mvc-music-store-part-3/_static/image18.png)

В нашем «цикл» Visual Web Developer знает, каждый элемент имеет тип жанра, поэтому мы видим IntelliSence для каждого типа жанра.

![](mvc-music-store-part-3/_static/image19.png)

Затем функции формирования шаблонов проверить объект жанр и определить, что каждый будет иметь свойство Name, поэтому циклически и записывает их. Он также создает редактирования, подробные сведения и удаления ссылок для каждого отдельного элемента. Мы будем пользоваться, далее в нашем директор магазина, но сейчас мы предлагаем возможность простого списка.

Когда мы запустите приложение и перейдите в "/ store", мы видим, отображается список жанров и count.

![](mvc-music-store-part-3/_static/image20.png)

## <a name="adding-links-between-pages"></a>Добавление ссылки между страницами

Наш "/ store" URL-адрес, в настоящее время список жанров список имен жанр просто в виде обычного текста. Изменим это, что вместо обычного текста вместо дает ссылку имена жанра, чтобы соответствующие хранилища или обзора URL-адрес, щелкнув жанр музыки, как произойдет переход «Disco» / Store/обзора? жанр = Disco URL-адрес. Следует обновить шаблон представления нашей \Views\Store\Index.cshtml выходные данные этих ссылок, с помощью кода как ниже **(не вводите в — нам улучшить на нем)**:

[!code-html[Main](mvc-music-store-part-3/samples/sample19.html)]

Это работает, но это может привести к более поздней версии проблемы, так как он основывается на строку. Для экземпляра Если требуется переименовать контроллер, необходимо поиск в наш код ищет ссылки, должны быть обновлены.

Альтернативный подход, который может использоваться — воспользоваться преимуществом метода вспомогательный метод HTML. ASP.NET MVC включает методы вспомогательный метод HTML, которые доступны из наш код шаблона представления для выполнения различных задач, так же, как это. Вспомогательный метод Html.ActionLink() является особенно удобно и упрощает создание HTML &lt;&gt; ссылки, а также отвечает за нежелательные сведения, такие как всегда убеждаться в том пути URL-адрес правильно URL-кодированием.

Html.ActionLink() имеет несколько перегрузок другой, чтобы обеспечить возможность указания столько информации, сколько необходимо для ссылок. В самом простом случае необходимо указать только текст ссылки и метод действия для перехода при щелчке гиперссылки на стороне клиента. Например мы можно связать с «/ Store /» Index() метода на странице сведения о хранилище с текстом ссылки «Перейти к хранилища индекса» с помощью следующего вызова.

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample20.cshtml)]

*Примечание: В этом случае нам не нужно указать имя контроллера, так как мы просто ссылка другого действия в одном контроллере, который готовится к просмотру текущего представления.*

Наш ссылки на странице «Обзор» необходимо передать параметр, однако, мы будем использовать другую перегрузку метода Html.ActionLink, который принимает три параметра:

- 1. Текст ссылки, который будет отображаться название жанра
- 2. Имя действия контроллера (Обзор)
- 3. Значения параметров маршрута, указав имя (жанр) и значение (жанр имя)

Усовершенствование, что все вместе, Вот каким образом, мы записываем эти связи в представление индекс хранилища:

[!code-cshtml[Main](mvc-music-store-part-3/samples/sample21.cshtml)]

Теперь если мы еще раз запустить нашего проекта и получить доступ к URL-адрес /Store/ будет рассмотрено список жанров. Каждом жанре представляет собой гиперссылку — при нажатии нам потребуется для наших/Store/обзора? жанр =*[жанр]* URL-адрес.

![](mvc-music-store-part-3/_static/image3.jpg)

HTML-код для списка жанр выглядит следующим образом:

[!code-html[Main](mvc-music-store-part-3/samples/sample22.html)]


> [!div class="step-by-step"]
> [Назад](mvc-music-store-part-2.md)
> [Вперед](mvc-music-store-part-4.md)
