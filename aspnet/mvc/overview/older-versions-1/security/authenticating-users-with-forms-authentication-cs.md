---
uid: mvc/overview/older-versions-1/security/authenticating-users-with-forms-authentication-cs
title: "Проверка подлинности пользователей с помощью форм проверки подлинности (C#) | Документы Microsoft"
author: microsoft
description: "Узнайте, как использовать атрибут [Authorize] чтобы защитить паролем определенного страниц в приложении MVC. Вы узнаете, как использовать веб-сайт администрирования слишком..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/27/2009
ms.topic: article
ms.assetid: 239fd3ca-5630-4b8d-bc4b-2f906b1d3504
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/security/authenticating-users-with-forms-authentication-cs
msc.type: authoredcontent
ms.openlocfilehash: 17bcf02e1351587d64b72ee2b40393e0f748f23e
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="authenticating-users-with-forms-authentication-c"></a>Проверка подлинности пользователей с помощью форм (C#)
====================
по [Microsoft](https://github.com/microsoft)

> Узнайте, как использовать атрибут [Authorize] чтобы защитить паролем определенного страниц в приложении MVC. Вы узнаете, как использовать средство администрирования веб-сайта для создания и управления пользователями и ролями. Кроме того, вы узнаете, как для настройки, где хранятся сведения об учетной записи и роли пользователя.


Целью данного учебника является объясняется, как можно использовать формы проверки подлинности пароль защиты представления в приложениях ASP.NET MVC. Вы узнаете, как использовать средство администрирования веб-сайта для создания пользователей и ролей. Вы также узнаете, как предотвратить несанкционированный вызов действия контроллера. Наконец вы узнаете, как настройка, где хранятся имена пользователей и пароли.

#### <a name="using-the-web-site-administration-tool"></a>С помощью средства администрирования веб-сайта

Прежде чем мы выполнять дополнительные действия, следует начнем с создания некоторых пользователей и ролей. Чтобы воспользоваться преимуществами Visual Studio 2008 Web Site Administration Tool — самый простой способ создания новых пользователей и ролей. Это средство можно запустить, выбрав параметр меню **проекта, Конфигурация ASP.NET**. Кроме того, можно запустить средство администрирования веб-сайта, щелкнув значок "(несколько пугающие)" молоток, попадание странах, где отображается в верхней части окна обозревателя решений (см. рис. 1).

**Рис. 1 – Запуск Web Site Administration Tool**

![clip_image002](authenticating-users-with-forms-authentication-cs/_static/image1.jpg)

В Web Site Administration Tool создайте новых пользователей и ролей, выбрав вкладку Безопасность. Нажмите кнопку **создать пользователя** ссылку, чтобы создать нового пользователя с именем Стивен (см. рис. 2). Любой пароль, который должен предоставить пользователю Стивен (например, *секрет*).

**Рис. 2 – Создание нового пользователя**

![clip_image004](authenticating-users-with-forms-authentication-cs/_static/image2.jpg)

Создать новые роли путем включения ролей и определения одной или нескольких ролей. Включить роли, щелкнув **включить роли** ссылку. Создайте роль с именем *Администраторы* , щелкнув **Создание и управление ролями** связи (см. рис. 3).

**Рис. 3 – Создание новой роли**

![clip_image006](authenticating-users-with-forms-authentication-cs/_static/image3.jpg)

Наконец, создайте нового пользователя с именем Sally и связать Sally с роли "Администраторы", щелкнув ссылку Создать пользователя администраторов при создании Sally (см. рис. 4).

**Рис. 4 – Добавление пользователя к роли**

![clip_image008](authenticating-users-with-forms-authentication-cs/_static/image4.jpg)

Когда все сказано и сделано, необходимо иметь два новых пользователей с именем Стивен и света. Также необходимо новую роль с именем администраторов. Sally является членом роли "Администраторы" и не является Стивен.

#### <a name="requiring-authorization"></a>Требующие авторизации

Может потребоваться пользователю проходить проверку подлинности, прежде чем пользователь вызывает действия контроллера, добавив атрибут [Authorize] действие. Можно применить атрибут [Authorize] действию отдельного контроллера или этот атрибут можно применять в класс контроллера целиком.

Например контроллер в список 1 предоставляет действие с именем CompanySecrets(). Поскольку это действие является помеченной атрибутом [Authorize], это действие не будет вызываться, если проверка подлинности пользователя.

**Перечисление Controllers\HomeController.cs. 1.**

[!code-csharp[Main](authenticating-users-with-forms-authentication-cs/samples/sample1.cs)]

Если действие CompanySecrets(), введя URL-адрес/Home/CompanySecrets в адресной строке браузера и вы не прошедшего проверку подлинности пользователя, то вы будете перенаправлены в представление входа автоматически (см. рис. 5).

**Рис. 5 – Просмотр имени входа**

![clip_image010](authenticating-users-with-forms-authentication-cs/_static/image5.jpg)

Можно использовать представление имени входа для ввода имени пользователя и пароля. Если вы не зарегистрированы в качестве пользователя, то можно щелкнуть **зарегистрировать** ссылку для перехода к регистр представления (см. рис. 6). Представление регистра можно использовать для создания учетной записи пользователя.

**Рис. 6 – представление регистра**

![clip_image012](authenticating-users-with-forms-authentication-cs/_static/image6.jpg)

После успешного входа, вы увидите CompanySecrets представления (см. рис. 7). По умолчанию будет продолжать войти до закрытия окна браузера.

**Представление CompanySecrets рис. 7.**

![clip_image014](authenticating-users-with-forms-authentication-cs/_static/image7.jpg)

#### <a name="authorizing-by-user-name-or-user-role"></a>Авторизация по имени пользователя или роли пользователя

Атрибут [Authorize] можно использовать для ограничения доступа к действия контроллера, к определенному набору пользователей или определенного набора ролей пользователей. Например измененный в списке 2 контроллера Home содержит два новых действий с именем StephenSecrets() и AdministratorSecrets().

**Перечисление Controllers\HomeController.cs. 2.**

[!code-csharp[Main](authenticating-users-with-forms-authentication-cs/samples/sample2.cs)]

Только пользователь с именем пользователя Стивен можно вызвать действие StephenSecrets(). Все другие пользователи получить перенаправлены в представление входа в систему. Свойства пользователей можно указать разделенный запятыми список имен учетных записей пользователей.

Только члены роли "Администраторы" можно вызвать действие AdministratorSecrets(). Например поскольку Sally является членом группы «Администраторы», она можно вызвать действие AdministratorSecrets(). Все другие пользователи получить перенаправлены в представление входа в систему. Свойства роли можно указать разделенный запятыми список имен ролей.

#### <a name="configuring-authentication"></a>Настройка проверки подлинности

На этом этапе может возникнуть вопрос, где хранятся сведения об учетной записи и роли пользователя. По умолчанию данные хранятся в базе данных SQL Express (RANU) именованного ASPNETDB.mdf находится в приложении MVC-приложении\_папки данных. Эта база данных создается платформой ASP.NET автоматически при запуске с помощью членства.

Чтобы просмотреть ASPNETDB.mdf базы данных в окне обозревателя решений, сначала необходимо выбрать пункт меню проекта, Показать все файлы.

С помощью базы данных SQL Express по умолчанию подходит при разработке приложения. Скорее всего тем не менее, вы не хотите использовать ASPNETDB.mdf базу данных по умолчанию в рабочем приложении. В этом случае можно изменить, где хранятся данные учетной записи пользователя, выполнив следующие два действия:

1. Добавление объектов базы данных служб приложения в производственной базе данных — изменить строку подключения вашего приложения для указания рабочей базы данных

Первым шагом является добавление все необходимые объекты базы данных (таблицы и хранимые процедуры) в производственной базе данных. Чтобы добавить эти объекты в новой базе данных проще всего воспользоваться преимуществами мастер установки SQL Server ASP.NET (см. рис. 8). Вы можете запустить это средство, открыв Командная строка Visual Studio 2008 из программной группы Microsoft Visual Studio 2008 и выполнив следующую команду из командной строки:

ASPNET\_regsql

**Рис. 8 — ASP.NET мастер установки SQL Server**

![clip_image016](authenticating-users-with-forms-authentication-cs/_static/image8.jpg)

Мастер установки SQL Server ASP.NET позволяет выбрать базы данных SQL Server в сети и установить все объекты базы данных, необходимые для служб приложений ASP.NET. Сервер базы данных не должен быть расположен на локальном компьютере.

> [!NOTE] 
> 
> Если вы не хотите использовать мастер установки SQL Server ASP.NET, можно найти скрипты SQL для добавления объектов базы данных приложения службы в следующей папке:
> 
> > C:\Windows\Microsoft.NET\Framework\v2.0.50727


После создания необходимые объекты базы данных, необходимо внести изменения подключения к базе данных, используемым в приложении MVC. Измените строку соединения ApplicationServices в файл веб-конфигурации (web.config), чтобы он указывал на производственную базу данных. Например измененный в списке 3 указывает это подключение к базе данных с именем MyProductionDB (исходная строка подключения ApplicationServices закомментирован).

**Листинг 3 – Web.config**

[!code-xml[Main](authenticating-users-with-forms-authentication-cs/samples/sample3.xml)]

#### <a name="configuring-database-permissions"></a>Настройка разрешений базы данных

При использовании встроенной безопасности для подключения к базе данных будет необходимо добавить правильные учетную запись Windows как имя входа в базу данных. Правильная учетная запись зависит ли использовании ASP.NET Development Server или IIS как веб-сервера. Учетная запись пользователя также зависит от операционной системы.

При использовании ASP.NET Development Server (по умолчанию веб-сервер используется в Visual Studio) приложение выполняется в контексте учетной записи пользователя Windows. В этом случае необходимо добавить учетная запись пользователя Windows в качестве входа в базу данных сервера.

Кроме того при использовании служб IIS необходимо добавить учетную запись NT AUTHORITY/СЕТЕВОЙ службы или учетной записи ASPNET в качестве входа в базу данных сервера. Если используется Windows XP, затем добавьте учетную запись ASPNET как имя входа базы данных. При использовании более новой операционной системы, таких как Windows Vista или Windows Server 2008, затем добавьте учетную запись NT AUTHORITY/СЕТЕВОЙ службы, как имя входа базы данных.

Можно добавить новую учетную запись в базу данных с помощью Microsoft SQL Server Management Studio (см. рис. 9).

**Рис. 9 – Создание нового имени входа Microsoft SQL Server**

![clip_image018](authenticating-users-with-forms-authentication-cs/_static/image9.jpg)

После создания необходимых входа, необходимо сопоставить имя входа пользователя базы данных с подходящей базы данных роли. Дважды щелкните имя входа и перейдите на вкладку сопоставления пользователей. Выберите одну или несколько ролей базы данных приложения службы. Например, для проверки подлинности пользователей, необходимо включить aspnet\_членства\_BasicAccess роли базы данных. Для создания новых пользователей, необходимо включить aspnet\_членства\_FullAccess роли базы данных (см. рис. 10).

**Рис. 10 – Добавление ролей базы данных служб приложений**

![clip_image020](authenticating-users-with-forms-authentication-cs/_static/image10.jpg)

#### <a name="summary"></a>Сводка

В этом учебнике вы узнали, как использовать проверку подлинности форм, при создании приложения ASP.NET MVC. Во-первых вы узнали, как для создания новых пользователей и роли, используя преимущества Web Site Administration Tool. Далее вы узнали, как использовать атрибут [Authorize], чтобы предотвратить несанкционированный вызов действия контроллера. Наконец вы узнали, как настроить приложение MVC, для хранения пользователя и сведения о ролях в производственной базы данных.

>[!div class="step-by-step"]
[Вперед](authenticating-users-with-windows-authentication-cs.md)
