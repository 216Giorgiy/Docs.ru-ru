---
uid: mvc/overview/older-versions-1/controllers-and-routing/improving-performance-with-output-caching-cs
title: Повышение производительности с помощью вывода кэширования (C#) | Документы Microsoft
author: microsoft
description: В этом учебнике вы узнаете, как можно существенно повысить производительность веб-приложений ASP.NET MVC, используя преимущества кэширования вывода. Вы...
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/27/2009
ms.topic: article
ms.assetid: 521c9117-81cd-4d8d-9d96-0256dc7bf50f
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/controllers-and-routing/improving-performance-with-output-caching-cs
msc.type: authoredcontent
ms.openlocfilehash: 8958caa5a0ccad669ca861bed261102625be5cb6
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="improving-performance-with-output-caching-c"></a>Повышение производительности с выводом (C#)
====================
по [Microsoft](https://github.com/microsoft)

> В этом учебнике вы узнаете, как можно существенно повысить производительность веб-приложений ASP.NET MVC, используя преимущества кэширования вывода. Вы узнаете, как для кэширования результата, возвращенного действия контроллера, поэтому это же содержимое создаваться каждый раз, новый пользователь вызывает действие не требуется.


Целью данного учебника является объясняется, каким образом можно существенно повысить производительность приложения ASP.NET MVC, используя преимущества кэша вывода. Кэш вывода позволяет кэшировать содержимое, возвращенных действия контроллера. Таким образом, то же содержимое не должны создаваться каждый время вызова того же действия контроллера.

Допустим, что приложение ASP.NET MVC список записей базы данных в представление с именем индекса. Как правило каждый пользователь вызывает действие контроллера, которое возвращает представление Index время набора записей базы данных необходимо извлечь из базы данных, выполнив запрос к базе данных.

Если, с другой стороны, можно воспользоваться преимуществами кэша вывода можно избежать, выполнив запрос к базе данных каждый раз, любой пользователь вызывает одно и то же действие контроллера. Представление можно получить из кэша, а не создаются заново из действия контроллера. Кэширование позволяет вам избежать выполнения избыточных работать на сервере.

## <a name="enabling-output-caching"></a>Включение кэширования выходных данных

Кэширование выходных данных путем добавления атрибута [OutputCache] действие отдельного контроллера или класс контроллера целиком. Например контроллер в список 1 предоставляет действие с именем Index(). Выходные данные действия Index() кэшируется на 10 секунд.

**Перечисление Controllers\HomeController.cs. 1.**

[!code-csharp[Main](improving-performance-with-output-caching-cs/samples/sample1.cs)]

В бета-версии ASP.NET MVC, кэширование вывода не работает для URL-адрес: [ http://www.MySite.com/ ](http://www.mysite.com/). Вместо этого необходимо ввести URL-адрес: [ http://www.MySite.com/Home/Index ](http://www.mysite.com/Home/Index). 

В список 1 выходные данные действия Index() кэшируется на 10 секунд. При желании можно указать существенно превышает длительность кэширования. Например, если требуется кэшировать вывод действия контроллера за один день затем можно указать длительность кэширования 86400 секунд (60 секунд \* 60 минут \* 24 часа).

Нет никакой гарантии, содержимое будет кэшироваться объема указанного времени. Если ресурсы памяти станет недостаточным, кэш автоматически запускается исключении содержимого.

Контроллер Home в листинге 1 возвращает представление индекса в списке 2. Нет ничего особенного в этом представлении. Представление Index просто отображает текущее время (см. рис. 1).

**Перечисление Views\Home\Index.aspx. 2.**

[!code-aspx[Main](improving-performance-with-output-caching-cs/samples/sample2.aspx)]

**Рис. 1 – представление Cached Index**

![clip_image002](improving-performance-with-output-caching-cs/_static/image1.jpg)

Если вызвать Index() действие несколько раз, введя URL-адрес/Home или индекса в адресной строке браузера и нажатии кнопки Обновить и перезагрузить в браузере, несколько раз, а затем времени, отображаемого в представлении индекса не изменится на 10 секунд. То же время отображается в том случае, так как представление кэшируется.

Важно понимать, что тем же самым представлением кэшируется для всех посетителей приложения. Кто-то вызывает действие Index() получите же кэшированная версия индекс представления. Это означает, что значительно снижает объем работы, необходимо выполнить на веб-сервер для обслуживания индекса представления.

Представление в списке 2 происходит выполнения очень простой. Представление отображает только текущее время. Тем не менее можно было бы так же, как легко кэша представление, которое отображает набора записей базы данных. В этом случае набора записей базы данных не нужно извлечь из базы данных каждый время вызова действия контроллера, который возвращает представление. Кэширование может сократить объем работы, которую должна выполнять веб-сервер и сервер базы данных.

Не используйте страницу &lt;% @ OutputCache %&gt; директив в представлении MVC. Эта директива размываются по из мира веб-форм и не должны использоваться в приложении ASP.NET MVC.

## <a name="where-content-is-cached"></a>Где кэширования содержимого

По умолчанию при использовании атрибута [OutputCache], содержимое кэшируется в трех местах: веб-сервере, любые прокси-серверов и веб-браузер. Можно управлять точно где содержимое кэшируется, изменив свойство расположение атрибута [OutputCache].

Можно задать свойство Location в один из следующих значений:

> · Любой
> 
> · Клиент
> 
> · Подчиненные
> 
> · Сервер
> 
> · Нет
> 
> · ServerAndClient


По умолчанию свойство расположения имеет значение Any. Однако существуют ситуации, в которых может потребоваться кэша только в браузере или только на сервере. Например если сведения, которые можно настраивать отдельно для каждого пользователя, затем не следует кэшировать данные на сервере. При отображении различные сведения различным пользователям следует кэшировать сведения только на стороне клиента.

Например контроллер в списке 3 предоставляет действие с именем GetName(), который возвращает имя текущего пользователя. Гнездо входит на веб-сайт и вызывает действие GetName() действие возвращается строка «Hi гнездо». Если впоследствии Jill входит на веб-сайт и вызывает действие GetName(), то она также будет получить строка «Hi гнездо». Строка кэшируется на веб-сервере для всех пользователей после гнездо изначально вызывает действия контроллера.

**Листинг 3 – Controllers\BadUserController.cs**

[!code-csharp[Main](improving-performance-with-output-caching-cs/samples/sample3.cs)]

Скорее всего контроллер в списке 3 не работает должным образом. Вы не хотите отображать сообщение «Hi гнездо» для Jill.

Никогда не следует кэшировать персонализации содержимого в кэше сервера. Тем не менее можно кэшировать персонализации содержимого в кэше браузера, чтобы повысить производительность. Если пользователь вызывает одно и то же действие контроллера несколько раз кэшировать содержимое в браузере, содержимое можно получить из кэша браузера, а не на сервере.

Измененный контроллера в листинге 4 кэширует выходные данные действия GetName(). Однако содержимое кэшируется только в браузере, а не на сервере. Таким образом, когда несколько пользователей вызова метода GetName(), каждый пользователь получает свои имя пользователя и имя пользователя не другого пользователя.

**Листинг 4 – Controllers\UserController.cs**

[!code-csharp[Main](improving-performance-with-output-caching-cs/samples/sample4.cs)]

Обратите внимание, что атрибут [OutputCache] в листинге 4 включает свойство Location, присвоено значение OutputCacheLocation.Client. Атрибут [OutputCache] также включает свойство NoStore. Свойство NoStore используется для информирования прокси-серверы и обозреватель их не следует хранить постоянную копию кэшированного содержимого.

## <a name="varying-the-output-cache"></a>Изменения кэша вывода

В некоторых ситуациях может потребоваться различных резервных копий тех же самых содержимого. Допустим, что вы создаете страницы основной/подробности. Главная страница отображает список названий фильмов. Если щелкнуть заголовок, можно получить сведения о выбранной фильма.

Если кэшировать страницу сведений, затем подробности же фильма отображается независимо от того, какие фрагменты нажмите кнопку. Первого выбранного пользователем первого фильма будет отображаться для всех последующих пользователей.

Эту неполадку можно устранить, используя свойство VaryByParam атрибута [OutputCache]. Это свойство позволяет создавать различные резервных копий тех же самых содержимое, если параметр формы или изменяется параметр строки запроса.

Например контроллер в листинге 5 предоставляет два действия с именем Master() и Details(). Действие Master() возвращает список названий фильмов и Details() действие возвращает сведения для выбранного фрагмента.

**Листинг 5 – Controllers\MoviesController.cs**

[!code-csharp[Main](improving-performance-with-output-caching-cs/samples/sample5.cs)]

Действие Master() включает VaryByParam свойство со значением «none». Возвращается при вызове действия Master() же кэшированная версия главного просмотра. Любой параметров формы или строки запроса, которые являются параметры игнорируются (см. рис. 2).

**Рис. 2 – Просмотр /Movies/Master**

![clip_image004](improving-performance-with-output-caching-cs/_static/image2.jpg)

**Рис. 3 – Просмотр подробностей/фильмов /**

![clip_image006](improving-performance-with-output-caching-cs/_static/image3.jpg)

Действие Details() включает VaryByParam свойство со значением «Id». При разных значениях параметра Id передаются действия контроллера, создаются в представлении сведений различных резервных копий.

Это важно понимать, что с помощью VaryByParam результаты свойства в дополнительные кэширование и не меньше. Для каждой версии параметр Id создается другой кэшированная версия подробного представления.

Свойству VaryByParam следующие значения:

> \* = Создайте другой кэшированная версия всякий раз, когда изменяется формы или параметром строки запроса.
> 
> Нет = не Создание различных резервных копий
> 
> Точка с запятой список параметров = Создание различных резервных копий, каждый раз, когда любой из параметров строку, форму или запрос в списке зависит от


## <a name="creating-a-cache-profile"></a>Создание профиля кэша

В качестве альтернативы для настройки свойств кэша вывода, изменяя свойства атрибута [OutputCache] можно создать профиль кэша в файле веб-конфигурации (web.config). Создайте профиль кэша в файле конфигурации веб-предлагает несколько важных преимуществ.

Во-первых настроив кэширование вывода в файл веб-конфигурации, можно управлять как действия контроллера кэшировать содержимое в одном централизованном месте. Можно создать один профиль кэша и применить профиль с несколькими контроллерами или действия контроллера.

Во-вторых можно изменить файл веб-конфигурации без перекомпиляции приложения. Если вам нужно отключить кэширование для приложения, который уже развернут в рабочей среде, можно просто изменить кэш профилей, определенных в файле веб-конфигурации. Любые изменения в файл веб-конфигурации будет обнаруживаются автоматически и применения.

Например &lt;кэширование&gt; раздела веб-конфигурации в список 6 определяет профиль кэша с именем Cache1Hour. &lt;Кэширование&gt; раздел должен находиться внутри &lt;system.web&gt; раздел файла веб-конфигурации.

**Перечисление 6 – разделе кэша для файла web.config**

[!code-xml[Main](improving-performance-with-output-caching-cs/samples/sample6.xml)]

Контроллер в листинг 7 показано, как Cache1Hour профиль можно применять к действия контроллера с помощью атрибута [OutputCache].

**Листинг 7 – Controllers\ProfileController.cs**

[!code-csharp[Main](improving-performance-with-output-caching-cs/samples/sample7.cs)]

Если вызвать Index() действию, предоставляемым контроллером в листинг 7 и то же время будет возвращаться в течение часа.

## <a name="summary"></a>Сводка

Кэширование вывода обеспечивает очень простой метод значительно повышая производительность приложений ASP.NET MVC. В этом учебнике вы узнали, как использовать атрибут [OutputCache] для кэширования выходных данных действия контроллера. Вы также узнали, как изменить свойства атрибута [OutputCache], например длительность и VaryByParam свойства для изменения кэширования содержимого возвращает. Наконец вы узнали, как для определения профилей кэша в файл веб-конфигурации.

> [!div class="step-by-step"]
> [Назад](understanding-action-filters-cs.md)
> [Вперед](adding-dynamic-content-to-a-cached-page-cs.md)
