---
uid: mvc/overview/older-versions-1/controllers-and-routing/adding-dynamic-content-to-a-cached-page-cs
title: "Добавление динамического контента в кэшированные страницы (C#) | Документы Microsoft"
author: microsoft
description: "Дополнительные сведения о смешивать динамических и кэшированное содержимое на одной странице. Подстановки после кэширования позволяет отображать динамическое содержимое, например o объявления баннер..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/27/2009
ms.topic: article
ms.assetid: 2ddd4407-d143-4a94-877c-21771bfb97a6
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/controllers-and-routing/adding-dynamic-content-to-a-cached-page-cs
msc.type: authoredcontent
ms.openlocfilehash: bee7e17ee16d75419c215558b1deb7d6f0d79448
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="adding-dynamic-content-to-a-cached-page-c"></a>Добавление динамического контента в кэшированные страницы (C#)
====================
по [Microsoft](https://github.com/microsoft)

> Дополнительные сведения о смешивать динамических и кэшированное содержимое на одной странице. Подстановки после кэширования позволяет отображать динамическое содержимое, например рекламных объявлений или новости, страницы, которая есть выходные данные в кэше.


Используя преимущества кэширования вывода, могут существенно повысить производительность приложения ASP.NET MVC. Вместо повторного создания страницы каждую страницу при запросе страницы можно создать раза и кэшируются в памяти для нескольких пользователей.

Но есть проблема. Что делать, если необходимо отобразить динамическое содержимое на странице? Например предположим, требуется объявление баннер отобразить на странице. Вы не хотите баннерной должен быть кэширован, чтобы каждый пользователь видит точно такой же объявление. Денежные средства бы сделать в этом случае!

К счастью есть простое решение. Можно воспользоваться преимуществами функции платформы ASP.NET, который называется *подстановка после кэширования*. Подстановки после кэширования позволяет заменить динамическое содержимое на странице, кэшированные в памяти.


Как правило при выводе страницы кэша с помощью атрибута [OutputCache], страница кэшируется на сервере и клиенте (веб-браузер). При использовании подстановки после кэширования страница кэшируется только на сервере.


#### <a name="using-post-cache-substitution"></a>С помощью подстановки после кэширования

С помощью подстановки после кэширования в два этапа. Во-первых необходимо определить метод, который возвращает строку, представляющую динамическое содержимое, которое будет отображаться в кэшированной страницы. Далее можно вызвать метод HttpResponse.WriteSubstitution() для вставки динамическое содержимое на странице.

Пусть, например, требуется случайным образом отобразить элементы различных новостей кэшированных страниц. Класс в список 1 предоставляет один метод с именем RenderNews(), которая случайным образом возвращает один элемент новостей из списка из трех элементов новостей.

**Перечисление Models\News.cs. 1.**

[!code-csharp[Main](adding-dynamic-content-to-a-cached-page-cs/samples/sample1.cs)]

Чтобы воспользоваться преимуществами подстановки после кэширования, следует вызвать метод HttpResponse.WriteSubstitution(). Метод WriteSubstitution() устанавливает код с динамическим содержимым, замените кэшированных страниц. Метод WriteSubstitution() используется для отображения случайных новостей в представлении в списке 2.

**Перечисление Views\Home\Index.aspx. 2.**

[!code-aspx[Main](adding-dynamic-content-to-a-cached-page-cs/samples/sample2.aspx)]

Метод RenderNews передается методу WriteSubstitution(). Обратите внимание, что не вызывается метод RenderNews (отсутствуют круглые скобки). Вместо этого WriteSubstitution() передается ссылка на метод.

Представление Index кэшируется. Возвращает представление контроллера в списке 3. Обратите внимание, что действие Index() помечено атрибутом [OutputCache], который вызывает представление Index на кэширование в течение 60 секунд.

**Перечисление Controllers\HomeController.cs. 3.**

[!code-csharp[Main](adding-dynamic-content-to-a-cached-page-cs/samples/sample3.cs)]

Несмотря на то, что кэшируются представление Index различных случайных новости отображаются при запросе страницы индекса. При запросе страницы индекса, время, отображаемое на странице не изменяет 60 секунд (см. рис. 1). Тот факт, что не изменяет время подтверждает, что страница кэшируется. Однако содержимое введенному изменение метода — случайных новости — WriteSubstitution() с каждым запросом.

**Рис. 1 – Добавление динамического новости в кэшированной страницы**

![clip_image002](adding-dynamic-content-to-a-cached-page-cs/_static/image1.jpg)

#### <a name="using-post-cache-substitution-in-helper-methods"></a>С помощью подстановки после кэширования в вспомогательные методы

Для инкапсуляции вызов метода WriteSubstitution() внутри пользовательских вспомогательных метода является более простой способ воспользоваться преимуществами подстановки после кэширования. Вспомогательный метод со списком 4 показана этот подход.

**Листинг 4 – AdHelper.cs**

[!code-csharp[Main](adding-dynamic-content-to-a-cached-page-cs/samples/sample4.cs)]

Листинг 4 содержит статический класс, имеющий два метода: RenderBanner() и RenderBannerInternal(). Метод RenderBanner() представляет фактический вспомогательный метод. Этот метод расширяет стандартный класс ASP.NET MVC HtmlHelper, чтобы Html.RenderBanner() можно вызвать в представлении так же, как вспомогательный метод.

Метод RenderBanner() вызывает метод HttpResponse.WriteSubstitution() передачу метод RenderBannerInternal() метод WriteSubsitution().

Метод RenderBannerInternal() является закрытым. Этот метод не будет предоставляться как вспомогательный метод. Метод RenderBannerInternal() случайным образом возвращает одно изображение баннера объявления из списка три объявления изображения баннера.

Измененный представление Index в листинге 5 показано, как можно использовать вспомогательный метод RenderBanner(). Обратите внимание, что дополнительный &lt;% @ импорта %&gt; директива включается в верхней части представления, чтобы импортировать пространство имен MvcApplication1.Helpers. Если не импортировать это пространство имен, метод RenderBanner() не будет отображаться как метод для свойств Html.

**Листинг 5 – Views\Home\Index.aspx (с помощью метода RenderBanner())**

[!code-aspx[Main](adding-dynamic-content-to-a-cached-page-cs/samples/sample5.aspx)]

При запросе страницы к просмотру в представлении в листинге 5 разных баннерной отображается с каждым запросом (см. рис. 2). Страница кэшируется, но баннерной встраивается динамически с помощью вспомогательного метода RenderBanner().

**Рис. 2 – отображение случайных баннерной представление Index**

![clip_image004](adding-dynamic-content-to-a-cached-page-cs/_static/image2.jpg)

#### <a name="summary"></a>Сводка

Этот учебник описано, как динамически обновить содержимое в кэшированных страниц. Вы узнали, как использовать метод HttpResponse.WriteSubstitution(), чтобы включить динамическое содержимое, вставляемый в кэшированных страниц. Вы также узнали, как инкапсулировать вызов метода WriteSubstitution() вспомогательный метод HTML.

Преимущества кэширования по возможности — он может оказывать значительное влияние на производительность веб-приложений. Как описано в этом учебнике, можно воспользоваться преимуществами кэширования даже в том случае, если необходимо отобразить динамическое содержимое на страницах.

## 

## 

>[!div class="step-by-step"]
[Назад](improving-performance-with-output-caching-cs.md)
[Вперед](creating-a-controller-cs.md)
