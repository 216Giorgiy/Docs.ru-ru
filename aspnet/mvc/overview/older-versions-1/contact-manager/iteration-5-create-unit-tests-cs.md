---
uid: mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
title: 'Итерации #5 – Создание модульных тестов (C#) | Документы Microsoft'
author: microsoft
description: В пятой итерации сделан нашего приложения проще в обслуживании и изменить, добавив модульных тестов. Мы макета наших классов модели данных и создания модульных тестов для o...
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2009
ms.topic: article
ms.assetid: 28ad8f80-b8a5-444e-b478-8b15a846060c
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
msc.type: authoredcontent
ms.openlocfilehash: 7a61b5791a40088df9d27f7b1bd37df1831ef22b
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="iteration-5--create-unit-tests-c"></a><span data-ttu-id="ea4b2-104">Итерации #5 – Создание модульных тестов (C#)</span><span class="sxs-lookup"><span data-stu-id="ea4b2-104">Iteration #5 – Create unit tests (C#)</span></span>
====================
<span data-ttu-id="ea4b2-105">по [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="ea4b2-105">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="ea4b2-106">Загрузить исходный код</span><span class="sxs-lookup"><span data-stu-id="ea4b2-106">Download Code</span></span>](iteration-5-create-unit-tests-cs/_static/contactmanager_5_cs1.zip)

> <span data-ttu-id="ea4b2-107">В пятой итерации сделан нашего приложения проще в обслуживании и изменить, добавив модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-107">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="ea4b2-108">Мы макета наших классов модели данных и создания модульных тестов для наших контроллеров и логику проверки.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-108">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>


## <a name="building-a-contact-management-aspnet-mvc-application-c"></a><span data-ttu-id="ea4b2-109">Создание приложения ASP.NET MVC управления контактами (C#)</span><span class="sxs-lookup"><span data-stu-id="ea4b2-109">Building a Contact Management ASP.NET MVC Application (C#)</span></span>

<span data-ttu-id="ea4b2-110">В этой серии учебники мы создаем всего приложения управления контактами от начала и завершения.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-110">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="ea4b2-111">Приложение диспетчера контактов позволяет хранить контактные данные - имена, номера телефонов и адресов электронной почты — список людей.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-111">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="ea4b2-112">Мы постройте приложение в нескольких итерациях.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-112">We build the application over multiple iterations.</span></span> <span data-ttu-id="ea4b2-113">С каждой итерацией постепенно мы улучшить приложение.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-113">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="ea4b2-114">Это несколько итераций предназначена для того, чтобы позволяют понять причину для каждого изменения.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-114">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="ea4b2-115">Итерации #1 - создать приложение.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-115">Iteration #1 - Create the application.</span></span> <span data-ttu-id="ea4b2-116">В первой итерации мы создадим диспетчера контактов простейшим способом невозможно.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-116">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="ea4b2-117">Добавлена поддержка для основных операций базы данных: создание, чтение, обновление и удаление (CRUD).</span><span class="sxs-lookup"><span data-stu-id="ea4b2-117">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="ea4b2-118">Итерации #2 — сделать приложение поиска работы с низким приоритетом.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-118">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="ea4b2-119">В этой итерации нам улучшить внешний вид приложения, изменив значение по умолчанию главной страницы представления ASP.NET MVC и каскадные таблицы стилей.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-119">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="ea4b2-120">Итерации #3 - Добавление проверки формы.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-120">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="ea4b2-121">В третьем проходе добавим проверки базовой формы.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-121">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="ea4b2-122">Мы запретить отправки формы, не завершая обязательные поля.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-122">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="ea4b2-123">Мы также для проверки адреса электронной почты и номера телефонов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-123">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="ea4b2-124">Итерации #4 - сделать приложение слабо.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-124">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="ea4b2-125">В этой третьей итерации мы воспользоваться преимуществами нескольких шаблонов разработки программного обеспечения, чтобы упростить обслуживание и изменить приложение диспетчера контактов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-125">In this third iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="ea4b2-126">Например мы выполнили рефакторинг наше приложение, чтобы использовать шаблон репозитория и шаблон внедрения зависимостей.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-126">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="ea4b2-127">Итерации #5 - Создание модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-127">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="ea4b2-128">В пятой итерации сделан нашего приложения проще в обслуживании и изменить, добавив модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-128">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="ea4b2-129">Мы макета наших классов модели данных и создания модульных тестов для наших контроллеров и логику проверки.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-129">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="ea4b2-130">Итерация 6 # — с помощью управляемой тестами разработки.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-130">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="ea4b2-131">В итерации этого шестой мы добавим новые функциональные возможности наше приложение, сначала написание модульных тестов и писать код для модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-131">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="ea4b2-132">В этой итерации добавим групп контактов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-132">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="ea4b2-133">Итерации #7. Добавление функциональности Ajax.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-133">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="ea4b2-134">В седьмой итерации мы повысить скорость реагирования и производительности приложения, добавляя поддержку Ajax.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-134">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>


## <a name="this-iteration"></a><span data-ttu-id="ea4b2-135">Этой итерации</span><span class="sxs-lookup"><span data-stu-id="ea4b2-135">This Iteration</span></span>

<span data-ttu-id="ea4b2-136">В предыдущих итерациях приложение диспетчера контактов мы оптимизировали приложению быть более слабо.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-136">In the previous iteration of the Contact Manager application, we refactored the application to be more loosely coupled.</span></span> <span data-ttu-id="ea4b2-137">Мы запятыми приложение в различных контроллера, службы и слои репозитория.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-137">We separated the application into distinct controller, service, and repository layers.</span></span> <span data-ttu-id="ea4b2-138">Каждый уровень взаимодействует с нижнего уровня через интерфейсы.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-138">Each layer interacts with the layer beneath it through interfaces.</span></span>

<span data-ttu-id="ea4b2-139">Мы оптимизировали приложение, чтобы сделать удобнее для обслуживания и изменения приложения.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-139">We refactored the application to make the application easier to maintain and modify.</span></span> <span data-ttu-id="ea4b2-140">Например если необходимо использовать новые технологии доступа к данным, мы можем просто изменить уровня репозитория не касаясь контроллер или уровня службы.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-140">For example, if we need to use a new data access technology, we can simply change the repository layer without touching the controller or service layer.</span></span> <span data-ttu-id="ea4b2-141">Сделав диспетчера контактов слабо, мы хранять сделать приложение более устойчивым, чтобы изменить.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-141">By making the Contact Manager loosely coupled, we ve made the application more resilient to change.</span></span>

<span data-ttu-id="ea4b2-142">Но что произойдет, если необходимо добавить новый компонент в приложение диспетчера контактов?</span><span class="sxs-lookup"><span data-stu-id="ea4b2-142">But, what happens when we need to add a new feature to the Contact Manager application?</span></span> <span data-ttu-id="ea4b2-143">Или, что произойдет, если мы будем устранять ошибки?</span><span class="sxs-lookup"><span data-stu-id="ea4b2-143">Or, what happens when we fix a bug?</span></span> <span data-ttu-id="ea4b2-144">Жаль, что, но также и проверенные истину написание кода состоит в том всякий раз, когда touch кода создается риск возникновения новых ошибок.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-144">A sad, but well proven, truth of writing code is that whenever you touch code you create the risk of introducing new bugs.</span></span>

<span data-ttu-id="ea4b2-145">Например один день нормально, менеджеру по работе с вас могут попросить добавить новый компонент диспетчера контактов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-145">For example, one fine day, your manager might ask you to add a new feature to the Contact Manager.</span></span> <span data-ttu-id="ea4b2-146">Можно добавить поддержку групп обратитесь к менеджеру.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-146">She wants you to add support for Contact Groups.</span></span> <span data-ttu-id="ea4b2-147">Она хочет, чтобы пользователи могли упорядочить свои контакты в группы, такие как друзья, Business и т. д.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-147">She wants you to enable users to organize their contacts into groups such as Friends, Business, and so on.</span></span>

<span data-ttu-id="ea4b2-148">Чтобы реализовать этот новый компонент, необходимо изменить все три уровня приложения диспетчера контактов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-148">In order to implement this new feature, you'll need to modify all three layers of the Contact Manager application.</span></span> <span data-ttu-id="ea4b2-149">Необходимо добавить новые функции для контроллеров, уровень службы и хранилище.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-149">You'll need to add new functionality to the controllers, the service layer, and the repository.</span></span> <span data-ttu-id="ea4b2-150">Сразу после запуска изменения кода, то существует риск критические функции, которые работали перед.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-150">As soon as you start modifying code, you risk breaking functionality that worked before.</span></span>

<span data-ttu-id="ea4b2-151">Рефакторинг нашего приложения в отдельные слои, как мы делали в предыдущих итерациях был хорошо.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-151">Refactoring our application into separate layers, as we did in the previous iteration, was a good thing.</span></span> <span data-ttu-id="ea4b2-152">Было хорошо, так как он позволяет нам вносить изменения в все слои, не затрагивая остальной части приложения.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-152">It was a good thing because it enables us to make changes to entire layers without touching the rest of the application.</span></span> <span data-ttu-id="ea4b2-153">Если вы хотите сделать удобнее для обслуживания и изменять код в составе слоя, необходимо создать модульные тесты для кода.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-153">However, if you want to make the code within a layer easier to maintain and modify, you need to create unit tests for the code.</span></span>

<span data-ttu-id="ea4b2-154">Используется модульного теста для тестирования отдельный блок кода.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-154">You use a unit test to test an individual unit of code.</span></span> <span data-ttu-id="ea4b2-155">Эти блоки кода, меньше, чем слои всего приложения.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-155">These units of code are smaller than entire application layers.</span></span> <span data-ttu-id="ea4b2-156">Как правило чтобы убедиться, является ли конкретный метод в коде работает нужным образом, предполагается, что используется модульного теста.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-156">Typically, you use a unit test to verify whether a particular method in your code behaves in the way that you expect.</span></span> <span data-ttu-id="ea4b2-157">Например создается модульный тест для метода CreateContact(), предоставляемые классом ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-157">For example, you would create a unit test for the CreateContact() method exposed by the ContactManagerService class.</span></span>

<span data-ttu-id="ea4b2-158">Модульные тесты на работу приложения, точно так же, как средство подстраховки.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-158">The unit tests for an application work just like a safety net.</span></span> <span data-ttu-id="ea4b2-159">Каждый раз при изменении кода в приложении, можно запустить набор модульных тестов для проверки, разбивает ли изменять существующие функциональные возможности.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-159">Whenever you modify code in an application, you can run a set of unit tests to check whether the modification breaks existing functionality.</span></span> <span data-ttu-id="ea4b2-160">Модульные тесты сделать код можно изменить.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-160">Unit tests make your code safe to modify.</span></span> <span data-ttu-id="ea4b2-161">Модульные тесты сделать весь код в приложении более устойчивым к изменения.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-161">Unit tests make all of the code in your application more resilient to change.</span></span>

<span data-ttu-id="ea4b2-162">В этой итерации мы добавим модульные тесты наше приложение диспетчера контактов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-162">In this iteration, we add unit tests to our Contact Manager application.</span></span> <span data-ttu-id="ea4b2-163">Таким образом, в следующей итерации, можно добавить контакт группы для нашего приложения, не беспокоясь о критических существующие функциональные возможности.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-163">That way, in the next iteration, we can add Contact Groups to our application without worrying about breaking existing functionality.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="ea4b2-164">Существуют различные платформы, включая NUnit, xUnit.net и MbUnit модульного тестирования.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-164">There are a variety of unit testing frameworks including NUnit, xUnit.net, and MbUnit.</span></span> <span data-ttu-id="ea4b2-165">В этом учебнике мы используем платформе модульного тестирования входящих в состав Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-165">In this tutorial, we use the unit testing framework included with Visual Studio.</span></span> <span data-ttu-id="ea4b2-166">Тем не менее можно легко использовать один из этих альтернативных платформ.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-166">However, you could just as easily use one of these alternative frameworks.</span></span>


## <a name="what-gets-tested"></a><span data-ttu-id="ea4b2-167">Что возвращает тестирования</span><span class="sxs-lookup"><span data-stu-id="ea4b2-167">What Gets Tested</span></span>

<span data-ttu-id="ea4b2-168">В идеальном мире весь код должен покрывать модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-168">In the perfect world, all of your code would be covered by unit tests.</span></span> <span data-ttu-id="ea4b2-169">В идеальном мире бы идеальным подстраховки.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-169">In the perfect world, you would have the perfect safety net.</span></span> <span data-ttu-id="ea4b2-170">Вы бы иметь возможность измените любую строку кода в приложении, чтобы узнать, выполнив модульные тесты ли это изменение было передано существующие функциональные возможности.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-170">You would be able to modify any line of code in your application and know instantly, by executing your unit tests, whether the change broke existing functionality.</span></span>

<span data-ttu-id="ea4b2-171">Тем не менее мы не хотите динамической t в идеальном мире.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-171">However, we don t live in a perfect world.</span></span> <span data-ttu-id="ea4b2-172">На практике при написании модульных тестов можно сосредоточиться на написание тестов для бизнес-логики (например, логика проверки).</span><span class="sxs-lookup"><span data-stu-id="ea4b2-172">In practice, when writing unit tests, you concentrate on writing tests for your business logic (for example, validation logic).</span></span> <span data-ttu-id="ea4b2-173">В частности вы *не* создавать модульные тесты для данных доступ к логику или логику представления.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-173">In particular, you *do not* write unit tests for your data access logic or your view logic.</span></span>

<span data-ttu-id="ea4b2-174">Чтобы быть полезным, модульные тесты должны выполняться очень быстро.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-174">To be useful, unit tests must execute very quickly.</span></span> <span data-ttu-id="ea4b2-175">Можно легко накапливаются сотни (или даже тысячами) модульных тестов для приложения.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-175">You easily can accumulate hundreds (or even thousands) of unit tests for an application.</span></span> <span data-ttu-id="ea4b2-176">Если модульные тесты занять много времени для запуска, а затем позволяет избежать их выполнении.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-176">If the unit tests take a long time to run then you'll avoid executing them.</span></span> <span data-ttu-id="ea4b2-177">Другими словами, длительные модульные тесты — бесполезными для ежедневных кодирования в целях.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-177">In other words, long running unit tests are useless for day to day coding purposes.</span></span>

<span data-ttu-id="ea4b2-178">По этой причине обычно вы не создаете модульных тестов для кода, взаимодействующая с базой данных.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-178">For this reason, you typically do not write unit tests for code that interacts with a database.</span></span> <span data-ttu-id="ea4b2-179">Запустив сотни модульных тестов для активной базы данных будет слишком медленно.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-179">Running hundreds of unit tests against a live database would be too slow.</span></span> <span data-ttu-id="ea4b2-180">Вместо этого макета базы данных и написать код, который взаимодействует с базой данных макетов (мы обсудим имитации базы данных ниже).</span><span class="sxs-lookup"><span data-stu-id="ea4b2-180">Instead, you mock your database and write code that interacts with the mock database (we discuss mocking a database below).</span></span>

<span data-ttu-id="ea4b2-181">Аналогично обычно не написании модульных тестов для представления.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-181">For a similar reason, you typically do not write unit tests for views.</span></span> <span data-ttu-id="ea4b2-182">Для проверки представления, необходимо запустить веб-сервера.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-182">In order to test a view, you must spin up a web server.</span></span> <span data-ttu-id="ea4b2-183">Поскольку для настройки веб-сервера является относительно медленным процессом, создании модульных тестов для представления не рекомендуется.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-183">Because spinning up a web server is a relatively slow process, creating unit tests for your views is not recommended.</span></span>

<span data-ttu-id="ea4b2-184">Если представление содержит сложной логики следует рассмотреть, переместив логику в вспомогательные методы.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-184">If your view contains complicated logic then you should consider moving the logic into Helper methods.</span></span> <span data-ttu-id="ea4b2-185">Можно создавать модульные тесты для вспомогательных методов, которые выполняются не задействовав веб-сервера.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-185">You can write unit tests for Helper methods that execute without spinning up a web server.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="ea4b2-186">Во время записи тестов для логики доступа к данным или логики представления, рекомендуется не при написании модульных тестов, эти тесты может быть очень полезной при функционального построения или интеграции тестов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-186">While writing tests for data access logic or view logic is not a good idea when writing unit tests, these tests can be very valuable when building functional or integration tests.</span></span>


> [!NOTE] 
> 
> <span data-ttu-id="ea4b2-187">ASP.NET MVC является обработчик представлений Web Forms.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-187">ASP.NET MVC is the Web Forms View Engine.</span></span> <span data-ttu-id="ea4b2-188">Хотя обработчик представлений Web Forms зависит от веб-сервера, может быть других обработчиков представлений.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-188">While the Web Forms View Engine is dependent on a web server, other view engines might not be.</span></span>


## <a name="using-a-mock-object-framework"></a><span data-ttu-id="ea4b2-189">С помощью макетов объекта платформы</span><span class="sxs-lookup"><span data-stu-id="ea4b2-189">Using a Mock Object Framework</span></span>

<span data-ttu-id="ea4b2-190">При создании модульных тестов, почти всегда необходимо воспользоваться преимуществами платформы создания объекта.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-190">When building unit tests, you almost always need to take advantage of a Mock Object framework.</span></span> <span data-ttu-id="ea4b2-191">Это платформа для создания объекта позволяет создавать макеты и заглушки для классов в вашем приложении.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-191">A Mock Object framework enables you to create mocks and stubs for the classes in your application.</span></span>

<span data-ttu-id="ea4b2-192">Например framework макета объекта можно использовать для создания имитационную версию класса репозитория.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-192">For example, you can use a Mock Object framework to generate a mock version of your repository class.</span></span> <span data-ttu-id="ea4b2-193">Таким образом, вы можно использовать класс макета репозитория вместо класса реальные репозитория в модульных тестах.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-193">That way, you can use the mock repository class instead of the real repository class in your unit tests.</span></span> <span data-ttu-id="ea4b2-194">С помощью макета репозитория дает возможность избежать выполнения кода базы данных при выполнении модульного теста.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-194">Using the mock repository enables you to avoid executing database code when executing a unit test.</span></span>

<span data-ttu-id="ea4b2-195">Visual Studio включает платформу для создания объекта.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-195">Visual Studio does not include a Mock Object framework.</span></span> <span data-ttu-id="ea4b2-196">Тем не менее имеются несколько инфраструктур макета объекта коммерческих с открытым исходным кодом для платформы .NET framework:</span><span class="sxs-lookup"><span data-stu-id="ea4b2-196">However, there are several commercial and open source Mock Object frameworks available for the .NET framework:</span></span>

1. <span data-ttu-id="ea4b2-197">Заказа - эта платформа доступна в соответствии с открытой лицензией BSD.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-197">Moq - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="ea4b2-198">Вы можете загрузить заказа из [ https://code.google.com/p/moq/ ](https://code.google.com/p/moq/).</span><span class="sxs-lookup"><span data-stu-id="ea4b2-198">You can download Moq from [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span></span>
2. <span data-ttu-id="ea4b2-199">Фиктивных Rhino - эта платформа доступна в соответствии с открытой лицензией BSD.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-199">Rhino Mocks - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="ea4b2-200">Вы можете загрузить Rhino фиктивных из [ http://ayende.com/projects/rhino-mocks.aspx ](http://ayende.com/projects/rhino-mocks.aspx).</span><span class="sxs-lookup"><span data-stu-id="ea4b2-200">You can download Rhino Mocks from [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span></span>
3. <span data-ttu-id="ea4b2-201">Typemock изолятор - это коммерческих framework.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-201">Typemock Isolator - This is a commercial framework.</span></span> <span data-ttu-id="ea4b2-202">Можно загрузить ознакомительную версию с [ http://www.typemock.com/ ](http://www.typemock.com/).</span><span class="sxs-lookup"><span data-stu-id="ea4b2-202">You can download a trial version from [http://www.typemock.com/](http://www.typemock.com/).</span></span>

<span data-ttu-id="ea4b2-203">В этом учебнике решила использовать заказа.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-203">In this tutorial, I decided to use Moq.</span></span> <span data-ttu-id="ea4b2-204">Однако можно легко использовать фиктивных Rhino или изолятор Typemock создание макетов объектов для приложения диспетчера контактов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-204">However, you could just as easily use Rhino Mocks or Typemock Isolator to create the Mock objects for the Contact Manager application.</span></span>

<span data-ttu-id="ea4b2-205">Прежде чем использовать заказа, необходимо выполнить следующие действия:</span><span class="sxs-lookup"><span data-stu-id="ea4b2-205">Before you can use Moq, you need to complete the following steps:</span></span>

1. <span data-ttu-id="ea4b2-206">.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-206">.</span></span>
2. <span data-ttu-id="ea4b2-207">Прежде чем вы распаковать загрузки, убедитесь в том, щелкните правой кнопкой мыши файл и нажмите кнопку с многоточием **Unblock** (см. рис. 1).</span><span class="sxs-lookup"><span data-stu-id="ea4b2-207">Before you unzip the download, make sure that you right-click the file and click the button labeled **Unblock** (see Figure 1).</span></span>
3. <span data-ttu-id="ea4b2-208">Распакуйте загрузки.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-208">Unzip the download.</span></span>
4. <span data-ttu-id="ea4b2-209">Добавьте ссылку на сборку заказа, щелкните правой кнопкой мыши папку References проекта ContactManager.Tests и выбрав **добавить ссылку**.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-209">Add a reference to the Moq assembly by right-clicking the References folder in the ContactManager.Tests project and selecting **Add Reference**.</span></span> <span data-ttu-id="ea4b2-210">Вкладка "Обзор" перейдите к папке, куда было распаковано заказа и выберите сборку Moq.dll.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-210">Under the Browse tab, browse to the folder where you unzipped Moq and select the Moq.dll assembly.</span></span> <span data-ttu-id="ea4b2-211">Нажмите кнопку **ОК** кнопки.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-211">Click the **OK** button.</span></span>
5. <span data-ttu-id="ea4b2-212">После выполнения этих шагов вашей папке "ссылки" должна выглядеть как на рис. 2.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-212">After you complete these steps, your References folder should look like Figure 2.</span></span>


<span data-ttu-id="ea4b2-213">[![Разблокирование заказа](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="ea4b2-213">[![Unblocking Moq](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span></span>

<span data-ttu-id="ea4b2-214">**На рисунке 01**: разблокирование заказа ([Просмотр полноразмерное изображение](iteration-5-create-unit-tests-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="ea4b2-214">**Figure 01**: Unblocking Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image2.png))</span></span>


<span data-ttu-id="ea4b2-215">[![Ссылки после добавления заказа](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="ea4b2-215">[![References after adding Moq](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span></span>

<span data-ttu-id="ea4b2-216">**На рисунке 02**: ссылки после добавления заказа ([Просмотр полноразмерное изображение](iteration-5-create-unit-tests-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="ea4b2-216">**Figure 02**: References after adding Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image4.png))</span></span>


## <a name="creating-unit-tests-for-the-service-layer"></a><span data-ttu-id="ea4b2-217">Создание модульных тестов для уровня службы</span><span class="sxs-lookup"><span data-stu-id="ea4b2-217">Creating Unit Tests for the Service Layer</span></span>

<span data-ttu-id="ea4b2-218">Разрешить s начните с создания набора модульных тестов для наших уровень службы s приложение диспетчера контактов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-218">Let s start by creating a set of unit tests for our Contact Manager application s service layer.</span></span> <span data-ttu-id="ea4b2-219">Мы будем использовать эти тесты, чтобы проверить логику проверки.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-219">We'll use these tests to verify our validation logic.</span></span>

<span data-ttu-id="ea4b2-220">Создайте новую папку с именем моделей в проекте ContactManager.Tests.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-220">Create a new folder named Models in the ContactManager.Tests project.</span></span> <span data-ttu-id="ea4b2-221">Затем щелкните правой кнопкой мыши папку модели и выберите **Add, новый тест**.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-221">Next, right-click the Models folder and select **Add, New Test**.</span></span> <span data-ttu-id="ea4b2-222">**Добавление нового теста** появляется диалоговое окно, показанное на рис. 3.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-222">The **Add New Test** dialog shown in Figure 3 appears.</span></span> <span data-ttu-id="ea4b2-223">Выберите **модульного теста** шаблона и назовите новый тест ContactManagerServiceTest.cs.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-223">Select the **Unit Test** template and name your new test ContactManagerServiceTest.cs.</span></span> <span data-ttu-id="ea4b2-224">Нажмите кнопку **ОК** кнопку, чтобы добавить в проект тестов новый тест.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-224">Click the **OK** button to add your new test to your Test Project.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="ea4b2-225">Как правило требуется структуру папки тестового проекта в соответствии со структурой папок проекта ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-225">In general, you want the folder structure of your Test Project to match the folder structure of your ASP.NET MVC project.</span></span> <span data-ttu-id="ea4b2-226">Например поместите контроллера тестов в папку Controllers, модель тестов в папку Models и так далее.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-226">For example, you place controller tests in a Controllers folder, model tests in a Models folder, and so on.</span></span>


<span data-ttu-id="ea4b2-227">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="ea4b2-227">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span></span>

<span data-ttu-id="ea4b2-228">**На рисунке 03**: Models\ContactManagerServiceTest.cs ([Просмотр полноразмерное изображение](iteration-5-create-unit-tests-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="ea4b2-228">**Figure 03**: Models\ContactManagerServiceTest.cs([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image6.png))</span></span>


<span data-ttu-id="ea4b2-229">Изначально требуется протестировать метод CreateContact(), предоставляемые классом ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-229">Initially, we want to test the CreateContact() method exposed by the ContactManagerService class.</span></span> <span data-ttu-id="ea4b2-230">Мы создадим следующие пять тестов:</span><span class="sxs-lookup"><span data-stu-id="ea4b2-230">We'll create the following five tests:</span></span>

- <span data-ttu-id="ea4b2-231">CreateContact() - тесты, CreateContact() возвращает значение true, если допустимый контакт передается в метод.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-231">CreateContact() - Tests that CreateContact() returns the value true when a valid Contact is passed to the method.</span></span>
- <span data-ttu-id="ea4b2-232">CreateContactRequiredFirstName() - тесты, что сообщение об ошибке добавляется в состояние модели после контакта с отсутствует имя первого передается методу CreateContact().</span><span class="sxs-lookup"><span data-stu-id="ea4b2-232">CreateContactRequiredFirstName() - Tests that an error message is added to model state when a Contact with a missing first name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="ea4b2-233">CreateContactRequredLastName() - тесты, сообщение об ошибке добавляется в состояние модели после контакта с отсутствует Фамилия передается методу CreateContact().</span><span class="sxs-lookup"><span data-stu-id="ea4b2-233">CreateContactRequredLastName() - Tests that an error message is added to model state when a Contact with a missing last name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="ea4b2-234">CreateContactInvalidPhone() - тесты, что сообщение об ошибке добавляется в состояние модели после контакта с недопустимыми номерами телефонов передается методу CreateContact().</span><span class="sxs-lookup"><span data-stu-id="ea4b2-234">CreateContactInvalidPhone() - Tests that an error message is added to model state when a Contact with an invalid phone number is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="ea4b2-235">CreateContactInvalidEmail() - тесты, что сообщение об ошибке добавляется в состояние модели после контакта с недопустимый адрес электронной почты передается методу CreateContact()...</span><span class="sxs-lookup"><span data-stu-id="ea4b2-235">CreateContactInvalidEmail() - Tests that an error message is added to model state when a Contact with an invalid email address is passed to the CreateContact() method..</span></span>

<span data-ttu-id="ea4b2-236">Первый тест проверяет, что допустимый контакт не будет создавать ошибку проверки.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-236">The first test verifies that a valid Contact does not generate a validation error.</span></span> <span data-ttu-id="ea4b2-237">Остальные тесты проверки всех правил проверки.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-237">The remaining tests check each of the validation rules.</span></span>

<span data-ttu-id="ea4b2-238">В список 1 содержится код для этих тестов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-238">The code for these tests is contained in Listing 1.</span></span>

<span data-ttu-id="ea4b2-239">**Листинг 1 - Models\ContactManagerServiceTest.cs**</span><span class="sxs-lookup"><span data-stu-id="ea4b2-239">**Listing 1 - Models\ContactManagerServiceTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample1.cs)]


<span data-ttu-id="ea4b2-240">Так как мы используем контакт класс в список 1, необходимо добавить ссылку на платформу Entity Framework Microsoft нашей тестовый проект.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-240">Because we use the Contact class in Listing 1, we need to add a reference to the Microsoft Entity Framework to our Test project.</span></span> <span data-ttu-id="ea4b2-241">Добавьте ссылку на сборку System.Data.Entity.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-241">Add a reference to the System.Data.Entity assembly.</span></span>


<span data-ttu-id="ea4b2-242">Листинг 1 содержит метод с именем Initialize(), отмеченный атрибутом [TestInitialize].</span><span class="sxs-lookup"><span data-stu-id="ea4b2-242">Listing 1 contains a method named Initialize() that is decorated with the [TestInitialize] attribute.</span></span> <span data-ttu-id="ea4b2-243">Этот метод автоматически вызывается перед выполнением каждого из модульных тестов (она называется 5 раз непосредственно перед каждым из модульных тестов).</span><span class="sxs-lookup"><span data-stu-id="ea4b2-243">This method is called automatically before each of the unit tests is run (it is called 5 times right before each of the unit tests).</span></span> <span data-ttu-id="ea4b2-244">Метод Initialize() создает макет репозитория с следующую строку кода:</span><span class="sxs-lookup"><span data-stu-id="ea4b2-244">The Initialize() method creates a mock repository with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample2.cs)]

<span data-ttu-id="ea4b2-245">Эта строка кода заказа используется для создания макета репозитория из интерфейса IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-245">This line of code uses the Moq framework to generate a mock repository from the IContactManagerRepository interface.</span></span> <span data-ttu-id="ea4b2-246">Вместо фактического EntityContactManagerRepository макета репозитория используется для предотвращения доступа к базе данных при запуске каждого модульного теста.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-246">The mock repository is used instead of the actual EntityContactManagerRepository to avoid accessing the database when each unit test is run.</span></span> <span data-ttu-id="ea4b2-247">Макета репозитория реализует методы интерфейса IContactManagerRepository, но фактически t Дон методы выполнять никаких действий.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-247">The mock repository implements the methods of the IContactManagerRepository interface, but the methods don t actually do anything.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="ea4b2-248">При использовании framework заказа, является различие между \_mockRepository и \_mockRepository.Object.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-248">When using the Moq framework, there is a distinction between \_mockRepository and \_mockRepository.Object.</span></span> <span data-ttu-id="ea4b2-249">Первый из них относится макетов&lt;IContactManagerRepository&gt; класс, содержащий методы для указания того, как будет вести себя макета репозитория.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-249">The former refers to the Mock&lt;IContactManagerRepository&gt; class that contains methods for specifying how the mock repository will behave.</span></span> <span data-ttu-id="ea4b2-250">Последнее относится к фактическое макета репозитория, который реализует интерфейс IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-250">The latter refers to the actual mock repository that implements the IContactManagerRepository interface.</span></span>


<span data-ttu-id="ea4b2-251">При создании экземпляра класса ContactManagerService, макета репозитория используется в метод Initialize().</span><span class="sxs-lookup"><span data-stu-id="ea4b2-251">The mock repository is used in the Initialize() method when creating an instance of the ContactManagerService class.</span></span> <span data-ttu-id="ea4b2-252">Все отдельные модульные тесты используют этот экземпляр класса ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-252">All of the individual unit tests use this instance of the ContactManagerService class.</span></span>

<span data-ttu-id="ea4b2-253">Листинг 1 содержит пять методов, которые соответствуют каждому из модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-253">Listing 1 contains five methods that correspond to each of the unit tests.</span></span> <span data-ttu-id="ea4b2-254">Каждый из этих методов является помеченной атрибутом [TestMethod].</span><span class="sxs-lookup"><span data-stu-id="ea4b2-254">Each of these methods is decorated with the [TestMethod] attribute.</span></span> <span data-ttu-id="ea4b2-255">При выполнении модульных тестов, вызывается любой метод, который имеет этот атрибут.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-255">When you run the unit tests, any method that has this attribute is called.</span></span> <span data-ttu-id="ea4b2-256">Другими словами любой метод, отмеченный атрибутом [TestMethod] — это модульный тест.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-256">In other words, any method that is decorated with the [TestMethod] attribute is a unit test.</span></span>

<span data-ttu-id="ea4b2-257">Первый модульный тест, с именем CreateContact(), проверяет, что вызов CreateContact() возвращает значение true, если допустимый экземпляр класса контакта передается в метод.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-257">The first unit test, named CreateContact(), verifies that calling CreateContact() returns the value true when a valid instance of the Contact class is passed to the method.</span></span> <span data-ttu-id="ea4b2-258">Тест создает экземпляр класса контакта, вызывает метод CreateContact() и проверяет, что CreateContact() возвращает значение true.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-258">The test creates an instance of the Contact class, calls the CreateContact() method, and verifies that CreateContact() returns the value true.</span></span>

<span data-ttu-id="ea4b2-259">Остальные тесты убедитесь, что при вызове метода CreateContact() Недопустимый контакт затем метод возвращает значение false, и сообщение об ошибке проверки ожидаемого добавляется состояние модели.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-259">The remaining tests verify that when the CreateContact() method is called with an invalid Contact then the method returns false and the expected validation error message is added to model state.</span></span> <span data-ttu-id="ea4b2-260">Например тест CreateContactRequiredFirstName() создает экземпляр класса контакта с пустой строки для свойства «имя».</span><span class="sxs-lookup"><span data-stu-id="ea4b2-260">For example, the CreateContactRequiredFirstName() test creates an instance of the Contact class with an empty string for its FirstName property.</span></span> <span data-ttu-id="ea4b2-261">Затем метод CreateContact() вызывается с недопустимый контакт.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-261">Next, the CreateContact() method is called with the invalid Contact.</span></span> <span data-ttu-id="ea4b2-262">Наконец тест проверяет, что CreateContact() возвращает значение false и состояния модели содержит сообщение об ошибке проверки ожидаемого «требуется имя.»</span><span class="sxs-lookup"><span data-stu-id="ea4b2-262">Finally, the test verifies that CreateContact() returns false and that model state contains the expected validation error message "First name is required."</span></span>

<span data-ttu-id="ea4b2-263">Можно выполнять модульные тесты в список 1, выбрав параметр меню **теста запустите все тесты в решении (CTRL + R, A)**.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-263">You can run the unit tests in Listing 1 by selecting the menu option **Test, Run, All Tests in Solution (CTRL+R, A)**.</span></span> <span data-ttu-id="ea4b2-264">Результаты тестов отображаются в окне результатов теста (см. рис. 4).</span><span class="sxs-lookup"><span data-stu-id="ea4b2-264">The results of the tests are displayed in the Test Results window (see Figure 4).</span></span>


<span data-ttu-id="ea4b2-265">[![Результаты теста](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="ea4b2-265">[![Test Results](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span></span>

<span data-ttu-id="ea4b2-266">**На рисунке 04**: результаты теста ([Просмотр полноразмерное изображение](iteration-5-create-unit-tests-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="ea4b2-266">**Figure 04**: Test Results ([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image8.png))</span></span>


## <a name="creating-unit-tests-for-controllers"></a><span data-ttu-id="ea4b2-267">Создание модульных тестов для контроллеров</span><span class="sxs-lookup"><span data-stu-id="ea4b2-267">Creating Unit Tests for Controllers</span></span>

<span data-ttu-id="ea4b2-268">Приложение ASP.NETMVC управления потоком взаимодействия с пользователем.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-268">ASP.NETMVC application control the flow of user interaction.</span></span> <span data-ttu-id="ea4b2-269">При тестировании контроллер, необходимо проверить ли контроллер возвращает правой действие результат и представления данных.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-269">When testing a controller, you want to test whether the controller returns the right action result and view data.</span></span> <span data-ttu-id="ea4b2-270">Также может потребоваться проверить, является ли контроллер взаимодействует с классами модели так, как ожидалось.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-270">You also might want to test whether a controller interacts with model classes in the manner expected.</span></span>

<span data-ttu-id="ea4b2-271">Например список 2 содержит два модульных теста для контроллера контакт Create() метод.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-271">For example, Listing 2 contains two unit tests for the Contact controller Create() method.</span></span> <span data-ttu-id="ea4b2-272">Первый модульный тест проверяет, что при допустимый контакт передается методу Create(), а затем метод Create() перенаправляет действие индекса.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-272">The first unit test verifies that when a valid Contact is passed to the Create() method then the Create() method redirects to the Index action.</span></span> <span data-ttu-id="ea4b2-273">Другими словами Если передать допустимый контакт, Create() метод должен вернуть RedirectToRouteResult, который представляет действие индекса.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-273">In other words, when passed a valid Contact, the Create() method should return a RedirectToRouteResult that represents the Index action.</span></span>

<span data-ttu-id="ea4b2-274">Мы не хотите t требуется протестировать ContactManager уровень службы, когда мы тестируем слоя контроллера.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-274">We don t want to test the ContactManager service layer when we are testing the controller layer.</span></span> <span data-ttu-id="ea4b2-275">Таким образом мы макета уровень службы на следующий код в методе Initialize:</span><span class="sxs-lookup"><span data-stu-id="ea4b2-275">Therefore, we mock the service layer with the following code in the Initialize method:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample3.cs)]

<span data-ttu-id="ea4b2-276">В модульном тесте CreateValidContact() мы макета поведение вызывающих уровень службы CreateContact() метод следующий код:</span><span class="sxs-lookup"><span data-stu-id="ea4b2-276">In the CreateValidContact() unit test, we mock the behavior of calling the service layer CreateContact() method with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample4.cs)]

<span data-ttu-id="ea4b2-277">Эта строка кода приводит к макетов служба ContactManager возвращают значение true при вызове его метода CreateContact().</span><span class="sxs-lookup"><span data-stu-id="ea4b2-277">This line of code causes the mock ContactManager service to return the value true when its CreateContact() method is called.</span></span> <span data-ttu-id="ea4b2-278">Путем имитации уровень службы, можно проверить поведение нашей контроллера без необходимости выполнения любого кода в уровне службы.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-278">By mocking the service layer, we can test the behavior of our controller without needing to execute any code in the service layer.</span></span>

<span data-ttu-id="ea4b2-279">Второй модульный тест проверяет, что действие Create() возвращает представления создания, если методу передается недопустимый контакт.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-279">The second unit test verifies that the Create() action returns the Create view when an invalid contact is passed to the method.</span></span> <span data-ttu-id="ea4b2-280">Мы возникновение уровень службы CreateContact() метода, возвращающего значение false с следующую строку кода:</span><span class="sxs-lookup"><span data-stu-id="ea4b2-280">We cause the service layer CreateContact() method to return the value false with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample5.cs)]

<span data-ttu-id="ea4b2-281">Если метод Create() работает как ожидается, затем он должен возвращать представления создания при уровень службы возвращает значение false.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-281">If the Create() method behaves as we expect then it should return the Create view when the service layer returns the value false.</span></span> <span data-ttu-id="ea4b2-282">В этом случае контроллер может отобразить сообщения об ошибках проверки в режиме создания, и у пользователя есть исправить, недопустимые свойства контакта.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-282">That way, the controller can display the validation error messages in the Create view and the user has a chance to correct that invalid Contact properties.</span></span>


<span data-ttu-id="ea4b2-283">Если вы планируете создать модульные тесты для контроллеров необходимо возвращать имена явное представление из действий контроллера.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-283">If you plan to build unit tests for your controllers then you need to return explicit view names from your controller actions.</span></span> <span data-ttu-id="ea4b2-284">Например не получить следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ea4b2-284">For example, do not return a view like this:</span></span>

<span data-ttu-id="ea4b2-285">Возвращает View();</span><span class="sxs-lookup"><span data-stu-id="ea4b2-285">return View();</span></span>

<span data-ttu-id="ea4b2-286">Вместо этого получить следующим образом:</span><span class="sxs-lookup"><span data-stu-id="ea4b2-286">Instead, return the view like this:</span></span>

<span data-ttu-id="ea4b2-287">Возвращает View("Create");</span><span class="sxs-lookup"><span data-stu-id="ea4b2-287">return View("Create");</span></span>

<span data-ttu-id="ea4b2-288">При отсутствии явной при возврате представление ViewResult.ViewName свойство возвращает пустую строку.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-288">If you are not explicit when returning a view then the ViewResult.ViewName property returns an empty string.</span></span>


<span data-ttu-id="ea4b2-289">**Листинг 2 - Controllers\ContactControllerTest.cs**</span><span class="sxs-lookup"><span data-stu-id="ea4b2-289">**Listing 2 - Controllers\ContactControllerTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample6.cs)]

## <a name="summary"></a><span data-ttu-id="ea4b2-290">Сводка</span><span class="sxs-lookup"><span data-stu-id="ea4b2-290">Summary</span></span>

<span data-ttu-id="ea4b2-291">В этой итерации мы создали модульных тестов для нашего приложения диспетчера контактов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-291">In this iteration, we created unit tests for our Contact Manager application.</span></span> <span data-ttu-id="ea4b2-292">Мы эти модульные тесты можно выполнять в любое время, чтобы убедиться, что приложение по-прежнему работает так, которую мы предполагаем.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-292">We can run these unit tests at any time to verify that our application still behaves in the manner that we expect.</span></span> <span data-ttu-id="ea4b2-293">Модульные тесты действуют как средство подстраховки, если для приложения позволяет нам безопасно изменить нашего приложения в будущем.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-293">The unit tests act as a safety net for our application enabling us to safely modify our application in the future.</span></span>

<span data-ttu-id="ea4b2-294">Мы создали два набора модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-294">We created two sets of unit tests.</span></span> <span data-ttu-id="ea4b2-295">Во-первых мы протестировали логику проверки путем создания модульных тестов для наших уровня службы.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-295">First, we tested our validation logic by creating unit tests for our service layer.</span></span> <span data-ttu-id="ea4b2-296">Далее мы протестировали логику потока управления путем создания модульных тестов для наших слоя контроллера.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-296">Next, we tested our flow control logic by creating unit tests for our controller layer.</span></span> <span data-ttu-id="ea4b2-297">При тестировании наш уровень службы, мы изолируются наши тесты для нашей службы слоя из наших уровня репозитория имитации нашей уровня репозитория.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-297">When testing our service layer, we isolated our tests for our service layer from our repository layer by mocking our repository layer.</span></span> <span data-ttu-id="ea4b2-298">При тестировании на уровне контроллера, мы изолируются наши тесты для наших слоя контроллера имитации уровня службы.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-298">When testing the controller layer, we isolated our tests for our controller layer by mocking the service layer.</span></span>

<span data-ttu-id="ea4b2-299">В следующей итерации мы изменить приложение диспетчера контактов, чтобы он поддерживал группы контактов.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-299">In the next iteration, we modify the Contact Manager application so that it supports Contact Groups.</span></span> <span data-ttu-id="ea4b2-300">Мы добавим эти новые командлеты для нашего приложения с помощью процесса разработки программного обеспечения, называемого управляемой тестами разработки.</span><span class="sxs-lookup"><span data-stu-id="ea4b2-300">We'll add this new functionality to our application using a software design process called test-driven development.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="ea4b2-301">[Назад](iteration-4-make-the-application-loosely-coupled-cs.md)
> [Вперед](iteration-6-use-test-driven-development-cs.md)</span><span class="sxs-lookup"><span data-stu-id="ea4b2-301">[Previous](iteration-4-make-the-application-loosely-coupled-cs.md)
[Next](iteration-6-use-test-driven-development-cs.md)</span></span>
