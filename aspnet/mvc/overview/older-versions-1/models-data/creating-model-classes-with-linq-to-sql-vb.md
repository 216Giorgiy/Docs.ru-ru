---
uid: mvc/overview/older-versions-1/models-data/creating-model-classes-with-linq-to-sql-vb
title: "Создание классов модели с помощью LINQ to SQL (Visual Basic) | Документы Microsoft"
author: microsoft
description: "Целью данного учебника является объясните, один из способов создания классов модели для приложения ASP.NET MVC. В этом учебнике вы узнаете, как для построения модели c..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/07/2008
ms.topic: article
ms.assetid: a4a25a75-d71f-4509-98b4-df72e748985a
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/models-data/creating-model-classes-with-linq-to-sql-vb
msc.type: authoredcontent
ms.openlocfilehash: 972d5b11049825e84e070ef1c4b2b90116654397
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="creating-model-classes-with-linq-to-sql-vb"></a>Создание классов модели с помощью LINQ to SQL (Visual Basic)
====================
по [Microsoft](https://github.com/microsoft)

[Скачать PDF](http://download.microsoft.com/download/1/1/f/11f721aa-d749-4ed7-bb89-a681b68894e6/ASPNET_MVC_Tutorial_10_VB.pdf)

> Целью данного учебника является объясните, один из способов создания классов модели для приложения ASP.NET MVC. В этом учебнике вы научитесь создавать классы модели и выполнять доступ к базе данных, используя преимущества Microsoft LINQ to SQL.


Целью данного учебника является объясните, один из способов создания классов модели для приложения ASP.NET MVC. В этом учебнике вы научитесь создавать классы модели и выполнять доступ к базе данных, используя преимущества Microsoft LINQ to SQL.

В этом учебнике мы создаем простое приложение фильма базы данных. Мы начнем с создания приложения базы данных фильма в быстрым и простым способом невозможно. Все наши доступа к данным выполнять непосредственно из наших действий контроллера.

Далее вы узнаете, как использовать шаблон репозитория. Чтобы использовать шаблон репозитория требуется немного больше работы. Однако преимуществом внедрение этот шаблон является позволяет создавать приложения, которые могут настраиваться для изменения и можно легко проверить.

## <a name="what-is-a-model-class"></a>Что такое класс модели?

Модель MVC содержит все логики приложения, которая не содержится в представлении MVC или контроллера MVC. В частности модель MVC содержит все приложения бизнес-процессов и логики доступа к данным.

Можно использовать множество различных технологий для реализации логики доступа к данным. Например можно построить вашей классов доступа к данным с помощью классов Microsoft Entity Framework, NHibernate, Subsonic или ADO.NET.

В этом учебнике. я использую LINQ to SQL для запроса и обновления базы данных. LINQ to SQL обеспечивает очень простой метод взаимодействия с базой данных Microsoft SQL Server. Тем не менее важно понимать, что платформа ASP.NET MVC не привязан к LINQ to SQL каким-либо образом. ASP.NET MVC совместим с любой технологии доступа к данным.

## <a name="create-a-movie-database"></a>Создание базы данных фильма

В этом учебнике, чтобы продемонстрировать, как создать классы модели — мы создать простое приложение фильма базы данных. Первым шагом является создание новой базы данных. Щелкните правой кнопкой мыши приложение\_папки данных в окне обозревателя решений и выберите пункт меню **добавить, новый элемент**. Выберите шаблон базы данных SQL Server, присвойте ему имя MoviesDB.mdf и нажмите кнопку **добавить** кнопку (см. рис. 1).


[![Добавление новой базы данных SQL Server](creating-model-classes-with-linq-to-sql-vb/_static/image2.png)](creating-model-classes-with-linq-to-sql-vb/_static/image1.png)

**На рисунке 01**: Добавление новой базы данных SQL Server ([Просмотр полноразмерное изображение](creating-model-classes-with-linq-to-sql-vb/_static/image3.png))


После создания новой базы данных, можно открыть базу данных, дважды щелкнув файл MoviesDB.mdf в приложении\_папки данных. Дважды щелкните файл MoviesDB.mdf открыть окно обозревателя серверов (см. рис. 2).

|  | Окно обозревателя серверов называется окно обозревателя базы данных при использовании Visual Web Developer. |
| --- | --- |


[![С помощью окна обозревателя серверов](creating-model-classes-with-linq-to-sql-vb/_static/image5.png)](creating-model-classes-with-linq-to-sql-vb/_static/image4.png)

**На рисунке 02**: с помощью окна обозревателя серверов ([Просмотр полноразмерное изображение](creating-model-classes-with-linq-to-sql-vb/_static/image6.png))


Нам нужно добавить одной таблицы в базе данных, представляющий нашей фильмов. Щелкните правой кнопкой мыши папку «таблицы» и выберите пункт меню в **добавить новую таблицу**. При выборе этого параметра меню открывается в конструкторе таблиц (см. рис. 3).


[![С помощью окна обозревателя серверов](creating-model-classes-with-linq-to-sql-vb/_static/image8.png)](creating-model-classes-with-linq-to-sql-vb/_static/image7.png)

**На рисунке 03**: конструктора таблиц ([Просмотр полноразмерное изображение](creating-model-classes-with-linq-to-sql-vb/_static/image9.png))


Необходимо добавить следующие столбцы в таблице базы данных:

| **Имя столбца** | **Тип данных** | **Разрешить значения NULL** |
| --- | --- | --- |
| Идентификатор | Int | False |
| Заголовок | Nvarchar(200) | False |
| Директор | nvarchar(50) | False |

Необходимо выполнить два специальных действия со столбцом идентификаторов. Во-первых необходимо пометить столбец идентификатора как столбец первичного ключа, выбрав столбец в конструкторе таблиц и щелкнув значок ключа. LINQ to SQL требует указания первичного ключа, при выполнении вставляет или обновляет в базе данных.

Далее необходимо пометить как столбец идентификаторов со столбцом идентификаторов, назначив значение Да **Is Identity** свойство (см. рис. 3). Столбец идентификаторов является столбец, который будет назначен новый номер автоматически каждый раз при добавлении новой строки данных в таблицу.

После внесения этих изменений, сохраните таблицу с именем tblMovie. Таблицу можно сохранить, нажав кнопку "Сохранить".

## <a name="create-linq-to-sql-classes"></a>Создание классов LINQ to SQL

Нашей модели MVC будет содержать LINQ для классов SQL, представляющие tblMovie таблицу базы данных. Самым простым способом создания этих классов LINQ to SQL — щелкните правой кнопкой мыши папку Models, выберите **добавить, новый элемент**выберите LINQ to SQL Classes шаблона, присвойте имя Movie.dbml классы и нажмите кнопку **добавить**кнопку (см. рис. 4).


[![Создание LINQ для классов SQL](creating-model-classes-with-linq-to-sql-vb/_static/image11.png)](creating-model-classes-with-linq-to-sql-vb/_static/image10.png)

**На рисунке 04**: создание классов LINQ to SQL ([Просмотр полноразмерное изображение](creating-model-classes-with-linq-to-sql-vb/_static/image12.png))


Сразу после создания фильма LINQ to SQL Classes откроется реляционный конструктор объектов. Таблицы базы данных можно перетаскивать из окна обозревателя серверов в реляционный конструктор объектов для создания классов LINQ to SQL, представляют таблицы для конкретной базы данных. Необходимо добавить таблицы базы данных tblMovie на реляционный конструктор объектов (см. рис. 4).


[![С помощью реляционного конструктора объектов](creating-model-classes-with-linq-to-sql-vb/_static/image14.png)](creating-model-classes-with-linq-to-sql-vb/_static/image13.png)

**На рисунке 05**: с помощью реляционного конструктора объектов ([Просмотр полноразмерное изображение](creating-model-classes-with-linq-to-sql-vb/_static/image15.png))


По умолчанию в реляционный конструктор объектов создает класс с очень совпадает с именем таблицы базы данных, перетащите в конструктор. Тем не менее мы не хотим вызовите нашей tblMovie класса. Таким образом щелкните имя класса в конструкторе и измените имя класса для фильмов.

Наконец, не забудьте выбрать **Сохранить** кнопку Сохранить LINQ to SQL Classes (изображением дискеты). В противном случае LINQ to SQL Classes не быть создан в реляционный конструктор объектов.

## <a name="using-linq-to-sql-in-a-controller-action"></a>С помощью LINQ to SQL в действие контроллера

Теперь, когда у нас есть наших классов LINQ to SQL, эти классы можно использовать для получения данных из базы данных. В этом разделе вы узнаете, как использовать LINQ для классов SQL непосредственно внутри действия контроллера. Мы будем отобразить список фильмов tblMovies таблицы базы данных в представлении MVC.

Во-первых необходимо изменить класс HomeController. Этот класс можно найти в папке Controllers находится приложения. Измените класс, чтобы она выглядела как класс в список 1.

**Листинг 1.`Controllers\HomeController.vb`**

[!code-vb[Main](creating-model-classes-with-linq-to-sql-vb/samples/sample1.vb)]

Для представления базы данных MoviesDB Index() действие в список 1 используется LINQ to SQL DataContext класса (MovieDataContext). Класс MoveDataContext был создан Visual Studio реляционный конструктор объектов.

Запрос LINQ выполняется для DataContext для извлечения всех фильмы tblMovies таблицы базы данных. Список фильмов назначается локальную переменную с именем фильмов. Наконец список фильмов передается в представление данных в представлении.

Чтобы можно было отобразить фильмы, далее, необходимо изменить представление индекса. Представление индекса можно найти в папке Views\Home\. Обновите представление индекса, чтобы он выглядел представление в списке 2.

**Листинг 2.`Views\Home\Index.aspx`**

[!code-aspx[Main](creating-model-classes-with-linq-to-sql-vb/samples/sample2.aspx)]

Обратите внимание, что измененный представление индекса включает &lt;% @ импортировать пространство имен %&gt; директив в верхней части представления. Эта директива импортирует пространство имен MvcApplication1. Это пространство имен необходимо для работы с классами модели — в частности, класс фильма--в представлении.

Представление в списке 2 содержит For каждого цикла итерации всех элементов, представленный свойством ViewData.Model. Значение свойства заголовок отображается для каждого фильма.

Обратите внимание, что значение свойства ViewData.Model приведен в объект IEnumerable. Это необходимо, чтобы перебрать содержимое ViewData.Model. Здесь другой вариант — Создать строго типизированное представление. При создании строго типизированное представление в представление кода класса приведение ViewData.Model свойства для конкретного типа.

При запуске приложения после внесения изменений в класс HomeController и представление индекса вы получите пустую страницу. Вы получите пустую страницу, так как нет фильма записей в таблице базы данных tblMovies.

Для добавления записей в таблицу tblMovies базы данных, щелкните правой кнопкой мыши tblMovies таблицы базы данных в окне обозревателя сервера (в окне обозревателя базы данных в Visual Web Developer) и выбрать пункт меню **Показать таблицу данных**. Для вставки записей фильма в этой сетке отображается (см. рис. 5).


[![Вставка фильмов](creating-model-classes-with-linq-to-sql-vb/_static/image17.png)](creating-model-classes-with-linq-to-sql-vb/_static/image16.png)

**На рисунке 06**: вставка фильмов ([Просмотр полноразмерное изображение](creating-model-classes-with-linq-to-sql-vb/_static/image18.png))


После добавления некоторых записей базы данных в таблицу tblMovies и запустите приложение, вы увидите страницу на рис. 7. Отображаются все записи фильма базы данных в виде маркированного списка.


[![Отображение фильмов в представлении индекса](creating-model-classes-with-linq-to-sql-vb/_static/image20.png)](creating-model-classes-with-linq-to-sql-vb/_static/image19.png)

**На рисунке 07**: отображение фильмов с представлением индекса ([Просмотр полноразмерное изображение](creating-model-classes-with-linq-to-sql-vb/_static/image21.png))


## <a name="using-the-repository-pattern"></a>Чтобы использовать шаблон репозитория

В предыдущем разделе мы использовали LINQ для классов SQL непосредственно внутри действия контроллера. Мы использовали класс MovieDataContext непосредственно из Index() действия контроллера. Нет ничего плохого таким образом, в случае простого приложения. Однако для работы с LINQ to SQL напрямую в классе контроллера создает проблемы при необходимы для создания более сложных приложений.

С помощью LINQ to SQL в класс контроллера затрудняет переключение технологии доступа к данным в будущем. Например вы можете переключиться с Microsoft LINQ to SQL с помощью платформы Entity Framework Microsoft как к технологии доступа к данным. В этом случае необходимо переписать каждый контроллер, который обращается к базе данных в приложении.

С помощью LINQ to SQL в класс контроллера также усложняет задачу создания модульных тестов для приложения. Как правило не требуется взаимодействие с базой данных при выполнении модульных тестов. Вы хотите использовать модульных тестов для тестирования логики приложения и не сервере базы данных.

Для создания приложения MVC более настраиваться для будущих изменений и, можно легко проверить, следует использовать шаблон репозитория. Если используется шаблон репозитория, создания репозитория отдельный класс, содержащий все логики доступа к базе данных.

При создании класса репозитория, создается интерфейс, представляющий все методы, используемые классом репозитория. В контроллерах писать код с интерфейсом, а не в репозитории. Таким образом, можно реализовать репозитория, в будущем с помощью технологии доступа к данным в другой.

Интерфейс в списке 3 называется IMovieRepository и представляет один метод с именем ListAll().

**Листинг 3.`Models\IMovieRepository.vb`**

[!code-vb[Main](creating-model-classes-with-linq-to-sql-vb/samples/sample3.vb)]

Класс репозитория в листинге 4 реализует интерфейс IMovieRepository. Обратите внимание, что он содержит метод с именем соответствующего метода, объявленного в интерфейсе IMovieRepository ListAll().

**Листинг 4.`Models\MovieRepository.vb`**

[!code-vb[Main](creating-model-classes-with-linq-to-sql-vb/samples/sample4.vb)]

Наконец класс MoviesController в листинге 5 использует шаблон репозитория. Больше не используются LINQ для классов SQL непосредственно.

**Листинг 5.`Controllers\MoviesController.vb`**

[!code-vb[Main](creating-model-classes-with-linq-to-sql-vb/samples/sample5.vb)]

Обратите внимание, что класс MoviesController в листинге 5 имеет два конструктора. Первый конструктор конструктор без параметров, вызывается, когда приложение запущено. Этот конструктор создает экземпляр класса MovieRepository и передает его второй конструктор.

Второй конструктор принимает один параметр: параметр IMovieRepository. Этот конструктор просто присваивается значение параметра поле уровня класса с именем \_репозитория.

Класс MoviesController имеет преимущества программного обеспечения шаблон, который называется шаблон внедрения зависимостей. В частности она использует так называемые конструктор внедрения зависимостей. Можно прочитать подробнее об этой модели, считывая в следующей статье по Martin Fowler:

[http://martinfowler.com/articles/injection.HTML](http://martinfowler.com/articles/injection.html)

Обратите внимание, что весь код в классе MoviesController (за исключением первый конструктор) взаимодействует с интерфейс IMovieRepository вместо фактического MovieRepository класса. Код взаимодействует с абстрактный интерфейс вместо конкретную реализацию интерфейса.

Если вы хотите изменить технологии доступа к данным, используемые приложением можно просто реализовать интерфейс IMovieRepository с классом, который использует технологии доступа к альтернативной базы данных. Например можно создать класс EntityFrameworkMovieRepository или SubSonicMovieRepository класса. Поскольку класс контроллера запрограммированы в интерфейсе, можно передать новую реализацию IMovieRepository класс контроллера и класса будет продолжать работать.

Кроме того Если вы хотите протестировать класс MoviesController, можно передать класс фиктивное фильма репозитория для MoviesController. Можно реализовать класс IMovieRepository с классом, который содержит все необходимые методы интерфейса IMovieRepository, но не осуществляет доступ к фактически базы данных. Таким образом, вы можете модульного теста MoviesController класса без фактически обращения к реальной базы данных.

## <a name="summary"></a>Сводка

Целью данного учебника было показано, как создать классы модели MVC, используя преимущества Microsoft LINQ to SQL. Мы рассмотрели две стратегии для отображения данных базы данных в приложении ASP.NET MVC. Во-первых мы создаются LINQ для классов SQL и используются классы непосредственно внутри действия контроллера. Использование LINQ для классов SQL в контроллер позволяет быстро и легко увидеть базы данных в приложении MVC.

Далее мы изучена немного сложнее, но определенно более эффективный путь для отображения данных базы данных. Мы воспользовался шаблон репозитория и разместить все наши логики доступа к базе данных в классе отдельные репозитория. В нашем контроллера мы писали все наши кода по интерфейс вместо конкретного класса. Преимуществом шаблон репозитория является, что позволяет легко изменять технологий доступа к базе данных в будущем, и позволяет легко тестировать наших классов контроллеров.

>[!div class="step-by-step"]
[Назад](creating-model-classes-with-the-entity-framework-vb.md)
[Вперед](displaying-a-table-of-database-data-vb.md)
