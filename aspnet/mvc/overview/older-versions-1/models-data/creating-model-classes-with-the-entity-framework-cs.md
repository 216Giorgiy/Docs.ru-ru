---
uid: mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-cs
title: "Создание классов модели с платформой Entity Framework (C#) | Документы Microsoft"
author: microsoft
description: "В этом учебнике вы узнаете, как использовать ASP.NET MVC с платформой Entity Framework корпорации Майкрософт. Вы научитесь использовать мастер для создания сущности ADO.NET Da..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/27/2009
ms.topic: article
ms.assetid: 61644169-e8b1-45dd-bf96-9c2301b69879
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-cs
msc.type: authoredcontent
ms.openlocfilehash: 8a897f671de73d9991189e32a5d86b513051ef05
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="creating-model-classes-with-the-entity-framework-c"></a><span data-ttu-id="dc244-104">Создание классов модели с платформой Entity Framework (C#)</span><span class="sxs-lookup"><span data-stu-id="dc244-104">Creating Model Classes with the Entity Framework (C#)</span></span>
====================
<span data-ttu-id="dc244-105">по [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="dc244-105">by [Microsoft](https://github.com/microsoft)</span></span>

> <span data-ttu-id="dc244-106">В этом учебнике вы узнаете, как использовать ASP.NET MVC с платформой Entity Framework корпорации Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="dc244-106">In this tutorial, you learn how to use ASP.NET MVC with the Microsoft Entity Framework.</span></span> <span data-ttu-id="dc244-107">Вы узнаете, как использовать мастер для создания модели EDM ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="dc244-107">You learn how to use the Entity Wizard to create an ADO.NET Entity Data Model.</span></span> <span data-ttu-id="dc244-108">В ходе этого учебника мы создаем веб-приложения, демонстрирующий выбора, вставки, обновления и удаления базы данных с помощью платформы Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="dc244-108">Over the course of this tutorial, we build a web application that illustrates how to select, insert, update, and delete database data by using the Entity Framework.</span></span>


<span data-ttu-id="dc244-109">Целью данного учебника является объясняется, как можно создать классы для доступа к данным с помощью платформы Entity Framework корпорации Майкрософт, при создании приложения ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="dc244-109">The goal of this tutorial is to explain how you can create data access classes using the Microsoft Entity Framework when building an ASP.NET MVC application.</span></span> <span data-ttu-id="dc244-110">В учебнике предполагается без знания платформы Entity Framework корпорации Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="dc244-110">This tutorial assumes no previous knowledge of the Microsoft Entity Framework.</span></span> <span data-ttu-id="dc244-111">В конце этого учебника будет понять, как использовать платформу Entity Framework для выбора, вставки, обновления и удаления записей базы данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-111">By the end of this tutorial, you'll understand how to use the Entity Framework to select, insert, update, and delete database records.</span></span>

<span data-ttu-id="dc244-112">Microsoft Entity Framework является средство объекта реляционного сопоставления (O/надежный обмен Сообщениями), которое позволяет автоматически создавать слой доступа к данным из базы данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-112">The Microsoft Entity Framework is an Object Relational Mapping (O/RM) tool that enables you to generate a data access layer from a database automatically.</span></span> <span data-ttu-id="dc244-113">Платформа Entity Framework позволяет избежать трудоемкой работы построения классов доступа данных вручную.</span><span class="sxs-lookup"><span data-stu-id="dc244-113">The Entity Framework enables you to avoid the tedious work of building your data access classes by hand.</span></span>

<span data-ttu-id="dc244-114">Чтобы продемонстрировать, как можно использовать Microsoft Entity Framework с ASP.NET MVC, мы создадим простой пример приложения.</span><span class="sxs-lookup"><span data-stu-id="dc244-114">In order to illustrate how you can use the Microsoft Entity Framework with ASP.NET MVC, we'll build a simple sample application.</span></span> <span data-ttu-id="dc244-115">Мы создадим приложение фильма базы данных, позволяет отображать и изменять записи фильма базы данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-115">We'll create a Movie Database application that enables you to display and edit movie database records.</span></span>

<span data-ttu-id="dc244-116">Этот учебник предполагается, что Visual Studio 2008 или Visual Web Developer 2008 с пакетом обновления 1.</span><span class="sxs-lookup"><span data-stu-id="dc244-116">This tutorial assumes that you have Visual Studio 2008 or Visual Web Developer 2008 with Service Pack 1.</span></span> <span data-ttu-id="dc244-117">Требуется пакет обновления 1 для использования платформы Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="dc244-117">You need Service Pack 1 in order to use the Entity Framework.</span></span> <span data-ttu-id="dc244-118">Пакет обновления 1 для Visual Studio 2008 или Visual Web Developer с пакетом обновления 1 можно загрузить из следующий адрес:</span><span class="sxs-lookup"><span data-stu-id="dc244-118">You can download Visual Studio 2008 Service Pack 1 or Visual Web Developer with Service Pack 1 from the following address:</span></span>

> [<span data-ttu-id="dc244-119">https://www.ASP.NET/downloads/</span><span class="sxs-lookup"><span data-stu-id="dc244-119">https://www.asp.net/downloads/</span></span>](https://www.asp.net/downloads)


> [!NOTE] 
> 
> <span data-ttu-id="dc244-120">Отсутствует essential подключение между ASP.NET MVC и Entity Framework корпорации Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="dc244-120">There is no essential connection between ASP.NET MVC and the Microsoft Entity Framework.</span></span> <span data-ttu-id="dc244-121">Существует несколько альтернатив на платформу Entity Framework, который можно использовать с ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="dc244-121">There are several alternatives to the Entity Framework that you can use with ASP.NET MVC.</span></span> <span data-ttu-id="dc244-122">Например можно построить с помощью других средствах O/надежный обмен Сообщениями, таких как Microsoft LINQ to SQL, SubSonic и NHibernate классами модели MVC.</span><span class="sxs-lookup"><span data-stu-id="dc244-122">For example, you can build your MVC Model classes using other O/RM tools such as Microsoft LINQ to SQL, NHibernate, or SubSonic.</span></span>


## <a name="creating-the-movie-sample-database"></a><span data-ttu-id="dc244-123">Создание образца базы данных фильма</span><span class="sxs-lookup"><span data-stu-id="dc244-123">Creating the Movie Sample Database</span></span>

<span data-ttu-id="dc244-124">Приложение фильма базы данных использует таблицу базы данных с именем фильмы, содержит следующие столбцы:</span><span class="sxs-lookup"><span data-stu-id="dc244-124">The Movie Database application uses a database table named Movies that contains the following columns:</span></span>

| <span data-ttu-id="dc244-125">Имя столбца</span><span class="sxs-lookup"><span data-stu-id="dc244-125">Column Name</span></span> | <span data-ttu-id="dc244-126">Тип данных</span><span class="sxs-lookup"><span data-stu-id="dc244-126">Data Type</span></span> | <span data-ttu-id="dc244-127">Разрешить значения NULL?</span><span class="sxs-lookup"><span data-stu-id="dc244-127">Allow Nulls?</span></span> | <span data-ttu-id="dc244-128">Является первичным ключом?</span><span class="sxs-lookup"><span data-stu-id="dc244-128">Is Primary Key?</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="dc244-129">Идентификатор</span><span class="sxs-lookup"><span data-stu-id="dc244-129">Id</span></span> | <span data-ttu-id="dc244-130">int</span><span class="sxs-lookup"><span data-stu-id="dc244-130">int</span></span> | <span data-ttu-id="dc244-131">False</span><span class="sxs-lookup"><span data-stu-id="dc244-131">False</span></span> | <span data-ttu-id="dc244-132">True</span><span class="sxs-lookup"><span data-stu-id="dc244-132">True</span></span> |
| <span data-ttu-id="dc244-133">Заголовок</span><span class="sxs-lookup"><span data-stu-id="dc244-133">Title</span></span> | <span data-ttu-id="dc244-134">Nvarchar(100)</span><span class="sxs-lookup"><span data-stu-id="dc244-134">nvarchar(100)</span></span> | <span data-ttu-id="dc244-135">False</span><span class="sxs-lookup"><span data-stu-id="dc244-135">False</span></span> | <span data-ttu-id="dc244-136">False</span><span class="sxs-lookup"><span data-stu-id="dc244-136">False</span></span> |
| <span data-ttu-id="dc244-137">Директор</span><span class="sxs-lookup"><span data-stu-id="dc244-137">Director</span></span> | <span data-ttu-id="dc244-138">Nvarchar(100)</span><span class="sxs-lookup"><span data-stu-id="dc244-138">nvarchar(100)</span></span> | <span data-ttu-id="dc244-139">False</span><span class="sxs-lookup"><span data-stu-id="dc244-139">False</span></span> | <span data-ttu-id="dc244-140">False</span><span class="sxs-lookup"><span data-stu-id="dc244-140">False</span></span> |

<span data-ttu-id="dc244-141">В этой таблице можно добавить в проект ASP.NET MVC, выполните следующие действия:</span><span class="sxs-lookup"><span data-stu-id="dc244-141">You can add this table to an ASP.NET MVC project by following these steps:</span></span>

1. <span data-ttu-id="dc244-142">Щелкните правой кнопкой мыши приложение\_папки данных в окне обозревателя решений и выберите пункт меню **добавить, новый элемент.**</span><span class="sxs-lookup"><span data-stu-id="dc244-142">Right-click the App\_Data folder in the Solution Explorer window and select the menu option **Add, New Item.**</span></span>
2. <span data-ttu-id="dc244-143">Из **Добавление нового элемента** выберите **базы данных SQL Server**, введите имя MoviesDB.mdf базы данных и нажмите кнопку **добавить** кнопки.</span><span class="sxs-lookup"><span data-stu-id="dc244-143">From the **Add New Item** dialog box, select **SQL Server Database**, give the database the name MoviesDB.mdf, and click the **Add** button.</span></span>
3. <span data-ttu-id="dc244-144">Дважды щелкните файл MoviesDB.mdf, чтобы открыть окно обозревателя базы данных обозревателя серверов.</span><span class="sxs-lookup"><span data-stu-id="dc244-144">Double-click the MoviesDB.mdf file to open the Server Explorer/Database Explorer window.</span></span>
4. <span data-ttu-id="dc244-145">Разверните подключение к базе данных MoviesDB.mdf, щелкните правой кнопкой мыши папку «таблицы» и выберите пункт меню **добавить новую таблицу**.</span><span class="sxs-lookup"><span data-stu-id="dc244-145">Expand the MoviesDB.mdf database connection, right-click the Tables folder, and select the menu option **Add New Table**.</span></span>
5. <span data-ttu-id="dc244-146">В конструкторе таблиц добавьте столбцы Id, Title и директора.</span><span class="sxs-lookup"><span data-stu-id="dc244-146">In the Table Designer, add the Id, Title, and Director columns.</span></span>
6. <span data-ttu-id="dc244-147">Нажмите кнопку **Сохранить** (он имеет значок дискеты) кнопка Сохранить новую таблицу с именем фильмов.</span><span class="sxs-lookup"><span data-stu-id="dc244-147">Click the **Save** button (it has the icon of the floppy) to save the new table with the name Movies.</span></span>

<span data-ttu-id="dc244-148">После создания таблицы базы данных фильмы, следует добавить некоторые демонстрационные данные в таблицу.</span><span class="sxs-lookup"><span data-stu-id="dc244-148">After you create the Movies database table, you should add some sample data to the table.</span></span> <span data-ttu-id="dc244-149">Щелкните правой кнопкой мыши таблицу фильмы и выбрать пункт меню **Показать таблицу данных**.</span><span class="sxs-lookup"><span data-stu-id="dc244-149">Right-click the Movies table and select the menu option **Show Table Data**.</span></span> <span data-ttu-id="dc244-150">Можно ввести данные фиктивное фильмов в появившейся сетке.</span><span class="sxs-lookup"><span data-stu-id="dc244-150">You can enter fake movie data into the grid that appears.</span></span>

## <a name="creating-the-adonet-entity-data-model"></a><span data-ttu-id="dc244-151">Создание модели EDM ADO.NET</span><span class="sxs-lookup"><span data-stu-id="dc244-151">Creating the ADO.NET Entity Data Model</span></span>

<span data-ttu-id="dc244-152">Для использования платформы Entity Framework, необходимо создать модель EDM.</span><span class="sxs-lookup"><span data-stu-id="dc244-152">In order to use the Entity Framework, you need to create an Entity Data Model.</span></span> <span data-ttu-id="dc244-153">Вы можете воспользоваться преимуществами Visual Studio *мастер моделей EDM* для автоматического создания модели EDM из базы данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-153">You can take advantage of the Visual Studio *Entity Data Model Wizard* to generate an Entity Data Model from a database automatically.</span></span>

<span data-ttu-id="dc244-154">Выполните следующие действия.</span><span class="sxs-lookup"><span data-stu-id="dc244-154">Follow these steps:</span></span>

1. <span data-ttu-id="dc244-155">Щелкните правой кнопкой мыши папку модели в окне обозревателя решений и выбрать пункт меню **добавить, новый элемент**.</span><span class="sxs-lookup"><span data-stu-id="dc244-155">Right-click the Models folder in the Solution Explorer window and select the menu option **Add, New Item**.</span></span>
2. <span data-ttu-id="dc244-156">В **Добавление нового элемента** диалоговое окно, выберите категорию данных (см. рис. 1).</span><span class="sxs-lookup"><span data-stu-id="dc244-156">In the **Add New Item** dialog, select the Data category (see Figure 1).</span></span>
3. <span data-ttu-id="dc244-157">Выберите **ADO.NET Entity Data Model** шаблона, присвойте имя MoviesDBModel.edmx модели EDM и нажмите кнопку **добавить** кнопки.</span><span class="sxs-lookup"><span data-stu-id="dc244-157">Select the **ADO.NET Entity Data Model** template, give the Entity Data Model the name MoviesDBModel.edmx, and click the **Add** button.</span></span> <span data-ttu-id="dc244-158">Щелкнув **добавить** кнопка запускает мастер модели данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-158">Clicking the **Add** button launches the Data Model Wizard.</span></span>
4. <span data-ttu-id="dc244-159">В **Выбор содержимого модели** действии, выберите **создать из базы данных** и нажмите кнопку **Далее** кнопку (см. рис. 2).</span><span class="sxs-lookup"><span data-stu-id="dc244-159">In the **Choose Model Contents** step, choose the **Generate from a database** option and click the **Next** button (see Figure 2).</span></span>
5. <span data-ttu-id="dc244-160">В **Выбор подключения к данным** шаг, выберите подключение к базе данных MoviesDB.mdf, введите объекты имя MoviesDBEntities параметры подключения и нажмите кнопку **Далее** кнопку (см. рис. 3).</span><span class="sxs-lookup"><span data-stu-id="dc244-160">In the **Choose Your Data Connection** step, select the MoviesDB.mdf database connection, enter the entities connection settings name MoviesDBEntities, and click the **Next** button (see Figure 3).</span></span>
6. <span data-ttu-id="dc244-161">В **Выбор объектов базы данных** шагов, выберите в таблице базы данных фильма и нажмите кнопку **Готово** кнопку (см. рис. 4).</span><span class="sxs-lookup"><span data-stu-id="dc244-161">In the **Choose Your Database Objects** step, select the Movie database table and click the **Finish** button (see Figure 4).</span></span>

<span data-ttu-id="dc244-162">После выполнения этих действий, откроется конструктор модели EDM ADO.NET (конструктор сущностей).</span><span class="sxs-lookup"><span data-stu-id="dc244-162">After you complete these steps, the ADO.NET Entity Data Model Designer (Entity Designer) opens.</span></span>

<span data-ttu-id="dc244-163">**Рис. 1 – Создание новой модели EDM**</span><span class="sxs-lookup"><span data-stu-id="dc244-163">**Figure 1 – Creating a new Entity Data Model**</span></span>

![clip_image002](creating-model-classes-with-the-entity-framework-cs/_static/image1.jpg)

<span data-ttu-id="dc244-165">**Рис. 2 – выберите шаг содержимое модели**</span><span class="sxs-lookup"><span data-stu-id="dc244-165">**Figure 2 – Choose Model Contents Step**</span></span>

![clip_image004](creating-model-classes-with-the-entity-framework-cs/_static/image2.jpg)

<span data-ttu-id="dc244-167">**Рис. 3 – Выбор подключения базы данных**</span><span class="sxs-lookup"><span data-stu-id="dc244-167">**Figure 3 – Choose Your Data Connection**</span></span>

![clip_image006](creating-model-classes-with-the-entity-framework-cs/_static/image3.jpg)

<span data-ttu-id="dc244-169">**Рис. 4 – Выбор объектов базы данных**</span><span class="sxs-lookup"><span data-stu-id="dc244-169">**Figure 4 – Choose Your Database Objects**</span></span>

![clip_image008](creating-model-classes-with-the-entity-framework-cs/_static/image4.jpg)

#### <a name="modifying-the-adonet-entity-data-model"></a><span data-ttu-id="dc244-171">Изменение модели EDM ADO.NET</span><span class="sxs-lookup"><span data-stu-id="dc244-171">Modifying the ADO.NET Entity Data Model</span></span>

<span data-ttu-id="dc244-172">После создания модели EDM, можно изменить модель, используя конструктор сущностей (см. рис. 5).</span><span class="sxs-lookup"><span data-stu-id="dc244-172">After you create an Entity Data Model, you can modify the model by taking advantage of the Entity Designer (see Figure 5).</span></span> <span data-ttu-id="dc244-173">Конструктор сущностей в любое время можно открыть двойным щелчком файла MoviesDBModel.edmx, содержащиеся в папке «Models» в окне обозревателя решений.</span><span class="sxs-lookup"><span data-stu-id="dc244-173">You can open the Entity Designer at any time by double-clicking the MoviesDBModel.edmx file contained in the Models folder within the Solution Explorer window.</span></span>

<span data-ttu-id="dc244-174">**Рисунок 5 – конструктор модели EDM ADO.NET**</span><span class="sxs-lookup"><span data-stu-id="dc244-174">**Figure 5 – The ADO.NET Entity Data Model Designer**</span></span>

![clip_image010](creating-model-classes-with-the-entity-framework-cs/_static/image5.jpg)

<span data-ttu-id="dc244-176">Например можно использовать конструктор сущностей изменять имена классов, которые создает мастер модели EDM.</span><span class="sxs-lookup"><span data-stu-id="dc244-176">For example, you can use the Entity Designer to change the names of the classes that the Entity Model Data Wizard generates.</span></span> <span data-ttu-id="dc244-177">Мастер создал класс доступа к данным с именем фильмов.</span><span class="sxs-lookup"><span data-stu-id="dc244-177">The Wizard created a new data access class named Movies.</span></span> <span data-ttu-id="dc244-178">Другими словами мастер предлагает класс очень совпадает с именем таблицы базы данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-178">In other words, the Wizard gave the class the very same name as the database table.</span></span> <span data-ttu-id="dc244-179">Так как этот класс будет использоваться для представления фильма конкретный экземпляр, мы должны Переименуйте класс фильмы фильмом.</span><span class="sxs-lookup"><span data-stu-id="dc244-179">Because we will use this class to represent a particular Movie instance, we should rename the class from Movies to Movie.</span></span>

<span data-ttu-id="dc244-180">Если требуется переименовать класс сущностей, можно дважды щелкнуть имя класса в конструкторе сущностей и введите новое имя (см. рис. 6).</span><span class="sxs-lookup"><span data-stu-id="dc244-180">If you want to rename an entity class, you can double-click on the class name in the Entity Designer and enter a new name (see Figure 6).</span></span> <span data-ttu-id="dc244-181">Кроме того можно изменить имя сущности в окне «Свойства» после выбора сущности в Entity Designer.</span><span class="sxs-lookup"><span data-stu-id="dc244-181">Alternatively, you can change the name of an entity in the Properties window after selecting an entity in the Entity Designer.</span></span>

<span data-ttu-id="dc244-182">**Рис. 6 – изменение имени сущности**</span><span class="sxs-lookup"><span data-stu-id="dc244-182">**Figure 6 – Changing an entity name**</span></span>

![clip_image012](creating-model-classes-with-the-entity-framework-cs/_static/image6.jpg)

<span data-ttu-id="dc244-184">Не забудьте сохранить вашей модели EDM после внесения изменений, нажав кнопку «Сохранить» (значок дискеты).</span><span class="sxs-lookup"><span data-stu-id="dc244-184">Remember to save your Entity Data Model after making a modification by clicking the Save button (the icon of the floppy disk).</span></span> <span data-ttu-id="dc244-185">В фоновом Entity Designer создает набор классов C#.</span><span class="sxs-lookup"><span data-stu-id="dc244-185">Behind the scenes, the Entity Designer generates a set of C# classes.</span></span> <span data-ttu-id="dc244-186">Эти классы можно просмотреть, открыв файл MoviesDBModel.Designer.cs в окне обозревателя решений.</span><span class="sxs-lookup"><span data-stu-id="dc244-186">You can view these classes by opening the MoviesDBModel.Designer.cs file from the Solution Explorer window.</span></span>


<span data-ttu-id="dc244-187">Не следует изменять код в файле Designer.cs так, как изменения будут быть перезаписан в следующий раз, используйте конструктор сущностей.</span><span class="sxs-lookup"><span data-stu-id="dc244-187">Don't modify the code in the Designer.cs file since your changes will be overwritten the next time you use the Entity Designer.</span></span> <span data-ttu-id="dc244-188">Если вы хотите расширить функциональные возможности для классов сущностей, определенных в файле Designer.cs, то можно создать *разделяемые классы* в отдельные файлы.</span><span class="sxs-lookup"><span data-stu-id="dc244-188">If you want to extend the functionality of the entity classes defined in the Designer.cs file then you can create *partial classes* in separate files.</span></span>


#### <a name="selecting-database-records-with-the-entity-framework"></a><span data-ttu-id="dc244-189">При выборе записи базы данных с платформой Entity Framework</span><span class="sxs-lookup"><span data-stu-id="dc244-189">Selecting Database Records with the Entity Framework</span></span>

<span data-ttu-id="dc244-190">Давайте начнем построение нашего фильма базы данных приложения путем создания страницы со списком записей фильма.</span><span class="sxs-lookup"><span data-stu-id="dc244-190">Let's start building our Movie Database application by creating a page that displays a list of movie records.</span></span> <span data-ttu-id="dc244-191">Контроллер Home в листинге 1 представляет действие с именем Index().</span><span class="sxs-lookup"><span data-stu-id="dc244-191">The Home controller in Listing 1 exposes an action named Index().</span></span> <span data-ttu-id="dc244-192">Действие Index() возвращает все записи фильма фильма таблицы базы данных, используя преимущества платформы Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="dc244-192">The Index() action returns all of the movie records from the Movie database table by taking advantage of the Entity Framework.</span></span>

<span data-ttu-id="dc244-193">**Перечисление Controllers\HomeController.cs. 1.**</span><span class="sxs-lookup"><span data-stu-id="dc244-193">**Listing 1 – Controllers\HomeController.cs**</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample1.cs)]

<span data-ttu-id="dc244-194">Обратите внимание, что контроллер в список 1 включает конструктор.</span><span class="sxs-lookup"><span data-stu-id="dc244-194">Notice that the controller in Listing 1 includes a constructor.</span></span> <span data-ttu-id="dc244-195">Конструктор инициализирует поле уровня класса с именем \_базы данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-195">The constructor initializes a class-level field named \_db.</span></span> <span data-ttu-id="dc244-196">\_Поле db представляет сущности базы данных, созданные платформой Entity Framework корпорации Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="dc244-196">The \_db field represents the database entities generated by the Microsoft Entity Framework.</span></span> <span data-ttu-id="dc244-197">\_Поле db является экземпляром класса MoviesDBEntities, который был создан конструктором сущностей.</span><span class="sxs-lookup"><span data-stu-id="dc244-197">The \_db field is an instance of the MoviesDBEntities class that was generated by the Entity Designer.</span></span>


<span data-ttu-id="dc244-198">Чтобы использовать класс theMoviesDBEntities в контроллер Home, необходимо импортировать пространство имен MovieEntityApp.Models (*MVCProjectName*. Модели).</span><span class="sxs-lookup"><span data-stu-id="dc244-198">In order to use theMoviesDBEntities class in the Home controller, you must import the MovieEntityApp.Models namespace (*MVCProjectName*.Models).</span></span>


<span data-ttu-id="dc244-199">\_Db поле используется в действии Index() для получения записей из таблицы базы данных фильмов.</span><span class="sxs-lookup"><span data-stu-id="dc244-199">The \_db field is used within the Index() action to retrieve the records from the Movies database table.</span></span> <span data-ttu-id="dc244-200">Выражение \_db. MovieSet представляет все записи из таблицы базы данных фильмов.</span><span class="sxs-lookup"><span data-stu-id="dc244-200">The expression \_db.MovieSet represents all of the records from the Movies database table.</span></span> <span data-ttu-id="dc244-201">Метод ToList() используется для преобразования набора фильмов в универсальной коллекции объектов фильма (список&lt;фильма&gt;).</span><span class="sxs-lookup"><span data-stu-id="dc244-201">The ToList() method is used to convert the set of movies into a generic collection of Movie objects (List&lt;Movie&gt;).</span></span>

<span data-ttu-id="dc244-202">Записи фильма получены с помощью LINQ to Entities.</span><span class="sxs-lookup"><span data-stu-id="dc244-202">The movie records are retrieved with the help of LINQ to Entities.</span></span> <span data-ttu-id="dc244-203">Index() действие в список 1 использует LINQ *синтаксис метода* для извлечения набора записей базы данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-203">The Index() action in Listing 1 uses LINQ *method syntax* to retrieve the set of database records.</span></span> <span data-ttu-id="dc244-204">При желании можно использовать LINQ *синтаксис запроса* вместо него.</span><span class="sxs-lookup"><span data-stu-id="dc244-204">If you prefer, you can use LINQ *query syntax* instead.</span></span> <span data-ttu-id="dc244-205">Следующие две инструкции выполняют точно такой же функции:</span><span class="sxs-lookup"><span data-stu-id="dc244-205">The following two statements do the very same thing:</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample2.cs)]

<span data-ttu-id="dc244-206">Используйте любой синтаксис LINQ — синтаксис метода или синтаксис запроса — найденной интуитивно.</span><span class="sxs-lookup"><span data-stu-id="dc244-206">Use whichever LINQ syntax – method syntax or query syntax – that you find most intuitive.</span></span> <span data-ttu-id="dc244-207">Нет разницы в производительности между двумя способами — единственное отличие заключается в стиль.</span><span class="sxs-lookup"><span data-stu-id="dc244-207">There is no difference in performance between the two approaches – the only difference is style.</span></span>

<span data-ttu-id="dc244-208">Представление в списке 2 используется для отображения записей фильма.</span><span class="sxs-lookup"><span data-stu-id="dc244-208">The view in Listing 2 is used to display the movie records.</span></span>

<span data-ttu-id="dc244-209">**Перечисление Views\Home\Index.aspx. 2.**</span><span class="sxs-lookup"><span data-stu-id="dc244-209">**Listing 2 – Views\Home\Index.aspx**</span></span>

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample3.aspx)]

<span data-ttu-id="dc244-210">Представление в списке 2 содержит **foreach** цикл, который проходит по каждой записи фильма и отображает значения свойства Title и директора запись фильма.</span><span class="sxs-lookup"><span data-stu-id="dc244-210">The view in Listing 2 contains a **foreach** loop that iterates through each movie record and displays the values of the movie record's Title and Director properties.</span></span> <span data-ttu-id="dc244-211">Обратите внимание, что изменить и удалить ссылку рядом с каждой записи.</span><span class="sxs-lookup"><span data-stu-id="dc244-211">Notice that an Edit and Delete link is displayed next to each record.</span></span> <span data-ttu-id="dc244-212">Кроме того, ссылку Добавить фильма отображается в нижней части представления (см. рис. 7).</span><span class="sxs-lookup"><span data-stu-id="dc244-212">Furthermore, an Add Movie link appears at the bottom of the view (see Figure 7).</span></span>

<span data-ttu-id="dc244-213">**Рис. 7 представлении индекса**</span><span class="sxs-lookup"><span data-stu-id="dc244-213">**Figure 7 – The Index view**</span></span>

![clip_image014](creating-model-classes-with-the-entity-framework-cs/_static/image7.jpg)

<span data-ttu-id="dc244-215">Просмотр индекса является *типизированного представления*.</span><span class="sxs-lookup"><span data-stu-id="dc244-215">The Index view is a *typed view*.</span></span> <span data-ttu-id="dc244-216">Содержит представление Index &lt;% @ Page %&gt; директивы *Inherits* атрибут, который приводит свойство модели для строго типизированной коллекции универсальный список объектов фильма (список&lt;фильма).</span><span class="sxs-lookup"><span data-stu-id="dc244-216">The Index view includes a &lt;%@ Page %&gt; directive with an *Inherits* attribute that casts the Model property to a strongly typed generic List collection of Movie objects (List&lt;Movie).</span></span>

## <a name="inserting-database-records-with-the-entity-framework"></a><span data-ttu-id="dc244-217">Вставка записи базы данных с платформой Entity Framework</span><span class="sxs-lookup"><span data-stu-id="dc244-217">Inserting Database Records with the Entity Framework</span></span>

<span data-ttu-id="dc244-218">Entity Framework позволяет упростить процесс для вставки новых записей в таблицу базы данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-218">You can use the Entity Framework to make it easy to insert new records into a database table.</span></span> <span data-ttu-id="dc244-219">Листинг 3 содержит два новых действий, добавленный в класс контроллера Home, можно использовать для вставки новых записей в таблице базы данных фильма.</span><span class="sxs-lookup"><span data-stu-id="dc244-219">Listing 3 contains two new actions added to the Home controller class that you can use to insert new records into the Movie database table.</span></span>

<span data-ttu-id="dc244-220">**Листинг 3 – Controllers\HomeController.cs (Добавить методы)**</span><span class="sxs-lookup"><span data-stu-id="dc244-220">**Listing 3 – Controllers\HomeController.cs (Add methods)**</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample4.cs)]

<span data-ttu-id="dc244-221">Первое действие Add() просто возвращает представление.</span><span class="sxs-lookup"><span data-stu-id="dc244-221">The first Add() action simply returns a view.</span></span> <span data-ttu-id="dc244-222">Представление содержит формы для добавления новой базы данных фильма записи (см. рис. 8).</span><span class="sxs-lookup"><span data-stu-id="dc244-222">The view contains a form for adding a new movie database record (see Figure 8).</span></span> <span data-ttu-id="dc244-223">При отправке формы, второе действие Add() вызывается.</span><span class="sxs-lookup"><span data-stu-id="dc244-223">When you submit the form, the second Add() action is invoked.</span></span>

<span data-ttu-id="dc244-224">Обратите внимание, что второе действие Add() помечено атрибутом AcceptVerbs.</span><span class="sxs-lookup"><span data-stu-id="dc244-224">Notice that the second Add() action is decorated with the AcceptVerbs attribute.</span></span> <span data-ttu-id="dc244-225">Это действие может быть вызвана только при выполнении операции HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="dc244-225">This action can be invoked only when performing an HTTP POST operation.</span></span> <span data-ttu-id="dc244-226">Другими словами это действие может быть вызвана только при учете формы HTML.</span><span class="sxs-lookup"><span data-stu-id="dc244-226">In other words, this action can only be invoked when posting an HTML form.</span></span>

<span data-ttu-id="dc244-227">Второе действие Add() создает новый экземпляр класса Entity Framework фильма с помощью метода ASP.NET MVC TryUpdateModel().</span><span class="sxs-lookup"><span data-stu-id="dc244-227">The second Add() action creates a new instance of the Entity Framework Movie class with the help of the ASP.NET MVC TryUpdateModel() method.</span></span> <span data-ttu-id="dc244-228">Метод TryUpdateModel() принимает полей в FormCollection, передаваемый в метод Add() и присваивает значения этих полей формы HTML в класс фильма.</span><span class="sxs-lookup"><span data-stu-id="dc244-228">The TryUpdateModel() method takes the fields in the FormCollection passed to the Add() method and assigns the values of these HTML form fields to the Movie class.</span></span>


<span data-ttu-id="dc244-229">При использовании платформы Entity Framework, необходимо указать «белый список» свойств при использовании методов TryUpdateModel или UpdateModel для обновления свойств класса сущностей.</span><span class="sxs-lookup"><span data-stu-id="dc244-229">When using the Entity Framework, you must supply a "white list" of properties when using the TryUpdateModel or UpdateModel methods to update the properties of an entity class.</span></span>


<span data-ttu-id="dc244-230">После этого действие Add() выполняет проверку некоторые простой формы.</span><span class="sxs-lookup"><span data-stu-id="dc244-230">Next, the Add() action performs some simple form validation.</span></span> <span data-ttu-id="dc244-231">Действие проверяет, что заголовок и директора свойства имеют значения.</span><span class="sxs-lookup"><span data-stu-id="dc244-231">The action verifies that both the Title and Director properties have values.</span></span> <span data-ttu-id="dc244-232">В случае ошибки проверки для ModelState добавляется сообщение об ошибке проверки.</span><span class="sxs-lookup"><span data-stu-id="dc244-232">If there is a validation error, then a validation error message is added to ModelState.</span></span>

<span data-ttu-id="dc244-233">Если нет ошибок проверки новой записи фильма добавляется в таблицу базы данных фильмов с помощью платформы Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="dc244-233">If there are no validation errors then a new movie record is added to the Movies database table with the help of the Entity Framework.</span></span> <span data-ttu-id="dc244-234">Новая запись добавляется в базу данных с две следующие строки кода:</span><span class="sxs-lookup"><span data-stu-id="dc244-234">The new record is added to the database with the following two lines of code:</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample5.cs)]

<span data-ttu-id="dc244-235">Первая строка кода добавляет новую сущность фильма набор фильмов, отслеживаемые платформой Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="dc244-235">The first line of code adds the new Movie entity to the set of movies being tracked by the Entity Framework.</span></span> <span data-ttu-id="dc244-236">Вторая строка кода сохраняет все изменения были внесены в кино, отслеживаемые в основной базе данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-236">The second line of code saves whatever changes have been made to the Movies being tracked back to the underlying database.</span></span>

<span data-ttu-id="dc244-237">**Рис. 8 – добавить представление**</span><span class="sxs-lookup"><span data-stu-id="dc244-237">**Figure 8 – The Add view**</span></span>

![clip_image016](creating-model-classes-with-the-entity-framework-cs/_static/image8.jpg)

#### <a name="updating-database-records-with-the-entity-framework"></a><span data-ttu-id="dc244-239">Обновление записей базы данных с платформой Entity Framework</span><span class="sxs-lookup"><span data-stu-id="dc244-239">Updating Database Records with the Entity Framework</span></span>

<span data-ttu-id="dc244-240">Можно выполнить почти тот же подход, чтобы изменить запись в базе данных с платформой Entity Framework, как подход, который мы следовали для вставки новой записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-240">You can follow almost the same approach to edit a database record with the Entity Framework as the approach that we just followed to insert a new database record.</span></span> <span data-ttu-id="dc244-241">Листинг 4 содержит два новых действий контроллера, с именем Edit().</span><span class="sxs-lookup"><span data-stu-id="dc244-241">Listing 4 contains two new controller actions named Edit().</span></span> <span data-ttu-id="dc244-242">Первое действие Edit() возвращает HTML-формы для редактирования запись фильма.</span><span class="sxs-lookup"><span data-stu-id="dc244-242">The first Edit() action returns an HTML form for editing a movie record.</span></span> <span data-ttu-id="dc244-243">Второе действие Edit() пытается обновить базу данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-243">The second Edit() action attempts to update the database.</span></span>

<span data-ttu-id="dc244-244">**Листинг 4 – Controllers\HomeController.cs (методы редактирования)**</span><span class="sxs-lookup"><span data-stu-id="dc244-244">**Listing 4 – Controllers\HomeController.cs (Edit methods)**</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample6.cs)]

<span data-ttu-id="dc244-245">Второе действие Edit() начинается путем извлечения из базы данных, которая соответствует идентификатору фильма редактируемого запись фильма.</span><span class="sxs-lookup"><span data-stu-id="dc244-245">The second Edit() action starts by retrieving the Movie record from the database that matches the Id of the movie being edited.</span></span> <span data-ttu-id="dc244-246">Следующие LINQ to Entities инструкции извлекает первой записи базы данных, которая совпадает с определенным кодом:</span><span class="sxs-lookup"><span data-stu-id="dc244-246">The following LINQ to Entities statement grabs the first database record that matches a particular Id:</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample7.cs)]

<span data-ttu-id="dc244-247">Затем метод TryUpdateModel() используется для присвоения значений полей формы HTML свойства сущности фильма.</span><span class="sxs-lookup"><span data-stu-id="dc244-247">Next, the TryUpdateModel() method is used to assign the values of the HTML form fields to the properties of the movie entity.</span></span> <span data-ttu-id="dc244-248">Обратите внимание, что список разрешенных предоставлены для указания точного свойств для обновления.</span><span class="sxs-lookup"><span data-stu-id="dc244-248">Notice that a white list is supplied to specify the exact properties to update.</span></span>

<span data-ttu-id="dc244-249">Далее некоторые простые проверка выполняется для проверки того, что название и директора свойства имеют значения.</span><span class="sxs-lookup"><span data-stu-id="dc244-249">Next, some simple validation is performed to verify that both the Movie Title and Director properties have values.</span></span> <span data-ttu-id="dc244-250">Если одно из свойств отсутствует значение, затем добавляется сообщение об ошибке проверки ModelState и ModelState.IsValid возвращает значение false.</span><span class="sxs-lookup"><span data-stu-id="dc244-250">If either property is missing a value, then a validation error message is added to ModelState and ModelState.IsValid returns the value false.</span></span>

<span data-ttu-id="dc244-251">Наконец в случае ошибки проверки не базовой таблицы базы данных фильмы затем обновляется любые изменения, путем вызова метода SaveChanges().</span><span class="sxs-lookup"><span data-stu-id="dc244-251">Finally, if there are no validation errors, then the underlying Movies database table is updated with any changes by calling the SaveChanges() method.</span></span>

<span data-ttu-id="dc244-252">При изменении записи базы данных, необходимо передать идентификатор записи, в изменяемой действия контроллера, который выполняет обновление базы данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-252">When editing database records, you need to pass the Id of the record being edited to the controller action that performs the database update.</span></span> <span data-ttu-id="dc244-253">В противном случае действие контроллера будет известно, какая запись для обновления в базе данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-253">Otherwise, the controller action will not know which record to update in the underlying database.</span></span> <span data-ttu-id="dc244-254">Представление изменения, содержащиеся в листинге 5 включает в себя скрытое поле формы, представляющее идентификатор изменяемую запись базы данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-254">The Edit view, contained in Listing 5, includes a hidden form field that represents the Id of the database record being edited.</span></span>

<span data-ttu-id="dc244-255">**Листинг 5 – Views\Home\Edit.aspx**</span><span class="sxs-lookup"><span data-stu-id="dc244-255">**Listing 5 – Views\Home\Edit.aspx**</span></span>

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample8.aspx)]

## <a name="deleting-database-records-with-the-entity-framework"></a><span data-ttu-id="dc244-256">Удаление записей базы данных с платформой Entity Framework</span><span class="sxs-lookup"><span data-stu-id="dc244-256">Deleting Database Records with the Entity Framework</span></span>

<span data-ttu-id="dc244-257">Операции окончательной базы данных, который нужно разбираться в этом учебнике выполняется удаление записи базы данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-257">The final database operation, which we need to tackle in this tutorial, is deleting database records.</span></span> <span data-ttu-id="dc244-258">Действия контроллера 6 со списком позволяет удалять записи определенной базы данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-258">You can use the controller action in Listing 6 to delete a particular database record.</span></span>

<span data-ttu-id="dc244-259">**Перечисление 6 — \Controllers\HomeController.cs (действие Delete)**</span><span class="sxs-lookup"><span data-stu-id="dc244-259">**Listing 6 -- \Controllers\HomeController.cs (Delete action)**</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample9.cs)]

<span data-ttu-id="dc244-260">Действие Delete() сначала извлекает фильм, сущность, которая соответствует идентификатору переданные в действие.</span><span class="sxs-lookup"><span data-stu-id="dc244-260">The Delete() action first retrieves the Movie entity that matches the Id passed to the action.</span></span> <span data-ttu-id="dc244-261">Далее фильма удаляется из базы данных с помощью вызова метода DeleteObject(), а затем с помощью метода SaveChanges().</span><span class="sxs-lookup"><span data-stu-id="dc244-261">Next, the movie is deleted from the database by calling the DeleteObject() method followed by the SaveChanges() method.</span></span> <span data-ttu-id="dc244-262">Наконец пользователь перенаправляется обратно в представление индекс.</span><span class="sxs-lookup"><span data-stu-id="dc244-262">Finally, the user is redirected back to the Index view.</span></span>

## <a name="summary"></a><span data-ttu-id="dc244-263">Сводка</span><span class="sxs-lookup"><span data-stu-id="dc244-263">Summary</span></span>

<span data-ttu-id="dc244-264">Цель этого учебника было показано, как создать базы данных веб-приложения, используя преимущества ASP.NET MVC и Entity Framework корпорации Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="dc244-264">The purpose of this tutorial was to demonstrate how you can build database-driven web applications by taking advantage of ASP.NET MVC and the Microsoft Entity Framework.</span></span> <span data-ttu-id="dc244-265">Вы узнали, как создать приложение, которое позволяет выбрать, вставки, обновления и удаления записей базы данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-265">You learned how to build an application that enables you to select, insert, update, and delete database records.</span></span>

<span data-ttu-id="dc244-266">Во-первых мы рассмотрели, как можно использовать мастер моделей EDM для создания модели EDM из среды Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="dc244-266">First, we discussed how you can use the Entity Data Model Wizard to generate an Entity Data Model from within Visual Studio.</span></span> <span data-ttu-id="dc244-267">Далее вы узнаете, как использовать LINQ to Entities для получения набора записей базы данных из таблицы базы данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-267">Next, you learn how to use LINQ to Entities to retrieve a set of database records from a database table.</span></span> <span data-ttu-id="dc244-268">Наконец мы использовали Entity Framework для вставки, обновления и удаления записей базы данных.</span><span class="sxs-lookup"><span data-stu-id="dc244-268">Finally, we used the Entity Framework to insert, update, and delete database records.</span></span>

>[!div class="step-by-step"]
[<span data-ttu-id="dc244-269">Вперед</span><span class="sxs-lookup"><span data-stu-id="dc244-269">Next</span></span>](creating-model-classes-with-linq-to-sql-cs.md)
