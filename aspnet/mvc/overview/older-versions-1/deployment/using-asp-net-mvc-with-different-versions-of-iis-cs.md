---
uid: mvc/overview/older-versions-1/deployment/using-asp-net-mvc-with-different-versions-of-iis-cs
title: С помощью ASP.NET MVC с разными версиями IIS (C#) | Документы Microsoft
author: microsoft
description: В этом учебнике вы узнаете, как использовать ASP.NET MVC и маршрутизация URL-адресов, с разными версиями служб IIS. Вы узнаете различные стратегии...
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/19/2008
ms.topic: article
ms.assetid: b0cf4a34-2c1d-4717-bb54-ff029e722990
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/deployment/using-asp-net-mvc-with-different-versions-of-iis-cs
msc.type: authoredcontent
ms.openlocfilehash: 73c129c1eaf85cb5b110248fe2a2c0faed0157bc
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="using-aspnet-mvc-with-different-versions-of-iis-c"></a>С помощью ASP.NET MVC с разными версиями IIS (C#)
====================
по [Microsoft](https://github.com/microsoft)

> В этом учебнике вы узнаете, как использовать ASP.NET MVC и маршрутизация URL-адресов, с разными версиями служб IIS. Вы узнаете, различные стратегии для использования ASP.NET MVC с IIS 7.0 (классический режим), IIS 6.0 и более ранних версий IIS.


Платформа ASP.NET MVC зависит от маршрутизация ASP.NET на перенаправление запросов браузера действия контроллера. Чтобы воспользоваться преимуществами маршрутизации ASP.NET, может потребоваться выполнить дополнительные действия по настройке веб-сервера. Все зависит от версии Internet Information Services (IIS) и режим для приложения обработки запроса.

Здесь приводится сводка различные версии IIS.

- IIS 7.0 (интегрированный режим) — без специальной настройки, необходимые для использования маршрутизации ASP.NET.
- IIS 7.0 (классический режим) — необходимо выполнить специальные конфигурации для использования маршрутизации ASP.NET.
- IIS 6.0 или ниже — необходимо выполнить специальные конфигурации для использования маршрутизации ASP.NET.

Последняя версия служб IIS — версии 7.5 (на Win7). IIS 7 IIS включены с Windows Server 2008 и VISTA/SP1 и более поздних версий. IIS 7.0 можно установить в любой версии операционной системы Vista, кроме Home Basic (в разделе [ https://technet.microsoft.com/library/cc731179%28WS.10%29.aspx ](https://technet.microsoft.com/library/cc731179%28WS.10%29.aspx)).

IIS 7.0 поддерживает два режима для обработки запросов. Можно использовать в режиме интеграции с или классического режима. Нет необходимости выполнять все специальные шаги настройки при использовании IIS 7.0 в интегрированном режиме. Тем не менее, необходимо выполнить дополнительную настройку, при использовании IIS 7.0 в классическом режиме.

Microsoft Windows Server 2003 включает службы IIS 6.0. При использовании операционной системы Windows Server 2003 невозможно обновить IIS 6.0 на IIS 7.0. При использовании IIS 6.0, необходимо выполнить дополнительные действия по настройке.

Microsoft Windows XP Professional включает службы IIS 5.1. При использовании служб IIS 5.1, необходимо выполнить дополнительные действия по настройке.

Наконец Microsoft Windows 2000 и Microsoft Windows 2000 Professional включает IIS 5.0. При использовании IIS 5.0, необходимо выполнить дополнительные действия по настройке.

## <a name="integrated-versus-classic-mode"></a>Сравнение классический режим интеграции

IIS 7.0 может обрабатывать запросы, с помощью двух режимов обработки других запросов: интегрированный и классический. В режиме интеграции с обеспечивает более высокую производительность и дополнительные функции. Классический режим включена для обеспечения обратной совместимости с предыдущими версиями IIS.

Режим обработки запроса определяется свойством пула приложения. Можно определить, какой режим обработки используется конкретного веб-приложения путем определения пула приложений, связанных с приложением. Выполните следующие действия.

1. Запустите диспетчер служб IIS
2. В окне подключения выберите приложение
3. В окне «действия» выберите **основные параметры** ссылку, чтобы открыть диалоговое окно изменения приложения (см. рис. 1)
4. Запишите выбранного пула приложений.

По умолчанию службы IIS настроены для поддержки два пула приложений: **DefaultAppPool** и **Classic .NET AppPool**. Если выбран DefaultAppPool, приложение выполняется в режиме интеграции запрос обработки. Если выбран Classic .NET AppPool, приложение работает в режиме обработки классический запроса.

[![Диалоговое окно нового проекта](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image1.jpg)](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image1.png)

**Рис. 1**: обнаружение режим обработки запроса ([Просмотр полноразмерное изображение](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image2.png))

Обратите внимание, что вы можете настроить режим обработки запроса в диалоговом окне изменения приложения. Нажмите кнопку Выбрать и изменить пул приложений, связанный с приложением. Имейте в виду, что существуют проблемы совместимости при изменении приложения ASP.NET из классического в интегрированный режим. Дополнительные сведения см. в следующих статьях:

- Обновление для IIS 7.0 в Windows Vista и Windows Server 2008 — ASP.NET версии 1.1 [https://www.iis.net/learn/application-frameworks/building-and-running-aspnet-applications/upgrading-aspnet-11-to-iis-on-windows-vista-and-windows-server-2008](https://www.iis.net/learn/application-frameworks/building-and-running-aspnet-applications/upgrading-aspnet-11-to-iis-on-windows-vista-and-windows-server-2008)
- Интеграция ASP.NET с IIS 7.0: [https://www.iis.net/learn/application-frameworks/building-and-running-aspnet-applications/aspnet-integration-with-iis](https://www.iis.net/learn/application-frameworks/building-and-running-aspnet-applications/aspnet-integration-with-iis)

Если приложение ASP.NET использует DefaultAppPool, не требуется, выполнять дополнительные действия для получения маршрутизация ASP.NET (и поэтому ASP.NET MVC) для работы. Тем не менее если приложение ASP.NET настроено на использование Classic .NET AppPool, а затем продолжите чтение, имеется больше работы.

## <a name="using-aspnet-mvc-with-older-versions-of-iis"></a>С помощью ASP.NET MVC с более ранними версиями IIS

Если необходимо использовать ASP.NET MVC с более старой версии IIS, чем IIS 7.0, или необходимо использовать службы IIS 7.0 в классическом режиме, есть два варианта. Во-первых можно изменить таблицу маршрутов для использования расширений файлов. Например вместо запроса URL-адрес: /Store/Details, запрашивается URL-адрес: /Store.aspx/Details.

Второй вариант — создать так называемую *сопоставления*. Сопоставление с подстановочными знаками сценарий позволяет сопоставить каждый запрос в платформе ASP.NET.

Если нет доступа к веб-сервера (например, your ASP.NET MVC приложение размещается поставщиком услуг Интернета) необходимо использовать первый параметр. Если вы не хотите изменять внешний вид URL-адресов, а у вас есть доступ к веб-серверу, можно использовать второй вариант.

Мы исследуем каждого параметра подробно в следующих разделах.

## <a name="adding-extensions-to-the-route-table"></a>Добавление расширений в таблице маршрутов

Для изменения таблицы маршрутизации в файле Global.asax является самым простым способом получения маршрутизация ASP.NET для работы с более ранними версиями IIS. Значение по умолчанию и неизмененного файла Global.asax в листинге 1 настраивает один маршрут с именем маршрута по умолчанию.

**Листинг 1 — Global.asax (без изменений)**

[!code-csharp[Main](using-asp-net-mvc-with-different-versions-of-iis-cs/samples/sample1.cs)]

Маршрут по умолчанию, настроенные в список 1 позволяет указать URL-адреса для маршрута, которые выглядят следующим образом:

/ Home/Index

/ Продукта или сведения о/3

/ Продукта

К сожалению более ранних версий IIS не будет передавать эти запросы на базе платформы ASP.NET. Таким образом эти запросы не будут направляться к контроллеру. Например если при выполнении запроса обозревателя/Home URL-адрес или индекса сможете получить страницу ошибок на рис. 2.

[![Диалоговое окно нового проекта](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image2.jpg)](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image3.png)

**На рисунке 2**: сообщение об ошибке 404 не найдено ([Просмотр полноразмерное изображение](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image4.png))

Более ранних версий IIS сопоставлять только определенных запросов платформы ASP.NET. Запрос должен быть URL-адреса с расширением файла справа. Например запрос /SomePage.aspx сопоставлены платформы ASP.NET. Однако запрос /SomePage.htm не поддерживается.

Таким образом Чтобы получить маршрутизация ASP.NET для работы, мы необходимо изменить маршрут по умолчанию, таким образом, чтобы он включал расширение файла, которое сопоставляется с помощью платформы ASP.NET.

Это делается с помощью скрипта с именем `registermvc.wsf`. Она была включена в выпуск ASP.NET MVC 1 в `C:\Program Files\Microsoft ASP.NET\ASP.NET MVC\Scripts`, но начиная с ASP.NET 2 этот скрипт был перемещен в фьючерсов ASP.NET в [ http://aspnet.codeplex.com/releases/view/39978 ](http://aspnet.codeplex.com/releases/view/39978).

Регистрирует новый модуль MVC было связано с IIS для выполнения этого скрипта. После регистрации расширения MVC было связано свои маршруты в файле Global.asax можно изменить, чтобы маршруты с помощью расширения MVC было связано.

Измененный файл Global.asax в списке 2 работает с предыдущими версиями IIS.

**Листинг 2 - Global.asax (изменено с расширениями)**

[!code-csharp[Main](using-asp-net-mvc-with-different-versions-of-iis-cs/samples/sample2.cs)]

**Важные**: помните, что необходимо построить приложение ASP.NET MVC после изменения в файл Global.asax.

Существует два важных изменения в файл Global.asax в списке 2. Теперь имеется два маршрутов, указанных в файле Global.asax. Шаблон URL-адреса для маршрута по умолчанию первый маршрут теперь выглядит следующим образом.

{controller}.mvc/{action}/{id}

Добавление расширения MVC было связано изменяет тип файлов, которые перехватывает модуль маршрутизации ASP.NET. После этого изменения приложение ASP.NET MVC теперь направляет запросы следующим образом:

/Home.mvc/Index/

/Product.MVC/Details/3

/Product.MVC/

Второй маршрут маршрута корневой новый. Этот шаблон URL-адреса для маршрута корневой является пустой строкой. Этот маршрут необходим для сопоставления запросов к корню приложения. Например корневой маршрута будет соответствовать запрос, который выглядит следующим образом:

[http://www.YourApplication.com/](http://www.YourApplication.com/)

После внесения этих изменений в таблицу маршрутизации, необходимо чтобы убедиться в том, что все ссылки в приложении совместимы с этих новых шаблонов URL-адресов. Другими словами убедитесь, что все ссылки включает в себя расширение MVC было связано. При использовании Html.ActionLink() вспомогательный метод для создания ссылки, затем нет необходимости вносить изменения.

Вместо registermvc.wcf скрипта, можно добавить новое расширение для IIS, который сопоставляется вручную платформы ASP.NET. При добавлении нового расширения самостоятельно, убедитесь, что флажок с меткой **проверка наличия файла** не проверяется.

## <a name="hosted-server"></a>Размещенного сервера

Не всегда имеется доступ к веб-серверу. Например при размещении приложения ASP.NET MVC с помощью поставщика размещения Интернета, затем будут обязательно доступа к службам IIS.

В этом случае следует использовать одно из существующих расширений файлов, которые сопоставлены с помощью платформы ASP.NET. Расширения файлов, которые сопоставляются ASP.NET примеры .aspx, .ashx расширения и .axd.

Например в списке 3 измененный файл Global.asax использует расширение .aspx вместо расширения MVC было связано.

**Листинг 3 — Global.asax (изменено с расширениями .aspx)**

[!code-csharp[Main](using-asp-net-mvc-with-different-versions-of-iis-cs/samples/sample3.cs)]

В списке 3 файла Global.asax именно таким же, что и предыдущий файл Global.asax, за исключением того факта, что он использует расширение .aspx вместо расширения MVC было связано. Выполнение настройки удаленного веб-сервера, чтобы использовать расширение .aspx не нужно.

## <a name="creating-a-wildcard-script-map"></a>Создание карты сценария с подстановочными знаками

Если у вас есть доступ к веб-серверу не требуется изменить URL-адреса для приложения ASP.NET MVC, доступны дополнительные параметры. Можно создать сопоставление с подстановочными знаками скрипт, который сопоставляет все запросы на веб-сервер на базе платформы ASP.NET. Таким образом, можно использовать значение по умолчанию таблица маршрутов ASP.NET MVC с IIS 7.0 (в классическом режиме) или IIS 6.0.

Имейте в виду, что этот параметр вызывает IIS для перехвата всех запросов, поступающих на веб-сервер. Сюда входят запросы для изображения, классический ASP-страницы и HTML-страницы. Таким образом Включение подстановочного знака карты скриптов для ASP.NET негативно влияет на производительность.

Вот, как включить сопоставление сценария с подстановочными знаками для IIS 7.0:

1. Выберите приложение, в окне подключения
2. Убедитесь, что **функции** выбрано представление
3. Дважды щелкните **сопоставления обработчика** кнопки
4. Нажмите кнопку **сопоставления добавить** связи (см. рис. 3)
5. Введите путь к aspnet\_isapi.dll файл (можно скопировать этот путь из карты скриптов PageHandlerFactory)
6. Введите имя MVC
7. Нажмите кнопку **ОК** кнопки

[![Диалоговое окно нового проекта](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image3.jpg)](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image5.png)

**Рис. 3**: Создание универсального сопоставления сценария с IIS 7.0 ([Просмотр полноразмерное изображение](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image6.png))

Выполните следующие действия для создания универсального сопоставления сценария с IIS 6.0.

1. Щелкните правой кнопкой мыши веб-сайт и выберите свойства
2. Выберите **домашний каталог** вкладка
3. Нажмите кнопку **конфигурации** кнопки
4. Выберите **сопоставления** вкладка
5. Нажмите кнопку **вставить** кнопку (см. рис. 4)
6. Вставьте путь для aspnet\_isapi.dll в поле исполняемый файл (можно скопировать этот путь из карты скриптов для ASPX-файлов)
7. Снимите флажок **проверка наличия файла**
8. Нажмите кнопку **ОК** кнопки

[![Диалоговое окно нового проекта](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image4.jpg)](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image7.png)

**Рис. 4**: Создание универсального сопоставления сценария с IIS 6.0 ([Просмотр полноразмерное изображение](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image8.png))

После включения универсальных сопоставлений, необходимо изменить таблицу маршрутов в файле Global.asax, чтобы оно включало корневой маршрут. В противном случае вы получите страницу ошибок на рис. 5 при выполнении запроса на корневую страницу приложения. Можно использовать в листинге 4 измененный файл Global.asax.

[![Диалоговое окно нового проекта](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image5.jpg)](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image9.png)

**Рис. 5**: отсутствует корневая ошибка маршрута ([Просмотр полноразмерное изображение](using-asp-net-mvc-with-different-versions-of-iis-cs/_static/image10.png))

**Листинг 4 - Global.asax (изменено с маршрутом корневой)**

[!code-csharp[Main](using-asp-net-mvc-with-different-versions-of-iis-cs/samples/sample4.cs)]

После включения сопоставления для IIS 7.0 или IIS 6.0, вы можете внести запросы, работающие с таблицей маршрутов по умолчанию, которые выглядят следующим образом:

/

/ Home/Index

/ Продукта или сведения о/3

/ Продукта

## <a name="summary"></a>Сводка

Целью данного учебника было объясняется, как можно использовать ASP.NET MVC, при использовании более старой версии IIS (или IIS 7.0 в классическом режиме). Мы рассмотрели два метода получения маршрутизация ASP.NET для работы с более ранними версиями IIS: изменить таблицу маршрутов по умолчанию или создать скрипт сопоставление с подстановочными знаками.

Первый вариант необходимо изменить URL-адреса, используемые в приложении ASP.NET MVC. Один очень значительное преимущество, этот первый вариант — Нет необходимости доступа к веб-сервер для изменения таблицы маршрутов. Это означает, можно использовать этот первый вариант, даже в том случае, если размещение приложения ASP.NET MVC с Интернетом хостинга.

Второй вариант — создать сопоставление сценария с подстановочными знаками. Преимуществом второй параметр является не требуются для изменения URL-адресов. Второй вариант недостатком является то, что он может повлиять на производительность приложения ASP.NET MVC.

> [!div class="step-by-step"]
> [Вперед](using-asp-net-mvc-with-different-versions-of-iis-vb.md)
