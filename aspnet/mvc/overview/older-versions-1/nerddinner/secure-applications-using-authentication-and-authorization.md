---
uid: mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
title: Защита приложений с использованием проверки подлинности и авторизации | Документы Microsoft
author: microsoft
description: Шаг 9 показано добавление проверки подлинности и авторизации для защиты нашего приложения обновление NerdDinner, чтобы пользователи должны зарегистрировать и выполните вход на сайт для создания...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/27/2010
ms.topic: article
ms.assetid: 9e4d5cac-b071-440c-b044-20b6d0c964fb
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
msc.type: authoredcontent
ms.openlocfilehash: 4a9b1e6d7d453bd8dc5a61b1f1cec4617af7d693
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2018
---
<a name="secure-applications-using-authentication-and-authorization"></a>Защита приложений с использованием проверки подлинности и авторизации
====================
по [Microsoft](https://github.com/microsoft)

[Скачать PDF](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> Это шаг 9 бесплатных [учебника «Обновление NerdDinner» приложения](introducing-the-nerddinner-tutorial.md) , обходов сквозной как построить небольшой, но завершается веб-приложения с помощью ASP.NET MVC 1.
> 
> Шаг 9 показано добавление проверки подлинности и авторизации для защиты нашего приложения обновление NerdDinner, чтобы пользователи должны зарегистрировать и входа на сайт для создания нового ужинов и только пользователь, размещается dinner можно изменить позже.
> 
> При использовании ASP.NET MVC 3, которому рекомендуется следовать [Приступая к работе с MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) или [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) учебники.


## <a name="nerddinner-step-9-authentication-and-authorization"></a>Обновление NerdDinner шаг 9: Проверка подлинности и авторизация

В данный момент нашей обновление NerdDinner приложения предоставляет все, кто узле возможность создавать и изменять сведения о любой dinner. Позволяет изменить, чтобы пользователи должны для регистрации и входа на сайт для создания нового ужинов и добавить ограничение, чтобы только пользователь, размещается dinner можно изменить его позже.

Для этого мы используем проверку подлинности и авторизации для защиты приложения.

### <a name="understanding-authentication-and-authorization"></a>Основные сведения о проверке подлинности и авторизации

*Проверка подлинности* — это процесс обнаружения и проверки удостоверения клиента, доступ к приложению. Проще говоря, это об определении «кто» — для конечных пользователей при посещении веб-сайта. ASP.NET поддерживает несколько способов проверки подлинности пользователей браузера. Для веб-приложений Интернета наиболее распространенные методики проверки подлинности используется называется «Проверка подлинности форм». Проверка подлинности форм позволяет разработчику создавать свои собственные приложения HTML-форму входа, а затем проверять имя пользователя и пароль, которые конечный пользователь отправляет на базу данных или другие учетные данные хранилища паролей. Если комбинация пользователь/пароль указан правильно, разработчик может затем попросите ASP.NET для выдачи зашифрованного файла cookie HTTP, чтобы идентифицировать пользователя на будущие запросы. Мы отправим с помощью проверки подлинности форм с нашей обновление NerdDinner приложения.

*Авторизация* — это процесс определения того, имеет ли прошедшего проверку подлинности пользователя разрешение на доступ к конкретному ресурсу или URL-адрес или для выполнения некоторых операций. Например, в нашем приложении обновление NerdDinner нам требуется авторизовать доступность только пользователи, вошедшие в */ужинов/Create* URL-адрес и создать новый ужинов. Мы также потребуется добавить логику авторизации, чтобы изменить его — и запретить редактирование доступ другим пользователям только пользователь, размещается dinner.

### <a name="forms-authentication-and-the-accountcontroller"></a>Проверка подлинности форм и AccountController

Шаблон проекта Visual Studio по умолчанию для ASP.NET MVC автоматически включает проверку подлинности форм, при создании новых приложений ASP.NET MVC. Также автоматически добавляет реализацию предварительно созданной учетной записи входа страницы проект — которая значительно упрощает для интеграции безопасности в пределах сайта.

При доступе к нему пользователь не прошел проверку подлинности, Site.master главную страницу по умолчанию отображает ссылку «Вход» по верхнему правому углу сайта:

![](secure-applications-using-authentication-and-authorization/_static/image1.png)

Щелкнув ссылку «Вход» открывающее для пользователя */Account/входа* URL-адрес:

![](secure-applications-using-authentication-and-authorization/_static/image2.png)

Посетителей, которые еще не зарегистрированы можно сделать, щелкнув ссылку «Регистрация» — что ведет к */Account/Register* URL-адрес, давая возможность ввести данные учетной записи:

![](secure-applications-using-authentication-and-authorization/_static/image3.png)

Нажмите кнопку «Регистрация» создать нового пользователя в систему членства ASP.NET и проверки подлинности пользователя на узел, используя проверку подлинности форм.

Если пользователь не выполнил вход, Site.master изменяет правой верхней части страницы, чтобы выходные данные «страница приветствия [username]!» сообщения и отображает «выход» ссылку вместо «вход в систему» один. Щелкнув ссылку «Выход», выполняет выход пользователя:

![](secure-applications-using-authentication-and-authorization/_static/image4.png)

Выше функции входа, выхода и регистрации реализуется в классе AccountController, который был добавлен в свой проект в Visual Studio при создании проекта. Пользовательский Интерфейс для AccountController реализуется с помощью шаблонов представлений в каталоге \Views\Account:

![](secure-applications-using-authentication-and-authorization/_static/image5.png)

Класс AccountController использует систему проверки подлинности форм ASP.NET для отправки файлов cookie проверки подлинности зашифрованные и API членства ASP.NET для хранения и проверки имен пользователей и паролей. API членства в ASP.NET является расширяемой и включает все хранилище учетных данных пароль для использования. ASP.NET поставляется с реализациями поставщиков членства встроенные, хранят пароли или имя пользователя в базе данных SQL или в Active Directory.

Можно настроить поставщика членства, какие приложения обновление NerdDinner используется при открытии файла «web.config» в корне проекта и найдите &lt;членства&gt; раздела внутри него. Регистрирует поставщика членства SQL web.config по умолчанию, при создании проекта и настраивает его на использование строки подключения с именем «ApplicationServices», чтобы указать расположение базы данных.

Строка подключения «ApplicationServices» по умолчанию (что указывается в &lt;connectionStrings&gt; раздел файла web.config) настроен на использование SQL Express. Он указывает на SQL Express базу данных с именем «ASPNETDB. MDF» в разделе приложения «приложение\_данных «каталог. Если эта база данных не существует, при первом запуске API членства используется в приложении, ASP.NET автоматически создать базу данных и подготовки схемы базы данных соответствующее членство в ней:

![](secure-applications-using-authentication-and-authorization/_static/image6.png)

Если вместо SQL Express, мы хотели использовать полный экземпляр SQL Server (или подключения к удаленной базе данных), мы все необходимые задачи — обновить строки подключения «ApplicationServices» в файле web.config и убедитесь, что соответствующее членство схемы будет добавлен в базу данных, которую он указывает на. Можно запустить «aspnet\_regsql.exe» служебной программы в каталоге \Windows\Microsoft.NET\Framework\v2.0.50727\ для добавления соответствующей схемы членства и другим службам приложения ASP.NET в базе данных.

### <a name="authorizing-the-dinnerscreate-url-using-the-authorize-filter"></a>Авторизация ужинов/создать URL-адрес, с помощью фильтра [Authorize]

Написание кода для обеспечения безопасной проверки подлинности и реализация управления учетной записи для приложения обновление NerdDinner не пришлось. Пользователи могут зарегистрировать новые учетные записи с нашими приложения и имя входа и выхода из системы сайта.

Теперь мы можно добавить логику авторизации для приложения и позволяет контролировать то, что они не поддерживается на узле состояние проверки подлинности и имя пользователя посетителей. Начнем с добавления логики авторизации к методам действий класса DinnersController «Создать». В частности, это будет требовать пользователей, обращающихся к */ужинов/Create* URL-адрес необходимо выполнить вход. Если они не вошли в мы будем перенаправит их на страницу входа, чтобы они могут войти.

Реализация этой логики является довольно просто. Все, что нам нужно задача — добавить атрибут [Authorize] фильтр нашей создавать методы действий следующим образом:

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample1.cs)]

ASP.NET MVC поддерживает возможность создания «фильтры действий», которые могут использоваться для реализации многократно используемые логику, которая может применяться декларативно методам действий. Фильтр [Authorize] — это один из встроенных действий фильтров, предоставляемых платформой ASP.NET MVC и позволяет разработчику декларативно правила авторизации применяются к методам действия и классы контроллера.

При применении без параметров (как выше) фильтра [Authorize] обеспечивает, что пользователя, выполняющего запрос метода действия, которые должны войти в – и он автоматически перенаправляет браузер на URL-адрес входа, если они не являются. При выполнении этого перенаправления, первоначально запрошенный URL-адрес передается как аргумент строки запроса (например: / Account/входа в систему? ReturnUrl = % 2fDinners % 2fCreate). AccountController затем перенаправляет пользователя обратно на первоначально запрошенный URL-адрес после их входа в систему.

Фильтр [Authorize] Дополнительно поддерживает возможность задать свойство «Пользователи» или «Роли», которое может использоваться для обеспечения, как вход в и в списке разрешенных пользователей или членом роли безопасности, разрешенных. Например приведенный ниже код позволяет только два отдельных пользователей, «scottgu» и «Гейтса», для доступа к URL-адрес ужинов/Create:

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample2.cs)]

Внедрение конкретного пользователя имена в коде в большей степени становится довольно без сопровождения хотя. Лучшим подходом является определение более высокого уровня «роли», код проверяет, а затем для сопоставления пользователей в роли, с помощью базы данных или системы active directory (включая фактическое сопоставление список хранятся в коде). ASP.NET включает в себя API-Интерфейс управления встроенные роли, а также набор встроенных поставщиков ролей (в том числе шаблоны для SQL и Active Directory), которые помогают выполнять сопоставление пользователя или роли. Затем следует обновить код, чтобы только пользователи в роли определенного «admin» для доступа к URL-адрес ужинов/Create:

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample3.cs)]

### <a name="using-the-useridentityname-property-when-creating-dinners"></a>С помощью свойства User.Identity.Name при создании ужинов

Мы можем извлечь имя пользователя вошедшего в систему в запрос, используя свойство User.Identity.Name предоставляется в базовом классе контроллера.

Ранее реализованная версии HTTP POST метода действия нашей Create() мы должны были жестко задано свойство «HostedBy» Dinner для статическая строка. Мы можно обновить этот код, чтобы вместо этого используйте свойство User.Identity.Name, а также автоматически добавлять Подтверждать для узла, создание компании Dinner:

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample4.cs)]

Так как мы добавили атрибут [Authorize] Create() метода, ASP.NET MVC обеспечивает, метод действия выполняется только при посещении ужинов/создать URL-адрес входа пользователя узле. Таким образом значение свойства User.Identity.Name всегда будет содержать допустимое имя пользователя.

### <a name="using-the-useridentityname-property-when-editing-dinners"></a>С помощью свойства User.Identity.Name при редактировании ужинов

Теперь добавим определенную логику авторизации, которая ограничивает доступ пользователей, чтобы они могли только изменять свойства ужинов, они размещаются.

Чтобы помочь в этом мы сначала добавим вспомогательный метод «IsHostedBy(username)» к нашей компании Dinner объекта (в пределах Dinner.cs разделяемого класса, созданному ранее). Этот вспомогательный метод возвращает значение true или false в зависимости от ли указанное имя пользователя соответствует свойству Dinner HostedBy и инкапсулирует логику, необходимую для выполнения сравнения строк без учета регистра из них:

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample5.cs)]

Затем будет добавлен атрибут [Authorize] к методам действий Edit() в нашем классе DinnersController. Это позволит гарантировать, что пользователь должен войти запрос */Dinners/Edit / [id]* URL-адрес.

Затем можно добавить код в нашем изменить методы, которые использует вспомогательный метод Dinner.IsHostedBy(username) убедиться, что вошедшего в систему пользователя соответствует узле компании Dinner. Если пользователь не является узел, мы будем отображение вида «InvalidOwner» и завершите работу запроса. Для этого кода выглядит следующим образом ниже.

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample6.cs)]

Мы затем щелкните правой кнопкой мыши каталог \Views\Dinners и выберите Добавить -&gt;просмотра команду меню, чтобы создать новое представление «InvalidOwner». Мы будем заполнить его с ниже сообщение об ошибке:

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample7.aspx)]

И теперь, когда пользователь пытается изменить dinner, которыми они не владеют, они получите сообщение об ошибке:

![](secure-applications-using-authentication-and-authorization/_static/image7.png)

Мы повторить эти шаги для методов действий Delete() в нашем контроллера для блокировки разрешение на удаление ужинов также и убедитесь, что его можно удалить только узел компании Dinner.

### <a name="showinghiding-edit-and-delete-links"></a>Изменить отображение или скрытие и удаление ссылки

Мы выполняется связывание Edit и Delete метода действия класса DinnersController нашей сведения о URL-адрес:

![](secure-applications-using-authentication-and-authorization/_static/image8.png)

В настоящее время мы продемонстрируем ссылки действий Edit и Delete, независимо от того, посетитель сведения о URL-адрес узла компании dinner. Позволяет изменить, чтобы ссылки отображаются только в том случае, если владелец компании dinner посетителя.

Метод действия Details() в нашем DinnersController получающий объект Dinner и затем передает его в качестве объекта модели для наших шаблон представления:

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample8.cs)]

Мы можем обновить нашей Просмотр шаблона, чтобы условно Показать или скрыть ссылки Edit и Delete с помощью Dinner.IsHostedBy(), вспомогательный метод, аналогичные показанным ниже:

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample9.aspx)]

#### <a name="next-steps"></a>Следующие шаги

Теперь взглянем на как можно включить прошедшим проверку пользователям RSVP для ужинов, с помощью AJAX.

> [!div class="step-by-step"]
> [Назад](implement-efficient-data-paging.md)
> [Вперед](use-ajax-to-deliver-dynamic-updates.md)
