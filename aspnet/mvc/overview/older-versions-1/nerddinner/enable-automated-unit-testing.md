---
uid: mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
title: "Включение автоматического тестирования модулей | Документы Microsoft"
author: microsoft
description: "Шаг 12 показано, как разработать набор автоматических модульных тестов, проверьте нашей обновление NerdDinner функциональность и которое даст нам достоверности для внесения изменений..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/27/2010
ms.topic: article
ms.assetid: a19ff2ce-3f7e-4358-9a51-a1403da9c63e
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
msc.type: authoredcontent
ms.openlocfilehash: 1a4258054d90b2d5bcc06a63fb6f3b4673a4837d
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="enable-automated-unit-testing"></a><span data-ttu-id="6def0-103">Включить автоматическое тестирование модулей</span><span class="sxs-lookup"><span data-stu-id="6def0-103">Enable Automated Unit Testing</span></span>
====================
<span data-ttu-id="6def0-104">по [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="6def0-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="6def0-105">Скачать PDF</span><span class="sxs-lookup"><span data-stu-id="6def0-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="6def0-106">Это шаг 12 бесплатных [учебника «Обновление NerdDinner» приложения](introducing-the-nerddinner-tutorial.md) , обходов сквозной как построить небольшой, но завершается веб-приложения с помощью ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="6def0-106">This is step 12 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="6def0-107">Шаг 12 показано, как разработать набор автоматических модульных тестов, проверьте нашей обновление NerdDinner функциональность и которое даст нам уверенность в том, вносить изменения и усовершенствования для приложения в будущем.</span><span class="sxs-lookup"><span data-stu-id="6def0-107">Step 12 shows how to develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>
> 
> <span data-ttu-id="6def0-108">При использовании ASP.NET MVC 3, которому рекомендуется следовать [Приступая к работе с MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) или [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) учебники.</span><span class="sxs-lookup"><span data-stu-id="6def0-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-12-unit-testing"></a><span data-ttu-id="6def0-109">Обновление NerdDinner шаг 12: Модульное тестирование</span><span class="sxs-lookup"><span data-stu-id="6def0-109">NerdDinner Step 12: Unit Testing</span></span>

<span data-ttu-id="6def0-110">Давайте разработать набор автоматических модульных тестов, проверьте нашей обновление NerdDinner функциональность и которое даст нам уверенность в том, вносить изменения и усовершенствования для приложения в будущем.</span><span class="sxs-lookup"><span data-stu-id="6def0-110">Let's develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>

### <a name="why-unit-test"></a><span data-ttu-id="6def0-111">Почему модульный тест?</span><span class="sxs-lookup"><span data-stu-id="6def0-111">Why Unit Test?</span></span>

<span data-ttu-id="6def0-112">На диске в документе одного утром иметь внезапное flash вдохновения о приложении, над которым вы работаете.</span><span class="sxs-lookup"><span data-stu-id="6def0-112">On the drive into work one morning you have a sudden flash of inspiration about an application you are working on.</span></span> <span data-ttu-id="6def0-113">Необходимо учесть, что изменений, можно реализовать, значительно улучшить приложение.</span><span class="sxs-lookup"><span data-stu-id="6def0-113">You realize there is a change you can implement that will make the application dramatically better.</span></span> <span data-ttu-id="6def0-114">Возможно, рефакторинг, очищает код добавляет новый компонент и исправляет ошибку.</span><span class="sxs-lookup"><span data-stu-id="6def0-114">It might be a refactoring that cleans up the code, adds a new feature, or fixes a bug.</span></span>

<span data-ttu-id="6def0-115">На вопрос, вы confronts, когда поступают на компьютер — «safe это делать это улучшение?»</span><span class="sxs-lookup"><span data-stu-id="6def0-115">The question that confronts you when you arrive at your computer is – "how safe is it to make this improvement?"</span></span> <span data-ttu-id="6def0-116">Что делать, если внесения изменений имеет побочные эффекты или что-то разрывы?</span><span class="sxs-lookup"><span data-stu-id="6def0-116">What if making the change has side effects or breaks something?</span></span> <span data-ttu-id="6def0-117">Изменения могут быть простыми и занимает несколько минут для реализации, но что делать, если требуется часы, можно вручную проверить во всех сценариях приложения?</span><span class="sxs-lookup"><span data-stu-id="6def0-117">The change might be simple and only take a few minutes to implement, but what if it takes hours to manually test out all of the application scenarios?</span></span> <span data-ttu-id="6def0-118">Что делать, если забыт описать сценарий и неработающие приложение выходит в производство?</span><span class="sxs-lookup"><span data-stu-id="6def0-118">What if you forget to cover a scenario and a broken application goes into production?</span></span> <span data-ttu-id="6def0-119">Делает это улучшение действительно стоит все?</span><span class="sxs-lookup"><span data-stu-id="6def0-119">Is making this improvement really worth all the effort?</span></span>

<span data-ttu-id="6def0-120">Автоматические модульные тесты обеспечивают средство подстраховки, которая позволяет непрерывно улучшения приложений и избежать опасаться кода, над которым вы работаете.</span><span class="sxs-lookup"><span data-stu-id="6def0-120">Automated unit tests can provide a safety net that enables you to continually enhance your applications, and avoid being afraid of the code you are working on.</span></span> <span data-ttu-id="6def0-121">Автоматических тестов, которые быстро убедитесь, что позволяет уверенно — код, а также расширяет возможности для внесения изменений, вы может в противном случае не испытывали удобнее делать.</span><span class="sxs-lookup"><span data-stu-id="6def0-121">Having automated tests that quickly verify functionality enables you to code with confidence – and empower you to make improvements you might otherwise not have felt comfortable doing.</span></span> <span data-ttu-id="6def0-122">Они также помогут создать более простого в сопровождении решения и имеют больше времени жизни - какие интересы гораздо выше рентабельность инвестиций.</span><span class="sxs-lookup"><span data-stu-id="6def0-122">They also help create solutions that are more maintainable and have a longer lifetime - which leads to a much higher return on investment.</span></span>

<span data-ttu-id="6def0-123">Платформа ASP.NET MVC позволяет легко и естественным функции приложения модульного тестирования.</span><span class="sxs-lookup"><span data-stu-id="6def0-123">The ASP.NET MVC Framework makes it easy and natural to unit test application functionality.</span></span> <span data-ttu-id="6def0-124">Она также позволяет проверить управляемую разработки (TDD) рабочий процесс, который позволяет осуществлять разработку на основе тестирования.</span><span class="sxs-lookup"><span data-stu-id="6def0-124">It also enables a Test Driven Development (TDD) workflow that enables test-first based development.</span></span>

### <a name="nerddinnertests-project"></a><span data-ttu-id="6def0-125">NerdDinner.Tests проекта</span><span class="sxs-lookup"><span data-stu-id="6def0-125">NerdDinner.Tests Project</span></span>

<span data-ttu-id="6def0-126">Если мы создали нашего приложения обновление NerdDinner в начале этого учебника, мы были будет появляться диалоговое окно подтверждения ли мы хотели создать проект модульных тестов направляются вместе с проектом приложения:</span><span class="sxs-lookup"><span data-stu-id="6def0-126">When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go along with the application project:</span></span>

![](enable-automated-unit-testing/_static/image1.png)

<span data-ttu-id="6def0-127">Мы хранится этот «Да, создать проект модульного теста» переключатель — что привело к «NerdDinner.Tests» проекта, добавляемое в нашем решении:</span><span class="sxs-lookup"><span data-stu-id="6def0-127">We kept the "Yes, create a unit test project" radio button selected – which resulted in a "NerdDinner.Tests" project being added to our solution:</span></span>

![](enable-automated-unit-testing/_static/image2.png)

<span data-ttu-id="6def0-128">NerdDinner.Tests проект ссылается на сборку проекта приложения обновление NerdDinner и позволяет легко добавлять автоматические тесты, проверить работоспособность приложения его.</span><span class="sxs-lookup"><span data-stu-id="6def0-128">The NerdDinner.Tests project references the NerdDinner application project assembly, and enables us to easily add automated tests to it that verify the application functionality.</span></span>

### <a name="creating-unit-tests-for-our-dinner-model-class"></a><span data-ttu-id="6def0-129">Создание модульных тестов для нашей компании Dinner класс модели</span><span class="sxs-lookup"><span data-stu-id="6def0-129">Creating Unit Tests for our Dinner Model Class</span></span>

<span data-ttu-id="6def0-130">Наш проект NerdDinner.Tests, проверить Dinner класс, созданный при уровень нашей модели мы добавим некоторые тесты.</span><span class="sxs-lookup"><span data-stu-id="6def0-130">Let's add some tests to our NerdDinner.Tests project that verify the Dinner class we created when we built our model layer.</span></span>

<span data-ttu-id="6def0-131">Мы начнем с создания новой папки в нашем тестовый проект называется «Моделей», куда будет помещать наших тестов, связанных с моделью.</span><span class="sxs-lookup"><span data-stu-id="6def0-131">We'll start by creating a new folder within our test project called "Models" where we'll place our model-related tests.</span></span> <span data-ttu-id="6def0-132">Мы затем правой кнопкой мыши папку и выберите **Add -&gt;новый тест** команду меню.</span><span class="sxs-lookup"><span data-stu-id="6def0-132">We'll then right-click on the folder and choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="6def0-133">Откроется диалоговое окно «Добавление нового теста».</span><span class="sxs-lookup"><span data-stu-id="6def0-133">This will bring up the "Add New Test" dialog.</span></span>

<span data-ttu-id="6def0-134">Мы выберем создание «Модульный тест» и присвойте ей имя «DinnerTest.cs»:</span><span class="sxs-lookup"><span data-stu-id="6def0-134">We'll choose to create a "Unit Test" and name it "DinnerTest.cs":</span></span>

![](enable-automated-unit-testing/_static/image3.png)

<span data-ttu-id="6def0-135">При нажатии кнопки «ОК» Visual Studio Добавление (и откройте) DinnerTest.cs файл в проект.</span><span class="sxs-lookup"><span data-stu-id="6def0-135">When we click the "ok" button Visual Studio will add (and open) a DinnerTest.cs file to the project:</span></span>

![](enable-automated-unit-testing/_static/image4.png)

<span data-ttu-id="6def0-136">Шаблон по умолчанию Visual Studio модульного теста имеет множество код шаблона формы в ней, найти несколько запутанным.</span><span class="sxs-lookup"><span data-stu-id="6def0-136">The default Visual Studio unit test template has a bunch of boiler-plate code within it that I find a little messy.</span></span> <span data-ttu-id="6def0-137">Давайте очистить просто содержать следующий код:</span><span class="sxs-lookup"><span data-stu-id="6def0-137">Let's clean it up to just contain the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample1.cs)]

<span data-ttu-id="6def0-138">Атрибут [TestClass] выше DinnerTest класса идентифицирует его как класс, который будет содержать тесты, а также дополнительный тест инициализации и уничтожения кода.</span><span class="sxs-lookup"><span data-stu-id="6def0-138">The [TestClass] attribute on the DinnerTest class above identifies it as a class that will contain tests, as well as optional test initialization and teardown code.</span></span> <span data-ttu-id="6def0-139">Тесты в нем можно определить путем добавления открытые методы с атрибутом [TestMethod] на них.</span><span class="sxs-lookup"><span data-stu-id="6def0-139">We can define tests within it by adding public methods that have a [TestMethod] attribute on them.</span></span>

<span data-ttu-id="6def0-140">Ниже приведены первое из двух тестов для, мы добавим наш класс Dinner.</span><span class="sxs-lookup"><span data-stu-id="6def0-140">Below are the first of two tests we'll add that exercise our Dinner class.</span></span> <span data-ttu-id="6def0-141">Первый тест проверяет, что нашей компании Dinner недопустим, если новый Dinner создается без правильно задать все свойства.</span><span class="sxs-lookup"><span data-stu-id="6def0-141">The first test verifies that our Dinner is invalid if a new Dinner is created without all properties being set correctly.</span></span> <span data-ttu-id="6def0-142">Второй тест проверяет действительность нашей компании Dinner при Dinner имеет все свойства, заданные с допустимыми значениями:</span><span class="sxs-lookup"><span data-stu-id="6def0-142">The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample2.cs)]

<span data-ttu-id="6def0-143">Можно заметить выше, нашей имен тестов явным образом указать (и немного verbose).</span><span class="sxs-lookup"><span data-stu-id="6def0-143">You'll notice above that our test names are very explicit (and somewhat verbose).</span></span> <span data-ttu-id="6def0-144">Мы делаем, так как мы может оказаться, что создание сотен или тысяч небольших тестов, и мы хотели бы просто быстро определить назначение и поведение каждого из них (особенно если мы ищем по списку ошибок в test runner).</span><span class="sxs-lookup"><span data-stu-id="6def0-144">We are doing this because we might end up creating hundreds or thousands of small tests, and we want to make it easy to quickly determine the intent and behavior of each of them (especially when we are looking through a list of failures in a test runner).</span></span> <span data-ttu-id="6def0-145">Имена теста должна быть названа функциональные возможности, которые они предназначены для проверки.</span><span class="sxs-lookup"><span data-stu-id="6def0-145">The test names should be named after the functionality they are testing.</span></span> <span data-ttu-id="6def0-146">Выше мы используем «существительное\_следует\_команда «шаблон именования.</span><span class="sxs-lookup"><span data-stu-id="6def0-146">Above we are using a "Noun\_Should\_Verb" naming pattern.</span></span>

<span data-ttu-id="6def0-147">Мы структурирование тестов с помощью pattern — предназначенную для «Упорядочить, Act, Assert» тестирование «AAA»:</span><span class="sxs-lookup"><span data-stu-id="6def0-147">We are structuring the tests using the "AAA" testing pattern – which stands for "Arrange, Act, Assert":</span></span>

- <span data-ttu-id="6def0-148">Упорядочить: Настройка тестируемой единицы</span><span class="sxs-lookup"><span data-stu-id="6def0-148">Arrange: Setup the unit being tested</span></span>
- <span data-ttu-id="6def0-149">ACT: Именно модульного теста и записать результаты</span><span class="sxs-lookup"><span data-stu-id="6def0-149">Act: Exercise the unit under test and capture results</span></span>
- <span data-ttu-id="6def0-150">Assert: Проверки поведения</span><span class="sxs-lookup"><span data-stu-id="6def0-150">Assert: Verify the behavior</span></span>

<span data-ttu-id="6def0-151">При написании тестов, мы хотим, чтобы избежать необходимости отдельных тестов делать слишком много.</span><span class="sxs-lookup"><span data-stu-id="6def0-151">When we write tests we want to avoid having the individual tests do too much.</span></span> <span data-ttu-id="6def0-152">Вместо этого каждый тест следует проверить только один понятием (который будет значительно упростит для выявления причины сбоев).</span><span class="sxs-lookup"><span data-stu-id="6def0-152">Instead each test should verify only a single concept (which will make it much easier to pinpoint the cause of failures).</span></span> <span data-ttu-id="6def0-153">Рекомендуется является попробовать и иметь только один assert инструкции для каждого теста.</span><span class="sxs-lookup"><span data-stu-id="6def0-153">A good guideline is to try and only have a single assert statement for each test.</span></span> <span data-ttu-id="6def0-154">Если имеется более одного оператора в методе теста контроля, убедитесь, что они все используются для тестирования то же самое.</span><span class="sxs-lookup"><span data-stu-id="6def0-154">If you have more than one assert statement in a test method, make sure they are all being used to test the same concept.</span></span> <span data-ttu-id="6def0-155">Если вы сомневаетесь, сделайте еще один тест.</span><span class="sxs-lookup"><span data-stu-id="6def0-155">When in doubt, make another test.</span></span>

### <a name="running-tests"></a><span data-ttu-id="6def0-156">Запущенные тесты</span><span class="sxs-lookup"><span data-stu-id="6def0-156">Running Tests</span></span>

<span data-ttu-id="6def0-157">Visual Studio 2008 Professional (и более поздних версий) включает встроенные тестов, которые можно использовать для выполнения модульных тестов Visual Studio проектов в среде IDE.</span><span class="sxs-lookup"><span data-stu-id="6def0-157">Visual Studio 2008 Professional (and higher editions) includes a built-in test runner that can be used to run Visual Studio Unit Test projects within the IDE.</span></span> <span data-ttu-id="6def0-158">Мы можем выбрать **Test -&gt;выполнения -&gt;все тесты в решении** меню команд (или типа Ctrl R A) для выполнения всех наших модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="6def0-158">We can select the **Test-&gt;Run-&gt;All Tests in Solution** menu command (or type Ctrl R, A) to run all of our unit tests.</span></span> <span data-ttu-id="6def0-159">Или в качестве альтернативы можно позиционировать наши курсор в методе класса или тестирования конкретного теста и использовать **Test -&gt;выполнения -&gt;тесты в текущем контексте** команду меню (или тип Ctrl R, T) для выполнения подмножества модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="6def0-159">Or alternatively we can position our cursor within a specific test class or test method and use the **Test-&gt;Run-&gt;Tests in Current Context** menu command (or type Ctrl R, T) to run a subset of the unit tests.</span></span>

<span data-ttu-id="6def0-160">Давайте поместите нашей курсор в пределах класса DinnerTest и введите «Ctrl R, T» для выполнения двух тестов, который мы только что определили.</span><span class="sxs-lookup"><span data-stu-id="6def0-160">Let's position our cursor within the DinnerTest class and type "Ctrl R, T" to run the two tests we just defined.</span></span> <span data-ttu-id="6def0-161">Когда мы делаем это окне «Результаты теста» появится в среде Visual Studio, и мы рассмотрим результаты выполнения наших теста перечислены внутри его:</span><span class="sxs-lookup"><span data-stu-id="6def0-161">When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span></span>

![](enable-automated-unit-testing/_static/image5.png)

<span data-ttu-id="6def0-162">*Примечание: В окне результатов теста VS не содержит столбца имя класса по умолчанию. Это можно добавить, щелкнув правой кнопкой мыши в окне результатов теста и с помощью команды меню Добавление и удаление столбцов.*</span><span class="sxs-lookup"><span data-stu-id="6def0-162">*Note: The VS test results window does not show the Class Name column by default. You can add this by right-clicking within the Test Results window and using the Add/Remove Columns menu command.*</span></span>

<span data-ttu-id="6def0-163">Наши тесты два заняло долю секунды для выполнения — и как можно оба они передаются см.</span><span class="sxs-lookup"><span data-stu-id="6def0-163">Our two tests took only a fraction of a second to run – and as you can see they both passed.</span></span> <span data-ttu-id="6def0-164">Теперь можно перейти и расширить их путем создания другие тесты, которые можно проверить определенные правила проверки, а также рассматриваются два вспомогательных метода - IsUserHost() и IsUserRegisterd() —, мы добавили в класс Dinner.</span><span class="sxs-lookup"><span data-stu-id="6def0-164">We can now go on and augment them by creating additional tests that verify specific rule validations, as well as cover the two helper methods - IsUserHost() and IsUserRegisterd() – that we added to the Dinner class.</span></span> <span data-ttu-id="6def0-165">Наличие этих тестов для класса Dinner сделает намного легче и безопаснее добавить новые бизнес-правила, связанные с защитой к нему в будущем.</span><span class="sxs-lookup"><span data-stu-id="6def0-165">Having all these tests in place for the Dinner class will make it much easier and safer to add new business rules and validations to it in the future.</span></span> <span data-ttu-id="6def0-166">Мы добавить новое правило логику на обед и затем за несколько секунд убедиться, что он еще не нарушают любой из наших прежние функции логики.</span><span class="sxs-lookup"><span data-stu-id="6def0-166">We can add our new rule logic to Dinner, and then within seconds verify that it hasn't broken any of our previous logic functionality.</span></span>

<span data-ttu-id="6def0-167">Обратите внимание на то, как с помощью имени описательные теста позволяет легко понять, что проверка каждого теста.</span><span class="sxs-lookup"><span data-stu-id="6def0-167">Notice how using a descriptive test name makes it easy to quickly understand what each test is verifying.</span></span> <span data-ttu-id="6def0-168">Рекомендуется использовать **Сервис -&gt;параметры** команды меню, открыв тестирования Сервис -&gt;экран настройки выполнения тестов и проверки» дважды щелкните результат теста модульных отказавших или неопределенным результатом отображается флажок точки сбоя в тесте».</span><span class="sxs-lookup"><span data-stu-id="6def0-168">I recommend using the **Tools-&gt;Options** menu command, opening the Test Tools-&gt;Test Execution configuration screen, and checking the "Double-clicking a failed or inconclusive unit test result displays the point of failure in the test" checkbox.</span></span> <span data-ttu-id="6def0-169">Это позволит вам дважды щелкнуть при сбое в окне результатов теста и мгновенного перехода к предположение сбоя.</span><span class="sxs-lookup"><span data-stu-id="6def0-169">This will allow you to double-click on a failure in the test results window and jump immediately to the assert failure.</span></span>

### <a name="creating-dinnerscontroller-unit-tests"></a><span data-ttu-id="6def0-170">Создание DinnersController модульных тестов</span><span class="sxs-lookup"><span data-stu-id="6def0-170">Creating DinnersController Unit Tests</span></span>

<span data-ttu-id="6def0-171">Теперь создадим несколько модульных тестов, проверьте нашей DinnersController функциональность.</span><span class="sxs-lookup"><span data-stu-id="6def0-171">Let's now create some unit tests that verify our DinnersController functionality.</span></span> <span data-ttu-id="6def0-172">Мы запустить, щелкнув папку «Контроллеры» в нашем тестовый проект и затем выберите **Add -&gt;новый тест** команду меню.</span><span class="sxs-lookup"><span data-stu-id="6def0-172">We'll start by right-clicking on the "Controllers" folder within our Test project and then choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="6def0-173">Мы Создание «Модульного теста» и присвойте ей имя «DinnersControllerTest.cs».</span><span class="sxs-lookup"><span data-stu-id="6def0-173">We'll create a "Unit Test" and name it "DinnersControllerTest.cs".</span></span>

<span data-ttu-id="6def0-174">Мы создадим двух методах теста, метод действия Details() на DinnersController проверки.</span><span class="sxs-lookup"><span data-stu-id="6def0-174">We'll create two test methods that verify the Details() action method on the DinnersController.</span></span> <span data-ttu-id="6def0-175">Первый убедитесь, что представление возвращается при запросе существующие компании Dinner.</span><span class="sxs-lookup"><span data-stu-id="6def0-175">The first will verify that a View is returned when an existing Dinner is requested.</span></span> <span data-ttu-id="6def0-176">Второй проверит, представление «NotFound» возвращается при запросе Dinner несуществующий:</span><span class="sxs-lookup"><span data-stu-id="6def0-176">The second will verify that a "NotFound" view is returned when a non-existent Dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample3.cs)]

<span data-ttu-id="6def0-177">Приведенный выше код компилирует очистки.</span><span class="sxs-lookup"><span data-stu-id="6def0-177">The above code compiles clean.</span></span> <span data-ttu-id="6def0-178">При выполнении тестов, однако их сбоев:</span><span class="sxs-lookup"><span data-stu-id="6def0-178">When we run the tests, though, they both fail:</span></span>

![](enable-automated-unit-testing/_static/image6.png)

<span data-ttu-id="6def0-179">Если взглянуть на сообщения об ошибках, мы рассмотрим, что причина не удалось выполнить тесты не поскольку наш класс DinnersRepository не удалось подключиться к базе данных.</span><span class="sxs-lookup"><span data-stu-id="6def0-179">If we look at the error messages, we'll see that the reason the tests failed was because our DinnersRepository class was unable to connect to a database.</span></span> <span data-ttu-id="6def0-180">Обновление NerdDinner приложение использует строку подключения в локальный файл SQL Server Express, которая работает под \App\_каталог данных обновление NerdDinner проекта приложения.</span><span class="sxs-lookup"><span data-stu-id="6def0-180">Our NerdDinner application is using a connection-string to a local SQL Server Express file which lives under the \App\_Data directory of the NerdDinner application project.</span></span> <span data-ttu-id="6def0-181">Поскольку наш NerdDinner.Tests проект компилируется и выполняется в другом каталоге, выберите проект приложения, неверное расположение относительный путь нашу строку подключения.</span><span class="sxs-lookup"><span data-stu-id="6def0-181">Because our NerdDinner.Tests project compiles and runs in a different directory then the application project, the relative path location of our connection-string is incorrect.</span></span>

<span data-ttu-id="6def0-182">Мы *удалось* устранить эту проблему, скопировав файл базы данных SQL Express нашей тестовый проект, а затем добавьте соответствующий тест строки подключения к ней в файле App.config нашей тестового проекта.</span><span class="sxs-lookup"><span data-stu-id="6def0-182">We *could* fix this by copying the SQL Express database file to our test project, and then add an appropriate test connection-string to it in the App.config of our test project.</span></span> <span data-ttu-id="6def0-183">Это будет получена вышеуказанные тесты, разблокирован и запущена.</span><span class="sxs-lookup"><span data-stu-id="6def0-183">This would get the above tests unblocked and running.</span></span>

<span data-ttu-id="6def0-184">Модульное тестирование кода, с помощью реальной базы данных, однако, предлагает ряд проблем.</span><span class="sxs-lookup"><span data-stu-id="6def0-184">Unit testing code using a real database, though, brings with it a number of challenges.</span></span> <span data-ttu-id="6def0-185">В частности:</span><span class="sxs-lookup"><span data-stu-id="6def0-185">Specifically:</span></span>

- <span data-ttu-id="6def0-186">Она значительно замедляет времени выполнения модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="6def0-186">It significantly slows down the execution time of unit tests.</span></span> <span data-ttu-id="6def0-187">Чем дольше необходимое для выполнения тестов, тем меньше вероятность будут часто выполнять их.</span><span class="sxs-lookup"><span data-stu-id="6def0-187">The longer it takes to run tests, the less likely you are to execute them frequently.</span></span> <span data-ttu-id="6def0-188">В идеальном случае требуется модульные тесты, чтобы иметь возможность выполнения в секундах — и должны быть сделать как естественным образом, что компиляция проекта.</span><span class="sxs-lookup"><span data-stu-id="6def0-188">Ideally you want your unit tests to be able to be run in seconds – and have it be something you do as naturally as compiling the project.</span></span>
- <span data-ttu-id="6def0-189">Он усложняет логику установки и очистки в тесты.</span><span class="sxs-lookup"><span data-stu-id="6def0-189">It complicates the setup and cleanup logic within tests.</span></span> <span data-ttu-id="6def0-190">Требуется, чтобы каждый модульный тест для изолированной и независимым от остальных (с побочных эффектов или зависимостей).</span><span class="sxs-lookup"><span data-stu-id="6def0-190">You want each unit test to be isolated and independent of others (with no side effects or dependencies).</span></span> <span data-ttu-id="6def0-191">При работе в реальной базе данных необходимо учитывать состояние и выполнить его сброс между тестами.</span><span class="sxs-lookup"><span data-stu-id="6def0-191">When working against a real database you have to be mindful of state and reset it between tests.</span></span>

<span data-ttu-id="6def0-192">Давайте взглянем на шаблон, который называется «инъекция зависимостей», которые могут помочь нам решить эти проблемы и избежать необходимости использования реальной базы данных с помощью наших тестов.</span><span class="sxs-lookup"><span data-stu-id="6def0-192">Let's look at a design pattern called "dependency injection" that can help us work around these issues and avoid the need to use a real database with our tests.</span></span>

### <a name="dependency-injection"></a><span data-ttu-id="6def0-193">Внедрение зависимостей</span><span class="sxs-lookup"><span data-stu-id="6def0-193">Dependency Injection</span></span>

<span data-ttu-id="6def0-194">В данный момент DinnersController тесно» связана» в класс DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="6def0-194">Right now DinnersController is tightly "coupled" to the DinnerRepository class.</span></span> <span data-ttu-id="6def0-195">«Соединение» относится к ситуации, когда класс явным образом зависит от другого класса для работы:</span><span class="sxs-lookup"><span data-stu-id="6def0-195">"Coupling" refers to a situation where a class explicitly relies on another class in order to work:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample4.cs)]

<span data-ttu-id="6def0-196">Поскольку класс DinnerRepository требуется доступ к базе данных, тесно связанные зависимости DinnersController класс имеет на концах DinnerRepository копии требует нам действующим DinnersController методы действий для тестирования базы данных.</span><span class="sxs-lookup"><span data-stu-id="6def0-196">Because the DinnerRepository class requires access to a database, the tightly coupled dependency the DinnersController class has on the DinnerRepository ends up requiring us to have a database in order for the DinnersController action methods to be tested.</span></span>

<span data-ttu-id="6def0-197">Можно обойти это, создав шаблон, который называется «внедрения зависимостей» — это подход, где больше не неявного создания зависимости (например, репозиторий классы, обеспечивающие доступ к данным) в классах, которые их используют.</span><span class="sxs-lookup"><span data-stu-id="6def0-197">We can get around this by employing a design pattern called "dependency injection" – which is an approach where dependencies (like repository classes that provide data access) are no longer implicitly created within classes that use them.</span></span> <span data-ttu-id="6def0-198">Вместо этого зависимости можно явно передать класс, который использует их с помощью аргументов конструктора.</span><span class="sxs-lookup"><span data-stu-id="6def0-198">Instead, dependencies can be explicitly passed to the class that uses them using constructor arguments.</span></span> <span data-ttu-id="6def0-199">Если зависимости определяются с помощью интерфейсов, мы получаем гибкость для передачи в реализациях «фиктивное» зависимостей для сценариев модульного тестирования.</span><span class="sxs-lookup"><span data-stu-id="6def0-199">If the dependencies are defined using interfaces, we then have the flexibility to pass in "fake" dependency implementations for unit test scenarios.</span></span> <span data-ttu-id="6def0-200">Это позволяет создать реализации зависимостей конкретного теста, которые фактически не требуется доступ к базе данных.</span><span class="sxs-lookup"><span data-stu-id="6def0-200">This enables us to create test-specific dependency implementations that do not actually require access to a database.</span></span>

<span data-ttu-id="6def0-201">Чтобы увидеть это в действии, давайте реализовать внедрение зависимостей в нашем DinnersController.</span><span class="sxs-lookup"><span data-stu-id="6def0-201">To see this in action, let's implement dependency injection with our DinnersController.</span></span>

#### <a name="extracting-an-idinnerrepository-interface"></a><span data-ttu-id="6def0-202">Извлечение интерфейса IDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="6def0-202">Extracting an IDinnerRepository interface</span></span>

<span data-ttu-id="6def0-203">Наш первым шагом является создание новый интерфейс IDinnerRepository, инкапсулирующий нашей контроллеров, необходимых для извлечения и обновления ужинов контракт репозитория.</span><span class="sxs-lookup"><span data-stu-id="6def0-203">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span></span>

<span data-ttu-id="6def0-204">Этот интерфейс контракта можно определить вручную, щелкнув правой кнопкой мыши по папке \Models и выбрав **Add -&gt;новый элемент** команды меню и создать новый интерфейс с именем IDinnerRepository.cs.</span><span class="sxs-lookup"><span data-stu-id="6def0-204">We can define this interface contract manually by right-clicking on the \Models folder, and then choosing the **Add-&gt;New Item** menu command and creating a new interface named IDinnerRepository.cs.</span></span>

<span data-ttu-id="6def0-205">Также мы извлечения рефакторинга средства встроены в Visual Studio Professional (и более поздних версий), чтобы автоматически использовать и создать интерфейс для нас из наших существующий класс DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="6def0-205">Alternatively we can use the refactoring tools built-into Visual Studio Professional (and higher editions) to automatically extract and create an interface for us from our existing DinnerRepository class.</span></span> <span data-ttu-id="6def0-206">Чтобы извлечь этот интерфейс, с помощью VS, просто поместите курсор в редакторе текста в классе DinnerRepository и затем щелкните правой кнопкой мыши и выберите **рефакторинга -&gt;извлечение интерфейса** команды меню:</span><span class="sxs-lookup"><span data-stu-id="6def0-206">To extract this interface using VS, simply position the cursor in the text editor on the DinnerRepository class, and then right-click and choose the **Refactor-&gt;Extract Interface** menu command:</span></span>

![](enable-automated-unit-testing/_static/image7.png)

<span data-ttu-id="6def0-207">Будет запуска диалогового окна «Извлечение интерфейса» и нам запрашивать имя интерфейса, для создания.</span><span class="sxs-lookup"><span data-stu-id="6def0-207">This will launch the "Extract Interface" dialog and prompt us for the name of the interface to create.</span></span> <span data-ttu-id="6def0-208">Он будет по умолчанию IDinnerRepository и автоматически выбрать все открытые методы в классе DinnerRepository Добавление интерфейса:</span><span class="sxs-lookup"><span data-stu-id="6def0-208">It will default to IDinnerRepository and automatically select all public methods on the existing DinnerRepository class to add to the interface:</span></span>

![](enable-automated-unit-testing/_static/image8.png)

<span data-ttu-id="6def0-209">При нажатии кнопки «ОК», Visual Studio добавит новый интерфейс IDinnerRepository наше приложение:</span><span class="sxs-lookup"><span data-stu-id="6def0-209">When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample5.cs)]

<span data-ttu-id="6def0-210">И наши существующий класс DinnerRepository будет обновлен, чтобы он реализовал интерфейс:</span><span class="sxs-lookup"><span data-stu-id="6def0-210">And our existing DinnerRepository class will be updated so that it implements the interface:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample6.cs)]

#### <a name="updating-dinnerscontroller-to-support-constructor-injection"></a><span data-ttu-id="6def0-211">Обновление DinnersController для поддержки внедрение конструктора</span><span class="sxs-lookup"><span data-stu-id="6def0-211">Updating DinnersController to support constructor injection</span></span>

<span data-ttu-id="6def0-212">Теперь мы сообщим DinnersController классом, который используется новый интерфейс.</span><span class="sxs-lookup"><span data-stu-id="6def0-212">We'll now update the DinnersController class to use the new interface.</span></span>

<span data-ttu-id="6def0-213">В настоящее время DinnersController является жестко таким образом, что его поля «dinnerRepository» всегда является классом DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="6def0-213">Currently DinnersController is hard-coded such that its "dinnerRepository" field is always a DinnerRepository class:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample7.cs)]

<span data-ttu-id="6def0-214">Мы изменим ее так, чтобы в поле «dinnerRepository» IDinnerRepository вместо DinnerRepository типа.</span><span class="sxs-lookup"><span data-stu-id="6def0-214">We'll change it so that the "dinnerRepository" field is of type IDinnerRepository instead of DinnerRepository.</span></span> <span data-ttu-id="6def0-215">Затем мы добавим два открытых конструкторов DinnersController.</span><span class="sxs-lookup"><span data-stu-id="6def0-215">We'll then add two public DinnersController constructors.</span></span> <span data-ttu-id="6def0-216">Один из конструкторов позволяет IDinnerRepository передается как аргумент.</span><span class="sxs-lookup"><span data-stu-id="6def0-216">One of the constructors allows an IDinnerRepository to be passed as an argument.</span></span> <span data-ttu-id="6def0-217">Второе — конструктор по умолчанию, который использует реализацию существующего DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="6def0-217">The other is a default constructor that uses our existing DinnerRepository implementation:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample8.cs)]

<span data-ttu-id="6def0-218">Так как ASP.NET MVC по умолчанию создает классы контроллера с помощью конструкторы по умолчанию, наши DinnersController во время выполнения будет продолжать класс DinnerRepository для осуществления доступа к данным.</span><span class="sxs-lookup"><span data-stu-id="6def0-218">Because ASP.NET MVC by default creates controller classes using default constructors, our DinnersController at runtime will continue to use the DinnerRepository class to perform data access.</span></span>

<span data-ttu-id="6def0-219">Теперь мы можем обновить нашей модульные тесты, однако для передачи в реализации репозитория «фиктивное» компании dinner, с помощью параметра конструктора.</span><span class="sxs-lookup"><span data-stu-id="6def0-219">We can now update our unit tests, though, to pass in a "fake" dinner repository implementation using the parameter constructor.</span></span> <span data-ttu-id="6def0-220">Этот репозиторий «фиктивное» компании dinner не требуется доступ к реальной базы данных и вместо этого будет использовать данные в памяти.</span><span class="sxs-lookup"><span data-stu-id="6def0-220">This "fake" dinner repository will not require access to a real database, and instead will use in-memory sample data.</span></span>

#### <a name="creating-the-fakedinnerrepository-class"></a><span data-ttu-id="6def0-221">Создание класса FakeDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="6def0-221">Creating the FakeDinnerRepository class</span></span>

<span data-ttu-id="6def0-222">Давайте создадим класс FakeDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="6def0-222">Let's create a FakeDinnerRepository class.</span></span>

<span data-ttu-id="6def0-223">Мы начнем с создания каталога «Fakes» в данном проекте NerdDinner.Tests и затем добавить в нее новый класс FakeDinnerRepository (щелкните правой кнопкой мыши папку и выберите **Add -&gt;новый класс**):</span><span class="sxs-lookup"><span data-stu-id="6def0-223">We'll begin by creating a "Fakes" directory within our NerdDinner.Tests project and then add a new FakeDinnerRepository class to it (right-click on the folder and choose **Add-&gt;New Class**):</span></span>

![](enable-automated-unit-testing/_static/image9.png)

<span data-ttu-id="6def0-224">Код будет обновлена, чтобы класс FakeDinnerRepository реализует интерфейс IDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="6def0-224">We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span></span> <span data-ttu-id="6def0-225">Мы затем правой кнопкой мыши и выберите из контекстного меню команду «Реализуйте интерфейс IDinnerRepository»:</span><span class="sxs-lookup"><span data-stu-id="6def0-225">We can then right-click on it and choose the "Implement interface IDinnerRepository" context menu command:</span></span>

![](enable-automated-unit-testing/_static/image10.png)

<span data-ttu-id="6def0-226">Это вызовет автоматическое добавление членов интерфейса IDinnerRepository в нашем FakeDinnerRepository класса реализации «заглушки» по умолчанию в Visual Studio:</span><span class="sxs-lookup"><span data-stu-id="6def0-226">This will cause Visual Studio to automatically add all of the IDinnerRepository interface members to our FakeDinnerRepository class with default "stub out" implementations:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample9.cs)]

<span data-ttu-id="6def0-227">Затем можно обновить реализацию FakeDinnerRepository для работы из списка в памяти&lt;Dinner&gt; коллекции, переданного в качестве аргумента конструктора:</span><span class="sxs-lookup"><span data-stu-id="6def0-227">We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed to it as a constructor argument:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample10.cs)]

<span data-ttu-id="6def0-228">Теперь у нас есть фиктивное реализацию IDinnerRepository, которая необходима база данных, а вместо этого может работать из списка в памяти объектов компании Dinner.</span><span class="sxs-lookup"><span data-stu-id="6def0-228">We now have a fake IDinnerRepository implementation that does not require a database, and can instead work off an in-memory list of Dinner objects.</span></span>

#### <a name="using-the-fakedinnerrepository-with-unit-tests"></a><span data-ttu-id="6def0-229">FakeDinnerRepository с помощью модульных тестов</span><span class="sxs-lookup"><span data-stu-id="6def0-229">Using the FakeDinnerRepository with Unit Tests</span></span>

<span data-ttu-id="6def0-230">Давайте вернемся к DinnersController модульные тесты, которые ранее сбой базы данных был недоступен.</span><span class="sxs-lookup"><span data-stu-id="6def0-230">Let's return to the DinnersController unit tests that failed earlier because the database wasn't available.</span></span> <span data-ttu-id="6def0-231">Можно изменить методы теста для использования FakeDinnerRepository, заполнены примерами данных компании Dinner в памяти для DinnersController, используя приведенный ниже код:</span><span class="sxs-lookup"><span data-stu-id="6def0-231">We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample11.cs)]

<span data-ttu-id="6def0-232">И теперь при выполнении этих тестов они оба передачи:</span><span class="sxs-lookup"><span data-stu-id="6def0-232">And now when we run these tests they both pass:</span></span>

![](enable-automated-unit-testing/_static/image11.png)

<span data-ttu-id="6def0-233">Лучше всего они принимают только доля секунды для выполнения и не требуют логики сложной настройки или очистки.</span><span class="sxs-lookup"><span data-stu-id="6def0-233">Best of all, they take only a fraction of a second to run, and do not require any complicated setup/cleanup logic.</span></span> <span data-ttu-id="6def0-234">Мы можем теперь модульного теста все наши код DinnersController действие метода (включая список, разбиение по страницам, сведения, создание, обновление и удаление) без необходимости никогда не подключаться к реальной базе данных.</span><span class="sxs-lookup"><span data-stu-id="6def0-234">We can now unit test all of our DinnersController action method code (including listing, paging, details, create, update and delete) without ever needing to connect to a real database.</span></span>

| <span data-ttu-id="6def0-235">**Разделе стороны: Платформы внедрения зависимостей**</span><span class="sxs-lookup"><span data-stu-id="6def0-235">**Side Topic: Dependency Injection Frameworks**</span></span> |
| --- |
| <span data-ttu-id="6def0-236">Выполнение внедрения вручную зависимости (например, превышающие) работает отлично, но трудно поддерживать как общее число зависимостей, и повышает компонентов в приложении.</span><span class="sxs-lookup"><span data-stu-id="6def0-236">Performing manual dependency injection (like we are above) works fine, but does become harder to maintain as the number of dependencies and components in an application increases.</span></span> <span data-ttu-id="6def0-237">Для .NET, которые помогают обеспечить еще большую гибкость управления зависимостей существует несколько инфраструктур внедрения зависимостей.</span><span class="sxs-lookup"><span data-stu-id="6def0-237">Several dependency injection frameworks exist for .NET that can help provide even more dependency management flexibility.</span></span> <span data-ttu-id="6def0-238">Эти платформы также иногда называют «Инверсии элемента управления» (IoC) контейнеры, предоставляют механизмы, позволяющие дополнительный уровень поддержки конфигурации для указания и передаче объектов во время выполнения (чаще всего с помощью конструктора внедрения зависимости ).</span><span class="sxs-lookup"><span data-stu-id="6def0-238">These frameworks, also sometimes called "Inversion of Control" (IoC) containers, provide mechanisms that enable an additional level of configuration support for specifying and passing dependencies to objects at runtime (most often using constructor injection).</span></span> <span data-ttu-id="6def0-239">Некоторые из более широкое внедрение зависимостей OSS / include IOC платформы в .NET: AutoFac, Ninject, Spring.NET, StructureMap и Windsor.</span><span class="sxs-lookup"><span data-stu-id="6def0-239">Some of the more popular OSS Dependency Injection / IOC frameworks in .NET include: AutoFac, Ninject, Spring.NET, StructureMap, and Windsor.</span></span> <span data-ttu-id="6def0-240">ASP.NET MVC предоставляет расширения API-интерфейсы, позволяющие разработчикам участвовать в решение и создание экземпляра контроллеры и позволяющий внедрения зависимостей и IoC платформы полностью интегрированы в рамках этого процесса.</span><span class="sxs-lookup"><span data-stu-id="6def0-240">ASP.NET MVC exposes extensibility APIs that enable developers to participate in the resolution and instantiation of controllers, and which enables Dependency Injection / IoC frameworks to be cleanly integrated within this process.</span></span> <span data-ttu-id="6def0-241">С помощью платформы DI и IOC также позволит нам для удаления из наших DinnersController — которого будет полностью удалить связь между ним и DinnerRepositorys конструктор по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="6def0-241">Using a DI/IOC framework would also enable us to remove the default constructor from our DinnersController – which would completely remove the coupling between it and the DinnerRepositorys.</span></span> <span data-ttu-id="6def0-242">Мы не использовали внедрения зависимостей и IOC framework в приложении обновление NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="6def0-242">We won't be using a dependency injection / IOC framework with our NerdDinner application.</span></span> <span data-ttu-id="6def0-243">Но это то, что мы рассмотреть в будущем, если обновление NerdDinner базы кода и возможности роста.</span><span class="sxs-lookup"><span data-stu-id="6def0-243">But it is something we could consider for the future if the NerdDinner code-base and capabilities grew.</span></span> |

### <a name="creating-edit-action-unit-tests"></a><span data-ttu-id="6def0-244">Создание модульных тестов для действий редактирования</span><span class="sxs-lookup"><span data-stu-id="6def0-244">Creating Edit Action Unit Tests</span></span>

<span data-ttu-id="6def0-245">Теперь создадим несколько модульных тестов, проверяющие DinnersController функциональные возможности редактирования.</span><span class="sxs-lookup"><span data-stu-id="6def0-245">Let's now create some unit tests that verify the Edit functionality of the DinnersController.</span></span> <span data-ttu-id="6def0-246">Мы начнем путем проверки версии HTTP-GET нашей действие изменения:</span><span class="sxs-lookup"><span data-stu-id="6def0-246">We'll start by testing the HTTP-GET version of our Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample12.cs)]

<span data-ttu-id="6def0-247">Мы создадим тест, который проверяет, что визуализации представления, поддерживаемый объект DinnerFormViewModel обратно в том случае, когда запрашивается допустимым dinner:</span><span class="sxs-lookup"><span data-stu-id="6def0-247">We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample13.cs)]

<span data-ttu-id="6def0-248">При выполнении теста, однако мы найдете, происходит сбой, поскольку при редактирования метода обращается к свойству User.Identity.Name выполнить проверку Dinner.IsHostedBy() исключение пустая ссылка.</span><span class="sxs-lookup"><span data-stu-id="6def0-248">When we run the test, though, we'll find that it fails because a null reference exception is thrown when the Edit method accesses the User.Identity.Name property to perform the Dinner.IsHostedBy() check.</span></span>

<span data-ttu-id="6def0-249">Объект пользователя в базовом классе контроллера инкапсулирует сведения о вошедшего в систему пользователя и заполняется ASP.NET MVC, при создании контроллера во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="6def0-249">The User object on the Controller base class encapsulates details about the logged-in user, and is populated by ASP.NET MVC when it creates the controller at runtime.</span></span> <span data-ttu-id="6def0-250">Так как мы тестируем DinnersController за пределами среды веб сервера, не задан объект пользователя (поэтому пустая ссылка на исключение).</span><span class="sxs-lookup"><span data-stu-id="6def0-250">Because we are testing the DinnersController outside of a web-server environment, the User object isn't set (hence the null reference exception).</span></span>

### <a name="mocking-the-useridentityname-property"></a><span data-ttu-id="6def0-251">Макетирование User.Identity.Name свойство</span><span class="sxs-lookup"><span data-stu-id="6def0-251">Mocking the User.Identity.Name property</span></span>

<span data-ttu-id="6def0-252">Платформы имитации упростить тестирование, позволяющих динамически создать фиктивный версии зависимых объектов, которые поддерживают наших тестов.</span><span class="sxs-lookup"><span data-stu-id="6def0-252">Mocking frameworks make testing easier by enabling us to dynamically create fake versions of dependent objects that support our tests.</span></span> <span data-ttu-id="6def0-253">Например мы используем платформа имитации в нашем тесте действие изменения для динамического создания объекта пользователя, наши DinnersController можно использовать для имитации username уточняющего запроса.</span><span class="sxs-lookup"><span data-stu-id="6def0-253">For example, we can use a mocking framework in our Edit action test to dynamically create a User object that our DinnersController can use to lookup a simulated username.</span></span> <span data-ttu-id="6def0-254">Это позволит избежать пустая ссылка вызывается при запуске нашем тесте.</span><span class="sxs-lookup"><span data-stu-id="6def0-254">This will avoid a null reference from being thrown when we run our test.</span></span>

<span data-ttu-id="6def0-255">Существует много .NET платформы, которые могут использоваться с ASP.NET MVC имитации (вы увидите список их здесь: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span><span class="sxs-lookup"><span data-stu-id="6def0-255">There are many .NET mocking frameworks that can be used with ASP.NET MVC (you can see a list of them here: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span></span> <span data-ttu-id="6def0-256">Для тестирования приложения обновление NerdDinner мы будем использовать с открытым исходным кодом имитации платформу, которая называется «Заказа», который можно загрузить бесплатно из [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span><span class="sxs-lookup"><span data-stu-id="6def0-256">For testing our NerdDinner application we'll use an open source mocking framework called "Moq", which can be downloaded for free from [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span></span>

<span data-ttu-id="6def0-257">После загрузки, мы добавим ссылку в данном проекте NerdDinner.Tests Moq.dll сборки:</span><span class="sxs-lookup"><span data-stu-id="6def0-257">Once downloaded, we'll add a reference in our NerdDinner.Tests project to the Moq.dll assembly:</span></span>

![](enable-automated-unit-testing/_static/image12.png)

<span data-ttu-id="6def0-258">Затем мы добавим вспомогательный метод «CreateDinnersControllerAs(username)» к нашей тестового класса, который принимает в качестве параметра, а также что имя пользователя, а затем «фиктивных» свойство User.Identity.Name на экземпляре DinnersController:</span><span class="sxs-lookup"><span data-stu-id="6def0-258">We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and which then "mocks" the User.Identity.Name property on the DinnersController instance:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample14.cs)]

<span data-ttu-id="6def0-259">Выше мы используем заказа для создания макетов объектов, что fakes объект параметром ControllerContext (который передается с классами контроллера для предоставления объектов среды выполнения, как пользователь, запрос, ответ и сеанса ASP.NET MVC).</span><span class="sxs-lookup"><span data-stu-id="6def0-259">Above we are using Moq to create a Mock object that fakes a ControllerContext object (which is what ASP.NET MVC passes to Controller classes to expose runtime objects like User, Request, Response, and Session).</span></span> <span data-ttu-id="6def0-260">Поступает вызов метода «SetupGet» на макетов для указания, что свойство HttpContext.User.Identity.Name параметром ControllerContext должна возвращать строку имени пользователя, которую мы передали вспомогательный метод.</span><span class="sxs-lookup"><span data-stu-id="6def0-260">We are calling the "SetupGet" method on the Mock to indicate that the HttpContext.User.Identity.Name property on ControllerContext should return the username string we passed to the helper method.</span></span>

<span data-ttu-id="6def0-261">Мы можете макета любое количество параметром ControllerContext свойства и методы.</span><span class="sxs-lookup"><span data-stu-id="6def0-261">We can mock any number of ControllerContext properties and methods.</span></span> <span data-ttu-id="6def0-262">Чтобы проиллюстрировать это были также добавлены вызов SetupGet() для свойства Request.IsAuthenticated (которого не требуется фактически ниже — тестов, но которые помогают проиллюстрировать, как можно макета свойств запроса).</span><span class="sxs-lookup"><span data-stu-id="6def0-262">To illustrate this I've also added a SetupGet() call for the Request.IsAuthenticated property (which isn't actually needed for the tests below – but which helps illustrate how you can mock Request properties).</span></span> <span data-ttu-id="6def0-263">После этого мы мы назначить экземпляр макетов параметром ControllerContext DinnersController, возвращает нашей вспомогательный метод.</span><span class="sxs-lookup"><span data-stu-id="6def0-263">When we are done we assign an instance of the ControllerContext mock to the DinnersController our helper method returns.</span></span>

<span data-ttu-id="6def0-264">Теперь можно написать модульные тесты, использующие этот вспомогательный метод для проверки редактирования сценариев с использованием разных пользователей:</span><span class="sxs-lookup"><span data-stu-id="6def0-264">We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample15.cs)]

<span data-ttu-id="6def0-265">А теперь передачи при запуске тестов:</span><span class="sxs-lookup"><span data-stu-id="6def0-265">And now when we run the tests they pass:</span></span>

![](enable-automated-unit-testing/_static/image13.png)

### <a name="testing-updatemodel-scenarios"></a><span data-ttu-id="6def0-266">UpdateModel() сценариев тестирования</span><span class="sxs-lookup"><span data-stu-id="6def0-266">Testing UpdateModel() scenarios</span></span>

<span data-ttu-id="6def0-267">Мы создали тесты, которые покрывают версию HTTP-GET действие изменения.</span><span class="sxs-lookup"><span data-stu-id="6def0-267">We've created tests that cover the HTTP-GET version of the Edit action.</span></span> <span data-ttu-id="6def0-268">Теперь создадим некоторые тесты, проверьте версию HTTP POST действие изменения:</span><span class="sxs-lookup"><span data-stu-id="6def0-268">Let's now create some tests that verify the HTTP-POST version of the Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample16.cs)]

<span data-ttu-id="6def0-269">Интересные новые сценарии тестирования для поддержки с данным методом действия — его использование вспомогательного метода UpdateModel() в базовом классе контроллера.</span><span class="sxs-lookup"><span data-stu-id="6def0-269">The interesting new testing scenario for us to support with this action method is its usage of the UpdateModel() helper method on the Controller base class.</span></span> <span data-ttu-id="6def0-270">Мы используем этот вспомогательный метод для привязки значений формы post нашей компании Dinner экземпляр объекта.</span><span class="sxs-lookup"><span data-stu-id="6def0-270">We are using this helper method to bind form-post values to our Dinner object instance.</span></span>

<span data-ttu-id="6def0-271">Ниже приведены два теста, показано, как указать форму, передаваемую значения для вспомогательного метода UpdateModel() для использования.</span><span class="sxs-lookup"><span data-stu-id="6def0-271">Below are two tests that demonstrates how we can supply form posted values for the UpdateModel() helper method to use.</span></span> <span data-ttu-id="6def0-272">Мы будет это сделать, создание и заполнение объектов FormCollection, а затем назначить его свойству «ValueProvider» на контроллере.</span><span class="sxs-lookup"><span data-stu-id="6def0-272">We'll do this by creating and populating a FormCollection object, and then assign it to the "ValueProvider" property on the Controller.</span></span>

<span data-ttu-id="6def0-273">Первый тест проверяет, что для успешного сохранения браузер перенаправляется на действие details.</span><span class="sxs-lookup"><span data-stu-id="6def0-273">The first test verifies that on a successful save the browser is redirected to the details action.</span></span> <span data-ttu-id="6def0-274">Второй тест проверяет, что при учете введено недопустимое действие повторно отображает представление изменения снова с сообщением об ошибке.</span><span class="sxs-lookup"><span data-stu-id="6def0-274">The second test verifies that when invalid input is posted the action redisplays the edit view again with an error message.</span></span>


[!code-csharp[Main](enable-automated-unit-testing/samples/sample17.cs)]

### <a name="testing-wrap-up"></a><span data-ttu-id="6def0-275">Тестирование Подведение итогов</span><span class="sxs-lookup"><span data-stu-id="6def0-275">Testing Wrap-Up</span></span>

<span data-ttu-id="6def0-276">Мы рассмотрели основные понятия, связанные с модульного тестирования классов контроллеров.</span><span class="sxs-lookup"><span data-stu-id="6def0-276">We've covered the core concepts involved in unit testing controller classes.</span></span> <span data-ttu-id="6def0-277">Эти методы можно использовать для простого создания сотни простых тестов, которые проверяют поведение приложения.</span><span class="sxs-lookup"><span data-stu-id="6def0-277">We can use these techniques to easily create hundreds of simple tests that verify the behavior of our application.</span></span>

<span data-ttu-id="6def0-278">Поскольку наш контроллера и тесты модели не требуется реальной базы данных, они являются очень быстро и легко выполняется.</span><span class="sxs-lookup"><span data-stu-id="6def0-278">Because our controller and model tests do not require a real database, they are extremely fast and easy to run.</span></span> <span data-ttu-id="6def0-279">Мы будем возможность выполнения сотни автоматических тестов в секундах и сразу же получить обратную связь относительно ли что-нибудь нарушала мы внесенных изменений.</span><span class="sxs-lookup"><span data-stu-id="6def0-279">We'll be able to execute hundreds of automated tests in seconds, and immediately get feedback as to whether a change we made broke something.</span></span> <span data-ttu-id="6def0-280">Это поможет вам получить нам достоверности постоянно улучшить рефакторинга и уточнения нашего приложения.</span><span class="sxs-lookup"><span data-stu-id="6def0-280">This will help provide us the confidence to continually improve, refactor, and refine our application.</span></span>

<span data-ttu-id="6def0-281">Мы узнали тестирование в последнем разделе этой главы — но не так, как тестирование стоит необходимо делать в конце процесса разработки!</span><span class="sxs-lookup"><span data-stu-id="6def0-281">We covered testing as the last topic in this chapter – but not because testing is something you should do at the end of a development process!</span></span> <span data-ttu-id="6def0-282">Напротив необходимо создавать автоматические тесты как можно раньше в процессе разработки.</span><span class="sxs-lookup"><span data-stu-id="6def0-282">On the contrary, you should write automated tests as early as possible in your development process.</span></span> <span data-ttu-id="6def0-283">Таким образом это позволяет получить оперативные сведения при разработке, помогает продуманным подумать о сценариев использования приложения и помогает разрабатывать приложение с чистой иерархическое представление и взаимозависимости в виду.</span><span class="sxs-lookup"><span data-stu-id="6def0-283">Doing so enables you to get immediate feedback as you develop, helps you think thoughtfully about your application's use case scenarios, and guides you to design your application with clean layering and coupling in mind.</span></span>

<span data-ttu-id="6def0-284">Главы в книге обсудим теста управляемую разработки (TDD) и способ его использования с ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="6def0-284">A later chapter in the book will discuss Test Driven Development (TDD), and how to use it with ASP.NET MVC.</span></span> <span data-ttu-id="6def0-285">Управляемой тестами разработки пишется итеративный типизации сначала тесты, которые удовлетворяют полученный код.</span><span class="sxs-lookup"><span data-stu-id="6def0-285">TDD is an iterative coding practice where you first write the tests that your resulting code will satisfy.</span></span> <span data-ttu-id="6def0-286">С помощью управляемой тестами разработки каждого компонента, начните с создания тест, который проверяет функциональные возможности, которые вы собираетесь реализовать.</span><span class="sxs-lookup"><span data-stu-id="6def0-286">With TDD you begin each feature by creating a test that verifies the functionality you are about to implement.</span></span> <span data-ttu-id="6def0-287">Запись модульного теста сначала гарантирует четко понимать, компонент и как он должен работать.</span><span class="sxs-lookup"><span data-stu-id="6def0-287">Writing the unit test first helps ensure that you clearly understand the feature and how it is supposed to work.</span></span> <span data-ttu-id="6def0-288">Только в том случае, когда записывается теста (и вы проверили, что он возвращает ошибку) вы, а затем реализовать фактическое функциональные возможности, которые можно проверить.</span><span class="sxs-lookup"><span data-stu-id="6def0-288">Only after the test is written (and you have verified that it fails) do you then implement the actual functionality the test verifies.</span></span> <span data-ttu-id="6def0-289">Так как уже Потратив время обдумывания как компонент может работать в случае использования, необходимо будет лучше понять требования и как оптимальным способом для их реализации.</span><span class="sxs-lookup"><span data-stu-id="6def0-289">Because you've already spent time thinking about the use case of how the feature is supposed to work, you will have a better understanding of the requirements and how best to implement them.</span></span> <span data-ttu-id="6def0-290">Закончив с реализацией, можно повторно выполнить тест — и немедленный результат в виде ли компонент работает правильно.</span><span class="sxs-lookup"><span data-stu-id="6def0-290">When you are done with the implementation you can re-run the test – and get immediate feedback as to whether the feature works correctly.</span></span> <span data-ttu-id="6def0-291">Мы обсудим TDD более в главе 10.</span><span class="sxs-lookup"><span data-stu-id="6def0-291">We'll cover TDD more in Chapter 10.</span></span>

### <a name="next-step"></a><span data-ttu-id="6def0-292">Следующий шаг</span><span class="sxs-lookup"><span data-stu-id="6def0-292">Next Step</span></span>

<span data-ttu-id="6def0-293">Некоторые последний переноса комментариев.</span><span class="sxs-lookup"><span data-stu-id="6def0-293">Some final wrap up comments.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="6def0-294">[Назад](use-ajax-to-implement-mapping-scenarios.md)
[Вперед](nerddinner-wrap-up.md)</span><span class="sxs-lookup"><span data-stu-id="6def0-294">[Previous](use-ajax-to-implement-mapping-scenarios.md)
[Next](nerddinner-wrap-up.md)</span></span>
