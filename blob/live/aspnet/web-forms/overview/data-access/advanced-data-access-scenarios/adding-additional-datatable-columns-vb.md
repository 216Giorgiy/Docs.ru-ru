---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/adding-additional-datatable-columns-vb
title: "Добавление дополнительных DataTable столбцов (VB) | Документы Microsoft"
author: rick-anderson
description: "При создании типизированного набора данных с помощью мастера TableAdapter, соответствующий объект DataTable содержит столбцы, возвращенные запросом к основной базе данных. Но есть..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/18/2007
ms.topic: article
ms.assetid: 1e8e65f9-fe3e-4250-810b-c90227786bed
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/adding-additional-datatable-columns-vb
msc.type: authoredcontent
ms.openlocfilehash: 2668a685389938979fc4b0a1e1701a90cef5dc1c
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="adding-additional-datatable-columns-vb"></a><span data-ttu-id="a6d8a-104">Добавление дополнительных DataTable столбцов (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="a6d8a-104">Adding Additional DataTable Columns (VB)</span></span>
====================
<span data-ttu-id="a6d8a-105">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a6d8a-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a6d8a-106">[Загрузить код](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_70_VB.zip) или [скачать PDF](adding-additional-datatable-columns-vb/_static/datatutorial70vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="a6d8a-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_70_VB.zip) or [Download PDF](adding-additional-datatable-columns-vb/_static/datatutorial70vb1.pdf)</span></span>

> <span data-ttu-id="a6d8a-107">При создании типизированного набора данных с помощью мастера TableAdapter, соответствующий объект DataTable содержит столбцы, возвращенные запросом к основной базе данных.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-107">When using the TableAdapter Wizard to create a Typed DataSet, the corresponding DataTable contains the columns returned by the main database query.</span></span> <span data-ttu-id="a6d8a-108">Однако бывают ситуации, когда необходимо DataTable для включения дополнительных столбцов.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-108">But there are occasions when the DataTable needs to include additional columns.</span></span> <span data-ttu-id="a6d8a-109">В этом учебнике показано, почему рекомендуется использовать хранимые процедуры в случае необходимости дополнительных столбцов таблицы данных.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-109">In this tutorial we learn why stored procedures are recommended when we need additional DataTable columns.</span></span>


## <a name="introduction"></a><span data-ttu-id="a6d8a-110">Вступление</span><span class="sxs-lookup"><span data-stu-id="a6d8a-110">Introduction</span></span>

<span data-ttu-id="a6d8a-111">При добавлении адаптера таблицы к типизированным набором данных, соответствующей схеме s DataTable определяется s основного запроса адаптера таблицы.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-111">When adding a TableAdapter to a Typed DataSet, the corresponding DataTable s schema is determined by the TableAdapter s main query.</span></span> <span data-ttu-id="a6d8a-112">Например, если основной запрос возвращает данные поля *A*, *B*, и *C*, таблицы данных будет иметь три соответствующего столбца с именем *A*, *B*, и *C*. В дополнение к его основной запрос адаптера таблицы могут включать дополнительные запросы, которые возвращают, возможно, подмножества данных, на основе некоторых параметра.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-112">For example, if the main query returns data fields *A*, *B*, and *C*, the DataTable will have three corresponding columns named *A*, *B*, and *C*. In addition to its main query, a TableAdapter can include additional queries that return, perhaps, a subset of the data based on some parameter.</span></span> <span data-ttu-id="a6d8a-113">Например, в дополнение к `ProductsTableAdapter` s основной запрос, который возвращает сведения обо всех приложениях, он также содержит методы, такие как `GetProductsByCategoryID(categoryID)` и `GetProductByProductID(productID)`, при котором возвращаются сведения определенного продукта на основе предоставленного параметра.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-113">For instance, in addition to the `ProductsTableAdapter` s main query, which returns information about all products, it also contains methods like `GetProductsByCategoryID(categoryID)` and `GetProductByProductID(productID)`, which return specific product information based on a supplied parameter.</span></span>

<span data-ttu-id="a6d8a-114">Модель предоставления схеме s DataTable отражают основного запроса адаптера таблицы s работает также в том случае, если все методы TableAdapter s возвращает тот же или меньшее число полей данных, чем указано в основном запросе.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-114">The model of having the DataTable s schema reflect the TableAdapter s main query works well if all of the TableAdapter s methods return the same or fewer data fields than those specified in the main query.</span></span> <span data-ttu-id="a6d8a-115">Если метод адаптера таблицы должен возвращать дополнительных полей данных, мы должны разверните схема s DataTable соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-115">If a TableAdapter method needs to return additional data fields, then we should expand the DataTable s schema accordingly.</span></span> <span data-ttu-id="a6d8a-116">В [главный/Detail, с помощью маркированного списка из главного записей с DataList сведения](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md) учебника мы добавили метод `CategoriesTableAdapter` , которые вернули `CategoryID`, `CategoryName`, и `Description` поля данных, заданные в основной запрос плюс `NumberOfProducts`, дополнительное поле данных, количество продуктов, связанные с каждой категории в отчет.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-116">In the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md) tutorial we added a method to the `CategoriesTableAdapter` that returned the `CategoryID`, `CategoryName`, and `Description` data fields defined in the main query plus `NumberOfProducts`, an additional data field that reported the number of products associated with each category.</span></span> <span data-ttu-id="a6d8a-117">Мы вручную добавить новый столбец в `CategoriesDataTable` для захвата `NumberOfProducts` значение из этого метода новые поля данных.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-117">We manually added a new column to the `CategoriesDataTable` in order to capture the `NumberOfProducts` data field value from this new method.</span></span>

<span data-ttu-id="a6d8a-118">Как было сказано в [передачи файлов](../working-with-binary-files/uploading-files-vb.md) учебника, отлично необходимо соблюдать осторожность с адаптеры таблиц TableAdapter, использование нерегламентированных инструкций SQL и имеют методы, поля данных не соответствуют основного запроса.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-118">As discussed in the [Uploading Files](../working-with-binary-files/uploading-files-vb.md) tutorial, great care must be taken with TableAdapters that use ad-hoc SQL statements and have methods whose data fields do not precisely match the main query.</span></span> <span data-ttu-id="a6d8a-119">Если повторно запускается мастер настройки адаптера таблицы, обновите все методы адаптера таблицы s, чтобы их список полей данных соответствует основного запроса.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-119">If the TableAdapter Configuration wizard is re-run, it will update all of the TableAdapter s methods so that their data field list matches the main query.</span></span> <span data-ttu-id="a6d8a-120">Следовательно любые методы со списками изменяемых столбцов вернуться к основной запрос s список столбцов и не возвращает ожидавшиеся данные.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-120">Consequently, any methods with customized column lists will revert to the main query s column list and not return the expected data.</span></span> <span data-ttu-id="a6d8a-121">Эта проблема не возникает при использовании хранимых процедур.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-121">This issue does not arise when using stored procedures.</span></span>

<span data-ttu-id="a6d8a-122">В этом учебнике мы рассмотрим способы расширения схемы s DataTable для включения дополнительных столбцов.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-122">In this tutorial we will look at how to extend a DataTable s schema to include additional columns.</span></span> <span data-ttu-id="a6d8a-123">Из-за хрупкость адаптера таблицы, при использовании нерегламентированных инструкций SQL в этом учебнике мы будем использовать хранимые процедуры.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-123">Due to the brittleness of the TableAdapter when using ad-hoc SQL statements, in this tutorial we will use stored procedures.</span></span> <span data-ttu-id="a6d8a-124">Ссылаться на [создание новых хранимых процедур для типизированного набора данных s адаптеры таблиц TableAdapter](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) и [существующих хранимых процедур для типизированного набора данных s адаптеры таблиц TableAdapter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) учебники Дополнительные сведения о Настройка адаптера таблицы с помощью хранимых процедур.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-124">Refer to the [Creating New Stored Procedures for the Typed DataSet s TableAdapters](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) and [Using Existing Stored Procedures for the Typed DataSet s TableAdapters](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) tutorials for more information on configuring a TableAdapter to use stored procedures.</span></span>

## <a name="step-1-adding-apricequartilecolumn-to-theproductsdatatable"></a><span data-ttu-id="a6d8a-125">Шаг 1: Добавление`PriceQuartile`столбца`ProductsDataTable`</span><span class="sxs-lookup"><span data-stu-id="a6d8a-125">Step 1: Adding a`PriceQuartile`Column to the`ProductsDataTable`</span></span>

<span data-ttu-id="a6d8a-126">В *создание новых хранимых процедур для типизированного набора данных s адаптеры таблиц TableAdapter* учебника мы создали типизированный набор данных, с именем `NorthwindWithSprocs`.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-126">In the *Creating New Stored Procedures for the Typed DataSet s TableAdapters* tutorial we created a Typed DataSet named `NorthwindWithSprocs`.</span></span> <span data-ttu-id="a6d8a-127">Этот набор данных в настоящее время содержит два DataTables: `ProductsDataTable` и `EmployeesDataTable`.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-127">This DataSet currently contains two DataTables: `ProductsDataTable` and `EmployeesDataTable`.</span></span> <span data-ttu-id="a6d8a-128">`ProductsTableAdapter` Имеет следующих трех способов:</span><span class="sxs-lookup"><span data-stu-id="a6d8a-128">The `ProductsTableAdapter` has the following three methods:</span></span>

- <span data-ttu-id="a6d8a-129">`GetProducts`-основной запрос, который возвращает все записи из `Products` таблицы</span><span class="sxs-lookup"><span data-stu-id="a6d8a-129">`GetProducts` - the main query, which returns all records from the `Products` table</span></span>
- <span data-ttu-id="a6d8a-130">`GetProductsByCategoryID(categoryID)`— Возвращает все продукты с указанным *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-130">`GetProductsByCategoryID(categoryID)` - returns all products with the specified *categoryID*.</span></span>
- <span data-ttu-id="a6d8a-131">`GetProductByProductID(productID)`— Возвращает определенный продукт с указанным *productID*.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-131">`GetProductByProductID(productID)` - returns the particular product with the specified *productID*.</span></span>

<span data-ttu-id="a6d8a-132">Основной запрос и два дополнительных метода возвращают один и тот же набор полей данных, а именно все столбцы из `Products` таблицы.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-132">The main query and the two additional methods all return the same set of data fields, namely all of the columns from the `Products` table.</span></span> <span data-ttu-id="a6d8a-133">Существуют не коррелированные вложенные запросы или `JOIN` s извлечение связанных данных из `Categories` или `Suppliers` таблицы.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-133">There are no correlated subqueries or `JOIN` s pulling related data from the `Categories` or `Suppliers` tables.</span></span> <span data-ttu-id="a6d8a-134">Таким образом `ProductsDataTable` имеет соответствующего столбца для каждого поля в `Products` таблицы.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-134">Therefore, the `ProductsDataTable` has a corresponding column for each field in the `Products` table.</span></span>

<span data-ttu-id="a6d8a-135">В этом учебнике позволяют s добавьте метод `ProductsTableAdapter` с именем `GetProductsWithPriceQuartile` , возвращающий все продукты.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-135">For this tutorial, let s add a method to the `ProductsTableAdapter` named `GetProductsWithPriceQuartile` that returns all of the products.</span></span> <span data-ttu-id="a6d8a-136">Помимо поля данных стандартные продукта `GetProductsWithPriceQuartile` также входят `PriceQuartile` поля данных, которое указывает, в какой квартиль попадают цена продукта s.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-136">In addition to the standard product data fields, `GetProductsWithPriceQuartile` will also include a `PriceQuartile` data field that indicates under which quartile the product s price falls.</span></span> <span data-ttu-id="a6d8a-137">Например, будет иметь те продукты, цены находятся в наиболее ресурсоемких 25% `PriceQuartile` значение 1, а те, цены, попадают в последние 25% будет иметь значение 4.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-137">For example, those products whose prices are in the most expensive 25% will have a `PriceQuartile` value of 1, while those whose prices fall in the bottom 25% will have a value of 4.</span></span> <span data-ttu-id="a6d8a-138">Прежде чем мы беспокоиться о создании хранимой процедуры для возврата этих сведений, тем не менее, сначала необходимо обновить `ProductsDataTable` для включения столбца, содержащего `PriceQuartile` результатов при `GetProductsWithPriceQuartile` используется метод.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-138">Before we worry about creating the stored procedure to return this information, however, we first need to update the `ProductsDataTable` to include a column to hold the `PriceQuartile` results when the `GetProductsWithPriceQuartile` method is used.</span></span>

<span data-ttu-id="a6d8a-139">Откройте `NorthwindWithSprocs` набора данных и щелкните правой кнопкой мыши `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-139">Open the `NorthwindWithSprocs` DataSet and right-click on the `ProductsDataTable`.</span></span> <span data-ttu-id="a6d8a-140">Выберите команду "Добавить" в контекстном меню, а затем выбрать столбец.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-140">Choose Add from the context-menu and then pick Column.</span></span>


<span data-ttu-id="a6d8a-141">[![Добавить новый столбец ProductsDataTable](adding-additional-datatable-columns-vb/_static/image2.png)](adding-additional-datatable-columns-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a6d8a-141">[![Add a New Column to the ProductsDataTable](adding-additional-datatable-columns-vb/_static/image2.png)](adding-additional-datatable-columns-vb/_static/image1.png)</span></span>

<span data-ttu-id="a6d8a-142">**Рис. 1**: добавить новый столбец в `ProductsDataTable` ([Просмотр полноразмерное изображение](adding-additional-datatable-columns-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="a6d8a-142">**Figure 1**: Add a New Column to the `ProductsDataTable` ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image3.png))</span></span>


<span data-ttu-id="a6d8a-143">Это будет добавлен новый столбец в таблицу DataTable с именем Column1 типа `System.String`.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-143">This will add a new column to the DataTable named Column1 of type `System.String`.</span></span> <span data-ttu-id="a6d8a-144">Необходимо обновить это имя столбца s PriceQuartile и его тип `System.Int32` , так как он будет использоваться для хранения числа от 1 до 4.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-144">We need to update this column s name to PriceQuartile and its type to `System.Int32` since it will be used to hold a number between 1 and 4.</span></span> <span data-ttu-id="a6d8a-145">Выберите столбец, добавленные в `ProductsDataTable` и в окне свойств задайте `Name` свойства PriceQuartile и `DataType` свойства `System.Int32`.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-145">Select the newly-added column in the `ProductsDataTable` and, from the Properties window, set the `Name` property to PriceQuartile and the `DataType` property to `System.Int32`.</span></span>


<span data-ttu-id="a6d8a-146">[![Задайте новое имя столбца s и свойства типа данных](adding-additional-datatable-columns-vb/_static/image5.png)](adding-additional-datatable-columns-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="a6d8a-146">[![Set the New Column s Name and DataType Properties](adding-additional-datatable-columns-vb/_static/image5.png)](adding-additional-datatable-columns-vb/_static/image4.png)</span></span>

<span data-ttu-id="a6d8a-147">**На рисунке 2**: задайте новый столбец s `Name` и `DataType` свойства ([Просмотр полноразмерное изображение](adding-additional-datatable-columns-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="a6d8a-147">**Figure 2**: Set the New Column s `Name` and `DataType` Properties ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image6.png))</span></span>


<span data-ttu-id="a6d8a-148">Как показано на рисунке 2, существуют дополнительные свойства, которые могут быть установлены, например ли значения в столбце должны быть уникальными, если столбец является столбцом с автоматическим приращением, ли базы данных `NULL` значения допускаются и т. д.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-148">As Figure 2 shows, there are additional properties that can be set, such as whether the values in the column must be unique, if the column is an auto-increment column, whether or not database `NULL` values are allowed, and so on.</span></span> <span data-ttu-id="a6d8a-149">Оставьте эти значения, значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-149">Leave these values set to their defaults.</span></span>

## <a name="step-2-creating-thegetproductswithpricequartilemethod"></a><span data-ttu-id="a6d8a-150">Шаг 2: Создание`GetProductsWithPriceQuartile`метод</span><span class="sxs-lookup"><span data-stu-id="a6d8a-150">Step 2: Creating the`GetProductsWithPriceQuartile`Method</span></span>

<span data-ttu-id="a6d8a-151">Теперь, когда `ProductsDataTable` был обновлен для включения `PriceQuartile` столбца, все готово для создания `GetProductsWithPriceQuartile` метод.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-151">Now that the `ProductsDataTable` has been updated to include the `PriceQuartile` column, we are ready to create the `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="a6d8a-152">Запустить, щелкнув и выбрав команду Добавить запрос в контекстном меню.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-152">Start by right-clicking on the TableAdapter and choosing Add Query from the context-menu.</span></span> <span data-ttu-id="a6d8a-153">Откроется мастер настройки запроса адаптера таблицы, который сначала запрашивает нам о том, является ли мы хотим использовать специализированные инструкции SQL или в новую или существующую хранимую процедуру.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-153">This brings up the TableAdapter Query Configuration wizard, which first prompts us as to whether we want to use ad-hoc SQL statements or a new or existing stored procedure.</span></span> <span data-ttu-id="a6d8a-154">Поскольку мы не хотите t, но имеется хранимая процедура, возвращающая данные квартиль цены, позволяет разрешить адаптера таблицы для создания этой хранимой процедуры для нас s.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-154">Since we don t yet have a stored procedure that returns the price quartile data, let s allow the TableAdapter to create this stored procedure for us.</span></span> <span data-ttu-id="a6d8a-155">Выберите параметр Создать новые хранимые процедуры и нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-155">Select the Create new stored procedure option and click Next.</span></span>


<span data-ttu-id="a6d8a-156">[![Указать мастера TableAdapter, чтобы создать хранимую процедуру для нас](adding-additional-datatable-columns-vb/_static/image8.png)](adding-additional-datatable-columns-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a6d8a-156">[![Instruct the TableAdapter Wizard to Create the Stored Procedure For Us](adding-additional-datatable-columns-vb/_static/image8.png)](adding-additional-datatable-columns-vb/_static/image7.png)</span></span>

<span data-ttu-id="a6d8a-157">**Рис. 3**: поручить адаптера таблицы мастер для создания хранимой процедуры для нас ([Просмотр полноразмерное изображение](adding-additional-datatable-columns-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="a6d8a-157">**Figure 3**: Instruct the TableAdapter Wizard to Create the Stored Procedure For Us ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image9.png))</span></span>


<span data-ttu-id="a6d8a-158">В последующих экране, показанном на рис. 4 мастер задает нам какой тип запроса для добавления.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-158">In the subsequent screen, shown in Figure 4, the wizard asks us what type of query to add.</span></span> <span data-ttu-id="a6d8a-159">Поскольку `GetProductsWithPriceQuartile` метод будет возвращать все столбцы и записи `Products` таблицы, выберите SELECT, возвращающая строки и нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-159">Since the `GetProductsWithPriceQuartile` method will return all columns and records from the `Products` table, select the SELECT which returns rows option and click Next.</span></span>


<span data-ttu-id="a6d8a-160">[![Наш запрос будет инструкция SELECT, возвращает несколько строк](adding-additional-datatable-columns-vb/_static/image11.png)](adding-additional-datatable-columns-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="a6d8a-160">[![Our Query will be a SELECT Statement that Returns Multiple Rows](adding-additional-datatable-columns-vb/_static/image11.png)](adding-additional-datatable-columns-vb/_static/image10.png)</span></span>

<span data-ttu-id="a6d8a-161">**Рис. 4**: наш запрос будет `SELECT` инструкции, возвращает несколько строк ([Просмотр полноразмерное изображение](adding-additional-datatable-columns-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="a6d8a-161">**Figure 4**: Our Query will be a `SELECT` Statement that Returns Multiple Rows ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image12.png))</span></span>


<span data-ttu-id="a6d8a-162">Далее мы запрашивается `SELECT` запроса.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-162">Next we are prompted for the `SELECT` query.</span></span> <span data-ttu-id="a6d8a-163">В мастере введите следующий запрос:</span><span class="sxs-lookup"><span data-stu-id="a6d8a-163">Enter the following query into the wizard:</span></span>


[!code-sql[Main](adding-additional-datatable-columns-vb/samples/sample1.sql)]

<span data-ttu-id="a6d8a-164">Приведенный выше запрос использует новый SQL Server 2005 s [ `NTILE` функция](https://msdn.microsoft.com/en-us/library/ms175126.aspx) для разделения результаты на четыре группы, где определяются группы `UnitPrice` значений, отсортированных в порядке убывания.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-164">The above query uses SQL Server 2005 s new [`NTILE` function](https://msdn.microsoft.com/en-us/library/ms175126.aspx) to divide the results into four groups where the groups are determined by the `UnitPrice` values sorted in descending order.</span></span>

<span data-ttu-id="a6d8a-165">К сожалению, конструктор запросов не знает, как выполнить синтаксический анализ `OVER` ключевое слово и выводится сообщение об ошибке при анализе приведенный выше запрос.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-165">Unfortunately, the Query Builder does not know how to parse the `OVER` keyword and will display an error when parsing the above query.</span></span> <span data-ttu-id="a6d8a-166">Таким образом введите приведенный выше запрос непосредственно в текстовое поле в мастере без использования построителя запросов.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-166">Therefore, enter the above query directly in the textbox in the wizard without using the Query Builder.</span></span>

> [!NOTE]
> <span data-ttu-id="a6d8a-167">Дополнительные сведения о s NTILE и SQL Server 2005 см. другие функции ранжирования [возврат ранжированные результаты с Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml) и [раздел Ранжирующие функции](https://msdn.microsoft.com/en-us/library/ms189798.aspx) из [SQL 2005 электронной документации по Server](https://msdn.microsoft.com/en-us/library/ms189798.aspx).</span><span class="sxs-lookup"><span data-stu-id="a6d8a-167">For more information on NTILE and SQL Server 2005 s other ranking functions, see [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml) and the [Ranking Functions section](https://msdn.microsoft.com/en-us/library/ms189798.aspx) from the [SQL Server 2005 Books Online](https://msdn.microsoft.com/en-us/library/ms189798.aspx).</span></span>


<span data-ttu-id="a6d8a-168">После ввода `SELECT` запроса и нажмите кнопку Далее, мастер появляется запрос на указание имени для хранимой процедуры, она будет создана.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-168">After entering the `SELECT` query and clicking Next, the wizard asks us to provide a name for the stored procedure it will create.</span></span> <span data-ttu-id="a6d8a-169">Имя новой хранимой процедуры `Products_SelectWithPriceQuartile` и нажмите кнопку Далее.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-169">Name the new stored procedure `Products_SelectWithPriceQuartile` and click Next.</span></span>


<span data-ttu-id="a6d8a-170">[![Имя хранимой процедуры Products_SelectWithPriceQuartile](adding-additional-datatable-columns-vb/_static/image14.png)](adding-additional-datatable-columns-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="a6d8a-170">[![Name the Stored Procedure Products_SelectWithPriceQuartile](adding-additional-datatable-columns-vb/_static/image14.png)](adding-additional-datatable-columns-vb/_static/image13.png)</span></span>

<span data-ttu-id="a6d8a-171">**Рис. 5**: имя хранимой процедуры `Products_SelectWithPriceQuartile` ([Просмотр полноразмерное изображение](adding-additional-datatable-columns-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="a6d8a-171">**Figure 5**: Name the Stored Procedure `Products_SelectWithPriceQuartile` ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image15.png))</span></span>


<span data-ttu-id="a6d8a-172">Наконец мы предлагается имя методы адаптера таблицы.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-172">Lastly, we are prompted to name the TableAdapter methods.</span></span> <span data-ttu-id="a6d8a-173">Оставьте оба заполнения таблицы данных и возвращать проверяется флажки DataTable и имя методы `FillWithPriceQuartile` и `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-173">Leave both the Fill a DataTable and Return a DataTable checkboxes checked and name the methods `FillWithPriceQuartile` and `GetProductsWithPriceQuartile`.</span></span>


<span data-ttu-id="a6d8a-174">[![Методы TableAdapter s имя и нажмите кнопку Готово.](adding-additional-datatable-columns-vb/_static/image17.png)](adding-additional-datatable-columns-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="a6d8a-174">[![Name the TableAdapter s Methods and Click Finish](adding-additional-datatable-columns-vb/_static/image17.png)](adding-additional-datatable-columns-vb/_static/image16.png)</span></span>

<span data-ttu-id="a6d8a-175">**Рис. 6**: имя s методы адаптера таблицы и нажмите "Готово" ([Просмотр полноразмерное изображение](adding-additional-datatable-columns-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="a6d8a-175">**Figure 6**: Name the TableAdapter s Methods and Click Finish ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image18.png))</span></span>


<span data-ttu-id="a6d8a-176">С `SELECT` указан запрос и хранимой процедуры и методы адаптера таблицы с именем, щелкните "Готово" Чтобы завершить работу мастера.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-176">With the `SELECT` query specified and the stored procedure and TableAdapter methods named, click Finish to complete the wizard.</span></span> <span data-ttu-id="a6d8a-177">На этом этапе может появиться предупреждение или два из мастера, о том, что `OVER` конструкция или оператор SQL не поддерживается.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-177">At this point you may get a warning or two from the wizard saying that The `OVER` SQL construct or statement is not supported.</span></span> <span data-ttu-id="a6d8a-178">Эти предупреждения можно игнорировать.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-178">These warnings can be ignored.</span></span>

<span data-ttu-id="a6d8a-179">По завершении работы мастера TableAdapter должен включать `FillWithPriceQuartile` и `GetProductsWithPriceQuartile` методы и базы данных должно включать хранимую процедуру с именем `Products_SelectWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-179">After completing the wizard, the TableAdapter should include the `FillWithPriceQuartile` and `GetProductsWithPriceQuartile` methods and the database should include a stored procedure named `Products_SelectWithPriceQuartile`.</span></span> <span data-ttu-id="a6d8a-180">Теперь пора убедитесь, что TableAdapter на самом деле содержит этот новый метод и правильно добавлен хранимой процедуры в базе данных.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-180">Take a moment to verify that the TableAdapter does indeed contain this new method and that the stored procedure has been correctly added to the database.</span></span> <span data-ttu-id="a6d8a-181">При проверке базы данных, если хранимая процедура try правой кнопкой мыши папку хранимые процедуры и выбрав обновления не отображаются.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-181">When checking the database, if you do not see the stored procedure try right-clicking on the Stored Procedures folder and choosing Refresh.</span></span>


![Убедитесь, что в адаптер таблицы добавлен новый метод](adding-additional-datatable-columns-vb/_static/image19.png)

<span data-ttu-id="a6d8a-183">**Рис. 7**: Убедитесь, что в адаптер таблицы добавлен новый метод</span><span class="sxs-lookup"><span data-stu-id="a6d8a-183">**Figure 7**: Verify that a New Method Has Been Added to the TableAdapter</span></span>


<span data-ttu-id="a6d8a-184">[![Убедитесь, что база данных содержит Products_SelectWithPriceQuartile хранимой процедуры](adding-additional-datatable-columns-vb/_static/image21.png)](adding-additional-datatable-columns-vb/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="a6d8a-184">[![Ensure that the Database Contains the Products_SelectWithPriceQuartile Stored Procedure](adding-additional-datatable-columns-vb/_static/image21.png)](adding-additional-datatable-columns-vb/_static/image20.png)</span></span>

<span data-ttu-id="a6d8a-185">**Рис. 8**: Убедитесь, что база данных содержит `Products_SelectWithPriceQuartile` хранимой процедуры ([Просмотр полноразмерное изображение](adding-additional-datatable-columns-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="a6d8a-185">**Figure 8**: Ensure that the Database Contains the `Products_SelectWithPriceQuartile` Stored Procedure ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image22.png))</span></span>


> [!NOTE]
> <span data-ttu-id="a6d8a-186">Одним из преимуществ использования хранимых процедур вместо нерегламентированных инструкций SQL является, повторный запуск мастера настройки адаптера таблицы не будет изменять список столбцов для хранимых процедур.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-186">One of the benefits of using stored procedures instead of ad-hoc SQL statements is that re-running the TableAdapter Configuration wizard will not modify the stored procedures column lists.</span></span> <span data-ttu-id="a6d8a-187">Проверьте, щелкнув правой кнопкой мыши в TableAdapter, вариант в контекстном меню для запуска мастера настройки и нажмите кнопку Готово, чтобы завершить его.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-187">Verify this by right-clicking on the TableAdapter, choosing the Configure option from the context-menu to start the wizard, and then clicking Finish to complete it.</span></span> <span data-ttu-id="a6d8a-188">Теперь перейдите к базе данных, просматривать `Products_SelectWithPriceQuartile` хранимой процедуры.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-188">Next, go to the database and view the `Products_SelectWithPriceQuartile` stored procedure.</span></span> <span data-ttu-id="a6d8a-189">Обратите внимание, что его список столбцов не был изменен.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-189">Note that its column list has not been modified.</span></span> <span data-ttu-id="a6d8a-190">Мы использовались нерегламентированных инструкций SQL, повторный запуск мастера настройки адаптера таблицы будет возвращаются этот запрос s список столбцов, чтобы соответствовать списку столбцов основного запроса, тем самым убирая инструкцию NTILE из запросов, используемых `GetProductsWithPriceQuartile` метод.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-190">Had we been using ad-hoc SQL statements, re-running the TableAdapter Configuration wizard would have reverted this query s column list to match the main query column list, thereby removing the NTILE statement from the query used by the `GetProductsWithPriceQuartile` method.</span></span>


<span data-ttu-id="a6d8a-191">При s уровня доступа к данным `GetProductsWithPriceQuartile` вызывается метод, адаптера таблицы выполняет `Products_SelectWithPriceQuartile` хранимой процедуры и добавляет строку в `ProductsDataTable` для каждой возвращаемой записи.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-191">When the Data Access Layer s `GetProductsWithPriceQuartile` method is invoked, the TableAdapter executes the `Products_SelectWithPriceQuartile` stored procedure and adds a row to the `ProductsDataTable` for each returned record.</span></span> <span data-ttu-id="a6d8a-192">Поля данных, возвращаемых хранимой процедурой сопоставляются с `ProductsDataTable` s столбцов.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-192">The data fields returned by the stored procedure are mapped to the `ProductsDataTable` s columns.</span></span> <span data-ttu-id="a6d8a-193">Так как `PriceQuartile` поля данных, возвращаемых из хранимой процедуры, его значение будет назначено `ProductsDataTable` s `PriceQuartile` столбца.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-193">Since there is a `PriceQuartile` data field returned from the stored procedure, its value is assigned to the `ProductsDataTable` s `PriceQuartile` column.</span></span>

<span data-ttu-id="a6d8a-194">Для этих методов адаптера таблицы, чьи запросы не возвращают `PriceQuartile` поля данных `PriceQuartile` значение столбца s — значения, указанного в его `DefaultValue` свойство.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-194">For those TableAdapter methods whose queries do not return a `PriceQuartile` data field, the `PriceQuartile` column s value is the value specified by its `DefaultValue` property.</span></span> <span data-ttu-id="a6d8a-195">Как показано на рисунке 2, это значение равно `DBNull`, значение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-195">As Figure 2 shows, this value is set to `DBNull`, the default.</span></span> <span data-ttu-id="a6d8a-196">Если вы хотите использовать другое значение, просто установите `DefaultValue` свойство соответствующим образом.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-196">If you would prefer a different default value, simply set the `DefaultValue` property accordingly.</span></span> <span data-ttu-id="a6d8a-197">Просто убедитесь, что `DefaultValue` значение допустимо, если s `DataType` (т. е. `System.Int32` для `PriceQuartile` столбца).</span><span class="sxs-lookup"><span data-stu-id="a6d8a-197">Just make sure that the `DefaultValue` value is valid given the column s `DataType` (i.e., `System.Int32` for the `PriceQuartile` column).</span></span>

<span data-ttu-id="a6d8a-198">На этом этапе мы выполнили необходимые действия для добавления дополнительного столбца к таблице данных.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-198">At this point we have performed the necessary steps for adding an additional column to a DataTable.</span></span> <span data-ttu-id="a6d8a-199">Чтобы убедиться, что работает этот дополнительный столбец, позволяют создавать страницы ASP.NET, которая отображает каждого s название продукта, цены и цены квартиль s.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-199">To verify that this additional column works as expected, let s create an ASP.NET page that displays each product s name, price, and price quartile.</span></span> <span data-ttu-id="a6d8a-200">Перед этим, сначала необходимо обновить уровень бизнес-логики, чтобы включить метод, который вызывает DAL s `GetProductsWithPriceQuartile` метод.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-200">Before we do that, though, we first need to update the Business Logic Layer to include a method that calls down to the DAL s `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="a6d8a-201">Мы затем обновить МЕТОДА на шаге 3 и затем создайте страницу ASP.NET в шаге 4.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-201">We will update the BLL next, in Step 3, and then create the ASP.NET page in Step 4.</span></span>

## <a name="step-3-augmenting-the-business-logic-layer"></a><span data-ttu-id="a6d8a-202">Шаг 3: Изменить уровень бизнес-логики</span><span class="sxs-lookup"><span data-stu-id="a6d8a-202">Step 3: Augmenting the Business Logic Layer</span></span>

<span data-ttu-id="a6d8a-203">Прежде чем мы используем новый `GetProductsWithPriceQuartile` метод от уровня представления, мы должны сначала добавьте соответствующий метод для МЕТОДА.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-203">Before we use the new `GetProductsWithPriceQuartile` method from the Presentation Layer, we should first add a corresponding method to the BLL.</span></span> <span data-ttu-id="a6d8a-204">Откройте `ProductsBLLWithSprocs` и добавьте следующий код:</span><span class="sxs-lookup"><span data-stu-id="a6d8a-204">Open the `ProductsBLLWithSprocs` class file and add the following code:</span></span>


[!code-vb[Main](adding-additional-datatable-columns-vb/samples/sample2.vb)]

<span data-ttu-id="a6d8a-205">Как и другие методы получения данных в `ProductsBLLWithSprocs`, `GetProductsWithPriceQuartile` метод просто вызывает DAL соответствующий s `GetProductsWithPriceQuartile` метод и возвращает его результаты.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-205">Like the other data retrieval methods in `ProductsBLLWithSprocs`, the `GetProductsWithPriceQuartile` method simply calls the DAL s corresponding `GetProductsWithPriceQuartile` method and returns its results.</span></span>

## <a name="step-4-displaying-the-price-quartile-information-in-an-aspnet-web-page"></a><span data-ttu-id="a6d8a-206">Шаг 4: Отображение информации квартиль цены на веб-странице ASP.NET</span><span class="sxs-lookup"><span data-stu-id="a6d8a-206">Step 4: Displaying the Price Quartile Information in an ASP.NET Web Page</span></span>

<span data-ttu-id="a6d8a-207">С добавлением МЕТОДА завершения мы готов для создания страницы ASP.NET, которая показывает квартиль цены для каждого продукта.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-207">With the BLL addition complete we re ready to create an ASP.NET page that shows the price quartile for each product.</span></span> <span data-ttu-id="a6d8a-208">Откройте `AddingColumns.aspx` страницы в `AdvancedDAL` папки и перетащите элемент управления GridView с панели элементов в конструктор параметр его `ID` свойства `Products`.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-208">Open the `AddingColumns.aspx` page in the `AdvancedDAL` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` property to `Products`.</span></span> <span data-ttu-id="a6d8a-209">В смарт-теге s GridView, привязать его к новой ObjectDataSource с именем `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-209">From the GridView s smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="a6d8a-210">Настройка ObjectDataSource для использования `ProductsBLLWithSprocs` класса s `GetProductsWithPriceQuartile` метод.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-210">Configure the ObjectDataSource to use the `ProductsBLLWithSprocs` class s `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="a6d8a-211">Поскольку это будет только для чтения сетка, установите раскрывающихся списков в UPDATE, INSERT и удаление вкладок (нет).</span><span class="sxs-lookup"><span data-stu-id="a6d8a-211">Since this will be a read-only grid, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="a6d8a-212">[![Настройка ObjectDataSource с помощью класса ProductsBLLWithSprocs](adding-additional-datatable-columns-vb/_static/image24.png)](adding-additional-datatable-columns-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="a6d8a-212">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](adding-additional-datatable-columns-vb/_static/image24.png)](adding-additional-datatable-columns-vb/_static/image23.png)</span></span>

<span data-ttu-id="a6d8a-213">**Рис. 9**: Настройка ObjectDataSource для использования `ProductsBLLWithSprocs` класса ([Просмотр полноразмерное изображение](adding-additional-datatable-columns-vb/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="a6d8a-213">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image25.png))</span></span>


<span data-ttu-id="a6d8a-214">[![Получить сведения о продукте из метода GetProductsWithPriceQuartile](adding-additional-datatable-columns-vb/_static/image27.png)](adding-additional-datatable-columns-vb/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="a6d8a-214">[![Retrieve Product Information from the GetProductsWithPriceQuartile Method](adding-additional-datatable-columns-vb/_static/image27.png)](adding-additional-datatable-columns-vb/_static/image26.png)</span></span>

<span data-ttu-id="a6d8a-215">**Рис. 10**: получить сведения о продукте из `GetProductsWithPriceQuartile` метод ([Просмотр полноразмерное изображение](adding-additional-datatable-columns-vb/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="a6d8a-215">**Figure 10**: Retrieve Product Information from the `GetProductsWithPriceQuartile` Method ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image28.png))</span></span>


<span data-ttu-id="a6d8a-216">После завершения работы мастера настройки источника данных Visual Studio автоматически добавит BoundField или CheckBoxField GridView для каждого поля данных, возвращаемых методом.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-216">After completing the Configure Data Source wizard, Visual Studio will automatically add a BoundField or CheckBoxField to the GridView for each of the data fields returned by the method.</span></span> <span data-ttu-id="a6d8a-217">Одно из этих полей данных является `PriceQuartile`, мы добавили в столбец `ProductsDataTable` в шаге 1.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-217">One of these data fields is `PriceQuartile`, which is the column we added to the `ProductsDataTable` in Step 1.</span></span>

<span data-ttu-id="a6d8a-218">Изменить поля s GridView, удаляя все, кроме `ProductName`, `UnitPrice`, и `PriceQuartile` стояли.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-218">Edit the GridView s fields, removing all but the `ProductName`, `UnitPrice`, and `PriceQuartile` BoundFields.</span></span> <span data-ttu-id="a6d8a-219">Настройка `UnitPrice` BoundField и отформатировать его значения в качестве валюты `UnitPrice` и `PriceQuartile` стояли вправо — и центру, соответственно.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-219">Configure the `UnitPrice` BoundField to format its value as a currency and have the `UnitPrice` and `PriceQuartile` BoundFields right- and center-aligned, respectively.</span></span> <span data-ttu-id="a6d8a-220">Наконец, обновление оставшихся стояли `HeaderText` свойства с продуктом, цена и цена квартиль, соответственно.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-220">Finally, update the remaining BoundFields `HeaderText` properties to Product, Price, and Price Quartile, respectively.</span></span> <span data-ttu-id="a6d8a-221">Кроме того установите флажок Включить сортировку в смарт-теге s GridView.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-221">Also, check the Enable Sorting checkbox from the GridView s smart tag.</span></span>

<span data-ttu-id="a6d8a-222">После этих изменений GridView и ObjectDataSource s декларативная разметка должна выглядеть следующим образом:</span><span class="sxs-lookup"><span data-stu-id="a6d8a-222">After these modifications, the GridView and ObjectDataSource s declarative markup should look like the following:</span></span>


[!code-aspx[Main](adding-additional-datatable-columns-vb/samples/sample3.aspx)]

<span data-ttu-id="a6d8a-223">Рис. 11 показана эта страница при посещении через браузер.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-223">Figure 11 shows this page when visited through a browser.</span></span> <span data-ttu-id="a6d8a-224">Обратите внимание, что изначально продукты упорядочены по цене, их в порядке убывания с каждого продукта, назначаются соответствующие `PriceQuartile` значение.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-224">Note that, initially, the products are ordered by their price in descending order with each product assigned an appropriate `PriceQuartile` value.</span></span> <span data-ttu-id="a6d8a-225">Конечно эти данные могут быть отсортированы по другим критериям со значением столбца квартиль цены по-прежнему отражения ранжирования продукта s по отношению к цене (см. рис. 12).</span><span class="sxs-lookup"><span data-stu-id="a6d8a-225">Of course this data can be sorted by other criteria with the Price Quartile column value still reflecting the product s ranking with respect to price (see Figure 12).</span></span>


<span data-ttu-id="a6d8a-226">[![Продукты в порядке их цены](adding-additional-datatable-columns-vb/_static/image30.png)](adding-additional-datatable-columns-vb/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="a6d8a-226">[![The Products are Ordered by their Prices](adding-additional-datatable-columns-vb/_static/image30.png)](adding-additional-datatable-columns-vb/_static/image29.png)</span></span>

<span data-ttu-id="a6d8a-227">**Рис. 11**: продукты упорядочены по их цены ([Просмотр полноразмерное изображение](adding-additional-datatable-columns-vb/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="a6d8a-227">**Figure 11**: The Products are Ordered by their Prices ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image31.png))</span></span>


<span data-ttu-id="a6d8a-228">[![Продукты упорядочены по именам](adding-additional-datatable-columns-vb/_static/image33.png)](adding-additional-datatable-columns-vb/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="a6d8a-228">[![The Products are Ordered by their Names](adding-additional-datatable-columns-vb/_static/image33.png)](adding-additional-datatable-columns-vb/_static/image32.png)</span></span>

<span data-ttu-id="a6d8a-229">**Рис. 12**: продукты упорядочены по их именам ([Просмотр полноразмерное изображение](adding-additional-datatable-columns-vb/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="a6d8a-229">**Figure 12**: The Products are Ordered by their Names ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image34.png))</span></span>


> [!NOTE]
> <span data-ttu-id="a6d8a-230">Несколько строк кода, мы может дополнять GridView, чтобы его цвет продукта строк на основе их `PriceQuartile` значение.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-230">With a few lines of code we could augment the GridView so that it colored the product rows based on their `PriceQuartile` value.</span></span> <span data-ttu-id="a6d8a-231">Мы может этих продуктов в первый квартиль светло-зеленый цвет, указанные в второй квартиль Светло-желтый цвет и так далее.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-231">We might color those products in the first quartile a light green, those in the second quartile a light yellow, and so forth.</span></span> <span data-ttu-id="a6d8a-232">Я рекомендую занять некоторое время, чтобы добавить эту функциональность.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-232">I encourage you to take a moment to add this functionality.</span></span> <span data-ttu-id="a6d8a-233">Если вам требуется форматирование элемента управления GridView в памяти, обратитесь к [форматирование на основе по данным](../custom-formatting/custom-formatting-based-upon-data-vb.md) учебника.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-233">If you need a refresher on formatting a GridView, consult the [Custom Formatting Based Upon Data](../custom-formatting/custom-formatting-based-upon-data-vb.md) tutorial.</span></span>


## <a name="an-alternative-approach---creating-another-tableadapter"></a><span data-ttu-id="a6d8a-234">Альтернативный подход — создание другого адаптера таблицы</span><span class="sxs-lookup"><span data-stu-id="a6d8a-234">An Alternative Approach - Creating Another TableAdapter</span></span>

<span data-ttu-id="a6d8a-235">Как было показано в этом учебнике, когда Добавление метода в TableAdapter, возвращающий полей данных, отличного от указано с основным запросом, можно добавить соответствующие столбцы в таблицу DataTable.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-235">As we saw in this tutorial, when adding a method to a TableAdapter that returns data fields other than those spelled out by the main query, we can add corresponding columns to the DataTable.</span></span> <span data-ttu-id="a6d8a-236">Такой подход, однако является только в том случае, если существует небольшое количество методов в адаптер таблицы, которые возвращают различные поля данных и поля альтернативный данных не меняются слишком сильно из основного запроса.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-236">Such an approach, however, works well only if there are a small number of methods in the TableAdapter that return different data fields and if those alternate data fields do not vary too much from the main query.</span></span>

<span data-ttu-id="a6d8a-237">Вместо добавления столбцов в таблицу DataTable, вместо этого можно добавить другой адаптер таблицы к набору данных, который содержит методы из первого адаптера таблицы, которые возвращают различные поля данных.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-237">Rather than adding columns to the DataTable, you can instead add another TableAdapter to the DataSet that contains the methods from the first TableAdapter that return different data fields.</span></span> <span data-ttu-id="a6d8a-238">В этом учебнике, а не добавлять `PriceQuartile` столбец `ProductsDataTable` (где он используется только `GetProductsWithPriceQuartile` метод), удалось добавлена дополнительных адаптера таблицы к набору данных с именем `ProductsWithPriceQuartileTableAdapter` , используемый `Products_SelectWithPriceQuartile` хранимых процедура, как его основным запросом.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-238">For this tutorial, rather than add the `PriceQuartile` column to the `ProductsDataTable` (where it is only used by the `GetProductsWithPriceQuartile` method), we could have added an additional TableAdapter to the DataSet named `ProductsWithPriceQuartileTableAdapter` that used the `Products_SelectWithPriceQuartile` stored procedure as its main query.</span></span> <span data-ttu-id="a6d8a-239">Использовать страниц ASP.NET, которые необходимы для получения сведения о продукте с квартиль цены `ProductsWithPriceQuartileTableAdapter`, а те, которые не удается продолжить использование `ProductsTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-239">ASP.NET pages that needed to get product information with the price quartile would use the `ProductsWithPriceQuartileTableAdapter`, while those that did not could continue to use the `ProductsTableAdapter`.</span></span>

<span data-ttu-id="a6d8a-240">Добавление нового адаптера таблицы, DataTables остаются untarnished и их столбцы точно отражают поля данных, возвращаемые методами s их адаптера таблицы.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-240">By adding a new TableAdapter, the DataTables remain untarnished and their columns precisely mirror the data fields returned by their TableAdapter s methods.</span></span> <span data-ttu-id="a6d8a-241">Тем не менее дополнительные адаптеры таблицы могут появиться повторяющиеся задачи и функции.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-241">However, additional TableAdapters can introduce repetitive tasks and functionality.</span></span> <span data-ttu-id="a6d8a-242">Например, если эти страницы ASP.NET, которая отображается `PriceQuartile` столбца также требуется для предоставления вставки, обновления и удаления поддержки, `ProductsWithPriceQuartileTableAdapter` необходимо иметь его `InsertCommand`, `UpdateCommand`, и `DeleteCommand` свойства должным образом настроить.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-242">For example, if those ASP.NET pages that displayed the `PriceQuartile` column also needed to provide insert, update, and delete support, the `ProductsWithPriceQuartileTableAdapter` would need to have its `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties properly configured.</span></span> <span data-ttu-id="a6d8a-243">Во время этих свойств может отражают `ProductsTableAdapter` s, эта конфигурация предоставляет дополнительный этап.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-243">While these properties would mirror the `ProductsTableAdapter` s, this configuration introduces an extra step.</span></span> <span data-ttu-id="a6d8a-244">Кроме того, существуют теперь два способа обновления, удаления или добавления продукта к базе данных — через `ProductsTableAdapter` и `ProductsWithPriceQuartileTableAdapter` классы.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-244">Moreover, there are now two ways to update, delete, or add a product to the database - through the `ProductsTableAdapter` and `ProductsWithPriceQuartileTableAdapter` classes.</span></span>

<span data-ttu-id="a6d8a-245">В этом учебнике загружаемый файл содержит `ProductsWithPriceQuartileTableAdapter` в класс `NorthwindWithSprocs` набора данных, иллюстрирующий этот альтернативный подход.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-245">The download for this tutorial includes a `ProductsWithPriceQuartileTableAdapter` class in the `NorthwindWithSprocs` DataSet that illustrates this alternative approach.</span></span>

## <a name="summary"></a><span data-ttu-id="a6d8a-246">Сводка</span><span class="sxs-lookup"><span data-stu-id="a6d8a-246">Summary</span></span>

<span data-ttu-id="a6d8a-247">В большинстве случаев все методы в адаптере таблицы возвращает тот же набор полей данных, но бывают случаи, когда конкретный метод или два может потребоваться вернуть дополнительное поле.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-247">In most scenarios, all of the methods in a TableAdapter will return the same set of data fields, but there are times when a particular method or two may need to return an additional field.</span></span> <span data-ttu-id="a6d8a-248">Например, в [главный/Detail, с помощью маркированного списка из главного записей с DataList сведения](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md) учебника мы добавили метод `CategoriesTableAdapter` , в дополнение к основным запросом s поля данных, возвращаемых `NumberOfProducts` полю, указывается число продукты, связанные с каждой категории.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-248">For example, in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md) tutorial we added a method to the `CategoriesTableAdapter` that, in addition to the main query s data fields, returned a `NumberOfProducts` field that reported the number of products associated with each category.</span></span> <span data-ttu-id="a6d8a-249">В этом учебнике мы рассмотрели Добавление метода в `ProductsTableAdapter` , которые вернули `PriceQuartile` поля в дополнение к основным запросом s поля данных.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-249">In this tutorial we looked at adding a method in the `ProductsTableAdapter` that returned a `PriceQuartile` field in addition to the main query s data fields.</span></span> <span data-ttu-id="a6d8a-250">Для сбора дополнительных данных полей, возвращенных s методы адаптера таблицы, необходимо добавить соответствующие столбцы в таблицу DataTable.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-250">To capture additional data fields returned by the TableAdapter s methods we need to add corresponding columns to the DataTable.</span></span>

<span data-ttu-id="a6d8a-251">Если планируется вручную добавлять столбцы в таблицу DataTable, рекомендуется использование хранимых процедур адаптера таблицы.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-251">If you plan on manually adding columns to the DataTable, it is recommended that the TableAdapter use stored procedures.</span></span> <span data-ttu-id="a6d8a-252">Если адаптер таблицы использует инструкции SQL ad-hoc, любое время настройки адаптера таблицы запускается мастер, все методы, поля данных, возвращенной основным запросом восстановить списки полей данных.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-252">If the TableAdapter uses ad-hoc SQL statements, any time the TableAdapter Configuration wizard is run all of the methods data field lists revert to the data fields returned by the main query.</span></span> <span data-ttu-id="a6d8a-253">Эта проблема не распространяется на хранимые процедуры, поэтому их рекомендуется использовать и использовались в этом учебнике.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-253">This problem does not extend to stored procedures, which is why they are recommended and were used in this tutorial.</span></span>

<span data-ttu-id="a6d8a-254">Программирование довольны!</span><span class="sxs-lookup"><span data-stu-id="a6d8a-254">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="a6d8a-255">Об авторе</span><span class="sxs-lookup"><span data-stu-id="a6d8a-255">About the Author</span></span>

<span data-ttu-id="a6d8a-256">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-256">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="a6d8a-257">Скотт — независимый консультант, trainer и записи.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-257">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="a6d8a-258">Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="a6d8a-258">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="a6d8a-259">Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="a6d8a-259">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="a6d8a-260">Благодарности</span><span class="sxs-lookup"><span data-stu-id="a6d8a-260">Special Thanks To</span></span>

<span data-ttu-id="a6d8a-261">Этот учебник ряд прошел проверку многие полезные рецензентов.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-261">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="a6d8a-262">Основными редакторами этого учебника были Рэнди Шмидт, Jacky Goor, Екатерина Leigh и – Хилтон Гизнау.</span><span class="sxs-lookup"><span data-stu-id="a6d8a-262">Lead reviewers for this tutorial were Randy Schmidt, Jacky Goor, Bernadette Leigh, and Hilton Giesenow.</span></span> <span data-ttu-id="a6d8a-263">Объясняются моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="a6d8a-263">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="a6d8a-264">Если Да, напишите мне по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a6d8a-264">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="a6d8a-265">[Назад](updating-the-tableadapter-to-use-joins-vb.md)
[Вперед](working-with-computed-columns-vb.md)</span><span class="sxs-lookup"><span data-stu-id="a6d8a-265">[Previous](updating-the-tableadapter-to-use-joins-vb.md)
[Next](working-with-computed-columns-vb.md)</span></span>
