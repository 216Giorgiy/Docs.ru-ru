---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-cs
title: "Обработка исключений уровня DAL и уровень бизнес-ЛОГИКИ (C#) | Документы Microsoft"
author: rick-anderson
description: "В этом учебнике будет рассмотрена tactfully обработки исключений, возникающих во время обновления рабочего процесса для редактирования DataList."
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/30/2006
ms.topic: article
ms.assetid: f8fd58e2-f932-4f08-ab3d-fbf8ff3295d2
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-cs
msc.type: authoredcontent
ms.openlocfilehash: 659976d40f6109422f222d794b54d837faeb0764
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/10/2017
---
<a name="handling-bll--and-dal-level-exceptions-c"></a><span data-ttu-id="1e305-103">Обработка исключений уровня DAL и уровень бизнес-ЛОГИКИ (C#)</span><span class="sxs-lookup"><span data-stu-id="1e305-103">Handling BLL- and DAL-Level Exceptions (C#)</span></span>
====================
<span data-ttu-id="1e305-104">по [Скотт Митчелл](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="1e305-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="1e305-105">[Загрузить пример приложения](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_CS.exe) или [скачать PDF](handling-bll-and-dal-level-exceptions-cs/_static/datatutorial38cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="1e305-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_CS.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-cs/_static/datatutorial38cs1.pdf)</span></span>

> <span data-ttu-id="1e305-106">В этом учебнике будет рассмотрена tactfully обработки исключений, возникающих во время обновления рабочего процесса для редактирования DataList.</span><span class="sxs-lookup"><span data-stu-id="1e305-106">In this tutorial, we'll see how to tactfully handle exceptions raised during an editable DataList's updating workflow.</span></span>


## <a name="introduction"></a><span data-ttu-id="1e305-107">Вступление</span><span class="sxs-lookup"><span data-stu-id="1e305-107">Introduction</span></span>

<span data-ttu-id="1e305-108">В [Общие сведения об изменении и удалении данных в DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) учебнике мы создали DataList, предлагаемых простое изменение и удаление возможностей.</span><span class="sxs-lookup"><span data-stu-id="1e305-108">In the [Overview of Editing and Deleting Data in the DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) tutorial, we created a DataList that offered simple editing and deleting capabilities.</span></span> <span data-ttu-id="1e305-109">Хотя полностью функциональны он вряд ли удобной для пользователей, как любой ошибки, возникшей во время изменения или процесс удаления привело к возникновению необработанного исключения.</span><span class="sxs-lookup"><span data-stu-id="1e305-109">While fully functional, it was hardly user-friendly, as any error that occurred during the editing or deleting process resulted in an unhandled exception.</span></span> <span data-ttu-id="1e305-110">Например, имя продукта s или, при изменении продукта, введите значение цены за очень недорогим!, приводит к возникновению исключения.</span><span class="sxs-lookup"><span data-stu-id="1e305-110">For example, omitting the product s name or, when editing a product, entering a price value of Very affordable!, throws an exception.</span></span> <span data-ttu-id="1e305-111">Так как это исключение не обработано в коде, он поднимает до среды выполнения ASP.NET, которая затем отображает сведения об исключении s в веб-странице.</span><span class="sxs-lookup"><span data-stu-id="1e305-111">Since this exception is not caught in code, it bubbles up to the ASP.NET runtime, which then displays the exception s details in the web page.</span></span>

<span data-ttu-id="1e305-112">Как мы видели в [обработки уровень бизнес-ЛОГИКИ и исключения уровня DAL на странице ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) учебник, если исключение создается из глубин бизнес-логику или уровней доступа к данным, сведения об исключении возвращаются в элемент управления ObjectDataSource и затем к GridView.</span><span class="sxs-lookup"><span data-stu-id="1e305-112">As we saw in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, if an exception is raised from the depths of the Business Logic or Data Access Layers, the exception details are returned to the ObjectDataSource and then to the GridView.</span></span> <span data-ttu-id="1e305-113">Мы узнали, как для правильной обработки этих исключений путем создания `Updated` или `RowUpdated` обработчики событий для ObjectDataSource или GridView, проверка для исключения, а затем, указывающее, что исключение было обработано.</span><span class="sxs-lookup"><span data-stu-id="1e305-113">We saw how to gracefully handle these exceptions by creating `Updated` or `RowUpdated` event handlers for the ObjectDataSource or GridView, checking for an exception, and then indicating that the exception was handled.</span></span>

<span data-ttu-id="1e305-114">DataList учебные видеоматериалы, однако нельзя t с использованием ObjectDataSource для обновления и удаления данных.</span><span class="sxs-lookup"><span data-stu-id="1e305-114">Our DataList tutorials, however, aren t using the ObjectDataSource for updating and deleting data.</span></span> <span data-ttu-id="1e305-115">Мы работаем непосредственно для МЕТОДА.</span><span class="sxs-lookup"><span data-stu-id="1e305-115">Instead, we are working directly against the BLL.</span></span> <span data-ttu-id="1e305-116">Чтобы обнаружить исключения, исходящие от уровень бизнес-ЛОГИКИ или DAL, необходимо реализовать код внутри кода нашу страницу ASP.NET обработки исключений.</span><span class="sxs-lookup"><span data-stu-id="1e305-116">In order to detect exceptions originating from the BLL or DAL, we need to implement exception handling code within the code-behind of our ASP.NET page.</span></span> <span data-ttu-id="1e305-117">В этом учебнике будет рассмотрена более tactfully обработки исключений, возникающих во время редактирования s DataList обновление рабочего процесса.</span><span class="sxs-lookup"><span data-stu-id="1e305-117">In this tutorial, we'll see how to more tactfully handle exceptions raised during an editable DataList s updating workflow.</span></span>

> [!NOTE]
> <span data-ttu-id="1e305-118">В *Обзор редактирование и удаление данных в DataList* учебнике мы рассмотрели разных методов изменения и удаления данных из DataList некоторые методы, связана с использованием ObjectDataSource для обновления и удаление.</span><span class="sxs-lookup"><span data-stu-id="1e305-118">In the *An Overview of Editing and Deleting Data in the DataList* tutorial we discussed different techniques for editing and deleting data from the DataList, Some techniques involved using an ObjectDataSource for updating and deleting.</span></span> <span data-ttu-id="1e305-119">Если вы применяете эти методы, можно обрабатывать исключения из МЕТОДА или DAL через ObjectDataSource s `Updated` или `Deleted` обработчики событий.</span><span class="sxs-lookup"><span data-stu-id="1e305-119">If you employ these techniques, you can handle exceptions from the BLL or DAL through the ObjectDataSource s `Updated` or `Deleted` event handlers.</span></span>


## <a name="step-1-creating-an-editable-datalist"></a><span data-ttu-id="1e305-120">Шаг 1: Создание редактируемых DataList</span><span class="sxs-lookup"><span data-stu-id="1e305-120">Step 1: Creating an Editable DataList</span></span>

<span data-ttu-id="1e305-121">Прежде чем мы беспокоиться об обработке исключений, возникающих во время обновления рабочего процесса, позволяют s сначала создать редактируемый DataList.</span><span class="sxs-lookup"><span data-stu-id="1e305-121">Before we worry about handling exceptions that occur during the updating workflow, let s first create an editable DataList.</span></span> <span data-ttu-id="1e305-122">Откройте `ErrorHandling.aspx` страницы в `EditDeleteDataList` набор папок, добавьте в конструктор DataList его `ID` свойства `Products`, и добавьте новый элемент управления ObjectDataSource с именем `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="1e305-122">Open the `ErrorHandling.aspx` page in the `EditDeleteDataList` folder, add a DataList to the Designer, set its `ID` property to `Products`, and add a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="1e305-123">Настройка ObjectDataSource для использования `ProductsBLL` класса s `GetProducts()` записывает метод выбора, задайте в инструкции INSERT, UPDATE, раскрывающиеся списки и удалять вкладки (нет).</span><span class="sxs-lookup"><span data-stu-id="1e305-123">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProducts()` method for selecting records; set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>


<span data-ttu-id="1e305-124">[![Возвращает сведения о продукте, с помощью метода GetProducts()](handling-bll-and-dal-level-exceptions-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="1e305-124">[![Return the Product Information Using the GetProducts() Method](handling-bll-and-dal-level-exceptions-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-cs/_static/image1.png)</span></span>

<span data-ttu-id="1e305-125">**Рис. 1**: возвращать сведения о продукта с помощью `GetProducts()` метод ([Просмотр полноразмерное изображение](handling-bll-and-dal-level-exceptions-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="1e305-125">**Figure 1**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image3.png))</span></span>


<span data-ttu-id="1e305-126">После завершения работы мастера ObjectDataSource Visual Studio автоматически создает `ItemTemplate` для DataList.</span><span class="sxs-lookup"><span data-stu-id="1e305-126">After completing the ObjectDataSource wizard, Visual Studio will automatically create an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="1e305-127">Введите здесь с `ItemTemplate` , отображает каждый s имя и цену продукта, а также кнопку "Изменить".</span><span class="sxs-lookup"><span data-stu-id="1e305-127">Replace this with an `ItemTemplate` that displays each product s name and price and includes an Edit button.</span></span> <span data-ttu-id="1e305-128">Создайте `EditItemTemplate` с веб-управления TextBox для имени и цена и кнопок "обновления" и "Отмена".</span><span class="sxs-lookup"><span data-stu-id="1e305-128">Next, create an `EditItemTemplate` with a TextBox Web control for name and price and Update and Cancel buttons.</span></span> <span data-ttu-id="1e305-129">Задайте в DataList s `RepeatColumns` равным 2.</span><span class="sxs-lookup"><span data-stu-id="1e305-129">Finally, set the DataList s `RepeatColumns` property to 2.</span></span>

<span data-ttu-id="1e305-130">После внесения этих изменений на страницу s должна выглядеть следующим образом.</span><span class="sxs-lookup"><span data-stu-id="1e305-130">After these changes, your page s declarative markup should look similar to the following.</span></span> <span data-ttu-id="1e305-131">Следует внимательно убедитесь, что изменения в "Отмена", и обновление кнопок их `CommandName` набор свойств для редактирования, Отмена и обновление, соответственно.</span><span class="sxs-lookup"><span data-stu-id="1e305-131">Double-check to make certain that the Edit, Cancel, and Update buttons have their `CommandName` properties set to Edit, Cancel, and Update, respectively.</span></span>


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="1e305-132">В этом учебнике DataList s состояния просмотра должна быть включена.</span><span class="sxs-lookup"><span data-stu-id="1e305-132">For this tutorial the DataList s view state must be enabled.</span></span>


<span data-ttu-id="1e305-133">Теперь пора просмотрите ход работы через браузер (см. рис. 2).</span><span class="sxs-lookup"><span data-stu-id="1e305-133">Take a moment to view our progress through a browser (see Figure 2).</span></span>


<span data-ttu-id="1e305-134">[![Каждый продукт включает кнопку «Изменить»](handling-bll-and-dal-level-exceptions-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="1e305-134">[![Each Product Includes an Edit Button](handling-bll-and-dal-level-exceptions-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-cs/_static/image4.png)</span></span>

<span data-ttu-id="1e305-135">**На рисунке 2**: каждый продукт включает кнопку Изменить ([Просмотр полноразмерное изображение](handling-bll-and-dal-level-exceptions-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="1e305-135">**Figure 2**: Each Product Includes an Edit Button ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image6.png))</span></span>


<span data-ttu-id="1e305-136">В настоящее время кнопка правки только вызывает обратную передачу его t еще делают этот продукт для редактирования.</span><span class="sxs-lookup"><span data-stu-id="1e305-136">Currently, the Edit button only causes a postback it doesn t yet make the product editable.</span></span> <span data-ttu-id="1e305-137">Чтобы включить редактирование, нам нужно создавать обработчики событий для DataList s `EditCommand`, `CancelCommand`, и `UpdateCommand` события.</span><span class="sxs-lookup"><span data-stu-id="1e305-137">To enable editing, we need to create event handlers for the DataList s `EditCommand`, `CancelCommand`, and `UpdateCommand` events.</span></span> <span data-ttu-id="1e305-138">`EditCommand` И `CancelCommand` события достаточно обновить DataList s `EditItemIndex` свойство и повторную привязку данных к элементу управления DataList:</span><span class="sxs-lookup"><span data-stu-id="1e305-138">The `EditCommand` and `CancelCommand` events simply update the DataList s `EditItemIndex` property and rebind the data to the DataList:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample2.cs)]

<span data-ttu-id="1e305-139">`UpdateCommand` Немного сложнее обработчика событий.</span><span class="sxs-lookup"><span data-stu-id="1e305-139">The `UpdateCommand` event handler is a bit more involved.</span></span> <span data-ttu-id="1e305-140">Его требуется считать продукта s `ProductID` из `DataKeys` коллекции вместе с s имя и цену продукта из текстовых полей в `EditItemTemplate`, а затем вызвать `ProductsBLL` класса s `UpdateProduct` метод перед возвратом DataList в состояние до редактирования.</span><span class="sxs-lookup"><span data-stu-id="1e305-140">It needs to read in the edited product s `ProductID` from the `DataKeys` collection along with the product s name and price from the TextBoxes in the `EditItemTemplate`, and then call the `ProductsBLL` class s `UpdateProduct` method before returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="1e305-141">Теперь позволяют s просто использовать именно тот же код из `UpdateCommand` обработчик событий в *Общие сведения об изменении и удалении данных в DataList* учебника.</span><span class="sxs-lookup"><span data-stu-id="1e305-141">For now, let s just use the exact same code from the `UpdateCommand` event handler in the *Overview of Editing and Deleting Data in the DataList* tutorial.</span></span> <span data-ttu-id="1e305-142">Мы добавим код для правильной обработки исключений в шаге 2.</span><span class="sxs-lookup"><span data-stu-id="1e305-142">We'll add the code to gracefully handle exceptions in step 2.</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample3.cs)]

<span data-ttu-id="1e305-143">В случае недопустимых входных данных которого может быть в форме неправильно отформатированный цена, недопустимая единица цены, например - 5,00 или заменяют s название продукта, будет вызвано исключение.</span><span class="sxs-lookup"><span data-stu-id="1e305-143">In the face of invalid input which can be in the form of an improperly formatted unit price, an illegal unit price value like -$5.00, or the omission of the product s name an exception will be raised.</span></span> <span data-ttu-id="1e305-144">Поскольку `UpdateCommand` обработчик событий не включает все на этом этапе код обработки исключения, исключение будет передано ASP.NET во время выполнения, где будет отображаться для конечного пользователя (см. рис. 3).</span><span class="sxs-lookup"><span data-stu-id="1e305-144">Since the `UpdateCommand` event handler does not include any exception handling code at this point, the exception will bubble up to the ASP.NET runtime, where it will be displayed to the end user (see Figure 3).</span></span>


![При возникновении необработанного исключения, конечный пользователь видит страницу ошибки](handling-bll-and-dal-level-exceptions-cs/_static/image7.png)

<span data-ttu-id="1e305-146">**Рис. 3**: при возникновении необработанного исключения, конечный пользователь видит страницу ошибки</span><span class="sxs-lookup"><span data-stu-id="1e305-146">**Figure 3**: When an Unhandled Exception Occurs, the End User Sees an Error Page</span></span>


## <a name="step-2-gracefully-handling-exceptions-in-the-updatecommand-event-handler"></a><span data-ttu-id="1e305-147">Шаг 2: Корректно обработка исключений в обработчике событий UpdateCommand</span><span class="sxs-lookup"><span data-stu-id="1e305-147">Step 2: Gracefully Handling Exceptions in the UpdateCommand Event Handler</span></span>

<span data-ttu-id="1e305-148">Во время обновления рабочего процесса, исключения могут возникать в `UpdateCommand` обработчик событий, уровень бизнес-ЛОГИКИ или DAL.</span><span class="sxs-lookup"><span data-stu-id="1e305-148">During the updating workflow, exceptions can occur in the `UpdateCommand` event handler, the BLL, or the DAL.</span></span> <span data-ttu-id="1e305-149">Например, если пользователь вводит ценой слишком много ресурсов, `Decimal.Parse` инструкции в `UpdateCommand` обработчик событий вызывает исключение `FormatException` исключение.</span><span class="sxs-lookup"><span data-stu-id="1e305-149">For example, if a user enters a price of Too expensive, the `Decimal.Parse` statement in the `UpdateCommand` event handler will throw a `FormatException` exception.</span></span> <span data-ttu-id="1e305-150">Если пользователь опустил s имя продукта или цену имеет отрицательное значение, МЕТОД вызовет исключение.</span><span class="sxs-lookup"><span data-stu-id="1e305-150">If the user omits the product s name or if the price has a negative value, the DAL will raise an exception.</span></span>

<span data-ttu-id="1e305-151">При возникновении исключения необходимо отобразить информационное сообщение внутри самой страницы.</span><span class="sxs-lookup"><span data-stu-id="1e305-151">When an exception occurs, we want to display an informative message within the page itself.</span></span> <span data-ttu-id="1e305-152">Добавление метки веб-элемент управления на страницу `ID` равно `ExceptionDetails`.</span><span class="sxs-lookup"><span data-stu-id="1e305-152">Add a Label Web control to the page whose `ID` is set to `ExceptionDetails`.</span></span> <span data-ttu-id="1e305-153">Настройка метки s текст, отображаемый красным, очень большой, полужирный и курсивный шрифт, назначив его `CssClass` свойства `Warning` класс CSS, который определен в `Styles.css` файла.</span><span class="sxs-lookup"><span data-stu-id="1e305-153">Configure the Label s text to display in a red, extra-large, bold and italic font by assigning its `CssClass` property to the `Warning` CSS class, which is defined in the `Styles.css` file.</span></span>

<span data-ttu-id="1e305-154">При возникновении ошибки нам нужен только метку, которая должна отображаться один раз.</span><span class="sxs-lookup"><span data-stu-id="1e305-154">When an error occurs, we only want the Label to be displayed once.</span></span> <span data-ttu-id="1e305-155">То есть при последующих обратных передачах предупреждающее сообщение подписи s должна исчезнуть.</span><span class="sxs-lookup"><span data-stu-id="1e305-155">That is, on subsequent postbacks, the Label s warning message should disappear.</span></span> <span data-ttu-id="1e305-156">Это можно сделать, сняв out метки s `Text` свойства или параметры его `Visible` свойства `False` в `Page_Load` обработчик событий (как это делалось в [обработки уровень бизнес-ЛОГИКИ и уровня DAL исключений в среде ASP Страница .NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) учебника) или путем отключения поддержки состояния представления метки s.</span><span class="sxs-lookup"><span data-stu-id="1e305-156">This can be accomplished by either clearing out the Label s `Text` property or settings its `Visible` property to `False` in the `Page_Load` event handler (as we did back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial) or by disabling the Label s view state support.</span></span> <span data-ttu-id="1e305-157">Разрешить s второй вариант следует использовать.</span><span class="sxs-lookup"><span data-stu-id="1e305-157">Let s use the latter option.</span></span>


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample4.aspx)]

<span data-ttu-id="1e305-158">При возникновении исключения, мы будем назначить сведения исключения, чтобы `ExceptionDetails` метки элемента управления s `Text` свойство.</span><span class="sxs-lookup"><span data-stu-id="1e305-158">When an exception is raised, we'll assign the details of the exception to the `ExceptionDetails` Label control s `Text` property.</span></span> <span data-ttu-id="1e305-159">Так как состояние просмотра отключено, при последующих обратных передачах `Text` свойство s программного изменения будут потеряны, вернитесь к текст по умолчанию (пустая строка), таким образом скрывая предупреждающее сообщение.</span><span class="sxs-lookup"><span data-stu-id="1e305-159">Since its view state is disabled, on subsequent postbacks the `Text` property s programmatic changes will be lost, reverting back to the default text (an empty string), thereby hiding the warning message.</span></span>

<span data-ttu-id="1e305-160">Чтобы определить, когда возникает ошибка для отображения на странице отображается информационное сообщение, необходимо добавить `Try ... Catch` блока `UpdateCommand` обработчика событий.</span><span class="sxs-lookup"><span data-stu-id="1e305-160">To determine when an error has been raised in order to display a helpful message on the page, we need to add a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="1e305-161">`Try` Часть содержит код, который может привести к возникновению исключения при `Catch` блок содержит код, выполняемый при возникновении исключения.</span><span class="sxs-lookup"><span data-stu-id="1e305-161">The `Try` portion contains code that may lead to an exception, while the `Catch` block contains code that is executed in the face of an exception.</span></span> <span data-ttu-id="1e305-162">Извлечение [основы обработки исключений](https://msdn.microsoft.com/en-us/library/2w8f0bss.aspx) раздела документации по .NET Framework для получения дополнительной информации о `Try ... Catch` блока.</span><span class="sxs-lookup"><span data-stu-id="1e305-162">Check out the [Exception Handling Fundamentals](https://msdn.microsoft.com/en-us/library/2w8f0bss.aspx) section in the .NET Framework documentation for more information on the `Try ... Catch` block.</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample5.cs)]

<span data-ttu-id="1e305-163">При любого типа, создается исключение, код внутри `Try` блока `Catch` начинается выполнение блоков кода.</span><span class="sxs-lookup"><span data-stu-id="1e305-163">When an exception of any type is thrown by code within the `Try` block, the `Catch` block s code will begin executing.</span></span> <span data-ttu-id="1e305-164">Тип исключения, создаваемое `DbException`, `NoNullAllowedException`, `ArgumentException`и т. д., зависит, какие именно, ставшее причиной ошибки в первую очередь.</span><span class="sxs-lookup"><span data-stu-id="1e305-164">The type of exception that is thrown `DbException`, `NoNullAllowedException`, `ArgumentException`, and so on depends on what, exactly, precipitated the error in the first place.</span></span> <span data-ttu-id="1e305-165">Если существует проблема s на уровне базы данных, `DbException` будет создано.</span><span class="sxs-lookup"><span data-stu-id="1e305-165">If there s a problem at the database level, a `DbException` will be thrown.</span></span> <span data-ttu-id="1e305-166">Если указано недопустимое значение для `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, или `ReorderLevel` поля, `ArgumentException` будет создаваться, как был добавлен код для проверки значений этих полей в `ProductsDataTable` класса (см. [ Создание бизнес-логики](../introduction/creating-a-business-logic-layer-cs.md) учебника).</span><span class="sxs-lookup"><span data-stu-id="1e305-166">If an illegal value is entered for the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` fields, an `ArgumentException` will be thrown, as we added code to validate these field values in the `ProductsDataTable` class (see the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial).</span></span>

<span data-ttu-id="1e305-167">Мы можем предоставить дополнительные пояснения конечному пользователю на основе типа обнаружено исключение текст сообщения.</span><span class="sxs-lookup"><span data-stu-id="1e305-167">We can provide a more helpful explanation to the end user by basing the message text on the type of exception caught.</span></span> <span data-ttu-id="1e305-168">Следующий код, который использовался в почти те же форму обратно в [обработки уровень бизнес-ЛОГИКИ и исключения уровня DAL на странице ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) учебник такой уровень детализации:</span><span class="sxs-lookup"><span data-stu-id="1e305-168">The following code which was used in a nearly identical form back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial provides this level of detail:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample6.cs)]

<span data-ttu-id="1e305-169">Для выполнения заданий данного учебника, просто вызовите `DisplayExceptionDetails` метод `Catch` блока, передавая на Перехваченный `Exception` экземпляра (`ex`).</span><span class="sxs-lookup"><span data-stu-id="1e305-169">To complete this tutorial, simply call the `DisplayExceptionDetails` method from the `Catch` block passing in the caught `Exception` instance (`ex`).</span></span>

<span data-ttu-id="1e305-170">С `Try ... Catch` блока в месте, пользователи получают сообщение более подробное сообщение об ошибке, как данные 4 и 5 Показать.</span><span class="sxs-lookup"><span data-stu-id="1e305-170">With the `Try ... Catch` block in place, users are presented with a more informative error message, as Figures 4 and 5 show.</span></span> <span data-ttu-id="1e305-171">Обратите внимание, что при возникновении исключения DataList остается в режиме редактирования.</span><span class="sxs-lookup"><span data-stu-id="1e305-171">Note that in the face of an exception the DataList remains in edit mode.</span></span> <span data-ttu-id="1e305-172">Это так, как при возникновении исключения, поток управления немедленно перенаправлены в `Catch` блока, минуя код, который возвращается в состояние до редактирования DataList.</span><span class="sxs-lookup"><span data-stu-id="1e305-172">This is because once the exception occurs, the control flow is immediately redirected to the `Catch` block, bypassing the code that returns the DataList to its pre-editing state.</span></span>


<span data-ttu-id="1e305-173">[![Сообщение об ошибке отображается, если пользователь опускает необходимые поля](handling-bll-and-dal-level-exceptions-cs/_static/image9.png)](handling-bll-and-dal-level-exceptions-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="1e305-173">[![An Error Message is Displayed if a User Omits a Required Field](handling-bll-and-dal-level-exceptions-cs/_static/image9.png)](handling-bll-and-dal-level-exceptions-cs/_static/image8.png)</span></span>

<span data-ttu-id="1e305-174">**Рис. 4**: сообщение об ошибке отображается, если пользователь опускает необходимые поля ([Просмотр полноразмерное изображение](handling-bll-and-dal-level-exceptions-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="1e305-174">**Figure 4**: An Error Message is Displayed if a User Omits a Required Field ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image10.png))</span></span>


<span data-ttu-id="1e305-175">[![— Сообщение об ошибке отображается при вводе отрицательного цены](handling-bll-and-dal-level-exceptions-cs/_static/image12.png)](handling-bll-and-dal-level-exceptions-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="1e305-175">[![An Error Message is Displayed When Entering a Negative Price](handling-bll-and-dal-level-exceptions-cs/_static/image12.png)](handling-bll-and-dal-level-exceptions-cs/_static/image11.png)</span></span>

<span data-ttu-id="1e305-176">**Рис. 5**: является сообщение об ошибке отображается при вводе отрицательного цены ([Просмотр полноразмерное изображение](handling-bll-and-dal-level-exceptions-cs/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="1e305-176">**Figure 5**: An Error Message is Displayed When Entering a Negative Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image13.png))</span></span>


## <a name="summary"></a><span data-ttu-id="1e305-177">Сводка</span><span class="sxs-lookup"><span data-stu-id="1e305-177">Summary</span></span>

<span data-ttu-id="1e305-178">GridView и ObjectDataSource предоставить обработчики, содержащие сведения о любые исключения, возникшие при выполнении рабочего процесса обновления и удаления, а также свойства, которые могут содержать значение, указывающее, было ли исключение обработано.</span><span class="sxs-lookup"><span data-stu-id="1e305-178">The GridView and ObjectDataSource provide post-level event handlers that include information about any exceptions that were raised during the updating and deleting workflow, as well as properties that can be set to indicate whether or not the exception has been handled.</span></span> <span data-ttu-id="1e305-179">Эти функции, однако недоступны при работе с DataList и непосредственно с помощью МЕТОДА.</span><span class="sxs-lookup"><span data-stu-id="1e305-179">These features, however, are unavailable when working with the DataList and using the BLL directly.</span></span> <span data-ttu-id="1e305-180">Вместо этого мы отвечают за реализации обработки исключений.</span><span class="sxs-lookup"><span data-stu-id="1e305-180">Instead, we are responsible for implementing exception handling.</span></span>

<span data-ttu-id="1e305-181">В этом учебнике мы узнали, как добавить обработку исключений для редактирования s DataList обновлении рабочего процесса путем добавления `Try ... Catch` блока `UpdateCommand` обработчика событий.</span><span class="sxs-lookup"><span data-stu-id="1e305-181">In this tutorial we saw how to add exception handling to an editable DataList s updating workflow by adding a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="1e305-182">Если исключение возникает во время обновления рабочего процесса, `Catch` блоков кода выполняется отображение полезную информацию в `ExceptionDetails` метки.</span><span class="sxs-lookup"><span data-stu-id="1e305-182">If an exception is raised during the updating workflow, the `Catch` block s code executes, displaying helpful information in the `ExceptionDetails` Label.</span></span>

<span data-ttu-id="1e305-183">На этом этапе DataList делает не пытается предотвратить исключения в первую очередь.</span><span class="sxs-lookup"><span data-stu-id="1e305-183">At this point, the DataList makes no effort to prevent exceptions from happening in the first place.</span></span> <span data-ttu-id="1e305-184">Несмотря на то, что мы знаем, что приведет к отрицательным цена исключение, нам не удалось t еще добавлены функциональные возможности для эффективного устранения пользователя вводить такие недопустимые входные данные.</span><span class="sxs-lookup"><span data-stu-id="1e305-184">Even though we know that a negative price will result in an exception, we haven t yet added any functionality to proactively prevent a user from entering such invalid input.</span></span> <span data-ttu-id="1e305-185">В нашем следующем уроке будет рассмотрена с целью сокращения исключения, вызванные пользователем недопустимые данные путем добавления элементов управления проверки в `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="1e305-185">In our next tutorial we'll see how to help reduce the exceptions caused by invalid user input by adding validation controls in the `EditItemTemplate`.</span></span>

<span data-ttu-id="1e305-186">Программирование довольны!</span><span class="sxs-lookup"><span data-stu-id="1e305-186">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="1e305-187">Дополнительные сведения</span><span class="sxs-lookup"><span data-stu-id="1e305-187">Further Reading</span></span>

<span data-ttu-id="1e305-188">Дополнительные сведения по темам, рассматриваемые в этом учебнике см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="1e305-188">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="1e305-189">Правила разработки исключений</span><span class="sxs-lookup"><span data-stu-id="1e305-189">Design Guidelines for Exceptions</span></span>](https://msdn.microsoft.com/en-us/library/ms298399.aspx)
- <span data-ttu-id="1e305-190">[Модули ведения журнала ошибок и обработчики (ELMAH)](http://workspaces.gotdotnet.com/elmah) (библиотека открытым исходным кодом для ведения журнала ошибок)</span><span class="sxs-lookup"><span data-stu-id="1e305-190">[Error Logging Modules and Handlers (ELMAH)](http://workspaces.gotdotnet.com/elmah) (an open-source library for logging errors)</span></span>
- <span data-ttu-id="1e305-191">[Enterprise Library для .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (включает блок управления исключений)</span><span class="sxs-lookup"><span data-stu-id="1e305-191">[Enterprise Library for .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (includes the Exception Management Application Block)</span></span>

## <a name="about-the-author"></a><span data-ttu-id="1e305-192">Об авторе</span><span class="sxs-lookup"><span data-stu-id="1e305-192">About the Author</span></span>

<span data-ttu-id="1e305-193">[Скотт Митчелл](http://www.4guysfromrolla.com/ScottMitchell.shtml), автор семи ASP/ASP.NET и основателя из [4GuysFromRolla.com](http://www.4guysfromrolla.com), работает с веб-технологиями Майкрософт с 1998 года.</span><span class="sxs-lookup"><span data-stu-id="1e305-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="1e305-194">Скотт — независимый консультант, trainer и записи.</span><span class="sxs-lookup"><span data-stu-id="1e305-194">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="1e305-195">Его последняя книга — [ *диспетчерами учат самостоятельно ASP.NET 2.0 в течение 24 часов*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="1e305-195">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="1e305-196">Он может быть достигнута по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) или через его блог, который можно найти в [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="1e305-196">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="1e305-197">Благодарности</span><span class="sxs-lookup"><span data-stu-id="1e305-197">Special Thanks To</span></span>

<span data-ttu-id="1e305-198">Этот учебник ряд прошел проверку многие полезные рецензентов.</span><span class="sxs-lookup"><span data-stu-id="1e305-198">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="1e305-199">Основной рецензент этого учебника было Алексей Pespisa.</span><span class="sxs-lookup"><span data-stu-id="1e305-199">Lead reviewer for this tutorial was Ken Pespisa.</span></span> <span data-ttu-id="1e305-200">Объясняются моих последующих статей для MSDN?</span><span class="sxs-lookup"><span data-stu-id="1e305-200">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="1e305-201">Если Да, напишите мне по [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="1e305-201">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="1e305-202">[Назад](performing-batch-updates-cs.md)
[Вперед](adding-validation-controls-to-the-datalist-s-editing-interface-cs.md)</span><span class="sxs-lookup"><span data-stu-id="1e305-202">[Previous](performing-batch-updates-cs.md)
[Next](adding-validation-controls-to-the-datalist-s-editing-interface-cs.md)</span></span>
